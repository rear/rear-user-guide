<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>Internal Backup with rsync to NFS server - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Internal Backup with rsync to NFS server";
        var mkdocs_page_input_path = "netfs_rsync.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="issues/index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Internal Backup with rsync to NFS server</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="internal_backup_with_rsync_to_nfs_server">Internal Backup with rsync to NFS server<a class="headerlink" href="#internal_backup_with_rsync_to_nfs_server" title="Permanent link">&para;</a></h1>
<p>We already discussed internal backup with GNU tar, but we could also use <code>rsync</code> instead of <code>tar</code> to make an archive of our system
to a NFS server. A simple <code>/etc/rear/local.conf</code> configuration file could like like:</p>
<pre><code>[root@alma rear]# cat /etc/rear/local.conf 
# This file etc/rear/local.conf is intended for the user's
# manual configuration of Relax-and-Recover (ReaR).
#
################################
BACKUP=NETFS
BACKUP_URL=nfs://192.168.122.1/apps/export/ReaR
BACKUP_PROG=rsync

# Use the same IP address(es) of the this system to be activated in the rescue OS
USE_STATIC_NETWORKING="y"

# To be able to login via ssh
SSH_ROOT_PASSWORD="relax"

# To save space limit what we need within rescue image (no firmware and only the loaded kernel modules)
FIRMWARE_FILES=( 'no' )
MODULES=( 'loaded_modules' )

PROGRESS_MODE="plain"
PROGRESS_WAIT_SECONDS="10"
</code></pre>
<p>To use <code>rsync</code> as backup program we need to add <code>BACKUP_PROG=rsync</code> to our configuration file.</p>
<p>Remember, when <code>OUTPUT</code> is not explicit mentioned then by default it will be set to <code>ISO</code>.</p>
<h2 id="running_rear_mkbackup">Running rear mkbackup<a class="headerlink" href="#running_rear_mkbackup" title="Permanent link">&para;</a></h2>
<p>As usual to make a rescue ISO image to the same location as defined with <code>BACKUP_URL</code> (if <code>OUTPUT_URL</code> is not
defined then it will be same as <code>BACKUP_URL</code>).</p>
<pre><code>[root@alma rear]# rear -v mkbackup
Relax-and-Recover 2.6 / 2020-06-17
Running rear mkbackup (PID 2159)
Using log file: /var/log/rear/rear-alma.log
Running workflow mkbackup on the normal/original system
Using backup archive '/var/tmp/rear.pMoleCmgUkWxB10/outputfs/alma/backup'
Using autodetected kernel '/boot/vmlinuz-5.14.0-570.58.1.el9_6.x86_64' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /var/lib/rear/layout/disklayout.conf
GRUB found in first bytes on /dev/vda and GRUB 2 is installed, using GRUB2 as a guessed bootloader for 'rear recover'
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
Creating recovery system root filesystem skeleton layout
Copying logfile /var/log/rear/rear-alma.log into initramfs as '/tmp/rear-alma-partial-2025-11-24T11:30:21+01:00.log'
Copying files and directories
Copying binaries and libraries
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules')
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Testing that the recovery system in /var/tmp/rear.pMoleCmgUkWxB10/rootfs contains a usable system
/usr/lib64/systemd/libsystemd-core-252.so requires libraries where 'ldd' shows 'not found'
/usr/lib64/systemd/libsystemd-core-252.so requires libsystemd-shared-252.so which was not found by 'ldd' but exists as /var/tmp/rear.pMoleCmgUkWxB10/rootfs/usr/lib64/systemd/libsystemd-shared-252.so
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (53889600 bytes) in 9 seconds
Making ISO image
Wrote ISO image: /var/lib/rear/output/rear-alma.iso (69M)
Copying resulting files to nfs location
Saving /var/log/rear/rear-alma.log as rear-alma.log to nfs location
Copying result files '/var/lib/rear/output/rear-alma.iso /var/tmp/rear.pMoleCmgUkWxB10/tmp/VERSION /var/tmp/rear.pMoleCmgUkWxB10/tmp/README /var/tmp/rear.pMoleCmgUkWxB10/tmp/rear-alma.log' to /var/tmp/rear.pMoleCmgUkWxB10/outputfs/alma at nfs location
Making backup (using backup method NETFS)
Creating rsync archive '/var/tmp/rear.pMoleCmgUkWxB10/outputfs/alma/backup'
Preparing archive operation
Archived 298 MiB [avg 27741 KiB/sec] 
Archived 282 MiB [avg 13750 KiB/sec] 
...
Archived 2041 MiB [avg 758 KiB/sec] 
Archived 2076 MiB [avg 768 KiB/sec] 
OK
Archived 2076 MiB in 2777 seconds [avg 765 KiB/sec]
Exiting rear mkbackup (PID 2159) and its descendant processes ...
Running exit tasks
</code></pre>
<p>Between two full archive runs we could use <code>rear mkbackuponly</code> to archive the files/directories that were added or changed after the previous <code>rear mkbackup</code> run. 
This only takes a minute or so, but the drawback is that you only have one copy of your system and a point in time recovery is not possible with this method. 
For example with <a href="rbme.md">Rsync Backup Made Easy (RBME)</a> a recovery in time is possible albeit to a specific date (not to a specifi hour).</p>
<h2 id="the_nfs_server_contains_the_archive_backup">The NFS server contains the archive backup<a class="headerlink" href="#the_nfs_server_contains_the_archive_backup" title="Permanent link">&para;</a></h2>
<pre><code>[root@rocky alma]# ll
total 72216
dr-xr-xr-x. 18 root root     4096 Nov  6 10:35 backup
-rw-------.  1 root root  2376360 Nov 24 12:17 backup.log
-rw-------.  1 root root      202 Nov 24 11:31 README
-rw-------.  1 root root 71415808 Nov 24 11:31 rear-alma.iso
-rw-------.  1 root root   137267 Nov 24 11:31 rear-alma.log
-rw-------.  1 root root        0 Nov 24 12:17 selinux.autorelabel
-rw-------.  1 root root      268 Nov 24 11:31 VERSION
</code></pre>
<p>and the <code>backup</code> sub-directory contains the archives files/directories of our client:</p>
<pre><code>[root@rocky alma]# ll backup
total 20
dr-xr-xr-x.  2 root root    6 Oct  2  2024 afs
lrwxrwxrwx.  1 root root    7 Oct  2  2024 bin -&gt; usr/bin
dr-xr-xr-x.  5 root root 4096 Nov  6 11:00 boot
drwxr-xr-x.  2 root root    6 Nov 24 11:18 dev
drwxr-xr-x. 84 root root 8192 Nov 24 11:18 etc
drwxr-xr-x.  3 root root   18 Nov  6 10:38 home
lrwxrwxrwx.  1 root root    7 Oct  2  2024 lib -&gt; usr/lib
lrwxrwxrwx.  1 root root    9 Oct  2  2024 lib64 -&gt; usr/lib64
drwxr-xr-x.  2 root root    6 Oct  2  2024 media
drwxr-xr-x.  2 root root    6 Oct  2  2024 mnt
drwxr-xr-x.  2 root root    6 Oct  2  2024 opt
dr-xr-xr-x.  2 root root    6 Nov 24 11:18 proc
drwxr-x---.  5 root root  176 Nov 13 16:51 root
drwxr-xr-x.  2 root root    6 Nov 24 11:18 run
lrwxrwxrwx.  1 root root    8 Oct  2  2024 sbin -&gt; usr/sbin
drwxr-xr-x.  2 root root    6 Oct  2  2024 srv
dr-xr-xr-x.  2 root root    6 Nov 24 11:18 sys
drwxrwxrwt.  2 root root    6 Nov 24 11:30 tmp
drwxr-xr-x. 12 root root  144 Nov  6 10:35 usr
drwxr-xr-x. 19 root root 4096 Nov  6 10:41 var
</code></pre>
<h2 id="recovering_with_netfs_method_and_rsync">Recovering with NETFS method and rsync<a class="headerlink" href="#recovering_with_netfs_method_and_rsync" title="Permanent link">&para;</a></h2>
<p>To recover the system boot from the ISO image and run command <code>rear -v recover</code>:</p>
<pre><code>RESCUE alma:~ # rear -v recover
Relax-and-Recover 2.6 / 2020-06-17
Running rear recover (PID 577)
Using log file: /var/log/rear/rear-alma.log
Running workflow recover within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
Started rpc.statd.
RPC status rpc.statd available.
Started rpc.idmapd.
Using backup archive '/tmp/rear.MyqwZAalENdB4AH/outputfs/alma/backup'
Calculating backup archive size
Backup archive size is 2.1G /tmp/rear.MyqwZAalENdB4AH/outputfs/alma/backup 
Comparing disks
Device vda has expected (same) size 8589934592 bytes (will be used for 'recover')
Disk configuration looks identical
Proceed with 'recover' (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)
yes
User confirmed to proceed with 'recover'
Start system layout restoration.
Disk '/dev/vda': creating 'msdos' partition table
Disk '/dev/vda': creating partition number 1 with name 'primary'
Disk '/dev/vda': creating partition number 2 with name 'primary'
Creating LVM PV /dev/vda2
Restoring LVM VG 'almalinux'
Sleeping 3 seconds to let udev or systemd-udevd create their devices...
Creating filesystem of type xfs with mount point / on /dev/mapper/almalinux-root.
Mounting filesystem /
Creating filesystem of type xfs with mount point /boot on /dev/vda1.
Mounting filesystem /boot
Creating swap on /dev/mapper/almalinux-swap
Disk layout created.
Restoring from '/tmp/rear.MyqwZAalENdB4AH/outputfs/alma/backup' (restore log in /var/lib/rear/restore/recover.backup.577.restore.log) ...
Backup restore program 'rsync' started in subshell (PID=2129)
Restoring for 10 seconds... 
Restoring for 20 seconds... 
Restoring for 30 seconds... 
OK
Backup restore program 'rsync' finished with zero exit code
Restoring finished (verify backup restore log messages in /var/lib/rear/restore/recover.backup.577.restore.log)
Created SELinux /mnt/local/.autorelabel file : after reboot SELinux will relabel all files
Recreating directories (with permissions) from /var/lib/rear/recovery/directories_permissions_owner_group
Renamed LVM devices file /mnt/local//etc/lvm/devices/system.devices to /mnt/local//etc/lvm/devices/system.devices.rearbak
to prevent LVM problems in the recovered system, verify that the file
is correct after booting the recovered system and move it back, or
regenerate it using vgimportdevices.
Migrating disk-by-id mappings in certain restored files in /mnt/local to current disk-by-id mappings ...
Running dracut...
Updated initrd with new drivers for kernel 5.14.0-503.11.1.el9_5.x86_64.
Running dracut...
Updated initrd with new drivers for kernel 5.14.0-570.58.1.el9_6.x86_64.
Installing GRUB2 boot loader...
Determining where to install GRUB2 (no GRUB2_INSTALL_DEVICES specified)
Found possible boot disk /dev/vda - installing GRUB2 there
Finished 'recover'. The target system is mounted at '/mnt/local'.
Exiting rear recover (PID 577) and its descendant processes ...
Running exit tasks
</code></pre>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=netfs_rsync.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
