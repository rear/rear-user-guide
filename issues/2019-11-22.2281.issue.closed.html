<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2019 11 22.2281.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2019 11 22.2281.issue.closed";
        var mkdocs_page_input_path = "issues/2019-11-22.2281.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2019 11 22.2281.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2281_issue_closed_missing_delete_dummy_partitions_and_resize_real_ones_calls_cause_rear_recover_bugerror"><a href="https://github.com/rear/rear/issues/2281">#2281 Issue</a> <code>closed</code>: Missing delete_dummy_partitions_and_resize_real_ones calls cause "rear recover" BugError<a class="headerlink" href="#2281_issue_closed_missing_delete_dummy_partitions_and_resize_real_ones_calls_cause_rear_recover_bugerror" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="musyl_opened_issue_at_2019-11-22_0944"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> opened issue at <a href="https://github.com/rear/rear/issues/2281">2019-11-22 09:44</a>:<a class="headerlink" href="#musyl_opened_issue_at_2019-11-22_0944" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.5</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    SUSE Linux Enterprise Server 12 SP4</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>BACKUP=NETFS
BACKUP_URL=nfs://naspnmksysb/mksysb/linux_lpars
ISO_MKISOFS_BIN="$( type -p mkisofs || type -p genisoimage )"
BACKUP_PROG_EXCLUDE=( "${BACKUP_PROG_EXCLUDE[@]}" '/tmp/*' '/var/lib/rear/output/*' '/media/*' '/hana/*' '/opt/coop/*' '/var/coop/*' '/home/*' '/var/mksysb/*' '/var/old_mksysb/*' '/dev/*' '/proc/*' '/run/*' '/syslink/*' '/var/instsoftw/*' '/usr/sap/*' '/opt/uniq/*' '/var/cisp/*' '/opt/ibm/cisp/*' '/opt/ixos/*' '/var/sapdaten*/*' '/var/DTA/*' '/var/svr*/*' '/var/universv/*' '/sapmnt/*' '/hana/data/STA/mnt00001/*' '/hana/shared/STA/*' '/hana/log/STA/mnt00001/*' )
BACKUP_PROG_INCLUDE=( '/*' '/var/lib/mysql/*' '/var/opt/*' '/home/' '/var/tmp/*' '/var/lib/pgsql/*' '/var/lib/machines/*' '/var/lib/libvirt/images/*' '/var/lib/mariadb/*' '/var/lib/named/*' '/var/patrol/*' '/usr/local/*' '/opt/*' '/etc/salt/*' '/tmp/*' '/root/*' '/var/log/*' '/boot/grub2/powerpc-ieee1275/*' '/var/lib/mailman/*' '/var/spool/*' '/srv/*' '/opt/ctm/*' '/opt/patrol/*' '/opt/teamquest/*')
BACKUP_ONLY_INCLUDE="yes"
COPY_AS_IS=( "${COPY_AS_IS[@]}" /etc/multipath/* )
COPY_AS_IS_EXCLUDE=( "${COPY_AS_IS_EXCLUDE[@]}" /dev/sd* /dev/mapper/mpath* /dev/mapper/*vg* /dev/mpath/\* /dev/dm-* /dev/sg* /dev/*_vg /dev/disk/\* /dev/block/\*  )
AUTOEXCLUDE_MULTIPATH=n
EXCLUDE_DEVICE_MAPPING=( "loop*" "ram*"  "dm-*" )
REAR_INITRD_COMPRESSION="lzma"
BOOT_OVER_SAN=y
ONLY_INCLUDE_VG=(sys_vg)

TIMESYNC=NTP
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PowerVM LPAR</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    PPC64LE</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    Open Firmware</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    SAN-FC and multipath-DM</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>rear recover failed. There are two entries in the disk_mappings file:</p>
<pre><code>Current disk mapping table (source =&gt; target):
  /dev/mapper/360060e8007e39e000030e39e00000776 =&gt; /dev/mapper/360060e8007e39e000030e39e00000776
  /dev/mapper/360060e8007e39e000030e39e00000775 =&gt; /dev/mapper/360060e8007e39e000030e39e00000775
</code></pre>
<p>LUN 360060e8007e39e000030e39e00000776 is swap partition<br />
LUN 360060e8007e39e000030e39e00000775 is system partition.</p>
<p>The first create_disk_label &amp; create_disk_partition is OK but the
second fails.</p>
<pre><code>BUG in /usr/share/rear/lib/layout-functions.sh line 1078
</code></pre>
<p>It seems that there is a problem with the current_disk variable in the
create_disk_label function.</p>
<ul>
<li>
<p>Workaround, if any:<br />
    The possible workaround is to delete the line corresponding to the
    swap, restore the system partition and after the reboot recreate the
    swap.</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
<a href="https://github.com/rear/rear/files/3878820/rear-svrlsta101-0.log">rear-svrlsta101-0.log</a></p>
</li>
</ul>
<p>To paste verbatim text like command output or file content,<br />
include it between a leading and a closing line of three backticks like</p>
<pre><code>++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
+++ local disk=/dev/mapper/360060e8007e39e000030e39e00000775 label=msdos
+++ [[ -n /dev/mapper/360060e8007e39e000030e39e00000776 ]]
+++ [[ /dev/mapper/360060e8007e39e000030e39e00000776 != \/\d\e\v\/\m\a\p\p\e\r\/\3\6\0\0\6\0\e\8\0\0\7\e\3\9\e\0\0\0\0\3\0\e\3\9\e\0\0\0\0\0\7\7\5 ]]
+++ BugError 'Current disk has changed from '\''/dev/mapper/360060e8007e39e000030e39e00000776'\'' to '\''/dev/mapper/360060e8007e39e000030e39e00000775'\'' without calling delete_dummy_partitions_and_resize_real_ones() first.'
+++ Error '
</code></pre>
<h4 id="jsmeix_commented_at_2019-11-22_1150"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557503095">2019-11-22 11:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1150" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
I dared to assign this issue also to you because<br />
<code>delete_dummy_partitions_and_resize_real_ones</code> is your code.</p>
<h4 id="jsmeix_commented_at_2019-11-22_1229"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557514070">2019-11-22 12:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1229" title="Permanent link">&para;</a></h4>
<p>@musyl<br />
before I try to dig around in your logs (as time permits)<br />
I would like to know what output you get for the following commands:</p>
<pre><code>lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>and</p>
<pre><code>findmnt -a
</code></pre>
<p>to get an overview of your block devices and filesystems structure.</p>
<p>Furthermore please also attach your <code>disklayout.conf</code> file<br />
that "rear mkrescue/mkbackup" had created<br />
usually as <code>var/lib/rear/layout/disklayout.conf</code></p>
<h4 id="jsmeix_commented_at_2019-11-22_1232"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557514996">2019-11-22 12:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1232" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I also dared to assign this issue also to you because<br />
it is about POWER architecture and multipath.</p>
<h4 id="musyl_commented_at_2019-11-22_1313"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557526652">2019-11-22 13:13</a>:<a class="headerlink" href="#musyl_commented_at_2019-11-22_1313" title="Permanent link">&para;</a></h4>
<p>Please find below the result of the commands requested.</p>
<p><a href="https://github.com/rear/rear/files/3879654/findmnt.log">findmnt.log</a><br />
<a href="https://github.com/rear/rear/files/3879655/lsblk.log">lsblk.log</a><br />
<a href="https://github.com/rear/rear/files/3879657/disklayout_conf.txt">disklayout_conf.txt</a></p>
<p>Thank you.</p>
<h4 id="jsmeix_commented_at_2019-11-22_1522"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557574289">2019-11-22 15:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1522" title="Permanent link">&para;</a></h4>
<p>On a quick first glance things look as follows to me:</p>
<p>The sequence of the <code>create_...</code> calls<br />
(some <code>create_device btrfsmountedsubvol</code> are cut here):</p>
<pre><code># grep '+ create_' rear-svrlsta101-0.log

++ create_device /dev/mapper/360060e8007e39e000030e39e00000776 multipath
++ create_multipath /dev/mapper/360060e8007e39e000030e39e00000776
++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000776 msdos
++ create_device /dev/mapper/360060e8007e39e000030e39e00000776-part1 part
++ create_device swap:/dev/mapper/360060e8007e39e000030e39e00000776-part1 swap
++ create_swap swap:/dev/mapper/360060e8007e39e000030e39e00000776-part1
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775 multipath
++ create_multipath /dev/mapper/360060e8007e39e000030e39e00000775
++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000775 msdos
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775-part1 part
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775-part2 part
++ create_device fs:/ fs
++ create_fs fs:/
++ create_device btrfsmountedsubvol:/ btrfsmountedsubvol
...
++ create_device btrfsmountedsubvol:/opt/patrol btrfsmountedsubvol
+++ create_component vgchange rear
+++ create_component /dev/mapper/360060e8007e39e000030e39e00000776 multipath
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000776 msdos
+++ create_disk_partition /dev/mapper/360060e8007e39e000030e39e00000776 primary 1 1048576 34360786943
+++ create_component /dev/mapper/360060e8007e39e000030e39e00000776-part1 part
+++ create_component swap:/dev/mapper/360060e8007e39e000030e39e00000776-part1 swap
+++ create_component /dev/mapper/360060e8007e39e000030e39e00000775 multipath
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>The functions where <code>current_disk="$disk"</code> is set are<br />
in usr/share/rear/lib/layout-functions.sh<br />
<code>create_disk_label()</code> and <code>create_disk_partition()</code></p>
<p>The <code>delete_dummy_partitions_and_resize_real_ones</code> function<br />
is only called in<br />
usr/share/rear/layout/prepare/GNU/Linux/100_include_partition_code.sh<br />
after the <code>create_partitions</code> call that calls <code>create_disk_label</code><br />
and for each partition on that disk <code>create_disk_partition</code>.</p>
<p>The sequence of only the <code>create_disk_label</code><br />
<code>create_partitions</code> and <code>create_disk_partition</code><br />
calls in rear-svrlsta101-0.log is</p>
<pre><code># grep '+ create_' rear-svrlsta101-0.log | egrep 'create_disk_label|create_partitions|create_disk_partition'

++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000776 msdos
++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000775 msdos
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000776 msdos
+++ create_disk_partition /dev/mapper/360060e8007e39e000030e39e00000776 primary 1 1048576 34360786943
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>which looks somehow wrong because I would expect to see</p>
<pre><code>create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>before</p>
<pre><code>create_partitions /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>and I think this wrong looking sequence is the reason why things fail.</p>
<p>I think it is right that "rear recover" errors out with that BugError
because<br />
I think the sequence how things are created could be wrong here.</p>
<p>But I am not at all a multipath expert so things could be rightfully<br />
different when multipath is used?</p>
<h4 id="jsmeix_commented_at_2019-11-22_1529"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-557577236">2019-11-22 15:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1529" title="Permanent link">&para;</a></h4>
<p>@musyl</p>
<p>only as a basically blind test because we have some recent fixes<br />
regarding multipath in our current GitHub upstream master code<br />
I would like to ask you to try out our current master code<br />
as described in the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Those recent fixes regarding multipath are<br />
<a href="https://github.com/rear/rear/pull/2235">https://github.com/rear/rear/pull/2235</a><br />
<a href="https://github.com/rear/rear/commit/0584c3287aade755bc2f4e4a70fffc8467b59eb8">https://github.com/rear/rear/commit/0584c3287aade755bc2f4e4a70fffc8467b59eb8</a><br />
which might make a difference here<br />
and additionally<br />
<a href="https://github.com/rear/rear/pull/2237">https://github.com/rear/rear/pull/2237</a><br />
<a href="https://github.com/rear/rear/commit/84d74a3646c99f3a78a9b20ac57c5935af6c4888">https://github.com/rear/rear/commit/84d74a3646c99f3a78a9b20ac57c5935af6c4888</a></p>
<h4 id="jsmeix_commented_at_2019-11-25_0859"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558056466">2019-11-25 08:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_0859" title="Permanent link">&para;</a></h4>
<p>I think my "quick first glance" in my above<br />
<a href="https://github.com/rear/rear/issues/2281#issuecomment-557574289">https://github.com/rear/rear/issues/2281#issuecomment-557574289</a><br />
is a contradiction in itself because I wrote (excerpts)</p>
<pre><code>the `create_partitions` call that calls `create_disk_label`
and for each partition on that disk `create_disk_partition`
...
I would expect to see
`create_disk_label ...`
before
`create_partitions ...`
</code></pre>
<p>but because <code>create_partitions</code> calls <code>create_disk_label</code><br />
the ordering <code>create_partitions</code> before <code>create_disk_label</code> is right.</p>
<p>So - as far as I see - for one same disk the expected ordering is</p>
<pre><code>create_partitions
  |-&gt; create_disk_label
  |-&gt; create_disk_partition (first one on that disk)
  ...
  '-&gt;create_disk_partition (last one on that disk)
delete_dummy_partitions_and_resize_real_ones
</code></pre>
<p>But as far as I see now it seems this sequence of function calls<br />
can run simultaneously for more than one disk at the same time<br />
cf. in my above<br />
<a href="https://github.com/rear/rear/issues/2281#issuecomment-557574289">https://github.com/rear/rear/issues/2281#issuecomment-557574289</a></p>
<pre><code># grep '+ create_' rear-svrlsta101-0.log | egrep 'create_disk_label|create_partitions|create_disk_partition'

++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000776 msdos
++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000775 msdos
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000776 msdos
+++ create_disk_partition /dev/mapper/360060e8007e39e000030e39e00000776 primary 1 1048576 34360786943
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>instead of the expected sequence</p>
<pre><code>++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000776 msdos
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000776 msdos
+++ create_disk_partition /dev/mapper/360060e8007e39e000030e39e00000776 primary 1 1048576 34360786943
++ create_partitions /dev/mapper/360060e8007e39e000030e39e00000775 msdos
+++ create_disk_label /dev/mapper/360060e8007e39e000030e39e00000775 msdos
</code></pre>
<p>With the intermixed sequence things can mess up<br />
because the <code>current_disk</code> variable is a global variable<br />
that is used as some kind of semaphore to<br />
synchronize creating partitions on a disk.</p>
<h4 id="jsmeix_commented_at_2019-11-25_0910"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558060095">2019-11-25 09:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_0910" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
I fear this issue here might reveal a possibly severe issue<br />
since the <code>create_partitions</code> function in<br />
layout/prepare/GNU/Linux/100_include_partition_code.sh<br />
does no longer emit the actual <code>parted</code> calls directly but only<br />
indircet function calls <code>create_disk_label</code> and
<code>create_disk_partition</code><br />
which could somehow (I do not yet see how) lead to intermixed<br />
creation of partitions on more than one disk at the same time?</p>
<h4 id="rmetrich_commented_at_2019-11-25_0931"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558068803">2019-11-25 09:31</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-11-25_0931" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix,<br />
I will try to have a look rapidly. Sorry, I'm very busy these months
(hence my silence on many ReaR stuff).</p>
<h4 id="jsmeix_commented_at_2019-11-25_0938"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558071672">2019-11-25 09:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_0938" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
thank you for your notification!</p>
<p>You really do not need to be sorry for being kept busy with other stuff.</p>
<p>For me it is basically the same, cf. my<br />
<a href="https://github.com/rear/rear/issues/799#issuecomment-531247109">https://github.com/rear/rear/issues/799#issuecomment-531247109</a><br />
and I also know it is same for @schabrolles</p>
<h4 id="jsmeix_commented_at_2019-11-25_1003"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558081653">2019-11-25 10:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_1003" title="Permanent link">&para;</a></h4>
<p>Currently I fail to see how device recreation things could run in
parallel.</p>
<p>As far as I see by plain looking at the code all seems to happen
sequentially.</p>
<p>Nowhere I spotted a subshell or something like that, starting at<br />
layout/prepare/default/540_generate_device_code.sh<br />
that calls <code>create_device</code> (in lib/layout-functions.sh)<br />
that calls <code>create_$type "$device"</code> which is here</p>
<pre><code># cat rear-svrlsta101-0.log | grep '+ create_device'

++ create_device /dev/mapper/360060e8007e39e000030e39e00000776 multipath
++ create_device /dev/mapper/360060e8007e39e000030e39e00000776-part1 part
++ create_device swap:/dev/mapper/360060e8007e39e000030e39e00000776-part1 swap
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775 multipath
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775-part1 part
++ create_device /dev/mapper/360060e8007e39e000030e39e00000775-part2 part
++ create_device fs:/ fs
...
</code></pre>
<p>But I think I may have found something else:</p>
<p>In
<a href="https://github.com/rear/rear/issues/2281#issuecomment-557574289">https://github.com/rear/rear/issues/2281#issuecomment-557574289</a><br />
I wrote</p>
<pre><code>The `delete_dummy_partitions_and_resize_real_ones` function
is only called in
usr/share/rear/layout/prepare/GNU/Linux/100_include_partition_code.sh
after the `create_partitions` call
</code></pre>
<p>I think it means <code>delete_dummy_partitions_and_resize_real_ones</code><br />
must be called after any <code>create_partitions</code> call<br />
but that is not the case because <code>create_partitions</code><br />
is also called in two other scripts:</p>
<pre><code># find usr/sbin/rear usr/share/rear/ -type f | xargs grep 'create_partitions'

usr/share/rear/layout/prepare/GNU/Linux/120_include_raid_code.sh:    create_partitions "$device"
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh:        create_partitions "$device" "$label"
</code></pre>
<p>therein in the <code>create_raid</code> and <code>create_multipath</code> functions.</p>
<p>@rmetrich<br />
when my assumption is right<br />
that <code>delete_dummy_partitions_and_resize_real_ones</code><br />
must be called after any <code>create_partitions</code> call<br />
then it is perhaps best to add the<br />
<code>delete_dummy_partitions_and_resize_real_ones</code> call<br />
into the <code>create_partitions</code> function to ensure that<br />
<code>delete_dummy_partitions_and_resize_real_ones</code><br />
is always called at the end of each <code>create_partitions</code> call?</p>
<p>But even if this is right it does not explain the unexpected<br />
ordering of the <code>create_...</code> function calls in the log<br />
that at least look as if there happens intermixed creation<br />
of partitions on more than one disk at the same time.</p>
<h4 id="musyl_commented_at_2019-11-25_1029"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558092091">2019-11-25 10:29</a>:<a class="headerlink" href="#musyl_commented_at_2019-11-25_1029" title="Permanent link">&para;</a></h4>
<p>Thank you all for your help.</p>
<p>I followed the "Testing current ReaR upstream GitHub master code"
procedure but the recovery fails by returning the same errors.</p>
<p><a href="https://github.com/rear/rear/files/3886127/rear-svrlsta101-0.log">rear-svrlsta101-0.log</a></p>
<h4 id="jsmeix_commented_at_2019-11-25_1048"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558099595">2019-11-25 10:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_1048" title="Permanent link">&para;</a></h4>
<p>@musyl<br />
thank you for your feedback!</p>
<p>The next test with our current ReaR upstream GitHub master code<br />
that you could try out is according to what I wrote in<br />
<a href="https://github.com/rear/rear/issues/2281#issuecomment-558081653">https://github.com/rear/rear/issues/2281#issuecomment-558081653</a><br />
to add a <code>delete_dummy_partitions_and_resize_real_ones</code> call<br />
after the <code>create_partitions</code> call in<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh<br />
in the same way as it is currently done for the non-multipath case<br />
usr/share/rear/layout/prepare/GNU/Linux/100_include_partition_code.sh<br />
so that it will look like the following (excerpt)</p>
<pre><code>function create_multipath() {
    ...
        create_partitions ...
        cat &gt;&gt; "$LAYOUT_CODE" &lt;&lt;EOF
delete_dummy_partitions_and_resize_real_ones
EOF
    fi
}
</code></pre>
<p>Then re-do "rear mkrescue/mkbackup" and afterwards<br />
trest if now "rear recover" perhaps works for you.</p>
<p>If re-do "rear mkrescue/mkbackup" is too laborious or time consuming for
you<br />
you could - in particular for a test - also modify the ReaR scripts<br />
from within the ReaR recovery system. To do that<br />
boot the ReaR recovery system and log in as 'root'<br />
and then - before you run "rear recover" - you can<br />
modify any ReaR scripts as you like.<br />
Cf. the section "Disaster recovery with Relax-and-Recover (ReaR)"</p>
<pre><code>even temporary quick and dirty workarounds
are relatively easily possible
</code></pre>
<p>in
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="musyl_commented_at_2019-11-25_1244"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558139389">2019-11-25 12:44</a>:<a class="headerlink" href="#musyl_commented_at_2019-11-25_1244" title="Permanent link">&para;</a></h4>
<p>I modified the script 210_load_multipath.sh</p>
<pre><code>### Create multipath devices (at least partitions on them).
function create_multipath() {
    local component device size label junk
    read component device size label junk &lt; &lt;(grep "^multipath $1 " "$LAYOUT_FILE")
    if [[ "$device" ]]; then
        Log "Found current or former multipath device $device in $LAYOUT_FILE: Creating partitions on it"
        create_partitions "$device" "$label"
        cat  &gt;&gt; "$LAYOUT_CODE" &lt;&lt;EOF
        # Clean up transient partitions and resize shrinked ones
        delete_dummy_partitions_and_resize_real_ones
    fi
EOF
}
</code></pre>
<p>I performed a backup and then a recover, but the recover loop in the
diskrestore.sh script.</p>
<p><a href="https://github.com/rear/rear/files/3886615/rear-svrlsta101-0_20191125_1331.log">rear-svrlsta101-0_20191125_1331.log</a></p>
<h4 id="jsmeix_commented_at_2019-11-25_1253"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558142215">2019-11-25 12:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_1253" title="Permanent link">&para;</a></h4>
<p>Without checking your log I noticed in your<br />
<a href="https://github.com/rear/rear/issues/2281#issuecomment-558139389">https://github.com/rear/rear/issues/2281#issuecomment-558139389</a><br />
that you modified 210_load_multipath.sh falsely.<br />
You need to have the <code>EOF</code> before the closing <code>fi</code><br />
i.e. you need to have</p>
<pre><code>### Create multipath devices (at least partitions on them).
function create_multipath() {
    local component device size label junk
    read component device size label junk &lt; &lt;(grep "^multipath $1 " "$LAYOUT_FILE")
    if [[ "$device" ]]; then
        Log "Found current or former multipath device $device in $LAYOUT_FILE: Creating partitions on it"
        create_partitions "$device" "$label"
        cat  &gt;&gt; "$LAYOUT_CODE" &lt;&lt;EOF
# Clean up transient partitions and resize shrinked ones
delete_dummy_partitions_and_resize_real_ones
EOF
    fi
}
</code></pre>
<h4 id="musyl_commented_at_2019-11-25_1412"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558172993">2019-11-25 14:12</a>:<a class="headerlink" href="#musyl_commented_at_2019-11-25_1412" title="Permanent link">&para;</a></h4>
<p>Oups ! Excuse me ! I'm sorry I didn't see my mistake.<br />
The recover worked but I see that the swap partition type is 'Linux'
(0x83) and not 'Linux swap / Solaris' (0x82) as defined at installation.</p>
<h4 id="jsmeix_commented_at_2019-11-25_1457"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558192197">2019-11-25 14:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-25_1457" title="Permanent link">&para;</a></h4>
<p>@musyl<br />
thank you for your prompt replies!</p>
<p>Off the top of my head the swap partition type issue is normal<br />
(I think I also had it on my test systems and it works nevertheless)<br />
but feel free to report it as a new separated GitHub issue<br />
so that we can have a closer look because ReaR should<br />
recreate the system exactly as it was before (as far as possible).</p>
<h4 id="musyl_commented_at_2019-11-26_0745"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558504092">2019-11-26 07:45</a>:<a class="headerlink" href="#musyl_commented_at_2019-11-26_0745" title="Permanent link">&para;</a></h4>
<p>Thank you very much for your help. !!<br />
Will the modification of script 210_load_multipath.sh be implemented
in the next version of ReaR (2.6)?<br />
Should I close the incident, or should I let you handle it?</p>
<h4 id="jsmeix_commented_at_2019-11-26_0831"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-558519787">2019-11-26 08:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-26_0831" title="Permanent link">&para;</a></h4>
<p>@musyl<br />
my pleasure!</p>
<p>The fix for this issue will be included in ReaR 2.6 and<br />
I will close this issue when its fix actually is in ReaR.</p>
<p>The fix of this issue will also include a fix for the
<code>create_partitions</code> call<br />
in prepare/GNU/Linux/120_include_raid_code.sh<br />
cf.
<a href="https://github.com/rear/rear/issues/2281#issuecomment-558081653">https://github.com/rear/rear/issues/2281#issuecomment-558081653</a></p>
<h4 id="rmetrich_commented_at_2019-12-04_1501"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-561684159">2019-12-04 15:01</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-04_1501" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
Sorry for taking so long, I'm very busy these weeks.<br />
I'm very confused by the code, I don't understand why, when creating a
software raid of multipath, we call create_partitions(), this will be
done later anyway from my understanding.</p>
<h4 id="rmetrich_commented_at_2019-12-04_1506"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-561686352">2019-12-04 15:06</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-04_1506" title="Permanent link">&para;</a></h4>
<p>@musyl Could you provide the diskrestore.sh file generated based on
disklayout.conf without any fix at all?</p>
<h4 id="jsmeix_commented_at_2019-12-04_1707"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-561739792">2019-12-04 17:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-12-04_1707" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
thank you for having a look.<br />
That you are <code>very confused by the code</code> helps me a lot<br />
because I do no longer think I am slow-witted here:<br />
I am also confused by the code.</p>
<p>Perhaps my usual forensics method could also help here<br />
(excerpts):</p>
<pre><code># git log -p --follow usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh

...

commit ad5bd0e889230e999e3669f0a21076b4d6aec2f2
Author: Sebastien Chabrolles ...
Date:   Fri Aug 25 17:54:33 2017 ...

    restore create_multipath function as we finally need it.
...
+### Create multipath devices (at least partitions on them).
+create_multipath() {
+    local multipath device
+    read multipath device junk &lt; &lt;(grep "multipath $1 " "$LAYOUT_FILE")
+
+    create_partitions "$device"
+}

....

commit 4344d1b6ae5d4e7010365ff939afac3f9d208d4c
Author: Sebastien Chabrolles ...
Date:   Thu Aug 24 19:53:22 2017 ...

    cleanup: remove useless create_multipath funtion
...
-### Create multipath devices (at least partitions on them).
-create_multipath() {
-    local multipath device
-    read multipath device junk &lt; &lt;(grep "multipath $1 " "$LAYOUT_FILE")
-
-    create_partitions "$device"
-}

...

commit 87c459a104335623347c629990c28d281bbc9256
Author: Jeroen Hoekx ...
Date:   Fri Mar 16 14:11:46 2012 ...

    layout: recreate partitions on multipath.
...
+### Create multipath devices (at least partitions on them)
+create_multipath() {
+    local multipath device
+    read multipath device junk &lt; &lt;(grep "multipath $1 " $LAYOUT_FILE)
+
+    create_partitions "$device"
+}
</code></pre>
<p>But unfortunately those commits<br />
<a href="https://github.com/rear/rear/commit/ad5bd0e889230e999e3669f0a21076b4d6aec2f2">https://github.com/rear/rear/commit/ad5bd0e889230e999e3669f0a21076b4d6aec2f2</a><br />
<a href="https://github.com/rear/rear/commit/4344d1b6ae5d4e7010365ff939afac3f9d208d4c">https://github.com/rear/rear/commit/4344d1b6ae5d4e7010365ff939afac3f9d208d4c</a><br />
<a href="https://github.com/rear/rear/commit/87c459a104335623347c629990c28d281bbc9256">https://github.com/rear/rear/commit/87c459a104335623347c629990c28d281bbc9256</a><br />
tell nothing about why <code>create_partitions</code> is needed to be called<br />
so my usual forensics method did not directly help here.</p>
<p>But the commits from @schabrolles at least mention<br />
<a href="https://github.com/rear/rear/pull/1449">https://github.com/rear/rear/pull/1449</a><br />
so perhaps therein is a reason that explains<br />
why <code>create_partitions</code> must be called<br />
separatedly in case of multipath.</p>
<p>The comments where <code>create_multipath</code> was removed and re-added are<br />
<a href="https://github.com/rear/rear/pull/1449#issuecomment-324578476">https://github.com/rear/rear/pull/1449#issuecomment-324578476</a><br />
<a href="https://github.com/rear/rear/pull/1449#issuecomment-324718692">https://github.com/rear/rear/pull/1449#issuecomment-324718692</a><br />
<a href="https://github.com/rear/rear/pull/1449#issuecomment-324874100">https://github.com/rear/rear/pull/1449#issuecomment-324874100</a><br />
<a href="https://github.com/rear/rear/pull/1449#issuecomment-325021108">https://github.com/rear/rear/pull/1449#issuecomment-325021108</a><br />
where the latter reads (excerpt):</p>
<pre><code>you are right regarding create_multipath()
function... we finally REALLY need it.
I do additional test which confirm
it cannot work without it (partition are not created)
</code></pre>
<p>So the question is why are partitions not created<br />
in case of multipath when there is no <code>create_multipath</code><br />
function that calls <code>create_partitions</code>?</p>
<p>My blind guess is that it may boil down to how the<br />
dependency handling of the disk layout components<br />
works in ReaR ( shudder ;-)</p>
<h4 id="musyl_commented_at_2019-12-06_0858"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-562489705">2019-12-06 08:58</a>:<a class="headerlink" href="#musyl_commented_at_2019-12-06_0858" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
Hello, I uploaded the diskrestore.sh file.</p>
<p><a href="https://github.com/rear/rear/files/3931240/diskrestore.sh.20191121165116.recover.12917.txt">diskrestore.sh.20191121165116.recover.12917.txt</a></p>
<h4 id="rmetrich_commented_at_2019-12-06_0913"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-562494572">2019-12-06 09:13</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-06_0913" title="Permanent link">&para;</a></h4>
<p>Thank you. This puzzles me. I don't understand why <code>multipath</code> and
<code>disk</code> are considered different.<br />
A <code>multipath</code> device is just a disk ...<br />
Currently the code when having a multipath device is "old-style",
explaining the issue. Probably <code>create_multipath</code> should call
<code>create_disk</code> internally.</p>
<h4 id="rmetrich_commented_at_2019-12-06_1322"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-562569245">2019-12-06 13:22</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-06_1322" title="Permanent link">&para;</a></h4>
<p>I need to set up 2 reproducers:</p>
<ul>
<li>a software raid</li>
<li>a multipath system</li>
</ul>
<p>Both cases do not execute through create_disk, hence the failures.</p>
<h4 id="rmetrich_commented_at_2019-12-06_1543"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-562623790">2019-12-06 15:43</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-06_1543" title="Permanent link">&para;</a></h4>
<p>I could progress a bit today:</p>
<ul>
<li>a software raid CAN have partitions, /dev/mdXXX is a standard block
    device</li>
</ul>
<p>But I doubt a multipath device may have (except the underlying disk of
course).</p>
<h4 id="rmetrich_commented_at_2019-12-06_1558"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-562630268">2019-12-06 15:58</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-06_1558" title="Permanent link">&para;</a></h4>
<p>I should have something on monday. Ping me if nothing comes up :-)</p>
<h4 id="rmetrich_commented_at_2019-12-09_0841"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-563125454">2019-12-09 08:41</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-12-09_0841" title="Permanent link">&para;</a></h4>
<p>@musyl Please check my code in PR #2295 on your system, I've tested in
my lab on Software Raid and Multipath.</p>
<h4 id="musyl_commented_at_2019-12-09_1549"><img src="https://avatars.githubusercontent.com/u/58026989?v=4" width="50"><a href="https://github.com/musyl">musyl</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-563301414">2019-12-09 15:49</a>:<a class="headerlink" href="#musyl_commented_at_2019-12-09_1549" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
It also works in my environment. Thank you so much.<br />
FYI I uploaded:<br />
<a href="https://github.com/rear/rear/files/3940502/disklayout.conf_20191208.txt">disklayout.conf_20191208.txt</a><br />
<a href="https://github.com/rear/rear/files/3940497/rear-svrlsta101-0.log_20191208.txt">rear-svrlsta101-0.log_20191208.txt</a><br />
<a href="https://github.com/rear/rear/files/3940498/diskrestore.sh_20191208.txt">diskrestore.sh_20191208.txt</a></p>
<h4 id="jsmeix_commented_at_2019-12-13_1259"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2281#issuecomment-565432587">2019-12-13 12:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-12-13_1259" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2295">https://github.com/rear/rear/pull/2295</a>
merged<br />
this issue should be fixed.</p>
<p>@rmetrich<br />
thank you for your fix!<br />
In particular because you did it regardless<br />
that you have not much time to work on ReaR.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-11-22.2281.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
