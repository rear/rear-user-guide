<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1692 Issue closed: Bareos-fd does not start. - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1692 Issue closed: Bareos-fd does not start.";
        var mkdocs_page_input_path = "issues/2018-01-11.1692.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1692 Issue closed: Bareos-fd does not start.</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1692_issue_closed_bareos-fd_does_not_start"><a href="https://github.com/rear/rear/issues/1692">#1692 Issue</a> <code>closed</code>: Bareos-fd does not start.<a class="headerlink" href="#1692_issue_closed_bareos-fd_does_not_start" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>minor bug</code>, <code>external tool</code></p>
<h4 id="start3_opened_issue_at_2018-01-11_2328"><img src="https://avatars.githubusercontent.com/u/7348757?v=4" width="50"><a href="https://github.com/StarT3">StarT3</a> opened issue at <a href="https://github.com/rear/rear/issues/1692">2018-01-11 23:28</a>:<a class="headerlink" href="#start3_opened_issue_at_2018-01-11_2328" title="Permanent link">&para;</a></h4>
<p>Relax-and-Recover 2.3 / 2017-12-20<br />
Got it from<br />
sh -c "echo 'deb
<a href="http://download.opensuse.org/repositories/Archiving:/Backup:/Rear/xUbuntu_14.04/">http://download.opensuse.org/repositories/Archiving:/Backup:/Rear/xUbuntu_14.04/</a>
/' &gt; /etc/apt/sources.list.d/rear.list" &amp; apt-get install rear<br />
Ubuntu 14.04.4 LTS<br />
config :</p>
<pre><code>OS_VENDOR=Ubuntu
OS_VERSION=14.04
BACKUP=BAREOS
OUTPUT=ISO
BAREOS_CLIENT="vm544617-fd"
OUTPUT_URL=nfs://"some ip here"/bareos
</code></pre>
<p><em>* Are you using legacy BIOS or UEFI boot?</em> Not sure, vm on hyper-v,
should be BIOS as Ubuntu 14 does not support Gen2 VM under Hyper-v.</p>
<ul>
<li>
<p>Brief description of the issue:<br />
    "rear recover" stuck at "Waiting for job to start" forever because
    of bareos-fd start failure. In my case Bareos-fd configuration
    "myself.conf" points to plugin directory "Plugin Directory =
    /usr/lib64/bareos/plugins". As there were no such directory in
    RESCUE environment, bareos-fd did not start. Bareos director had
    errors:<br />
<code>Fatal error: bsock_tcp.c:134 Unable to connect to Client: vm544617-fd</code><br />
    It is common for bareos config to define plugin directory. I use
    default bpipe plugin to get mysql backup.</p>
</li>
<li>
<p>Work-around, if any:<br />
    Comment "Plugin Directory = /usr/lib64/bareos/plugins" either on
    original host before mkrescue or in RESCUE environment and run
    bareos-fd manually.<br />
<em>nano /etc/bareos/bareos.d/client/myself.conf</em></p>
</li>
</ul>
<h4 id="gdha_commented_at_2018-01-12_0750"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357166902">2018-01-12 07:50</a>:<a class="headerlink" href="#gdha_commented_at_2018-01-12_0750" title="Permanent link">&para;</a></h4>
<p>@StarT3 Could you show us what the content is of your <code>myself.conf</code> and
what does that plugin directory contain? Would it be sufficient to add
it into the <code>COPY_AS_IS</code> array?</p>
<h4 id="jsmeix_commented_at_2018-01-12_1052"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357207347">2018-01-12 10:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-12_1052" title="Permanent link">&para;</a></h4>
<p>@StarT3</p>
<p>some general info FYI:</p>
<p>By default the ReaR recovery system is minimal which means<br />
that things which are not mandatory might be not automatically<br />
included in the ReaR recovery system.</p>
<p>You can specify anything what you need in addition<br />
to what is automatically included in the ReaR recovery<br />
system via the config variables</p>
<p>COPY_AS_IS<br />
REQUIRED_PROGS<br />
LIBS<br />
MODULES<br />
MODULES_LOAD<br />
FIRMWARE_FILES</p>
<p>In your particular case it may work to specify<br />
in your /etc/rear/local.conf something like</p>
<p>COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib64/bareos/plugins )</p>
<p>Furthermore if you need special commands to be run in the<br />
ReaR recovery system (e.g. launching a special service)<br />
you can specify that via config variables like</p>
<p>PRE_RECOVERY_SCRIPT<br />
NETWORKING_PREPARATION_COMMANDS</p>
<p>In your particular case it may also work to automate<br />
commenting "Plugin Directory = /usr/lib64/bareos/plugins"<br />
in your Bareos-fd configuration myself.conf via an<br />
appropriate command (e.g. a 'sed' command)<br />
that gets run as PRE_RECOVERY_SCRIPT.</p>
<p>For more info about each of the various config variables<br />
see usr/share/rear/conf/default.conf</p>
<p>If things like commenting "Plugin Directory"<br />
or having /usr/lib64/bareos/plugins in the<br />
recovery system are mandatory for Bareos<br />
such things could be added to the ReaR scripts<br />
to enhance the default Bareos support in ReaR.</p>
<p>But I am not a Bareos user so that I cannot reproduce anything<br />
or even fix anything that is specific for Bareos.</p>
<p>In general regarding third-party backup tools and ReaR see<br />
"Relax-and-Recover versus backup and restore" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="start3_commented_at_2018-01-12_2314"><img src="https://avatars.githubusercontent.com/u/7348757?v=4" width="50"><a href="https://github.com/StarT3">StarT3</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357380368">2018-01-12 23:14</a>:<a class="headerlink" href="#start3_commented_at_2018-01-12_2314" title="Permanent link">&para;</a></h4>
<p>Thank you for support.<br />
Here is full content of /etc/bareos/bareos-fd.d/client/myself.conf</p>
<pre><code>Client {
  Name = vm544617-fd
  Maximum Concurrent Jobs = 20
  Heartbeat Interval = 60

  # remove comment from "Plugin Directory" to load plugins from specified directory.
  # if "Plugin Names" is defined, only the specified plugins will be loaded,
  # otherwise all storage plugins (*-fd.so) from the "Plugin Directory".
  #
  Plugin Directory = /usr/lib/bareos/plugins
  # Plugin Names = ""

  # if compatible is set to yes, we are compatible with bacula
  # if set to no, new bareos features are enabled which is the default
  # compatible = yes
}
</code></pre>
<p>I believe such config is common for small web servers with light mysql
databases.<br />
COPY_AS_IS is not really necessary, bpipe plugin used to
backup/restore databases typically is in separate job and should be run
after whole server restored and running (mysql software should be
running at that time).</p>
<p>PRE_RECOVERY_SCRIPT should do the trick. It should comment line in
myself.config, and start bareos-fd. Currently testing:<br />
<code>PRE_RECOVERY_SCRIPT=("sed -e '/Plugin Directory = / s/^#*/#/' -i /etc/bareos/bareos-fd.d/client/myself.conf" &amp;&amp; "bareos-fd")</code><br />
Not sure if it would work, testing.</p>
<h4 id="jsmeix_commented_at_2018-01-15_1054"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357649128">2018-01-15 10:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-15_1054" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
is there something you like to fix or enhance in ReaR<br />
because currently it is a "minor bug" for BACKUP=BAREOS<br />
or is it only a "support question" that was "fixed/solved/done" ?</p>
<h4 id="gdha_commented_at_2018-01-15_1622"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357729377">2018-01-15 16:22</a>:<a class="headerlink" href="#gdha_commented_at_2018-01-15_1622" title="Permanent link">&para;</a></h4>
<p>@StarT3 What does the plugin directory exactly contain? Is it critical
for BAREOS or can it be left out? Or was that plugin directory empty?</p>
<h4 id="start3_commented_at_2018-01-15_1832"><img src="https://avatars.githubusercontent.com/u/7348757?v=4" width="50"><a href="https://github.com/StarT3">StarT3</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357758853">2018-01-15 18:32</a>:<a class="headerlink" href="#start3_commented_at_2018-01-15_1832" title="Permanent link">&para;</a></h4>
<p>In my case i use plugin called
<a href="http://doc.bareos.org/master/html/bareos-manual-main-reference.html#QQ2-1-561">bpipe</a>,
it is installed by default with Bareos. Main purpose - consistent backup
of databases.</p>
<blockquote>
<p>The bpipe plugin is a generic pipe program, that simply transmits the
data from a speciﬁed program to Bareos for backup, and from Bareos to
a speciﬁed program for restore. The purpose of the plugin is to
provide an interface to any system program for backup and restore.
That allows you, for example, to do database backups without a local
dump. By using diﬀerent command lines to bpipe, you can backup any
kind of data (ASCII or binary) depending on the program called.<br />
On Linux, the Bareos bpipe plugin is part of the bareos-filedaemon
package and is therefore installed on any system running the
ﬁledaemon.</p>
</blockquote>
<p>I think this particular plugin is not needed for the REAR recovery phase
because bpipe connects to existing (working) SQL service. It should be
used on the next stage, when we have recovered, up and running server,
and we need to recover (or update) production databases. There are a lot
of other plugins (for example Percona, python based plugins and so on),
and we cannot provide everything for every of them. But it would be nice
if REAR could take care at least of Plugin directory string in config.
Less headache for users, i've spent several hours to understand what is
wrong with my recovery.<br />
By default <code>Plugin Directory = /usr/lib/bareos/plugins</code> string is
commented in /etc/bareos/bareos-fd.d/client/myself.conf. So most users
do not use plugins. We could:</p>
<ol>
<li>Parse /etc/bareos/bareos-fd.d/client/myself.conf and include all
    plugin directories we found using <code>COPY_AS_IS</code></li>
<li>Just create empty folder /usr/lib/bareos/plugins in rear environment
    (default folder for plugins, could be empty). It would resolve the
    error.</li>
<li>Comment <code>Plugin Directory = /usr/lib/bareos/plugins</code> string with
    PRE_RECOVERY_SCRIPT.</li>
<li>Do nothing. If anyone as dumb as myself would encounter such error,
    googling should lead to that GitHub thread and it would take minutes
    to resolve it manually.<br />
    I'm not sure if it is support question or minor bug or feature
    request.</li>
</ol>
<h4 id="gdha_commented_at_2018-01-16_1100"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357925966">2018-01-16 11:00</a>:<a class="headerlink" href="#gdha_commented_at_2018-01-16_1100" title="Permanent link">&para;</a></h4>
<p>@StarT3 @jsmeix We can add a <strong>rescue</strong> script to add those directories
(<code>/usr/lib/bareos/plugins</code> or <code>/usr/lib64/bareos/plugins</code>) when found,
no?<br />
E.g. <code>prep/BAREOS/570_check_bareos_plugin_dir.sh</code> script (still to be
written)?</p>
<h4 id="jsmeix_commented_at_2018-01-16_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-357953507">2018-01-16 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-16_1306" title="Permanent link">&para;</a></h4>
<p>I think adaptions and enhancements for third-party backup tool support
in ReaR<br />
is best implemented by those who make a particular third-party backup
tool<br />
or at least by those who use a particular third-party backup tool.</p>
<p>@aussendorf<br />
could you have a look here and could you do a pull request<br />
if there is a need for adaptions and enhancements<br />
to get support for Bareos plugins in ReaR?</p>
<p>@gdha<br />
in general I do not use any of the third-party backup tools<br />
so that in general I can neither reproduce any issue nor fix<br />
or enhance things that are related to third-party backup tools.</p>
<h4 id="jsmeix_commented_at_2018-01-26_0939"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1692#issuecomment-360731587">2018-01-26 09:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-26_0939" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1708">https://github.com/rear/rear/pull/1708</a>
merged<br />
this issue should be at least avoided or even fixed.</p>
<p>Now the the Bareos plugin directory gets included in the ReaR recovery
system<br />
which makes the Bareos stuff in the recovery system more consistent<br />
in a generically working way which is preferred over possibly
complicated<br />
automated changing Bareos config files in the recovery system,<br />
cf. "Maintain backward compatibility" at<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
that reads (excerpt)</p>
<pre>
Preferably use simple generic functionality
that works on any Linux system.
Better very simple code than
oversophisticated (possibly fragile) constructs. 
</pre>

<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-01-11.1692.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
