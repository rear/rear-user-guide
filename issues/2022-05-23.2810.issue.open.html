<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2810 Issue open: Empty SD card slot appears as /dev/sdb disk without partition type - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2810 Issue open: Empty SD card slot appears as /dev/sdb disk without partition type";
        var mkdocs_page_input_path = "issues/2022-05-23.2810.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2810 Issue open: Empty SD card slot appears as /dev/sdb disk without partition type</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2810_issue_open_empty_sd_card_slot_appears_as_devsdb_disk_without_partition_type"><a href="https://github.com/rear/rear/issues/2810">#2810 Issue</a> <code>open</code>: Empty SD card slot appears as /dev/sdb disk without partition type<a class="headerlink" href="#2810_issue_open_empty_sd_card_slot_appears_as_devsdb_disk_without_partition_type" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code></p>
<h4 id="mdbr000_opened_issue_at_2022-05-23_1237"><img src="https://avatars.githubusercontent.com/u/5205406?v=4" width="50"><a href="https://github.com/mdbr000">mdbr000</a> opened issue at <a href="https://github.com/rear/rear/issues/2810">2022-05-23 12:37</a>:<a class="headerlink" href="#mdbr000_opened_issue_at_2022-05-23_1237" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): <code>Relax-and-Recover 2.6 / Git</code></p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>LSB Version:    n/a
Distributor ID: ManjaroLinux
Description:    Manjaro Linux
Release:    21.2.6
Codename:   Qonos
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>KERNEL_FILE=/boot/vmlinuz-5.15-x86_64

REQUIRED_PROGS+=( borg locale localectl localedef locale-gen mount.nfs mount.nfs4 mount.fuse mount.fuse3 tmux )
LIBS+=( /usr/lib/libcrypt*.so* /usr/lib/libutil*.so* )
MODULES+=( fuse )

OUTPUT=RAWDISK
BACKUP_URL=nfs://arch-pi/srv/nfs/backups
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR): <code>Dell Precision 7820</code></p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): <code>x86_64</code></p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): <code>UEFI / GRUB</code></p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): <code>SSD</code></p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                                                      KNAME          PKNAME         TRAN   TYPE  FSTYPE      LABEL               SIZE MOUNTPOINT
/dev/sda                                                  /dev/sda                      sata   disk                                  1.8T 
`-/dev/sda1                                               /dev/sda1      /dev/sda              part  ext4                            1.8T 
/dev/sdb                                                  /dev/sdb                      usb    disk                                    0B 
/dev/sdc                                                  /dev/sdc                      usb    disk  iso9660     MANJARO_XFCE_2126   7.5G 
|-/dev/sdc1                                               /dev/sdc1      /dev/sdc              part  iso9660     MANJARO_XFCE_2126   3.3G 
`-/dev/sdc2                                               /dev/sdc2      /dev/sdc              part  vfat        MISO_EFI              4M 
/dev/nvme0n1                                              /dev/nvme0n1                  nvme   disk                                953.9G 
|-/dev/nvme0n1p1                                          /dev/nvme0n1p1 /dev/nvme0n1   nvme   part  vfat        NO_LABEL            300M /boot/efi
|-/dev/nvme0n1p2                                          /dev/nvme0n1p2 /dev/nvme0n1   nvme   part  crypto_LUKS                   884.8G 
| `-/dev/mapper/luks-1912fa48-dcca-4001-8fa1-2cd45b2f5a6f /dev/dm-0      /dev/nvme0n1p2        crypt ext4                          884.8G /
`-/dev/nvme0n1p3                                          /dev/nvme0n1p3 /dev/nvme0n1   nvme   part  crypto_LUKS                    68.8G 
  `-/dev/mapper/luks-559f7632-17f5-465e-b714-bb3fb4be1799 /dev/dm-1      /dev/nvme0n1p3        crypt swap        swap               68.8G [SWAP]
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
<code>rear -d -v mkbackup</code> fails with the following messages due to
    /dev/sdb</li>
</ul>
<!-- -->

<pre><code>ERROR: Invalid 'disk /dev/sdb' entry (no partition table type for '/dev/sdb')
Some latest log messages since the last called script 200_partition_layout.sh:
  2022-05-22 19:23:20.559444144 Saving disks and their partitions
  blockdev: cannot open /dev/sdb: No medium found
  Error: Error opening /dev/sdb: No medium found
</code></pre>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>Insert an SD card into /dev/sdb such that it appears populated with a
block device. Not a sustainable workaround for scheduled backups.
Potential issue for when trying to restore the machine later.</p>
<h4 id="jsmeix_commented_at_2022-05-23_1407"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1134725068">2022-05-23 14:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-23_1407" title="Permanent link">&para;</a></h4>
<p>@mdbr000<br />
did you test and verify with a previous ReaR version<br />
that "rear recover" actually does work for you<br />
when you have no SD card in /dev/sdb ?</p>
<p>This error exit is new since my recent<br />
<a href="https://github.com/rear/rear/pull/2804">https://github.com/rear/rear/pull/2804</a><br />
therein this new tests</p>
<pre><code># Ensure syntactically correct 'disk' entries:
# Each value must exist and each value must be a single non-blank word so we 'test' without quoting the value:
test $devname || Error "Invalid 'disk' entry (no disk device name for '$disk')"
test $devsize || Error "Invalid 'disk $devname' entry (no device size for '$devname')"
test $disktype || Error "Invalid 'disk $devname' entry (no partition table type for '$devname')"
</code></pre>
<p>in particular the last test which is currently online at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh#L409">https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh#L409</a></p>
<p>It tests based on the "Disk layout file syntax" description in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
which reads (excerpts)</p>
<pre><code>Angle brackets "&lt;" and "&gt;" delimit a value ...
...
Square brackets "[" and "]" indicate an optional parameter.
...
Disks

  disk &lt;name&gt; &lt;size(B)&gt; &lt;partition label&gt;
</code></pre>
<p>None of the values is specified as optional there<br />
so - in theory - it should be right to error out<br />
but - in practice - perhaps <code>&lt;partition label&gt;</code> is optional?</p>
<p>I will have to thoroughly inspect the code<br />
that consumes those values to find out<br />
if <code>&lt;partition label&gt;</code> is mandatory or optional.</p>
<p>When there are missing mandatory values in disklayout.conf<br />
things go arbitrarily and badly wrong during "rear recover".</p>
<p>If "rear recover" actually did work for you<br />
even when you have no SD card in /dev/sdb<br />
with a previous ReaR version<br />
you may as a workaround for now remove the line</p>
<pre><code>test $disktype || Error "Invalid 'disk $devname' entry (no partition table type for '$devname')"
</code></pre>
<p>from your<br />
usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh<br />
script.</p>
<h4 id="mdbr000_commented_at_2022-05-27_1637"><img src="https://avatars.githubusercontent.com/u/5205406?v=4" width="50"><a href="https://github.com/mdbr000">mdbr000</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1139783197">2022-05-27 16:37</a>:<a class="headerlink" href="#mdbr000_commented_at_2022-05-27_1637" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thanks much for the response and helpful information. I was indeed able
to run <code>rear mkbackup</code> successfully after reverting to the commit just
prior to your #2804 PR when no memory card was present in /dev/sdb.</p>
<p>It sounds like this might be a change/fix that you'll want to make in
mainline. For now, I will compile a version that comments out the <code>test</code>
line you call out above.</p>
<p>I am still having issues with recovery, but that is a separate topic.</p>
<p>Again, thank you.</p>
<h4 id="jsmeix_commented_at_2022-05-30_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141120476">2022-05-30 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-30_1250" title="Permanent link">&para;</a></h4>
<p>@mdbr000<br />
please attach your recent var/lib/rear/layout/disklayout.conf<br />
because I need to know how all entries related to <code>sdb</code><br />
look therein in your particular case.</p>
<h4 id="jsmeix_commented_at_2022-05-30_1307"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141138162">2022-05-30 13:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-30_1307" title="Permanent link">&para;</a></h4>
<p>I did a test with a manually modified<br />
var/lib/rear/layout/disklayout.conf<br />
as follows (excerpt):</p>
<pre><code>disk /dev/sda 12884901888 gpt
disk /dev/sdb 5368709120
</code></pre>
<p>i.e. I removed the partition type label <code>gpt</code> from <code>sdb</code><br />
and I also removed any other entry for <code>sdb</code> so</p>
<pre><code>disk /dev/sdb 5368709120
</code></pre>
<p>is the only entry related to <code>sdb</code> in<br />
var/lib/rear/layout/disklayout.conf</p>
<p>Then I did a "rear -D recover" which worked.</p>
<p>Except from var/lib/rear/layout/diskrestore.sh<br />
regarding <code>sdb</code>:</p>
<pre><code>if create_component "/dev/sdb" "disk" ; then
# Create /dev/sdb (disk)

#
# Code handling disk '/dev/sdb'
#

### Disks should be block devices.
[ -b "/dev/sdb" ] || BugError "Disk /dev/sdb is not a block device."

Log "Stop mdadm"
if grep -q md /proc/mdstat 2&gt;/dev/null; then
    mdadm --stop -s &gt;&amp;2 || echo "stop mdadm failed"
    # Prevent udev waking up mdadm later.
    # Reasoning: At least on RHEL6 when parted created a raid partition on disk,
    # udev (via /lib/udev/rules.d/65-md-incremental.rules) wakes up mdadm which locks the disk,
    # so further parted commands with the disk will fail since the disk is busy now.
    # The /lib/udev/rules.d/65-md-incremental.rules detects anaconda (the Red Hat installer),
    # and if it find itself running under anaconda, it will not run.
    # Accordingly also for other installers (in particular the ReaR installer)
    # this rule should not be there (and other Linux distros probably do not have it)
    # which means removing it is the right solution to make ReaR work also for RHEL6:
    if [ -e /lib/udev/rules.d/65-md-incremental.rules ] ; then
        rm -f /lib/udev/rules.d/65-md-incremental.rules || echo "rm 65-md-incremental.rules failed"
    fi
fi
Log "Erasing MBR of disk /dev/sdb"
dd if=/dev/zero of=/dev/sdb bs=512 count=1
sync

# Make sure device nodes are visible (eg. in RHEL4)
my_udevtrigger
my_udevsettle

# Clean up transient partitions and resize shrinked ones
delete_dummy_partitions_and_resize_real_ones

#
# End of code handling disk '/dev/sdb'
#

component_created "/dev/sdb" "disk"
else
    LogPrint "Skipping /dev/sdb (disk) as it has already been created."
fi
</code></pre>
<p>So it works in the special case when there is<br />
only a 'disk' entry without partition type label value<br />
but nothing else for this disk exists in disklayout.conf</p>
<h4 id="jsmeix_commented_at_2022-05-30_1328"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141161670">2022-05-30 13:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-30_1328" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/0a1d634ed15500bb21f37ac1bbb11c8a4bb11545">https://github.com/rear/rear/commit/0a1d634ed15500bb21f37ac1bbb11c8a4bb11545</a><br />
we do no longer error out when there is no partition label type value<br />
for a 'disk' entry in disklayout.conf because "rear recover" works<br />
in a special case without partition label type value when there is<br />
only a 'disk' entry but nothing else for this disk exists in
disklayout.conf<br />
which can happen when /dev/sdX is an empty SD card slot without medium.</p>
<h4 id="jsmeix_commented_at_2022-05-30_1342"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141176019">2022-05-30 13:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-30_1342" title="Permanent link">&para;</a></h4>
<p>@mdbr000<br />
I would appreciate it if you could test our current<br />
ReaR upstream GitHub master code, see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>With our current ReaR upstream GitHub master code<br />
you should get the message</p>
<pre><code>No partition label type for 'disk /dev/sdb' (may cause 'rear recover' failure)
</code></pre>
<p>because usually a missing partition label type value<br />
will cause a 'rear recover' failure.</p>
<p>Here "'rear recover' failure" also means when a disk gets<br />
partitioned with a fallback partition type via the code in<br />
layout/prepare/GNU/Linux/100_include_partition_code.sh<br />
when the original disk partition type was different<br />
but somehow not detected/stored in disklayout.conf.</p>
<h4 id="pcahyna_commented_at_2022-05-30_1455"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141249655">2022-05-30 14:55</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-30_1455" title="Permanent link">&para;</a></h4>
<p>Interesting - when testing #2804 &amp; #2803 I tested cases with drives
without partition tables, but not drives with missing media. I wonder
how to test this without a physical drive that supports removable media?</p>
<h4 id="jsmeix_commented_at_2022-05-31_0722"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141759827">2022-05-31 07:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-31_0722" title="Permanent link">&para;</a></h4>
<p>I was also wondering how I could somehow reproduce<br />
the behaviour that is described in this issue here.</p>
<p>I am not a SD card user (I don't have a SD card medium).<br />
My homeoffice laptop has an (empty) SD card slot<br />
but I see no block device node for it.</p>
<p>So I guess the SD card reader in this issue here<br />
is some unusual hardware that shows up as block device<br />
even when there is no medium so its block device node<br />
is basically useless and misleading.</p>
<p>I played around with an artificial "dangling" block device node</p>
<pre><code># mknod /dev/sdq b 8 99

# file /dev/sdq
/dev/sdq: block special (8/99)

# find /sys/block/
/sys/block/
/sys/block/dm-1
/sys/block/sr0
/sys/block/dm-0
/sys/block/sda

# lsblk /dev/sdq
lsblk: /dev/sdq: failed to get sysfs name: No such file or directory

# blockdev --report /dev/sdq
RO    RA   SSZ   BSZ        StartSec            Size   Device
blockdev: cannot open /dev/sdq: No such device or address
</code></pre>
<p>and /dev/sdq was just ignored by "rear mkrescue" (as it should).</p>
<p>So I manually modified a 'disk' entry in disklayout.conf<br />
in the ReaR recovery system before "rear recover"<br />
to be able to at least partially reproduce this issue here.</p>
<h4 id="pcahyna_commented_at_2022-05-31_1001"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1141930711">2022-05-31 10:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-31_1001" title="Permanent link">&para;</a></h4>
<p>The difference with a "dangling" device node is that opening it will
report <code>ENXIO</code> "No such device or address", while an existing but empty
device reports <code>ENOMEDIUM</code> "No medium found". I don't think the device
is necessarily "useless and misleading" - the physical device (card
reader) is here, only its slot is empty. This is the usual behavior with
removable media devices like floppies or optical media (not USB flash
"disks" though, because in their case you remove the entire device, not
only the medium).</p>
<h4 id="jsmeix_commented_at_2022-05-31_1155"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142036377">2022-05-31 11:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-31_1155" title="Permanent link">&para;</a></h4>
<p>With "basically useless and misleading" I meant how it behaves<br />
in practice in particular compared to "normal" disks.</p>
<p>With a "normal" disk when e.g. /dev/sda is there<br />
one can access "the whole disk data" via /dev/sda</p>
<p>In contrast removable media devices behave different because<br />
when e.g. /dev/sdb is there it does not necessarily mean<br />
one can access "the whole disk data" via /dev/sdb<br />
but only when a medium is inserted.</p>
<p>I wonder for what /dev/sdb could be useful without medium?<br />
My offhanded guess is that a removable media device<br />
without medium is as useful as a "normal" disk device where<br />
its built-in medium was mechanically removed by a technician<br />
or as useful as a USB mass storage device that is disconnected.<br />
But I am not at all an expert here so I only do some<br />
offhanded thinking from an ignorant end-user point of view.</p>
<p>In the end for ReaR this issue means:<br />
We will have to implement special case handling<br />
for removable media devices in ReaR.</p>
<h4 id="jsmeix_commented_at_2022-05-31_1204"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142045466">2022-05-31 12:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-31_1204" title="Permanent link">&para;</a></h4>
<p>FYI<br />
how my CD/DVD device behaves on my homeoffice laptop<br />
without medium</p>
<pre><code># cat /sys/block/sr0/removable
1

# lsblk /dev/sr0
NAME MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sr0   11:0    1 1024M  0 rom

# blockdev --report /dev/sr0
RO    RA   SSZ   BSZ        StartSec            Size   Device
rw  1024   512   512               0      1073741312   /dev/sr0

# parted -s /dev/sr0 print
Error: Error opening /dev/sr0: No medium found
</code></pre>
<p>and with medium (which got automatically mounted)</p>
<pre><code># lsblk /dev/sr0
NAME MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sr0   11:0    1  3.8G  0 rom  /run/media/johannes/openSUSE-Leap...

# blockdev --report /dev/sr0
RO    RA   SSZ   BSZ        StartSec            Size   Device
rw  1024  2048  2048               0      4056940544   /dev/sr0

# parted -s /dev/sr0 print
Error: Can't have a partition outside the disk!
Model: hp DVDRAM GU70N (scsi)
Disk /dev/sr0: 4057MB
Sector size (logical/physical): 2048B/2048B
Partition Table: unknown
Disk Flags:
</code></pre>
<h4 id="pcahyna_commented_at_2022-05-31_1232"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142073982">2022-05-31 12:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-31_1232" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I wonder for what /dev/sdb could be useful without medium?</p>
</blockquote>
<p>You can ask for its manufacturer and capabilities, for example. With the
device node, it is easier to map what devices you have. If the device
has a loadable tray, you can also issue commands like open/close the
tray and load the medium (this is the case for optical and similar
media), which would be difficult without a device node.</p>
<p>It seems that the empty DVD drive behaves similarly to the empty SD card
reader, but that's probably not so useful for ReaR testing, because I
suppose that ReaR ignores CD/DVD drives (would it help to create a
symlink <code>/dev/sdb</code> -&gt; <code>/dev/sr0</code>?)</p>
<h4 id="jsmeix_commented_at_2022-05-31_1246"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142089461">2022-05-31 12:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-31_1246" title="Permanent link">&para;</a></h4>
<p>With a /dev/sdq -&gt; /dev/sr0 symlink:</p>
<pre><code># ln -s /dev/sr0 /dev/sdq

# ls -l  /dev/sr0 /dev/sdq
lrwxrwxrwx  1 root root      8 May 31 14:38 /dev/sdq -&gt; /dev/sr0
brw-rw----+ 1 root cdrom 11, 0 May 31 14:10 /dev/sr0

# usr/sbin/rear -D mkrescue
...
Creating disk layout
Overwriting existing disk layout file /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Excluding component fs:/other in EXCLUDE_RECREATE
Marking component 'fs:/other' as done in /root/rear.github.master/var/lib/rear/layout/disktodo.conf
Disabling excluded components in /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Disabling component 'fs ... /other' in /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Using sysconfig bootloader 'grub2' for 'rear recover'
Verifying that the entries in /root/rear.github.master/var/lib/rear/layout/disklayout.conf are correct
Created disk layout (check the results in /root/rear.github.master/var/lib/rear/layout/disklayout.conf)
...

# grep sdq var/lib/rear/layout/disklayout.conf
[no output]

# grep sdq var/log/rear/rear-linux-h9wr.log
[no output]

# grep sr0 var/lib/rear/layout/disklayout.conf
# /dev/sr0            /dev/sr0       sata   rom          3.8G
[this is only the 'lsblk' comment line in disklayout.conf]

# grep sr0 var/log/rear/rear-linux-h9wr.log
++ ID_NEW=sr0
++ [[ sr0 =~ ^dm- ]]
++ echo ata-hp_DVDRAM_GU70N_M49CBQG2454 /dev/sr0
++ ID_NEW=sr0
++ [[ sr0 =~ ^dm- ]]
++ echo wwn-0x5001480000000000 /dev/sr0
++ blockd=sr0
++ [[ sr0 = hd* ]]
++ [[ sr0 = sd* ]]
++ [[ sr0 = cciss* ]]
++ [[ sr0 = vd* ]]
++ [[ sr0 = xvd* ]]
++ [[ sr0 = dasd* ]]
++ [[ sr0 = nvme* ]]
++ [[ sr0 = mmcblk* ]]
</code></pre>
<p>Without /dev/sdq -&gt; /dev/sr0 symlink:</p>
<pre><code># grep sr0 var/lib/rear/layout/disklayout.conf
# /dev/sr0            /dev/sr0       sata   rom          3.8G
[this is only the 'lsblk' comment line in disklayout.conf]

# grep sr0 var/log/rear/rear-linux-h9wr.log
++ ID_NEW=sr0
++ [[ sr0 =~ ^dm- ]]
++ echo ata-hp_DVDRAM_GU70N_M49CBQG2454 /dev/sr0
++ ID_NEW=sr0
++ [[ sr0 =~ ^dm- ]]
++ echo wwn-0x5001480000000000 /dev/sr0
++ blockd=sr0
++ [[ sr0 = hd* ]]
++ [[ sr0 = sd* ]]
++ [[ sr0 = cciss* ]]
++ [[ sr0 = vd* ]]
++ [[ sr0 = xvd* ]]
++ [[ sr0 = dasd* ]]
++ [[ sr0 = nvme* ]]
++ [[ sr0 = mmcblk* ]]
</code></pre>
<h4 id="jsmeix_commented_at_2022-05-31_1303"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142108453">2022-05-31 13:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-31_1303" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your explanation<br />
for what /dev/sdX is useful without medium<br />
e.g. to open/close a tray and things like that<br />
i.e. what is needed to load or unload a medium.<br />
Now I understand.</p>
<h4 id="pcahyna_commented_at_2022-05-31_1341"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142152951">2022-05-31 13:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-31_1341" title="Permanent link">&para;</a></h4>
<p>I am trying to create <code>/dev/sdq</code> with the same device major/minor
numbers as <code>/dev/sr0</code> (<code>cp -a /dev/sr0 /dev/sdq</code> does the job) and trick
ReaR into believing that it is a disk, but so far I have not been
successful.</p>
<h4 id="pcahyna_commented_at_2022-05-31_1346"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1142157784">2022-05-31 13:46</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-31_1346" title="Permanent link">&para;</a></h4>
<p>looking at the output here, <code>/dev/sdb</code> is a USB mass storage device. I
remember having seen (external) USB card readers, but it was a long time
ago. Some laptops apparently have built-in memory card readers on USB,
so one might be successful with some of those, but I currently do not
have one. @mdbr000 what device is it? (I think a <code>lsusb</code> output would
help.)</p>
<h4 id="jsmeix_commented_at_2022-06-01_0646"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1143181042">2022-06-01 06:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-01_0646" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thanks for trying with an artificial /dev/sdq device node<br />
with same major/minor numbers as /dev/sr0.<br />
That would have been my next attempt for today.</p>
<p>FYI:<br />
My built-in SD card reader is:</p>
<pre><code># lspci -k
...
05:00.0 Unassigned class [ff00]: Realtek Semiconductor Co., Ltd.
 RTS5227 PCI Express Card Reader (rev 01)
        Subsystem: Hewlett-Packard Company Device 1940
        Kernel driver in use: rtsx_pci
        Kernel modules: rtsx_pci
</code></pre>
<p>I have nothing about 'rtsx' in <code>dmesg</code> - there is only</p>
<pre><code># dmesg | egrep -i '05:00\.0|mmc'

[    0.036434] PCI: MMCONFIG for domain 0000 [bus 00-ff] at [mem 0xe0000000-0xefffffff] (base 0xe0000000)
[    0.036434] PCI: MMCONFIG at [mem 0xe0000000-0xefffffff] reserved in E820
...
[    2.514760] pci 0000:05:00.0: [10ec:5227] type 00 class 0xff0000
[    2.514861] pci 0000:05:00.0: reg 0x10: [mem 0xb0500000-0xb0500fff]
[    2.515180] pci 0000:05:00.0: supports D1 D2
[    2.515182] pci 0000:05:00.0: PME# supported from D1 D2 D3hot D3cold
...
[    7.722075] sr 5:0:0:0: [sr0] scsi3-mmc drive: 24x/24x writer dvd-ram cd/rw xa/form2 cdda tray
</code></pre>
<p>There is no device node for it (neither /dev/sd* nor /dev/mmc*)</p>
<pre><code># udisksctl status

MODEL                     REVISION  SERIAL               DEVICE
---------------------------------------------------------------
TOSHIBA MQ01ABF050        AM002C    Y2PLP02CT            sda     
hp       DVDRAM GU70N     U703      M49CBQG2454          sr0
</code></pre>
<p>I assume this is expected because I do not have a SD card.</p>
<h4 id="pcahyna_commented_at_2022-06-01_1149"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1143504272">2022-06-01 11:49</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-01_1149" title="Permanent link">&para;</a></h4>
<p>@jsmeix I have a similar device and it behaves the same way. I decided I
will not try further to emulate an empty <code>sd</code> drive with an empty <code>sr</code>
drive, because it seems that the code is smart enough to distinguish
between CD-ROM drives and usual SCSI disks. I now prefer reproducing the
issue with the actual problematic hardware.</p>
<p>@mdbr000 can you please send the <code>lsusb</code> output identifying your card
reader?</p>
<h4 id="jsmeix_commented_at_2022-06-02_0725"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1144536800">2022-06-02 07:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-02_0725" title="Permanent link">&para;</a></h4>
<p>I postponed this issue to ReaR 2.8 because<br />
it does not need to be solved for ReaR 2.7<br />
because since<br />
<a href="https://github.com/rear/rear/commit/0a1d634ed15500bb21f37ac1bbb11c8a4bb11545">https://github.com/rear/rear/commit/0a1d634ed15500bb21f37ac1bbb11c8a4bb11545</a><br />
"rear mkrescue" works again even when there is<br />
no partition label type value for a 'disk' entry in disklayout.conf</p>
<h4 id="github-actions_commented_at_2022-08-02_0353"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1201984947">2022-08-02 03:53</a>:<a class="headerlink" href="#github-actions_commented_at_2022-08-02_0353" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="jsmeix_commented_at_2022-08-10_0611"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1210205720">2022-08-10 06:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-08-10_0611" title="Permanent link">&para;</a></h4>
<p>Because I have no removable media device<br />
I cannot do anything actually useful here<br />
so I leave this issue closed.</p>
<h4 id="jsmeix_commented_at_2023-03-21_1256"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1477790517">2023-03-21 12:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-21_1256" title="Permanent link">&para;</a></h4>
<p>Reopening because of<br />
<a href="https://github.com/rear/rear/issues/2958">https://github.com/rear/rear/issues/2958</a></p>
<h4 id="github-actions_commented_at_2023-05-21_0227"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2810#issuecomment-1556066684">2023-05-21 02:27</a>:<a class="headerlink" href="#github-actions_commented_at_2023-05-21_0227" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-05-23.2810.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
