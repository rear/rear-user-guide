<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1000 Issue closed: Error at rear recover: Disk /dev/hda is not a block device - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1000 Issue closed: Error at rear recover: Disk /dev/hda is not a block device";
        var mkdocs_page_input_path = "issues/2016-09-16.1000.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#1000 Issue closed: Error at rear recover: Disk /dev/hda is not a block device</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1000_issue_closed_error_at_rear_recover_disk_devhda_is_not_a_block_device"><a href="https://github.com/rear/rear/issues/1000">#1000 Issue</a> <code>closed</code>: Error at rear recover: Disk /dev/hda is not a block device<a class="headerlink" href="#1000_issue_closed_error_at_rear_recover_disk_devhda_is_not_a_block_device" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="jandoe88_opened_issue_at_2016-09-16_0858"><img src="https://avatars.githubusercontent.com/u/16703948?v=4" width="50"><a href="https://github.com/jandoe88">jandoe88</a> opened issue at <a href="https://github.com/rear/rear/issues/1000">2016-09-16 08:58</a>:<a class="headerlink" href="#jandoe88_opened_issue_at_2016-09-16_0858" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): Relax-and-Recover 1.18 / Git</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): Debian
    GNU/Linux 5.0 \n \l</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):<br />
    OUTPUT=ISO<br />
    BACKUP=NETFS<br />
    BACKUP_URL="nfs://192.168.77.31/srv/nfs/"<br />
    AUTOEXCLUDE_PATH=( /data )</li>
<li>Brief description of the issue:<br />
    I try p2v of a physical machine with debian 5, software raid and
    lvm. Mkbackup works without problems. Restore on kvm (also tested
    restore on real hardware) is not working. I get the following
    error:<br />
    ERROR: BUG BUG BUG! Disk /dev/hda is not a block device<br />
    Any ideas?</li>
</ul>
<p>Recovery logfile:</p>
<p><a href="https://github.com/rear/rear/files/476457/rear-log.pdf">rear-log.pdf</a></p>
<h4 id="jsmeix_commented_at_2016-09-16_1138"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-247579776">2016-09-16 11:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-09-16_1138" title="Permanent link">&para;</a></h4>
<p>Do what the log file recommends:</p>
<pre>
HINT: If you can reproduce the issue, try using the -d or -D option !
</pre>

<p>In general see the section<br />
"Debugging issues with Relax-and-Recover (rear)" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I think the "Disk /dev/hda is not a block device." message<br />
comes from the create_disk() function in<br />
usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh<br />
therein the code</p>
<pre>
    [[ -b "$disk" ]]
    BugIfError "Disk $disk is not a block device."
</pre>

<p>I.e. in your target system /dev/hda is not a block device.</p>
<p>When you are in the recovery system before you run<br />
"rear recover" inspect your target system and verify that<br />
the contens of your var/lib/rear/layout/disklayout.conf<br />
are appropriate for what there actually is in your<br />
target system.</p>
<p>In general regarding migration:</p>
<p>In general migrating a system onto different hardware<br />
(or from physical to virtual hardware) does not "just work".</p>
<p>In sufficiently simple cases it may "just work" but in general<br />
do not expect too much built-in intelligence from a program<br />
(written in plain bash which is not a programming language<br />
that is primarily meant for artificial intelligence ;-)<br />
that would do the annoying legwork for you.</p>
<p>To migrate a system onto different hardware you usually<br />
have to adapt your disklayout.conf from the "old" system<br />
to make it appropriate for the "new" system.</p>
<p>For an example you may have a look at the<br />
"P2V HP microserver to VmWare" issue<br />
<a href="https://github.com/rear/rear/issues/943">https://github.com/rear/rear/issues/943</a></p>
<p>To mitigate the annoying migrating legwork a bit,<br />
I recommend the newest rear GitHub master code that provides<br />
some first steps for RECOVERY_UPDATE_URL support.</p>
<p>See default.conf how RECOVERY_UPDATE_URL is meant to work:<br />
<a href="https://raw.githubusercontent.com/rear/rear/dev/usr/share/rear/conf/default.conf">https://raw.githubusercontent.com/rear/rear/dev/usr/share/rear/conf/default.conf</a></p>
<p>For an example how RECOVERY_UPDATE_URL works see<br />
<a href="https://github.com/rear/rear/issues/943#issuecomment-236547810">https://github.com/rear/rear/issues/943#issuecomment-236547810</a></p>
<p>But when you use the latest rear master code see<br />
<a href="https://github.com/rear/rear/issues/943#issuecomment-237544630">https://github.com/rear/rear/issues/943#issuecomment-237544630</a><br />
what is special about the disklayout.conf file location<br />
in the recovery system that you must consider<br />
to make RECOVERY_UPDATE_URL work.</p>
<h4 id="gdha_commented_at_2016-09-21_0817"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-248543000">2016-09-21 08:17</a>:<a class="headerlink" href="#gdha_commented_at_2016-09-21_0817" title="Permanent link">&para;</a></h4>
<p>@jandoe88 I guess your missing the right kernel module for the disk
devices on the target system (due to the p2v move). If you know which
kernel module it is, you have to make sure it is copied on the source
system (via LOAD_MODULES) during the creation of the rear ISO image.</p>
<h4 id="jsmeix_commented_at_2016-09-21_0830"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-248545846">2016-09-21 08:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-09-21_0830" title="Permanent link">&para;</a></h4>
<p>Or /dev/hda may not at all exist on the new system.</p>
<p>On virtual machines the device node for a virtual harddisk<br />
could be something like "/dev/vda", cf. the section<br />
"First steps with Relax-and-Recover (rear)" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>E.g. on my SLES12-SP2-RC2 virtual KVM/QEMU machine:</p>
<pre>
# test -b /dev/hda || echo no block device
no block device
# ls -l /dev/hda
ls: cannot access '/dev/hda': No such file or directory
</pre>

<h4 id="jandoe88_commented_at_2016-09-21_0830"><img src="https://avatars.githubusercontent.com/u/16703948?v=4" width="50"><a href="https://github.com/jandoe88">jandoe88</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-248545887">2016-09-21 08:30</a>:<a class="headerlink" href="#jandoe88_commented_at_2016-09-21_0830" title="Permanent link">&para;</a></h4>
<p>Hi. Thanks for your help jsmeix and gdha.<br />
I figured it out, it works now. There were different problems:</p>
<ol>
<li>The hard disk was shown in dmesg but not in fdisk.<br />
    Solution: Device in /dev was missing, create it manually<br />
    mknod /dev/sda b 8 0<br />
    mknod /dev/sda1 b 8 1<br />
    mknod /dev/sda2 b 8 2<br />
    [...]</li>
<li>Kernel module for software raid had to be loaded manually:<br />
    modprobe md</li>
<li>diskrestore.sh had to be changed during recovery:<br />
    echo "Y" | mdadm --create /dev/md0 --force --metadata=00.90<br />
    to<br />
    echo "Y" | mdadm --create /dev/md0 --force --metadata=0.90</li>
</ol>
<p>After that, the recovery worked as expected :)</p>
<p>Best regards,<br />
Jan</p>
<h4 id="jsmeix_commented_at_2016-09-21_0831"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-248546155">2016-09-21 08:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-09-21_0831" title="Permanent link">&para;</a></h4>
<p>@jandoe88<br />
many thanks for your feedback what the actual issue was<br />
in your particular case and how you got it working!</p>
<h4 id="jsmeix_commented_at_2016-09-21_0837"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1000#issuecomment-248547468">2016-09-21 08:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-09-21_0837" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I think in this case</p>
<pre>
BugIfError "Disk $disk is not a block device."
</pre>

<p>is not the right kind of error.<br />
In migration mode it should be</p>
<pre>
StopIfError "Disk $disk is not a block device."
</pre>

<p>because in migration mode that issue is<br />
(with probability one) not a bug in rear.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-09-16.1000.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
