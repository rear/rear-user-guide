<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3075 Issue closed: Add new BACKUP=VEEAM method - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3075 Issue closed: Add new BACKUP=VEEAM method";
        var mkdocs_page_input_path = "issues/2023-11-12.3075.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3075 Issue closed: Add new BACKUP=VEEAM method</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3075_issue_closed_add_new_backupveeam_method"><a href="https://github.com/rear/rear/issues/3075">#3075 Issue</a> <code>closed</code>: Add new BACKUP=VEEAM method<a class="headerlink" href="#3075_issue_closed_add_new_backupveeam_method" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>sponsored</code>, <code>no-issue-activity</code></p>
<h4 id="schlomo_opened_issue_at_2023-11-12_1916"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/3075">2023-11-12 19:16</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-11-12_1916" title="Permanent link">&para;</a></h4>
<h3 id="discussed_in_httpsgithubcomrearreardiscussions3071">Discussed in <a href="https://github.com/rear/rear/discussions/3071">https://github.com/rear/rear/discussions/3071</a><a class="headerlink" href="#discussed_in_httpsgithubcomrearreardiscussions3071" title="Permanent link">&para;</a></h3>
<div type='discussions-op-text'>

<sup>Originally posted by **idna38** November 7, 2023</sup>  
Hello,

We like to request a Veeam Linux Client disaster recovery integration
option with relax and recover.  
Our approach is to create a small PXE configuration for each single
client, upload it to an NFS/PXE server and restore those  
systems with PXE and the Veeam Backup agent for Linux.

Here is our procedure to run a successful backup and recovery with relax
and recover:

Client-side configuration
=========================

File /etc/rear/local.conf:

OUTPUT=PXE  
OUTPUT\_PREFIX\_PXE=$HOSTNAME  
BACKUP=NETFS  
BACKUP\_URL=nfs://192.168.0.1/var/lib/tftpboot  
PXE\_TFTP\_URL=nfs://192.168.0.1/var/lib/tftpboot/  
PXE\_CONFIG\_URL=nfs://192.168.0.1/var/lib/tftpboot/pxelinux.cfg  
PXE\_RECOVER\_MODE="unattended"

PXE\_CONFIG\_GRUB\_STYLE=y  
PXE\_TFTP\_IP=192.168.0.1  
SSH\_ROOT\_PASSWORD=changeme  
USING\_UEFI\_BOOTLOADER=1  
COPY\_AS\_IS+=( /usr/share/rear/\* /etc/veeam/\* /usr/bin/veeam\*
/usr/lib/veeam/\* /usr/sbin/veeam\* /usr/share/veeam/\*
/usr/share/doc/veeam/\* )

Backup procedure
================

rear -v mkbackup

After the backup task is completed, it should have created a PXE
configuration file with initrd, vmlinuz kernel files on the NFS/PXE
server.

**Example:**  
\[root@rhel8-veeam-rear tftp\]\# cat 01-02-a7-18-00-00-13  
default hd  
prompt 1  
timeout 300

label hd  
localboot -1  
say ENTER - boot local hard disk  
say
--------------------------------------------------------------------------------  
display /rhel8-veeam-rear.message  
say ----------------------------------------------------------  
say rear = disaster recover this system with Relax-and-Recover  
label rear  
kernel /rhel8-veeam-rear.kernel  
append initrd=/rhel8-veeam-rear.initrd.cgz root=/dev/ram0 vga=normal rw
selinux=0 console=ttyS0,9600 console=tty0  
\[root@rhel8-veeam-rear tftp\]\#

Restore Procedure
=================

-   Boot the system with network boot/PXE
-   Login with root user and the password which was provided in the
    local.conf file from the client to restore.
-   Start the initial restore for disk, filesystem partitions, hostname
    and original network configuration like DHCP/STATIC
-   Start Veeam Service
-   Recover Data with Veeam Agent for Linux
-   Rewrite Grub Bootloader
-   SELinux (Optionally)
-   Reboot the system
-   Verify functionality

Commands to use
===============

-   rear recover

-   systemctl start veeamservice

-   'veeamconfig vbrServer add --name <veeamserver> --address
    <veeamserver> --domain <veeamdomain> --login Administrator (IP und
    Hostname von Veeam Server) --password <password>'

-   veeamconfig backup list --all (Always use the last backup ID  
    Example:

-   veeamconfig backup mount --id {Use same the mount-id which was
    provided from the previous command)}

: Info:  
This could raise an error, because the software want´s to mount the
device in read/write mode, which is not allowed.

:The device was only mounted as veeamloop device and needs to be
remounted agains as read-only device for recovery

-   veeammount -d /tmp/veeamflr/<ID>/FileLevelBackup\_0 -p /mnt/backup
    -o ro -m (-d und -p können per mount command gesucht werden)

Final recovery procedure
========================

Recover the files from /mnt/backup to /mnt/local
================================================

shopt -s dotglob  
cp -rpva /mnt/backup/\* /mnt/local/ \# Copyjob time can depend of the
amount of data :)

Chroot and rewrite the GRUB Bootloader
======================================

chroot /mnt/local  
sudo dnf reinstall shim-\* grub2-\*  
exit (von rear console)

Did you restore the backup to /mnt/local ? Are you ready to continue
recovery ? yes

After this "umount -a" and "reboot"  
SELinux will be relabeled if necessarry

Last Post Task:  
Add the client/server back to an Veeam Protection Group with an XML
file:  
-- veeamconfig mode setVbrSettings --cfg

Please let us know, how we can proceed on this or if we can get some
help from the community.  
Any answer is kindly appreciated.

Thanks and best regards,  
Andreas</div>

<h4 id="schlomo_commented_at_2023-11-12_1934"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/3075#issuecomment-1807218361">2023-11-12 19:34</a>:<a class="headerlink" href="#schlomo_commented_at_2023-11-12_1934" title="Permanent link">&para;</a></h4>
<p>@idna38 just to clarify how Veeam works: it mounts a virtual file system
that we can use to copy all files and folders back onto the freshly
formatted disks? How does it handle multiple file systems on the
original server, extended file attributes and stuff like that? What
about sparse files and hard links?</p>
<p>Is it important to stop this mount (see
<a href="https://helpcenter.veeam.com/docs/agentforlinux/userguide/files_restore_cmd_backup_umount.html?ver=60">https://helpcenter.veeam.com/docs/agentforlinux/userguide/files_restore_cmd_backup_umount.html?ver=60</a>)
or OK to leave it open?</p>
<p>I'm also wondering why just mounting the backup as described in
<a href="https://helpcenter.veeam.com/docs/agentforlinux/userguide/files_restore_cmd_backup_mount.html?ver=60">https://helpcenter.veeam.com/docs/agentforlinux/userguide/files_restore_cmd_backup_mount.html?ver=60</a>
is not enough.</p>
<p>Is there maybe another command that would simply extract (like <code>tar -x</code>)
this Veeam backup to a directory, without mounting it first? That might
give us more control over the process and it might be faster, too.</p>
<h4 id="schlomo_commented_at_2023-11-12_2125"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/3075#issuecomment-1807244344">2023-11-12 21:25</a>:<a class="headerlink" href="#schlomo_commented_at_2023-11-12_2125" title="Permanent link">&para;</a></h4>
<p>@idna38 would it be worth exploring these "recovery tokens" as a way to
facilitate authentication for the agent without granting full access to
credentials stored on the rescue media?<br />
<img alt="image" src="https://github.com/rear/rear/assets/101384/a1c8e17f-4865-4d8a-8793-1a034c6a9b47" /></p>
<h4 id="github-actions_commented_at_2024-01-12_0210"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/3075#issuecomment-1888304232">2024-01-12 02:10</a>:<a class="headerlink" href="#github-actions_commented_at_2024-01-12_0210" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-11-12.3075.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
