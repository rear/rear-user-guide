<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#199 Issue closed: Problem with chroot into nodev mount - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#199 Issue closed: Problem with chroot into nodev mount";
        var mkdocs_page_input_path = "issues/2013-02-06.199.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#199 Issue closed: Problem with chroot into nodev mount</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="199_issue_closed_problem_with_chroot_into_nodev_mount"><a href="https://github.com/rear/rear/issues/199">#199 Issue</a> <code>closed</code>: Problem with chroot into nodev mount<a class="headerlink" href="#199_issue_closed_problem_with_chroot_into_nodev_mount" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>discuss / RFC</code></p>
<h4 id="semsen_opened_issue_at_2013-02-06_1443"><img src="https://avatars.githubusercontent.com/u/3492356?v=4" width="50"><a href="https://github.com/semsen">semsen</a> opened issue at <a href="https://github.com/rear/rear/issues/199">2013-02-06 14:43</a>:<a class="headerlink" href="#semsen_opened_issue_at_2013-02-06_1443" title="Permanent link">&para;</a></h4>
<p>Since 1.1x rear mounts the filesystems while the recover with the
originated mount options. I have a problem with the final chroots for
mkinitrd and grub. I use SLES11 SP2 and mount the "normal" filesystems
due to some security advices with the "nodev" option.<br />
So when there is done the chroot to /mnt/local the /dev doesn't work and
there are errors from the mkinitrd part (only cosmetic) but also from
the part the grub configuration because grub says the device does not
exist and he does nothing.</p>
<p>Since I was not able to mount a udev or devfs to /mnt/local/dev quickly
like its done for /proc, I solved it by overwriting the "nodev" with
"dev" for / in the disklayout.conf</p>
<p>Here's my change in layout/save/GNU/Linux/23_filesystem_layout.sh</p>
<pre><code>    options=${options#(} 
    options=${options%)}
</code></pre>
<blockquote>
<pre><code>   # Don't mount the original root fs with nodev, chroot for initrd and grub won't work 
   if [[ $mountpoint = "/" ]]; then 
    options=$(echo $options|sed 's/nodev/dev/') 
   fi 
    echo -n " options=$options"
</code></pre>
</blockquote>
<p>Please feel free to adopt this change. Maybee a better place to solve
this problem is not when writing the disklayoutfile, but when reading
it. It would also be possible to do a remount before the chroots, but I
thought this would be the place nodev is removed thoroughly.</p>
<p>I had an adittional problem.</p>
<p>In my old environment (SELS10, rear 1.7.23, TSM-Backup with TSM-Client
6.2) a rear recover produced a ISO of about 40MB. In my new environment
(SLES11, rear 1.14 and TSM Backup with TSM-Client 6.4) the ISO is about
175MB!</p>
<p>Some of the groth is about SLES11, some is about rear (packaging all
storage and network drivers into the iso). But most of the growth is
caused by the new TSM Client which has a lot of huge libs. I had to
enlarge my /tmp and /var filesystems to run rear recover successfully.<br />
Therefor I exclude some files via COPY_AS_IS_EXCLUDE_TSM in my
local.conf</p>
<p>COPY_AS_IS_EXCLUDE_TSM=(
/opt/tivoli/tsm/client/api/bin64/libTsmViSdk.so
/opt/tivoli/tsm/client/ba/bin/libTsmViSdk.so
/opt/tivoli/tsm/client/ba/bin/libtypes.so
/opt/tivoli/tsm/client/ba/bin/plugins64/libdiskLibPlugin.so )</p>
<p>TSM-Restore works without them and the ISO shrinked to 100MB</p>
<p>Maybee you can add this in the default.conf, (maybee as comment) to give
users a hint where to start.</p>
<h4 id="gdha_commented_at_2013-02-06_1515"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/199#issuecomment-13186418">2013-02-06 15:15</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-06_1515" title="Permanent link">&para;</a></h4>
<p>@dagwieers @jhoekx What are your opinions about the "nodev" issue?</p>
<h4 id="jhoekx_commented_at_2013-02-06_1521"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/199#issuecomment-13186733">2013-02-06 15:21</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-06_1521" title="Permanent link">&para;</a></h4>
<p>Let's just ignore the <code>nodev</code> option in
13_include_filesystem_code.sh.</p>
<h4 id="jhoekx_commented_at_2013-02-06_1529"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/199#issuecomment-13187205">2013-02-06 15:29</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-06_1529" title="Permanent link">&para;</a></h4>
<p>Not quite tested the fix. Please reopen if the issue is still present.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2013-02-06.199.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
