<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#150 Issue closed: Relax-and-Recover fails when /tmp is mounted noexec - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#150 Issue closed: Relax-and-Recover fails when /tmp is mounted noexec";
        var mkdocs_page_input_path = "issues/2012-09-01.150.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#150 Issue closed: Relax-and-Recover fails when /tmp is mounted noexec</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="150_issue_closed_relax-and-recover_fails_when_tmp_is_mounted_noexec"><a href="https://github.com/rear/rear/issues/150">#150 Issue</a> <code>closed</code>: Relax-and-Recover fails when /tmp is mounted noexec<a class="headerlink" href="#150_issue_closed_relax-and-recover_fails_when_tmp_is_mounted_noexec" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code></p>
<h4 id="schoekek_opened_issue_at_2012-09-01_0959"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> opened issue at <a href="https://github.com/rear/rear/issues/150">2012-09-01 09:59</a>:<a class="headerlink" href="#schoekek_opened_issue_at_2012-09-01_0959" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>i have this error since version 1.12...<br />
I installed today the 1.13.0 from suse Buildservice on Debian 6.0.5.</p>
<p>many thx for ideas,</p>
<p>Karsten</p>
<h4 id="dagwieers_commented_at_2012-09-01_2112"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8216602">2012-09-01 21:12</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-01_2112" title="Permanent link">&para;</a></h4>
<p>Could you please test the snapshot release ? (Which is incidently also
called 1.13.0 with a git-timestamp)</p>
<p>Also, we would need more information in order to help you.</p>
<p>@jhoekx I think we need to make a small troubleshooting guide that
instructs people to try the most recent release from the master branch,
perform some tests and to send more detailed information (configuration,
version and logs).</p>
<h4 id="schoekek_commented_at_2012-09-02_0830"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8219982">2012-09-02 08:30</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-02_0830" title="Permanent link">&para;</a></h4>
<p>I try the shapshot release rear_1.13.0-0git201208292128_all.deb frome
suse built service.<br />
The error ist the same.<br />
Here is the output:</p>
<pre><code>rear -dD mkbackup
.
.
Copying binaries and libraries
Copying kernel modules
ERROR: BUG BUG BUG!  ROOTFS_DIR '/tmp/rear.WTjmuRD2dQETSQc/rootfs' is broken, chroot bash test failed.
=== Issue report ===
Please report this unexpected issue at: https://github.com/rear/rear/issues
Also include the relevant bits from /var/log/rear/rear-legolas.log

HINT: If you can reproduce the issue, try using the -d or -D option !
====================
Aborting due to an error, check /var/log/rear/rear-legolas.log for details
You should also rm -Rf /tmp/rear.WTjmuRD2dQETSQc
Beendet
</code></pre>
<p>The local.conf file ist emty.<br />
The file <em>/var/log/rear/rear-legolas.log</em> is very log, can you mail it?</p>
<p>Whis infos need you??</p>
<p>Karsten</p>
<h4 id="dagwieers_commented_at_2012-09-02_1152"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8221187">2012-09-02 11:52</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-02_1152" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I try the shapshot release rear_1.13.0-0git201208292128_all.deb
frome suse built service.<br />
The error ist the same.</p>
</blockquote>
<p>Thanks for testing.</p>
<p>In order to debug Relax-and-Recover retains the temporary directory in
<em>/tmp/</em>, can you try to do a:
<code>chroot /tmp/rear.WTjmuRD2dQETSQc /bin/bash</code></p>
<p>This is in fact what is probably failing. I hope the output of that
command to be useful.</p>
<p>PS You can upload log files through gist:
<a href="https://gist.github.com/">https://gist.github.com/</a></p>
<h4 id="jhoekx_commented_at_2012-09-02_1415"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8222296">2012-09-02 14:15</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-02_1415" title="Permanent link">&para;</a></h4>
<p>I will try to reproduce this in a VM. Are you on Debian 64-bit?</p>
<h4 id="schoekek_commented_at_2012-09-02_1422"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8222359">2012-09-02 14:22</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-02_1422" title="Permanent link">&para;</a></h4>
<p>thx for your Time on sunday!</p>
<p>I use Debian on 32 Bit</p>
<pre><code>legolas:~# uname -a
Linux legolas 2.6.32-5-686 #1 SMP Sun May 6 04:01:19 UTC 2012 i686 GNU/Linux
legolas:~# cat /etc/debian_version
6.0.5
</code></pre>
<p>Here ist the output:</p>
<pre><code># chroot /tmp/rear.qPmcLixJUznp1E7 /bin/bash
chroot: failed to run command `/bin/bash': No such file or directory
</code></pre>
<p>I try <code>strace -f chroot /tmp/rear.qPmcLixJUznp1E7 /bin/bash
2&gt;&amp;1</code><br />
Here is the output:</p>
<pre><code>execve("/usr/sbin/chroot", ["chroot", "/tmp/rear.qPmcLixJUznp1E7", "/bin/bash"], [/* 16 vars */]) = 0
brk(0)                                  = 0x9445000
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
mmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb77d1000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=76406, ...}) = 0
mmap2(NULL, 76406, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb77be000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/i686/cmov/libc.so.6", O_RDONLY) = 3
read(3, "\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\0n\1\0004\0\0\0"..., 512) = 512
fstat64(3, {st_mode=S_IFREG|0755, st_size=1327556, ...}) = 0
mmap2(NULL, 1337704, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb7677000
mprotect(0xb77b7000, 4096, PROT_NONE)   = 0
mmap2(0xb77b8000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x140) = 0xb77b8000
mmap2(0xb77bb000, 10600, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xb77bb000
close(3)                                = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7676000
set_thread_area({entry_number:-1 -&gt; 6, base_addr:0xb76768d0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1}) = 0
mprotect(0xb77b8000, 8192, PROT_READ)   = 0
mprotect(0xb77ef000, 4096, PROT_READ)   = 0
munmap(0xb77be000, 76406)               = 0
brk(0)                                  = 0x9445000
brk(0x9466000)                          = 0x9466000
open("/usr/lib/locale/locale-archive", O_RDONLY|O_LARGEFILE) = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=1527680, ...}) = 0
mmap2(NULL, 1527680, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb7501000
close(3)                                = 0
chroot("/tmp/rear.qPmcLixJUznp1E7")     = 0
chdir("/")                              = 0
execve("/bin/bash", ["/bin/bash"], [/* 16 vars */]) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/locale.alias", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de_DE.UTF-8/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de_DE.utf8/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de_DE/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de.UTF-8/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de.utf8/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de/LC_MESSAGES/coreutils.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
write(2, "chroot: ", 8chroot: )                 = 8
write(2, "failed to run command `/bin/bash"..., 33failed to run command `/bin/bash') = 33
open("/usr/share/locale/de_DE.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de_DE.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de_DE/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/de/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
write(2, ": No such file or directory", 27: No such file or directory) = 27
write(2, "\n", 1
)                       = 1
close(1)                                = 0
close(2)                                = 0
exit_group(127)                         = ?
</code></pre>
<p>Can help this?</p>
<h4 id="jhoekx_commented_at_2012-09-02_1516"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8222813">2012-09-02 15:16</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-02_1516" title="Permanent link">&para;</a></h4>
<p>I did only test with 64 bit debian. Tested it again right now and that
works. I will install a 32 bit version.</p>
<h4 id="jhoekx_commented_at_2012-09-02_1600"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8223214">2012-09-02 16:00</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-02_1600" title="Permanent link">&para;</a></h4>
<p>So I tested in debian 6.0.5 i386 and everything worked great.</p>
<p>Can you check that there are no files from a previous Relax-and-Recover
installation present?</p>
<p>Otherwise, please show <code>ls -l /</code>.</p>
<p>Mine looks like:</p>
<pre><code>root@debianrear32:~# ls -l /
total 128
drwxr-xr-x  2 root   root    4096 Sep  2 17:41 bin
drwxr-xr-x  3 root   root    4096 Sep  2 17:42 boot
drwxr-xr-x 14 root   root    2940 Sep  2 17:54 dev
drwxr-xr-x 67 root   root    4096 Sep  2 17:54 etc
drwxr-xr-x  3 root   root    4096 Sep  2 17:43 home
lrwxrwxrwx  1 root   root      28 Sep  2 17:52 initrd.img -&gt; boot/initrd.img-2.6.32-5-686
drwxr-xr-x 12 root   root    4096 Sep  2 17:47 lib
drwx------  2 root   root   16384 Sep  2 17:27 lost+found
drwxr-xr-x  3 root   root    4096 Sep  2 17:27 media
drwxr-xr-x  2 root   root    4096 May  7 16:55 mnt
drwxr-xr-x  2 root   root    4096 Sep  2 17:28 opt
dr-xr-xr-x 69 root   root       0 Sep  2 17:54 proc
drwx------  4 root   root    4096 Sep  2 17:52 root
drwxr-xr-x  2 root   root    4096 Sep  2 17:47 sbin
drwxr-xr-x  2 root   root    4096 Jul 21  2010 selinux
drwxr-xr-x  2 root   root    4096 Sep  2 17:28 srv
drwxr-xr-x 12 root   root       0 Sep  2 17:54 sys
drwxrwxrwt  2 root   root    4096 Sep  2 17:54 tmp
drwxr-xr-x 10 root   root    4096 Sep  2 17:28 usr
drwxr-xr-x 13 root   root    4096 Sep  2 17:28 var
lrwxrwxrwx  1 root   root      25 Sep  2 17:52 vmlinuz -&gt; boot/vmlinuz-2.6.32-5-686
</code></pre>
<p>And <code>ldd /bin/bash</code>:</p>
<pre><code>root@debianrear32:~# ldd /bin/bash 
        linux-gate.so.1 =&gt;  (0xb7778000)
        libncurses.so.5 =&gt; /lib/libncurses.so.5 (0xb7738000)
        libdl.so.2 =&gt; /lib/i686/cmov/libdl.so.2 (0xb7734000)
        libc.so.6 =&gt; /lib/i686/cmov/libc.so.6 (0xb75ec000)
        /lib/ld-linux.so.2 (0xb7779000)
</code></pre>
<h4 id="schoekek_commented_at_2012-09-02_1630"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8223438">2012-09-02 16:30</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-02_1630" title="Permanent link">&para;</a></h4>
<p>I search for old file at any time...<br />
All old files was deleted.</p>
<pre><code>legolas:~# ldd /bin/bash
        linux-gate.so.1 =&gt;  (0xb778d000)
        libncurses.so.5 =&gt; /lib/libncurses.so.5 (0xb773e000)
        libdl.so.2 =&gt; /lib/i686/cmov/libdl.so.2 (0xb773a000)
        libc.so.6 =&gt; /lib/i686/cmov/libc.so.6 (0xb75f2000)
        /lib/ld-linux.so.2 (0xb778e000)
</code></pre>
<p>Mein Debian was updated from Etch to Lenny to Squeezy...</p>
<h4 id="schoekek_commented_at_2012-09-02_1634"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8223471">2012-09-02 16:34</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-02_1634" title="Permanent link">&para;</a></h4>
<p>sorry i press the Close button ;-(</p>
<h4 id="dagwieers_commented_at_2012-09-02_1957"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8225481">2012-09-02 19:57</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-02_1957" title="Permanent link">&para;</a></h4>
<p>Ok, I think we started off on the wrong foot because I gave you the
wrong command, it should have been:
<code>chroot /tmp/rear.WTjmuRD2dQETSQc/rootfs /bin/bash</code>.</p>
<h4 id="jhoekx_commented_at_2012-09-03_0637"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8230534">2012-09-03 06:37</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-03_0637" title="Permanent link">&para;</a></h4>
<p>Can you run <code>rear -D mkrescue</code> and copy the logfile in a gist. That will
allow us to figure out what happened that makes the chroot test fail.</p>
<h4 id="schoekek_commented_at_2012-09-03_1634"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8242630">2012-09-03 16:34</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-03_1634" title="Permanent link">&para;</a></h4>
<p>oh, no prblem, here ist the output of the command:</p>
<pre><code>legolas:~# chroot /tmp/rear.qPmcLixJUznp1E7/rootfs /bin/bash
chroot: failed to run command `/bin/bash': Permission denied
</code></pre>
<h4 id="schoekek_commented_at_2012-09-03_1652"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8242945">2012-09-03 16:52</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-03_1652" title="Permanent link">&para;</a></h4>
<p>and here is rear output:</p>
<pre><code>legolas:~# rear -dD mkbackup
Relax-and-Recover 1.13.0-git201208292128 / 2012-08-29
Using log file: /var/log/rear/rear-legolas.log
Creating disk layout
Creating root filesystem layout
TIP: To login as root via ssh you need to set up /root/.ssh/authorized_keys
Copying files and directories
Copying binaries and libraries
Copying kernel modules
ERROR: BUG BUG BUG!  ROOTFS_DIR '/tmp/rear.BoILxSWM3SFKL5R/rootfs' is broken, chroot bash test failed.
=== Issue report ===
Please report this unexpected issue at: https://github.com/rear/rear/issues
Also include the relevant bits from /var/log/rear/rear-legolas.log

HINT: If you can reproduce the issue, try using the -d or -D option !
====================
Aborting due to an error, check /var/log/rear/rear-legolas.log for details
You should also rm -Rf /tmp/rear.BoILxSWM3SFKL5R
Beendet
</code></pre>
<p>and the logfile /var/log/rear/rear-legolas.log
<a href="https://gist.github.com/3610710">https://gist.github.com/3610710</a></p>
<h4 id="gdha_commented_at_2012-09-04_0639"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8253805">2012-09-04 06:39</a>:<a class="headerlink" href="#gdha_commented_at_2012-09-04_0639" title="Permanent link">&para;</a></h4>
<p>what is the output of <code>ll /tmp/rear.qPmcLixJUznp1E7/rootfs/bin/bash</code> ?</p>
<h4 id="jhoekx_commented_at_2012-09-04_1146"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8260120">2012-09-04 11:46</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-04_1146" title="Permanent link">&para;</a></h4>
<p>Is your /tmp mounted noexec? <code>grep /tmp /proc/mounts</code></p>
<p>I can get the exact error message as you've got when I change my /tmp to
be noexec.</p>
<h4 id="schoekek_commented_at_2012-09-04_1536"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8267503">2012-09-04 15:36</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-04_1536" title="Permanent link">&para;</a></h4>
<p>Yes /tmp ist noexec mounted...<br />
this is for a long time</p>
<h4 id="dagwieers_commented_at_2012-09-04_1642"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8269987">2012-09-04 16:42</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-04_1642" title="Permanent link">&para;</a></h4>
<p>@lgbff Thanks for the clarification !<br />
@jhoekx Thanks for the detective work (or lucky guess ? :-)</p>
<p>Ok, so Relax-and-Recover expects <em>/tmp</em> to be <code>exec</code> mounted. How are we
going to handle this ?</p>
<ul>
<li>Check <em>/tmp</em> for <code>noexec</code>, halt and escalate problem ?</li>
<li>Do we use another location that is less likely to be <code>noexec</code> (e.g.
    /var/lib/rear) ?</li>
<li>Do we temporarily disable <code>noexec</code> by remounting and then go back to
    <code>exec</code> ?</li>
<li>Are there any other workarounds ? We do not actually need <code>exec</code>
    other than testing bash :-( The irony here is that it's not bash
    that is hurting us, but the test to see if it works correctly (which
    it probably will !)</li>
</ul>
<h4 id="schlomo_commented_at_2012-09-04_1646"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8270129">2012-09-04 16:46</a>:<a class="headerlink" href="#schlomo_commented_at_2012-09-04_1646" title="Permanent link">&para;</a></h4>
<p>Why not use /dev/shm?</p>
<p>/tmp is probably the worst possible location and pure "legacy"...</p>
<p>Or even better: Use /dev/shm by default and allow user to change the<br />
location.</p>
<h4 id="gdha_commented_at_2012-09-04_1651"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8270310">2012-09-04 16:51</a>:<a class="headerlink" href="#gdha_commented_at_2012-09-04_1651" title="Permanent link">&para;</a></h4>
<p>Or, if /tmp is noexec mounted skip the test (saying testing is not
possible)?</p>
<h4 id="schoekek_commented_at_2012-09-04_1704"><img src="https://avatars.githubusercontent.com/u/1560809?v=4" width="50"><a href="https://github.com/schoekek">schoekek</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8270744">2012-09-04 17:04</a>:<a class="headerlink" href="#schoekek_commented_at_2012-09-04_1704" title="Permanent link">&para;</a></h4>
<p>I remount /tmp without noexec option and rear run fine ;-)</p>
<p>(my /var is mounted noexec too)</p>
<h4 id="dagwieers_commented_at_2012-09-04_1845"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8274116">2012-09-04 18:45</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-04_1845" title="Permanent link">&para;</a></h4>
<p>@schlomo I don't like <em>/dev/shm</em> for this, I fear a risk of trashing the
system because we pressure memory too high. (default is 50%of RAM)</p>
<p>@gdha That's probably the best suggestion. Just alert the condition, in
99% of the cases there is no issue and it is up to the user (in this
case) to ensure the recovery process works as expected. Maybe we can
combine this together with a check for other possible location (before
giving up, disabling the check and alerting the user).</p>
<h4 id="jhoekx_commented_at_2012-09-05_0628"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8288868">2012-09-05 06:28</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-09-05_0628" title="Permanent link">&para;</a></h4>
<p>I found this by thinking how you could get a permission denied error
when running bash after you've written it.</p>
<p>Well, <code>/tmp</code> is also a tmpfs these days on non-enterprise systems, so
memory pressure is not really an argument.</p>
<p>I think a combination of making TMP_DIR configurable with a check and
warning if /tmp is mounted noexec would be the best solution for now.</p>
<h4 id="dagwieers_commented_at_2012-09-07_0902"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8359958">2012-09-07 09:02</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-07_0902" title="Permanent link">&para;</a></h4>
<p>I am closing this issue. Feel free to report if this feature can be
improved or fails to work in your case.</p>
<h4 id="dagwieers_commented_at_2012-09-09_1948"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8408468">2012-09-09 19:48</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-09_1948" title="Permanent link">&para;</a></h4>
<p>I am wondering about one thing with my implementation though. If
Relax-and-Recover is started in quiet mode (default) no warning messages
are shown. So in case you run rear via cron, it won't escalate this
warning. I can see cases where this is expected (i.e. the user tested it
himself thoroughly and wants to leave /tmp noexec) but also cases where
it is not (i.e. user is unaware due to this and might be at risk).</p>
<p>Not sure what is best, the logfile does have the warning so if the user
checked the logfile for warnings or errors, he should have known. But
you know how <em>ignorant</em> users can be ;-))</p>
<h4 id="schlomo_commented_at_2012-09-09_2005"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8408660">2012-09-09 20:05</a>:<a class="headerlink" href="#schlomo_commented_at_2012-09-09_2005" title="Permanent link">&para;</a></h4>
<p>IMHO this should be a fatal error. Let the user give ReaR another work
dir<br />
where it can do the chroot test. IMHO this test is very important to
ensure<br />
that the resulting initrd has a chance to function.</p>
<p>Who knows. Maybe a users changes /tmp to noexec long time after setting
up<br />
ReaR?</p>
<h4 id="dagwieers_commented_at_2012-09-09_2017"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-8408815">2012-09-09 20:17</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-09_2017" title="Permanent link">&para;</a></h4>
<p>@schlomo Maybe we can change it to a fatal error once we have issue
#157 solved. I am open to that.</p>
<h4 id="kollyma_commented_at_2019-04-17_1319"><img src="https://avatars.githubusercontent.com/u/6848449?u=3506255ae83e4276c0b5299cae9e8fd7f6cd0d64&v=4" width="50"><a href="https://github.com/kollyma">kollyma</a> commented at <a href="https://github.com/rear/rear/issues/150#issuecomment-484086259">2019-04-17 13:19</a>:<a class="headerlink" href="#kollyma_commented_at_2019-04-17_1319" title="Permanent link">&para;</a></h4>
<p>We are facing the same issue, because /tmp mouted with noexec
permissions:</p>
<pre><code>ERROR: Cannot test if the ReaR recovery system is usable because /tmp is mounted 'noexec'
Aborting due to an error, check /var/log/rear/rear-serverxy.log for details
</code></pre>
<p>set the TMDIR variable to fix the issue:</p>
<pre><code>export TMPDIR='/var/tmp/' ; /usr/sbin/rear mkbackup
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2012-09-01.150.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
