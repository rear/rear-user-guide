<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2768 PR merged: Fixed the RAID10 layout support code - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2768 PR merged: Fixed the RAID10 layout support code";
        var mkdocs_page_input_path = "issues/2022-03-08.2768.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2768 PR merged: Fixed the RAID10 layout support code</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2768_pr_merged_fixed_the_raid10_layout_support_code"><a href="https://github.com/rear/rear/pull/2768">#2768 PR</a> <code>merged</code>: Fixed the RAID10 layout support code<a class="headerlink" href="#2768_pr_merged_fixed_the_raid10_layout_support_code" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2022-03-08_1503"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/2768">2022-03-08 15:03</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2022-03-08_1503" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/commit/4dbbb288057189076d82cb8e477cd994a4ce1851">https://github.com/rear/rear/commit/4dbbb288057189076d82cb8e477cd994a4ce1851</a><br />
<a href="https://github.com/rear/rear/issues/1040#issuecomment-1034870262">https://github.com/rear/rear/issues/1040#issuecomment-1034870262</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Not at all tested - I don't have a RAID10 test system right now</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>In layout/save/GNU/Linux/210_raid_layout.sh<br />
fixed the RAID10 layout support code as far as possible for now.<br />
Currently only 'near=...' support is (and was) implemented initially
via<br />
<a href="https://github.com/rear/rear/commit/4dbbb288057189076d82cb8e477cd994a4ce1851">https://github.com/rear/rear/commit/4dbbb288057189076d82cb8e477cd994a4ce1851</a></p>
<p>This fix was triggered by ShellCheck<br />
SC2034: param appears unused. Verify use (or export if used
externally)<br />
<a href="https://github.com/koalaman/shellcheck/wiki/SC2034">https://github.com/koalaman/shellcheck/wiki/SC2034</a><br />
SC2066: Since you double quoted this, it will not word split, and the
loop will only run once<br />
<a href="https://github.com/koalaman/shellcheck/wiki/SC2066">https://github.com/koalaman/shellcheck/wiki/SC2066</a><br />
cf.
<a href="https://github.com/rear/rear/issues/1040#issuecomment-1034870262">https://github.com/rear/rear/issues/1040#issuecomment-1034870262</a></p>
<h4 id="jsmeix_commented_at_2022-03-14_1356"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1066824706">2022-03-14 13:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-14_1356" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
I cannot really test it because I don't have a RAID10 test system right
now.<br />
I only did some checks with the new code commands on command line.<br />
So I would appreciate if someone could at least have a look.<br />
Perhaps you see something obviously wrong.</p>
<h4 id="pcahyna_commented_at_2022-03-14_1409"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1066839330">2022-03-14 14:09</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-14_1409" title="Permanent link">&para;</a></h4>
<p>@jsmeix I think I will be able to get a RAID10 system for tests, stay
tuned please...</p>
<h4 id="jsmeix_commented_at_2022-03-16_1148"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1069040509">2022-03-16 11:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-16_1148" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
a question regarding your (very much appreciated!) RAID testing:<br />
Because I have also<br />
<a href="https://github.com/rear/rear/issues/2759">https://github.com/rear/rear/issues/2759</a><br />
<code>Rename disklayout.conf keyword 'raid' into 'raidarray'</code><br />
on my todo list<br />
I would like to ask you if I should implement that right now<br />
so you could (by the way) also test that<br />
or if you prefer that I implement that later<br />
so we do not mix up two different things?</p>
<h4 id="pcahyna_commented_at_2022-03-16_1414"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1069177118">2022-03-16 14:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-16_1414" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
here is disklayout generated by <code>rear savelayout</code> from ReaR 2.6 release.</p>
<pre><code># Disk layout dated 20220314131456 (YYYYmmddHHMMSS)
# NAME                                       KNAME      PKNAME    TRAN TYPE   FSTYPE            SIZE MOUNTPOINT
# /dev/vda                                   /dev/vda                  disk                      10G 
# |-/dev/vda1                                /dev/vda1  /dev/vda       part   xfs                 1G /boot
# `-/dev/vda2                                /dev/vda2  /dev/vda       part   LVM2_member         9G 
#   |-/dev/mapper/rhel_kvm--08--guest16-root /dev/dm-0  /dev/vda2      lvm    xfs                 8G /
#   `-/dev/mapper/rhel_kvm--08--guest16-swap /dev/dm-1  /dev/vda2      lvm    swap                1G [SWAP]
# /dev/vdb                                   /dev/vdb                  disk                      10G 
# `-/dev/vdb1                                /dev/vdb1  /dev/vdb       part   linux_raid_member  10G 
#   `-/dev/md127                             /dev/md127 /dev/vdb1      raid10 xfs                20G /home
# /dev/vdc                                   /dev/vdc                  disk                      10G 
# `-/dev/vdc1                                /dev/vdc1  /dev/vdc       part   linux_raid_member  10G 
#   `-/dev/md127                             /dev/md127 /dev/vdc1      raid10 xfs                20G /home
# /dev/vdd                                   /dev/vdd                  disk                      10G 
# `-/dev/vdd1                                /dev/vdd1  /dev/vdd       part   linux_raid_member  10G 
#   `-/dev/md127                             /dev/md127 /dev/vdd1      raid10 xfs                20G /home
# /dev/vde                                   /dev/vde                  disk                      10G 
# `-/dev/vde1                                /dev/vde1  /dev/vde       part   linux_raid_member  10G 
#   `-/dev/md127                             /dev/md127 /dev/vde1      raid10 xfs                20G /home
# /dev/vdf                                   /dev/vdf                  disk                      10G 
# Disk /dev/vda
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vda 10737418240 msdos
# Partitions on /dev/vda
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vda 1073741824 1048576 primary boot /dev/vda1
part /dev/vda 9662627840 1074790400 primary lvm /dev/vda2
# Disk /dev/vdb
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vdb 10737418240 msdos
# Partitions on /dev/vdb
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vdb 10736369664 1048576 primary none /dev/vdb1
# Disk /dev/vdc
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vdc 10737418240 msdos
# Partitions on /dev/vdc
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vdc 10736369664 1048576 primary none /dev/vdc1
# Disk /dev/vdd
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vdd 10737418240 msdos
# Partitions on /dev/vdd
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vdd 10736369664 1048576 primary none /dev/vdd1
# Disk /dev/vde
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vde 10737418240 msdos
# Partitions on /dev/vde
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vde 10736369664 1048576 primary none /dev/vde1
# Disk /dev/vdf
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
#disk /dev/vdf 10737418240 unknown
# Partitions on /dev/vdf
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
raid /dev/md127 metadata=1.2 level=raid10 raid-devices=4 uuid=ed2fc124:cb694549:a8802ad3:11da529b name=127_0 layout=n2 chunk=512 devices=/dev/vde1,/dev/vdb1,/dev/vdc1,/dev/vdd1
# Format for LVM PVs
# lvmdev &lt;volume_group&gt; &lt;device&gt; [&lt;uuid&gt;] [&lt;size(bytes)&gt;]
lvmdev /dev/rhel_kvm-08-guest16 /dev/vda2 OntpJo-QT6x-9lwd-dcAA-hzLe-X0IU-FiudhS 18872320
# Format for LVM VGs
# lvmgrp &lt;volume_group&gt; &lt;extentsize&gt; [&lt;size(extents)&gt;] [&lt;size(bytes)&gt;]
lvmgrp /dev/rhel_kvm-08-guest16 4096 2303 9433088
# Format for LVM LVs
# lvmvol &lt;volume_group&gt; &lt;name&gt; &lt;size(bytes)&gt; &lt;layout&gt; [key:value ...]
lvmvol /dev/rhel_kvm-08-guest16 root 8585740288b linear 
lvmvol /dev/rhel_kvm-08-guest16 swap 1073741824b linear 
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/mapper/rhel_kvm--08--guest16-root / xfs uuid=822a6936-2a38-4e28-9707-7bed38d1e3d8 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
fs /dev/md127 /home xfs uuid=1f0561d9-eecc-4d0f-87ee-4dc8bf2ccaa5 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=1024,swidth=2048,noquota
fs /dev/vda1 /boot xfs uuid=8dcc2dcb-66a9-4317-b47a-92aae301be09 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/mapper/rhel_kvm--08--guest16-swap uuid=33452b6f-eaf6-4fbc-995c-543f6dee49f2 label=
</code></pre>
<p>I will try your patched version as well and compare the output. I don't
see anything obviously wrong that needs fixing, though, do you?</p>
<h4 id="jsmeix_commented_at_2022-03-17_0941"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1070654128">2022-03-17 09:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-17_0941" title="Permanent link">&para;</a></h4>
<p>Only from looking at the old code I think</p>
<pre><code>raid ... level=raid10 ... layout=n2 ...
</code></pre>
<p>is supported with the old code<br />
and should be (hopefully) still work with my new code<br />
which is all what this pull request is about at least for now.</p>
<p>According to "man mdadm" (at least for mdadm v4.1 in openSUSE Leap
15.3)<br />
<code>layout=n2</code> is the default for RAID10 ("man mdadm" excerpts):</p>
<pre><code>-p, --layout=
...
The layout options for RAID10 are one of 'n', 'o' or 'f'
followed by a small number.
The default is 'n2'.
The supported options are:
'n' signals 'near' copies...
'o' signals 'offset' copies...
'f' signals 'far' copies...
See md(4) for more detail about 'near', 'offset', and 'far'.
</code></pre>
<p>So a real test would be a RAID10 layout that is not <code>n2</code>.</p>
<p>But I think (again: only from looking at the old code)<br />
that something like</p>
<pre><code>raid ... level=raid10 ... layout=f2 ...
</code></pre>
<p>is not supported with the old code<br />
and is still not (yet) supported with my new code<br />
i.e.<br />
I think when the "Layout :" line in the detailed mdadm output looks like</p>
<pre><code>          Layout : near=2
</code></pre>
<p>it is supported but when it looks like</p>
<pre><code>          Layout : near=2, far=2
</code></pre>
<p>or</p>
<pre><code>          Layout : near=2, far=1
</code></pre>
<p>the <code>far</code> part is not supported.</p>
<p>I am wondering if it is possible to set up a RAID10 array<br />
so that the "Layout :" line in the detailed mdadm output looks like</p>
<pre><code>          Layout : far=2
</code></pre>
<p>i.e. without a <code>near</code> value.<br />
This would be also not supported (from plain looking at the code).</p>
<p>What seems to be also not supported (from plain looking at the code)
is<br />
when the "Layout :" line in the detailed mdadm output looks like</p>
<pre><code>          Layout : near=1
</code></pre>
<p>see my <code>TODO</code> comment in my new code.</p>
<p>What is also not supported is a RAID10 layout with 'offset' copies<br />
i.e. what is set with something like <code>mdadm ... --layout=o2</code>.</p>
<p>Perhaps some of the not supported cases can be ignored<br />
because they cannot appear in practice or are plain wrong<br />
but for wrong setups ReaR should at least report to the user<br />
that such a setup is not supported when ReaR detects it.</p>
<p>But I think some support is likely still missing for RAID10 layout<br />
and if missing support can be easily added I would like to add it<br />
via this pull requests or via a separated subsequent pull request.</p>
<h4 id="pcahyna_commented_at_2022-03-18_1030"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072278733">2022-03-18 10:30</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-18_1030" title="Permanent link">&para;</a></h4>
<blockquote>
<p>So a real test would be a RAID10 layout that is not <code>n2</code>.</p>
</blockquote>
<p>I have done many such tests and recorded the results</p>
<blockquote>
<p>But I think (again: only from looking at the old code) that something
like</p>
<pre><code>raid ... level=raid10 ... layout=f2 ...
</code></pre>
<p>is not supported with the old code and is still not (yet) supported
with my new code i.e. I think when the "Layout :" line in the detailed
mdadm output looks like</p>
<pre><code>          Layout : near=2
</code></pre>
<p>it is supported but when it looks like</p>
<pre><code>          Layout : near=2, far=2
</code></pre>
<p>or</p>
<pre><code>          Layout : near=2, far=1
</code></pre>
<p>the <code>far</code> part is not supported.</p>
</blockquote>
<p>I have never been able to get in a situation where <code>mdadm</code> prints this,
though. I have tried RHEL 6.10, 7.9, 8.5. According to the replies to
the (quite old) stackexchange post, this had not been printed anymore
for some time before the post was written, so I suspect it referred to
some very old mdadm version. And apparently it is not possible to create
an array with both "near" and "far" copies either, except by editing the
disk metadata by hand. So, I was not able to test this case.</p>
<blockquote>
<p>I am wondering if it is possible to set up a RAID10 array so that the
"Layout :" line in the detailed mdadm output looks like</p>
<pre><code>          Layout : far=2
</code></pre>
<p>i.e. without a <code>near</code> value. This would be also not supported (from
plain looking at the code).</p>
</blockquote>
<p>Yes, that's actually the only thing I was able to get mdadm to print
when using the "far" layout, so it is very common. And, surprisingly,
ReaR (version 2.6) saves and recreates this just fine.</p>
<blockquote>
<p>What seems to be also not supported (from plain looking at the code)
is when the "Layout :" line in the detailed mdadm output looks like</p>
<pre><code>          Layout : near=1
</code></pre>
<p>see my <code>TODO</code> comment in my new code.</p>
</blockquote>
<p>I was not able to get mdadm to create this, so I was not able to test
it:</p>
<pre><code># mdadm --create --verbose /dev/md127 --level=raid10 --layout=n1 --raid-devices=4 /dev/vde1 /dev/vdf1 /dev/vdc1 /dev/vdd1
mdadm: Defaulting to version 1.2 metadata
mdadm: RUN_ARRAY failed: Invalid argument
</code></pre>
<blockquote>
<p>What is also not supported is a RAID10 layout with 'offset' copies
i.e. what is set with something like <code>mdadm ... --layout=o2</code>.</p>
</blockquote>
<p>That works for me, just as with the f2 layout. (ReaR 2.6, again.) I
tested full backup and recovery and examined the storage layout after.</p>
<blockquote>
<p>Perhaps some of the not supported cases can be ignored because they
cannot appear in practice or are plain wrong but for wrong setups ReaR
should at least report to the user that such a setup is not supported
when ReaR detects it.</p>
</blockquote>
<p>The challenge is to create such setups for testing. To summarize, I was
not able to find a single setup that could be realistically created and
posed a problem for ReaR (version 2.6)</p>
<p>I have detailed information saved from these ReaR and mdadm runs in
various situations and can provide details if you want.</p>
<blockquote>
<p>But I think some support is likely still missing for RAID10 layout and
if missing support can be easily added I would like to add it via this
pull requests or via a separated subsequent pull request.</p>
</blockquote>
<p>If we find some unsupported setups, sure. Can you perhaps try some old
versions of SLES to see whether they allow creation of "less standard"
layouts? (Perhaps with loop devices.)</p>
<h4 id="jsmeix_commented_at_2022-03-18_1135"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072326881">2022-03-18 11:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1135" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for your tests.<br />
Off the top of my head I think I have now an idea how the old code
worked.<br />
My new code does no longer support the "far" layout and/or the "offset"
layout.<br />
I will right now enhance my code...</p>
<h4 id="jsmeix_commented_at_2022-03-18_1146"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072334027">2022-03-18 11:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1146" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
could you please post here the detailed mdadm output<br />
for a "far" layout and for an "offset" layout<br />
and the matching "raid" entry in disklayout.conf</p>
<p>Is it possible to combine any of "near" "far" and "offset" layouts?<br />
It seems "near" and "far" exclude each other.<br />
But what about "near" plus "offset" or "far" plus "offset"?<br />
Do the latter also exclude each other?</p>
<h4 id="pcahyna_commented_at_2022-03-18_1223"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072361069">2022-03-18 12:23</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-18_1223" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna could you please post here the detailed mdadm output for a
"far" layout and for an "offset" layout and the matching "raid" entry
in disklayout.conf</p>
</blockquote>
<pre><code>/dev/md127:
           Version : 1.2
     Creation Time : Thu Mar 17 08:20:43 2022
        Raid Level : raid10
        Array Size : 20951040 (19.98 GiB 21.45 GB)
     Used Dev Size : 10475520 (9.99 GiB 10.73 GB)
      Raid Devices : 4
     Total Devices : 4
       Persistence : Superblock is persistent

       Update Time : Thu Mar 17 12:24:29 2022
             State : clean 
    Active Devices : 4
   Working Devices : 4
    Failed Devices : 0
     Spare Devices : 0

            Layout : offset=2
        Chunk Size : 512K

Consistency Policy : resync

              Name : kvm-08-guest23:127
              UUID : 62a70b90:01229daa:37bbf5de:40646c97
            Events : 29

    Number   Major   Minor   RaidDevice State
       0     252       65        0      active sync   /dev/vde1
       1     252       81        1      active sync   /dev/vdf1
       2     252       33        2      active sync   /dev/vdc1
       3     252       49        3      active sync   /dev/vdd1

raid /dev/md127 metadata=1.2 level=raid10 raid-devices=4 uuid=62a70b90:01229daa:37bbf5de:40646c97 layout=o2 chunk=512 devices=/dev/vde1,/dev/vdf1,/dev/vdc1,/dev/vdd1
</code></pre>
<blockquote>
<p>Is it possible to combine any of "near" "far" and "offset" layouts? It
seems "near" and "far" exclude each other. But what about "near" plus
"offset" or "far" plus "offset"? Do the latter also exclude each
other?</p>
</blockquote>
<p>I don't know - what would be the mdadm command to create them?</p>
<h4 id="pcahyna_commented_at_2022-03-18_1225"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072362485">2022-03-18 12:25</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-18_1225" title="Permanent link">&para;</a></h4>
<p>far layout:</p>
<pre><code>/dev/md127:
           Version : 1.2
     Creation Time : Thu Mar 17 08:19:29 2022
        Raid Level : raid10
        Array Size : 20951040 (19.98 GiB 21.45 GB)
     Used Dev Size : 10475520 (9.99 GiB 10.73 GB)
      Raid Devices : 4
     Total Devices : 4
       Persistence : Superblock is persistent

       Update Time : Thu Mar 17 12:23:01 2022
             State : clean 
    Active Devices : 4
   Working Devices : 4
    Failed Devices : 0
     Spare Devices : 0

            Layout : far=2
        Chunk Size : 512K

Consistency Policy : resync

              Name : kvm-08-guest22:127
              UUID : 4a723d0e:7e4e5c5e:a07ac57c:d33fd39e
            Events : 32

    Number   Major   Minor   RaidDevice State
       0     252       65        0      active sync   /dev/vde1
       1     252       81        1      active sync   /dev/vdf1
       2     252       33        2      active sync   /dev/vdc1
       3     252       49        3      active sync   /dev/vdd1

raid /dev/md127 metadata=1.2 level=raid10 raid-devices=4 uuid=4a723d0e:7e4e5c5e:a07ac57c:d33fd39e layout=f2 chunk=512 devices=/dev/vde1,/dev/vdf1,/dev/vdc1,/dev/vdd1
</code></pre>
<h4 id="jsmeix_commented_at_2022-03-18_1300"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072387116">2022-03-18 13:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1300" title="Permanent link">&para;</a></h4>
<p>I did not test my recent commit here<br />
<a href="https://github.com/rear/rear/pull/2768/commits/55e38dc76df7c1d8e145fd530465ddd8b71cdd73">https://github.com/rear/rear/pull/2768/commits/55e38dc76df7c1d8e145fd530465ddd8b71cdd73</a><br />
This is something for next week - as time permits.</p>
<p>But now I do at least understand what the code should do<br />
so I could now even fix things in that code.</p>
<h4 id="jsmeix_commented_at_2022-03-18_1311"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072396568">2022-03-18 13:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1311" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
if you think my current code is needlessly overcomplicated<br />
because it tries to somehow deal even with things like</p>
<pre><code>          Layout : near=2, far=3
</code></pre>
<p>or</p>
<pre><code>          Layout : near=2, far=3, offset=4
</code></pre>
<p>I could simplify it so that it only works for (mutually exclusive)
things like</p>
<pre><code>          Layout : near=2
          Layout : far=3
          Layout : offset=4
</code></pre>
<p>and only leave a comment in the code that explains it.</p>
<h4 id="pcahyna_commented_at_2022-03-18_1329"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072411420">2022-03-18 13:29</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-18_1329" title="Permanent link">&para;</a></h4>
<p>I am not sure. It appears that a long time ago it used to be possible to
create such arrays, so someone might have an old array still in
operation. We need to find a reproducer.</p>
<h4 id="jsmeix_commented_at_2022-03-18_1341"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072422979">2022-03-18 13:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1341" title="Permanent link">&para;</a></h4>
<p>By the way FYI:</p>
<p>Regarding code that tinkers with IFS like</p>
<pre><code>OIFS=$IFS
IFS=","
for layout_option in $layout ; do
    ...
done
IFS=$OIFS
</code></pre>
<p>Somehow I do not like tinkering with IFS.</p>
<p>Here in particular not because IFS is changed in the whole <code>for</code> loop
body</p>
<pre><code># ( IFS="," ; for w in word ; do echo $w ; echo -n "$IFS" | od -a ; done )
word
0000000   ,
0000001
</code></pre>
<p>and when the <code>for</code> loop body is longer things can easily go wrong<br />
in particular when commands or functions are called in the <code>for</code> loop
body<br />
that assume the normal IFS is set.</p>
<p>Recently I learned about code like</p>
<pre><code>while IFS="..." read a b c ; do ... ; done
</code></pre>
<p>which is much cleaner<br />
because IFS is only changed for the read command<br />
so one does not have to save and restore IFS.</p>
<p>But this cannot work for the <code>for</code> command in bash<br />
because "man bash" reads (excerpts)</p>
<pre><code>       for name [ [ in [ word ... ] ] ; ] do list ; done
...
       for (( expr1 ; expr2 ; expr3 )) ; do list ; done
...
       while list-1; do list-2; done
</code></pre>
<p>so <code>for</code> does not run a command list but only expands words.</p>
<p>This means <code>for</code> loops with changed IFS<br />
need to be converted into <code>while</code> loops with changed IFS<br />
for example like</p>
<pre><code># string="foo,bar,baz"

# unset A B C

# while IFS="," read a b c ; do A=$a ; B=$b ; C=$c ; echo $A $B $C ; done &lt;&lt;&lt; "$string"
foo bar baz

# echo $A $B $C
foo bar baz
</code></pre>
<p>or for better readability (easier to see what 'read' gets as input)<br />
but with "useless use of echo" and a pipe</p>
<pre><code># string="foo,bar,baz"

# unset A B C

# echo "$string" | while IFS="," read a b c ; do A=$a ; B=$b ; C=$c ; echo $A $B $C ; done
foo bar baz

# echo $A $B $C
[no output]
</code></pre>
<p>But the drawback of using a pipe is that the "while read ... do ...
done" part<br />
is run as separated process (in a subshell) so that e.g. one cannot set
variables<br />
in the "while read ... do ... done" part that are meant to be used after
the pipe,<br />
cf. the "General explanation" in 220_lvm_layout.sh currently starting
at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh#L25">https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh#L25</a></p>
<h4 id="jsmeix_commented_at_2022-03-18_1403"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072442489">2022-03-18 14:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1403" title="Permanent link">&para;</a></h4>
<p>Regarding things like "Layout : near=2, far=3, offset=4":</p>
<p>I think the old code did not support it.<br />
I think the old code only suppoted mutually exclusive things like<br />
"Layout : near=2" XOR "Layout : far=3" XOR "Layout : offset=4"<br />
because I did some tests on command line with the old code<br />
and that made me falsely assume the old code did not support<br />
"Layout : far=3" XOR "Layout : offset=4"<br />
because I had tired out what the old code results for<br />
"Layout : near=2, far=3"<br />
where the "far=3" part was ignored - if I remember correctly.</p>
<p>So if the old code really only suppoted mutually exclusive things like<br />
"Layout : near=2" XOR "Layout : far=3" XOR "Layout : offset=4"<br />
and because we did not get any issue from a user that<br />
things like "Layout : near=2, far=3, offset=4" do not work<br />
I think we are safe to ignore multiple RAID10 layouts<br />
for one same RAID10 array.</p>
<p>Furthermore<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a><br />
shows (excerpt)</p>
<pre><code>ReaR-2.6 dropped official support for the following Linux based operating
systems:

  o Fedora &lt; 29
  o RHEL &lt; 6
  o CentOS &lt; 6
  o Scientific Linux &lt; 6
  o SLES &lt; 12
  o openSUSE Leap 42.x and before (i.e. openSUSE &lt;= 13)
  o openSUSE Tumbleweed
  o Debian &lt; 8
  o Ubuntu &lt; 16
</code></pre>
<p>and you wrote in your<br />
<a href="https://github.com/rear/rear/pull/2768#issuecomment-1072278733">https://github.com/rear/rear/pull/2768#issuecomment-1072278733</a><br />
"I have tried RHEL 6.10, 7.9, 8.5"<br />
so we should be rather safe when we silently ignore<br />
multiple RAID10 layouts for one same RAID10 array.</p>
<h4 id="jsmeix_commented_at_2022-03-18_1406"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1072444871">2022-03-18 14:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-18_1406" title="Permanent link">&para;</a></h4>
<p>But now there is weekend time - at least for me :-)</p>
<p>@pcahyna @rear/contributors<br />
I wish you a relaxed and recovering weekend!</p>
<h4 id="jsmeix_commented_at_2022-03-29_1232"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1081813738">2022-03-29 12:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-29_1232" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
do you think you find time to test my changes in this pull request?</p>
<h4 id="pcahyna_commented_at_2022-03-30_0842"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1082794747">2022-03-30 08:42</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-30_0842" title="Permanent link">&para;</a></h4>
<p>@jsmeix, sure. I was trying to find a system that allows to create some
of the more complicated layouts and got distracted by other things.</p>
<blockquote>
<p>I think we are safe to ignore multiple RAID10 layouts<br />
for one same RAID10 array.</p>
<p>ReaR-2.6 dropped official support for the following Linux based
operating<br />
systems:</p>
</blockquote>
<p>My worry is that one might have an old array created on a system version
that supported the unusual layouts, but still used on a system with
newer layouts. So I will still try some of the older, now unsupported
releases.</p>
<h4 id="pcahyna_commented_at_2022-04-04_0919"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1087316160">2022-04-04 09:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-04_0919" title="Permanent link">&para;</a></h4>
<p>@jsmeix I tested RHEL 5 and even there I was not able to recreate a
configuration that would print anything else than in newer versions
(i.e. it was not printing <code>near=2,far=1</code>, which was reported in the
Ubuntu forums 10 years ago, for example).<br />
I think the risk of encountering a "weird" configuration is therefore
minimal and so I will abandon further attempts of creating it and focus
on testing your changes in usual circumstances.</p>
<h4 id="pcahyna_commented_at_2022-04-05_1712"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1089066052">2022-04-05 17:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-05_1712" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix</p>
<p>your new code saves and recreates correctly a RAID created with</p>
<pre><code>mdadm --create --verbose /dev/md127 --level=raid10 --layout=o2 --raid-devices=4 /dev/vde1 /dev/vdf1 /dev/vdc1 /dev/vdd1
</code></pre>
<p>Here is the relevant part of disklayout.conf</p>
<pre><code># Software RAID devices (mdadm --detail --scan --config=partitions)
# ARRAY /dev/md127 metadata=1.2 name=127 UUID=cb09fcd3:99a70a82:cf98c4bf:027581fa
# Software RAID  device /dev/md127 (mdadm --misc --detail /dev/md127)
# /dev/md127:
#            Version : 1.2
#      Creation Time : Tue Apr  5 07:44:13 2022
#         Raid Level : raid10
#         Array Size : 20951040 (19.98 GiB 21.45 GB)
#      Used Dev Size : 10475520 (9.99 GiB 10.73 GB)
#       Raid Devices : 4
#      Total Devices : 4
#        Persistence : Superblock is persistent
#        Update Time : Tue Apr  5 07:46:02 2022
#              State : clean, resyncing 
#     Active Devices : 4
#    Working Devices : 4
#     Failed Devices : 0
#      Spare Devices : 0
#             Layout : offset=2
#         Chunk Size : 512K
# Consistency Policy : resync
#      Resync Status : 95% complete
#               Name : 127
#               UUID : cb09fcd3:99a70a82:cf98c4bf:027581fa
#             Events : 23
#     Number   Major   Minor   RaidDevice State
#        0     252       65        0      active sync   /dev/vde1
#        1     252       81        1      active sync   /dev/vdf1
#        2     252       33        2      active sync   /dev/vdc1
#        3     252       49        3      active sync   /dev/vdd1
# RAID device /dev/md127
# Format: raid /dev/&lt;kernel RAID device&gt; level=&lt;RAID level&gt; raid-devices=&lt;nr of active devices&gt; devices=&lt;component device1,component device2,...&gt; [name=&lt;array name&gt;] [metadata=&lt;metadata style&gt;] [uuid=&lt;UUID&gt;] [layout=&lt;data layout&gt;] [chunk=&lt;chunk size&gt;] [spare-devices=&lt;nr of spare devices&gt;] [size=&lt;container size&gt;]
raid /dev/md127 level=raid10 raid-devices=4 devices=/dev/vde1,/dev/vdf1,/dev/vdc1,/dev/vdd1 metadata=1.2 uuid=cb09fcd3:99a70a82:cf98c4bf:027581fa layout=o2 chunk=512
# RAID disk /dev/md127
# Format: raiddisk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
raiddisk /dev/md127 21453864960 loop
</code></pre>
<p>I can test other RAID10 layouts, and code without your change to see if
there is a difference in output.</p>
<h4 id="pcahyna_commented_at_2022-04-05_1805"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1089130867">2022-04-05 18:05</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-05_1805" title="Permanent link">&para;</a></h4>
<p>and here is the layout with the Git master version</p>
<pre><code># Software RAID devices (mdadm --detail --scan --config=partitions)
# ARRAY /dev/md127 metadata=1.2 name=127 UUID=71d25b13:d80ea84b:fab43358:73b78180
# Software RAID  device /dev/md127 (mdadm --misc --detail /dev/md127)
# /dev/md127:
#            Version : 1.2
#      Creation Time : Tue Apr  5 13:49:34 2022
#         Raid Level : raid10
#         Array Size : 20951040 (19.98 GiB 21.45 GB)
#      Used Dev Size : 10475520 (9.99 GiB 10.73 GB)
#       Raid Devices : 4
#      Total Devices : 4
#        Persistence : Superblock is persistent
#        Update Time : Tue Apr  5 13:51:09 2022
#              State : clean, resyncing 
#     Active Devices : 4
#    Working Devices : 4
#     Failed Devices : 0
#      Spare Devices : 0
#             Layout : offset=2
#         Chunk Size : 512K
# Consistency Policy : resync
#      Resync Status : 61% complete
#               Name : 127
#               UUID : 71d25b13:d80ea84b:fab43358:73b78180
#             Events : 17
#     Number   Major   Minor   RaidDevice State
#        0     252       65        0      active sync   /dev/vde1
#        1     252       81        1      active sync   /dev/vdf1
#        2     252       33        2      active sync   /dev/vdc1
#        3     252       49        3      active sync   /dev/vdd1
# RAID device /dev/md127
# Format: raid /dev/&lt;kernel RAID device&gt; level=&lt;RAID level&gt; raid-devices=&lt;nr of active devices&gt; devices=&lt;component device1,component device2,...&gt; [name=&lt;array name&gt;] [metadata=&lt;metadata style&gt;] [uuid=&lt;UUID&gt;] [layout=&lt;data layout&gt;] [chunk=&lt;chunk size&gt;] [spare-devices=&lt;nr of spare devices&gt;] [size=&lt;container size&gt;]
raid /dev/md127 level=raid10 raid-devices=4 devices=/dev/vde1,/dev/vdf1,/dev/vdc1,/dev/vdd1 metadata=1.2 uuid=71d25b13:d80ea84b:fab43358:73b78180 layout=o2 chunk=512
# RAID disk /dev/md127
# Format: raiddisk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
raiddisk /dev/md127 21453864960 loop
</code></pre>
<h4 id="pcahyna_commented_at_2022-04-06_0813"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1089975719">2022-04-06 08:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-06_0813" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix , do you want more tests with different layouts? So far, the
output of old and changed code has looked identical.</p>
<h4 id="jsmeix_commented_at_2022-04-06_0902"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1090029883">2022-04-06 09:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-06_0902" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for all your testing!<br />
I think you tested more than enough.</p>
<h4 id="jsmeix_commented_at_2022-04-06_0903"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1090030939">2022-04-06 09:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-06_0903" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
when there are no objections from you<br />
I would like to merge it tomorrow afternoon.</p>
<h4 id="pcahyna_commented_at_2022-04-06_0906"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1090033858">2022-04-06 09:06</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-06_0906" title="Permanent link">&para;</a></h4>
<p>@jsmeix I will have a look at the code changes, until now I have focused
on functional testing</p>
<h4 id="jsmeix_commented_at_2022-04-06_0908"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1090036393">2022-04-06 09:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-06_0908" title="Permanent link">&para;</a></h4>
<p>No longer a 'bug' but a 'cleanup' because the old code had<br />
somehow worked sufficiently for its intended use case, cf.<br />
<a href="https://github.com/rear/rear/pull/2768#issuecomment-1072278733">https://github.com/rear/rear/pull/2768#issuecomment-1072278733</a></p>
<h4 id="pcahyna_commented_at_2022-04-07_0933"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1091427456">2022-04-07 09:33</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-07_0933" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks, from what I have read it is better to avoid the <code>-a</code> and
<code>-o</code> test operators entirely.</p>
<h4 id="jsmeix_commented_at_2022-04-07_1004"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1091475081">2022-04-07 10:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-07_1004" title="Permanent link">&para;</a></h4>
<p>I agree one should avoid the <code>-a</code> and <code>-o</code> operators of <code>test</code> if
possible<br />
because those two operators have each duplicate meanings<br />
according to <code># help test</code> that reads (excerpts):</p>
<pre><code>      -a FILE        True if file exists.
...
      -o OPTION      True if the shell option OPTION is enabled.
...
      EXPR1 -a EXPR2 True if both expr1 AND expr2 are true.
      EXPR1 -o EXPR2 True if either expr1 OR expr2 is true.
</code></pre>
<p>Currently we have 67 code lines where <code>test</code> is used with <code>-a</code> or <code>-o</code>:</p>
<pre><code># find usr/sbin/rear usr/share/rear/ -type f | xargs grep 'test .* -[ao] ' | wc -l
67
</code></pre>
<p>(that lists also some false positives).</p>
<h4 id="jsmeix_commented_at_2022-04-07_1148"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2768#issuecomment-1091638786">2022-04-07 11:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-07_1148" title="Permanent link">&para;</a></h4>
<p>Only for completeness (because I mentioned it in the commit message)<br />
here the old code</p>
<pre><code>if test "$level" = "raid10" ; then
    OIFS=$IFS
    IFS=","
    for param in "$layout" ; do
        copies=${layout%=*}
        number=${layout#*=}
        test "$number" -gt 1 &amp;&amp; layout="${copies:0:1}$number"
    done
    IFS=$OIFS
fi
</code></pre>
<p>and what shellcheck reports</p>
<pre><code>for param in "$layout" ; do
^-^ SC2034: param appears unused. Verify use (or export if used externally).
             ^-------^ SC2066: Since you double quoted this, it will not word split, and the loop will only run once.
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-03-08.2768.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
