<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3170 Issue closed: Alma Linux 9.3 not able to install bootloader. - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3170 Issue closed: Alma Linux 9.3 not able to install bootloader.";
        var mkdocs_page_input_path = "issues/2024-02-29.3170.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3170 Issue closed: Alma Linux 9.3 not able to install bootloader.</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3170_issue_closed_alma_linux_93_not_able_to_install_bootloader"><a href="https://github.com/rear/rear/issues/3170">#3170 Issue</a> <code>closed</code>: Alma Linux 9.3 not able to install bootloader.<a class="headerlink" href="#3170_issue_closed_alma_linux_93_not_able_to_install_bootloader" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="rvdkraan_opened_issue_at_2024-02-29_1423"><img src="https://avatars.githubusercontent.com/u/46997988?u=8a7e4c8e33630d8d8e2f75c0c26e88b735e420b6&v=4" width="50"><a href="https://github.com/rvdkraan">rvdkraan</a> opened issue at <a href="https://github.com/rear/rear/issues/3170">2024-02-29 14:23</a>:<a class="headerlink" href="#rvdkraan_opened_issue_at_2024-02-29_1423" title="Permanent link">&para;</a></h4>
<p>When recovering using a usb key a warning is shown that the bootlaoder
could not be installed.<br />
no code for the os used to auto recover. Advising to manually install
the bootloader.</p>
<p>The OS was successfully recovered however without a bootloader the
system will not start.</p>
<pre><code>Begin dumping out configuration and system information:
 This is a 'Linux-x86_64' system, compatible with 'Linux-i386'.
 Configuration tree:
  Linux-i386.conf : OK
   GNU/Linux.conf : OK
   Fedora.conf : missing/empty
   Fedora/i386.conf : missing/empty
   Fedora/9.3.conf : missing/empty
   Fedora/9.3/i386.conf : missing/empty
   RedHatEnterpriseServer.conf : missing/empty
   RedHatEnterpriseServer/i386.conf : missing/empty
   RedHatEnterpriseServer/9.3.conf : missing/empty
   RedHatEnterpriseServer/9.3/i386.conf : missing/empty
   site.conf : OK
   local.conf : OK
 System definition:
  ARCH="Linux-i386"
  OS="GNU/Linux"
  OS_MASTER_VENDOR="Fedora"
  OS_MASTER_VERSION="9.3"
  OS_MASTER_VENDOR_ARCH="Fedora/i386"
  OS_MASTER_VENDOR_VERSION="Fedora/9.3"
  OS_MASTER_VENDOR_VERSION_ARCH="Fedora/9.3/i386"
  OS_VENDOR="RedHatEnterpriseServer"
  OS_VERSION="9.3"
  OS_VENDOR_ARCH="RedHatEnterpriseServer/i386"
  OS_VENDOR_VERSION="RedHatEnterpriseServer/9.3"
  OS_VENDOR_VERSION_ARCH="RedHatEnterpriseServer/9.3/i386"
# Backup with NETFS:
  NETFS_KEEP_OLD_BACKUP_COPY=""
  NETFS_PREFIX="hms-alma"
  NETFS_RESTORE_CAPABILITIES=("No")
  BACKUP_DUPLICITY_NAME="rear-backup"
  BACKUP_INTEGRITY_CHECK=""
  BACKUP_MOUNTCMD=""
  BACKUP_ONLY_EXCLUDE="no"
  BACKUP_ONLY_INCLUDE="no"
  BACKUP_OPTIONS=""
  BACKUP_RESTORE_MOVE_AWAY_DIRECTORY="/var/lib/rear/moved_away_after_backup_restore/"
  BACKUP_RESTORE_MOVE_AWAY_FILES=("/boot/grub/grubenv" "/boot/grub2/grubenv")
  BACKUP_RSYNC_OPTIONS=("--sparse" "--archive" "--hard-links" "--numeric-ids" "--stats")
  BACKUP_SELINUX_DISABLE="1"
  BACKUP_TYPE=""
  BACKUP_UMOUNTCMD=""
  BACKUP_URL="usb:///dev/disk/by-label/REAR-000"
# Backup program is 'tar':
  BACKUP_PROG_ARCHIVE="backup"
  BACKUP_PROG_COMPRESS_OPTIONS=("--gzip")
  BACKUP_PROG_COMPRESS_SUFFIX=".gz"
  BACKUP_PROG_CRYPT_ENABLED="false"
  BACKUP_PROG_CRYPT_KEY=""
  BACKUP_PROG_CRYPT_OPTIONS="/usr/bin/openssl des3 -salt -k "
  BACKUP_PROG_DECRYPT_OPTIONS="/usr/bin/openssl des3 -d -k "
  BACKUP_PROG_EXCLUDE=("/tmp/*" "/dev/shm/*" "/var/lib/rear/output/*" "/var/tmp/rear.p8MJE6hNidGJS4u")
  BACKUP_PROG_OPTIONS=("--anchored")
  BACKUP_PROG_OPTIONS_CREATE_ARCHIVE=""
  BACKUP_PROG_OPTIONS_RESTORE_ARCHIVE=""
  BACKUP_PROG_SUFFIX=".tar"
  BACKUP_PROG_WARN_PARTIAL_TRANSFER="1"
# Output to USB:
  USB_BIOS_BOOT_DEFAULT=""
  USB_BOOTLOADER=""
  USB_BOOT_PART_SIZE="0"
  USB_DEVICE=""
  USB_DEVICE_BOOT_LABEL="REARBOOT"
  USB_DEVICE_FILESYSTEM="ext3"
  USB_DEVICE_FILESYSTEM_LABEL="REAR-000"
  USB_DEVICE_FILESYSTEM_PARAMS=""
  USB_DEVICE_FILESYSTEM_PERCENTAGE="100"
  USB_DEVICE_PARTED_LABEL=""
  USB_PARTITION_ALIGN_BLOCK_SIZE="8"
  USB_RETAIN_BACKUP_NR="2"
  USB_SUFFIX=""
  USB_UEFI_PART_SIZE="1024"
  OUTPUT_EFISTUB_SYSTEMD_BOOTLOADER="/usr/lib/systemd/boot/efi/systemd-bootx64.efi"
  OUTPUT_LFTP_PASSWORD=""
  OUTPUT_LFTP_USERNAME=""
  OUTPUT_MOUNTCMD=""
  OUTPUT_OPTIONS=""
  OUTPUT_PREFIX="hms-alma"
  OUTPUT_PREFIX_PXE=""
  OUTPUT_UMOUNTCMD=""
  OUTPUT_URL=""
</code></pre>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.7 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME="AlmaLinux"
VERSION="9.3 (Shamrock Pampas Cat)"
ID="almalinux"
ID_LIKE="rhel centos fedora"
VERSION_ID="9.3"
PLATFORM_ID="platform:el9"
PRETTY_NAME="AlmaLinux 9.3 (Shamrock Pampas Cat)"
ANSI_COLOR="0;34"
LOGO="fedora-logo-icon"
CPE_NAME="cpe:/o:almalinux:almalinux:9::baseos"
HOME_URL="https://almalinux.org/"
DOCUMENTATION_URL="https://wiki.almalinux.org/"
BUG_REPORT_URL="https://bugs.almalinux.org/"

ALMALINUX_MANTISBT_PROJECT="AlmaLinux-9"
ALMALINUX_MANTISBT_PROJECT_VERSION="9.3"
REDHAT_SUPPORT_PRODUCT="AlmaLinux"
REDHAT_SUPPORT_PRODUCT_VERSION="9.3"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=USB
BACKUP=NETFS

BACKUP_URL="usb:///dev/disk/by-label/REAR-000"

USE_DHCLIENT=no
USE_STATIC_NETWORKING=y
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    Axiomsys</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    X86 64bit</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
</li>
</ul>
<!-- -->

<pre><code>BIOS Information
        Vendor: American Megatrends Inc.
        Version: 5.12
        Release Date: 04/20/2018
        Address: 0xF0000
        Runtime Size: 64 kB
        ROM Size: 16 MB
        Characteristics:
                PCI is supported
                BIOS is upgradeable
                BIOS shadowing is allowed
                Boot from CD is supported
                Selectable boot is supported
                BIOS ROM is socketed
                EDD is supported
                5.25"/1.2 MB floppy services are supported (int 13h)
                3.5"/720 kB floppy services are supported (int 13h)
                3.5"/2.88 MB floppy services are supported (int 13h)
                Print screen service is supported (int 5h)
                Serial services are supported (int 14h)
                Printer services are supported (int 17h)
                ACPI is supported
                USB legacy is supported
                BIOS boot specification is supported
                Targeted content distribution is supported
                UEFI is supported
        BIOS Revision: 5.12
</code></pre>
<ul>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    Dual SSD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                               KNAME     PKNAME    TRAN   TYPE FSTYPE      LABEL   SIZE MOUNTPOINT
/dev/sda                           /dev/sda            sata   disk                   119.2G
|-/dev/sda1                        /dev/sda1 /dev/sda         part vfat                600M /boot/efi
|-/dev/sda2                        /dev/sda2 /dev/sda         part xfs                   1G /boot
`-/dev/sda3                        /dev/sda3 /dev/sda         part LVM2_member       117.7G
  |-/dev/mapper/almalinux_hms-root /dev/dm-0 /dev/sda3        lvm  xfs                  70G /
  |-/dev/mapper/almalinux_hms-swap /dev/dm-1 /dev/sda3        lvm  swap                3.9G [SWAP]
  `-/dev/mapper/almalinux_hms-home /dev/dm-2 /dev/sda3        lvm  xfs                43.8G /home
/dev/sdb                           /dev/sdb            sata   disk                   111.8G
`-/dev/sdb1                        /dev/sdb1 /dev/sdb         part xfs               111.8G /database
</code></pre>
<h4 id="gdha_commented_at_2024-03-01_1428"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1973301491">2024-03-01 14:28</a>:<a class="headerlink" href="#gdha_commented_at_2024-03-01_1428" title="Permanent link">&para;</a></h4>
<p>@rvdkraan A debug log of a 'mkrescue' could be helpful.</p>
<h4 id="jsmeix_commented_at_2024-03-01_1435"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1973312486">2024-03-01 14:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-03-01_1435" title="Permanent link">&para;</a></h4>
<p>@rvdkraan<br />
plus a debug log of "rear -D recover", see in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
in the section<br />
"Debugging issues with Relax-and-Recover"<br />
both parts<br />
"To analyze and debug a 'rear mkrescue/mkbackup' failure<br />
the following information is mandatory"<br />
and<br />
"To analyze and debug a "rear recover" failure the<br />
following additional information is also mandatory"</p>
<p>In general:<br />
Caution with possible secrets in a full debug log file:<br />
When 'rear' is run via '-D' in debugscript mode<br />
it logs executed commands via the bash command 'set -x'<br />
that print commands and their arguments as they are executed<br />
so in particular when arguments contain secret values<br />
(e.g. something like a password or whatever else)<br />
such secret values may appear in the log file.<br />
Also secrets may be stored in some other files<br />
like /var/lib/rear/layout/disklayout.conf<br />
or /var/lib/rear/layout/diskrestore.sh<br />
cf. <code>[password=&lt;password&gt;]</code> in the section<br />
"Disk layout file syntax" in<br />
doc/user-guide/06-layout-configuration.adoc<br />
online at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc</a><br />
So before you attach your full debug log file and other files<br />
here (GitHub is a public accessible place) inspect your files<br />
and verify that they do not accidentally contain secrets.</p>
<h4 id="pcahyna_commented_at_2024-03-01_1501"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1973350469">2024-03-01 15:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-01_1501" title="Permanent link">&para;</a></h4>
<blockquote>
<p>When recovering using a usb key a warning is shown that the bootlaoder
could not be installed.<br />
no code for the os used to auto recover. Advising to manually install
the bootloader.</p>
</blockquote>
<p>It would be also helpful to provide the actual warning message and
information about the firmware used to boot (BIOS or UEFI? If UEFI, is
Secure Boot used?)</p>
<h4 id="rvdkraan_commented_at_2024-03-05_1030"><img src="https://avatars.githubusercontent.com/u/46997988?u=8a7e4c8e33630d8d8e2f75c0c26e88b735e420b6&v=4" width="50"><a href="https://github.com/rvdkraan">rvdkraan</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1978443990">2024-03-05 10:30</a>:<a class="headerlink" href="#rvdkraan_commented_at_2024-03-05_1030" title="Permanent link">&para;</a></h4>
<p>Hi @gdha @jsmeix @pcahyna</p>
<p>Thank you all for the feedback.<br />
It really helps to have an active community to help each other.</p>
<p>I have attached the log files.<br />
My disk is not encrypted. And did not find any secrets. If you do we
need to delete this post.</p>
<p><a href="https://github.com/rear/rear/files/14493832/rear-hms-alma.recover.log">rear-hms-alma
recover.log</a><br />
<a href="https://github.com/rear/rear/files/14493833/rear-log.mkrescue.log">rear-log
mkrescue.log</a><br />
<img alt="EFI
boot" src="https://github.com/rear/rear/assets/46997988/16d71c50-3166-4bdb-82d3-650423e318a3" /></p>
<p>U use the BIOS boot mode. EFI gives an warning.<br />
It is also a bit confusing that mkrescue finishes ok but the log file
shows a few errors.</p>
<p>warning in console about the bootloader:</p>
<p>WARNING:<br />
For this system<br />
RedHatEnterpriseServer/9.3 on Linux-i386 (based on Fedora/9.3/i386)<br />
there is no code to install a boot loader on the recovered system<br />
or the code that we have failed to install the boot loader correctly.<br />
Please contribute appropriate code to the Relax-and-Recover project,<br />
see
<a href="http://relax-and-recover.org/development/">http://relax-and-recover.org/development/</a><br />
Take a look at the scripts in /usr/share/rear/finalize - for example<br />
for PC architectures like x86 and x86_64 see the script<br />
/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh<br />
and for POWER architectures like ppc64le see the script<br />
/usr/share/rear/finalize/Linux-ppc64le/660_install_grub2.sh<br />
| IF YOU DO NOT INSTALL A BOOT LOADER MANUALLY, |<br />
| THEN YOUR SYSTEM WILL NOT BE ABLE TO BOOT. |<br />
You can use 'chroot /mnt/local bash --login'<br />
to change into the recovered system and<br />
manually install a boot loader therein.</p>
<p>TIA<br />
Ruben</p>
<h4 id="jsmeix_commented_at_2024-03-05_1348"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1978815190">2024-03-05 13:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-03-05_1348" title="Permanent link">&para;</a></h4>
<p>@rvdkraan</p>
<p>I am not a bootloader expert and<br />
I am even less an UEFI expert<br />
but I try as good as I can:</p>
<p>Fist some general info:</p>
<p>The primary user config variables<br />
that determine which kind of bootloader<br />
will be (re)installed during "rear recover" are<br />
BOOTLOADER<br />
USING_UEFI_BOOTLOADER<br />
UEFI_BOOTLOADER<br />
see their descriptions in usr/share/rear/conf/default.conf</p>
<p>When there are issues with installing the bootloader<br />
of the recreated system during "rear recover"<br />
it should help to specify the right values as needed<br />
for those config variables.</p>
<p>What does not work automatically or cannot work is<br />
when you boot via UEFI on the original system<br />
where "rear mkrescue/mkbackup" was run<br />
BUT<br />
you want to boot via BIOS on the replacement system<br />
where "rear recover" is run.</p>
<p>In general ReaR is meant to recreate a system<br />
as it was before.<br />
In particular ReaR is meant to recreate a system<br />
on fully compatible replacement hardware<br />
(also fully compatible replacement virtual hardware),<br />
see the section<br />
"Fully compatible replacement hardware is needed" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>It might work (but I did not test it)<br />
when you had UEFI on the original system<br />
but now use BIOS on the replacement system<br />
(provided you can boot the ReaR recovery system<br />
on the replacement system with BIOS)<br />
that you manually adapt user config variables<br />
in /etc/rear/local.conf and /etc/rear/rescue.conf<br />
and the var/lib/rear/recovery/bootloader value<br />
inside the booted ReaR recovery system<br />
before you run "rear recover".</p>
<p>Excerpts where I had a look at your log files:</p>
<p>Ecxerpts from your<br />
<a href="https://github.com/rear/rear/files/14493833/rear-log.mkrescue.log">https://github.com/rear/rear/files/14493833/rear-log.mkrescue.log</a></p>
<pre><code>+ source /usr/share/rear/prep/default/320_include_uefi_env.sh
...
++ DebugPrint 'Found EFI system partition /dev/sda1 on /boot/efi type vfat'
++ USING_UEFI_BOOTLOADER=1

+ source /usr/share/rear/layout/save/default/445_guess_bootloader.sh
...
++ Log 'No known bootloader matches the first bytes on /dev/sda'
...
++ Log 'No known bootloader matches the first bytes on /dev/sdb'
...
++ Log 'No known bootloader matches the first bytes on /dev/sdc'
...
++ Log 'GRUB 2 is installed (grub-probe or grub2-probe exist).'
...
++ echo GRUB2-EFI
</code></pre>
<p>so you have <code>GRUB2-EFI</code> in var/lib/rear/recovery/bootloader<br />
which looks right - as far as I see at first glance.</p>
<p>Then excerpts from your<br />
<a href="https://github.com/rear/rear/files/14493832/rear-hms-alma.recover.log">https://github.com/rear/rear/files/14493832/rear-hms-alma.recover.log</a></p>
<pre><code>+ source /etc/rear/rescue.conf
...
++ USING_UEFI_BOOTLOADER=1
++ UEFI_BOOTLOADER=/boot/efi/EFI/almalinux/grubx64.efi

+ source /usr/share/rear/finalize/Linux-i386/660_install_grub2.sh
...
++ '[' GRUB2 '!=' GRUB2-EFI ']'
++ return 0
</code></pre>
<p>so finalize/Linux-i386/660_install_grub2.sh does nothing<br />
and the subsequent script</p>
<pre><code>+ source /usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh
...
++ Log efibootmgr --create --gpt --disk /dev/sda --part 1 --write-signature --label '"RedHatEnterpriseServer' '9.3"' --loader '"\EFI\almalinux\grubx64.efi"'
2024-03-05 09:28:27.331724852 efibootmgr --create --gpt --disk /dev/sda --part 1 --write-signature --label "RedHatEnterpriseServer 9.3" --loader "\EFI\almalinux\grubx64.efi"
++ efibootmgr --create --gpt --disk /dev/sda --part 1 --write-signature --label 'RedHatEnterpriseServer 9.3' --loader '\EFI\almalinux\grubx64.efi'
EFI variables are not supported on this system.
++ LogPrintError 'efibootmgr failed to create EFI Boot Manager entry on /dev/sda partition 1 (ESP /dev/sda1 )'
</code></pre>
<p>failed because "EFI variables are not supported on this system"<br />
(I think this is because you use BIOS on the replacement system)<br />
so in the end no bootloader (neither for BIOS nor for UEFI)<br />
gets installed.</p>
<p>Because I am not a bootloader expert<br />
I may misunderstand things so my above analysis<br />
how things fail in this specific case could be just wrong.</p>
<h4 id="pcahyna_commented_at_2024-03-05_1423"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1978888236">2024-03-05 14:23</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-05_1423" title="Permanent link">&para;</a></h4>
<p>@rvdkraan</p>
<blockquote>
<p>U use the BIOS boot mode. EFI gives an warning.</p>
</blockquote>
<p>I suppose you mean "I use the BIOS boot mode. EFI gives an warning."</p>
<p>If so, and you are booting in BIOS mode, this is the reason for the
bootloader warning that you see. You need to recover to a matching
system, as explained by @jsmeix (i.e. backup was created on EFI -
recover to a system with EFI). Even then, with BIOS, I think that the
recovered system will work OK, if you select the restored disk in the
BIOS boot menu as the boot device, and you can thus ignore the message.</p>
<p>The EFI problem in the screenshot is a known bug of GRUB, see
<a href="https://github.com/rear/rear/issues/2971">https://github.com/rear/rear/issues/2971</a>
. It will be solved by a GRUB update. In the meantime, as a workaround,
set <code>SECURE_BOOT_BOOTLOADER=/boot/efi/EFI/almalinux/shimx64.efi</code> in
<code>/etc/rear/local.conf</code> and recreate the rescue USB. This should make
your USB bootable in EFI mode and the bootloader warning that you see at
the end should not appear.</p>
<h4 id="rvdkraan_commented_at_2024-03-05_1428"><img src="https://avatars.githubusercontent.com/u/46997988?u=8a7e4c8e33630d8d8e2f75c0c26e88b735e420b6&v=4" width="50"><a href="https://github.com/rvdkraan">rvdkraan</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1978900635">2024-03-05 14:28</a>:<a class="headerlink" href="#rvdkraan_commented_at_2024-03-05_1428" title="Permanent link">&para;</a></h4>
<p>I try to edit the config.<br />
The hardware should be almost identical, the disk in the system I am
restoring to is bigger.<br />
Both systems support BIOS and UEFI but the UEFI boot of rear does not
work.<br />
I saw that this should be fixed in a new release.</p>
<h4 id="pcahyna_commented_at_2024-03-05_1432"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1978908260">2024-03-05 14:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-05_1432" title="Permanent link">&para;</a></h4>
<p>@rvdkraan the point is, by setting
<code>SECURE_BOOT_BOOTLOADER=/boot/efi/EFI/almalinux/shimx64.efi</code> UEFI should
work already in this release</p>
<h4 id="jsmeix_commented_at_2024-03-06_1609"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1981222992">2024-03-06 16:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-03-06_1609" title="Permanent link">&para;</a></h4>
<p>Only FYI as a side note:</p>
<p>Out of curiosity I was wondering how far it could work<br />
to call existing ReaR scripts to install a bootloader<br />
from within the ReaR recovery system.</p>
<p>I use a QEMU/KVM system with BIOS and a single /dev/sda.</p>
<p>In the ReaR recovery system<br />
before running "rear recover"<br />
I did</p>
<pre><code>RESCUE localhost:~ # export GRUB2_INSTALL_DEVICES="/dev/sdQQQ"
</code></pre>
<p>to make finalize/Linux-i386/660_install_grub2.sh<br />
intentionally fail<br />
so I got</p>
<pre><code>RESCUE localhost:~ # rear -D recover
...
Installing GRUB2 boot loader...
Installing GRUB2 on /dev/sdQQQ (specified in GRUB2_INSTALL_DEVICES)
Failed to install GRUB2 on /dev/sdQQQ
Failed to install GRUB2 on /dev/sdQQQ
WARNING:
For this system
SUSE_LINUX/15.5 on Linux-i386 (based on SUSE/15/i386)
there is no code to install a boot loader on the recovered system
or the code that we have failed to install the boot loader correctly.
Please contribute appropriate code to the Relax-and-Recover project,
see http://relax-and-recover.org/development/
Take a look at the scripts in /usr/share/rear/finalize - for example
for PC architectures like x86 and x86_64 see the script
/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh
and for POWER architectures like ppc64le see the script
/usr/share/rear/finalize/Linux-ppc64le/660_install_grub2.sh
---------------------------------------------------
|  IF YOU DO NOT INSTALL A BOOT LOADER MANUALLY,  |
|  THEN YOUR SYSTEM WILL NOT BE ABLE TO BOOT.     |
---------------------------------------------------
You can use 'chroot /mnt/local bash --login'
to change into the recovered system and
manually install a boot loader therein.
...
</code></pre>
<p>Then I did</p>
<pre><code>RESCUE localhost:~ # export GRUB2_INSTALL_DEVICES="/dev/sda"

RESCUE localhost:~ # rear -d shell
...
REAR localhost:/usr/share/rear # export NOBOOTLOADER="yes"

REAR localhost:/usr/share/rear # Source finalize/Linux-i386/660_install_grub2.sh
...
Installing GRUB2 boot loader...
Generating grub configuration file ...
Found theme: /boot/grub2/themes/SLE/theme.txt
Found linux image: /boot/vmlinuz-5.14.21-150500.55.28-default
Found initrd image: /boot/initrd-5.14.21-150500.55.28-default
Warning: os-prober will not be executed to detect other bootable partitions.
Systems on them will not be added to the GRUB boot configuration.
Check GRUB_DISABLE_OS_PROBER documentation entry.
done
Installing GRUB2 on /dev/sda (specified in GRUB2_INSTALL_DEVICES)
Installing for i386-pc platform.
Installation finished. No error reported.

REAR localhost:/usr/share/rear # exit

RESCUE localhost:~ # reboot
</code></pre>
<p>The recreated system boots normally for me.</p>
<p>To make <code>rear shell</code> working<br />
within the ReaR recovery system one must adapt<br />
usr/share/rear/init/default/050_check_rear_recover_mode.sh<br />
as follows</p>
<pre><code>--- a/usr/share/rear/init/default/050_check_rear_recover_mode.sh
+++ b/usr/share/rear/init/default/050_check_rear_recover_mode.sh
@@ -15,7 +15,7 @@
 if test -f /etc/rear-release ; then
     # We are in the ReaR rescue/recovery system:
     case "$WORKFLOW" in
-        (recover|layoutonly|restoreonly|finalizeonly|mountonly|opaladmin|help)
+        (recover|layoutonly|restoreonly|finalizeonly|mountonly|opaladmin|shell|help)
             LogPrint "Running workflow $WORKFLOW within the ReaR rescue/recovery system"
             ;;
         (*)
</code></pre>
<p>i.e. add <code>shell</code> to the workflows that are allowed<br />
to be run from within the ReaR recovery system.</p>
<h4 id="rvdkraan_commented_at_2024-03-07_0820"><img src="https://avatars.githubusercontent.com/u/46997988?u=8a7e4c8e33630d8d8e2f75c0c26e88b735e420b6&v=4" width="50"><a href="https://github.com/rvdkraan">rvdkraan</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1982891769">2024-03-07 08:20</a>:<a class="headerlink" href="#rvdkraan_commented_at_2024-03-07_0820" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
The workaround worked and I was able to recover. Thanks.<br />
@jsmeix<br />
I do not fully grasp the shell you mentioned.<br />
However it nice to know that a failed recovery for the bootloader can be
fixt manually.</p>
<h4 id="pcahyna_commented_at_2024-03-08_1547"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1985929365">2024-03-08 15:47</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-08_1547" title="Permanent link">&para;</a></h4>
<p>@jsmeix <code>rear shell</code> looks nice, TIL! But in this case we don't even
need it, if the user boots from the recovered disk, the EFI shim's
fallback mechanism will fix up the boot entry automatically.
<a href="https://github.com/rhboot/shim/blob/main/README.fallback">https://github.com/rhboot/shim/blob/main/README.fallback</a></p>
<h4 id="jsmeix_commented_at_2024-03-08_1621"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1985991370">2024-03-08 16:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-03-08_1621" title="Permanent link">&para;</a></h4>
<p>Yes, this issue only triggered me to try out<br />
calling ReaR scripts from within the ReaR recovery system.<br />
I used BIOS because @rvdkraan tried to recover on BIOS.</p>
<h4 id="pcahyna_commented_at_2024-03-08_1626"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1986001582">2024-03-08 16:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-08_1626" title="Permanent link">&para;</a></h4>
<p>Fore me the interesting thing to note is that restoring a UEFI system in
BIOS mode "just works" and the warning can thus be considered excessive.
I suppose the opposite is not true (the bootloader would not get
installed and the system would not boot).</p>
<h4 id="rvdkraan_commented_at_2024-03-12_1239"><img src="https://avatars.githubusercontent.com/u/46997988?u=8a7e4c8e33630d8d8e2f75c0c26e88b735e420b6&v=4" width="50"><a href="https://github.com/rvdkraan">rvdkraan</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1991558962">2024-03-12 12:39</a>:<a class="headerlink" href="#rvdkraan_commented_at_2024-03-12_1239" title="Permanent link">&para;</a></h4>
<p>Hi @pcahyna</p>
<p>Rebooting gave me an screen showing only a white underscore like to have
on a prompt but than without blinking.<br />
However maybe there was an other reason the recovered system did not
boot.</p>
<h4 id="pcahyna_commented_at_2024-03-12_1431"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3170#issuecomment-1991789532">2024-03-12 14:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-03-12_1431" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Hi @pcahyna</p>
<p>Rebooting gave me an screen showing only a white underscore like to
have on a prompt but than without blinking. However maybe there was an
other reason the recovered system did not boot.</p>
</blockquote>
<p>hi @rvdkraan , when did that happen? Was it before applying the
<code>SECURE_BOOT_BOOTLOADER=</code> workaround, i.e. after the recovery has
printed the warning</p>
<pre><code>| IF YOU DO NOT INSTALL A BOOT LOADER MANUALLY, |
| THEN YOUR SYSTEM WILL NOT BE ABLE TO BOOT. |
</code></pre>
<p>?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2024-02-29.3170.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
