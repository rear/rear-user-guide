<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1019 Issue closed: MANUAL_INCLUDE=YES behaves unexpectedly - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1019 Issue closed: MANUAL_INCLUDE=YES behaves unexpectedly";
        var mkdocs_page_input_path = "issues/2016-09-30.1019.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1019 Issue closed: MANUAL_INCLUDE=YES behaves unexpectedly</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1019_issue_closed_manual_includeyes_behaves_unexpectedly"><a href="https://github.com/rear/rear/issues/1019">#1019 Issue</a> <code>closed</code>: MANUAL_INCLUDE=YES behaves unexpectedly<a class="headerlink" href="#1019_issue_closed_manual_includeyes_behaves_unexpectedly" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="john-leone_opened_issue_at_2016-09-30_2323"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> opened issue at <a href="https://github.com/rear/rear/issues/1019">2016-09-30 23:23</a>:<a class="headerlink" href="#john-leone_opened_issue_at_2016-09-30_2323" title="Permanent link">&para;</a></h4>
<h1 id="relax-and-recover_rear_issue_template">Relax-and-Recover (rear) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h1>
<p>Please fill in the following items before submitting a new issue:</p>
<ul>
<li>
<p>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 1.17.2 / Git</p>
</li>
<li>
<p>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    Red Hat Enterprise Linux Server release 6.7 (Santiago)</p>
</li>
<li>
<p>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</p>
<p><pre>
OUTPUT=ISO
OUTPUT_URL=nfs://xxx.xxx.xxx.xxx/dbar
BACKUP=NETFS
BACKUP_URL=nfs://xxx.xxx.xxx.xxx/dbar
SSH_ROOT_PASSWORD="redhat"
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media' '/var/tmp' '/var/crash')
MANUAL_INCLUDE=YES
BACKUP_PROG_INCLUDE=("${BACKUP_PROG_INCLUDE[@]}"'/boot' '/' '/opt' '/midrange' '/tmp' '/var' )
NETFS_KEEP_OLD_BACKUP_COPY=1
</pre></p>
</li>
<li>
<p>Brief description of the issue<br />
    Trying to configure MANUAL_INCLUDE mode in the local.conf file to
    specify only the file systems that we want backed up for a server.
    For the test we did not include /home but after we recover the
    server /home is there. See below, when running mkbackup we see a
    message "Excluding mountpoint /home (MANUAL_INCLUDE mode)"</p>
</li>
</ul>
<p>Am I missing something on the local.conf file?</p>
<ul>
<li>Log Output
    <pre>
    [root@xsmithm1d ~]# rear -v mkbackup
    Relax-and-Recover 1.17.2 / Git
    Using log file: /var/log/rear/rear-xsmithm1d.log
    Creating disk layout
    Excluding mountpoint /home. (MANUAL_INCLUDE mode)
    Creating root filesystem layout
    Copying files and directories
    Copying binaries and libraries
    Copying kernel modules
    Creating initramfs
    Making ISO image
    Wrote ISO image: /var/lib/rear/output/rear-xsmithm1d.iso (70M)
    Copying resulting files to nfs location
    Encrypting disabled
    Creating tar archive '/tmp/rear.y56DIIOlJAyFmCI/outputfs/xsmithm1d/backup.tar.gz'
    Archived 2187 MiB [avg 8683 KiB/sec]OK
    Archived 2187 MiB in 259 seconds [avg 8650 KiB/sec]
    </pre></li>
</ul>
<h4 id="jsmeix_commented_at_2016-10-04_1011"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251348729">2016-10-04 10:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1011" title="Permanent link">&para;</a></h4>
<p>I never used MANUAL_INCLUDE=YES before<br />
and for me it behaves in a totally unexpected way.</p>
<p>From my current point of view MANUAL_INCLUDE=YES<br />
behaves totally wrong.</p>
<p>What indicates that the current MANUAL_INCLUDE=YES<br />
implementation is at least incomplete is that the only script<br />
that contains MANUAL_INCLUDE is<br />
usr/share/rear/layout/save/default/31_include_exclude.sh<br />
which is about "Include/Exclude components"<br />
(i.e. things in var/lib/rear/layout/disklayout.conf)<br />
but there is noting at all about MANUAL_INCLUDE in<br />
scripts that deal with backup and restore.</p>
<p>My testing:</p>
<p>I have a SLES12-SP2-RC3 test system with those<br />
partitions/mountpoints:</p>
<pre>
# findmnt -a -t ext4 -o TARGET,SOURCE
TARGET  SOURCE
/       /dev/sda2
|-/var  /dev/sda4
`-/home /dev/sda3
</pre>

<p>and this etc/rear/local.conf:</p>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
KEEP_BUILD_DIR=""
MANUAL_INCLUDE=YES
BACKUP_PROG_INCLUDE=( '/*' '/var/*' )
</pre>

<p>I did</p>
<pre>
# usr/sbin/rear -d -D mkbackup
Relax-and-Recover 1.18 / Git
Using log file: /root/rear/var/log/rear/rear-f157.log
mkdir: created directory '/root/rear/var/lib'
mkdir: created directory '/root/rear/var/lib/rear'
mkdir: created directory '/root/rear/var/lib/rear/output'
Creating disk layout
Excluding mountpoint /. (MANUAL_INCLUDE mode)
Excluding mountpoint /home. (MANUAL_INCLUDE mode)
Excluding mountpoint /var. (MANUAL_INCLUDE mode)
Creating root filesystem layout
Copying files and directories
Copying binaries and libraries
Copying kernel modules
Creating initramfs
Making ISO image
Wrote ISO image: /root/rear/var/lib/rear/output/rear-f157.iso (150M)
Copying resulting files to nfs location
Encrypting disabled
Creating tar archive '/tmp/rear.3rKHiCiYpT4Gc5R/outputfs/f157/backup.tar.gz'
Archived 851 MiB [avg 6657 KiB/sec]OK
Archived 851 MiB in 132 seconds [avg 6607 KiB/sec]
</pre>

<p>Accordingly I get this var/lib/rear/layout/disklayout.conf</p>
<pre>
# Disk /dev/sda
# Format: disk <devname> <size(bytes)> <partition label type>
#disk /dev/sda 21474836480 msdos
# Partitions on /dev/sda
# Format: part <device> <partition size(bytes)> <partition start(bytes)> <partition type|name> <flags> /dev/<partition>
#part /dev/sda 1076887552 1048576 primary none /dev/sda1
#part /dev/sda 16105078784 1077936128 primary boot /dev/sda2
#part /dev/sda 2146435072 17183014912 primary none /dev/sda3
#part /dev/sda 2145386496 19329449984 primary none /dev/sda4
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs <device> <mountpoint> <fstype> [uuid=<uuid>] [label=<label>] [<attributes>]
#fs /dev/sda2 / ext4 uuid=b1a4bb41-8ea9-44db-b997-252bfa2c9858 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16382 default_mount_options=user_xattr,acl options=rw,relatime,data=ordered
#fs /dev/sda3 /home ext4 uuid=91066e65-8def-4c73-b572-3c0898f14026 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16376 default_mount_options=user_xattr,acl options=rw,relatime,data=ordered
#fs /dev/sda4 /var ext4 uuid=a1897b93-0835-4bac-93ac-38ea301deb99 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16368 default_mount_options=user_xattr,acl options=rw,relatime,data=ordered
# Swap partitions or swap files
# Format: swap <filename> uuid=<uuid> label=<label>
#swap /dev/sda1 uuid=db6d1cd2-8870-4ab1-a143-ec93ec40e4a1 label=
</pre>

<p>i.e. everything is disabled therein so that I would get<br />
nothing recreated during "rear recover".</p>
<p>On the other hand in my backup.tar.gz<br />
I have also all of /home/* and<br />
the whole /var/* content even twice.</p>
<p>Summary from my current point of view:</p>
<p>Currently "MANUAL_INCLUDE=YES" is broken.</p>
<p>At least "MANUAL_INCLUDE=YES" behaves so unexpectedly<br />
that currently I don't know how it is meant to be used correctly.</p>
<h4 id="jsmeix_commented_at_2016-10-04_1018"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251350225">2016-10-04 10:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1018" title="Permanent link">&para;</a></h4>
<p>Some forensics about MANUAL_INCLUDE:</p>
<p>"git log -p usr/share/rear/conf/default.conf" shows</p>
<pre>
commit eaa95532cf7c3f0f5cbf14c316dcd5b48a49c04e
Author: Robert Paschedag &lt;robert.paschedag@web.de>
Date:   Thu Jul 23 14:08:22 2015 +0200
    entered info for MANUAL_INCLUDE mode in conf/default.conf
</pre>

<p>and<br />
"git log -p
usr/share/rear/layout/save/default/31_include_exclude.sh"<br />
shows</p>
<pre>
commit 0359a0c1972d5dfd2f32f527deca07396df54f7b
Author: Robert Paschedag &lt;robert.paschedag@web.de>
Date:   Tue Jun 9 23:17:00 2015 +0200
    Added possibility to only backup BACKUP_PROG_INCLUDE
</pre>

<p>I.e. MANUAL_INCLUDE was added by<br />
<a href="https://github.com/rear/rear/commit/0359a0c1972d5dfd2f32f527deca07396df54f7b">https://github.com/rear/rear/commit/0359a0c1972d5dfd2f32f527deca07396df54f7b</a><br />
and<br />
<a href="https://github.com/rear/rear/commit/eaa95532cf7c3f0f5cbf14c316dcd5b48a49c04e">https://github.com/rear/rear/commit/eaa95532cf7c3f0f5cbf14c316dcd5b48a49c04e</a></p>
<h4 id="jsmeix_commented_at_2016-10-04_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251351443">2016-10-04 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1024" title="Permanent link">&para;</a></h4>
<p>@gdha @schlomo<br />
what is your opinion about MANUAL_INCLUDE?</p>
<p>I do not undrerstand how that is meant to be used<br />
and from my current point of view the current implementation<br />
looks so broken that currently I would simply remove it<br />
but that could of course cause regressions for<br />
Robert Paschedag who is probably the only user of it.</p>
<h4 id="jsmeix_commented_at_2016-10-04_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251352939">2016-10-04 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1032" title="Permanent link">&para;</a></h4>
<p>@John-Leone<br />
you have a typo in your BACKUP_PROG_INCLUDE array:</p>
<pre>
BACKUP_PROG_INCLUDE=("${BACKUP_PROG_INCLUDE[@]}"'/boot' '/' ...
</pre>

<p>there is no separator (space) between<br />
"${BACKUP_PROG_INCLUDE[@]}" and '/boot'<br />
which results in general not what is intended:</p>
<pre>
# arr=( 'foo' 'bar' )
# echo ${arr[@]}
foo bar
# arr=( "${arr[@]}"'baz' 'qux' )
# echo ${arr[@]}
foo barbaz qux
</pre>

<h4 id="gdha_commented_at_2016-10-04_1123"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251361888">2016-10-04 11:23</a>:<a class="headerlink" href="#gdha_commented_at_2016-10-04_1123" title="Permanent link">&para;</a></h4>
<p>@jsmeix if MANUAL_INCLUDE is so broken we should or ask @rpasche to fix
it, or disable it in the meantime (or remove it) when there is no decent
response on our request.</p>
<h4 id="jsmeix_commented_at_2016-10-04_1136"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251364158">2016-10-04 11:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1136" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
many thanks for inluding @rpasche - I did not know<br />
the GitHub user account of Robert Paschedag.</p>
<p>I assume for the 1.19 release we can leave it<br />
as is because default.conf explicitly states<br />
"Do NOT use MANUAL_INCLUDE mode."<br />
so that no user should use it carelessly.</p>
<p>I set the milestone to "Rear future".</p>
<h4 id="jsmeix_commented_at_2016-10-04_1155"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251367457">2016-10-04 11:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-04_1155" title="Permanent link">&para;</a></h4>
<p>For completeness:<br />
Now even I found out how to get the GitHub user account:<br />
One has to look at the GitHub commit URL, e.g.<br />
<a href="https://github.com/rear/rear/commit/0359a0c1972d5dfd2f32f527deca07396df54f7b">https://github.com/rear/rear/commit/0359a0c1972d5dfd2f32f527deca07396df54f7b</a><br />
and there the GitHub user account is shown.<br />
But - as far as I know - one cannot get the<br />
GitHub user account via "git log".</p>
<h4 id="rpasche_commented_at_2016-10-05_0650"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251595987">2016-10-05 06:50</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-05_0650" title="Permanent link">&para;</a></h4>
<p>Puh.....let me search in my mind.</p>
<p>I think the main problem for us was, that rear tried to backup every
filesystem it found. This is ok. But often on our servers, extra disks
have been added, that should not be backuped by rear, but with another
backup software (i.e. TSM or whatever). Failing to explictly exclude the
"new" filesystems caused rear (and the final NFS destination) to blow up
with this extra data. So we decided to set a "defined" number of
filesystems, that need to be saved by rear. Everything else should be
ignored. And the easiest way for me was to just set all other
filesystems to be "done".<br />
I'm sorry for this inconvenience and as soon as I have time, I'll try to
reproduce this and also have a look at our backups (and restores). But
until now, we had no problems with that.</p>
<h4 id="jsmeix_commented_at_2016-10-05_0743"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251604748">2016-10-05 07:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-05_0743" title="Permanent link">&para;</a></h4>
<p>@rpasche<br />
many thanks for your prompt reply!</p>
<p>Can you provide one of your etc/real/local.conf files<br />
preferably together with a matching disklayout.conf file<br />
so that I get a better idea how you use it.</p>
<p>When it works for you there is perhaps only some<br />
misunderstanding how MANUAL_INCLUDE is meant to be used<br />
and then it should be sufficient to enhance its documentation<br />
in default.conf to make it more clear how one must use it.</p>
<h4 id="rpasche_commented_at_2016-10-05_1051"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251642910">2016-10-05 10:51</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-05_1051" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix ,</p>
<p>here are some files</p>
<p>rear_local.conf
<a href="https://gist.github.com/rpasche/c64b9a35bf052eedb27150097c7c2498">https://gist.github.com/rpasche/c64b9a35bf052eedb27150097c7c2498</a><br />
disklayout.conf
<a href="https://gist.github.com/rpasche/66ac59e99a94222aba25cb0425afbe7d">https://gist.github.com/rpasche/66ac59e99a94222aba25cb0425afbe7d</a><br />
backup-include
<a href="https://gist.github.com/rpasche/c965842f8b5098ed95f597535dbbb938">https://gist.github.com/rpasche/c965842f8b5098ed95f597535dbbb938</a><br />
backup-exclude
<a href="https://gist.github.com/rpasche/93ee502aa47943185e8bc56f4706f549">https://gist.github.com/rpasche/93ee502aa47943185e8bc56f4706f549</a></p>
<h4 id="rpasche_commented_at_2016-10-05_1109"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251645945">2016-10-05 11:09</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-05_1109" title="Permanent link">&para;</a></h4>
<p>here, /data2 has been excluded through "MANUAL_INCLUDE" mode.</p>
<h4 id="jsmeix_commented_at_2016-10-05_1244"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-251663658">2016-10-05 12:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-05_1244" title="Permanent link">&para;</a></h4>
<p>@rpasche<br />
many thanks for the files.</p>
<p>On quick very first glance I noticed the duplicates<br />
in your backup-include - perhaps a general improvement<br />
makes sense to deduplicate entries in backup-include<br />
(and backup-exclude) to avoid duplicated files in the<br />
backup.tar.gz - but I need to test that...</p>
<h4 id="john-leone_commented_at_2016-10-18_1731"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-254580679">2016-10-18 17:31</a>:<a class="headerlink" href="#john-leone_commented_at_2016-10-18_1731" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix<br />
How did your additional testing go? Did MANUAL_INCLUDE=YES ever work
for you?<br />
Thanks,<br />
John</p>
<h4 id="jsmeix_commented_at_2016-10-19_0804"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-254742646">2016-10-19 08:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-19_0804" title="Permanent link">&para;</a></h4>
<p>@John-Leone<br />
I had no time to do anything more here.<br />
For me MANUAL_INCLUDE=YES does not at all work, see<br />
<a href="https://github.com/rear/rear/issues/1019#issuecomment-251348729">https://github.com/rear/rear/issues/1019#issuecomment-251348729</a></p>
<h4 id="rpasche_commented_at_2016-10-19_1347"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-254817544">2016-10-19 13:47</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-19_1347" title="Permanent link">&para;</a></h4>
<p>@jsmeix, @John-Leone</p>
<p>Just created another test-vm, made backup and recovery.</p>
<p>Added a second disk with LVM mounted as /testdata with a 5GB file, that
should not be backed up by rear. For testing reasons, I removed all
virtual disks and recreated new ones.<br />
The recovery worked as expected. The only drawbackup here now is,
because /testdata was excluded and was the only filesystem on that LVM
(on the second disk), the LVM has not been re-created on that second
disk and thus, systemd went into emergency after reboot because that LVM
was missing. But commenting this line in /etc/fstab fixed that here.</p>
<p>If I would not have "wiped" the second disk (with /testdata), there
would not have been an error at all.</p>
<p>See
<a href="https://gist.github.com/rpasche/ffa1c797ab363b8d8f88682ce09bb356">https://gist.github.com/rpasche/ffa1c797ab363b8d8f88682ce09bb356</a>.
I have attached several files.</p>
<h4 id="rpasche_commented_at_2016-10-20_0652"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255023865">2016-10-20 06:52</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-20_0652" title="Permanent link">&para;</a></h4>
<p>By the way....this should also work, so that the LVM on second disk
would have been recreated, without restoring the "contents" of /testdata</p>
<pre><code>BACKUP_PROG_INCLUDE=( "/" "/boot" "/var" "/home" "/data" "/ora" "/tmp" "/testdata" )
BACKUP_PROG_EXCLUDE=( "/data/*" "/ora/*" "/tmp/*" "/testdata/*")
</code></pre>
<h4 id="jsmeix_commented_at_2016-10-20_0843"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255045326">2016-10-20 08:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-10-20_0843" title="Permanent link">&para;</a></h4>
<p>@rpasche regarding your<br />
<a href="https://github.com/rear/rear/issues/1019#issuecomment-254817544">https://github.com/rear/rear/issues/1019#issuecomment-254817544</a></p>
<p>I assume you used current GitHub rear master for your test<br />
or current rear 1.19 release (and not an older rear version).</p>
<p>If yes, your test shows that there is still a vaild use-case<br />
for MANUAL_INCLUDE=YES but what is missing is a<br />
more explanatory description how it must be used correctly<br />
so that it works as it is meant to work because<br />
for me - as I try to use it - it does not work.</p>
<h4 id="john-leone_commented_at_2016-10-20_1105"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255076205">2016-10-20 11:05</a>:<a class="headerlink" href="#john-leone_commented_at_2016-10-20_1105" title="Permanent link">&para;</a></h4>
<p>I’m going try testing again.</p>
<h4 id="florianheigl_commented_at_2016-10-20_2338"><img src="https://avatars.githubusercontent.com/u/2828955?v=4" width="50"><a href="https://github.com/FlorianHeigl">FlorianHeigl</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255257065">2016-10-20 23:38</a>:<a class="headerlink" href="#florianheigl_commented_at_2016-10-20_2338" title="Permanent link">&para;</a></h4>
<p>@rpasche btw, i also always just need a 'backup those 7 critical
filesystems' mode for datacenter use, for P2V I <em>sometimes</em> just want
everything. but my default use case is the classical 'only backup vg00'
of olden days.</p>
<h4 id="rpasche_commented_at_2016-10-21_1143"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255360011">2016-10-21 11:43</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-21_1143" title="Permanent link">&para;</a></h4>
<p>@jsmeix ,</p>
<p>looks like "gist" is somehow down right now, so here is the restore log
with v1.19 (freshly cloned about 30 minutes ago)</p>
<p>Same config, same disklayout. This time, I did NOT wipe the second
disk....only the first disk and also removed the 5GB file, that I had
created on the second disk to verify, that it has NOT been backed up by
rear (and also not recovered). After restore and reboot, the system just
came up as if nothing had happened.</p>
<p>So...I don't know, why this MANUAL_INCLUDE mode is "sooo
inpredicteable"?</p>
<p>I tell it in BACKUP_INCLUDE, what filesystems should be saved and from
these filesystems, I also want to ignore some content. That's why for
example /data is set in BACKUP_INCLUDE and /data/* (see the asterix)
is set in BACKUP_EXCLUDE. So rear restores the /data "filesystem", but
not the contents on it.</p>
<pre><code>2016-10-21 13:19:51 Relax-and-Recover 1.19 / Git
2016-10-21 13:19:51 Command line options: /bin/rear -v recover
2016-10-21 13:19:51 Using log file: /var/log/rear/rear-rear-restore.log
2016-10-21 13:19:51 Including /etc/rear/os.conf
2016-10-21 13:19:51 Including conf/Linux-i386.conf
2016-10-21 13:19:51 Including conf/GNU/Linux.conf
2016-10-21 13:19:51 Including /etc/rear/local.conf
2016-10-21 13:19:51 Including /etc/rear/rescue.conf
2016-10-21 13:19:51 Running 'init' stage
2016-10-21 13:19:51 Including init/default/01_set_drlm_env.sh
2016-10-21 13:19:51 Including init/default/03_update_recovery_system.sh
2016-10-21 13:19:51 Including init/default/05_check_rear-recover_mode.sh
2016-10-21 13:19:51 Finished running 'init' stage in 0 seconds
2016-10-21 13:19:51 Using build area '/tmp/rear.iQ5TRwTH4iBLiud'
mkdir: created directory '/tmp/rear.iQ5TRwTH4iBLiud/rootfs'
mkdir: created directory '/tmp/rear.iQ5TRwTH4iBLiud/tmp'
2016-10-21 13:19:51 Running recover workflow
2016-10-21 13:19:51 Running 'setup' stage
2016-10-21 13:19:51 Including setup/default/01_pre_recovery_script.sh
2016-10-21 13:19:51 Finished running 'setup' stage in 0 seconds
2016-10-21 13:19:51 Running 'verify' stage
2016-10-21 13:19:51 Including verify/default/02_cciss_scsi_engage.sh
2016-10-21 13:19:51 Including verify/default/02_translate_url.sh
2016-10-21 13:19:51 Using NETFS_URL is deprecated. Use BACKUP_URL instead.
2016-10-21 13:19:51 Including verify/default/03_translate_tape.sh
2016-10-21 13:19:51 Including verify/default/04_validate_variables.sh
2016-10-21 13:19:51 Including verify/NETFS/default/05_check_NETFS_requirements.sh
2016-10-21 13:19:51 Skipping 'ping' test for host 'NFSSERVER' in BACKUP_URL 'nfs://NFSSERVER/data/rear/images'
2016-10-21 13:19:51 Including verify/default/05_create_mappings_dir.sh
2016-10-21 13:19:51 Including verify/GNU/Linux/05_sane_recovery_check.sh
2016-10-21 13:19:51 Including verify/NETFS/default/05_start_required_nfs_daemons.sh
2016-10-21 13:19:51 Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
2016-10-21 13:19:51 Started RPC portmapper 'rpcbind'.
2016-10-21 13:19:51 RPC portmapper 'rpcbind' available.
2016-10-21 13:19:51 Started rpc.statd.
2016-10-21 13:19:51 RPC status rpc.statd available.
rpc.idmapd: libnfsidmap: requested translation method, 'nsswitch', is not available

rpc.idmapd: Unable to create name to user id mappings.
2016-10-21 13:19:51 Starting rpc.idmapd failed.
mount: mount point /var/lib/nfs/rpc_pipefs does not exist
2016-10-21 13:19:51 Including verify/NETFS/default/06_mount_NETFS_path.sh
mkdir: created directory '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
2016-10-21 13:19:51 Mounting with 'mount -v -t nfs -o rw,noatime NFSSERVER:/data/rear/images /tmp/rear.iQ5TRwTH4iBLiud/outputfs'
mount.nfs: timeout set for Fri Oct 21 13:21:56 2016
mount.nfs: trying text-based options 'vers=4,addr=SERVER_IP,clientaddr=CLIENT_IP'
2016-10-21 13:19:56 Including verify/NETFS/default/07_set_backup_archive.sh
2016-10-21 13:19:56 Including verify/NETFS/default/09_set_readonly_options.sh
2016-10-21 13:19:56 Including verify/GNU/Linux/23_storage_and_network_modules.sh
2016-10-21 13:19:56 Including verify/GNU/Linux/26_recovery_storage_drivers.sh
2016-10-21 13:19:56 Including verify/NETFS/default/55_check_backup_archive.sh
2016-10-21 13:19:56 Calculating backup archive size
2016-10-21 13:19:56 Backup archive size is 468M /tmp/rear.iQ5TRwTH4iBLiud/outputfs/rear-restore/backup.tar.gz (compressed)
2016-10-21 13:19:56 Including verify/NETFS/default/60_check_encryption_key.sh
2016-10-21 13:19:56 Including verify/NETFS/default/98_umount_NETFS_dir.sh
2016-10-21 13:19:56 Unmounting '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
umount: /tmp/rear.iQ5TRwTH4iBLiud/outputfs (NFSSERVER:/data/rear/images) unmounted
rmdir: removing directory, '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
2016-10-21 13:19:56 Finished running 'verify' stage in 5 seconds
2016-10-21 13:19:56 Running 'layout/prepare' stage
2016-10-21 13:19:56 Including layout/prepare/default/01_prepare_files.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/10_include_partition_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/11_include_lvm_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/12_include_raid_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/13_include_filesystem_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/13_include_mount_filesystem_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/13_include_mount_subvolumes_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/14_include_swap_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/15_include_drbd_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/16_include_luks_code.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/17_include_hpraid_code.sh
2016-10-21 13:19:56 Including layout/prepare/default/20_recreate_hpraid.sh
2016-10-21 13:19:56 Including layout/prepare/GNU/Linux/21_load_multipath.sh
2016-10-21 13:19:56 Including layout/prepare/default/25_compare_disks.sh
2016-10-21 13:19:56 Comparing disks.
2016-10-21 13:19:56 Looking for sda...
2016-10-21 13:19:56 Device sda exists.
2016-10-21 13:19:56 Size of device sda matches.
2016-10-21 13:19:56 Disk configuration is identical, proceeding with restore.
2016-10-21 13:19:56 Including layout/prepare/default/30_map_disks.sh
2016-10-21 13:19:56 Including layout/prepare/default/31_remove_exclusions.sh
2016-10-21 13:19:56 Including layout/prepare/default/32_apply_mappings.sh
2016-10-21 13:19:56 Including layout/prepare/default/40_autoresize_disks.sh
2016-10-21 13:19:56 Including layout/prepare/default/50_confirm_layout.sh
2016-10-21 13:19:56 Including layout/prepare/default/51_list_dependencies.sh
2016-10-21 13:19:56 Including layout/prepare/default/52_exclude_components.sh
2016-10-21 13:19:56 Including layout/prepare/default/54_generate_device_code.sh
2016-10-21 13:19:56 Begin create_fs( fs:/ )
2016-10-21 13:19:56 Begin mount_fs( fs:/ )
2016-10-21 13:19:56 End mount_fs( fs:/ )
2016-10-21 13:19:56 End create_fs( fs:/ )
2016-10-21 13:19:56 Begin create_fs( fs:/data )
2016-10-21 13:19:56 Begin mount_fs( fs:/data )
2016-10-21 13:19:56 End mount_fs( fs:/data )
2016-10-21 13:19:56 End create_fs( fs:/data )
2016-10-21 13:19:56 Begin create_fs( fs:/home )
2016-10-21 13:19:56 Begin mount_fs( fs:/home )
2016-10-21 13:19:56 End mount_fs( fs:/home )
2016-10-21 13:19:56 End create_fs( fs:/home )
2016-10-21 13:19:56 Begin create_fs( fs:/tmp )
2016-10-21 13:19:56 Begin mount_fs( fs:/tmp )
2016-10-21 13:19:56 End mount_fs( fs:/tmp )
2016-10-21 13:19:56 End create_fs( fs:/tmp )
2016-10-21 13:19:56 Begin create_fs( fs:/var )
2016-10-21 13:19:56 Begin mount_fs( fs:/var )
2016-10-21 13:19:56 End mount_fs( fs:/var )
2016-10-21 13:19:56 End create_fs( fs:/var )
2016-10-21 13:19:56 Begin create_fs( fs:/boot )
2016-10-21 13:19:56 Begin mount_fs( fs:/boot )
2016-10-21 13:19:56 End mount_fs( fs:/boot )
2016-10-21 13:19:56 End create_fs( fs:/boot )
2016-10-21 13:19:56 Including layout/prepare/default/55_finalize_script.sh
2016-10-21 13:19:56 Including layout/prepare/default/60_show_unprocessed.sh
2016-10-21 13:19:56 Including layout/prepare/default/61_exclude_from_restore.sh
2016-10-21 13:19:56 Finished running 'layout/prepare' stage in 0 seconds
2016-10-21 13:19:56 Running 'layout/recreate' stage
2016-10-21 13:19:56 Including layout/recreate/default/10_ask_confirmation.sh
2016-10-21 13:19:56 Including layout/recreate/default/20_run_script.sh
2016-10-21 13:19:56 Start system layout restoration.
+++ create_component /dev/sda disk
+++ local device=/dev/sda
+++ local type=disk
+++ local touchfile=disk--dev-sda
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/disk--dev-sda ']'
+++ return 0
+++ Log 'Stop mdadm'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:56 Stop mdadm'
2016-10-21 13:19:56 Stop mdadm
+++ grep -q md /proc/mdstat
+++ Log 'Erasing MBR of disk /dev/sda'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:56 Erasing MBR of disk /dev/sda'
2016-10-21 13:19:56 Erasing MBR of disk /dev/sda
+++ dd if=/dev/zero of=/dev/sda bs=512 count=1
1+0 records in
1+0 records out
512 bytes (512 B) copied, 0.0230462 s, 22.2 kB/s
+++ sync
+++ LogPrint 'Creating partitions for disk /dev/sda (msdos)'
+++ Log 'Creating partitions for disk /dev/sda (msdos)'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:56 Creating partitions for disk /dev/sda (msdos)'
2016-10-21 13:19:56 Creating partitions for disk /dev/sda (msdos)
+++ Print 'Creating partitions for disk /dev/sda (msdos)'
+++ test -n 1
+++ echo -e 'Creating partitions for disk /dev/sda (msdos)'
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ parted -s /dev/sda mklabel msdos
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ parted -s /dev/sda mkpart '"primary"' 1048576B 1000341503B
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ parted -s /dev/sda set 1 boot on
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ parted -s /dev/sda mkpart '"primary"' 1000341504B 32211206143B
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ parted -s /dev/sda set 2 lvm on
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ sleep 1
+++ partprobe -s /dev/sda
/dev/sda: msdos partitions 1 2
+++ my_udevtrigger
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm trigger
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ component_created /dev/sda disk
+++ local device=/dev/sda
+++ local type=disk
+++ local touchfile=disk--dev-sda
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/disk--dev-sda
+++ create_component /dev/sda1 part
+++ local device=/dev/sda1
+++ local type=part
+++ local touchfile=part--dev-sda1
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/part--dev-sda1 ']'
+++ return 0
+++ component_created /dev/sda1 part
+++ local device=/dev/sda1
+++ local type=part
+++ local touchfile=part--dev-sda1
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/part--dev-sda1
+++ create_component /dev/sda2 part
+++ local device=/dev/sda2
+++ local type=part
+++ local touchfile=part--dev-sda2
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/part--dev-sda2 ']'
+++ return 0
+++ component_created /dev/sda2 part
+++ local device=/dev/sda2
+++ local type=part
+++ local touchfile=part--dev-sda2
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/part--dev-sda2
+++ create_component pv:/dev/sda2 lvmdev
+++ local device=pv:/dev/sda2
+++ local type=lvmdev
+++ local touchfile=lvmdev-pv:-dev-sda2
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmdev-pv:-dev-sda2 ']'
+++ return 0
+++ LogPrint 'Creating LVM PV /dev/sda2'
+++ Log 'Creating LVM PV /dev/sda2'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:58 Creating LVM PV /dev/sda2'
2016-10-21 13:19:58 Creating LVM PV /dev/sda2
+++ Print 'Creating LVM PV /dev/sda2'
+++ test -n 1
+++ echo -e 'Creating LVM PV /dev/sda2'
+++ lvm vgchange -a n system
  Volume group "system" not found
  Skipping volume group system
+++ true
+++ lvm pvcreate -ff --yes -v --uuid TRZ029-3c4D-QH9j-MTPn-Y3Wr-C1Yu-EtZvwE --restorefile /var/lib/rear/layout/lvm/system.cfg /dev/sda2
    DEGRADED MODE. Incomplete RAID LVs will be processed.
  Couldn't find device with uuid TRZ029-3c4D-QH9j-MTPn-Y3Wr-C1Yu-EtZvwE.
    Wiping cache of LVM-capable devices
    Set up physical volume for "/dev/sda2" with 60958720 available sectors
    Writing physical volume data to disk "/dev/sda2"
  Physical volume "/dev/sda2" successfully created
+++ component_created pv:/dev/sda2 lvmdev
+++ local device=pv:/dev/sda2
+++ local type=lvmdev
+++ local touchfile=lvmdev-pv:-dev-sda2
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmdev-pv:-dev-sda2
+++ create_component /dev/system lvmgrp
+++ local device=/dev/system
+++ local type=lvmgrp
+++ local touchfile=lvmgrp--dev-system
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmgrp--dev-system ']'
+++ return 0
+++ LogPrint 'Restoring LVM VG system'
+++ Log 'Restoring LVM VG system'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:58 Restoring LVM VG system'
2016-10-21 13:19:58 Restoring LVM VG system
+++ Print 'Restoring LVM VG system'
+++ test -n 1
+++ echo -e 'Restoring LVM VG system'
+++ '[' -e /dev/system ']'
+++ lvm vgcfgrestore -f /var/lib/rear/layout/lvm/system.cfg system
  Restored volume group system
+++ lvm vgchange --available y system
  6 logical volume(s) in volume group "system" now active
+++ LogPrint 'Sleeping 3 seconds to let udev or systemd-udevd create their devices...'
+++ Log 'Sleeping 3 seconds to let udev or systemd-udevd create their devices...'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:19:58 Sleeping 3 seconds to let udev or systemd-udevd create their devices...'
2016-10-21 13:19:58 Sleeping 3 seconds to let udev or systemd-udevd create their devices...
+++ Print 'Sleeping 3 seconds to let udev or systemd-udevd create their devices...'
+++ test -n 1
+++ echo -e 'Sleeping 3 seconds to let udev or systemd-udevd create their devices...'
+++ sleep 3
+++ component_created /dev/system lvmgrp
+++ local device=/dev/system
+++ local type=lvmgrp
+++ local touchfile=lvmgrp--dev-system
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmgrp--dev-system
+++ create_component /dev/mapper/system-lv_swap lvmvol
+++ local device=/dev/mapper/system-lv_swap
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_swap
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_swap ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_swap lvmvol
+++ local device=/dev/mapper/system-lv_swap
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_swap
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_swap
+++ create_component /dev/mapper/system-lv_root lvmvol
+++ local device=/dev/mapper/system-lv_root
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_root
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_root ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_root lvmvol
+++ local device=/dev/mapper/system-lv_root
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_root
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_root
+++ create_component /dev/mapper/system-lv_var lvmvol
+++ local device=/dev/mapper/system-lv_var
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_var
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_var ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_var lvmvol
+++ local device=/dev/mapper/system-lv_var
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_var
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_var
+++ create_component /dev/mapper/system-lv_tmp lvmvol
+++ local device=/dev/mapper/system-lv_tmp
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_tmp
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_tmp ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_tmp lvmvol
+++ local device=/dev/mapper/system-lv_tmp
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_tmp
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_tmp
+++ create_component /dev/mapper/system-lv_home lvmvol
+++ local device=/dev/mapper/system-lv_home
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_home
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_home ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_home lvmvol
+++ local device=/dev/mapper/system-lv_home
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_home
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_home
+++ create_component /dev/mapper/system-lv_data lvmvol
+++ local device=/dev/mapper/system-lv_data
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_data
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_data ']'
+++ return 0
+++ component_created /dev/mapper/system-lv_data lvmvol
+++ local device=/dev/mapper/system-lv_data
+++ local type=lvmvol
+++ local touchfile=lvmvol--dev-mapper-system-lv_data
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/lvmvol--dev-mapper-system-lv_data
+++ create_component fs:/ fs
+++ local device=fs:/
+++ local type=fs
+++ local touchfile=fs-fs:-
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:- ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.'
+++ Log 'Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:01 Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.'
2016-10-21 13:20:01 Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.
+++ Print 'Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point / on /dev/mapper/system-lv_root.'
+++ wipefs -a /dev/mapper/system-lv_root
+++ mkfs -t ext3 -b 4096 -i 16371 -U 633fbdee-3312-499f-a9d3-0392eff11c78 /dev/mapper/system-lv_root
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 2684928 4k blocks and 673056 inodes
Filesystem UUID: 633fbdee-3312-499f-a9d3-0392eff11c78
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208

Allocating group tables:  0/82     done                            
Writing inode tables:  0/82     done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information:  0/82     done

+++ tune2fs -m 4 -c -1 -i 0d -o user_xattr,acl /dev/mapper/system-lv_root
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 4% (107397 blocks)
+++ LogPrint 'Mounting filesystem /'
+++ Log 'Mounting filesystem /'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:03 Mounting filesystem /'
2016-10-21 13:20:03 Mounting filesystem /
+++ Print 'Mounting filesystem /'
+++ test -n 1
+++ echo -e 'Mounting filesystem /'
+++ mkdir -p /mnt/local/
+++ mount -o rw,relatime,errors=remount-ro,data=ordered /dev/mapper/system-lv_root /mnt/local/
+++ component_created fs:/ fs
+++ local device=fs:/
+++ local type=fs
+++ local touchfile=fs-fs:-
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-
+++ create_component fs:/data fs
+++ local device=fs:/data
+++ local type=fs
+++ local touchfile=fs-fs:-data
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-data ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.'
+++ Log 'Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:03 Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.'
2016-10-21 13:20:03 Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.
+++ Print 'Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point /data on /dev/mapper/system-lv_data.'
+++ wipefs -a /dev/mapper/system-lv_data
+++ mkfs -t ext3 -b 4096 -i 16381 -U 9c3106ff-46c0-4b1e-9071-823f45012ab6 /dev/mapper/system-lv_data
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 2251776 4k blocks and 564144 inodes
Filesystem UUID: 9c3106ff-46c0-4b1e-9071-823f45012ab6
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables:  0/69     done                            
Writing inode tables:  0/69     done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information:  0/69 2/69     done

+++ tune2fs -m 4 -c -1 -i 0d -o user_xattr,acl /dev/mapper/system-lv_data
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 4% (90071 blocks)
+++ LogPrint 'Mounting filesystem /data'
+++ Log 'Mounting filesystem /data'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:05 Mounting filesystem /data'
2016-10-21 13:20:05 Mounting filesystem /data
+++ Print 'Mounting filesystem /data'
+++ test -n 1
+++ echo -e 'Mounting filesystem /data'
+++ mkdir -p /mnt/local/data
+++ mount -o rw,relatime,data=ordered /dev/mapper/system-lv_data /mnt/local/data
+++ component_created fs:/data fs
+++ local device=fs:/data
+++ local type=fs
+++ local touchfile=fs-fs:-data
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-data
+++ create_component fs:/home fs
+++ local device=fs:/home
+++ local type=fs
+++ local touchfile=fs-fs:-home
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-home ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.'
+++ Log 'Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:05 Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.'
2016-10-21 13:20:05 Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.
+++ Print 'Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point /home on /dev/mapper/system-lv_home.'
+++ wipefs -a /dev/mapper/system-lv_home
+++ mkfs -t ext3 -b 4096 -i 16375 -U 3f296303-856d-475b-b149-8390a43bd9e7 /dev/mapper/system-lv_home
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 487424 4k blocks and 122160 inodes
Filesystem UUID: 3f296303-856d-475b-b149-8390a43bd9e7
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912

Allocating group tables:  0/15     done                            
Writing inode tables:  0/15     done                            
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information:  0/15     done

+++ tune2fs -m 4 -c -1 -i 0d -o user_xattr,acl /dev/mapper/system-lv_home
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 4% (19496 blocks)
+++ LogPrint 'Mounting filesystem /home'
+++ Log 'Mounting filesystem /home'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:06 Mounting filesystem /home'
2016-10-21 13:20:06 Mounting filesystem /home
+++ Print 'Mounting filesystem /home'
+++ test -n 1
+++ echo -e 'Mounting filesystem /home'
+++ mkdir -p /mnt/local/home
+++ mount -o rw,relatime,data=ordered /dev/mapper/system-lv_home /mnt/local/home
+++ component_created fs:/home fs
+++ local device=fs:/home
+++ local type=fs
+++ local touchfile=fs-fs:-home
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-home
+++ create_component fs:/tmp fs
+++ local device=fs:/tmp
+++ local type=fs
+++ local touchfile=fs-fs:-tmp
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-tmp ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.'
+++ Log 'Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:06 Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.'
2016-10-21 13:20:06 Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.
+++ Print 'Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/system-lv_tmp.'
+++ wipefs -a /dev/mapper/system-lv_tmp
+++ mkfs -t ext3 -b 4096 -i 16375 -U 33bf2d6c-7e2c-4934-9709-ba16abb403c4 /dev/mapper/system-lv_tmp
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 487424 4k blocks and 122160 inodes
Filesystem UUID: 33bf2d6c-7e2c-4934-9709-ba16abb403c4
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912

Allocating group tables:  0/15     done                            
Writing inode tables:  0/15     done                            
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information:  0/15     done

+++ tune2fs -m 4 -c -1 -i 0d -o user_xattr,acl /dev/mapper/system-lv_tmp
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 4% (19496 blocks)
+++ LogPrint 'Mounting filesystem /tmp'
+++ Log 'Mounting filesystem /tmp'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:06 Mounting filesystem /tmp'
2016-10-21 13:20:06 Mounting filesystem /tmp
+++ Print 'Mounting filesystem /tmp'
+++ test -n 1
+++ echo -e 'Mounting filesystem /tmp'
+++ mkdir -p /mnt/local/tmp
+++ mount -o rw,relatime,data=ordered /dev/mapper/system-lv_tmp /mnt/local/tmp
+++ component_created fs:/tmp fs
+++ local device=fs:/tmp
+++ local type=fs
+++ local touchfile=fs-fs:-tmp
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-tmp
+++ create_component fs:/var fs
+++ local device=fs:/var
+++ local type=fs
+++ local touchfile=fs-fs:-var
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-var ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.'
+++ Log 'Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:06 Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.'
2016-10-21 13:20:06 Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.
+++ Print 'Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point /var on /dev/mapper/system-lv_var.'
+++ wipefs -a /dev/mapper/system-lv_var
+++ mkfs -t ext3 -b 4096 -i 16363 -U 8537f481-b277-4c26-b2f5-e06178544868 /dev/mapper/system-lv_var
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 732160 4k blocks and 183632 inodes
Filesystem UUID: 8537f481-b277-4c26-b2f5-e06178544868
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912

Allocating group tables:  0/23     done                            
Writing inode tables:  0/2317/23     done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information:  0/23     done

+++ tune2fs -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/system-lv_var
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 5% (36608 blocks)
+++ LogPrint 'Mounting filesystem /var'
+++ Log 'Mounting filesystem /var'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:07 Mounting filesystem /var'
2016-10-21 13:20:07 Mounting filesystem /var
+++ Print 'Mounting filesystem /var'
+++ test -n 1
+++ echo -e 'Mounting filesystem /var'
+++ mkdir -p /mnt/local/var
+++ mount -o rw,relatime,data=ordered /dev/mapper/system-lv_var /mnt/local/var
+++ component_created fs:/var fs
+++ local device=fs:/var
+++ local type=fs
+++ local touchfile=fs-fs:-var
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-var
+++ create_component fs:/boot fs
+++ local device=fs:/boot
+++ local type=fs
+++ local touchfile=fs-fs:-boot
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-boot ']'
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ LogPrint 'Creating filesystem of type ext3 with mount point /boot on /dev/sda1.'
+++ Log 'Creating filesystem of type ext3 with mount point /boot on /dev/sda1.'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:07 Creating filesystem of type ext3 with mount point /boot on /dev/sda1.'
2016-10-21 13:20:07 Creating filesystem of type ext3 with mount point /boot on /dev/sda1.
+++ Print 'Creating filesystem of type ext3 with mount point /boot on /dev/sda1.'
+++ test -n 1
+++ echo -e 'Creating filesystem of type ext3 with mount point /boot on /dev/sda1.'
+++ wipefs -a /dev/sda1
+++ mkfs -t ext3 -b 4096 -i 16366 -U bd12a504-305c-47ed-920b-cc269cf5d461 /dev/sda1
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 243968 4k blocks and 61184 inodes
Filesystem UUID: bd12a504-305c-47ed-920b-cc269cf5d461
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376

Allocating group tables: 0/8   done                            
Writing inode tables: 0/8   done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: 0/8   done

+++ tune2fs -m 4 -c -1 -i 0d -o user_xattr,acl /dev/sda1
tune2fs 1.42.12 (29-Aug-2014)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 4% (9758 blocks)
+++ LogPrint 'Mounting filesystem /boot'
+++ Log 'Mounting filesystem /boot'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:08 Mounting filesystem /boot'
2016-10-21 13:20:08 Mounting filesystem /boot
+++ Print 'Mounting filesystem /boot'
+++ test -n 1
+++ echo -e 'Mounting filesystem /boot'
+++ mkdir -p /mnt/local/boot
+++ mount -o rw,relatime,data=ordered /dev/sda1 /mnt/local/boot
+++ component_created fs:/boot fs
+++ local device=fs:/boot
+++ local type=fs
+++ local touchfile=fs-fs:-boot
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/fs-fs:-boot
+++ create_component swap:/dev/mapper/system-lv_swap swap
+++ local device=swap:/dev/mapper/system-lv_swap
+++ local type=swap
+++ local touchfile=swap-swap:-dev-mapper-system-lv_swap
+++ '[' -e /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/swap-swap:-dev-mapper-system-lv_swap ']'
+++ return 0
+++ LogPrint 'Creating swap on /dev/mapper/system-lv_swap'
+++ Log 'Creating swap on /dev/mapper/system-lv_swap'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2016-10-21 13:20:08 Creating swap on /dev/mapper/system-lv_swap'
2016-10-21 13:20:08 Creating swap on /dev/mapper/system-lv_swap
+++ Print 'Creating swap on /dev/mapper/system-lv_swap'
+++ test -n 1
+++ echo -e 'Creating swap on /dev/mapper/system-lv_swap'
+++ mkswap -U 0dd4d9f7-0d9f-43fc-a619-f1b61b698bee /dev/mapper/system-lv_swap
Setting up swapspace version 1, size = 3903484 KiB
no label, UUID=0dd4d9f7-0d9f-43fc-a619-f1b61b698bee
+++ component_created swap:/dev/mapper/system-lv_swap swap
+++ local device=swap:/dev/mapper/system-lv_swap
+++ local type=swap
+++ local touchfile=swap-swap:-dev-mapper-system-lv_swap
+++ touch /tmp/rear.iQ5TRwTH4iBLiud/tmp/touch/swap-swap:-dev-mapper-system-lv_swap
+++ set +x
2016-10-21 13:20:08 Disk layout created.
2016-10-21 13:20:08 Including layout/recreate/default/25_verify_mount.sh
2016-10-21 13:20:08 Finished running 'layout/recreate' stage in 12 seconds
2016-10-21 13:20:08 Running 'restore' stage
2016-10-21 13:20:08 Including restore/NETFS/default/10_mount_NETFS_path.sh
mkdir: created directory '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
2016-10-21 13:20:08 Mounting with 'mount -v -t nfs -o ro NFSSERVER:/data/rear/images /tmp/rear.iQ5TRwTH4iBLiud/outputfs'
mount.nfs: timeout set for Fri Oct 21 13:22:08 2016
mount.nfs: trying text-based options 'vers=4,addr=SERVER_IP,clientaddr=CLIENT_IP'
2016-10-21 13:20:08 Including restore/NETFS/default/38_prepare_multiple_isos.sh
2016-10-21 13:20:08 Including restore/NETFS/default/40_restore_backup.sh
2016-10-21 13:20:08 Decrypting disabled
2016-10-21 13:20:08 Restoring tar archive '/tmp/rear.iQ5TRwTH4iBLiud/outputfs/rear-restore/backup.tar.gz'
2016-10-21 13:20:08 dd if=/tmp/rear.iQ5TRwTH4iBLiud/outputfs/rear-restore/backup.tar.gz | cat | tar --block-number --totals --verbose --anchored --gzip -C /mnt/local/ -x -f -
956877+1 records in
956877+1 records out
489921112 bytes (490 MB) copied, 13.6799 s, 35.8 MB/s
Total bytes read: 1124730880 (1.1GiB, 79MiB/s)
2016-10-21 13:20:23 Restored 1029 MiB in 14 seconds [avg 75312 KiB/sec]
2016-10-21 13:20:23 Including restore/NETFS/default/50_selinux_autorelabel.sh
2016-10-21 13:20:23 Including restore/default/50_selinux_autorelabel.sh
2016-10-21 13:20:23 Created /.autorelabel file : after reboot SELinux will relabel all files
2016-10-21 13:20:23 Including restore/NETFS/Linux-i386/51_selinux_fixfiles_exclude_dirs.sh
2016-10-21 13:20:23 Including restore/NETFS/default/51_set_capabilities.sh
2016-10-21 13:20:23 Including restore/default/90_create_missing_directories.sh
2016-10-21 13:20:23 Restore the Mountpoints (with permissions) from /var/lib/rear/recovery/mountpoint_permissions
2016-10-21 13:20:23 Including restore/NETFS/default/98_umount_NETFS_dir.sh
2016-10-21 13:20:23 Unmounting '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
umount: /tmp/rear.iQ5TRwTH4iBLiud/outputfs (NFSSERVER:/data/rear/images) unmounted
rmdir: removing directory, '/tmp/rear.iQ5TRwTH4iBLiud/outputfs'
2016-10-21 13:20:23 Including restore/default/99_move_away_restored_files.sh
2016-10-21 13:20:23 Finished running 'restore' stage in 15 seconds
2016-10-21 13:20:23 Running 'finalize' stage
2016-10-21 13:20:23 Including finalize/default/01_prepare_checks.sh
2016-10-21 13:20:23 Including finalize/default/10_populate_dev.sh
2016-10-21 13:20:23 Including finalize/GNU/Linux/15_migrate_disk_devices_layout.sh
2016-10-21 13:20:23 Including finalize/GNU/Linux/15_migrate_lun_wwid.sh
2016-10-21 13:20:23 Including finalize/GNU/Linux/15_migrate_uuid_tags.sh
2016-10-21 13:20:23 Including finalize/GNU/Linux/16_rename_diskbyid.sh
2016-10-21 13:20:23 Including finalize/Debian/i386/17_rebuild_initramfs.sh
2016-10-21 13:20:23 Including finalize/Linux-i386/21_install_grub.sh
/sbin/grub-probe
2016-10-21 13:20:23 Skip installing GRUB Legacy boot loader because GRUB 2 is installed (grub-probe or grub2-probe exist).
2016-10-21 13:20:23 Including finalize/Linux-i386/22_install_elilo.sh
2016-10-21 13:20:23 Including finalize/Linux-i386/22_install_grub2.sh
2016-10-21 13:20:23 Installing GRUB2 boot loader
Installing for i386-pc platform.
grub-install: warning: cannot open directory `/usr/share/locale': No such file or directory.
Installation finished. No error reported.
2016-10-21 13:20:24 Including finalize/Linux-i386/23_run_efibootmgr.sh
2016-10-21 13:20:24 Including finalize/GNU/Linux/30_create_mac_mapping.sh
2016-10-21 13:20:24 Including finalize/GNU/Linux/41_migrate_udev_rules.sh
2016-10-21 13:20:24 Including finalize/GNU/Linux/42_migrate_network_configuration_files.sh
2016-10-21 13:20:24 Including finalize/default/88_check_for_mount_by_id.sh
2016-10-21 13:20:24 Including finalize/default/89_finish_checks.sh
2016-10-21 13:20:24 Including finalize/default/90_remount_sync.sh
2016-10-21 13:20:24 Finished running 'finalize' stage in 1 seconds
2016-10-21 13:20:24 Running 'wrapup' stage
2016-10-21 13:20:24 Including wrapup/default/50_post_recovery_script.sh
2016-10-21 13:20:24 Including wrapup/default/98_good_bye.sh
2016-10-21 13:20:24 Including wrapup/default/99_copy_logfile.sh
2016-10-21 13:20:24 Finished running 'wrapup' stage in 0 seconds
2016-10-21 13:20:24 Finished running recover workflow
2016-10-21 13:20:24 Running exit tasks.
</code></pre>
<p>Now what next?</p>
<p>Regards,</p>
<h4 id="rpasche_commented_at_2016-10-21_1334"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255378069">2016-10-21 13:34</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-21_1334" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix ,</p>
<p>maybe you can give me a hint. It's of course possible, that I was to
blind to setup a configuration for our needs without developing the
MANUAL_INCLUDE mode.</p>
<p>How do you create a config and define only a "standard" set of
filesystems that you want to backup and ignore everything else that
could be added in future, without the need to edit the configuration?</p>
<p>If I'm able to setup such a configuration, MANUAL_INCLUDE could be
thrown away... ;-)</p>
<p>Meanwhile, started digging into the code again...<br />
Regards,</p>
<h4 id="rpasche_commented_at_2016-10-21_1401"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-255385006">2016-10-21 14:01</a>:<a class="headerlink" href="#rpasche_commented_at_2016-10-21_1401" title="Permanent link">&para;</a></h4>
<p>I just also found the error, why the filesystems are listed twice for
backup. It is in</p>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/40_create_include_exclude_files.sh">https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/40_create_include_exclude_files.sh</a></p>
<p>Because everything from BACKUP_PROG_INCLUDE is added to
backup-include.txt and all mountpoints NOT in EXCLUDE_MOUNTPOINTS. This
is - truely - an error, when running in MANUAL_INCLUDE mode. The
mounpoints in mountpoint_device should NOT be added to the
backup-include.txt list if in MANUAL_INCLUDE mode as
BACKUP_PROG_INCLUDE is used.</p>
<p>But I have to test this...</p>
<p>Regards,</p>
<h4 id="jsmeix_commented_at_2016-11-08_0905"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-259082487">2016-11-08 09:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-08_0905" title="Permanent link">&para;</a></h4>
<p>@rpasche<br />
many thanks for working on the MANUAL_INCLUDE mode!</p>
<p>@John-Leone<br />
if you like to test if current ReaR GitHub master code<br />
(that contains
<a href="https://github.com/rear/rear/pull/1060">https://github.com/rear/rear/pull/1060</a>)<br />
now works o.k. for you in MANUAL_INCLUDE mode:</p>
<p>How to test the currently newest rear GitHub master code:</p>
<p>Basically "git clone" it into a directory and<br />
then run rear from within that directory like:</p>
<pre>
# git clone https://github.com/rear/rear.git
# cd rear
# vi etc/rear/local.conf
# usr/sbin/rear -d -D mkbackup
</pre>

<h4 id="john-leone_commented_at_2016-11-10_2134"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-259814068">2016-11-10 21:34</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-10_2134" title="Permanent link">&para;</a></h4>
<p>Hello Johannes,<br />
The MANUAL_INCLUDE=YES did not work as expected, the recovery restored
all the file systems.<br />
I was expecting /home and /u01 not to be recovered.</p>
<p>Please check below; is there something wrong with my configuration
files?<br />
For testing I used a Cisco C240 physical server running RHEL 6.8</p>
<p>[root@xsmithm1d rear]# cat local.conf</p>
<h2 id="john_added_the_lines_below">John added the lines below.<a class="headerlink" href="#john_added_the_lines_below" title="Permanent link">&para;</a></h2>
<p>OUTPUT=ISO<br />
OUTPUT_URL=sshfs://root@xxx.xx.xx.xx/dbar/<br />
BACKUP=NETFS<br />
BACKUP_URL=sshfs://root@xxx.xx.xx.xx/dbar/<br />
SSH_ROOT_PASSWORD="redhat"<br />
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media'
'/var/tmp' '/var/crash')<br />
MANUAL_INCLUDE=YES<br />
BACKUP_PROG_INCLUDE=("${BACKUP_PROG_INCLUDE[@]}" '/boot' '/'
'/opt' '/midrange' '/tmp' '/var' )<br />
NETFS_KEEP_OLD_BACKUP_COPY=</p>
<p>I did…..</p>
<p>[root@xladmm1p ~]# ssh -A xsmithm1d "/root/rear-master/usr/sbin/rear
-d -D mkbackup"<br />
Relax-and-Recover 1.19 / Git<br />
Using log file: /root/rear-master/var/log/rear/rear-xsmithm1d.log<br />
insmod /lib/modules/2.6.32-642.3.1.el6.x86_64/kernel/fs/fuse/fuse.ko<br />
Creating disk layout<br />
Excluding mountpoint /home. (MANUAL_INCLUDE mode)<br />
Excluding mountpoint /u01. (MANUAL_INCLUDE mode)<br />
Creating root filesystem layout<br />
Copying files and directories<br />
Copying binaries and libraries<br />
Copying kernel modules<br />
Creating initramfs<br />
Making ISO image<br />
Wrote ISO image:
/root/rear-master/var/lib/rear/output/rear-xsmithm1d.iso (89M)<br />
Copying resulting files to sshfs location<br />
Encrypting disabled<br />
Creating tar archive
'/tmp/rear.oqfXxaujNSgKPLj/outputfs/xsmithm1d/backup.tar.gz'<br />
Preparing archive operation OK<br />
Archived 1337 MiB in 212 seconds [avg 6460 KiB/sec]<br />
You should also rm -Rf /tmp/rear.oqfXxaujNSgKPLj</p>
<p>Result……..</p>
<p>[root@xsmithm1d rear]# df -h<br />
Filesystem Size Used Avail Use% Mounted on<br />
/dev/mapper/rootvg-root<br />
7.8G 2.2G 5.6G 28% /<br />
tmpfs 16G 0 16G 0% /dev/shm<br />
/dev/sda1 488M 111M 378M 23% /boot<br />
/dev/mapper/rootvg-home<br />
5.8G 13M 5.8G 1% /home<br />
/dev/mapper/rootvg-midrange<br />
4.8G 212M 4.6G 5% /midrange<br />
/dev/mapper/rootvg-opt<br />
7.8G 543M 7.3G 7% /opt<br />
/dev/mapper/rootvg-tmp<br />
7.8G 797M 7.0G 11% /tmp<br />
/dev/mapper/rootvg-var<br />
9.8G 1.1G 8.2G 12% /var<br />
/dev/mapper/rootvg-u01<br />
20G 44M 19G 1% /u01</p>
<p>Also…..<br />
The recovery image configured the network as rename4 and I needed
activate the rename4 interface to start the recovery, network works fine
with Rear Version1.17.2</p>
<p>RESCUE xsmithm1d:~ # ip addr show<br />
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state
UNKNOWN<br />
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br />
inet 127.0.0.1/8 scope host lo<br />
inet6 ::1/128 scope host<br />
valid_lft forever preferred_lft forever<br />
2: eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc mq state DOWN qlen
1000<br />
link/ether 90:e2:ba:84:d9:d0 brd ff:ff:ff:ff:ff:ff<br />
3: eth3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen
1000<br />
link/ether 90:e2:ba:84:d9:d1 brd ff:ff:ff:ff:ff:ff<br />
4: rename4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq
state UP qlen 1000<br />
link/ether f4:4e:05:9f:44:9e brd ff:ff:ff:ff:ff:ff<br />
inet xxx.xxx.xxx.xx/24 scope global rename4<br />
inet6 fe80::f64e:5ff:fe9f:449e/64 scope link<br />
valid_lft forever preferred_lft forever<br />
5: eth1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen
1000<br />
link/ether f4:4e:05:9f:44:9f brd ff:ff:ff:ff:ff:ff</p>
<h4 id="jsmeix_commented_at_2016-11-11_0846"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-259909516">2016-11-11 08:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-11_0846" title="Permanent link">&para;</a></h4>
<p>@John-Leone FYI:<br />
currently I do not work on this issue,<br />
perhaps at a later time - as time permits - but no guarantee.</p>
<h4 id="john-leone_commented_at_2016-11-11_1230"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-259947695">2016-11-11 12:30</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-11_1230" title="Permanent link">&para;</a></h4>
<p>Thanks for the update.</p>
<h4 id="rpasche_commented_at_2016-11-11_1527"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-259981426">2016-11-11 15:27</a>:<a class="headerlink" href="#rpasche_commented_at_2016-11-11_1527" title="Permanent link">&para;</a></h4>
<p>@John-Leone<br />
Can you provide the backup.log and recovery.log and also
<code>disklayout.conf</code> and <code>disktodo.conf</code></p>
<h4 id="rpasche_commented_at_2016-11-11_1739"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-260011918">2016-11-11 17:39</a>:<a class="headerlink" href="#rpasche_commented_at_2016-11-11_1739" title="Permanent link">&para;</a></h4>
<p>Can you also show output of <code>pvs</code>, <code>lvs</code> and <code>vgs</code>? Do you actually have
contents restored to /u01 or /home? Looks pretty small.</p>
<h4 id="john-leone_commented_at_2016-11-14_2054"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-260459368">2016-11-14 20:54</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-14_2054" title="Permanent link">&para;</a></h4>
<p>I have uploaded the files as requested, please see rear.tar.gz</p>
<p><a href="https://github.com/rear/rear/files/590448/rear.tar.gz">https://github.com/rear/rear/files/590448/rear.tar.gz</a></p>
<h4 id="john-leone_commented_at_2016-11-14_2058"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-260460591">2016-11-14 20:58</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-14_2058" title="Permanent link">&para;</a></h4>
<p>Below is the output from lvs, pvs and vgs.<br />
For testing purposes I created /u01 and put very small files on the
filesytem, then I expected /u01 and /home to be excluded during the
recovery.</p>
<pre><code>[root@xsmithm1d recover]# lvs
  LV       VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  home     rootvg -wi-ao----  6.00g
  midrange rootvg -wi-ao----  5.00g
  opt      rootvg -wi-ao----  8.00g
  origroot rootvg -wi-a----- 11.00g
  origvar  rootvg -wi-a----- 13.00g
  root     rootvg -wi-ao----  8.00g
  swap     rootvg -wi-ao----  8.00g
  tmp      rootvg -wi-ao----  8.00g
  u01      rootvg -wi-ao---- 20.00g
  var      rootvg -wi-ao---- 10.00g

[root@xsmithm1d recover]# pvs
  PV         VG     Fmt  Attr PSize PFree
  /dev/sda2  rootvg lvm2 a--u 1.09t 1018.22g

[root@xsmithm1d recover]# vgs
  VG     #PV #LV #SN Attr   VSize VFree
  rootvg   1  10   0 wz--n- 1.09t 1018.22g
</code></pre>
<h4 id="rpasche_commented_at_2016-11-15_2122"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-260772408">2016-11-15 21:22</a>:<a class="headerlink" href="#rpasche_commented_at_2016-11-15_2122" title="Permanent link">&para;</a></h4>
<p>@John-Leone</p>
<p>So after looking into the files, I have some questions regarding your
restore tests.</p>
<p>Is this a test machine and did you "wipe" the disks before you tried to
recover? To me, it looks like the neither /u01 nor /home have been
backuped nor restored.</p>
<pre><code>grep -E '/(home|u01)' backup.log
block 226236: /u01/
block 1653949: /usr/lib64/python2.6/site-packages/matplotlib/mpl-data/images/home.png
block 1653976: /usr/lib64/python2.6/site-packages/matplotlib/mpl-data/images/home.svg
block 1654060: /usr/lib64/python2.6/site-packages/matplotlib/mpl-data/images/home.ppm
block 1654118: /usr/lib64/python2.6/site-packages/matplotlib/mpl-data/images/home.xpm
block 3592346: /usr/share/doc/libxslt-1.1.26/EXSLT/html/home.png
block 3594513: /usr/share/doc/libxslt-1.1.26/html/home.png
block 3647508: /usr/share/doc/valgrind-3.8.1/html/images/home.png
block 3966491: /etc/selinux/targeted/modules/active/homedir_template
block 4222545: /home/
</code></pre>
<p>The "directories" have been backuped...but that's normal as the
directories itself are stored on /.<br />
I also see, that the filesystems of /home and /u01 have not been
restored. What I see, is that the LVMs have been restored (the complete
VG with <code>vgcfgrestore</code>). Because of that, the "original" fs of <code>/home</code>
and <code>/u01</code> have been found again. That's why the files on /home and /u01
are present "again".</p>
<p>It would be cool, if you could try your backup and recover again. But
this time, wipe the whole disk before you try to recover, if this is
possible for you.</p>
<h4 id="jsmeix_commented_at_2016-11-16_0939"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-260899147">2016-11-16 09:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-16_0939" title="Permanent link">&para;</a></h4>
<p>A side note FYI regarding "wipe the disk":<br />
We have a pending issue for that, see<br />
<a href="https://github.com/rear/rear/issues/799">https://github.com/rear/rear/issues/799</a></p>
<h4 id="john-leone_commented_at_2016-11-16_2214"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-261089492">2016-11-16 22:14</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-16_2214" title="Permanent link">&para;</a></h4>
<p>I tested again, this is what I did:</p>
<ol>
<li>First "rear -v mkbackup"</li>
<li>next, deleted everything from /home</li>
<li>then, un-mounted /u01 &amp; " lvremove /dev/mapper/rootvg-u01"</li>
</ol>
<p>This is the local.conf file</p>
<h2 id="john_added_the_lines_below_1">John added the lines below.<a class="headerlink" href="#john_added_the_lines_below_1" title="Permanent link">&para;</a></h2>
<p>OUTPUT=ISO<br />
OUTPUT_URL=sshfs://root@xxx.xx.xx.xx/dbar/<br />
BACKUP=NETFS<br />
BACKUP_URL=sshfs://root@xxx.xx.xx.xx/dbar/<br />
SSH_ROOT_PASSWORD="redhat"<br />
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media' )<br />
MANUAL_INCLUDE=YES<br />
BACKUP_PROG_INCLUDE=("${BACKUP_PROG_INCLUDE[@]}" '/boot' '/'
'/opt' '/midrange' '/tmp' '/var' )<br />
NETFS_KEEP_OLD_BACKUP_COPY=</p>
<p>After the system was recovered /home was mounted but still empty.<br />
and /u01 was recovered and mounted.</p>
<p>Since "BACKUP_PROG_INCLUDE" statement did not include /u01 &amp; /home I
didn't expect /u01 to be restored and /home was restored but none of the
files were recovered.</p>
<h4 id="rpasche_commented_at_2016-11-17_0803"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-261180648">2016-11-17 08:03</a>:<a class="headerlink" href="#rpasche_commented_at_2016-11-17_0803" title="Permanent link">&para;</a></h4>
<p>Hi @John-Leone ,</p>
<p>the only thing you can blame MANUAL_INCLUDE mode right now, as ít -
currently - does NOT "remove" a logical volume of the filesystem, that
had been ignored "after" the whole volume group has been restored.</p>
<blockquote>
<p>After the system was recovered /home was mounted but still empty.</p>
</blockquote>
<p>Well....this is what you wanted, hey? At least, that nothing has been
restored, as nothing has been backuped.</p>
<blockquote>
<p>and /u01 was recovered and mounted.</p>
</blockquote>
<p>Just to explain again, what is happening.</p>
<p>The whole volume group gets restored within recovery (with
<code>vgcfgrestore</code>, "including" the logical volumes for <code>/home</code> and <code>/u01</code>
in your case.<br />
So your systems knows, that there are 2 logical volumes with <code>/home</code> and
<code>/u01</code> again. And because you did not overwrite a range of sectores with
zeros (or random crap) where <code>/home</code> and <code>/u01</code> started, your filesystem
drivers will find a <code>valid</code> filesystem ready to mount again. And because
nothing has been backuped from /home (because it was excluded), nothing
has been restored...hence, it's empty.</p>
<p>The same with <code>/u01</code>. Just removing the logical volume with <code>lvremove</code>
won't destroy the filesystem <code>in it</code>. You just removed some metadata
about the name, size, startsector, endsector and some other stuff from
LVM. But we restored this information with <code>vgcfgrestore</code> so everything
is found again on <code>/u01</code>.</p>
<p>Currently, my first opinion would be, to remove the logical volumes
after <code>vgcfgrestore</code> has restored the information within recovery to fix
this. I'll have to check this.</p>
<p>To "quickly" fix this iin your case, you could just "lvremove" <code>/home</code>
and <code>/u01</code> after restore has finished and your setup should look as
expected.</p>
<h4 id="rpasche_commented_at_2016-11-17_1118"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-261221869">2016-11-17 11:18</a>:<a class="headerlink" href="#rpasche_commented_at_2016-11-17_1118" title="Permanent link">&para;</a></h4>
<p>Hmm...looks like in <code>MIGRATION_MODE</code> the parts of the LVM get recreated
step by step. Still looking....</p>
<h4 id="john-leone_commented_at_2016-11-30_1850"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-263959740">2016-11-30 18:50</a>:<a class="headerlink" href="#john-leone_commented_at_2016-11-30_1850" title="Permanent link">&para;</a></h4>
<p>@rpasche<br />
Are you still working on MANUAL_INCLUDE mode?</p>
<h4 id="rpasche_commented_at_2016-12-01_0838"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-264111605">2016-12-01 08:38</a>:<a class="headerlink" href="#rpasche_commented_at_2016-12-01_0838" title="Permanent link">&para;</a></h4>
<p>Yes....somehow....but I'm currently not sure, if the current situation
is a "real" problem.</p>
<p>I don't think, that it is. The main feature of ReaR is to recover the
system to a state that it was before a crash. And this is what it did.
It did not touch the filesystems <code>/home</code> or <code>/u01</code>, To be more
precise...it did NOT RECREATE the filesystems on those 2 volumes. For me
it sounds that you like your system to look different after a recover as
you don't want that <code>/home</code> or <code>/u01</code> be recovered.</p>
<p>Just another point....if the logical volumes of <code>/home</code> and <code>/u01</code> would
not be recovered, all your data that you store in those 2 directories
(after you took the server back into production after the recover) will
consume space on the <code>/</code> filesystem.</p>
<p>Regards...</p>
<h4 id="jsmeix_commented_at_2016-12-01_1011"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-264132715">2016-12-01 10:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-12-01_1011" title="Permanent link">&para;</a></h4>
<p>To only specify what is in the backup independent<br />
form what components (e.g. partitions, filesystems, ...)<br />
will be recreated (or excluded from being recreated)<br />
the following could be of interest:</p>
<p>While implementing<br />
<a href="https://github.com/rear/rear/issues/1088">https://github.com/rear/rear/issues/1088</a><br />
I needed functionality to specify exactly without ReaR's implicit<br />
automagic what I want to have in the backup and what not<br />
(but it must work in a backward compatible way so that<br />
I cannot simply remove ReaR's implicit automagic here).</p>
<p>Therefore via<br />
<a href="https://github.com/rear/rear/pull/1091">https://github.com/rear/rear/pull/1091</a><br />
I invented BACKUP_ONLY_INCLUDE<br />
so that I do not have to use MANUAL_INCLUDE=YES<br />
and - by the way - I invented also its logical counterpart<br />
BACKUP_ONLY_EXCLUDE which could be useful to get things<br />
in the backup that are not intended to be restored (i.e. have<br />
the content of EXCLUDE_MOUNTPOINTS in the backup).</p>
<p>I think in general a backup should be complete<br />
(i.e. basically it should contain all regular files - except tmp
files)<br />
regardless what exactly is actually needed to be restored,<br />
see also EXCLUDE_RESTORE versus<br />
BACKUP_RESTORE_MOVE_AWAY_FILES<br />
in default.conf.</p>
<p>This means in current GitHub 'master' code<br />
there are now the new boolean variables<br />
BACKUP_ONLY_INCLUDE and<br />
BACKUP_ONLY_EXCLUDE used in<br />
backup/NETFS/default/400_create_include_exclude_files.sh</p>
<p>I.e. currently it only works for those backupo methods that use<br />
backup/NETFS/default/400_create_include_exclude_files.sh<br />
which are NETFS, RSYNC, and BORG because<br />
backup/BORG/default/400_create_include_exclude_files.sh<br />
and<br />
backup/RSYNC/default/400_create_include_exclude_files.sh<br />
are symbolic links to<br />
backup/NETFS/default/400_create_include_exclude_files.sh</p>
<p>Cf. the section about<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
that reads in particular (excerpt):</p>
<pre>
It is very different to what extent support for
each individual backup tool is implemented
in ReaR because support for each individual
backup tool is implemented separated
from each other.
</pre>

<p>How it works:</p>
<p>When BACKUP_ONLY_INCLUDE is set to a 'true' value<br />
only what is specified in BACKUP_PROG_INCLUDE<br />
will be in the backup but not implicitly also all local filesystems<br />
as defined in mountpoint_device.</p>
<p>When BACKUP_ONLY_EXCLUDE is set to a 'true' value<br />
only what is specified in BACKUP_PROG_EXCLUDE<br />
will be excluded from the backup but not implicitly also<br />
all excluded mountpoints in EXCLUDE_MOUNTPOINTS.</p>
<h4 id="rpasche_commented_at_2016-12-01_1044"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-264139257">2016-12-01 10:44</a>:<a class="headerlink" href="#rpasche_commented_at_2016-12-01_1044" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Wow! You have been busy. I have to test this new stuff at the other
customer when I'm there the next time.</p>
<h4 id="gdha_commented_at_2017-01-07_1117"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-271077493">2017-01-07 11:17</a>:<a class="headerlink" href="#gdha_commented_at_2017-01-07_1117" title="Permanent link">&para;</a></h4>
<p>@John-Leone @jsmeix @rpasche It would be nice to get rid of
<code>MANUAL_INCLUDE</code> variable when the variables of @jsmeix
<code>BACKUP_PROG_INCLUDE</code> and <code>BACKUP_PROG_EXCLUDE</code> are proven to work as
designed. Sure, more testing is required, but at least we have a goal
for ReaR v2.1, right?</p>
<h4 id="rpasche_commented_at_2017-01-07_1143"><img src="https://avatars.githubusercontent.com/u/12664472?u=7d93437b713d9a1a67b448b34f2c0a6576a0930e&v=4" width="50"><a href="https://github.com/rpasche">rpasche</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-271078802">2017-01-07 11:43</a>:<a class="headerlink" href="#rpasche_commented_at_2017-01-07_1143" title="Permanent link">&para;</a></h4>
<p>Am 7. Januar 2017 12:17:15 MEZ schrieb gdha <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>:</p>
<blockquote>
<p>@John-Leone @jsmeix @rpasche It would be nice to get rid of<br />
<code>MANUAL_INCLUDE</code> variable when the variables of @jsmeix<br />
<code>BACKUP_PROG_INCLUDE</code> and <code>BACKUP_PROG_EXCLUDE</code> are proven to work
as<br />
designed. Sure, more testing is required, but at least we have a
goal<br />
for ReaR v2.1, right?</p>
</blockquote>
<p>True but unfortunately I had no time yet to test the new version 🙁</p>
<h4 id="john-leone_commented_at_2017-01-08_1522"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-271157398">2017-01-08 15:22</a>:<a class="headerlink" href="#john-leone_commented_at_2017-01-08_1522" title="Permanent link">&para;</a></h4>
<p>@John-Leone @jsmeix @rpasche @gdha<br />
Thanks for the update.</p>
<h4 id="john-leone_commented_at_2017-01-11_2141"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-272003951">2017-01-11 21:41</a>:<a class="headerlink" href="#john-leone_commented_at_2017-01-11_2141" title="Permanent link">&para;</a></h4>
<p>@jsmeix @rpasche @gdha<br />
I was wondering what is the ETA for ReaR v2.1?</p>
<h4 id="jsmeix_commented_at_2017-01-12_0832"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-272104213">2017-01-12 08:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-12_0832" title="Permanent link">&para;</a></h4>
<p>see<br />
<a href="https://github.com/rear/rear/milestones">https://github.com/rear/rear/milestones</a></p>
<h4 id="john-leone_commented_at_2017-02-03_1748"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-277314414">2017-02-03 17:48</a>:<a class="headerlink" href="#john-leone_commented_at_2017-02-03_1748" title="Permanent link">&para;</a></h4>
<p>@jsmeix @gdha @rpasche I think the intent for MANUAL_INCLUDE was to
define only the file systems you need backed-up then the others would be
ignored so you don't consume all the DASD on the NFS share.
BACKUP_PROG_EXCLUDE works fine but since each server is different we
need to add which items need to be excluded.</p>
<h4 id="gdha_commented_at_2017-04-25_1823"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-297121501">2017-04-25 18:23</a>:<a class="headerlink" href="#gdha_commented_at_2017-04-25_1823" title="Permanent link">&para;</a></h4>
<p>@rpasche @jsmeix @John-Leone I think we can close this issue, no?</p>
<h4 id="jsmeix_commented_at_2017-04-26_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1019#issuecomment-297343684">2017-04-26 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-04-26_1032" title="Permanent link">&para;</a></h4>
<p>I close it because with BACKUP_ONLY_INCLUDE<br />
and BACKUP_ONLY_EXCLUDE there is an<br />
alternative to MANUAL_INCLUDE so that now<br />
users can use what fits best for them.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-09-30.1019.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
