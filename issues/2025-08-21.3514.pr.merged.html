<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3514 PR merged: Fix parsing of workflow command line arguments - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3514 PR merged: Fix parsing of workflow command line arguments";
        var mkdocs_page_input_path = "issues/2025-08-21.3514.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3514 PR merged: Fix parsing of workflow command line arguments</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3514_pr_merged_fix_parsing_of_workflow_command_line_arguments"><a href="https://github.com/rear/rear/pull/3514">#3514 PR</a> <code>merged</code>: Fix parsing of workflow command line arguments<a class="headerlink" href="#3514_pr_merged_fix_parsing_of_workflow_command_line_arguments" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="lzaoral_opened_issue_at_2025-08-21_1259"><img src="https://avatars.githubusercontent.com/u/48823770?v=4" width="50"><a href="https://github.com/lzaoral">lzaoral</a> opened issue at <a href="https://github.com/rear/rear/pull/3514">2025-08-21 12:59</a>:<a class="headerlink" href="#lzaoral_opened_issue_at_2025-08-21_1259" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Critical</strong></p>
</li>
<li>
<p>Reference to related issue (URL):
    <a href="https://github.com/rear/rear/pull/3500#issuecomment-3206558501">https://github.com/rear/rear/pull/3500#issuecomment-3206558501</a></p>
</li>
<li>
<p>How was this pull request tested? <code>rear format -- -y /dev/&lt;DEVICE&gt;</code>
    on RHEL 8 and 10</p>
</li>
<li>
<p>Description of the changes in this pull request:<br />
    Workflows expect that "$@" will not contain anything before the <code>--</code>
    argument. Fixes the following failure:</p>
</li>
</ul>
<!-- -->

<pre><code>$ rear format -- /dev/sdb
ERROR: Argument 'format' not accepted. Use 'rear format -- --help' for more information.
</code></pre>
<p>Partially reverts commit a2fe977d3cac54e1dcdad49146f822217c2b83d1.</p>
<h4 id="pcahyna_commented_at_2025-08-21_1357"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3210731169">2025-08-21 13:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-08-21_1357" title="Permanent link">&para;</a></h4>
<p>I think we should wait for @jsmeix to explain why he has moved the line
in #3500 .</p>
<h4 id="jsmeix_commented_at_2025-09-02_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3245380625">2025-09-02 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-02_1335" title="Permanent link">&para;</a></h4>
<p>Argh!</p>
<p>Now I see it why the part</p>
<pre><code># Keep the remaining command line arguments to feed to the workflow:
ARGS=( "$@" )
</code></pre>
<p>must be after the</p>
<pre><code># Set workflow to first command line argument or to "help" as fallback:
if test -z "$WORKFLOW" ; then
    # Usually workflow is now in $1 (after the options and its arguments were shifted above)
    # but when rear is called without a workflow there exists no $1 here so that
    # an empty default value is used to avoid 'set -eu' error exit if $1 is unset:
    if test "${1:-}" ; then
        # Not "$1" to get rid of compound commands:
        WORKFLOW=$1
        shift
    else
        WORKFLOW=help
    fi
fi
</code></pre>
<p>part.<br />
Because therein <code>$1</code> is used<br />
so <code>the remaining command line arguments</code><br />
are those except the workflow command line argument.</p>
<p>I moved it up directly after the <code>Parse options</code> part<br />
because I falsely thought <code>the remaining command line arguments</code><br />
are all after the options so it belongs there.</p>
<p>Now I think the proper ordering so that<br />
what belongs together is kept together in the code<br />
(cf. "Code must be easy to understand" in our "Coding Style")<br />
should be:</p>
<pre><code># Parse options
help_note_text="Use '$PROGRAM --help' or 'man $PROGRAM' for more information."

...

    shift
done

# Set workflow to first command line argument or to "help" as fallback:
if test -z "$WORKFLOW" ; then
    # Usually workflow is now in $1 (after the options and its arguments were shifted above)
    # but when rear is called without a workflow there exists no $1 here so that
    # an empty default value is used to avoid 'set -eu' error exit if $1 is unset:
    if test "${1:-}" ; then
        # Not "$1" to get rid of compound commands:
        WORKFLOW=$1
        shift
    else
        WORKFLOW=help
    fi
fi

# Keep the remaining command line arguments to feed to the workflow:
ARGS=( "$@" )

# End of handling command line options and arguments.

# Set RECOVERY_MODE when we are running inside a rescue/recovery system
# which is normally ReaR's recovery system or alternatively in PORTABLE mode
# it is a foreign rescue system like the System Rescue CD or the Ubuntu Desktop Live CD,
# see doc/user-guide/17-Portable-Mode.adoc
# RECOVERY_MODE is a boolean variable (cf. conf/default.conf) because we need it below
# to set TMPDIR to ReaR's TMP_DIR only when we are not running inside a rescue/recovery system
# but we do not yet have lib/global-functions.sh (which contains is_true/is_false) sourced there.
# In ReaR's recovery system /etc/rear-release is unique (it does not exist otherwise)
# see build/default/970_add_rear_release.sh that adds it to identify ReaR's rescue environment.
# PORTABLE mode is meant to be used only to run 'rear recover' within a foreign rescue system,
# see https://github.com/rear/rear/pull/3206#issuecomment-2122173021
if test -e "/etc/rear-release" || test "$PORTABLE" ; then
    RECOVERY_MODE=1
fi

# Set alternative config directory unless in recovery mode
# because the contents of an alternative config directory
# get stored in the ReaR recovery system in /etc/rear
# so "rear recover" does not work with '-c'
# see https://github.com/rear/rear/issues/512#issuecomment-68051604
# and https://github.com/rear/rear/issues/2942#issuecomment-3132425914
if test "$ALTERNATIVE_CONFIG_DIR" ; then
    if test "$RECOVERY_MODE" ; then
@@ -326,26 +323,29 @@
    fi
    if ! test -d "$ALTERNATIVE_CONFIG_DIR" ; then
        # 'test -d something' is also true when something is a symlink to an existing directory
        echo "ERROR: The '-c' option argument '$ALTERNATIVE_CONFIG_DIR' is not a directory" &gt;&amp;2
        exit 1
    fi
    CONFIG_DIR="$ALTERNATIVE_CONFIG_DIR"
fi
</code></pre>
<h4 id="jsmeix_commented_at_2025-09-02_1339"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3245395201">2025-09-02 13:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-02_1339" title="Permanent link">&para;</a></h4>
<p>@lzaoral @pcahyna<br />
do you agree to my proposed ordering of code parts in<br />
<a href="https://github.com/rear/rear/pull/3514#issuecomment-3245380625">https://github.com/rear/rear/pull/3514#issuecomment-3245380625</a><br />
or is this again somehow wrong?</p>
<h4 id="pcahyna_commented_at_2025-09-03_0942"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3248499687">2025-09-03 09:42</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-09-03_0942" title="Permanent link">&para;</a></h4>
<p>@jsmeix before I look at it in detail, can you please explain what was
wrong with the original (before the change in
<a href="https://github.com/rear/rear/commit/a2fe977d3cac54e1dcdad49146f822217c2b83d1#diff-c88d8e622898fcfe3f447b77fe254dc6cc45a5152afa771e666be10971bfb01eR297">https://github.com/rear/rear/commit/a2fe977d3cac54e1dcdad49146f822217c2b83d1#diff-c88d8e622898fcfe3f447b77fe254dc6cc45a5152afa771e666be10971bfb01eR297</a>
) ordering that is proposed to be restored here?<br />
I would like to know why it is needed to change it (from the original
version) before reviewing the change.</p>
<h4 id="jsmeix_commented_at_2025-09-03_1325"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3249255111">2025-09-03 13:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-03_1325" title="Permanent link">&para;</a></h4>
<p>Nothing was "wrong" with the original<br />
when "wrong" means "a bug in the code".</p>
<p>But the ordering was "wrong" when "wrong" means that<br />
the ordering of code parts was confusing or misleading<br />
because it intermixed different things<br />
(at least as far as I can see currently).</p>
<p>Initially it was</p>
<pre><code># Parse options
...
# Set workflow to first command line argument or to "help" as fallback:
...
# Keep the remaining command line arguments to feed to the workflow:
</code></pre>
<p>There what belongs together is kept together in the code<br />
i.e. the whole handling command line options and arguments.</p>
<p>Then I falsey inserted the new parts</p>
<pre><code># Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
</code></pre>
<p>in between like</p>
<pre><code># Parse options
...
# Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
...
# Set workflow to first command line argument or to "help" as fallback:
...
# Keep the remaining command line arguments to feed to the workflow:
</code></pre>
<p>and I noticed that the part</p>
<pre><code># Keep the remaining command line arguments to feed to the workflow:
</code></pre>
<p>belongs to</p>
<pre><code># Parse options
</code></pre>
<p>so I moved it up to the current mess which caused a bug<br />
because currently the ordering is "wrong" where<br />
"wrong" means "a bug in the code"</p>
<pre><code># Parse options
...
# Keep the remaining command line arguments to feed to the workflow:
...
# Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
...
# Set workflow to first command line argument or to "help" as fallback:
</code></pre>
<p>Now - as far as I can see - the correct ordering should be</p>
<pre><code># Parse options
...
# Set workflow to first command line argument or to "help" as fallback:
...
# Keep the remaining command line arguments to feed to the workflow:
...
# Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
</code></pre>
<p>i.e. keep the original three parts which are handling<br />
command line options and arguments</p>
<pre><code># Parse options
...
# Set workflow to first command line argument or to "help" as fallback:
...
# Keep the remaining command line arguments to feed to the workflow:
</code></pre>
<p>together as it was initially<br />
and afterwards add the two new parts</p>
<pre><code># Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
</code></pre>
<p>Technically what is proposed in this pull request</p>
<pre><code># Parse options
...
# Set RECOVERY_MODE when we are running inside a rescue/recovery system
...
# Set alternative config directory unless in recovery mode
...
# Set workflow to first command line argument or to "help" as fallback:
...
# Keep the remaining command line arguments to feed to the workflow:
</code></pre>
<p>works - i.e. there is no bug - but as far as I can see<br />
the two new parts do not belong in between the original three parts.</p>
<h4 id="pcahyna_commented_at_2025-09-08_1008"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3265569945">2025-09-08 10:08</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-09-08_1008" title="Permanent link">&para;</a></h4>
<p>@jsmeix I suppose this would be the complete diff that you propose:</p>
<pre><code>diff --git a/usr/sbin/rear b/usr/sbin/rear
index e519ddb71..6cce0d18e 100755
--- a/usr/sbin/rear
+++ b/usr/sbin/rear
@@ -293,9 +293,25 @@ while true ; do
     shift
 done

+# Set workflow to first command line argument or to "help" as fallback:
+if test -z "$WORKFLOW" ; then
+    # Usually workflow is now in $1 (after the options and its arguments were shifted above)
+    # but when rear is called without a workflow there exists no $1 here so that
+    # an empty default value is used to avoid 'set -eu' error exit if $1 is unset:
+    if test "${1:-}" ; then
+        # Not "$1" to get rid of compound commands:
+        WORKFLOW=$1
+        shift
+    else
+        WORKFLOW=help
+    fi
+fi
+
 # Keep the remaining command line arguments to feed to the workflow:
 ARGS=( "$@" )

+# End of handling command line options and arguments.
+
 # Set RECOVERY_MODE when we are running inside a rescue/recovery system
 # which is normally ReaR's recovery system or alternatively in PORTABLE mode
 # it is a foreign rescue system like the System Rescue CD or the Ubuntu Desktop Live CD,
@@ -332,20 +348,6 @@ if test "$ALTERNATIVE_CONFIG_DIR" ; then
     CONFIG_DIR="$ALTERNATIVE_CONFIG_DIR"
 fi

-# Set workflow to first command line argument or to "help" as fallback:
-if test -z "$WORKFLOW" ; then
-    # Usually workflow is now in $1 (after the options and its arguments were shifted above)
-    # but when rear is called without a workflow there exists no $1 here so that
-    # an empty default value is used to avoid 'set -eu' error exit if $1 is unset:
-    if test "${1:-}" ; then
-        # Not "$1" to get rid of compound commands:
-        WORKFLOW=$1
-        shift
-    else
-        WORKFLOW=help
-    fi
-fi
-
 # The following workflows are always verbose:
 case "$WORKFLOW" in
     (validate|shell|recover|mountonly)
</code></pre>
<p>This reordering looks good to me.</p>
<h4 id="jsmeix_commented_at_2025-09-08_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3266391410">2025-09-08 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-08_1340" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes,<br />
<a href="https://github.com/rear/rear/pull/3514#issuecomment-3265569945">https://github.com/rear/rear/pull/3514#issuecomment-3265569945</a><br />
is the complete diff I propose.</p>
<p>Should I make a pull request for this change<br />
or would you or @lzaoral do it via this pull request here?</p>
<h4 id="lzaoral_commented_at_2025-09-08_1344"><img src="https://avatars.githubusercontent.com/u/48823770?v=4" width="50"><a href="https://github.com/lzaoral">lzaoral</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3266412227">2025-09-08 13:44</a>:<a class="headerlink" href="#lzaoral_commented_at_2025-09-08_1344" title="Permanent link">&para;</a></h4>
<p>@jsmeix No need to create a new PR, I'll rebase this one.</p>
<h4 id="pcahyna_commented_at_2025-09-08_1401"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3266480164">2025-09-08 14:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-09-08_1401" title="Permanent link">&para;</a></h4>
<p>By the way, I tried letting Claude Code analyze the proposed change.</p>
<p>I used the prompt</p>
<blockquote>
<p>There is an uncommitted change in this repository, some code blocks
are<br />
reordered. The goal of the change is to improve readability, no
functional<br />
change is acceptable. Our task is to review the change. Is there
really no<br />
functional change caused by the reordering?</p>
</blockquote>
<p>and the answer:</p>
<pre><code>  Analysis of the code reordering:

  The code blocks that were moved:
  1. WORKFLOW setting block (lines 296-311) - moved earlier
  2. ARGS setting (line 311) - moved earlier

  The code that remained in its original position:
  1. RECOVERY_MODE setting (lines 313-326)
  2. CONFIG_DIR validation and setting (lines 328-347)

  Key dependency analysis:

  1. PORTABLE variable: This is set during option parsing (line 211:
  PORTABLE=1) and is used in the RECOVERY_MODE logic (line 324: if test -e 
  "/etc/rear-release" || test "$PORTABLE"). Since option parsing happens
  before both the original and new positions of the moved code, this
  dependency is preserved.
  2. ALTERNATIVE_CONFIG_DIR variable: This is set during option parsing
  (around line 221) and used in the CONFIG_DIR logic. Again, option parsing
  happens before the moved code.
  3. Variable dependencies within moved code: The WORKFLOW and ARGS setting
  only depends on $1 and $@, which are the command line arguments after
  option processing. This doesn't depend on RECOVERY_MODE or CONFIG_DIR.
  4. Variables used after the moved code: The case "$WORKFLOW" statement at
  line 350 still works correctly because WORKFLOW is now set earlier.

  Conclusion:

  The reordering appears to be functionally safe. The moved code blocks
  (WORKFLOW and ARGS setting) do not depend on RECOVERY_MODE or CONFIG_DIR
  settings, and all the variables they need ($1, $@) are available at the
  earlier position since they come from command line parsing which happens
  before both the old and new positions.

  The code that uses WORKFLOW (like the verbose workflow case statement)
  still works because WORKFLOW is set before it's used.

  This is indeed a pure readability improvement with no functional change.
</code></pre>
<p>I tried multiple times, the answer was similar in all except one, where
Claude Code claimed that there was a difference in corner cases, but
after a follow-up question it admitted that there is actually no
difference.</p>
<p>It always correctly pointed out the problem in the current code.</p>
<h4 id="jsmeix_commented_at_2025-09-08_1519"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3266813966">2025-09-08 15:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-08_1519" title="Permanent link">&para;</a></h4>
<p>Now<br />
<a href="https://github.com/rear/rear/pull/3514/files">https://github.com/rear/rear/pull/3514/files</a><br />
looks exactly as I intended - i.e. the<br />
<code>Set workflow to first command line argument ...</code><br />
block is moved up where it had been initially.</p>
<h4 id="jsmeix_commented_at_2025-09-09_1254"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3514#issuecomment-3270616977">2025-09-09 12:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-09-09_1254" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
unless there are objections<br />
I would like to merge it on Thursday (11.Sept.2025) afternoon.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2025-08-21.3514.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
