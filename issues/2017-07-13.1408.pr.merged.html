<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1408 PR merged: Automated unique default user_input_ID for UserInput - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1408 PR merged: Automated unique default user_input_ID for UserInput";
        var mkdocs_page_input_path = "issues/2017-07-13.1408.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1408 PR merged: Automated unique default user_input_ID for UserInput</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1408_pr_merged_automated_unique_default_user_input_id_for_userinput"><a href="https://github.com/rear/rear/pull/1408">#1408 PR</a> <code>merged</code>: Automated unique default user_input_ID for UserInput<a class="headerlink" href="#1408_pr_merged_automated_unique_default_user_input_id_for_userinput" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2017-07-13_1426"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/1408">2017-07-13 14:26</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2017-07-13_1426" title="Permanent link">&para;</a></h4>
<p>Have an automated unique default user_input_ID<br />
for the UserInput function so that each<br />
UserInput function call has a user_input_ID<br />
which is some kind of precondition for<br />
<a href="https://github.com/rear/rear/issues/1366">https://github.com/rear/rear/issues/1366</a></p>
<p>Now (at least from my current point of view)<br />
the UserInput function should be feature-complete.</p>
<p>It needs 'bc' to calculate huge numbers and (fortunately) since<br />
<a href="https://github.com/rear/rear/pull/1332">https://github.com/rear/rear/pull/1332</a><br />
'bc' is one of the REQUIRED_PROGS in default.conf<br />
so that it is also available in the ReaR recovery system.</p>
<p>By the way I enhanced the CallerSource function<br />
that now also outputs the line number (useful in bigger scripts)<br />
because I learned how to use BASH_LINENO correctly<br />
(there is an unexpected - but documented - "off by one"<br />
for the BASH_LINENO array index).</p>
<h4 id="schlomo_commented_at_2017-08-25_0653"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324838627">2017-08-25 06:53</a>:<a class="headerlink" href="#schlomo_commented_at_2017-08-25_0653" title="Permanent link">&para;</a></h4>
<p>@jsmeix I had another close look at the <code>UserInput</code> function and I am
not sure if the automatically generated hash numbers will be useful or
harmful. The reason is that they change if the call is moved to another
script or even <strong>if we change a single letter in the wording</strong>. If
somebody where to create responses for a specific ReaR run and we move
that input query to another script or just fix the wording then his
responses won't work anymore. That means that every such change -
regardless how minor - would be a <strong>breaking change</strong> for the user.</p>
<p>I therefore would like us to consider to remove this automatic feature
with the goal of only having explicit interfaces for users to configure
and not to have implicit interfaces. As we just introduce the
<code>UserInput</code> function I think that it is much easier for all of us
maintainers and also for our users if we simply assign those numbers
<strong>manuall</strong>. At the moment there are only very few uses of the function
that we would have to extend with the number (starting from 1) and then
we simply count up as we add more <code>UserInput</code> calls. If you want we can
make assigning the number a mandatory argument to force everybody to set
one.</p>
<p>People will still have to update their answers when we change the
wording of the answer they use but at least they won't have to do
anything when we move the code or when we change the default or an
answer that they didn't care about.</p>
<p>Here is the list of files to update, IMHO no big deal:</p>
<pre><code>$ git grep -cE '^[^\#]+\(\s*UserInput'
usr/share/rear/format/USB/default/200_check_usb_layout.sh:1
usr/share/rear/format/USB/default/300_format_usb_disk.sh:1
usr/share/rear/layout/prepare/GNU/Linux/150_include_drbd_code.sh:1
usr/share/rear/layout/prepare/default/600_show_unprocessed.sh:1
usr/share/rear/restore/BORG/default/300_load_archives.sh:1
usr/share/rear/restore/FDRUPSTREAM/default/270_selinux_considerations.sh:1
usr/share/rear/restore/NBKDC/default/400_restore_backup.sh:1
</code></pre>
<p>What do you think?</p>
<h4 id="jsmeix_commented_at_2017-08-25_1257"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324912118">2017-08-25 12:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-08-25_1257" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
of course I know how the automated IDs change<br />
(I made the code and the comments ;-)</p>
<p>The idea is that each different UserInput function is called<br />
with its own ID explicitly specified in the call like</p>
<pre>
UserInput -I 123 ...
</pre>

<p>The automated default user_input_ID is only there<br />
as fallback for UserInput function calls without '-I'<br />
so that the user can in any case provide predefined<br />
automated input even if a UserInput function is called<br />
without '-I'.</p>
<p>Why I currently do not call UserInput with '-I':</p>
<p>Because IDs of different UserInput function calls<br />
must be different and currently I have no good idea<br />
for a reasonable and meaningful numbering scheme.</p>
<p>I think the ID should contain the script number,<br />
e.g. in 123_do_something.sh it should be</p>
<pre>
UserInput -I 123... ...
</pre>

<p>but the script number is not unique so that<br />
I need more...</p>
<p>As soon as I have a good idea for a reasonable and<br />
meaningful numbering scheme I will add '-I ...'<br />
to all UserInput calls.</p>
<h4 id="jsmeix_commented_at_2017-08-25_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324914467">2017-08-25 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-08-25_1306" title="Permanent link">&para;</a></h4>
<p>Note that UserInput calls can even have same IDs<br />
when those calls have same purpose.</p>
<p>Only a theoretical example (I don't know a real one):<br />
E.g. in various backup restore scripts<br />
for various backup methods there could be<br />
same UserInput calls that have same purpose.<br />
Like for backup methods where ReaR basically only<br />
pauses until the admin had restored it manually like</p>
<pre>
UserInput -I 999999 -t 0 -p 'Press [Enter] to continue after restore'
</pre>

<p>Of course this here is only a theoretical example<br />
because in this case automated user input<br />
is clearly never ever wanted.</p>
<h4 id="schlomo_commented_at_2017-08-25_1346"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324924918">2017-08-25 13:46</a>:<a class="headerlink" href="#schlomo_commented_at_2017-08-25_1346" title="Permanent link">&para;</a></h4>
<p>I fully understand and share your concerns, @jsmeix</p>
<p>The more we talk about this the more I get the feeling that a bash array
is the wrong tool for providing the answers to ReaR questions. Bash
arrays are indexed by numbers which is apparently not flexible enough.</p>
<p>How about switching to property files? Let's think about a directory
<code>/etc/rear/answers</code> where users can place files named like
<code>foobar.property</code> that contain answer like that:</p>
<pre><code>network.use-network-card=0
storage.use-disk.sda=0
storage.multipath.failed-loading=0
</code></pre>
<p>And of course the user input function for the multipathing issue we
discuss in #1449 would be called with
<code>-I storage.multipath.failed-loading</code> to make it read that answer.</p>
<p>The idea is semantic naming for the user input ID. With a little magic
grep and sed I will be able to create for you an answer file where
everything is commented out :-)</p>
<p>With such a model (string instead of number as user input ID) you don't
need to keep a precise inventory of existing user input IDs.</p>
<p>And I would still prefer to not have automatic user input IDs because I
don't want to create an interface that will change as we refactor ReaR
code.</p>
<h4 id="jsmeix_commented_at_2017-08-25_1545"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324959027">2017-08-25 15:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-08-25_1545" title="Permanent link">&para;</a></h4>
<p>Only a side note<br />
that is related to
<a href="https://github.com/rear/rear/issues/1390">https://github.com/rear/rear/issues/1390</a></p>
<p>Bash 4.x supports associative arrays where the members<br />
are referenced using arbitrary strings,<br />
e.g. on my SLES12<br />
(the 'declare -A' is mandatory)</p>
<pre>
# unset USER_INPUT_VALUES

# declare -A USER_INPUT_VALUES

# USER_INPUT_VALUES[first_user_input]='input for UserInput -I first_user_input'

# USER_INPUT_VALUES[second_user_input]='input for UserInput -I second_user_input'

# USER_INPUT_VALUES[third_user_input]='input for UserInput -I third_user_input'

# for user_input in "${USER_INPUT_VALUES[@]}" ; do echo "'$user_input'" ; done
'input for UserInput -I second_user_input'
'input for UserInput -I third_user_input'
'input for UserInput -I first_user_input'

# index='second_user_input' ; echo ${USER_INPUT_VALUES[$index]}
input for UserInput -I second_user_input

# USER_INPUT_VALUES[last user input]="input for UserInput -I 'last user input'"

# for user_input in "${USER_INPUT_VALUES[@]}" ; do echo "'$user_input'" ; done
'input for UserInput -I second_user_input'
'input for UserInput -I 'last user input''
'input for UserInput -I third_user_input'
'input for UserInput -I first_user_input'

# index='last user input' ; echo ${USER_INPUT_VALUES[$index]}
input for UserInput -I 'last user input'
</pre>

<h4 id="jsmeix_commented_at_2017-08-25_1552"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324961145">2017-08-25 15:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-08-25_1552" title="Permanent link">&para;</a></h4>
<p>If we do not have automatic user input IDs<br />
it is still mandatory for me that the user can<br />
always predefine an input for any UserInput call<br />
which means then a UserInput call must be with '-I'<br />
otherwise the UserInput function aborts with BugError.</p>
<p>I think with strings as ID this should be acceptable<br />
so that even the user can ad-hoc add an UserInput call<br />
in any of the scripts because with strings as ID the<br />
user could simply use any dummy ID<br />
e.g. to pause somewhere in a script<br />
with something like</p>
<pre>
UserInput -I asdfghjkl -t 0 -p 'Press [Enter] to continue'
</pre>

<p>when he does not care about the ID string.</p>
<h4 id="jsmeix_commented_at_2017-08-25_1604"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-324964529">2017-08-25 16:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-08-25_1604" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
why a directory like /etc/rear/answers?</p>
<p>I think a single file /etc/rear/user_input[.conf]<br />
that contains lines of bash syntax (as anything in ReaR)<br />
with string variable assignments like</p>
<pre>
ID_string="arbitrary user input string"
</pre>

<p>should be sufficient.</p>
<p>I would like to source that file in the UserInput function<br />
but I wonder how to ensure that those assinged variables<br />
are kept local inside the UserInput function so that<br />
no other ReaR variables could be accidentally overwritten?</p>
<h4 id="schlomo_commented_at_2017-08-26_2008"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1408#issuecomment-325159131">2017-08-26 20:08</a>:<a class="headerlink" href="#schlomo_commented_at_2017-08-26_2008" title="Permanent link">&para;</a></h4>
<p>Whatever we do must support multiple configuration / input files so that
people can easily provide different answers from different sources (e.g.
packages). Therefore I'd like to have a directory where users can put
multiple files.</p>
<p>Personally I think that editing a properties file is simpler because
there you have the user input ID as the key without any prefix. But I
don't insist on that. What I do find important is that the user input ID
is something that the user can set "as is" in a file. If the user input
IDs are Bash variables then we must prefix them with some constant and
then the <code>UserInput</code> function should also be called with that prefixed
ID and output that prefixed ID in the debug log etc.</p>
<p>So the main question is probably: Do we want to have user input IDs
without a prefix? Then we should put them into a different configuration
namespace which would be a different configuration directory. Even if
the format is Bash (and we read it with <code>source</code>), we would need that
different directory to avoid the constant prefix for each and every key.</p>
<p>And I am not sure if <code>ID_</code> is enough of a prefix or if it is
sufficiently self explanatory. Maybe <code>ANSWER_</code> will be easier to
understand.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-07-13.1408.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
