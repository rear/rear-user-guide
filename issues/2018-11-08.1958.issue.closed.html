<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1958 Issue closed: Support by-path PVs - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1958 Issue closed: Support by-path PVs";
        var mkdocs_page_input_path = "issues/2018-11-08.1958.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1958 Issue closed: Support by-path PVs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1958_issue_closed_support_by-path_pvs"><a href="https://github.com/rear/rear/issues/1958">#1958 Issue</a> <code>closed</code>: Support by-path PVs<a class="headerlink" href="#1958_issue_closed_support_by-path_pvs" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="schlomo_opened_issue_at_2018-11-08_1059"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/1958">2018-11-08 10:59</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2018-11-08_1059" title="Permanent link">&para;</a></h4>
<p>ReaR 2.4 on SLES12 SP3 with local disk in VMware VM with LVM</p>
<p><strong>Problem</strong><br />
PVs are addressed by <code>/dev/disk/by-path/</code> like this:</p>
<pre><code># pvs
  PV                                                           VG                     Fmt  Attr PSize   PFree
  /dev/disk/by-id/dm-name-local-lvm-modbtsbl-114v_vol00_dg-001 modbtsbl-114v_vol00_dg lvm2 a--  550.10g 104.00m
  /dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:0:0-part2        storage                lvm2 a--   19.99g   1.49g

# pvdisplay -c
/dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:0:0-part2:storage:41924608:-1:8:8:-1:4096:5117:381:4736:HcNHiV-SSq8-yvzK-3q21-p8ND-qGah-J1eb6J
/dev/disk/by-id/dm-name-local-lvm-modbtsbl-114v_vol00_dg-001:modbtsbl-114v_vol00_dg:1153654784:-1:8:8:-1:4096:140826:26:140800:JDWfR1-feeC-Eznp-x1Qo-7TAb-j5KK-JMc1Bj
</code></pre>
<p>The resulting <code>disklayout.conf</code> contains broken lines like this:</p>
<pre><code>lvmdev /dev/03 /dev/disk/by-path/pci-0000 -1 00.0-scsi-0
</code></pre>
<p>And consequently ReaR doesn't work.</p>
<p><strong>Cause</strong><br />
Root cause is
<a href="https://github.com/rear/rear/blob/aa7b1979c347a3800959d757f7ce485fc10bd788/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh#L15">220_lvm_layout.sh</a>
using <code>:</code> to separate the output. <code>:</code> also appears as part of the PV
physical block device name so that our code breaks.</p>
<p><strong>Solution</strong><br />
Don't use <code>:</code> as a separator in stuff that contains file names because
<code>:</code> is valid <em>and</em> used in file names.</p>
<p><strong>Further TODO</strong><br />
This fix alone is not enough because ReaR does not recognize the
dependency between the PV and the <code>/dev/sda</code> disk and therefore excludes
that disk from formatting and recovery.</p>
<h4 id="schlomo_commented_at_2018-11-08_1132"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-436964420">2018-11-08 11:32</a>:<a class="headerlink" href="#schlomo_commented_at_2018-11-08_1132" title="Permanent link">&para;</a></h4>
<p>@skrueger8 FYI</p>
<h4 id="jsmeix_commented_at_2018-11-08_1136"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-436965342">2018-11-08 11:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-08_1136" title="Permanent link">&para;</a></h4>
<p>I added @gdha because according to the</p>
<pre>
git log -p --follow usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
</pre>

<p>output layout/save/GNU/Linux/220_lvm_layout.sh was initially creted
by<br />
@gdha via<br />
<a href="https://github.com/rear/rear/commit/c7b79dd8ed4f3c653e223fee482feb740edea7a4">https://github.com/rear/rear/commit/c7b79dd8ed4f3c653e223fee482feb740edea7a4</a><br />
that already uses <code>:</code> as filed separator but the commit message<br />
'added patch of Jeroen to check/save-layout workflows'<br />
indicates it originates from @jhoekx</p>
<p>I think the 'pvdisplay -c' output is the root cause because</p>
<pre>
dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:0:0-part2:storage:...
</pre>

<p>is already broken because the 'pvdisplay -c' output uses <code>:</code> as field
separator<br />
but that character appears in the first field value in this case.</p>
<h4 id="jsmeix_commented_at_2018-11-08_1139"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-436966157">2018-11-08 11:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-08_1139" title="Permanent link">&para;</a></h4>
<p>I need to set up a test system with LVM to be able to actually work on
it...</p>
<h4 id="schlomo_commented_at_2018-11-08_1143"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-436967024">2018-11-08 11:43</a>:<a class="headerlink" href="#schlomo_commented_at_2018-11-08_1143" title="Permanent link">&para;</a></h4>
<p>@skrueger8 can you please check that the fix in
<a href="https://github.com/rear/rear/commit/ea2b700ef16ed1dc46d46ad472c6ee91fc38ba30">https://github.com/rear/rear/commit/ea2b700ef16ed1dc46d46ad472c6ee91fc38ba30</a>
reflects what we tested?</p>
<h4 id="schlomo_commented_at_2018-11-08_1148"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-436968284">2018-11-08 11:48</a>:<a class="headerlink" href="#schlomo_commented_at_2018-11-08_1148" title="Permanent link">&para;</a></h4>
<p>@jsmeix for testing some more info:</p>
<ul>
<li>GPT disk with BIOS boot</li>
<li>1st partition is <code>bios_grub</code></li>
<li>2nd partition is PV on which resides the LV with the btrfs volume
    for the system</li>
<li><code>/boot</code> is on the btrfs volume that has <code>/</code></li>
<li>PV is defined via its <code>by-path</code> block device file</li>
</ul>
<p>Please add additional fixes to the <code>issue-1958</code> branch and we will also
try them out.</p>
<h4 id="jsmeix_commented_at_2018-11-08_1528"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437036234">2018-11-08 15:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-08_1528" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
there are so many ways how to setup storage in YaST<br />
that I need more details how to setup what you have<br />
so that I can reproduce their issue.</p>
<p>What is the output of commands like</p>
<pre>
# parted -s /dev/sda unit MiB print

# lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sda
</pre>

<p>on a relatively small system that has this issue?</p>
<p>FYI<br />
what I have on my SLES12 test system with the default LVM setup that one
gets<br />
when one selects during installation in YaST the "LVM-based Proposal"<br />
(but not the "Encrypted LVM-based Proposal")</p>
<pre>
# parted -s /dev/sda unit MiB print
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 20480MiB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags: 
Number  Start    End       Size      Type     File system  Flags
 1      1.00MiB  20480MiB  20479MiB  primary               boot, lvm, type=8e

# lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sda
NAME                        KNAME     TRAN TYPE FSTYPE       SIZE MOUNTPOINT
/dev/sda                    /dev/sda  ata  disk               20G 
`-/dev/sda1                 /dev/sda1      part LVM2_member   20G 
  |-/dev/mapper/system-swap /dev/dm-0      lvm  swap         1.4G [SWAP]
  `-/dev/mapper/system-root /dev/dm-1      lvm  btrfs       18.6G /
</pre>

<p>Meanwhile I found out how to enforce GPT in YaST (somewhat hidden) and<br />
how to manually create a BIOS Grub partition in YaST (Googling helped
me)<br />
perhaps I should even read some SUSE manuals (my very last resort ;-)
...</p>
<h4 id="jsmeix_commented_at_2018-11-08_1614"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437054518">2018-11-08 16:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-08_1614" title="Permanent link">&para;</a></h4>
<p>I get closer but up to now I failed to setup by-path PVs.<br />
What I have now via manual setup in YaST:</p>
<pre>
# parted -s /dev/sda unit MiB print
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 20480MiB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: pmbr_boot
Number  Start    End       Size      File system  Name  Flags
 1      1.00MiB  16.0MiB   15.0MiB                      bios_grub
 2      16.0MiB  19469MiB  19453MiB                     lvm, legacy_boot

# lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                                KNAME     TRAN TYPE FSTYPE       SIZE MOUNTPOINT
/dev/sda                            /dev/sda  ata  disk               20G 
|-/dev/sda1                         /dev/sda1      part               15M 
`-/dev/sda2                         /dev/sda2      part LVM2_member   19G 
  |-/dev/mapper/system-system--swap /dev/dm-0      lvm  swap           1G [SWAP]
  `-/dev/mapper/system-system--root /dev/dm-1      lvm  btrfs         18G /
/dev/sr0                            /dev/sr0  ata  rom              1024M 

# pvs
  PV         VG     Fmt  Attr PSize  PFree
  /dev/sda2  system lvm2 a--  19.00g 4.00m

# pvdisplay -c
  /dev/sda2:system:39839744:-1:8:8:-1:4096:4863:1:4862:7guAfh-09wj-3ivj-oH4K-kvqE-NUjJ-r9sPSu

# pvdisplay --columns --separator "|"
  PV|VG|Fmt|Attr|PSize|PFree
  /dev/sda2|system|lvm2|a--|19.00g|4.00m
</pre>

<h4 id="skrueger8_commented_at_2018-11-09_0728"><img src="https://avatars.githubusercontent.com/u/18461169?u=c6a5a9397449f213df1385cfb8d0d8f91f3c7ba2&v=4" width="50"><a href="https://github.com/skrueger8">skrueger8</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437273876">2018-11-09 07:28</a>:<a class="headerlink" href="#skrueger8_commented_at_2018-11-09_0728" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@schlomo<br />
there are so many ways how to setup storage in YaST<br />
that I need more details how to setup what you have<br />
so that I can reproduce their issue.</p>
<p>What is the output of commands like</p>
<pre>
<h1 id="parted_-s_devsda_unit_mib_print">parted -s /dev/sda unit MiB print<a class="headerlink" href="#parted_-s_devsda_unit_mib_print" title="Permanent link">&para;</a></h1>
<h1 id="lsblk_-i_-p_-o_nameknametrantypefstypesizemountpoint_devsda">lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sda<a class="headerlink" href="#lsblk_-i_-p_-o_nameknametrantypefstypesizemountpoint_devsda" title="Permanent link">&para;</a></h1>
<p>on a relatively small that has this issue?
</pre></p>
<p>Hi, here's the output you requested:</p>
</blockquote>
<pre><code># parted -s /dev/sda unit MiB print
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 20480MiB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start    End       Size      File system  Name     Flags
 1      1.00MiB  8.00MiB   7.00MiB                primary  bios_grub
 2      8.00MiB  20479MiB  20471MiB               primary  lvm, legacy_boot

# lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sda
NAME                             KNAME      TRAN TYPE FSTYPE       SIZE MOUNTPOINT
/dev/sda                         /dev/sda        disk               20G
|-/dev/sda1                      /dev/sda1       part                7M
`-/dev/sda2                      /dev/sda2       part LVM2_member   20G
  |-/dev/mapper/storage-root     /dev/dm-0       lvm  btrfs         12G /
  |-/dev/mapper/storage-home     /dev/dm-8       lvm  xfs            5G /home
  |-/dev/mapper/storage-varcrash /dev/dm-9       lvm  xfs            1G /var/crash
  `-/dev/mapper/storage-varlog   /dev/dm-10      lvm  xfs          512M /var/log
</code></pre>
<h4 id="skrueger8_commented_at_2018-11-09_0732"><img src="https://avatars.githubusercontent.com/u/18461169?u=c6a5a9397449f213df1385cfb8d0d8f91f3c7ba2&v=4" width="50"><a href="https://github.com/skrueger8">skrueger8</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437274592">2018-11-09 07:32</a>:<a class="headerlink" href="#skrueger8_commented_at_2018-11-09_0732" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@skrueger8 can you please check that the fix in
<a href="https://github.com/rear/rear/commit/ea2b700ef16ed1dc46d46ad472c6ee91fc38ba30">ea2b700</a>
reflects what we tested?</p>
</blockquote>
<p>Yup, that's the fix we tested yesterday.</p>
<h4 id="jsmeix_commented_at_2018-11-09_0810"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437282349">2018-11-09 08:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-09_0810" title="Permanent link">&para;</a></h4>
<p>@skrueger8<br />
thanks for the info!</p>
<p>@skrueger8 @schlomo<br />
do you perhaps know how to install a SLES12 system so that it uses
by-path PVs?<br />
I mean what I would have to do in YaST during installation to get
by-path PVs?<br />
Or do you know a URL to documentation where that is described?<br />
(I can find that out on my own but I don't know how long that may
take...)</p>
<p>Or can you describe me how you installed your system so that it uses
by-path PVs<br />
so that I can relatively easily reproduce it?</p>
<p>I guess if you have many such systems you probably don't install each<br />
of them one by one with YaST but e.g. perhaps with AutoYaST (or
whatever<br />
other deployment tool you may use) perhaps together with even more<br />
sophisticated software on top of that like SUSE Manager (or anything
else)<br />
but that would be something that I cannot "relatively easily reproduce".</p>
<p>On the other hand - I guess - when you use AutoYaST for installation<br />
you may provide me your AutoYaST <code>autoinst.xml</code> file for one of your
systems<br />
(ideally for an as simple and small as possible system that uses by-path
PVs)<br />
pereferably attach your AutoYaST <code>autoinst.xml</code> file to this issue
here.<br />
If you provide me your AutoYaST <code>autoinst.xml</code> file ensure it does<br />
no longer contain secrets like root password or things like that.<br />
Then - I hope - I can relatively easily reproduce your system.</p>
<h4 id="schlomo_commented_at_2018-11-09_0817"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437283849">2018-11-09 08:17</a>:<a class="headerlink" href="#schlomo_commented_at_2018-11-09_0817" title="Permanent link">&para;</a></h4>
<p><a href="https://www.suse.com/documentation/sles11/book_autoyast/data/createprofile_partitioning.html">https://www.suse.com/documentation/sles11/book_autoyast/data/createprofile_partitioning.html</a>
suggests to use</p>
<pre><code>&lt;mountby config:type="symbol"&gt;path&lt;/mountby&gt;
</code></pre>
<p>We will provide you with the relevant information</p>
<h4 id="jsmeix_commented_at_2018-11-09_0958"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-437309794">2018-11-09 09:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-09_0958" title="Permanent link">&para;</a></h4>
<p>I am afraid, today I cannot work on this issue,<br />
I have some Ghostscript security related things to do, cf.<br />
<a href="https://ghostscript.com/pipermail/gs-devel/2018-November/010126.html">https://ghostscript.com/pipermail/gs-devel/2018-November/010126.html</a></p>
<p>Hopefully next week...</p>
<h4 id="jsmeix_commented_at_2019-02-26_1000"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-467375278">2019-02-26 10:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-26_1000" title="Permanent link">&para;</a></h4>
<p>"needs sponsorship" =&gt; for a "ReaR future" milestone</p>
<h4 id="jsmeix_commented_at_2020-02-18_1122"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-587413877">2020-02-18 11:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_1122" title="Permanent link">&para;</a></h4>
<p>I think calling the 'lvm' commands with <code>--separator ' | ' --aligned</code><br />
(for better human readability) or plain <code>--separator '|'</code> options<br />
could be a (hopefully) sufficiently fail-safe way because at least on<br />
all my systems <code>find /dev | grep '|'</code> results nothing so that it seems<br />
the <code>|</code> character does not appear in device nodes or device symlinks<br />
...<br />
of course except those users who use the <code>|</code> character in labels<br />
so that it appears in <code>/dev/disk/by-label/</code> e.g. something like</p>
<pre><code>/dev/disk/by-label/my|stuff
</code></pre>
<h4 id="github-actions_commented_at_2020-06-30_0133"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-651464894">2020-06-30 01:33</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-30_0133" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2022-10-31_0330"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-1296493251">2022-10-31 03:30</a>:<a class="headerlink" href="#github-actions_commented_at_2022-10-31_0330" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="pcahyna_commented_at_2023-01-02_1522"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/1958#issuecomment-1369032960">2023-01-02 15:22</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-02_1522" title="Permanent link">&para;</a></h4>
<p>I believe #2903 addresses all the issues:</p>
<blockquote>
<p>This fix alone is not enough because ReaR does not recognize the
dependency between the PV and the /dev/sda disk and therefore excludes
that disk from formatting and recovery.</p>
</blockquote>
<p>this is not an issue for some reason. Here is the layout on a two-disk
system configured to show <code>/dev/disk/by-path</code> PVs:<br />
/var/lib/rear/layout/disklayout.conf</p>
<pre><code># Disk layout dated 20230102095535 (YYYYmmddHHMMSS)
# NAME                                         KNAME     PKNAME    TRAN   TYPE FSTYPE      LABEL   SIZE MOUNTPOINT UUID                                   WWN
# /dev/sda                                     /dev/sda            sata   disk                   931.5G                                                   0x5000c5007971fc8c
# |-/dev/sda1                                  /dev/sda1 /dev/sda         part vfat                600M /boot/efi  C7D3-F00C                              0x5000c5007971fc8c
# |-/dev/sda2                                  /dev/sda2 /dev/sda         part xfs                   1G /boot      a8512f5b-ebc6-460b-8f5e-508df68c185f   0x5000c5007971fc8c
# `-/dev/sda3                                  /dev/sda3 /dev/sda         part LVM2_member       929.9G            2z2Dm7-R1JN-eCjn-arTJ-rQDR-YQz8-meSfPN 0x5000c5007971fc8c
#   |-/dev/mapper/rhel_hpe--dl120gen9--01-root /dev/dm-0 /dev/sda3        lvm  xfs                  70G /          89705cff-2ff7-4b45-90be-1cc292c0ef20   
#   |-/dev/mapper/rhel_hpe--dl120gen9--01-swap /dev/dm-1 /dev/sda3        lvm  swap                7.8G [SWAP]     d5b1cc1d-f7ab-4f25-bccf-e8fb73750cb5   
#   `-/dev/mapper/rhel_hpe--dl120gen9--01-home /dev/dm-2 /dev/sda3        lvm  xfs                 1.8T /home      77b0e7ae-92c7-4137-842b-f06bdadda278   
# /dev/sdb                                     /dev/sdb            sata   disk                   931.5G                                                   0x5000c500798fc371
# `-/dev/sdb1                                  /dev/sdb1 /dev/sdb         part LVM2_member       931.5G            Vg2HFj-EZwJ-k1D9-UjKv-Gwkr-6dhx-d0O7mc 0x5000c500798fc371
#   `-/dev/mapper/rhel_hpe--dl120gen9--01-home /dev/dm-2 /dev/sdb1        lvm  xfs                 1.8T /home      77b0e7ae-92c7-4137-842b-f06bdadda278   
# Disk /dev/sda
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/sda 1000204886016 gpt
# Partitions on /dev/sda
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/sda 629145600 1048576 EFI%20System%20Partition boot,esp /dev/sda1
part /dev/sda 1073741824 630194176 rear-noname none /dev/sda2
part /dev/sda 998500204544 1703936000 rear-noname lvm /dev/sda3
# Disk /dev/sdb
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/sdb 1000204886016 gpt
# Partitions on /dev/sdb
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/sdb 1000203091968 1048576 rear-noname lvm /dev/sdb1
# Format for LVM PVs
# lvmdev &lt;volume_group&gt; &lt;device&gt; [&lt;uuid&gt;] [&lt;size(bytes)&gt;]
lvmdev /dev/rhel_hpe-dl120gen9-01 /dev/sda3 2z2Dm7-R1JN-eCjn-arTJ-rQDR-YQz8-meSfPN 998496010240
lvmdev /dev/rhel_hpe-dl120gen9-01 /dev/sdb1 Vg2HFj-EZwJ-k1D9-UjKv-Gwkr-6dhx-d0O7mc 1000198897664
# Format for LVM VGs
# lvmgrp &lt;volume_group&gt; &lt;extentsize&gt; [&lt;size(extents)&gt;] [&lt;size(bytes)&gt;]
lvmgrp /dev/rhel_hpe-dl120gen9-01 4096 476526 1951850496
# Format for LVM LVs
# lvmvol &lt;volume_group&gt; &lt;name&gt; &lt;size(bytes)&gt; &lt;layout&gt; [key:value ...]
lvmvol /dev/rhel_hpe-dl120gen9-01 swap 8338276352b linear 
lvmvol /dev/rhel_hpe-dl120gen9-01 root 75161927680b linear 
# Volume rhel_hpe-dl120gen9-01/home has multiple segments. Recreating it by 'lvcreate' will not preserve segments and properties of the other segments as well
lvmvol /dev/rhel_hpe-dl120gen9-01 home 1915194703872b linear 
# Extra parameters for the 'lvmvol /dev/rhel_hpe-dl120gen9-01 home' line above not taken into account when restoring using 'lvcreate': segmentsize:1000198897664b
#lvmvol /dev/rhel_hpe-dl120gen9-01 home 1915194703872b linear 
# Extra parameters for the '#lvmvol /dev/rhel_hpe-dl120gen9-01 home' line above not taken into account when restoring using 'lvcreate': segmentsize:914995806208b
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/mapper/rhel_hpe--dl120gen9--01-home /home xfs uuid=77b0e7ae-92c7-4137-842b-f06bdadda278 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
fs /dev/mapper/rhel_hpe--dl120gen9--01-root / xfs uuid=89705cff-2ff7-4b45-90be-1cc292c0ef20 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
fs /dev/sda1 /boot/efi vfat uuid=C7D3-F00C label= options=rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro
fs /dev/sda2 /boot xfs uuid=a8512f5b-ebc6-460b-8f5e-508df68c185f label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/mapper/rhel_hpe--dl120gen9--01-swap uuid=d5b1cc1d-f7ab-4f25-bccf-e8fb73750cb5 label=
</code></pre>
<p>/var/lib/rear/layout/diskdeps.conf</p>
<pre><code>/dev/sda1 /dev/sda
/dev/sda2 /dev/sda
/dev/sda3 /dev/sda
/dev/sdb1 /dev/sdb
/dev/rhel_hpe-dl120gen9-01 pv:/dev/sda3
pv:/dev/sda3 /dev/sda3
/dev/rhel_hpe-dl120gen9-01 pv:/dev/sdb1
pv:/dev/sdb1 /dev/sdb1
/dev/mapper/rhel_hpe--dl120gen9--01-swap /dev/rhel_hpe-dl120gen9-01
/dev/mapper/rhel_hpe--dl120gen9--01-root /dev/rhel_hpe-dl120gen9-01
/dev/mapper/rhel_hpe--dl120gen9--01-home /dev/rhel_hpe-dl120gen9-01
fs:/home /dev/mapper/rhel_hpe--dl120gen9--01-home
fs:/home fs:/
fs:/ /dev/mapper/rhel_hpe--dl120gen9--01-root
fs:/boot/efi /dev/sda1
fs:/boot/efi fs:/
fs:/boot/efi fs:/boot
fs:/boot /dev/sda2
fs:/boot fs:/
swap:/dev/mapper/rhel_hpe--dl120gen9--01-swap /dev/mapper/rhel_hpe--dl120gen9--01-swap
</code></pre>
<p>/var/lib/rear/layout/disktodo.conf</p>
<pre><code>todo /dev/sda disk
todo /dev/sda1 part
todo /dev/sda2 part
todo /dev/sda3 part
todo /dev/sdb disk
todo /dev/sdb1 part
todo pv:/dev/sda3 lvmdev
todo pv:/dev/sdb1 lvmdev
todo /dev/rhel_hpe-dl120gen9-01 lvmgrp
todo /dev/mapper/rhel_hpe--dl120gen9--01-swap lvmvol
todo /dev/mapper/rhel_hpe--dl120gen9--01-root lvmvol
todo /dev/mapper/rhel_hpe--dl120gen9--01-home lvmvol
todo fs:/home fs
todo fs:/ fs
todo fs:/boot/efi fs
todo fs:/boot fs
todo swap:/dev/mapper/rhel_hpe--dl120gen9--01-swap swap
</code></pre>
<p>lvm pvdisplay -c</p>
<pre><code>  /dev/disk/by-path/pci-0000:00:11.4-ata-1-part3:rhel_hpe-dl120gen9-01:1950195712:-1:8:8:-1:4096:238060:0:238060:2z2Dm7-R1JN-eCjn-arTJ-rQDR-YQz8-meSfPN
  /dev/disk/by-path/pci-0000:00:11.4-ata-2-part1:rhel_hpe-dl120gen9-01:1953521664:-1:8:8:-1:4096:238466:0:238466:Vg2HFj-EZwJ-k1D9-UjKv-Gwkr-6dhx-d0O7mc
</code></pre>
<p>So, <code>/dev/disk/by-path/*</code> does not appear in the layout, only <code>/dev/sd*</code>
does, and dependencies seem to be properly recorded. This is despite
pvdisplay showing <code>/dev/disk/by-path/*</code> paths. I believe the layout code
performs enough symlink resolution now.</p>
<blockquote>
<p>Or can you describe me how you installed your system so that it uses
by-path PVs<br />
so that I can relatively easily reproduce it?</p>
</blockquote>
<p>LVM configuration described in
<a href="https://github.com/rear/rear/pull/2903">https://github.com/rear/rear/pull/2903</a>:
add</p>
<pre><code>filter = [ "r|/dev/disk/by-path/.*-usb-|", "a|/dev/disk/by-path/pci-.*-nvme-|", "a|/dev/disk/by-path/pci-.*-scsi-|", "a|/dev/disk/by-path/pci-.*-ata-|", "a|/dev/disk/by-path/pci-.*-sas-|", "a|loop|", "r|.*|" ]
</code></pre>
<p>to /etc/lvm/lvm.conf.</p>
<p><a href="https://github.com/rear/rear/commit/ea2b700ef16ed1dc46d46ad472c6ee91fc38ba30#commitcomment-31237351">https://github.com/rear/rear/commit/ea2b700ef16ed1dc46d46ad472c6ee91fc38ba30#commitcomment-31237351</a></p>
<blockquote>
<p>PV size is human readable and not in bytes :(</p>
</blockquote>
<p>solved by <code>--units=b</code>.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-11-08.1958.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
