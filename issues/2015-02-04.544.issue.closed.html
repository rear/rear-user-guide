<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2015 02 04.544.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2015 02 04.544.issue.closed";
        var mkdocs_page_input_path = "issues/2015-02-04.544.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2015 02 04.544.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="544_issue_closed_rear_does_not_support_suse-specific_gpt_sync_mbr_partition_scheme_unable_to_recover_when_hybrid_mbr_found"><a href="https://github.com/rear/rear/issues/544">#544 Issue</a> <code>closed</code>: rear does not support SUSE-specific 'gpt_sync_mbr' partition scheme (unable to recover when hybrid MBR found)<a class="headerlink" href="#544_issue_closed_rear_does_not_support_suse-specific_gpt_sync_mbr_partition_scheme_unable_to_recover_when_hybrid_mbr_found" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="roseswe_opened_issue_at_2015-02-04_1513"><img src="https://avatars.githubusercontent.com/u/3810660?v=4" width="50"><a href="https://github.com/roseswe">roseswe</a> opened issue at <a href="https://github.com/rear/rear/issues/544">2015-02-04 15:13</a>:<a class="headerlink" href="#roseswe_opened_issue_at_2015-02-04_1513" title="Permanent link">&para;</a></h4>
<p>Output of rear recover<br />
:: cut ::</p>
<pre><code>2015-02-04 15:07:13 Size of device sdi matches.
2015-02-04 15:07:13 Looking for sdj...
2015-02-04 15:07:13 Device sdj exists.
2015-02-04 15:07:13 Size of device sdj matches.
2015-02-04 15:07:13 Disk configuration is identical, proceeding with restore.
2015-02-04 15:07:13 Including layout/prepare/default/30_map_disks.sh
2015-02-04 15:07:13 Including layout/prepare/default/31_remove_exclusions.sh
2015-02-04 15:07:13 Including layout/prepare/default/32_apply_mappings.sh
2015-02-04 15:07:13 Including layout/prepare/default/40_autoresize_disks.sh
2015-02-04 15:07:13 Including layout/prepare/default/50_confirm_layout.sh
2015-02-04 15:07:13 Including layout/prepare/default/51_list_dependencies.sh
2015-02-04 15:07:13 Including layout/prepare/default/52_exclude_components.sh
2015-02-04 15:07:13 Including layout/prepare/default/54_generate_device_code.sh
2015-02-04 15:07:13 ERROR: Partition number '' of partition  is not a valid number.
=== Stack trace ===
Trace 0: /bin/rear:249 main
Trace 1: /usr/share/rear/lib/recover-workflow.sh:29 WORKFLOW_recover
Trace 2: /usr/share/rear/lib/framework-functions.sh:70 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:31 Source
Trace 4: /usr/share/rear/layout/prepare/default/54_generate_device_code.sh:52 source
Trace 5: /usr/share/rear/lib/layout-functions.sh:35 create_device
Trace 6: /usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh:68 create_disk
Trace 7: /usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh:210 create_partitions
Trace 8: /usr/share/rear/lib/layout-functions.sh:328 get_partition_number
Trace 9: /usr/share/rear/lib/_input-output-functions.sh:132 StopIfError
Message: Partition number '' of partition  is not a valid number.
===================
/usr/share/rear/lib/layout-functions.sh: line 331: ((: &lt;= 128 : syntax error: operand expected (error token is "&lt;= 128 ")
2015-02-04 15:07:13 ERROR: Partition  is numbered ''. More than 128 partitions is not supported.
=== Stack trace ===
Trace 0: /bin/rear:249 main
Trace 1: /usr/share/rear/lib/recover-workflow.sh:29 WORKFLOW_recover
Trace 2: /usr/share/rear/lib/framework-functions.sh:70 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:31 Source
Trace 4: /usr/share/rear/layout/prepare/default/54_generate_device_code.sh:52 source
Trace 5: /usr/share/rear/lib/layout-functions.sh:35 create_device
Trace 6: /usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh:68 create_disk
Trace 7: /usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh:210 create_partitions
Trace 8: /usr/share/rear/lib/layout-functions.sh:332 get_partition_number
Trace 9: /usr/share/rear/lib/_input-output-functions.sh:132 StopIfError
Message: Partition  is numbered ''. More than 128 partitions is not supported.
===================
2015-02-04 15:07:13 Running exit tasks.
2015-02-04 15:07:13 Finished in 71 seconds
2015-02-04 15:07:13 Removing build area /tmp/rear.ZhlcnK9tviL0e8q
rmdir: removing directory, `/tmp/rear.ZhlcnK9tviL0e8q/outputfs'
rmdir: failed to remove `/tmp/rear.ZhlcnK9tviL0e8q/outputfs': No such file or directory
rmdir: removing directory, `/tmp/rear.ZhlcnK9tviL0e8q'
2015-02-04 15:07:13 End of program reached

# fdisk -l /dev/sda

WARNING: GPT (GUID Partition Table) detected on '/dev/sda'! The util fdisk doesn't support GPT. Use GNU Parted.

Disk /dev/sda: 64.4 GB, 64424509440 bytes
255 heads, 63 sectors/track, 7832 cylinders, total 125829120 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2088959     1043456   83  Linux
/dev/sda2         2088960   125804543    61857792   83  Linux
/dev/sda4               1           1           0+  ee  GPT
</code></pre>
<p>Partition table entries are not in disk order</p>
<pre><code># parted -l
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 64.4GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt_sync_mbr

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  1070MB  1068MB  ext3         primary  boot, legacy_boot
 2      1070MB  64.4GB  63.3GB               primary  lvm
</code></pre>
<h4 id="gdha_commented_at_2015-02-04_1556"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-72880015">2015-02-04 15:56</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-04_1556" title="Permanent link">&para;</a></h4>
<p>@roseswe was this an issue for rear-1.16.1 or the latest from OSB? Could
you also share the <code>/var/lib/rear/layout/disklayout.conf</code> file and if
possible run in debug mode <code>rear -vD recovery</code> so we can see where
exactly it fails?</p>
<h4 id="roseswe_commented_at_2015-02-10_1554"><img src="https://avatars.githubusercontent.com/u/3810660?v=4" width="50"><a href="https://github.com/roseswe">roseswe</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-73723945">2015-02-10 15:54</a>:<a class="headerlink" href="#roseswe_commented_at_2015-02-10_1554" title="Permanent link">&para;</a></h4>
<p>We tested both: SLES 11 SP3 version and GIT upstream:<br />
Relax-and-Recover 1.16.1-git201501300930 / 2015-01-30<br />
rear116-1.16-0.7.1 (SLES11)</p>
<h4 id="gdha_commented_at_2015-02-11_0851"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-73849541">2015-02-11 08:51</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-11_0851" title="Permanent link">&para;</a></h4>
<p>@roseswe Could you also share the <code>/var/lib/rear/layout/disklayout.conf</code>
file and if possible run in debug mode <code>rear -vD recovery</code> so we can see
where exactly it fails?</p>
<h4 id="gdha_commented_at_2015-02-11_0853"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-73849739">2015-02-11 08:53</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-11_0853" title="Permanent link">&para;</a></h4>
<p>@roseswe Do you see an error while running <code>rear -vD savelayout</code>?</p>
<h4 id="roseswe_commented_at_2015-02-20_1019"><img src="https://avatars.githubusercontent.com/u/3810660?v=4" width="50"><a href="https://github.com/roseswe">roseswe</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-75216478">2015-02-20 10:19</a>:<a class="headerlink" href="#roseswe_commented_at_2015-02-20_1019" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<p>@roseswe Do you see an error while running rear -vD savelayout?<br />
No returns with 0; log file (360 KB) also looks at a first glance
ok.</p>
<pre><code>system: # head disklayout.conf
disk /dev/sda 64424509440 gpt_sync_mbr
part /dev/sda 1068498944 1048576 boot,legacy_boot  /dev/sda1
part /dev/sda 63342379008 1069547520 lvm  /dev/sda2
lvmdev /dev/systemvg /dev/sda2 WyLQQM-fWnH-Oi2x-AIYa-k2JT-1vyk-pcimDI 123715584
lvmgrp /dev/systemvg 4096 15101 61853696
lvmvol /dev/systemvg home_lv 256 2097152
</code></pre>
</blockquote>
</blockquote>
<h4 id="gdha_commented_at_2015-02-21_1117"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-75367375">2015-02-21 11:17</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-21_1117" title="Permanent link">&para;</a></h4>
<p>@roseswe see
<a href="https://bugzilla.novell.com/show_bug.cgi?id=811408">https://bugzilla.novell.com/show_bug.cgi?id=811408</a>
(the problem seems to be the label <em>gpt_sync_mbr</em> which is not
recognized by rear (see script
<code>layout/prepare/GNU/Linux/10_include_partition_code.sh</code>)</p>
<h4 id="gdha_commented_at_2015-03-30_1145"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-87642967">2015-03-30 11:45</a>:<a class="headerlink" href="#gdha_commented_at_2015-03-30_1145" title="Permanent link">&para;</a></h4>
<p>@roseswe what does your customer want? If code has to be written then it
has to be done on-site I guess as we do not have the required setup for
this behavior...</p>
<h4 id="jsmeix_commented_at_2015-07-13_1116"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-120893602">2015-07-13 11:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-07-13_1116" title="Permanent link">&para;</a></h4>
<p>Some background information how that gpt_sync_mbr partition type
became created:</p>
<p>It is YaST (more precisely it is libstorage) that creates a
gpt_sync_mbr partition type under special conditions.</p>
<p>As far as I see it seems that special conditions are hardcoded in the
libstorage source file storage/Disk.cc as follows:</p>
<p>YaST creates a gpt_sync_mbr partition type when a gpt partition type
is requested but the system does not use (U)EFI for booting (i.e. when
it uses BIOS) and the system is x86 compatible (this means both x86 and
x86_64) or the system is ppc but not ppc64le.</p>
<p>As far as I understand it it seems the basic logic behind is that YaST
creates a gpt_sync_mbr partition type when a gpt partition type is
requested but the system actually won't be able to boot from it.</p>
<p>For example a system with traditional BIOS where a gpt partition is
wanted. In this case a gpt_sync_mbr partition type must be actually
used (that is basically a gpt partition where the first sector on the
disk is a valid MBR) so that BIOS can boot it.</p>
<p>The problem with gpt_sync_mbr partition type is that it is not in
compliance with the EFI GPT standard (cf.
<a href="http://www.rodsbooks.com/gdisk/hybrid.html">http://www.rodsbooks.com/gdisk/hybrid.html</a>
) and as a consequence it will cause problems here and there (just as an
example rear does not work with it).</p>
<p>If possible I would recommend that on uses<br />
either traditional BIOS with traditional MBR partition type<br />
or (U)EFI with GPT partition type<br />
but not a mix-up of both.</p>
<h4 id="jsmeix_commented_at_2015-07-13_1146"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-120899769">2015-07-13 11:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-07-13_1146" title="Permanent link">&para;</a></h4>
<p>It seems "parted -s /dev/sdX mklabel gpt_sync_mbr" is an undocumented
way to use parted - i.e. it seems the gpt_sync_mbr partition type is
not officially supported by parted because it is neither documented at
<a href="http://www.gnu.org/software/parted/manual/parted.html#mklabel">http://www.gnu.org/software/parted/manual/parted.html#mklabel</a>
nor in "man parted" (I have parted version 3.1 on my SLES12 system).</p>
<p>The more I learn about it the more that gpt_sync_mbr thingy seems to
"smell" - more and more it looks as if it is not something that should
be officially supported at all - it seems one only gets into trouble
with it...</p>
<h4 id="jsmeix_commented_at_2015-07-13_1232"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-120910925">2015-07-13 12:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-07-13_1232" title="Permanent link">&para;</a></h4>
<p>I found out that "parted -s /dev/sdX mklabel gpt_sync_mbr" really is
not supported by upstream parted (there is no 'gpt_sync_mbr' in
parted-3.2.tar.xz) - it is a SUSE-specific addon via a
parted-gpt-mbr-sync.patch see
<a href="https://build.opensuse.org/package/show/Base:System/parted">https://build.opensuse.org/package/show/Base:System/parted</a></p>
<h4 id="jsmeix_commented_at_2015-07-13_1236"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-120913214">2015-07-13 12:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-07-13_1236" title="Permanent link">&para;</a></h4>
<p>It seems that one is the root of all this evil nowadays:<br />
<a href="https://bugzilla.opensuse.org/show_bug.cgi?id=220839">https://bugzilla.opensuse.org/show_bug.cgi?id=220839</a></p>
<h4 id="gdha_commented_at_2015-08-06_1335"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-128367593">2015-08-06 13:35</a>:<a class="headerlink" href="#gdha_commented_at_2015-08-06_1335" title="Permanent link">&para;</a></h4>
<p>@roseswe @jsmeix how do you want to proceed with this case?</p>
<h4 id="jsmeix_commented_at_2015-08-28_1327"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-135775287">2015-08-28 13:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-08-28_1327" title="Permanent link">&para;</a></h4>
<p>@gdha</p>
<p>(FYI: late reply because I was on vacation.)</p>
<p>Currently there is no need for rear upstream to do something here.</p>
<p>If at all there might be a note added to the rear documentation that
currently it does not work for partitions of type 'gpt_sync_mbr' aka.
'hybrid (synced) MBR' .</p>
<h4 id="jsmeix_commented_at_2015-10-23_1131"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-150548564">2015-10-23 11:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-10-23_1131" title="Permanent link">&para;</a></h4>
<p>I will implement support for the SUSE-specific 'gpt_sync_mbr' hack in
rear because it is requested by a SUSE customer.</p>
<p>As usual I will try to implement it in a way so that it does not cause
regressions eleswhere and finally - after confirmation by SUSE-internal
testing (and ideally also by the SUSE customer) that it works - I will
do a GitHub submitrequest.</p>
<h4 id="jsmeix_commented_at_2015-10-26_1331"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-151133875">2015-10-26 13:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-10-26_1331" title="Permanent link">&para;</a></h4>
<p>Some intermediate feedback what goes on:</p>
<p>I have now a KVM/QEMU machine with gpt_sync_mbr<br />
and I can reproduce the error exit of the initial comment:</p>
<pre>
Disk configuration is identical, proceeding with restore.
ERROR: Partition number '' of partition  is not a valid number.
ERROR: Partition  is numbered ''. More than 128 partitions is not supported.
</pre>

<p>To get a KVM/QEMU machine with gpt_sync_mb<br />
it was simply specifying a 2500GB virtual harddisk<br />
on a "normal" (i.e. BIOS) KVM/QEMU machine.</p>
<p>Fortunately one can create a KVM/QEMU virtual machine<br />
with a much bigger virtual harddisk than what is actually<br />
available as free space on the real harddisk.<br />
I use virt-manager to set it up.<br />
There is a popup notification that warns about that the<br />
virtual harddisk is bigger than the free space on the real harddisk<br />
but one can acknowledge the warning and proceed.</p>
<p>When YaST detects a system with BIOS<br />
and with a disk of more than 2TB<br />
then YaST does the gpt_sync_mb partitioning<br />
automatically.</p>
<p>On my system this gpt_sync_mb partitioning looks as follows:</p>
<pre>
# parted /dev/sda unit MiB print
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 2560000MiB
Sector size (logical/physical): 512B/512B
Partition Table: gpt_sync_mbr
Disk Flags: 
Number Start    End        Size       File system    Name    Flags
 1     1.00MiB  2.00MiB    1.00MiB                   primary bios_grub
 2     2.00MiB  2063MiB    2061MiB    linux-swap(v1) primary
 3     2063MiB  43026MiB   40963MiB   btrfs          primary legacy_boot
 4     43026MiB 2559999MiB 2516973MiB xfs            primary
</pre>

<p>On that system "rear mkbackup" creates this disklayout.conf<br />
(excerpt)</p>
<pre>
# egrep '^disk|^part' /tmp/rear.WkRJ6ruTilrLlvE/rootfs/var/lib/rear/layout/disklayout.conf
disk /dev/sda 2684354560000 gpt_sync_mbr
part /dev/sda 1048576 1048576 bios_grub  /dev/sda1
part /dev/sda 2161115136 2097152 none  /dev/sda2
part /dev/sda 42952818688 2163212288 legacy_boot  /dev/sda3
part /dev/sda 2639237480448 45116030976 none  /dev/sda4
</pre>

<p>In
usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh
there is</p>
<pre>
read part disk size pstart name flags partition junk
</pre>

<p>which reads this line from disklayout.conf</p>
<pre>
part /dev/sda 1048576 1048576 bios_grub  /dev/sda1
</pre>

<p>that results</p>
<pre>
$disk="/dev/sda"
$size="1048576"
$pstart="1048576"
$name="bios_grub"
$flags="/dev/sda1"
$partition=""
</pre>

<p>which is obviously wrong for $name $flags and $partition.</p>
<p>In particular because $partition is empty the line</p>
<pre>
local number=$(get_partition_number "$partition")
</pre>

<p>in
usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh
calls get_partition_number with empty $partition and in
usr/share/rear/lib/layout-functions.sh get_partition_number does an
error exit in this case.</p>
<p>What I need to fix first and foremost is that disklayout.conf is created
correctly.</p>
<p>Currently it seems that "$name" is empty in disklayout.conf is the root
cause.</p>
<h4 id="jsmeix_commented_at_2015-10-26_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-151136106">2015-10-26 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-10-26_1340" title="Permanent link">&para;</a></h4>
<p>For comparison how parted and disklayout.conf look<br />
on a "msdos" labeled partitioning:</p>
<pre>
# parted /dev/sda unit MiB print
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 25600MiB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags: 
Number  Start     End       Size      Type     File system     Flags
 1      1.00MiB   1498MiB   1497MiB   primary  linux-swap(v1)  type=82
 2      1498MiB   13790MiB  12292MiB  primary  btrfs           boot, type=83
 3      13790MiB  25600MiB  11810MiB  primary  xfs             type=83
# egrep '^disk|^part' /tmp/rear.dYWXyVLurEQKeha/rootfs/var/lib/rear/layout/disklayout.conf
disk /dev/sda 26843545600 msdos
part /dev/sda 1569718272 1048576 primary none /dev/sda1
part /dev/sda 12889096192 1570766848 primary boot /dev/sda2
part /dev/sda 12383682560 14459863040 primary none /dev/sda3
</pre>

<p>At least on first glance it also does not look correct because here the
flags are all "none" in contrast to what parted reports.</p>
<p>Currently the whole partitioning looks messy for me...</p>
<h4 id="jsmeix_commented_at_2015-10-27_1223"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-151473796">2015-10-27 12:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-10-27_1223" title="Permanent link">&para;</a></h4>
<p>@jhoekx</p>
<p>I have some general questions regarding the partitioning code in rear.</p>
<p>I like to understand the reasoning behind why the partitioning code<br />
is as it is because from my current point of view I think I may<br />
need to change it substantially to make it less "fragile".</p>
<p>Jeroen, I think you are the right one to ask because "git blame
usr/share/rear/layout/save/GNU/Linux/20_partition_layout.sh" and "git
blame
usr/share/rear/layout/prepare/GNU/Linux/10_include_partition_code.sh"
shows mostly you as the one who made them.</p>
<p>Jeroen, is this o.k. for you?</p>
<h4 id="jsmeix_commented_at_2015-11-02_1448"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-153039092">2015-11-02 14:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-02_1448" title="Permanent link">&para;</a></h4>
<p>The issue should be fixed with my above pull request
<a href="https://github.com/rear/rear/pull/681">https://github.com/rear/rear/pull/681</a></p>
<p>This minimal changes make it work for me.</p>
<p>Nevertheless the whole partitioning code looks fragile from my point of
view but I think it is better to not do major changes here but to keep
the fix for this particular issue minimal.</p>
<h4 id="jsmeix_commented_at_2015-11-03_1526"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/544#issuecomment-153388087">2015-11-03 15:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-03_1526" title="Permanent link">&para;</a></h4>
<p>Merged pull request #681 which should fix it.</p>
<p>At least it works for me with this partitioning</p>
<pre>
# parted /dev/sda unit MiB print
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 2560000MiB
Sector size (logical/physical): 512B/512B
Partition Table: gpt_sync_mbr
Disk Flags: 
Number  Start     End         Size        File system     Name     Flags
 1      1.00MiB   2.00MiB     1.00MiB                     primary  bios_grub
 2      2.00MiB   2063MiB     2061MiB     linux-swap(v1)  primary
 3      2063MiB   43026MiB    40963MiB    btrfs           primary  legacy_boot
 4      43026MiB  2559999MiB  2516973MiB  xfs             primary
</pre>

<p>with a 2500GB virtual harddisk on a "normal" (i.e. BIOS) KVM/QEMU
machine.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-02-04.544.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
