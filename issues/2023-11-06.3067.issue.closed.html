<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3067 Issue closed: Trying to build rescue ISO for Bacula backup - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3067 Issue closed: Trying to build rescue ISO for Bacula backup";
        var mkdocs_page_input_path = "issues/2023-11-06.3067.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3067 Issue closed: Trying to build rescue ISO for Bacula backup</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3067_issue_closed_trying_to_build_rescue_iso_for_bacula_backup"><a href="https://github.com/rear/rear/issues/3067">#3067 Issue</a> <code>closed</code>: Trying to build rescue ISO for Bacula backup<a class="headerlink" href="#3067_issue_closed_trying_to_build_rescue_iso_for_bacula_backup" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="zenadmin-ops_opened_issue_at_2023-11-06_0544"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> opened issue at <a href="https://github.com/rear/rear/issues/3067">2023-11-06 05:44</a>:<a class="headerlink" href="#zenadmin-ops_opened_issue_at_2023-11-06_0544" title="Permanent link">&para;</a></h4>
<!-- Relax-and-Recover (ReaR) Issue Template
Fill in the following items when submitting a new issue.
Use GitHub Markdown, see "Basic writing and formatting syntax" on
https://docs.github.com/en/get-started/writing-on-github
Support is voluntary without guarantee/warranty/liability -->

<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): 2.7</p>
</li>
<li>
<p>If your ReaR version is not the current version, explain why you
    can't upgrade:</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"): Debian 11</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=file:///home/zen/debian11-recovery.iso
BACKUP=BACULA
BACULA_CONF_DIR=”/opt/bacula/etc”
BACULA_BIN_DIR=”/opt/bacula/bin”
USE_STATIC_NETWORKING="Yes"
IP=192.168.200.41
NM=255.255.255.0
GW=192.168.200.200
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR): Hyper-V VM</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    Hello,</p>
</li>
</ul>
<p>Attempting to create a ReaR recovery environment to perform a restore
using Bacula</p>
<p>Latest output from sudo rear mkrescue -v</p>
<pre><code>2023-11-05 12:25:07.005672167 Including prep/BACULA/default/450_check_BACULA_client_configured.sh
2023-11-05 12:25:07.008836829 Including prep/default/490_store_write_protect_settings.sh
2023-11-05 12:25:07.011793294 Including prep/GNU/Linux/500_EFISTUB_check_kernel.sh
2023-11-05 12:25:07.015053855 Including prep/BACULA/default/500_check_BACULA_bconsole_results.sh
2023-11-05 12:25:07.029257686 ERROR: Bacula director debian11-DR6 is not responding.
===== Stack trace =====
Trace 0: /usr/sbin/rear:696 main
Trace 1: /usr/share/rear/lib/mkrescue-workflow.sh:12 WORKFLOW_mkrescue
Trace 2: /usr/share/rear/lib/framework-functions.sh:129 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:59 Source
Trace 4: /usr/share/rear/prep/BACULA/default/500_check_BACULA_bconsole_results.sh:21 source
</code></pre>
<p>I think this is likely to be a configuration error as this system has
Bacula installed and operational.</p>
<p>After troubleshooting suggestions.</p>
<p>Thank you.</p>
<h4 id="zenadmin-ops_commented_at_2023-11-06_0550"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1794131801">2023-11-06 05:50</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2023-11-06_0550" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>Possibly the issue might be that I need to define a 'client' that the
ReaR recovery environment will use when performing the restore.</p>
<p>I must admit that I'm not entirely clear on this aspect of the
configuration at present.</p>
<h4 id="zenadmin-ops_commented_at_2023-11-07_2312"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1800350102">2023-11-07 23:12</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2023-11-07_2312" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>I've attempted some troubleshooting and this error appears to be a bug</p>
<pre><code>sudo rear mkrescue -v
Relax-and-Recover 2.7 / 2022-07-13
Running rear mkrescue (PID 405169 date 2023-11-08 10:07:54)
Using log file: /var/log/rear/rear-debian11-DR6.log
Running workflow mkrescue on the normal/original system
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-5.10.0-26-amd64' as kernel in the recovery system
ERROR: Bacula director debian11-DR6 is not responding.

2023-11-08 10:07:55.104444475 Including prep/BACULA/default/500_check_BACULA_bconsole_results.sh
2023-11-08 10:07:55.134400311 ERROR: Bacula director debian11-DR6 is not responding.
</code></pre>
<p>Here is the relevant code</p>
<pre><code># is the director server present? Fetch from $BACULA_CONF_DIR/bconsole.conf file
BACULA_DIRECTOR=$(grep -i address $BACULA_CONF_DIR/bconsole.conf | awk '{ print $3 }')
[ "${BACULA_DIRECTOR}" ] || Error "Director not defined in $BACULA_CONF_DIR/bconsole.conf"

# check if the director is responding?
if has_binary nc; then
   DIRECTOR_RESULT=$(nc -vz "${BACULA_DIRECTOR}" 9101 2&gt;&amp;1 | grep -i connected | wc -l)
   [[ $DIRECTOR_RESULT -eq 0 ]] &amp;&amp; Error "Bacula director ${BACULA_DIRECTOR} is not responding."
fi

# does the director allow connections from this client? bconsole knows!
#
# We want these two lines to show that we can connect to the director
# and that the director can connect to the file daemon on this system.
# "Connecting to Director 'director_name-fd:9101'"
# "Connecting to Client 'bacula_client_name-fd at FQDN:9102"
BACULA_CLIENT=$(grep $(hostname -s) $BACULA_CONF_DIR/bacula-fd.conf | grep "\-fd" | awk '{print $3}' | sed -e "s/-fd//g")
[ "${BACULA_CLIENT}" ] || Error "Client $(hostname -s) not defined in $BACULA_CONF_DIR/bacula-fd.conf"

BACULA_RESULT=( $(echo -e " status client=${BACULA_CLIENT}-fd" | bconsole | grep Connect) )

director=${BACULA_RESULT[3]}
client=${BACULA_RESULT[9]}
</code></pre>
<p>Here is the address from bconsole.conf</p>
<pre><code>address = debian11-DR6
</code></pre>
<p>Here is the output from the nc command</p>
<pre><code>nc -vz debian11-dr6 9101
debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) opensudo
</code></pre>
<h4 id="gdha_commented_at_2023-11-08_0621"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1801162987">2023-11-08 06:21</a>:<a class="headerlink" href="#gdha_commented_at_2023-11-08_0621" title="Permanent link">&para;</a></h4>
<p>What is the return code of the command:</p>
<pre><code>nc -vz debian11-dr6 9101
debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) opensudo
</code></pre>
<p>Perhaps, we could use this instead of looking for "connected"?</p>
<h4 id="zenadmin-ops_commented_at_2023-11-08_2133"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1802714651">2023-11-08 21:33</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2023-11-08_2133" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>Can you check the syntax of the 2nd line</p>
<pre><code>nc -vz debian11-dr6 9101
debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) open
zen@debian11-DR6:~$ debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) opensudo
bash: syntax error near unexpected token `('
</code></pre>
<h4 id="gdha_commented_at_2023-11-09_0706"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1803270422">2023-11-09 07:06</a>:<a class="headerlink" href="#gdha_commented_at_2023-11-09_0706" title="Permanent link">&para;</a></h4>
<p>@ZENAdmin-Ops What you need to do is:</p>
<blockquote>
<pre><code>$ nc -vz debian11-dr6 9101
debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) open
</code></pre>
</blockquote>
<pre><code>echo $?
</code></pre>
<h4 id="zenadmin-ops_commented_at_2023-11-09_0923"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1803457789">2023-11-09 09:23</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2023-11-09_0923" title="Permanent link">&para;</a></h4>
<pre><code>nc -vz debian11-dr6 9101 
debian11-DR6.zen.local [192.168.200.40] 9101 (bacula-dir) open
zen@debian11-DR6:~$ echo $?
0
</code></pre>
<h4 id="pcahyna_commented_at_2023-11-16_1817"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1814993866">2023-11-16 18:17</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-16_1817" title="Permanent link">&para;</a></h4>
<p>Hi, is the check using "nc" even needed? Isn't the subsequent check
using <code>bconsole</code> enough?</p>
<h4 id="pcahyna_commented_at_2023-11-16_1820"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1814997545">2023-11-16 18:20</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-16_1820" title="Permanent link">&para;</a></h4>
<p>I mean, doesn't answering the latter question</p>
<pre><code># does the director allow connections from this client? bconsole knows!
</code></pre>
<p>also implicitly answer the question</p>
<pre><code># check if the director is responding?
</code></pre>
<p>above it? presumably, if the director allow connections from this
client, it is also responding.</p>
<h4 id="github-actions_commented_at_2024-01-16_0210"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1892968294">2024-01-16 02:10</a>:<a class="headerlink" href="#github-actions_commented_at_2024-01-16_0210" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="zenadmin-ops_commented_at_2024-01-16_0211"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1892969285">2024-01-16 02:11</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2024-01-16_0211" title="Permanent link">&para;</a></h4>
<p>This ticket can be closed</p>
<h4 id="pcahyna_commented_at_2024-01-16_1042"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1893488536">2024-01-16 10:42</a>:<a class="headerlink" href="#pcahyna_commented_at_2024-01-16_1042" title="Permanent link">&para;</a></h4>
<p>@ZENAdmin-Ops for future users: what was the problem? And how was it
solved?</p>
<h4 id="zenadmin-ops_commented_at_2024-01-16_1710"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/3067#issuecomment-1894164406">2024-01-16 17:10</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2024-01-16_1710" title="Permanent link">&para;</a></h4>
<p>I never really got that problem fixed, since I switched fairly quickly
to running the restore from a bash script instead of trying to use the
(very minimal) built in bacula support in rear. With that said from
looking at the errors and the source code it looks like the problem is
that Rear is searching for "connected" in the output of "nc" to check if
the director is available, only nc doesn't ever actually say
"connected". I'm guessing this code was written for an earlier version
of nc that always had "connected" in its output if it was able to
connect. Currently that nc command gives output like this:<br />
Connection to localhost (127.0.0.1) 9101 port [tcp/bacula-dir]
succeeded!<br />
So it should really be searching for "succeeded" instead of "connected".</p>
<p>Probably the issue could be fixed by changing<br />
DIRECTOR_RESULT=$(nc -vz "${BACULA_DIRECTOR}" 9101 2&gt;&amp;1 | grep -i
connected | wc -l)<br />
to<br />
DIRECTOR_RESULT=$(nc -vz "${BACULA_DIRECTOR}" 9101 2&gt;&amp;1 | grep -i
succeeded | wc -l)</p>
<p>Although if nc ever changes its output it would break again... so it
would seem like there should be a better way for it to check the
connection rather than trying to parse nc's output. Also, a few lines
down it checks the connection again using bconsole... so the first check
is kind of unnecessary.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-11-06.3067.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
