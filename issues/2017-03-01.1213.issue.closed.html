<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1213 Issue closed: XFS mount failed with attributes sunit=128,swidth=86016 after updating RHEL 7.2 to 7.3 - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1213 Issue closed: XFS mount failed with attributes sunit=128,swidth=86016 after updating RHEL 7.2 to 7.3";
        var mkdocs_page_input_path = "issues/2017-03-01.1213.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1213 Issue closed: XFS mount failed with attributes sunit=128,swidth=86016 after updating RHEL 7.2 to 7.3</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1213_issue_closed_xfs_mount_failed_with_attributes_sunit128swidth86016_after_updating_rhel_72_to_73"><a href="https://github.com/rear/rear/issues/1213">#1213 Issue</a> <code>closed</code>: XFS mount failed with attributes sunit=128,swidth=86016 after updating RHEL 7.2 to 7.3<a class="headerlink" href="#1213_issue_closed_xfs_mount_failed_with_attributes_sunit128swidth86016_after_updating_rhel_72_to_73" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="gdha_opened_issue_at_2017-03-01_1424"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/1213">2017-03-01 14:24</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-03-01_1424" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): 2.00</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): RHEL 7.3</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
<li>Are you using legacy BIOS or UEFI boot? BIOS</li>
<li>Brief description of the issue:<br />
    When I restore an server with redhat 7.3 I will get the following
    error.<br />
    I edited then the <code>diskrestore.sh</code> and removed or set the two
    attributes =0 from all mount commands.</li>
</ul>
<p>Run the restore script with “5) Continue restore script”, and the
restore worked fine.</p>
<p>sunit=128,swidth=86016<br />
sunit=0,swidth=0</p>
<p>The original FS had those attributes set.</p>
<pre><code>/dev/mapper/h50l270vg00-root / xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0
</code></pre>
<p>After rear created the filesystem, those attributes are 0. This shown
down under Rear recreate Filesystem</p>
<p>If rear tries to mount the filesystem with <code>sunit=128,swidth=86016</code>, it
get the error.</p>
<p>I guess rear tries to mount the filesystem with the original attributes.
If this attributes are newly set to 0 the mount with the original
attributes does not work.</p>
<p>But I don’t know, why our filesystemes has set those attributes to this
values. The system are building automatically by redhat satellite.</p>
<p>ERROR Message:</p>
<pre><code>+++ Print 'Mounting filesystem /'
+++ test 1
+++ echo -e 'Mounting filesystem /'
+++ mkdir -p /mnt/local/
+++ mount -o rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota /dev/mapper/h50l270vg00-root /mnt/local/
mount: wrong fs type, bad option, bad superblock on /dev/mapper/h50l270vg00-root,
       missing codepage or helper program, or other error
       In some cases useful info is found in syslog - try
       dmesg | tail or so.
2017-02-28 11:20:53 An error occurred during layout recreation.
</code></pre>
<p>Mount Attributes before restore with rear:</p>
<pre><code>/dev/mapper/h50l270vg00-root / xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/mpatha1 /boot xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/h50l270vg00-vlog /var/log xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/h50l270vg00-uloc /usr/local xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/h50l270vg00-home /home xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/h50l270vg00-vlsu /var/log/suva xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0

/dev/mapper/h50l270vg00-alib /app/lib xfs rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota 0 0
</code></pre>
<p>Rear recreate command Filesystem</p>
<pre><code>+++ mkfs.xfs -f -m uuid=a7371b95-f96f-4e4e-b4dd-cc2318368198 /dev/mapper/h50l270vg00-alib
meta-data=/dev/mapper/h50l270vg00-alib isize=512    agcount=8, agsize=163840 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=1310720, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<h4 id="gdha_commented_at_2017-03-01_1623"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-283389097">2017-03-01 16:23</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-01_1623" title="Permanent link">&para;</a></h4>
<p>Let’s say we have an redhat 7.2 server.</p>
<p>If you create an xfs filesystem, on this version, all filesystems are
created with this two options. (Maybe on other disk types other options)</p>
<pre><code>sunit=16     swidth=10752 blks
</code></pre>
<p>On this level we can restore with rear without problems. All file
systems are recreated with this options and mounted while the restore
with this option. <strong>This seems to be the default for xfs.</strong></p>
<p>Now we <strong><em>migrate</em> this server to *redhat release 7.3</strong>*.</p>
<p>All existing file systems have still this options set.<br />
All newly created file system has this <em>option set to 0.</em> I guess the
default has changed.</p>
<p>Now we restore with rear. The rear creates all file systems with the new
iso (redhat 7.3).<br />
All File systems are created with this options =0, because it’s the new
default.<br />
Rear tries now to mount the newly created file systems with the original
options.</p>
<p>I try now to build a server redhat 7.3 directly from source. If the pxe
kernel is on release 7.3, all file systems should have the option set to
0.</p>
<h3 id="redhat_72">Redhat 7.2<a class="headerlink" href="#redhat_72" title="Permanent link">&para;</a></h3>
<p>Red Hat Enterprise Linux Server release 7.2 (Maipo)
3.10.0-327.36.1.el7.x86_64</p>
<pre><code># rpm -qa | grep xfs
xfsprogs-3.2.2-2.el7.x86_64
xfsdump-3.1.4-1.el7.x86_64
</code></pre>
<h3 id="redhat_73">Redhat 7.3<a class="headerlink" href="#redhat_73" title="Permanent link">&para;</a></h3>
<p>Red Hat Enterprise Linux Server release 7.3 (Maipo)
3.10.0-514.6.1.el7.x86_64</p>
<pre><code># rpm -qa | grep xfs
xfsprogs-4.5.0-9.el7_3.x86_64
xfsdump-3.1.4-1.el7.x86_64
</code></pre>
<h3 id="create_new_file_system_on_version_73">Create new file system on version 7.3<a class="headerlink" href="#create_new_file_system_on_version_73" title="Permanent link">&para;</a></h3>
<pre><code># mkfs.xfs /dev/`uname -n`vg00/wrat
meta-data=/dev/h50l270vg00/wrat  isize=512    agcount=8, agsize=32000 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=256000, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=855, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<h3 id="existing_option_for_migrated_server">Existing option for migrated Server<a class="headerlink" href="#existing_option_for_migrated_server" title="Permanent link">&para;</a></h3>
<pre><code># xfs_info  /app/lib
meta-data=/dev/mapper/h50l270vg00-alib isize=256    agcount=8, agsize=35200 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0 spinodes=0
data     =                       bsize=4096   blocks=281600, imaxpct=25
         =                       sunit=16     swidth=10752 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=16 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<h4 id="gdha_commented_at_2017-03-01_1624"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-283389192">2017-03-01 16:23</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-01_1624" title="Permanent link">&para;</a></h4>
<p>Issue #1174 might be related?</p>
<h4 id="gozora_commented_at_2017-03-01_1709"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-283403940">2017-03-01 17:09</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-01_1709" title="Permanent link">&para;</a></h4>
<p>Hello @gdha<br />
Yes and it is related to #1208 as well.<br />
My
<a href="https://github.com/rear/rear/issues/1208#issuecomment-282854316">https://github.com/rear/rear/issues/1208#issuecomment-282854316</a>
describes same behavior but with <em>ftype</em> parameter.</p>
<p>Looks like XFS does not forgive! :-)</p>
<p>I was thinking of calling <code>xfs_info</code> for every single XFS filesystem
during <code>rear mkbackup</code>, store is somewhere and using it during
<code>mkfs.xfs</code> ...</p>
<p>@gozora The problem might be across updates of xfsprogs that default
values change. Therefore, during recovery the default values might be
different then the ones captured in the <code>disklayout.conf</code> file, which is
the case in this issue.</p>
<h4 id="gdha_commented_at_2017-03-06_0736"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-284322737">2017-03-06 07:36</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-06_0736" title="Permanent link">&para;</a></h4>
<p>The <code>fs</code> line in <code>disklayout.conf</code> file looks like for (when running
<code>rear savelaout</code>):</p>
<ul>
<li>RHEL 7.2 (on a SAN attached disk) with
    <em>xfsprogs-3.2.2-2.el7.x86_64</em>:</li>
</ul>
<!-- -->

<pre><code>fs /dev/mapper/h50l270vg00-home /home xfs uuid=27ae5138-014a-458e-8df2-66fe7edb1e1c label=  options=rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota
</code></pre>
<ul>
<li>RHEL 7.2 upgraded to RHEL 7.3 with <em>xfsprogs-3.2.2-2.el7.x86_64</em>
    and then <em>xfsprogs-4.5.0-9.el7_3.x86_64</em> - afterwards the <code>mount</code>
    command bails out (see below):</li>
</ul>
<!-- -->

<pre><code>fs /dev/mapper/h50l270vg00-home /home xfs uuid=27ae5138-014a-458e-8df2-66fe7edb1e1c label=  options=rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota
</code></pre>
<ul>
<li>RHEL 7.3 (on a SAN attached disk) with
    <em>xfsprogs-4.5.0-9.el7_3.x86_64</em>:</li>
</ul>
<!-- -->

<pre><code>fs /dev/mapper/h50l270vg00-home /home xfs uuid=574090d7-be7f-4f54-9243-0612dfb8e048 label=  options=rw,relatime,attr2,inode64,noquota
</code></pre>
<p>Please note that a fresh installed RHEL 7.3 lacks the parameters
<code>sunit=128,swidth=86016</code> on a direct attached SAN device.<br />
According
<a href="http://xfs.org/index.php/XFS_FAQ#Q:_How_to_calculate_the_correct_sunit.2Cswidth_values_for_optimal_performance">http://xfs.org/index.php/XFS_FAQ#Q:_How_to_calculate_the_correct_sunit.2Cswidth_values_for_optimal_performance</a>
these 2 parameters are meant for RAID performance optimization. Another
article
<a href="http://linuxsnippets.net/en/snippet/xfs-how-calculate-correct-sunitswidth-values-optimal-performance">http://linuxsnippets.net/en/snippet/xfs-how-calculate-correct-sunitswidth-values-optimal-performance</a>
about the same.</p>
<ul>
<li>
<p>[ ] The default behaviour with xfsprogs-3.2.2-2 changed when using
    <code>mkfs.xfs</code> on a direct attached SAN device, especially for the
    parameters <code>sunit</code>, <code>swidth</code> and <code>crc</code></p>
</li>
<li>
<p>[ ] Be aware ReaR fails when trying to mount during recovery from
    an updated RHEL 7.2 to 7.3:</p>
</li>
</ul>
<!-- -->

<pre><code>mount -o rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota /dev/mapper/h50l270vg00-root /
</code></pre>
<p>and the correct command should be (as the mkfs re-created the file
system with the defaults <code>sunit=0,swidth=0</code>):</p>
<pre><code>mount -o rw,relatime,attr2,inode64,noquota /dev/mapper/h50l270vg00-root /
</code></pre>
<ul>
<li>[ ] perhaps we need to cross check the values in <code>disklayout.conf</code>
    file with the ones returned by <code>xfs_info</code> before mounting it in
    recovery mode? @gozora @jsmeix any thoughts?<br />
    Also the <code>/etc/fstab</code> file may need to be changed.</li>
</ul>
<h4 id="gozora_commented_at_2017-03-07_1601"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-284764684">2017-03-07 16:01</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-07_1601" title="Permanent link">&para;</a></h4>
<p>Hello @gdha,</p>
<p>I was working on this topic a bit.<br />
For me only reasonable and safe way is to parse/save <code>xfs_info</code> data
during <code>rear mkbackup/mkrescue</code> and use this data for filesystem
re-creation during <code>rear recover</code>. Once we have filesystem created with
correct options mount will just work.</p>
<p>If I should host "Least friendly parse output" contest <code>xfs_info</code> would
be winner. (<a href="https://www.redhat.com/archives/libguestfs/2012-July/msg00025.html">some interesting
reading</a>).
I'll try to find some way how to process these data and transform them
to <code>mkfs.xfs</code> friendly syntax.</p>
<p>V.</p>
<h4 id="gdha_commented_at_2017-03-08_1650"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285097572">2017-03-08 16:50</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-08_1650" title="Permanent link">&para;</a></h4>
<p>@gozora I did some tests by trying to re-use the values found in
<code>options</code> of the <strong>fs</strong> line in <code>disklayout.conf</code> file. The bottom-line
is not that simple, and what we use to re-create a XFS file systems in
recover mode (the <em>defaults</em>, e.g.
<code>mkfs.xfs -f /dev/mapper/h50l270vg00-root</code>) is most likely the desired
state we want.</p>
<pre><code>[root@centos7-kvm ~]# mkfs.xfs -f /dev/sda1
meta-data=/dev/sda1              isize=256    agcount=4, agsize=52352 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0
data     =                       bsize=4096   blocks=209408, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal log           bsize=4096   blocks=853, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0


[root@centos7-kvm ~]# mount /dev/sda1 /mnt
[root@centos7-kvm ~]# xfs_info /mnt
meta-data=/dev/sda1              isize=256    agcount=4, agsize=52352 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0
data     =                       bsize=4096   blocks=209408, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal               bsize=4096   blocks=853, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

## options=rw,relatime,attr2,inode64,logbsize=64k,sunit=128,swidth=86016,noquota

[root@centos7-kvm ~]# mkfs.xfs -f -l size=64k -d sunit=128 -d swidth=86016 /dev/sda1
log size 16 blocks too small, minimum size is 768 blocks
Usage: mkfs.xfs
/* blocksize */     [-b log=n|size=num]
/* metadata */      [-m crc=0|1,finobt=0|1]
/* data subvol */   [-d agcount=n,agsize=n,file,name=xxx,size=num,
                (sunit=value,swidth=value|su=num,sw=num|noalign),
                sectlog=n|sectsize=num
/* force overwrite */   [-f]
/* inode size */    [-i log=n|perblock=n|size=num,maxpct=n,attr=0|1|2,
                projid32bit=0|1]
/* no discard */    [-K]
/* log subvol */    [-l agnum=n,internal,size=num,logdev=xxx,version=n
                sunit=value|su=num,sectlog=n|sectsize=num,
                lazy-count=0|1]
/* label */     [-L label (maximum 12 characters)]
/* naming */        [-n log=n|size=num,version=2|ci,ftype=0|1]
/* no-op info only */   [-N]
/* prototype file */    [-p fname]
/* quiet */     [-q]
/* realtime subvol */   [-r extsize=num,size=num,rtdev=xxx]
/* sectorsize */    [-s log=n|size=num]
/* version */       [-V]
            devicename
&lt;devicename&gt; is required unless -d name=xxx is given.
&lt;num&gt; is xxx (bytes), xxxs (sectors), xxxb (fs blocks), xxxk (xxx KiB),
      xxxm (xxx MiB), xxxg (xxx GiB), xxxt (xxx TiB) or xxxp (xxx PiB).
&lt;value&gt; is xxx (512 byte blocks).


[root@centos7-kvm ~]# mkfs.xfs -f -d sunit=128 -d swidth=86016 /dev/sda1
meta-data=/dev/sda1              isize=256    agcount=8, agsize=26176 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0
data     =                       bsize=4096   blocks=209408, imaxpct=25
         =                       sunit=16     swidth=10752 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal log           bsize=4096   blocks=768, version=2
         =                       sectsz=512   sunit=16 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<p>My conclusions:</p>
<ul>
<li>
<p>[ ] save the <code>/etc/fstab</code> file during the <strong>savelayout</strong> work-flow
    under <code>/var/lib/rear/layout/config</code> directory and give it a name
    like <code>fstab.txt</code> to differentiate from <code>/etc/fstab</code> as we will only
    use it to find the options for a given file system (if needed of
    course)</p>
</li>
<li>
<p>[ ] if we find <em>defaults</em> in the <code>fstab.txt</code> for a fs line we want
    to re-create then we are save to get rid of any options that might
    give conflicts, like <code>logbsize=64k,sunit=128,swidth=86016</code></p>
</li>
</ul>
<h4 id="gozora_commented_at_2017-03-08_1707"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285102667">2017-03-08 17:07</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-08_1707" title="Permanent link">&para;</a></h4>
<p>Hello @gdha</p>
<blockquote>
<p>The bottom-line is not that simple, and what we use to re-create a XFS
file systems in recover mode (the defaults, e.g. mkfs.xfs -f
/dev/mapper/h50l270vg00-root) is most likely the desired state we
want.</p>
</blockquote>
<p>I agree that this is not a simple thing to do, but using defaults is not
desirable (to my opinion).</p>
<p>Imagine situation where you would create your file system with e.g.
<strong>crc=1</strong> (despite it is non default option.) I think that using non
default options is perfectly fine and ReaR should reflect user choice
during <code>rear recover</code>. In upper listed scenario you'd get back system
which have <strong>crc=0</strong> hence some applications that were previously
working might start misbehave, or performance problems might be
introduced. (Take
<a href="https://github.com/rear/rear/issues/1208">https://github.com/rear/rear/issues/1208</a>
as an example).</p>
<p>Now speaking as sysadmin, I would really not appreciate this much ...</p>
<p>V.</p>
<h4 id="gdha_commented_at_2017-03-09_0735"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285276957">2017-03-09 07:35</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-09_0735" title="Permanent link">&para;</a></h4>
<p>@gozora strictly spoken you are right, however, in practice I noticed
that mkfs.xfs seems to do whatever it pleases with most parameters
given, or by bailing out (and end-user complains), or by modifying the
parameters to whatever XFS thinks best fit. I assume as sysadmin that
gives you a bad feeling as well. For this reason I find it very
uncomfortable to choose between defaults (what we do now) and do the
right thing (and increasing bailing out).<br />
Therefore, I think that using the input from <code>fstab.txt</code> could help us
to decide what was defined before? OTOH, you can tune XFS in other ways
too and that complicate things further. Pff need some time to decide.<br />
@jsmeix Can you assist us in making a decision? :-)</p>
<h4 id="jsmeix_commented_at_2017-03-09_0909"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285295425">2017-03-09 09:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-09_0909" title="Permanent link">&para;</a></h4>
<p>A generic proposal from my point of view:</p>
<p>I assume we can agree that in practice it is impossible<br />
(with reasonable effort) that ReaR always recreates a<br />
filesystem exactly as it was on the original system. cf.<br />
<a href="https://github.com/rear/rear/issues/1208#issuecomment-282991951">https://github.com/rear/rear/issues/1208#issuecomment-282991951</a></p>
<p>Furthermore my personal opinion is that currently ReaR<br />
tries too much to do things right in a silently working<br />
automated way, cf.<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282252947">https://github.com/rear/rear/pull/1204#issuecomment-282252947</a></p>
<p>Therefore I would like to suggest that first and foremost<br />
configuration variables are implemented where the user can<br />
(if needed) specify special filesystem setup parameters, cf.<br />
the new USB_DEVICE_FILESYSTEM_PARAMS variable, see<br />
<a href="https://github.com/rear/rear/pull/1217/files">https://github.com/rear/rear/pull/1217/files</a></p>
<p>This way the user has at least some manual means for now<br />
to enforce that "rear recover" results exactly what he needs.</p>
<p>Afterwards step by step ReaR can be further enhanced to<br />
autodetect more and more filesystem settings so that then<br />
step by step ReaR can recreate a filesystem more and more<br />
as is was before.</p>
<p>Because during "rear recover" several filesystems are recreated<br />
(also several filesystems of same type) I have currently no real<br />
good idea how configuration variables for filesystem setup<br />
parameters could be best implemented. I think those variables<br />
have to be arrays but currently I have no real good idea<br />
how to generically specify which parameters should belong<br />
to which particular filesystem. Perhaps using the device node<br />
of the filesystem (e.g. /dev/sda1 ) to match an 'fs' entry<br />
in disklayout.conf is a useful way?</p>
<h4 id="gozora_commented_at_2017-03-09_1505"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285376306">2017-03-09 15:05</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-09_1505" title="Permanent link">&para;</a></h4>
<p>Hello @gdha</p>
<blockquote>
<p>I noticed that mkfs.xfs seems to do whatever it pleases with most
parameters given, or by bailing out (and end-user complains), or by
modifying the parameters to whatever XFS thinks best fit.</p>
</blockquote>
<p>Yes, I've noticed this as well, <em>sunit, swidth</em> are such parameters
where you need to include some math to set them correctly. There is also
a group of parameters that are derived or mutually exclusive ....</p>
<blockquote>
<p>Therefore, I think that using the input from fstab.txt could help us
to decide what was defined before? OTOH, you can tune XFS in other
ways too and that complicate things further. Pff need some time to
decide.</p>
</blockquote>
<p>This is another nightmare, because mount options would not tell you
about how e.g. <em>crc</em>, <em>ftype</em> are setup ...</p>
<p>I'm trying to find out reasonable (both readable and easy to maintain)
sollution that could help here. So far I've failed 3 times already, but
I keep trying. At the end it is interesting challenge for me ...</p>
<p>@jsmeix</p>
<blockquote>
<p>Furthermore my personal opinion is that currently ReaR<br />
tries too much to do things right in a silently working<br />
automated way, cf.</p>
</blockquote>
<p>I take the risk that you will refuse merging PR (if I ever succeed to
write it :-)), and I'll fully understand that! But who knows, maybe you
will like it at the end ;-).</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-03-09_2023"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285470374">2017-03-09 20:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-09_2023" title="Permanent link">&para;</a></h4>
<p>Hello @gdha, @jsmeix,</p>
<p>I've created first prototype of
<a href="https://github.com/gozora/xfs_parse/blob/master/xfs_parse-0.1.0.sh">code</a>
that could help to solve this problem.<br />
I'd like to know your opinion on this idea in general.</p>
<p>If you would like to test it:<br />
<code># xfs_info &lt;xfs_filesystem_to_examine&gt; | ./xfs_parse-0.1.0.sh</code></p>
<p>which outputs something like:<br />
<code>mkfs.xfs -f -i size=512 -d agcount=4 -s size=1024 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=0 -b size=2048 -i maxpct=50 -d sunit=0 -d swidth=0 &lt;device&gt;</code></p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-03-10_0919"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285618629">2017-03-10 09:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-10_0919" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
regarding your<br />
<a href="https://github.com/rear/rear/issues/1213#issuecomment-285376306">https://github.com/rear/rear/issues/1213#issuecomment-285376306</a><br />
"I take the risk that you will refuse merging PR":</p>
<p>Don't worry:<br />
I will not refuse to merge useful additional automatisms.</p>
<p>But I think you may have misunderstood what I mean.</p>
<p>I am not against automatisms.<br />
I am for automatisms as default or fallback functionality.</p>
<p>I am against automatisms that remove the final control from the user<br />
(which I called "do things in a silently working automated way").</p>
<p>Have a look at<br />
<a href="https://github.com/rear/rear/pull/1212">https://github.com/rear/rear/pull/1212</a><br />
how I have documented UEFI_BOOTLOADER<br />
in default.conf (so that it is no longer "silently working") and<br />
how I have implemented UEFI_BOOTLOADER support in<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/rescue/default/850_save_sysfs_uefi_vars.sh">https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/rescue/default/850_save_sysfs_uefi_vars.sh</a><br />
therein in particular (excerpts):</p>
<pre>
When the user has specified UEFI_BOOTLOADER
in /etc/rear/local.conf use it
...
fall back step by step to more and more complicated
autodetection methods until a usable UEFI bootloader file is found
or error out if nothing is found
...
what the user has specified must have precedence over automatisms
</pre>

<p>This way the user still has the final control because when he<br />
specifies UEFI_BOOTLOADER this is used (and nothing else)<br />
but when the user does not make such a decision<br />
ReaR does various automatisms to "get things right"<br />
and if that fails ReaR errors out at that current place<br />
with a meaningful error message, cf.<br />
<a href="https://github.com/rear/rear/issues/1233">https://github.com/rear/rear/issues/1233</a></p>
<h4 id="jsmeix_commented_at_2017-03-10_0931"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285621142">2017-03-10 09:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-10_0931" title="Permanent link">&para;</a></h4>
<p>@gdha @gozora FYI:<br />
currently I do not have much time for ReaR issues<br />
because currently I have to work on other areas<br />
which is currently mainly printing related stuff, cf.<br />
<a href="https://en.opensuse.org/User:Jsmeix">https://en.opensuse.org/User:Jsmeix</a></p>
<h4 id="gdha_commented_at_2017-03-10_1434"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-285683655">2017-03-10 14:34</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-10_1434" title="Permanent link">&para;</a></h4>
<p>@gozora I think you are on the right track - looks promising so far.</p>
<h4 id="gozora_commented_at_2017-03-23_1010"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288672963">2017-03-23 10:10</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-23_1010" title="Permanent link">&para;</a></h4>
<p>I have first
<a href="https://github.com/gozora/xfs_parse/blob/master/xfs_parse.sh">version</a>
that can create XFS fielsystem reasonably well, now I'll try to
integrate it into ReaR without creating havoc ...</p>
<p>V</p>
<h4 id="jsmeix_commented_at_2017-03-23_1200"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288696923">2017-03-23 12:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-23_1200" title="Permanent link">&para;</a></h4>
<p>Wow!<br />
<a href="https://github.com/gozora/xfs_parse/blob/master/xfs_parse.sh">https://github.com/gozora/xfs_parse/blob/master/xfs_parse.sh</a><br />
looks daunting.</p>
<h4 id="gozora_commented_at_2017-03-23_2031"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288850592">2017-03-23 20:31</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-23_2031" title="Permanent link">&para;</a></h4>
<p>Hello @gdha, hello @jsmeix</p>
<p>My first idea would be to trigger save of XFS related options using
<a href="https://github.com/rear/rear/compare/master...gozora:xfs_parse">230_filesystem_layout.sh</a>
into $VAR_DIR/layout/config/.<br />
This configs would be later transposed by
<a href="https://github.com/gozora/xfs_parse/blob/master/xfs_parse.sh">xfs_parse.sh</a>
to <code>mkfs.xfs -f ...</code> command used in <em>diskrestore.sh</em></p>
<p>What do you think?</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-03-24_0920"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288972005">2017-03-24 09:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-24_0920" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I think during "rear mkbackup/mkrescue" saving XFS specific things<br />
into a file in $VAR_DIR/layout/ and use that during "rear recover"<br />
is "the one and only" (TM) right way.</p>
<p>On only wonder if $VAR_DIR/layout/config/ is right<br />
or perhaps if $VAR_DIR/layout/xfs/ could be better?<br />
In the end this does not really matter.<br />
Use whatever file in $VAR_DIR/layout/ you like most.</p>
<p>I also wonder if for XFS specific things a separated new script<br />
layout/save/GNU/Linux/232_xfs_filesystem_settings.sh<br />
would be better?</p>
<h4 id="gozora_commented_at_2017-03-24_0950"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288978395">2017-03-24 09:50</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-24_0950" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix</p>
<blockquote>
<p>On only wonder if $VAR_DIR/layout/config/ is right<br />
or perhaps if $VAR_DIR/layout/xfs/ could be better?<br />
In the end this does not really matter.<br />
Use whatever file in $VAR_DIR/layout/ you like most.</p>
</blockquote>
<p>Fine with that, for me it doesn't really matter where we will store xfs
properties files.</p>
<blockquote>
<p>I also wonder if for XFS specific things a separated new script<br />
layout/save/GNU/Linux/232_xfs_filesystem_settings.sh<br />
would be better?</p>
</blockquote>
<p>I've decided to use <em>230_filesystem_layout.sh</em> because it already
contains code that handles some XFS specific tasks:</p>
<pre><code>(xfs)
                uuid=$(xfs_admin -u $device | cut -d'=' -f 2 | tr -d " ")
                label=$(xfs_admin -l $device | cut -d'"' -f 2)
                echo -n " uuid=$uuid label=$label "
                xfs_info $device &gt; $VAR_DIR/layout/config/$(basename ${device}.rear_xfs)
                ;;
</code></pre>
<p>Creating separate file for saving XFS options will in my opinion create
duplicate code with same functionality we already have.</p>
<p>But if you think it will be easier to read, I have no problem adapting
it.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-03-24_1006"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-288981881">2017-03-24 10:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-24_1006" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I fully agree that code for one same functionality<br />
(here XFS options) must be at one same place, cf.<br />
<a href="https://github.com/rear/rear/issues/1229#issuecomment-286998459">https://github.com/rear/rear/issues/1229#issuecomment-286998459</a></p>
<p>In general:<br />
Because you implement and maintain it,<br />
you make the decisions what is best.<br />
What I do are only some side notes<br />
from an outsider's point of view.</p>
<h4 id="gozora_commented_at_2017-03-26_1402"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-289286577">2017-03-26 14:02</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-26_1402" title="Permanent link">&para;</a></h4>
<p>Hello @gdha, hello @jsmeix,</p>
<p>I have first working
<a href="https://github.com/rear/rear/compare/master...gozora:xfs_parse">code</a>
for parsing XFS options ready. I'll do pull request once I've done
broader testing of this code. (so far only Centos 7.2 was tested).</p>
<p>I've used following test scenario, which old ReaR code was not able to
handle:</p>
<ul>
<li>
<p>XFS logical volume created with following parameters:<br />
<code>mkfs.xfs -f -i size=1024 -d agcount=4 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=0 -b size=4096 -i maxpct=25 -d sunit=512 -d swidth=1024 -l version=2 -l sunit=0 -l lazy-count=1 -n size=4096 -n version=ci -r extsize=4096 -n ftype=1 /dev/mapper/vg00-lv_xfs</code></p>
</li>
<li>
<p><em>/etc/fstab</em> entry:<br />
<code>/dev/mapper/vg00-lv_xfs /data                    xfs    sunit=512,swidth=1024,attr2        0 0</code></p>
</li>
</ul>
<p>@gdha If you know someone struggling with this XFS problem and willing
to do some testing,
<a href="https://github.com/gozora/rear/tree/xfs_parse">https://github.com/gozora/rear/tree/xfs_parse</a>
is branch to clone.</p>
<p>Thanks</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-03-26_2002"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-289310669">2017-03-26 20:02</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-26_2002" title="Permanent link">&para;</a></h4>
<p>Tests on SLES12 SP1 passed!</p>
<p>Only troublemaker occurred was problem with mounting of XFS partition.<br />
Mount failed with error: <code>mount: Structure needs cleaning</code><br />
This was caused by code in <em>130_include_filesystem_code.sh</em>:<br />
<code>xfs_admin -U $uuid $device &gt;&amp;2</code><br />
Fortunately it was easy to fix with <code>xfs_repair</code></p>
<p>Next week I'll continue with tests on Debian and its derivatives (Ubuntu
and Mate) and SLES11.</p>
<p>V.</p>
<h4 id="gdha_commented_at_2017-03-28_1412"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-289782639">2017-03-28 14:12</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-28_1412" title="Permanent link">&para;</a></h4>
<p>@gozora The modified in script <code>230_filesystem_layout.sh</code> works fine:</p>
<pre><code>$ cat ./rear/var/lib/rear/layout/xfs/vgswap-lvxfs.xfs 
meta-data=/dev/mapper/vgswap-lvxfs isize=256    agcount=8, agsize=25598 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0
data     =                       bsize=4096   blocks=204784, imaxpct=25
         =                       sunit=2      swidth=64 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal               bsize=4096   blocks=512, version=2
         =                       sectsz=512   sunit=2 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<p>I would rename script <code>usr/share/rear/lib/xfs-functions.sh</code> into
<code>usr/share/rear/lib/filesystems-functions.sh</code> in case we need to add
new functions for new to discover file systems.</p>
<p>In script
<code>usr/share/rear/layout/prepare/GNU/Linux/130_include_filesystem_code.sh</code>
I have one doubt with line
<code>echo "    mkfs.xfs -f $xfs_opts $device &gt;&amp;2"</code> - what if the values
create by the <code>mkfs.xfs</code> code are slightly different then what we
give?<br />
It could be that the <code>mount</code> command would still fail, because the mount
options registered in the mount options variable of the <code>fs</code> line in the
<code>disklayout.conf</code> file would differ from the ones we created above by
the <code>mkfs.xfs</code> command.<br />
To be fair I did not come that far in my tests.</p>
<h4 id="gozora_commented_at_2017-03-28_1450"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-289795165">2017-03-28 14:50</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-28_1450" title="Permanent link">&para;</a></h4>
<p>Hello @gdha,</p>
<blockquote>
<p>I would rename script usr/share/rear/lib/xfs-functions.sh into
usr/share/rear/lib/filesystems-functions.sh in case we need to add new
functions for new to discover file systems.</p>
</blockquote>
<p>Sure will do.</p>
<blockquote>
<p>In script
usr/share/rear/layout/prepare/GNU/Linux/130_include_filesystem_code.sh
I have one doubt with line echo " mkfs.xfs -f $xfs_opts $device
&gt;&amp;2" - what if the values create by the mkfs.xfs code are slightly
different then what we give?<br />
It could be that the mount command would still fail, because the mount
options registered in the mount options variable of the fs line in the
disklayout.conf file would differ from the ones we created above by
the mkfs.xfs command.</p>
</blockquote>
<p>There should be no problem with this. <code>230_filesystem_layout.sh</code> first
dumps file system parameters during <code>rear mkbackup/mkrescue</code> and ReaR
later stores <code>mount</code> parameters for each XFS filesystem. Meaning that if
you had mounted XFS file system during <code>rear mkbackup/mkrescue</code> you have
a quite good chance that rescue system will mount it without problems as
well.<br />
If you have some real life example when we could have failure with
mounting, just let me know and I'll test it.</p>
<p>I'm still testing different XFS versions and looking for possible
problems, but so far it looks quite well.<br />
For an update, yesterday I've done tests on Ubuntu Mate 16.4 with quite
new version of XFS and it just worked.<br />
Today I'm continuing with Debian Jessie ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-03-31_0726"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-290637802">2017-03-31 07:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-31_0726" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1276">https://github.com/rear/rear/pull/1276</a>
merged<br />
I think this issue should be fixed.<br />
If not it can be reopened.</p>
<p>For each other separated XFS related problem<br />
a separated new GitHub issue should be submitted.</p>
<h4 id="jsmeix_commented_at_2017-03-31_0728"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-290638112">2017-03-31 07:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-31_0728" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
many thanks for your brave fighting against XFS monsters!<br />
;-)</p>
<h4 id="gozora_commented_at_2017-03-31_0823"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1213#issuecomment-290649100">2017-03-31 08:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-03-31_0823" title="Permanent link">&para;</a></h4>
<p>No problem, hope it will do more good than harm ;-).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-03-01.1213.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
