<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2903 PR merged: Protect against colons in pvdisplay output - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2903 PR merged: Protect against colons in pvdisplay output";
        var mkdocs_page_input_path = "issues/2023-01-02.2903.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2903 PR merged: Protect against colons in pvdisplay output</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2903_pr_merged_protect_against_colons_in_pvdisplay_output"><a href="https://github.com/rear/rear/pull/2903">#2903 PR</a> <code>merged</code>: Protect against colons in pvdisplay output<a class="headerlink" href="#2903_pr_merged_protect_against_colons_in_pvdisplay_output" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2023-01-02_1512"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2903">2023-01-02 15:12</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2023-01-02_1512" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL): fixes #1958</p>
</li>
<li>
<p>How was this pull request tested?</p>
<ul>
<li>full back-up and recovery on RHEL 8.7 / x86_64 (BIOS) with SATA
    disk, LVM in default configuration</li>
<li>full back-up and recovery on RHEL 8.7 / x86_64 (BIOS) with SATA
    disk, LVM configured to show <code>/dev/disk/by-path</code> device symlinks
    instead of the usual <code>/dev/sd*</code> device nodes by using this line
    in /etc/lvm/lvm.conf:<br />
<code>filter = [ "r|/dev/disk/by-path/.*-usb-|", "a|/dev/disk/by-path/pci-.*-nvme-|", "a|/dev/disk/by-path/pci-.*-scsi-|", "a|/dev/disk/by-path/pci-.*-ata-|", "a|/dev/disk/by-path/pci-.*-sas-|", "a|loop|", "r|.*|" ]</code>.<br />
    This case breaks with the original code already during
    <code>rear savelayout</code> and is fixed by this change.</li>
</ul>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>LVM can be configured to show device names under <code>/dev/disk/by-path</code> in
command output. These names often contain colons that separate fields
like channel and target (for example
<code>/dev/disk/by-path/pci-*-scsi-0:0:1:0-*</code>, similarly the <code>pci-*</code> part,
which contains colon-separated PCI bus and device numbers). Since the
"<code>pvdisplay -c</code>" output also uses colons as field separators and does
not escape embedded colons in any way, embedded colons break parsing of
this output.</p>
<p>As a fix, use the pipe character '<code>|</code>' as the field separator in
pvdisplay output. (This would break if a PV device has a '<code>|</code>' in its
name, but this is very much less likely than having a '<code>:</code>' .)</p>
<p>I did a survey of how similar problems are handled in other tools. Some
Solaris tools (ipadm, dladm, zoneadm) have a special switch (<code>-p</code>) to
request machine-parseable format. This format has colon-separated
fields, and embedded colons are escaped by backslash to allow parsing by
the shell "read" command (this escaping is the key functionality missing
in the pvdisplay command). zfs has a <code>-H</code> option which uses an
alternative parseable format: in addition to omitting headers it
separates the fields by a single TAB character. This would be in
principle ideal for our purpose (TABs are unlikely to occur in the
values), but in our case the output is processed via an unquoted "echo"
command, which would not preserve the TAB character. (This is needed to
remove the two leading spaces in the output, not sure what their purpose
is.) I believe that using <code>|</code> as the separator is the best choice in our
situation.</p>
<p>Also, configure explicitly what fields to output - "<code>pvdisplay -c</code>"
prints many fields, but I have not found documentation about what fields
is it using exactly, so one had to guess what the output means. Using
"<code>pvdisplay -C</code>" and selecting the fields explicitly is much clearer.</p>
<p>This also changes the PV size field to match documentation, the comment
says that size is in bytes, but it actually was not in bytes. As nothing
is actually using the PV size field, this inconsistency has not caused
any problem in practice, and no code needs adjusting for the change.</p>
<p>Fix provided by a customer in
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=2091163">https://bugzilla.redhat.com/show_bug.cgi?id=2091163</a>
.</p>
<h4 id="jsmeix_commented_at_2023-01-02_1609"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2903#issuecomment-1369062612">2023-01-02 16:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-02_1609" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
while you are at that code<br />
and when you like to do it:</p>
<p>I think when we have '|' as field separator<br />
the whole parsing could be simplified and<br />
made more straightforward as follows</p>
<pre><code># { echo '  /dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:1:0-part1|system|107340627968|7wwpcO-KmNN-qsTE-7sp7-JBJS-vBdC-Zyt1W7' ; \
    echo '  /dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:1:0-part2 | system2 |  207340627962|2wwpcO-KmNN-qsTE-7sp7-JBJS-vBdC-Zyt1W2  ' ; } \
  | tr -d ' ' \
  | while IFS='|' read pdev vgrp size uuid ; \
    do echo -e "\npdev='$pdev'\nvgrp='$vgrp'\nsize='$size'\nuuid='$uuid'\n" ; \
    done

pdev='/dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:1:0-part1'
vgrp='system'
size='107340627968'
uuid='7wwpcO-KmNN-qsTE-7sp7-JBJS-vBdC-Zyt1W7'


pdev='/dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:1:0-part2'
vgrp='system2'
size='207340627962'
uuid='2wwpcO-KmNN-qsTE-7sp7-JBJS-vBdC-Zyt1W2'
</code></pre>
<p>I remove all space characters via <code>tr -d ' '</code><br />
because space is the field separator in disklayout.conf<br />
according to "Disk layout file syntax" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
so spaces in values are forbidden anyway.</p>
<p>The</p>
<pre><code>... | while IFS='|' read ... ; do ...
</code></pre>
<p>sets the non-standard IFS value only for the 'read' command<br />
but it keeps the standard IFS value (space, tab, newline)<br />
for the commands in the 'while' body:</p>
<pre><code># echo 'foo|bar' | while IFS='|' read a b ; do echo "a=$a" ; echo -n "IFS=$IFS" | od -a ; echo "b=$b" ; done

a=foo
0000000   I   F   S   =  sp  ht  nl
0000007
b=bar
</code></pre>
<h4 id="pcahyna_commented_at_2023-01-04_1532"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2903#issuecomment-1371078094">2023-01-04 15:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-04_1532" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix , thank you for the suggestion, but I must say I am
reluctant to make such changes to the layout code, if there is no bug to
fix (except the bug fixed by the PR in the current form) .</p>
<h4 id="jsmeix_commented_at_2023-01-05_0942"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2903#issuecomment-1371989412">2023-01-05 09:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-05_0942" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
it is perfectly fine with me to only fix the actual issue here.</p>
<p>I had meant it only as a suggestion for further improvement.<br />
Perhaps I may do that when I have to work on that code again.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-01-02.2903.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
