<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3104 PR merged: Error() instead of BugError() in 850_make_USB_bootable.sh - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3104 PR merged: Error() instead of BugError() in 850_make_USB_bootable.sh";
        var mkdocs_page_input_path = "issues/2023-12-11.3104.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3104 PR merged: Error() instead of BugError() in 850_make_USB_bootable.sh</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3104_pr_merged_error_instead_of_bugerror_in_850_make_usb_bootablesh"><a href="https://github.com/rear/rear/pull/3104">#3104 PR</a> <code>merged</code>: Error() instead of BugError() in 850_make_USB_bootable.sh<a class="headerlink" href="#3104_pr_merged_error_instead_of_bugerror_in_850_make_usb_bootablesh" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2023-12-11_1054"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/3104">2023-12-11 10:54</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2023-12-11_1054" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/1571">https://github.com/rear/rear/issues/1571</a><br />
    and<br />
<a href="https://github.com/rear/rear/issues/3098">https://github.com/rear/rear/issues/3098</a><br />
    i.e. false BUG Error in<br />
    output/USB/Linux-i386/850_make_USB_bootable.sh<br />
    because of unsupported OUTPUT_URL for OUTPUT=USB</p>
</li>
<li>
<p>How was this pull request tested?<br />
    Not tested.<br />
    Those code changes should not cause any issue.</p>
</li>
<li>
<p>Description of the changes in this pull request:</p>
</li>
</ul>
<p>In output/USB/Linux-i386/850_make_USB_bootable.sh replaced the</p>
<pre><code>BugError "Filesystem where the booting related files are on $RAW_USB_DEVICE could not be found"
</code></pre>
<p>with more explanatory LogPrintError plus Error what the actual reason
is,<br />
similar as in the related<br />
<a href="https://github.com/rear/rear/pull/3102">https://github.com/rear/rear/pull/3102</a><br />
because in most cases it is not a bug in ReaR<br />
but an error (e.g. a user configuration error for OUTPUT=USB).</p>
<h4 id="jsmeix_commented_at_2023-12-12_1628"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1852384407">2023-12-12 16:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-12_1628" title="Permanent link">&para;</a></h4>
<p>For documentation here a copy of<br />
a comment from @pcahyna directly at the code changes<br />
which got lost because I changed that code lines via<br />
<a href="https://github.com/rear/rear/commit/5d86ec547e03fc8fa7d635b46f642682662004da">https://github.com/rear/rear/commit/5d86ec547e03fc8fa7d635b46f642682662004da</a></p>
<pre><code>Error "Unsupported filesystem $usb_filesystem for the booting related files on $RAW_USB_DEVICE"

This part is a bit misleading.
The purpose of the code is to determine the
filesystem on `$RAW_USB_DEVICE`.
But the code does not use `RAW_USB_DEVICE` at all
except in messages and comments.
It uses `$BUILD_DIR/outputfs` instead.
So, it may well happen that `$RAW_USB_DEVICE` is ext3-formatted,
but there is a XFS filesystem mounted at `$BUILD_DIR/outputfs`
(because of some `OUTPUT_URL` confusion that makes `RAW_USB_DEVICE`
 out of sync with `OUTPUT_URL`).
In that case, the user, when seeing the error message,
will check the filesystem on `$RAW_USB_DEVICE`
and will see that it is ext3, and will wonder
what is ReaR complaining about.
</code></pre>
<p>Here also copies of my replies for completeness:</p>
<pre><code>My idea was to show both $BUILD_DIR/outputfs and $RAW_USB_DEVICE
because $BUILD_DIR/outputfs is a meaningless directory like

/var/tmp/rear.Bhlh9JjUxW91R0i/outputfs

so $RAW_USB_DEVICE provides some context to the user
that this two messages are about his USB device.

I will show both $BUILD_DIR/outputfs and $RAW_USB_DEVICE

I will not fix here the possible OUTPUT_URL confusion
that makes RAW_USB_DEVICE out of sync with OUTPUT_URL
because that belongs to a separated overhaul task
of our whole OUTPUT=USB code.
</code></pre>
<h4 id="jsmeix_commented_at_2023-12-12_1636"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1852400590">2023-12-12 16:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-12_1636" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/commit/5d86ec547e03fc8fa7d635b46f642682662004da">https://github.com/rear/rear/commit/5d86ec547e03fc8fa7d635b46f642682662004da</a><br />
and<br />
<a href="https://github.com/rear/rear/commit/87ff78560da4852eabffffa6c0d6be49e0de3e7f">https://github.com/rear/rear/commit/87ff78560da4852eabffffa6c0d6be49e0de3e7f</a><br />
the user may now get error messages like</p>
<pre><code>Could not find a filesystem in /proc/mounts for /var/tmp/rear.Bhlh9JjUxW91R0i/outputfs
ERROR: An ext2/3/4 or vfat filesystem must be mounted for the booting related files on /dev/sdb
</code></pre>
<p>or</p>
<pre><code>Only ext2/3/4 and vfat are supported for the booting related files on /dev/sdb
ERROR: Unsupported filesystem xfs is mounted at /var/tmp/rear.Bhlh9JjUxW91R0i/outputfs
</code></pre>
<p>Of course this is still not perfect<br />
but at least the user can now see that he should check<br />
/var/tmp/rear.Bhlh9JjUxW91R0i/outputfs and /dev/sdb<br />
so he may hopefully see what does not match in his case.</p>
<h4 id="jsmeix_commented_at_2023-12-13_1458"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1854074716">2023-12-13 14:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-13_1458" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
provided things are OK for you with my latest commits<br />
I would like to merge it tomorrow afternoon</p>
<h4 id="pcahyna_commented_at_2023-12-13_1553"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1854191792">2023-12-13 15:53</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-12-13_1553" title="Permanent link">&para;</a></h4>
<p>I am looking at the CI error with centos-stream-8-x86_64 . It is of
course not related to the change, but still is something that would be
good to debug. As console log in the Testing Farm infrastructure is now
enabled, we can look at the console output:
<a href="https://artifacts.dev.testing-farm.io/a24b1484-7fc1-4e2a-8077-e72f9eea6cca/work-backup-and-restorefmaugnmx/console-68975dbe-0cbe-49ae-aa05-47d8fec8b66f.log">https://artifacts.dev.testing-farm.io/a24b1484-7fc1-4e2a-8077-e72f9eea6cca/work-backup-and-restorefmaugnmx/console-68975dbe-0cbe-49ae-aa05-47d8fec8b66f.log</a>
. It show this error:</p>
<pre><code>Running workflow recover within the ReaR rescue/recovery system
Running PRE_RECOVERY_SCRIPT 'mkdir /tmp/mnt; mount /dev/nvme0n1p1 /tmp/mnt/; modprobe brd rd_nr=1 rd_size=2097152; dd if=/tmp/mnt//var/lib/rear/output/rear-ip-172-31-16-70.iso of=/dev/ram0; umount /tmp/mnt/;'
/etc/scripts/system-setup: line 255:   545 Killed                  rear $rear_options recover
'eval rear $rear_options recover' results exit code 137
'rear recover' failed with exit code 137
1) View Relax-and-Recover log file(s)
2) Login at the rescue system
</code></pre>
<p>It does not tell us what happened, but it at least shows where. I
suspect that the fact that we don't see what happened is due to the
kernel not printing its log messages, which is due to<br />
<a href="https://github.com/rear/rear/blob/b1e9f5e1cbc735ed90526ff7fa54b922fcfa60e7/usr/share/rear/skel/default/etc/scripts/boot#L4">https://github.com/rear/rear/blob/b1e9f5e1cbc735ed90526ff7fa54b922fcfa60e7/usr/share/rear/skel/default/etc/scripts/boot#L4</a><br />
that was added 92d3a15be54137ae0f00f550c5e9e58d68142617 with the commit
message <code>Added dmesg -n1 to rescue system</code> without explaining why.<br />
Having kernel log messages on the console would be helpful for debugging
filesystem-related errors like #2777 (see #3058 for explanation : when
mount fails, the mount commands display only the unhelpful message
<code>wrong fs type, bad option, bad superblock on ..., missing codepage or helper program, or other error</code>,
and the real cause of the error like
<code>XFS (...): logbuf size must be greater than or equal to log stripe size</code>
is printed by the kernel to the message log).</p>
<p>Anyway, since the error happens when loading the ISO into a ramdisk (the
whole ISO gets loaded into a ramdisk in this test procedure), I suspect
that we are out of memory at this point. The failed test shows</p>
<pre><code>Memory: 2052384K/3503836K available
</code></pre>
<p>and a successful test ( CentOS-Stream-9 ) shows</p>
<pre><code>Memory: 2931284K/3942236K available
</code></pre>
<p>so indeed, successful test seems to have run on a machine with more
memory than the failed test.</p>
<h4 id="jsmeix_commented_at_2023-12-14_0729"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1855309704">2023-12-14 07:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-14_0729" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your review!<br />
As always it notably improved things.</p>
<h4 id="jsmeix_commented_at_2023-12-14_0740"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3104#issuecomment-1855331385">2023-12-14 07:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-14_0740" title="Permanent link">&para;</a></h4>
<p>FYI:<br />
Intentionally I have '$BUILD_DIR/outputfs'<br />
last in those messages because that is a<br />
meaningless and longish technical term like<br />
'/var/tmp/rear.XXXXXXXXXXXXXXX/outputfs'<br />
so having such stuff at the end helps to make<br />
those messages easier to read and comprehend.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-12-11.3104.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
