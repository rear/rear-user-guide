<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2254 Issue closed: ReaR must work independent of kernel device names - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2254 Issue closed: ReaR must work independent of kernel device names";
        var mkdocs_page_input_path = "issues/2019-10-17.2254.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2254 Issue closed: ReaR must work independent of kernel device names</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2254_issue_closed_rear_must_work_independent_of_kernel_device_names"><a href="https://github.com/rear/rear/issues/2254">#2254 Issue</a> <code>closed</code>: ReaR must work independent of kernel device names<a class="headerlink" href="#2254_issue_closed_rear_must_work_independent_of_kernel_device_names" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>severe improvement</code></p>
<h4 id="jsmeix_opened_issue_at_2019-10-17_1234"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2254">2019-10-17 12:34</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2019-10-17_1234" title="Permanent link">&para;</a></h4>
<p>On an internal SUSE mailing list I learned about the following<br />
change in the kernel:</p>
<p><a href="https://marc.info/?l=linux-kernel&amp;m=157013477505405&amp;w=2">https://marc.info/?l=linux-kernel&amp;m=157013477505405&amp;w=2</a><br />
that reads (excerpts)</p>
<pre><code>Beginning with kernel 5.3 the order in which SCSI devices
are probed and named has become non-deterministic.
This is a result of a patch that was submitted to add
asynchronous device probing (specifically, commit
f049cf1a7b6737c75884247c3f6383ef104d255a).
Previously, devices would always be probed in the order
in which they exist on the bus, resulting in the first device
being named 'sda', the second device 'sdb', and so on.
</code></pre>
<p>An explanation what that is<br />
(except from an SUSE internal mail - a bit modified by me here):</p>
<pre><code>Controllers could be probed in parallel
but the devices would still appear in the same order
on a per-controller basis.
If there was only one controller, they'd be predictable
as long as new devices weren't added in the middle.

Now the probing happens asynchronously on a per-device basis,
so even devices on a single bus can appear in "random" order.

The only stable configuration now is one with a single disk.

That's a change in behavior that,
even though ... documented as unpredictable,
has been very much predictable for years.
</code></pre>
<p>This means when before <code>/dev/sda</code> and <code>/dev/sdb</code> were<br />
on the same controller (or bus) their naming was stable<br />
but beginning with kernel 5.3 their naming is random.</p>
<p>Because in general kenel device names are unstable<br />
since a long time, ReaR must get rid of using kenel device names<br />
in particular in disklayout.conf and use better methods instead.</p>
<h4 id="jsmeix_commented_at_2019-10-17_1240"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2254#issuecomment-543155593">2019-10-17 12:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-17_1240" title="Permanent link">&para;</a></h4>
<p>I think it becomes more and more a need<br />
to completely overhaul the whole disk layout recreation code<br />
to make it sufficiently up to date and ideally more future proof,<br />
cf.<br />
<a href="https://github.com/rear/rear/issues/1390">https://github.com/rear/rear/issues/1390</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/791#issuecomment-406513969">https://github.com/rear/rear/issues/791#issuecomment-406513969</a><br />
BUT<br />
<a href="https://github.com/rear/rear/issues/799#issuecomment-531247109">https://github.com/rear/rear/issues/799#issuecomment-531247109</a></p>
<h4 id="jsmeix_commented_at_2019-10-23_1541"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2254#issuecomment-545506104">2019-10-23 15:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-23_1541" title="Permanent link">&para;</a></h4>
<p>Something related:</p>
<p>It seems
<a href="https://github.com/rear/rear/issues/1958">https://github.com/rear/rear/issues/1958</a><br />
is at least somehow related because in general<br />
it should not matter which of the possible names<br />
for one same block device is used.</p>
<p>E.g. on my workstation I have 9 additional (alias/link) names<br />
for my root partition <code>/dev/sda2</code></p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sda
NAME        KNAME     PKNAME   TRAN   TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           sata   disk        931.5G 
|-/dev/sda1 /dev/sda1 /dev/sda        part vfat     500M /boot/efi
|-/dev/sda2 /dev/sda2 /dev/sda        part ext4   915.5G /
`-/dev/sda3 /dev/sda3 /dev/sda        part swap    15.6G [SWAP]

# find /dev/disk/by-* -ls | grep -o '/dev/disk/by-.*/sda2'
/dev/disk/by-id/wwn-0x50014ee2b71cd724-part2 -&gt; ../../sda2
/dev/disk/by-id/scsi-SATA_WDC_WD10EZEX-75M_WD-WCC3F1AEYTNS-part2 -&gt; ../../sda2
/dev/disk/by-id/scsi-350014ee2b71cd724-part2 -&gt; ../../sda2
/dev/disk/by-id/scsi-1ATA_WDC_WD10EZEX-75M2NA0_WD-WCC3F1AEYTNS-part2 -&gt; ../../sda2
/dev/disk/by-id/scsi-0ATA_WDC_WD10EZEX-75M_WD-WCC3F1AEYTNS-part2 -&gt; ../../sda2
/dev/disk/by-id/ata-WDC_WD10EZEX-75M2NA0_WD-WCC3F1AEYTNS-part2 -&gt; ../../sda2
/dev/disk/by-partuuid/a55fd91f-6714-47a4-983a-e7b6f50fb9aa -&gt; ../../sda2
/dev/disk/by-path/pci-0000:00:1f.2-ata-1-part2 -&gt; ../../sda2
/dev/disk/by-uuid/aed8d81b-29bf-405e-9049-29a6c0e702d3 -&gt; ../../sda2
</code></pre>
<p>Ideally it should be possible to use anywhere any of the names</p>
<pre><code>/dev/sda2
/dev/disk/by-id/wwn-0x50014ee2b71cd724-part2
/dev/disk/by-id/scsi-SATA_WDC_WD10EZEX-75M_WD-WCC3F1AEYTNS-part2
/dev/disk/by-id/scsi-350014ee2b71cd724-part2
/dev/disk/by-id/scsi-1ATA_WDC_WD10EZEX-75M2NA0_WD-WCC3F1AEYTNS-part2
/dev/disk/by-id/scsi-0ATA_WDC_WD10EZEX-75M_WD-WCC3F1AEYTNS-part2
/dev/disk/by-id/ata-WDC_WD10EZEX-75M2NA0_WD-WCC3F1AEYTNS-part2
/dev/disk/by-partuuid/a55fd91f-6714-47a4-983a-e7b6f50fb9aa
/dev/disk/by-path/pci-0000:00:1f.2-ata-1-part2
/dev/disk/by-uuid/aed8d81b-29bf-405e-9049-29a6c0e702d3
</code></pre>
<p>and things should "just work".</p>
<p>So an immediate offhanded (and totally untested) idea is<br />
to implement a generic function named something like</p>
<pre><code>get_kernel_block_device_name()
</code></pre>
<p>that outputs the kernel block device name (<code>/dev/sda2</code> in the above
example)<br />
for any of its existing names, e.g.</p>
<pre><code>get_kernel_block_device_name /dev/disk/by-path/pci-0000:00:1f.2-ata-1-part2
</code></pre>
<p>would output <code>/dev/sda2</code> and in particular</p>
<pre><code>get_kernel_block_device_name /dev/sda2
</code></pre>
<p>would also output <code>/dev/sda2</code>.</p>
<p>So the idea behind is to still use the kernel block device name<br />
as the ultimate value that is finally used when calling commands<br />
because the kernel block device name is the only one that must exist<br />
but it should not matter when another compatible name for that thingy<br />
is used elsewhere for example in config files.</p>
<h4 id="jsmeix_commented_at_2020-02-10_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2254#issuecomment-584127125">2020-02-10 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-10_1340" title="Permanent link">&para;</a></h4>
<p>My SUSE Hack Week 19 project is<br />
<a href="https://hackweek.suse.com/19/projects/relax-and-recover-rear-proof-of-concept-implementation-of-new-storage-code">https://hackweek.suse.com/19/projects/relax-and-recover-rear-proof-of-concept-implementation-of-new-storage-code</a></p>
<h4 id="jsmeix_commented_at_2020-03-06_0922"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2254#issuecomment-595678350">2020-03-06 09:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-06_0922" title="Permanent link">&para;</a></h4>
<p>FYI:<br />
Since SUSE Hack Week 19 I am experimenting with that things in<br />
<a href="https://github.com/jsmeix/rear/tree/new_storare_initial_experimental_playground_issue2254">https://github.com/jsmeix/rear/tree/new_storare_initial_experimental_playground_issue2254</a></p>
<h4 id="github-actions_commented_at_2020-06-26_0139"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2254#issuecomment-649900639">2020-06-26 01:39</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-26_0139" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-10-17.2254.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
