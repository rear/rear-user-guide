<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#160 Issue closed: vol_id doesn't exist on ubuntu anymore - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#160 Issue closed: vol_id doesn\u0027t exist on ubuntu anymore";
        var mkdocs_page_input_path = "issues/2012-09-19.160.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#160 Issue closed: vol_id doesn't exist on ubuntu anymore</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="160_issue_closed_vol_id_doesnt_exist_on_ubuntu_anymore"><a href="https://github.com/rear/rear/issues/160">#160 Issue</a> <code>closed</code>: vol_id doesn't exist on ubuntu anymore<a class="headerlink" href="#160_issue_closed_vol_id_doesnt_exist_on_ubuntu_anymore" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>cleanup</code></p>
<h4 id="kkaiser_opened_issue_at_2012-09-19_1008"><img src="https://avatars.githubusercontent.com/u/1774205?u=6d26bd67a7ba64fb7bae93bbfe2151aaade0bdd2&v=4" width="50"><a href="https://github.com/kkaiser">kkaiser</a> opened issue at <a href="https://github.com/rear/rear/issues/160">2012-09-19 10:08</a>:<a class="headerlink" href="#kkaiser_opened_issue_at_2012-09-19_1008" title="Permanent link">&para;</a></h4>
<p>When trying to create a USB-Stick it fails because of the command
vol_id in:</p>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/format/USB/default/20_check_usb_layout.sh">https://github.com/rear/rear/blob/master/usr/share/rear/format/USB/default/20_check_usb_layout.sh</a><br />
(line 39)</p>
<p>blkid -o udev should work. Here is my /etc/rear/local.conf config:</p>
<pre><code># sample local configuration

### write the rescue initramfs to USB and update the USB bootloader
OUTPUT=USB

### create a backup using the internal NETFS method, using 'tar'
BACKUP=NETFS

### write both rescue image and backup to the device labeled REAR-000
BACKUP_URL=usb:///dev/sdb1/REAR-000
</code></pre>
<h4 id="dagwieers_commented_at_2012-09-19_2014"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8704936">2012-09-19 20:14</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-19_2014" title="Permanent link">&para;</a></h4>
<p>As usual with bug-reports, we expect an exact version of Ubuntu and
Relax-and-Recover together with all possible relevant information.</p>
<h4 id="kkaiser_commented_at_2012-09-20_0629"><img src="https://avatars.githubusercontent.com/u/1774205?u=6d26bd67a7ba64fb7bae93bbfe2151aaade0bdd2&v=4" width="50"><a href="https://github.com/kkaiser">kkaiser</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8717917">2012-09-20 06:29</a>:<a class="headerlink" href="#kkaiser_commented_at_2012-09-20_0629" title="Permanent link">&para;</a></h4>
<pre><code>Relax-and-Recover 1.13.0-git201209071215 / 2012-09-07
Using log file: /var/log/rear/rear-beryllium.log.lockless
Dumping out configuration and system information
This is a 'Linux-x86_64' system, compatible with 'Linux-i386'.
System definition:
                                    ARCH = Linux-i386
                                      OS = GNU/Linux
                        OS_MASTER_VENDOR = Debian
                       OS_MASTER_VERSION = 11.04
                   OS_MASTER_VENDOR_ARCH = Debian/i386
                OS_MASTER_VENDOR_VERSION = Debian/11.04
           OS_MASTER_VENDOR_VERSION_ARCH = Debian/11.04/i386
                               OS_VENDOR = Ubuntu
                              OS_VERSION = 11.04
                          OS_VENDOR_ARCH = Ubuntu/i386
                       OS_VENDOR_VERSION = Ubuntu/11.04
                  OS_VENDOR_VERSION_ARCH = Ubuntu/11.04/i386
Configuration tree:
                         Linux-i386.conf : OK
                          GNU/Linux.conf : OK
                             Debian.conf : missing/empty
                        Debian/i386.conf : missing/empty
                       Debian/11.04.conf : missing/empty
                  Debian/11.04/i386.conf : missing/empty
                             Ubuntu.conf : missing/empty
                        Ubuntu/i386.conf : missing/empty
                       Ubuntu/11.04.conf : missing/empty
                  Ubuntu/11.04/i386.conf : missing/empty
                               site.conf : missing/empty
                              local.conf : OK
Backup with NETFS
              NETFS_KEEP_OLD_BACKUP_COPY = 
                            NETFS_PREFIX = beryllium
                         BACKUP_MOUNTCMD = 
                          BACKUP_OPTIONS = 
                    BACKUP_RSYNC_OPTIONS = --sparse --archive --hard-links --verbose --numeric-ids --stats
                  BACKUP_SELINUX_DISABLE = 1
                        BACKUP_UMOUNTCMD = 
                              BACKUP_URL = usb:///dev/sdb1/REAR-000
Backup program is 'tar':
                             BACKUP_PROG = tar
                     BACKUP_PROG_ARCHIVE = backup
            BACKUP_PROG_COMPRESS_OPTIONS = --gzip
             BACKUP_PROG_COMPRESS_SUFFIX = .gz
                     BACKUP_PROG_EXCLUDE = /tmp/* /dev/shm/* /a/* /afs/* /SCR /scr
                     BACKUP_PROG_INCLUDE = 
                     BACKUP_PROG_OPTIONS = 
      BACKUP_PROG_OPTIONS_CREATE_ARCHIVE = 
     BACKUP_PROG_OPTIONS_RESTORE_ARCHIVE = 
                      BACKUP_PROG_SUFFIX = .tar
       BACKUP_PROG_WARN_PARTIAL_TRANSFER = 1
Output to USB
                              USB_DEVICE = 
                               USB_FILES = 
                    USB_RETAIN_BACKUP_NR = 2
                           RESULT_MAILTO =

/usr/share/rear/lib/validated/Ubuntu/11.04/i386.txt
Your system is not yet validated. Please carefully check all functions
and create a validation record with 'rear validate'. This will help others
to know about the validation status of Relax-and-Recover on this system.


lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 11.04
Release:    11.04
Codename:   natty

Relax-and-Recover 1.13.0-git201209071215 / 2012-09-07
</code></pre>
<h4 id="kkaiser_commented_at_2012-09-20_0653"><img src="https://avatars.githubusercontent.com/u/1774205?u=6d26bd67a7ba64fb7bae93bbfe2151aaade0bdd2&v=4" width="50"><a href="https://github.com/kkaiser">kkaiser</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8718274">2012-09-20 06:53</a>:<a class="headerlink" href="#kkaiser_commented_at_2012-09-20_0653" title="Permanent link">&para;</a></h4>
<pre><code>$ rear format /dev/sdb
USB device /dev/sdb must be formatted with ext2/3/4 or btrfs file system
Please type Yes to format /dev/sdb in ext3 format:
yes
ERROR: Abort USB format process by user
Aborting due to an error, check /var/log/rear/rear-beryllium.log for details
Terminated
root@beryllium:~ &gt; cat /var/log/rear/rear-beryllium.log
2012-09-20 08:52:36 Relax-and-Recover 1.13.0-git201209071215 / 2012-09-07
2012-09-20 08:52:36 Command line options: /usr/sbin/rear format /dev/sdb
2012-09-20 08:52:36 Including conf/Linux-i386.conf
2012-09-20 08:52:36 Including conf/GNU/Linux.conf
2012-09-20 08:52:36 Including /etc/rear/local.conf
2012-09-20 08:52:36 Using build area '/tmp/rear.bAtr9iIaOgD380r'
2012-09-20 08:52:36 Running format workflow
2012-09-20 08:52:36 Running 'format' stage
2012-09-20 08:52:36 Including format/USB/default/20_check_usb_layout.sh
/usr/share/rear/format/USB/default/20_check_usb_layout.sh: line 39: vol_id: command not found
2012-09-20 08:52:45 ERROR: Abort USB format process by user
=== Stack trace ===
Trace 0: /usr/sbin/rear:245 main
Trace 1: /usr/share/rear/lib/format-workflow.sh:46 WORKFLOW_format
Trace 2: /usr/share/rear/lib/framework-functions.sh:79 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:40 Source
Trace 4: /usr/share/rear/format/USB/default/20_check_usb_layout.sh:48 source
Trace 5: /usr/share/rear/lib/_input-output-functions.sh:131 StopIfError
Message: Abort USB format process by user
===================
2012-09-20 08:52:45 Running exit tasks.
2012-09-20 08:52:45 Finished in 9 seconds
2012-09-20 08:52:45 Removing build area /tmp/rear.bAtr9iIaOgD380r
2012-09-20 08:52:45 End of program reached
</code></pre>
<h4 id="kkaiser_commented_at_2012-09-20_0709"><img src="https://avatars.githubusercontent.com/u/1774205?u=6d26bd67a7ba64fb7bae93bbfe2151aaade0bdd2&v=4" width="50"><a href="https://github.com/kkaiser">kkaiser</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8718529">2012-09-20 07:09</a>:<a class="headerlink" href="#kkaiser_commented_at_2012-09-20_0709" title="Permanent link">&para;</a></h4>
<p>I tested "blkid -o udev" but doesn't work either. I also tried version:
Relax-and-Recover 1.14-git201209200242 / 2012-09-20</p>
<p>heres the log with blkid when running rear format /dev/sdb</p>
<pre><code>2012-09-20 09:06:02 Relax-and-Recover 1.14-git201209200242 / 2012-09-20
2012-09-20 09:06:02 Command line options: /usr/sbin/rear format /dev/sdb
2012-09-20 09:06:02 Including conf/Linux-i386.conf
2012-09-20 09:06:02 Including conf/GNU/Linux.conf
2012-09-20 09:06:02 Including /etc/rear/local.conf
2012-09-20 09:06:02 Using build area '/tmp/rear.x3kWlwW0uKt7ztJ'
2012-09-20 09:06:02 Running format workflow
2012-09-20 09:06:02 Running 'format' stage
2012-09-20 09:06:02 Including format/USB/default/20_check_usb_layout.sh
2012-09-20 09:06:08 ERROR: Abort USB format process by user
=== Stack trace ===
Trace 0: /usr/sbin/rear:245 main
Trace 1: /usr/share/rear/lib/format-workflow.sh:46 WORKFLOW_format
Trace 2: /usr/share/rear/lib/framework-functions.sh:79 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:40 Source
Trace 4: /usr/share/rear/format/USB/default/20_check_usb_layout.sh:48 source
Trace 5: /usr/share/rear/lib/_input-output-functions.sh:131 StopIfError
Message: Abort USB format process by user
===================
2012-09-20 09:06:08 Running exit tasks.
2012-09-20 09:06:08 Finished in 6 seconds
2012-09-20 09:06:08 Removing build area /tmp/rear.x3kWlwW0uKt7ztJ
2012-09-20 09:06:08 End of program reached
</code></pre>
<h4 id="thumm_commented_at_2012-09-20_0752"><img src="https://avatars.githubusercontent.com/u/2016802?v=4" width="50"><a href="https://github.com/thumm">thumm</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8719269">2012-09-20 07:52</a>:<a class="headerlink" href="#thumm_commented_at_2012-09-20_0752" title="Permanent link">&para;</a></h4>
<p>vol_id has been removed from udev (see &lt;a
href=<a href="http://git.kernel.org/?p=linux/hotplug/udev.git;a=commit;h=f07996885dab45102492d7f16e7e2997e264c725&gt;here">http://git.kernel.org/?p=linux/hotplug/udev.git;a=commit;h=f07996885dab45102492d7f16e7e2997e264c725&gt;here</a></a>)</p>
<p>Could you check it after applying the following patch (which I already
tested on Ubuntu 12.04 precise)</p>
<pre><code>diff --git a/usr/share/rear/format/USB/default/20_check_usb_layout.sh b/usr/share/rear/format/USB/default/20_check_usb_layout.sh
index b76eb2b..533a66d 100644
--- a/usr/share/rear/format/USB/default/20_check_usb_layout.sh
+++ b/usr/share/rear/format/USB/default/20_check_usb_layout.sh
@@ -36,7 +36,12 @@ StopIfError "Unable to determine raw USB device for $REAL_USB_DEVICE"
 answer=""

 ID_FS_TYPE=
-eval $(vol_id "$REAL_USB_DEVICE")
+which vol_id &gt; /dev/null 2&gt;&amp;1
+if [[ $? != 0 ]]; then
+  eval $(blkid -o udev "$REAL_USB_DEVICE")
+else
+  eval $(vol_id "$REAL_USB_DEVICE")
+fi
 StopIfError "Could not determine filesystem info for '$REAL_USB_DEVICE'"

 [[ "$ID_FS_TYPE" == @(btr*|ext*) ]]
</code></pre>
<h4 id="kkaiser_commented_at_2012-09-20_0834"><img src="https://avatars.githubusercontent.com/u/1774205?u=6d26bd67a7ba64fb7bae93bbfe2151aaade0bdd2&v=4" width="50"><a href="https://github.com/kkaiser">kkaiser</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8720181">2012-09-20 08:34</a>:<a class="headerlink" href="#kkaiser_commented_at_2012-09-20_0834" title="Permanent link">&para;</a></h4>
<p>yep I can confirm that the patch works. The mistake I made when trying
blkid was typing "yes" instead of "Yes". That is why "Abort USB format
process by user" was displayed.</p>
<p>thank you</p>
<h4 id="dagwieers_commented_at_2012-09-20_0950"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8721964">2012-09-20 09:50</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-20_0950" title="Permanent link">&para;</a></h4>
<p>@thumm Thanks for looking into this. However what we probably need to do
is ressurect <code>rear_vol_id</code> from the grave. We put it to rest back when
there was no longer a need to use <code>vol_id</code> (thanks to the new layout
code). So I was a bit surprised that there was still a need for <code>vol_id</code>
(and the related kludges it brings in).</p>
<p>You can find the removal of <code>rear_vol_id</code> here:
<a href="https://github.com/rear/rear/commit/8bcb4ba05d0efd04c947a0dc193f2ef77f74b171">https://github.com/rear/rear/commit/8bcb4ba05d0efd04c947a0dc193f2ef77f74b171</a></p>
<p>If you search the issues/commits for <code>vol_id</code> and <code>rear_vol_id</code>, you can
get a feeling of what the context of these changes was. If there is a
way to get rid of <code>vol_id</code> altogether (maybe using the layout-code) that
would be even better...</p>
<h4 id="thumm_commented_at_2012-09-25_1456"><img src="https://avatars.githubusercontent.com/u/2016802?v=4" width="50"><a href="https://github.com/thumm">thumm</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8857183">2012-09-25 14:56</a>:<a class="headerlink" href="#thumm_commented_at_2012-09-25_1456" title="Permanent link">&para;</a></h4>
<p>@dagwieers Do you really want to (re-) use <code>rear_vol_id</code>?
The format-workflow is the last one using vol_id (that's what
<code>grep -nri "vol_id" .</code> says) and would only need a very
small part of <code>rear_vol_id</code>: given a device -&gt; does this
device already has a ext* or btr filesystem.</p>
<p>In the layout functions <code>mount</code> is used to determine the
filesystem of a device. I would prefer a solution which uses the same
approach, e. g. something like this</p>
<pre><code>diff --git a/usr/share/rear/format/USB/default/20_check_usb_layout.sh b/usr/share/rear/format/USB/default/20_check_usb_layout
index b76eb2b..50263a0 100644
--- a/usr/share/rear/format/USB/default/20_check_usb_layout.sh
+++ b/usr/share/rear/format/USB/default/20_check_usb_layout.sh
@@ -36,7 +36,7 @@ StopIfError "Unable to determine raw USB device for $REAL_USB_DEVICE"
 answer=""

 ID_FS_TYPE=
-eval $(vol_id "$REAL_USB_DEVICE")
+ID_FS_TYPE=$(get_filesystem $REAL_USB_DEVICE)
 StopIfError "Could not determine filesystem info for '$REAL_USB_DEVICE'"

 [[ "$ID_FS_TYPE" == @(btr*|ext*) ]]
diff --git a/usr/share/rear/lib/layout-functions.sh b/usr/share/rear/lib/layout-functions.sh
index 8cfc865..60ba08c 100644
--- a/usr/share/rear/lib/layout-functions.sh
+++ b/usr/share/rear/lib/layout-functions.sh
@@ -447,3 +447,26 @@ get_block_size() {
     fi
 }

+# Get the filesystem of a partition
+get_filesystem () {
+    local name=$1
+    local tmp_mount_dir=$(mktemp -d $TMP_DIR/rear.formatXXX)
+
+    mkdir -p $tmp_mount_dir
+
+    [[ -d $tmp_mount_dir ]]
+    BugIfError "Unable to create dir $tmp_mount_dir"
+
+    mount $1 $tmp_mount_dir 2&gt; /dev/null
+    if (( $? == 0 )); then
+        echo $(mount | grep $name | cut -d" " -f5)
+        umount $tmp_mount_dir
+    else
+        echo "unknown"
+    fi
+
+    rmdir $tmp_mount_dir
+
+    return 0
+}
+
</code></pre>
<h4 id="dagwieers_commented_at_2012-09-25_2216"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8872339">2012-09-25 22:16</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-25_2216" title="Permanent link">&para;</a></h4>
<p>I wouldn't just mount, because that changes the filesystem, rather use
readonly-mounting is better.</p>
<p>That said, I am not convinced. It seems quite costly to do this, and
there is a risk that a mount (attempt) gives problems we would otherwise
not see. I wonder how exactly udev/vol_id do this. I expect they scan
the filesystem header, rather than mounting. That's why I prefer that
approach. The only reason why <code>rear_vol_id</code> is such a kludge is because
it has a lot of backward compatibility built in.</p>
<p>I love to hear what others think.</p>
<h4 id="dagwieers_commented_at_2012-09-26_1100"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8886161">2012-09-26 11:00</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-26_1100" title="Permanent link">&para;</a></h4>
<p>Ok, the preferred solution is to use <code>file</code> on, the block device. This
is lightweight. So something like this should do:</p>
<pre><code>file_output=$(file -sbL "$device")
case "$file_output" in
    (*ext2 filesystem*)
        filesystem=ext2
        ;;
    (*ext3 filesystem*)
        filesystem=ext3
        ;;
    (*ext4 filesystem*)
        filesystem=ext4
        ;;
    ### FIXME: Also test for btrfs
    (*)
        Error "Unsupported filesystem found on device $device ($file_output)"
        ;;
</code></pre>
<p>Is this acceptable ? Can you modify the patch in this way ?</p>
<h4 id="thumm_commented_at_2012-09-26_1604"><img src="https://avatars.githubusercontent.com/u/2016802?v=4" width="50"><a href="https://github.com/thumm">thumm</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8895207">2012-09-26 16:04</a>:<a class="headerlink" href="#thumm_commented_at_2012-09-26_1604" title="Permanent link">&para;</a></h4>
<p>Hm, a miracle has happened between <code>mount</code> and
<code>file</code> :-)</p>
<p>Yes, I can modify the patch, but I would like to unterstand the
difference between using <code>file</code> and <code>mount</code>. Why
is <code>file</code> more lightweight?</p>
<h4 id="dagwieers_commented_at_2012-09-26_1740"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8898372">2012-09-26 17:40</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-26_1740" title="Permanent link">&para;</a></h4>
<p>With <code>file</code> you simply read a few blocks (in my tests it is the first
262k) of the disk, with <code>mount</code> you do much more:</p>
<ul>
<li>register the mount to the kernel</li>
<li>verify filesystem metadata</li>
<li>open the filesystem</li>
<li>update filesystem metadata</li>
</ul>
<p>and you require to <code>umount</code> it, which undoes the above again. Besides
<code>mount</code> and <code>umount</code> can fail in considerably more ways than <code>file</code> can,
although it probably knows more about filesystems itself. One advantage
for file is that you don't need the kernel modules in order to make it
work. One disadvantage may be that the magic files may not support new
or experimental filesystems. But that's maybe a good thing.</p>
<h4 id="thumm_commented_at_2012-09-27_1241"><img src="https://avatars.githubusercontent.com/u/2016802?v=4" width="50"><a href="https://github.com/thumm">thumm</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8934727">2012-09-27 12:41</a>:<a class="headerlink" href="#thumm_commented_at_2012-09-27_1241" title="Permanent link">&para;</a></h4>
<p>Ok, that's clear now. Thank you very much. I'll send a pull request.</p>
<h4 id="dagwieers_commented_at_2012-09-28_0625"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/160#issuecomment-8965760">2012-09-28 06:25</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-28_0625" title="Permanent link">&para;</a></h4>
<p>This fixes #160.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2012-09-19.160.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
