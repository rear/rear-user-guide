<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2402 PR merged: Updated generated locale filename from "rear.UTF-8" to "en_US.UTF-8" (BACKUP=BORG) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2402 PR merged: Updated generated locale filename from \"rear.UTF-8\" to \"en_US.UTF-8\" (BACKUP=BORG)";
        var mkdocs_page_input_path = "issues/2020-05-21.2402.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2402 PR merged: Updated generated locale filename from "rear.UTF-8" to "en_US.UTF-8" (BACKUP=BORG)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2402_pr_merged_updated_generated_locale_filename_from_rearutf-8_to_en_usutf-8_backupborg"><a href="https://github.com/rear/rear/pull/2402">#2402 PR</a> <code>merged</code>: Updated generated locale filename from "rear.UTF-8" to "en_US.UTF-8" (BACKUP=BORG)<a class="headerlink" href="#2402_pr_merged_updated_generated_locale_filename_from_rearutf-8_to_en_usutf-8_backupborg" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>cleanup</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="gozora_opened_issue_at_2020-05-21_1057"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> opened issue at <a href="https://github.com/rear/rear/pull/2402">2020-05-21 10:57</a>:<a class="headerlink" href="#gozora_opened_issue_at_2020-05-21_1057" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL): <strong>N/A</strong></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Full backup/restore</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    During restore with <code>BACKUP=BORG</code> messages as follow could be
    observed:</p>
</li>
</ul>
<!-- -->

<pre><code>=== Borg archives list ===
Location:   backup
Repository: /mnt/rear/borg/node1

[1] HAEnode1_1  Thu, 2020-05-21 10:40:15

[2] Exit

Choose archive to recover from
(timeout 300 seconds)
1
Recovering from backup archive /mnt/rear/borg/node1::HAEnode1_1 on backup
Remote: bash: warning: setlocale: LC_ALL: cannot change locale (rear.UTF-8)
...
</code></pre>
<p><code>Remote: bash: warning: setlocale: LC_ALL: cannot change locale (rear.UTF-8)</code>
message is shown when server site does not have <code>rear.UTF-8</code>
available.<br />
Changing locale name to standard <code>en_US.UTF-8</code> will fix this problem.</p>
<p>One can workaround this message by generating <code>rear.UTF-8</code> locales on
destination host running Borg.</p>
<pre><code># localedef -f UTF-8 -i en_US "/usr/lib/locale/rear.UTF-8"
</code></pre>
<h4 id="flyinggreenfrog_commented_at_2020-05-25_0451"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633374821">2020-05-25 04:51</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-25_0451" title="Permanent link">&para;</a></h4>
<p>I could reproduce that issue. Fix in this PR looks good to me, and
should be merged/accepted imho.</p>
<p>One other workaround would be to disable the forwarding of the <code>LC_ALL</code>
variable in <code>/etc/ssh/ssh_config</code>:</p>
<pre><code># This enables sending locale enviroment variables LC_* LANG, see ssh_config(5).
    SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
    SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
    SendEnv LC_IDENTIFICATION LC_ALL
</code></pre>
<p>e.g. change last line to <code>SendEnv LC_IDENTIFICATION</code>, that is remove
<code>LC_ALL</code>.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-25_0559"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633392290">2020-05-25 05:59</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-25_0559" title="Permanent link">&para;</a></h4>
<p>Just finished a recover test with that commit, works as expected for me.
No
<code>Remote: bash: warning: setlocale: LC_ALL: cannot change locale (rear.UTF-8)</code>
warning appeared.</p>
<h4 id="gozora_commented_at_2020-05-25_0628"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633401559">2020-05-25 06:28</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-25_0628" title="Permanent link">&para;</a></h4>
<p>@flyinggreenfrog thaks for you review!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-25_0639"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633405630">2020-05-25 06:39</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-25_0639" title="Permanent link">&para;</a></h4>
<blockquote>
<p>One other workaround would be to disable the forwarding of the LC_ALL
variable in /etc/ssh/ssh_config:</p>
</blockquote>
<p>@flyinggreenfrog did you actually try this?</p>
<p>V.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-25_0647"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633408196">2020-05-25 06:47</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-25_0647" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<p>One other workaround would be to disable the forwarding of the
LC_ALL variable in /etc/ssh/ssh_config:</p>
</blockquote>
<p>@flyinggreenfrog did you actually try this?</p>
</blockquote>
<p>Yes, I tried it and it worked too.</p>
<p>Editing <code>/etc/ssh/ssh_config</code> in the rescue system with removing
<code>LC_ALL</code> worked.</p>
<p>And also editing <code>/etc/ssh/ssh_config</code> in the original system, then
running rear mkbackup (with the result <code>LC_ALL</code> removed also in the
rescue system), worked then of course too.</p>
<h4 id="jsmeix_commented_at_2020-05-25_0755"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633434871">2020-05-25 07:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-25_0755" title="Permanent link">&para;</a></h4>
<p>I have a general question about Borg out of curiosity:</p>
<p>I am not a Borg user so I don't know how Borg actually works.</p>
<p>I wonder why it seems the Borg behaviour depends on the locale.</p>
<p>I would understand that only a backup program user interface<br />
depends on the locale of the user who runs the program<br />
(e.g. different language for user dialog messages).</p>
<p>I would expect that things work when a backup program is called<br />
to make a backup under a different locale than the locale that<br />
another user uses when calling the program to restore the backup.</p>
<p>I.e. I would expect that Borg can be called under a UTF8 locale<br />
to make a backup and later Borg can be called under POSIX locale<br />
to restore that backup.</p>
<p>But it seems the locale when Borg is called to restore must match<br />
the locale that was used when Borg was called to make a backup.<br />
If yes, this looks like a plain wrong behaviour of Borg to me.</p>
<p>The borg_extract function contains a comment<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/borg-functions.sh#L142">https://github.com/rear/rear/blob/master/usr/share/rear/lib/borg-functions.sh#L142</a></p>
<pre><code># Scope of LC_ALL is only within run of `borg extract'.
# This avoids Borg problems with restoring UTF-8 encoded files names in archive
# and should not interfere with remaining stages of rear recover.
</code></pre>
<p>which looks scaring and plain wrong inside Borg because<br />
file names must be in any case restored byte-by-byte<br />
exactly same as they have been on the original system<br />
(same as any file content that must be restored byte-by-byte<br />
exactly same as it was on the original system).</p>
<p>How file names (and file contents) are restored must never ever<br />
depend on the locale that is used while the restore program runs,<br />
cf. the section "Non-ASCII characters in file names"<br />
in<br />
<a href="https://en.opensuse.org/SDB:Plain_Text_versus_Locale">https://en.opensuse.org/SDB:Plain_Text_versus_Locale</a><br />
that contains</p>
<pre><code>For the operating system a filename
is a plain sequence of bytes
without any additional information what
characters are meant by this sequence of bytes
</code></pre>
<p>So any backup program must store file names as a plain sequence of
bytes<br />
and restore the files with the exact same sequence of bytes as their
name.<br />
A reason behind is that e.g. different users can use different locales<br />
and have their own file names in their own different localizations.<br />
After a backup restore operation all file names must appear<br />
exactly same for all the users as they have been before.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-25_0807"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633440091">2020-05-25 08:07</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-25_0807" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I have a general question about Borg out of curiosity:</p>
<p>I am not a Borg user so I don't know how Borg actually works.</p>
<p>I wonder why it seems the Borg behaviour depends on the locale.</p>
</blockquote>
<p>Was that not already discussed/explained in
<a href="https://github.com/borgbackup/borg/issues/1702#issuecomment-253190651">https://github.com/borgbackup/borg/issues/1702#issuecomment-253190651</a>?</p>
<h4 id="jsmeix_commented_at_2020-05-25_1040"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633507877">2020-05-25 10:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-25_1040" title="Permanent link">&para;</a></h4>
<p>I know about<br />
<a href="https://github.com/borgbackup/borg/issues/1702#issuecomment-253190651">https://github.com/borgbackup/borg/issues/1702#issuecomment-253190651</a><br />
but this did not explain anything to me.<br />
It even confirms from my point of view that Borg seems<br />
to mess around with things (user's sacrosanct content)<br />
that it should not at all touch.</p>
<h4 id="jsmeix_commented_at_2020-05-25_1042"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633508778">2020-05-25 10:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-25_1042" title="Permanent link">&para;</a></h4>
<p>I cannot review Borg related things in ReaR when the reasoning behind<br />
is some Borg specific exceptional stuff that I do not understand.</p>
<h4 id="jsmeix_commented_at_2020-05-25_1045"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633509780">2020-05-25 10:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-25_1045" title="Permanent link">&para;</a></h4>
<p>If Borg needs dirty hacks in ReaR to make Borg work in ReaR<br />
it is perfectly fine and much appreciated to have such dirty hacks,<br />
cf. "Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="gozora_commented_at_2020-05-25_1311"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2402#issuecomment-633565371">2020-05-25 13:11</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-25_1311" title="Permanent link">&para;</a></h4>
<p>@jsmeix I'm afraid that in terms of Borg I'm just a simple user, without
any deeper background on how and why things work in certain way in Borg.
Same as with majority of Linux programs I use, I just want blindly trust
that authors knows what they are doing, because getting details on every
(or even some) application I'm working with is simply surpasses my
available brain and time capacity ;-) ...</p>
<p>V.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-21.2402.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
