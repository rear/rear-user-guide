<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2779 Issue closed: DISA STIG secured Red Hat system: libraries failing to copy during mkrescue ('fapolicyd' hinders it) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2779 Issue closed: DISA STIG secured Red Hat system: libraries failing to copy during mkrescue (\u0027fapolicyd\u0027 hinders it)";
        var mkdocs_page_input_path = "issues/2022-03-25.2779.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2779 Issue closed: DISA STIG secured Red Hat system: libraries failing to copy during mkrescue ('fapolicyd' hinders it)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2779_issue_closed_disa_stig_secured_red_hat_system_libraries_failing_to_copy_during_mkrescue_fapolicyd_hinders_it"><a href="https://github.com/rear/rear/issues/2779">#2779 Issue</a> <code>closed</code>: DISA STIG secured Red Hat system: libraries failing to copy during mkrescue ('fapolicyd' hinders it)<a class="headerlink" href="#2779_issue_closed_disa_stig_secured_red_hat_system_libraries_failing_to_copy_during_mkrescue_fapolicyd_hinders_it" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>external tool</code>, <code>not ReaR / invalid</code></p>
<h4 id="rtinsley87_opened_issue_at_2022-03-25_1918"><img src="https://avatars.githubusercontent.com/u/102384782?u=fcbf3eed1b9aa76346fdfa1fddfc03bd42430dac&v=4" width="50"><a href="https://github.com/rtinsley87">rtinsley87</a> opened issue at <a href="https://github.com/rear/rear/issues/2779">2022-03-25 19:18</a>:<a class="headerlink" href="#rtinsley87_opened_issue_at_2022-03-25_1918" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.6</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    Red Hat 8.5</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>export TMPDIR=/mnt/backup/Admin/tmp
OUTPUT=ISO
OUT_URL=file:///mnt/backup
COPY_AS_IS+=(/usr/lib*)
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    PC</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86 compatible</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI &amp; GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local SSD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>This system is being setup for secure use so it was imaged<br />
configured with the DISA stig for Red hat 8.5 with GUI.<br />
When I run a the command "sudo rear -v mkrescue" it fails with a error
warning</p>
<pre><code>BUG in /usr/share/rear/build/default/990_verify_rootfs.sh line 48:
'\''ReaR recovery system in '\''/mnt/backup/Admin/tmp/rear.ssBwqpOHnTJkjO0/rootfs'\'' is broken: '\''bash -c true'\'' failed'\''
</code></pre>
<p>and it also shows this during recovery system test</p>
<pre><code>/bin/bash: error while loading shared libraries: libtinfo.so.6: cannot open shared object file: Operation not permitted
</code></pre>
<p>When I checked the rootfs folder under usr/lib libtinfo.so.6 is missing
from the folder.<br />
I tried including the configuration line LIBS=(libtinfo.so.6) and it
will give a line<br />
during the verbose run that says libtinfo.so.6 failed to copy.</p>
<ul>
<li>
<p>Workaround, if any:<br />
    tested on VM without controls implemented during imaging<br />
    and just required grub2 modules to be installed</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):
    <a href="https://github.com/rear/rear/files/8353241/rear-Thuja.log">rear-Thuja.log</a></p>
</li>
</ul>
<h4 id="rtinsley87_commented_at_2022-03-29_1724"><img src="https://avatars.githubusercontent.com/u/102384782?u=fcbf3eed1b9aa76346fdfa1fddfc03bd42430dac&v=4" width="50"><a href="https://github.com/rtinsley87">rtinsley87</a> commented at <a href="https://github.com/rear/rear/issues/2779#issuecomment-1082164660">2022-03-29 17:24</a>:<a class="headerlink" href="#rtinsley87_commented_at_2022-03-29_1724" title="Permanent link">&para;</a></h4>
<p>I was able to resolve this issue by adding
"EXCLUDE_MOUNTPOINTS=(/dev/sdb)" to my local.conf. This was the
secondary drive for the backup itself.</p>
<p>So the local.conf looks like this:</p>
<pre><code>export TMPDIR="//mnt/backup/Admin/tmp"
BACKUP=NETFS
NETFS_KEEP_OLD_BACKUP_COPY=y
EXCLUDE_MOUNTPOINTS=(/dev/sdb)
OUTPUT=ISO
OUTPUT_URL=file:///mnt/backup/Admin/Rescue
BACKUP_PROG=rsync
BACKUP_URL=file:///mnt/backup/Admin/Backup
FULLBACKUP=THU
</code></pre>
<h4 id="rtinsley87_commented_at_2022-03-29_2258"><img src="https://avatars.githubusercontent.com/u/102384782?u=fcbf3eed1b9aa76346fdfa1fddfc03bd42430dac&v=4" width="50"><a href="https://github.com/rtinsley87">rtinsley87</a> commented at <a href="https://github.com/rear/rear/issues/2779#issuecomment-1082449384">2022-03-29 22:58</a>:<a class="headerlink" href="#rtinsley87_commented_at_2022-03-29_2258" title="Permanent link">&para;</a></h4>
<p>Further investigating revealed that these settings didn't fix the issue
but removing and re-installing fapolicyd application fixes it. This app
controls app and file whitelist and is required under the stig</p>
<h4 id="jsmeix_commented_at_2022-03-30_0622"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2779#issuecomment-1082669726">2022-03-30 06:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-30_0622" title="Permanent link">&para;</a></h4>
<p>@rtinsley87<br />
thank you for your feedback what the actual root cause is.<br />
Such feedback helps us at ReaR upstream a lot because now we know<br />
there is no hidden bug in ReaR and - at least I - learned about<br />
yet another security thingy that hinders what even 'root' can do<br />
besides the well known suspects "AppArmor" and "SELinux"<br />
(because "rear mkresue" runs as 'root' one assumes it has unlimited
permissions).</p>
<p>You wrote "removing and re-installing fapolicyd":<br />
According to<br />
<a href="https://github.com/linux-application-whitelisting/fapolicyd">https://github.com/linux-application-whitelisting/fapolicyd</a><br />
fapolicyd is a "File Access Policy Daemon" so I would assume<br />
it should be sufficient to only stop this daemon before "rear
mkrescue"<br />
and re-start it afterwards.<br />
But this removes fapolicyd protection while "rear mkrescue" is running<br />
so I think a better solution would be to configure fapolicyd
appropriately<br />
so that "rear mkrescue" can work.<br />
But I know nothing about fapolicyd whether or not it can be configured<br />
this way with reasonable effort.</p>
<h4 id="rtinsley87_commented_at_2022-03-30_1600"><img src="https://avatars.githubusercontent.com/u/102384782?u=fcbf3eed1b9aa76346fdfa1fddfc03bd42430dac&v=4" width="50"><a href="https://github.com/rtinsley87">rtinsley87</a> commented at <a href="https://github.com/rear/rear/issues/2779#issuecomment-1083326806">2022-03-30 16:00</a>:<a class="headerlink" href="#rtinsley87_commented_at_2022-03-30_1600" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thank you for following up! My supervisor and I are Windows users mainly
so I didn't think about fapolicyd being a daemon or service in Windows
that I could stop instead. I believe what may have happened is that the
daemon generates a default whitelist when it is initially installed
which is during the OS installation and when I removed and reinstalled
it generated a new default list that included everything currently on
the system or maybe not to that extent. The point is that, the rescue
ISO creation would work after the daemon was reinstalled and active as
well as if I uninstalled it then ran rescue and then re-installed.</p>
<p>I agree that we should configure it correctly if we want to leave it
installed. Thank you for providing the github link for fapolicyd so that
we can understand it better.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-03-25.2779.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
