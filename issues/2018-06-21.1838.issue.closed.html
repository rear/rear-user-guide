<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1838 Issue closed: How to interrupt the automatic Rear restore to same hardware and get to Relax-and-Recover shell? - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1838 Issue closed: How to interrupt the automatic Rear restore to same hardware and get to Relax-and-Recover shell?";
        var mkdocs_page_input_path = "issues/2018-06-21.1838.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1838 Issue closed: How to interrupt the automatic Rear restore to same hardware and get to Relax-and-Recover shell?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1838_issue_closed_how_to_interrupt_the_automatic_rear_restore_to_same_hardware_and_get_to_relax-and-recover_shell"><a href="https://github.com/rear/rear/issues/1838">#1838 Issue</a> <code>closed</code>: How to interrupt the automatic Rear restore to same hardware and get to Relax-and-Recover shell?<a class="headerlink" href="#1838_issue_closed_how_to_interrupt_the_automatic_rear_restore_to_same_hardware_and_get_to_relax-and-recover_shell" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="ccjung_opened_issue_at_2018-06-21_1339"><img src="https://avatars.githubusercontent.com/u/29214472?u=58ae98d864664297a19702de40bf4767338e396b&v=4" width="50"><a href="https://github.com/ccjung">ccjung</a> opened issue at <a href="https://github.com/rear/rear/issues/1838">2018-06-21 13:39</a>:<a class="headerlink" href="#ccjung_opened_issue_at_2018-06-21_1339" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):Relax-and-Recover
    2.1-git.2325.fc6e788.master / 2017-07-16</li>
<li>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):</li>
</ul>
<pre>
NAME="SLES"
VERSION="11.4"
VERSION_ID="11.4"
PRETTY_NAME="SUSE Linux Enterprise Server 11 SP4"
ID="sles"
ANSI_COLOR="0;32"
CPE_NAME="cpe:/o:suse:sles:11:4"
</pre>

<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" or "cat
    /etc/rear/local.conf"):</li>
</ul>
<pre>
# Default is to create Relax-and-Recover rescue media as ISO image
# set OUTPUT to change that
# set BACKUP to activate an automated (backup and) restore of your data
# Possible configuration values can be found in /usr/share/rear/conf/default.conf
#
# This file (local.conf) is intended for manual configuration. For configuration
# through packages and other automated means we recommend creating a new
# file named site.conf next to this file and to leave the local.conf as it is.
# Our packages will never ship with a site.conf.
AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
REAR_INITRD_COMPRESSION=lzma
OUTPUT=ISO
ISO_MAX_SIZE=4000
BACKUP=NETFS
BACKUP_URL=iso:///iso_fs/REAR_BACKUP
ISO_DIR=/iso_fs/REAR_ISO
TMPDIR=/iso_fs/REAR_TEMP
OUTPUT_URL=null
BOOT_FROM_SAN=y
EXCLUDE_MOUNTPOINTS=( /iso_fs /opt/commvault /opt/IBM/ITM /opt/splunkforwarder /opt/teamquest /var/opt/BESClient /hana/backup /hana/data /hana/log /hana/shared /usr/sap /usr/sap/basis /usr/sap/srm /PA_backup )
EXCLUDE_COMPONENTS=( /dev/mapper/20017380034880032 /dev/mapper/20017380034880033 /dev/mapper/20017380034880034 /dev/mapper/2001738003488003b /dev/mapper/2001738003488003e /dev/mapper/2001738003488003f /dev/mapper/20017380034880040 /dev/mapper/20017380034880041 /dev/mapper/20017380034880042 /dev/mapper/20017380034880043 /dev/mapper/20017380034880044 /dev/mapper/20017380034880045 /dev/mapper/20017380034880046 /dev/mapper/20017380034880047 /dev/mapper/20017380034880048 /dev/mapper/20017380034880049 /dev/mapper/2001738003488004a /dev/mapper/2001738003488004b )
</pre>

<ul>
<li>
<p>System architecture (x86 compatible or POWER and/or what kind of
    virtual machine): POWER</p>
</li>
<li>
<p>Are you using BIOS or UEFI or another way to boot? Use Power HMC SMS</p>
</li>
<li>
<p>Brief description of the issue:<br />
    If we use Rear to restore to the same hardware, the restore is
    automatic and we do not see the following menu and be able to go the
    the Relax-and-Recover shell:</p>
</li>
<li>
<p>View disk layout (disklayout.conf) 4) Go to Relax-and-Recover shell</p>
</li>
<li>Edit disk layout (disklayout.conf) 5) Continue recovery</li>
<li>View original disk space usage 6) Abort Relax-and-Recover</li>
</ul>
<p>For a Disaster Recovery test, we will be restoring to same hardware and
want to go to the Relax-and-Recover shell to run addiitonal scripts.</p>
<p>How do we get the option to be able to interrupt the automatic restore
to the same hardware and do additonal tasks before continuing with the
restore?</p>
<p>Thank you.</p>
<ul>
<li>Work-around, if any:</li>
</ul>
<h4 id="jsmeix_commented_at_2018-06-22_0721"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1838#issuecomment-399347056">2018-06-22 07:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-06-22_0721" title="Permanent link">&para;</a></h4>
<p>@suseusr168<br />
you use <code>Relax-and-Recover 2.1-git.2325.fc6e788.master / 2017-07-16</code><br />
which is too old for what you like to get.</p>
<p>I recommend to use our current ReaR upstream GitHub master code<br />
because that is the only place where we fix bugs - i.e. bugs in older<br />
ReaR versions are not fixed by us (i.e. by ReaR upstream).</p>
<p>To use our current ReaR upstream GitHub master code do the following:</p>
<p>Basically "git clone" it into a separated directory and then<br />
configure and run ReaR from within that directory like:</p>
<pre>
# git clone https://github.com/rear/rear.git

# mv rear rear.github.master

# cd rear.github.master

# vi etc/rear/local.conf

# usr/sbin/rear -D mkbackup
</pre>

<p>Note the relative paths "etc/rear/" and "usr/sbin/".</p>
<p>Alternatively use our curent latest ReaR 2.4 release<br />
from one of the "OpenSUSE Build Service packages" at<br />
<a href="http://relax-and-recover.org/download/">http://relax-and-recover.org/download/</a></p>
<p>When you have our current ReaR upstream GitHub master code<br />
or our curent latest ReaR 2.4 release you can do the following:</p>
<p>See the Relax-and-Recover Release Notes 2.4 at<br />
<a href="http://relax-and-recover.org/documentation/release-notes-2-4">http://relax-and-recover.org/documentation/release-notes-2-4</a><br />
that read (excerpts):</p>
<pre>
Version 2.3 (December 2017)
Abstract
...
Improved MIGRATION_MODE autodetection when the disk layout
looks ambiguous. Now ‘rear recover’ switches by default more often
into MIGRATION_MODE where manual disk layout configuration
happens via several user dialogs so that by default ‘rear recover’
shows more often user dialogs compared to before but the
intended behaviour can be enforced via the MIGRATION_MODE
config variable (for details see default.conf).
</pre>

<p>And our current default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf</a><br />
reads (excerpt):</p>
<pre>
##
# MIGRATION_MODE recovery during "rear recover"
#
# There is some basic autodetection during "rear recover" when
# disks on the replacement hardware seem to not match compared to
# what there was stored in disklayout.conf on the original system.
# If a mismatch is autodetected then ReaR goes into its
# MIGRATION_MODE where manual disk layout configuration happens.
# In this case ReaR asks the user via several user dialogs what to do.
# Only the disk size is used to determine whether or not
# disks on the replacement hardware match the disks on the original system.
# Problems only appear when more than one disk with same size is used.
# Examples:
# When on the original system and on the replacement hardware two disks
# with same size are used the disk devices may get interchanged
# so that what there was on /dev/sda on the original system may get
# recreated on /dev/sdb on the replacement hardware and vice versa.
# When on the original system one disk is used for the system and
# another disk with same size for the ReaR recovery system and backup
# the disk devices may get interchanged on the replacement hardware
# so that "rear recover" could result an ultimate disaster
# (instead of a recovery from a disaster) if it recreated the system
# on the disk where the ReaR recovery system and backup is
# which would overwrite/destroy the backup via parted and mkfs
# (cf. https://github.com/rear/rear/issues/1271).
# Therefore to be on the safe side and to avoid such problems
# ReaR goes by default automatically into its MIGRATION_MODE
# when more than one disk with same size is used on the original system
# or when for one of the used disk sizes on the original system
# more than one disk with same size is found on the replacement hardware
# i.e. when there is more than one possible target disk.
# Accordingly ReaR goes by default not into its MIGRATION_MODE
# only if for each used disk size on the original system eaxctly one
# possible target disk with same size is found on the replacement hardware.
# By setting MIGRATION_MODE='true' one can enfore MIGRATION_MODE.
# The by-default empty MIGRATION_MODE results that MIGRATION_MODE
# is set via the above described autodetection during "rear recover".
# MIGRATION_MODE is set to a default value here only
# if not already set so that the user can set it also via
#   export MIGRATION_MODE='true'
# directly before he calls "rear recover":
test "$MIGRATION_MODE" || MIGRATION_MODE=''
</pre>

<p>I.e. to enforce the MIGRATION_MODE dialogs<br />
when the replacement disk has same size call<br />
<code>export MIGRATION_MODE='true'</code><br />
before you call <code>rear recover</code>.</p>
<p>Furthermore in our current ReaR upstream GitHub master code<br />
or our curent latest ReaR 2.4 release there is in any case a<br />
user confirmation dialog (with 30 seconds timeout) where<br />
one can in any case interrupt the automatic proceeding restore<br />
when the replacement disk has same size, see<br />
<a href="https://github.com/rear/rear/issues/1271#issuecomment-346633365">https://github.com/rear/rear/issues/1271#issuecomment-346633365</a></p>
<p>Finally in our current ReaR upstream GitHub master code<br />
or our curent latest ReaR 2.4 release there is in MIGRATION_MODE<br />
an additional user confirmation dialog after the backup was restored<br />
so that the user can - if needed - adjust certain things, see<br />
<a href="https://github.com/rear/rear/pull/1758">https://github.com/rear/rear/pull/1758</a><br />
for some details and the reasoning behind.</p>
<h4 id="jsmeix_commented_at_2018-06-22_1212"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1838#issuecomment-399421895">2018-06-22 12:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-06-22_1212" title="Permanent link">&para;</a></h4>
<p>@suseusr168<br />
FYI<br />
how that user confirmation dialog looks like that appears<br />
in any case also when the replacement disk has same size<br />
on one of my test systems (SLES15 on KVM/QEMU virtual machine)</p>
<pre>
RESCUE d228:~ # rear -D recover
...
Comparing disks
Device sda has expected (same) size 21474836480 (will be used for recovery)
Disk configuration looks identical
UserInput -I DISK_LAYOUT_PROCEED_RECOVERY needed in /usr/share/rear/layout/prepare/default/250_compare_disks.sh line 146
Proceed with recovery (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)

UserInput: No real user input (empty or only spaces) - using default input
UserInput: No choices - result is 'yes'
User confirmed to proceed with recovery
</pre>

<p>and how it looks when that dialog is not confirmed<br />
i.e. when a <code>false</code> value like <code>n</code> is entered (excerpt):</p>
<pre>
Comparing disks
Device sda has expected (same) size 21474836480 (will be used for recovery)
Disk configuration looks identical
UserInput -I DISK_LAYOUT_PROCEED_RECOVERY needed in /usr/share/rear/layout/prepare/default/250_compare_disks.sh line 146
Proceed with recovery (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)
n
UserInput: No choices - result is 'n'
User enforced manual disk layout configuration
Using /dev/sda (same name and same size) for recreating /dev/sda
Current disk mapping table (source -> target):
    /dev/sda /dev/sda
UserInput -I LAYOUT_MIGRATION_CONFIRM_MAPPINGS needed in /usr/share/rear/layout/prepare/default/300_map_disks.sh line 211
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default '1' timeout 300 seconds)
</pre>

<p>versus how it looks with <code>export MIGRATION_MODE='true'</code> before
<code>rear recover</code></p>
<pre>
RESCUE d228:~ # export MIGRATION_MODE='true'

RESCUE d228:~ # rear -D recover
...
Enforced manual disk layout configuration (MIGRATION_MODE is 'true')
Using /dev/sda (same name and same size) for recreating /dev/sda
Current disk mapping table (source -> target):
    /dev/sda /dev/sda
UserInput -I LAYOUT_MIGRATION_CONFIRM_MAPPINGS needed in /usr/share/rear/layout/prepare/default/300_map_disks.sh line 211
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default '1' timeout 300 seconds)
</pre>

<h4 id="ccjung_commented_at_2018-06-22_1448"><img src="https://avatars.githubusercontent.com/u/29214472?u=58ae98d864664297a19702de40bf4767338e396b&v=4" width="50"><a href="https://github.com/ccjung">ccjung</a> commented at <a href="https://github.com/rear/rear/issues/1838#issuecomment-399468279">2018-06-22 14:48</a>:<a class="headerlink" href="#ccjung_commented_at_2018-06-22_1448" title="Permanent link">&para;</a></h4>
<p>@jsmeix ,<br />
Setting the variable export MIGRATION_MODE='true' worked!</p>
<p>After the restore, we saw the RESCUE prompt and was able to run our DR
script.</p>
<p>We will download Rear 2.4 and test it out.</p>
<p>Thank you for your prompt response and your help!</p>
<h4 id="jsmeix_commented_at_2018-06-25_0819"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1838#issuecomment-399870722">2018-06-25 08:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-06-25_0819" title="Permanent link">&para;</a></h4>
<p>@suseusr168<br />
thanks for your explicit positive feedback!<br />
It helps a lot to get explicit feedback that things work as intended<br />
and that there is not another possibly still unknown issue in ReaR.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-06-21.1838.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
