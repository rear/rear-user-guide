<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1966 Issue closed: Borg integration cannot handle local backups - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1966 Issue closed: Borg integration cannot handle local backups";
        var mkdocs_page_input_path = "issues/2018-11-19.1966.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1966 Issue closed: Borg integration cannot handle local backups</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1966_issue_closed_borg_integration_cannot_handle_local_backups"><a href="https://github.com/rear/rear/issues/1966">#1966 Issue</a> <code>closed</code>: Borg integration cannot handle local backups<a class="headerlink" href="#1966_issue_closed_borg_integration_cannot_handle_local_backups" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>needs sponsorship</code>, <code>external tool</code>,
<code>no-issue-activity</code></p>
<h4 id="signum_opened_issue_at_2018-11-19_0039"><img src="https://avatars.githubusercontent.com/u/36562?v=4" width="50"><a href="https://github.com/Signum">Signum</a> opened issue at <a href="https://github.com/rear/rear/issues/1966">2018-11-19 00:39</a>:<a class="headerlink" href="#signum_opened_issue_at_2018-11-19_0039" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): 2.4</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):</p>
</li>
</ul>
<p>Distributor ID: Debian<br />
Description: Debian GNU/Linux 9.6 (stretch)<br />
Release: 9.6<br />
Codename: stretch</p>
<ul>
<li>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):</li>
</ul>
<p>HP DL 360 hardware server</p>
<ul>
<li>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</li>
</ul>
<p>AMD64</p>
<ul>
<li>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</li>
</ul>
<p>local disk</p>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>Apparently the Borg integration can either handle SSH connections or a
local USB device. In my case I am usually using a mounted NFS file
system to access the backup server. It looks like REAR currently does
not support that scenario. If the BORGBACKUP_HOST variable is set then
it enforces an SSH connection. If it is not set then a local USB device
must be present. But a repository that is accessible at e.g.
/mnt/backup-server/rear-volume cannot be used.</p>
<p>If I try to omit BORGBACKUP_HOST and also the USB setting then REAR
dies with messages like:</p>
<pre><code>Using log file: /opt/rear/var/log/rear/rear-reartest.log
ERROR: Mount command 'mount -v -o rw,noatime / /tmp/rear.cg4UEAoZfJI8rUT/borg_backup' failed.
Some latest log messages since the last called script 250_mount_usb.sh:
  2018-11-19 00:43:46.233832962 Including prep/BORG/default/250_mount_usb.sh
  mkdir: created directory '/tmp/rear.cg4UEAoZfJI8rUT/borg_backup'
</code></pre>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>None known.</p>
<h4 id="gozora_commented_at_2018-11-19_0705"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439791672">2018-11-19 07:05</a>:<a class="headerlink" href="#gozora_commented_at_2018-11-19_0705" title="Permanent link">&para;</a></h4>
<p>Hi @Signum,</p>
<p>Did you try to use backup over SSH to localhost?</p>
<p>This should work fine for you ...</p>
<p>V.</p>
<h4 id="signum_commented_at_2018-11-19_1300"><img src="https://avatars.githubusercontent.com/u/36562?v=4" width="50"><a href="https://github.com/Signum">Signum</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439884954">2018-11-19 13:00</a>:<a class="headerlink" href="#signum_commented_at_2018-11-19_1300" title="Permanent link">&para;</a></h4>
<p>Thank you. That works indeed. But doesn't that add overhead for the SSH
encryption?</p>
<h4 id="schlomo_commented_at_2018-11-19_1305"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439886201">2018-11-19 13:05</a>:<a class="headerlink" href="#schlomo_commented_at_2018-11-19_1305" title="Permanent link">&para;</a></h4>
<p>I would expect a significant performance degradation when using
localhost SSH compared to direct mounting.</p>
<p>@Signum do you feel like preparing a pull request to fix this? This is a
typical case of a use case that didn't show up so far. I would suggest
to add logic that compares <code>BORGBACKUP_HOST</code> with the local host name
and with <code>localhost</code> in order to activate direct mounting. It might be
possible that it is enough to adjust the variables to trigger the right
code path. That way you could use the same configuration everywhere and
the backup would work locally if it is on the backup server.</p>
<p>In
<a href="https://github.com/schlomo/rbme/blob/master/rbme#L486">https://github.com/schlomo/rbme/blob/master/rbme#L486</a>
(my own backup tool) I had to solve the same problem.</p>
<h4 id="signum_commented_at_2018-11-19_1318"><img src="https://avatars.githubusercontent.com/u/36562?v=4" width="50"><a href="https://github.com/Signum">Signum</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439889459">2018-11-19 13:18</a>:<a class="headerlink" href="#signum_commented_at_2018-11-19_1318" title="Permanent link">&para;</a></h4>
<p>@schlomo I am pretty sure I can provide a decent pull request, yes.
Thanks for the discussion. Feel free to leave this issue open until
then. Give me roughly a week.</p>
<h4 id="gozora_commented_at_2018-11-19_1324"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439891251">2018-11-19 13:24</a>:<a class="headerlink" href="#gozora_commented_at_2018-11-19_1324" title="Permanent link">&para;</a></h4>
<p>When I was writing BORG support for ReaR, I was thinking about direct
mounting, but using localhost over SSH looked to be much more universal
solution comparing to writing mount code for all the different
networking file systems out there.<br />
Currently @Signum have NFS mounted but soon Samba share might appear,
afterwards some "fuse you name it file system".<br />
But in general if we can have universal code for Borg honoring universal
mounting I have not problem with that.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2018-11-19_1326"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439891945">2018-11-19 13:26</a>:<a class="headerlink" href="#gozora_commented_at_2018-11-19_1326" title="Permanent link">&para;</a></h4>
<p>@Signum I think that ssh encryption factor on HP DL 360 is negligible
;-)</p>
<p>V.</p>
<h4 id="signum_commented_at_2018-11-19_1448"><img src="https://avatars.githubusercontent.com/u/36562?v=4" width="50"><a href="https://github.com/Signum">Signum</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439917734">2018-11-19 14:48</a>:<a class="headerlink" href="#signum_commented_at_2018-11-19_1448" title="Permanent link">&para;</a></h4>
<p>While trying with "localhost" I just realized that the boot medium would
have to mount the NFS mountpoint to that borg can access the backup. I
couldn't find anything in the REAR docs on how to do that. Is it
supported? Because if NFS mounts wouldn't work then an automated
recovery would not work.</p>
<h4 id="gozora_commented_at_2018-11-19_1505"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439923629">2018-11-19 15:05</a>:<a class="headerlink" href="#gozora_commented_at_2018-11-19_1505" title="Permanent link">&para;</a></h4>
<p>You need to include NFS related sw like <a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1076">kernel
modules</a>
and
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1573">binaries</a>
like mount.nfs, all the rpc.* stuff .., into ReaR recovery system.<br />
One way to do it would be to use MODULES and PROGS_BORG options in
local.conf.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2018-11-19_1524"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439930362">2018-11-19 15:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-19_1524" title="Permanent link">&para;</a></h4>
<p>I am not a BORG user so only a blind shot in the dark:</p>
<p>Because<br />
<code>for f in $( find usr/share/rear/ -type f | grep -i borg ) ; do grep -H 'BACKUP_URL' $f ; done</code><br />
does not show something I assume the current BORG code in ReaR<br />
does not use the BACKUP_URL config variable.</p>
<p>For BACKUP=NETFS primarily the BACKUP_URL config variable<br />
determines what stuff gets included into the ReaR recovery system via<br />
usr/share/rear/prep/NETFS/default/050_check_NETFS_requirements.sh<br />
and also via its symbolic link<br />
usr/share/rear/prep/BLOCKCLONE/default/050_check_NETFS_requirements.sh<br />
for BACKUP=BLOCKCLONE.</p>
<p>Therefore I wonder if that code for BACKUP=NETFS might be relatively
easily<br />
also used for BACKUP=BORG with an appropriate BACKUP_URL setting<br />
because there should be no conflicts with the other existing code for<br />
BACKUP=BORG when BACKUP_URL has an arbitrary value?</p>
<h4 id="jsmeix_commented_at_2018-11-19_1535"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439934476">2018-11-19 15:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-19_1535" title="Permanent link">&para;</a></h4>
<p>Another not so blind shot in the dark:</p>
<p>It seems what @Signum needs is some functionality of BACKUP=NETFS<br />
together with BACKUP=BORG which looks somewhat related to<br />
"Using Multiple Backups for Relax-and-Recover" as described in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a></p>
<p>@Signum<br />
have a look if it might work as a first step towards what you need when
you do<br />
some kind of "Mis-Using Multiple Backups for Relax-and-Recover"<br />
to combine BACKUP=NETFS support together with BACKUP=BORG<br />
in one same ReaR recovery system.</p>
<h4 id="signum_commented_at_2018-11-19_1543"><img src="https://avatars.githubusercontent.com/u/36562?v=4" width="50"><a href="https://github.com/Signum">Signum</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-439937643">2018-11-19 15:43</a>:<a class="headerlink" href="#signum_commented_at_2018-11-19_1543" title="Permanent link">&para;</a></h4>
<p>@jsmeix Thanks for the clarification. Yes, I would like to use NETFS but
not copy the entire machine but rather do incremental backups. Multiple
backups seemed pretty complicated. My task is to run a PostgreSQL server
at a remove location with no IT staff on-site. So having REAR seemed to
be the best way for disaster recovery. And preferable the "Automatic"
variant.</p>
<p>I will re-read the page about multiple backups. Although it feels like
I'm doing something I shouldn't be.</p>
<h4 id="github-actions_commented_at_2020-08-24_0134"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/1966#issuecomment-678860041">2020-08-24 01:34</a>:<a class="headerlink" href="#github-actions_commented_at_2020-08-24_0134" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-11-19.1966.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
