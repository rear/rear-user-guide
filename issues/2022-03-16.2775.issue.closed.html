<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2775 Issue closed: mkbackup with Borg tries to backup /mnt/* and dies - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2775 Issue closed: mkbackup with Borg tries to backup /mnt/* and dies";
        var mkdocs_page_input_path = "issues/2022-03-16.2775.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2775 Issue closed: mkbackup with Borg tries to backup /mnt/* and dies</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2775_issue_closed_mkbackup_with_borg_tries_to_backup_mnt_and_dies"><a href="https://github.com/rear/rear/issues/2775">#2775 Issue</a> <code>closed</code>: mkbackup with Borg tries to backup /mnt/* and dies<a class="headerlink" href="#2775_issue_closed_mkbackup_with_borg_tries_to_backup_mnt_and_dies" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>external tool</code>, <code>no-issue-activity</code></p>
<h4 id="scruloose_opened_issue_at_2022-03-16_1410"><img src="https://avatars.githubusercontent.com/u/3537536?v=4" width="50"><a href="https://github.com/scruloose">scruloose</a> opened issue at <a href="https://github.com/rear/rear/issues/2775">2022-03-16 14:10</a>:<a class="headerlink" href="#scruloose_opened_issue_at_2022-03-16_1410" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):</p>
<ul>
<li>Relax-and-Recover 2.6-git.4698.a16e8403.master / 2022-03-09</li>
</ul>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
<ul>
<li>Debian Bookworm</li>
</ul>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>BACKUP=BORG
OUTPUT=RAWDISK
OUTPUT_URL="file:///ReaR"
OUTPUT_PREFIX=""
MODULES=( 'all_modules' )
COPY_AS_IS_EXCLUDE=( "${COPY_AS_IS_EXCLUDE[@]}" /etc/ssh/ssh_host* )
SSH_FILES='yes'
SSH_UNPROTECTED_PRIVATE_KEYS='no'
TIMESYNC=CHRONY
COPY_AS_IS_BORG=( "$ROOT_HOME_DIR/.config/borg/keys/" )
BORGBACKUP_HOST="neo"
BORGBACKUP_USERNAME="borg-$HOSTNAME"
BORGBACKUP_REPO="/~/borg"
BORGBACKUP_ARCHIVE_PREFIX="rear"
BORGBACKUP_COMPRESSION="auto,lz4"
BORGBACKUP_ENC_TYPE="keyfile-blake2"
BORGBACKUP_PRUNE_KEEP_DAILY=7
BORGBACKUP_PRUNE_KEEP_WEEKLY=4
BORGBACKUP_PRUNE_KEEP_MONTHLY=12
export BORG_PASSPHRASE=&lt;redacted&gt;
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
export BORG_LOGGING_CONF="/etc/rear/borg-logging.conf"
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):</p>
<ul>
<li>Sager laptop; bare metal</li>
</ul>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</p>
<ul>
<li>x86_64</li>
</ul>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
<ul>
<li>UEFI and GRUB</li>
</ul>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</p>
<ul>
<li>local NVMe</li>
</ul>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>/dev/nvme1n1            /dev/nvme1n1
|                                    nvme   disk               465.8G 
|-/dev/nvme1n1p1        /dev/nvme1n1p1
|                             /dev/nvme1n1
|                                    nvme   part  vfat           487M /boot/efi
|-/dev/nvme1n1p2        /dev/nvme1n1p2
|                             /dev/nvme1n1
|                                    nvme   part  ext4           954M /boot
|-/dev/nvme1n1p3        /dev/nvme1n1p3
|                             /dev/nvme1n1
|                                    nvme   part                  16M 
|-/dev/nvme1n1p4        /dev/nvme1n1p4
|                             /dev/nvme1n1
|                                    nvme   part  ntfs         231.4G 
`-/dev/nvme1n1p5        /dev/nvme1n1p5
                              /dev/nvme1n1
                                     nvme   part  crypto       232.9G 
  `-/dev/mapper/nvme0n1p2_crypt
                        /dev/dm-0
                              /dev/nvme1n1p5
                                            crypt LVM2_m       232.9G 
    |-/dev/mapper/rem--vg-vg--root
    |                   /dev/dm-1
    |                         /dev/dm-0
    |                                       lvm   ext4   root  217.9G /
    `-/dev/mapper/rem--vg-vg--swap
                        /dev/dm-2
                              /dev/dm-0
                                            lvm   swap            15G [SWAP]
/dev/nvme0n1            /dev/nvme0n1
|                                    nvme   disk                 1.8T 
`-/dev/nvme0n1p1        /dev/nvme0n1p1
                              /dev/nvme0n1
                                     nvme   part                 1.8T
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
<code>rear mkbackup</code> runs for a couple of minutes, then aborts.
    <code>systemctl status rear.service</code> shows the following:</li>
</ul>
<!-- -->

<pre><code>Mar 09 14:45:19 rem rear[317255]: ERROR: Borg failed to create backup archive, borg rc 1!
Mar 09 14:45:19 rem rear[317255]: Some latest log messages since the last called script 500_make_backup.sh:
Mar 09 14:45:19 rem rear[317255]:   2022-03-09 14:44:06.707125026 Creating backup archive 'rear_235' in Borg repository /~/borg on neo
Mar 09 14:45:19 rem rear[317255]: Use debug mode '-d' for some debug messages or debugscript mode '-D' for full debug messages with 'set -x' output
Mar 09 14:45:19 rem rear[317255]: Aborting due to an error, check /var/log/rear/rear-rem.log for details
Mar 09 14:45:22 rem systemd[1]: rear.service: Deactivated successfully.
Mar 09 14:45:22 rem systemd[1]: rear.service: Consumed 2min 35.624s CPU time.
</code></pre>
<p>This isn't the primary issue, but I will note that according to the
<a href="https://borgbackup.readthedocs.io/en/stable/usage/general.html?highlight=exit%20code#return-codes">Borg
docs</a>,
return code 1 indicates that Borg successfully completed, but with
warning(s) — not that it failed. I have verified that Borg <em>does</em>
successfully create the backup archive. ReaR should probably pass along
the warning and keep going in this case, not abort with an error message
claiming that Borg failed.</p>
<p><code>borg.log</code> contents:</p>
<pre><code>2022-03-09 14:44:08,213 INFO Creating archive at "ssh://borg-rem@neo:22/~/borg::rear_235"
2022-03-09 14:44:36,140 WARNING /mnt/&lt;dir1&gt;/&lt;foo&gt;: dir_open: [Errno 19] No such device: 'collab'
2022-03-09 14:44:36,300 WARNING /mnt/&lt;di1r&gt;/&lt;bar&gt;: dir_open: [Errno 19] No such device: 'trinity'
2022-03-09 14:44:36,924 WARNING /mnt/&lt;dir2&gt;: file inode changed (race condition), skipping file
2022-03-09 14:44:38,113 WARNING /mnt/&lt;dir3&gt;: file inode changed (race condition), skipping file
2022-03-09 14:44:38,601 WARNING /mnt/&lt;dir4&gt;/&lt;baz&gt;: file inode changed (race condition), skipping file
2022-03-09 14:44:38,930 WARNING /mnt/&lt;dir5&gt;/&lt;blah&gt; file inode changed (race condition), skipping file
2022-03-09 14:44:39,081 WARNING /mnt/&lt;dir6&gt;: file inode changed (race condition), skipping file
</code></pre>
<p>It looks like when ReaR calls Borg to do the backup, it's including
things under <code>/mnt</code>, which (to the best of my understanding) should all
be excluded automatically.</p>
<p>And here's the <code>rear.log</code>:</p>
<pre><code>Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.
Disk /var/tmp/rear.ZDumIhuP58NgCnr/tmp/rear-rem.raw: 778240 sectors, 380.0 MiB
Sector size (logical): 512 bytes
Disk identifier (GUID): 87B36ABC-0B06-42AA-B830-FBA9CBE2DD1A
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 778206
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          778206   379.0 MiB   EF00  Rescue System
2022-03-16 02:35:45.054100533 Using syslinux to install a Legacy BIOS bootloader
2022-03-16 02:35:45.367482529 Raw disk boot partition capacity after copying:
Filesystem      Size  Used Avail Use% Mounted on
/dev/loop0p1    379M  354M   25M  94% /var/tmp/rear.ZDumIhuP58NgCnr/tmp/boot
2022-03-16 02:35:55.247410124 Including output/default/400_copy_disk_struct_files.sh
2022-03-16 02:35:55.251655077 Including output/default/940_grub2_rescue.sh
2022-03-16 02:35:55.255723780 Including output/default/940_grub_rescue.sh
2022-03-16 02:35:55.260051080 Including output/default/950_copy_result_files.sh
2022-03-16 02:35:55.265194400 Copying resulting files to file location
2022-03-16 02:35:55.270463844 Saving /var/log/rear/rear-rem.log as rear-rem.log to file location
2022-03-16 02:35:55.273341144 Copying result files '/var/tmp/rear.ZDumIhuP58NgCnr/tmp/rear-rem.raw.gz /var/tmp/rear.ZDumIhuP58NgCnr/tmp/VERSION /var/tmp/rear.ZDumIhuP58NgCnr/tmp/README /var/tmp/rear.ZDumIhuP58NgCnr/tmp/rear-rem.log' to /ReaR/ at file location
2022-03-16 02:35:55.552225170 Including output/default/950_email_result_files.sh
2022-03-16 02:35:55.556252181 Including output/default/970_remove_lock.sh
2022-03-16 02:35:55.564144533 Including output/default/980_umount_output_dir.sh
2022-03-16 02:35:55.568271775 Finished running 'output' stage in 16 seconds
2022-03-16 02:35:55.570469638 ======================
2022-03-16 02:35:55.573768830 Running 'backup' stage
2022-03-16 02:35:55.579414682 ======================
2022-03-16 02:35:55.597765085 Including backup/default/010_pre_backup_script.sh
2022-03-16 02:35:55.610350022 Including backup/BORG/default/100_get_suffix.sh
2022-03-16 02:35:55.619167083 Including backup/BORG/default/400_create_include_exclude_files.sh
2022-03-16 02:35:55.624631202 Including backup/BORG/default/500_make_backup.sh
2022-03-16 02:35:55.627234920 Creating backup archive 'rear_241' in Borg repository /~/borg on neo
2022-03-16 02:37:11.016508231 ERROR: Borg failed to create backup archive, borg rc 1!
2022-03-16 02:37:11.022567421 Exiting rear mkbackup (PID 169576) and its descendant processes ...
2022-03-16 02:37:14.074604872 rear,169576 /usr/sbin/rear mkbackup
                                `-rear,189076 /usr/sbin/rear mkbackup
                                    `-pstree,189077 -Aplau 169576
2022-03-16 02:37:14.093484395 Running exit tasks
2022-03-16 02:37:14.097010892 Finished rear mkbackup in 169 seconds
2022-03-16 02:37:14.099265876 Removing build area /var/tmp/rear.ZDumIhuP58NgCnr
2022-03-16 02:37:14.577957829 End of program 'rear' reached
</code></pre>
<p>I see in this log that the step
<code>Including backup/BORG/default/400_create_include_exclude_files.sh</code> does
get called, but of course the temp area gets removed at the end of the
run, so I can't check the contents of <code>backup-include.txt</code>.</p>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>I haven't found any successful workaround yet. I have tried adding the
following lines to <code>local.conf</code>:</p>
<ul>
<li><code>EXCLUDE_BACKUP=( '/mnt' )</code></li>
<li><code>AUTOEXCLUDE_PATH=( ${AUTOEXCLUDE_PATH[@]}" /mnt )</code></li>
</ul>
<p>But <code>rear mkbackup</code> still fails with the same log output shown above.</p>
<h4 id="jsmeix_commented_at_2022-03-17_1256"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1070894554">2022-03-17 12:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-17_1256" title="Permanent link">&para;</a></h4>
<p>I didn't have a closer look but on first glance (excerpts from above)</p>
<pre><code>rear mkbackup runs for a couple of minutes, then aborts.
systemctl status rear.service shows the following:
...
Mar 09 14:45:22 rem systemd[1]: rear.service: Deactivated successfully.
Mar 09 14:45:22 rem systemd[1]: rear.service: Consumed 2min 35.624s CPU time.
</code></pre>
<p>indicates this issue could be similar as what I described in<br />
<a href="https://github.com/rear/rear/issues/840">https://github.com/rear/rear/issues/840</a></p>
<p>I know nothing at all about a <code>rear.service</code> for systemd.<br />
As far as I can see there is no <code>rear.service</code> in our sources.<br />
But I am not a systemd expert so I may miss something.</p>
<h4 id="gdha_commented_at_2022-03-17_1356"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1070955066">2022-03-17 13:56</a>:<a class="headerlink" href="#gdha_commented_at_2022-03-17_1356" title="Permanent link">&para;</a></h4>
<p>@scruloose Borg is responsible for the backup not ReaR, therefore,
excluding paths from the backup falls under Borgs' configuration
settings. ReaR tasks during recovery is creating the empty filesystems
and trigger borg to start the restore of the files.<br />
Furthermore, I guess the rear.service is a kind of cron written in
systemd?</p>
<h4 id="scruloose_commented_at_2022-03-17_1357"><img src="https://avatars.githubusercontent.com/u/3537536?v=4" width="50"><a href="https://github.com/scruloose">scruloose</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1070955947">2022-03-17 13:57</a>:<a class="headerlink" href="#scruloose_commented_at_2022-03-17_1357" title="Permanent link">&para;</a></h4>
<p>Thanks for taking a look!</p>
<p>I'm pretty confident that what's going on here is unrelated to that
issue...</p>
<ul>
<li>udev is not involved at all. I wrote the <code>rear.service</code> systemd unit
    myself, and it's activated by a timer, not a udev event.</li>
<li>The systemd service type is "simple", which neither monitors the
    status of the command it launches nor enforces any limit on how long
    it may run.</li>
<li>I use the same <code>rear.service</code> unit on several client systems, all
    using Borg for the backup component, and I've seen it run for many
    hours and succeed.</li>
<li><code>borg.log</code> clearly indicates that Borg is throwing warnings when it
    tries to back up various mounts located under <code>/mnt</code>, which it
    shouldn't be trying to back up in the first place.</li>
<li><code>rear.log</code> shows that ReaR is (wrongly) interpreting Borg's exit
    status of 1 as a failure and thus aborting the <code>mkbackup</code> workflow.
    There is no indication that ReaR is being interrupted.</li>
</ul>
<p>So I'm fairly sure the actual problem is that the <code>rear mkbackup</code>
workflow is failing to exclude <code>/mnt/*</code> in its call to Borg, even though
it should be excluded by default. I don't know how to determine whether
the failure of the include/exclude logic stems from a bug in ReaR or a
mistake in my configuration.</p>
<h4 id="gdha_commented_at_2022-03-17_1406"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1070958748">2022-03-17 14:06</a>:<a class="headerlink" href="#gdha_commented_at_2022-03-17_1406" title="Permanent link">&para;</a></h4>
<p>@gozora Hi Vlad - you are our Borg specialist - could you have a look
and comment on this issue please?</p>
<h4 id="scruloose_commented_at_2022-03-17_1449"><img src="https://avatars.githubusercontent.com/u/3537536?v=4" width="50"><a href="https://github.com/scruloose">scruloose</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1070973427">2022-03-17 14:49</a>:<a class="headerlink" href="#scruloose_commented_at_2022-03-17_1449" title="Permanent link">&para;</a></h4>
<p>@gdha But Borg is taking all of its instructions <em>from ReaR</em>. There is
no Borg configuration, beyond the env-vars and command-line that it
receives from ReaR.</p>
<p>The step
<code>Including backup/BORG/default/400_create_include_exclude_files.sh</code>
creates a temp file called <code>backup-include.txt</code> which is then read by
<code>backup/BORG/default/500_make_backup.sh</code> at the step commented as
"Create Borg friendly include list."</p>
<p>Presumably some combination of ReaR's various <code>EXCLUDE</code> and
<code>AUTOEXCLUDE</code> options determines what goes into that file and thus what
inclusions and exclusions ReaR passes when calling Borg... Right?</p>
<p>Yes, my setup is indeed "a kind of cron written in systemd". A timer
unit triggers the service unit, which executes <code>rear mkbackup</code>. I chose
<code>Type=simple</code> for that service unit specifically because it's the "fire
and forget" type: systemd considers the command successful as soon as
it's forked off, and pays no attention to how long the process runs or
what its exit status is. I'm happy to paste in those unit files, if
anyone thinks they're likely to be relevant.</p>
<h4 id="jsmeix_commented_at_2022-04-04_1547"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1087722797">2022-04-04 15:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-04_1547" title="Permanent link">&para;</a></h4>
<p>I am not a Borg backup user so I cannot actually help with<br />
Borg backup specific issues (if this one is a Borg backup specific
issue).</p>
<p>Because<br />
usr/share/rear/backup/BORG/default/400_create_include_exclude_files.sh<br />
is a symbolic link to<br />
usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh<br />
it seems in particular BACKUP_ONLY_INCLUDE could be<br />
also supported for BACKUP=BORG.</p>
<p>See usr/share/rear/conf/default.conf how BACKUP_ONLY_INCLUDE<br />
is meant to work which is currently online at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1309">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1309</a></p>
<p>I don't know if BACKUP_ONLY_INCLUDE actually works with BACKUP=BORG.<br />
I had BACKUP_ONLY_INCLUDE only tested with 'tar' for BACKUP=NETFS.<br />
If the ReaR default behaviour does not backup what I specifically need<br />
I find it easier to specify exactly what I need in
BACKUP_PROG_INCLUDE<br />
plus BACKUP_ONLY_INCLUDE="yes" to switch off ReaR's automatisms.</p>
<p>I cannot imagine why things under /mnt are not automatically<br />
excluded via our default</p>
<pre><code>AUTOEXCLUDE_PATH=( /media /run /mnt /tmp )
</code></pre>
<p>in this particular case here.</p>
<p>In general without a full debugscripts log file (i.e. "rear -D
mkbackup")<br />
it is impossible to tell what actually happens in this particular case
here.<br />
See our issue template<br />
<a href="https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md">https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md</a><br />
which reads (excerpt)</p>
<pre><code>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover" debug log files)
</code></pre>
<p>that is shown when one enters a new issue via the "New issue" button
at<br />
<a href="https://github.com/rear/rear/issues">https://github.com/rear/rear/issues</a></p>
<p>You may also have a look at the section<br />
"Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="gozora_commented_at_2022-04-04_1614"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1087751477">2022-04-04 16:14</a>:<a class="headerlink" href="#gozora_commented_at_2022-04-04_1614" title="Permanent link">&para;</a></h4>
<p>Hello guys,</p>
<p>I'm sorry, but I've never used <code>OUTPUT=RAWDISK</code> neither with or without
Borg so I have no clue of its implications.<br />
When talking about include/exclude of files, BORG should use same config
variables and processes as NETFS.</p>
<p>I'm sorry I can't help here more but I really lack spare time nowadays .</p>
<p>@gdha sorry for 18 days delay, but I've probably overlook you mentioning
me.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2022-04-05_0552"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1088296007">2022-04-05 05:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-05_0552" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
no need to be sorry.<br />
You already contributed so much to ReaR so feel free to focus on<br />
and hopefully also enjoy what has topmost priority for you now!</p>
<h4 id="github-actions_commented_at_2022-06-05_0300"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2775#issuecomment-1146730342">2022-06-05 03:00</a>:<a class="headerlink" href="#github-actions_commented_at_2022-06-05_0300" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-03-16.2775.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
