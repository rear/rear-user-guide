<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1511 Issue closed: Security Vulnerability (Privilege Escalation): SSH private user key disclosure for root account - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1511 Issue closed: Security Vulnerability (Privilege Escalation): SSH private user key disclosure for root account";
        var mkdocs_page_input_path = "issues/2017-09-22.1511.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1511 Issue closed: Security Vulnerability (Privilege Escalation): SSH private user key disclosure for root account</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1511_issue_closed_security_vulnerability_privilege_escalation_ssh_private_user_key_disclosure_for_root_account"><a href="https://github.com/rear/rear/issues/1511">#1511 Issue</a> <code>closed</code>: Security Vulnerability (Privilege Escalation): SSH private user key disclosure for root account<a class="headerlink" href="#1511_issue_closed_security_vulnerability_privilege_escalation_ssh_private_user_key_disclosure_for_root_account" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>critical / security / legal</code></p>
<h4 id="olivero2_opened_issue_at_2017-09-22_1910"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> opened issue at <a href="https://github.com/rear/rear/issues/1511">2017-09-22 19:10</a>:<a class="headerlink" href="#olivero2_opened_issue_at_2017-09-22_1910" title="Permanent link">&para;</a></h4>
<p>Relax-and-Recover 2.2 (ReaR) copies SSH private user keys from
<code>/root/.ssh</code> to the rescue medium. These keys authenticate SSH access to
accounts on networked hosts without requiring a login password.</p>
<p>On the original system, the private keys are only accessible with root
user privileges. They can be encrypted with a passphrase, but often are
not to allow outgoing SSH connections for unattended backup operations.</p>
<p>The ReaR rescue medium, which may be a DVD or a USB stick, grants
complete unauthenticated access to all files, including copied private
key files. Unless changed by some action outside of ReaR, these private
keys remain valid for the original system, during recovery and on the
restored system.</p>
<h4 id="attack_vector">Attack Vector<a class="headerlink" href="#attack_vector" title="Permanent link">&para;</a></h4>
<p>An attacker with physical access to the rescue medium can steal the
private user keys for the root account.</p>
<p>If the attacker obtains network access, he can then access other
accounts on the network authorizing the compromised root account via
their <code>authorized_keys</code> files.</p>
<p>The vulnerability can be mitigated by encrypting the root user's private
keys if the passphrase and the encryption method used can withstand an
offline attack.</p>
<h4 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h4>
<p>A successful attack allows an attacker to gain privileges on network
hosts and read and alter sensitive information.</p>
<h4 id="olivero2_commented_at_2017-09-23_1408"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331638140">2017-09-23 14:08</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-23_1408" title="Permanent link">&para;</a></h4>
<h2 id="suggestions_for_rear_users_and_developers">Suggestions for ReaR Users and Developers<a class="headerlink" href="#suggestions_for_rear_users_and_developers" title="Permanent link">&para;</a></h2>
<p>See
<a href="https://github.com/rear/rear/issues/1512#issuecomment-331638066">https://github.com/rear/rear/issues/1512#issuecomment-331638066</a></p>
<h4 id="jsmeix_commented_at_2017-09-25_0718"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331796963">2017-09-25 07:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-25_0718" title="Permanent link">&para;</a></h4>
<p>We (i.e the ReaR upstream authors and maintainers)<br />
need to get this security issue fixed before the ReaR 2.3 release.</p>
<h4 id="jsmeix_commented_at_2017-09-25_0735"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331800309">2017-09-25 07:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-25_0735" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/1513#issue-260096327">https://github.com/rear/rear/pull/1513#issue-260096327</a></p>
<pre>
This change improves the security of ReaR
but constitutes a breaking in change.
I find improving the security a good reason
for breaking changes, we just have to
explain it in the release notes.
</pre>

<p>I cannot agree more.</p>
<p>In general regarding security issues:<br />
I think when there is a real security issue for ReaR<br />
it means the issue must be by default exploitable.<br />
A possible security issue that requires that the user has<br />
explicity specified something insecure is not a real<br />
security issue for ReaR because ReaR is a full<br />
(bare-metal) system installer where the user can<br />
and must be able do anything as he needs.<br />
When there is a real security issue for ReaR, then<br />
any fix will be a backward incompatible change<br />
because we must change the by default insecure<br />
behaviour into a secure one.</p>
<h4 id="gdha_commented_at_2017-09-25_1147"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331856732">2017-09-25 11:47</a>:<a class="headerlink" href="#gdha_commented_at_2017-09-25_1147" title="Permanent link">&para;</a></h4>
<p>@gozora @schlomo @jsmeix As Vlad mentioned ISO's should be kept safe all
the time. That brings back memories from the past - see
<a href="http://mkcdrec.cvs.sourceforge.net/viewvc/mkcdrec/mkcdrec/mediacheck/README">http://mkcdrec.cvs.sourceforge.net/viewvc/mkcdrec/mkcdrec/mediacheck/README</a>
- an ISO <strong>mediacheck</strong> - will not guarantee nobody can tamper with the
ISO image, but it will give you at least a stamp of the time it was
created (nothing more nothing less).</p>
<h4 id="schlomo_commented_at_2017-09-25_1256"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331872090">2017-09-25 12:56</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-25_1256" title="Permanent link">&para;</a></h4>
<p>I asked the rear-users mailing list:
<a href="http://lists.relax-and-recover.org/pipermail/rear-users/2017-September/003474.html">http://lists.relax-and-recover.org/pipermail/rear-users/2017-September/003474.html</a></p>
<h4 id="olivero2_commented_at_2017-09-25_1819"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331968503">2017-09-25 18:19</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-25_1819" title="Permanent link">&para;</a></h4>
<p>I see two aspects here:</p>
<ol>
<li>Secure recovery (media integrity). This could be addressed by
    digitally signing rescue media during creation and offering the user
    to verify the signature when attempting recovery.</li>
<li>Protection against credentials theft.</li>
</ol>
<p>@gozora @gdha When you advocate keeping rescue media safe at all times:</p>
<p>How would you protect against credentials theft with rescue media in
less-guarded environments like home offices or branch offices? Think
about burglary or less security-aware office people having access to
such media.</p>
<p>How would you protect against credentials theft in data centers where
personnel lacking top-level security clearance would be involved in
media handling? (On the original system you'd need root privileges
before using the private keys.)</p>
<h4 id="gozora_commented_at_2017-09-25_1853"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331977959">2017-09-25 18:53</a>:<a class="headerlink" href="#gozora_commented_at_2017-09-25_1853" title="Permanent link">&para;</a></h4>
<p>I'm somehow confused, on one hand you are using unencrypted keys to
access servers and one the other hand advocating for high security.<br />
IMHO security must start from bottom and be kept on all levels, starting
with physical access through people and ending on SW layer. What you are
trying is just to somehow patch weak spots ..<br />
Sad true is that systems will never be 100% secure.</p>
<p>To answer your question</p>
<blockquote>
<p>How would you protect against credentials theft with rescue media in
less-guarded environments like home offices or branch offices? Think
about burglary or less security-aware office people having access to
such media.</p>
</blockquote>
<p>You could try this (or similar):
<a href="http://www.lok-it.co.uk/secure-usb-bootable-drive">http://www.lok-it.co.uk/secure-usb-bootable-drive</a></p>
<p>V.</p>
<h4 id="olivero2_commented_at_2017-09-25_1915"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331983744">2017-09-25 19:15</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-25_1915" title="Permanent link">&para;</a></h4>
<p>Sorry for the confusion. What's wrong with using unencrypted keys stored
on a secure (encrypted) medium?</p>
<h4 id="gozora_commented_at_2017-09-25_1917"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331984055">2017-09-25 19:17</a>:<a class="headerlink" href="#gozora_commented_at_2017-09-25_1917" title="Permanent link">&para;</a></h4>
<p>Are you not worried that once one system get compromised, attacker will
gain access to all other servers as well?</p>
<h4 id="olivero2_commented_at_2017-09-25_1919"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331984649">2017-09-25 19:19</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-25_1919" title="Permanent link">&para;</a></h4>
<p>Absolutely. It all depends on the entire network being securely set up.
I am aware of that and always try to find a reasonable trade-off between
security and usability.</p>
<p>After all, the most secure system is the one that cannot be used at all.</p>
<h4 id="olivero2_commented_at_2017-09-25_1928"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331986802">2017-09-25 19:28</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-25_1928" title="Permanent link">&para;</a></h4>
<p>And one extra note: Access is always granted with the least privilege
required.</p>
<h4 id="gozora_commented_at_2017-09-25_1930"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331987433">2017-09-25 19:30</a>:<a class="headerlink" href="#gozora_commented_at_2017-09-25_1930" title="Permanent link">&para;</a></h4>
<blockquote>
<p>And one extra note: Access is always granted with the least privilege
required.</p>
</blockquote>
<p>Now I'm confused again :-(</p>
<h4 id="olivero2_commented_at_2017-09-25_1936"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331988810">2017-09-25 19:36</a>:<a class="headerlink" href="#olivero2_commented_at_2017-09-25_1936" title="Permanent link">&para;</a></h4>
<p>Why? What's wrong with this:
<a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">https://en.wikipedia.org/wiki/Principle_of_least_privilege</a>?</p>
<h4 id="gozora_commented_at_2017-09-25_1947"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-331991741">2017-09-25 19:47</a>:<a class="headerlink" href="#gozora_commented_at_2017-09-25_1947" title="Permanent link">&para;</a></h4>
<p>Ah now I got your point (sometimes I quite slow).<br />
But sometimes even having minimal access rights is enough to get root
privileges ;-)</p>
<h4 id="jankowa_commented_at_2017-09-27_1415"><img src="https://avatars.githubusercontent.com/u/5942664?v=4" width="50"><a href="https://github.com/jankowa">jankowa</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-332535315">2017-09-27 14:15</a>:<a class="headerlink" href="#jankowa_commented_at_2017-09-27_1415" title="Permanent link">&para;</a></h4>
<p>While I think there are reasons anyway not to store secrets (like
ssh-keys) in the rescue image even if stored confidentially there are
usage scenarios where you'll have to store the image on untrusted
storage: e.g. a host in a data center with no direct hardware access.
The only way to restore is to provide the iso file in some way as a
rescue system with the tools the data center provides. Some have these
features: instead of a general rescue image you can provide a custom iso
on some file server - maybe your backup server.</p>
<p>But what about the secret of the backup storage? Correct me - but per
default also the passphrases of the various backup systems are stored to
rear image per default if configured.</p>
<p>We avoid this while not using rear for common daily backups - but for
rescue system only. So we do not store the passphrase for the backup (in
our case: borg) inside the rear config but provide them manually during
rescue image creation.</p>
<p>I'm not a long time user of rear so maybe I just missed the possibility
to configure the behavior already. If not it would be nice to decide
with some options if passphrases should be stored in rescue image or
not.</p>
<h4 id="jsmeix_commented_at_2017-10-09_1203"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1511#issuecomment-335137929">2017-10-09 12:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-10-09_1203" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1513">https://github.com/rear/rear/pull/1513</a>
merged<br />
I assume this issue is sufficiently fixed.<br />
Regarding what "sufficiently" means, cf.<br />
<a href="https://github.com/rear/rear/pull/1513#issuecomment-332413380">https://github.com/rear/rear/pull/1513#issuecomment-332413380</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-09-22.1511.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
