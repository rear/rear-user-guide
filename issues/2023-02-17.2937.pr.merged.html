<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2937 PR merged: Add support for Commvault Galaxy 11 - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2937 PR merged: Add support for Commvault Galaxy 11";
        var mkdocs_page_input_path = "issues/2023-02-17.2937.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2937 PR merged: Add support for Commvault Galaxy 11</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2937_pr_merged_add_support_for_commvault_galaxy_11"><a href="https://github.com/rear/rear/pull/2937">#2937 PR</a> <code>merged</code>: Add support for Commvault Galaxy 11<a class="headerlink" href="#2937_pr_merged_add_support_for_commvault_galaxy_11" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>sponsored</code>,
<code>Dedicated Priority Support</code></p>
<h4 id="schlomo_opened_issue_at_2023-02-17_0914"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/pull/2937">2023-02-17 09:14</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-02-17_0914" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):</p>
</li>
</ul>
<p>#2918</p>
<ul>
<li>How was this pull request tested?</li>
</ul>
<p>Manual tests with Comvault 11</p>
<ul>
<li>Brief description of the changes in this pull request:</li>
</ul>
<p>Clone GALAXY10 integration and adjust for Commvault Galaxy 11</p>
<p>I'm creating this PR for visibility and will continue to work on it, no
need to review it while in DRAFT state</p>
<h4 id="schlomo_commented_at_2023-02-17_1440"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1434740080">2023-02-17 14:40</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-17_1440" title="Permanent link">&para;</a></h4>
<p>Thanks a lot @jsmeix for your review, I still have to go over the code
and will take all of your remarks into consideration.</p>
<h4 id="jsmeix_commented_at_2023-02-17_1445"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1434746066">2023-02-17 14:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-17_1445" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I had only a quick look over the code and<br />
added offhanded comments without much thinking<br />
where I spotted something.</p>
<p>Now it's weekend time for me.</p>
<p>I wish you all a relaxed and recovering weekend!</p>
<h4 id="schlomo_commented_at_2023-02-17_1453"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1434756454">2023-02-17 14:53</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-17_1453" title="Permanent link">&para;</a></h4>
<p>Just an observation:</p>
<p>I think that most of the developers who worked on this code before
didn't realise that during rescue system startup we also read the ReaR
configuration in<br />
<a href="https://github.com/rear/rear/blob/ea900c4ec9589c7acb3d90c01f75ad7781fbdd8c/usr/share/rear/skel/default/etc/scripts/system-setup#L69-L77">https://github.com/rear/rear/blob/ea900c4ec9589c7acb3d90c01f75ad7781fbdd8c/usr/share/rear/skel/default/etc/scripts/system-setup#L69-L77</a></p>
<p>which makes it super simple to tweak the rescue startup for specific
configurations, e.g. mounting a <code>tmpfs</code> for backup software that wants
to confirm some free disk space.</p>
<p>Also, I think modifying the PATH should be done on a system level and
not per-ReaR-run level.</p>
<p>I'll see what can be done with that.</p>
<h4 id="jsmeix_commented_at_2023-02-21_1048"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438261014">2023-02-21 10:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-21_1048" title="Permanent link">&para;</a></h4>
<p>In general regarding new so called "boolean" config variables<br />
i.e. config variables where any non-empty value means 'true', cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L31">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L31</a></p>
<p>In this case here it is USE_RAMDISK:</p>
<p>I suggest to avoid new so called "boolean" config variables<br />
because such config variables evaluate to 'true' if set to 'false',<br />
e.g. in this case</p>
<pre><code>USE_RAMDISK="no"
</code></pre>
<p>will<br />
"Configuring Rescue system with default ramdisk size"<br />
in the current<br />
rescue/GNU/Linux/295_configure_ramdisk_rootfs.sh<br />
<a href="https://github.com/rear/rear/pull/2937/files/8d873cdca24d87e65c085dedfe9c1a8c2cdb4f04..77567f37567b947ab1797018868d934799b20c45#diff-c7ff10e36d2be7dc506e70939111fc5ff53cdcd4f4bf978ff6aeab5430c32eeb">https://github.com/rear/rear/pull/2937/files/8d873cdca24d87e65c085dedfe9c1a8c2cdb4f04..77567f37567b947ab1797018868d934799b20c45#diff-c7ff10e36d2be7dc506e70939111fc5ff53cdcd4f4bf978ff6aeab5430c32eeb</a></p>
<p>For new config variables I recommend explicit coding<br />
by using our is_true and is_false functions, see<br />
lib/global-functions.sh how to use them<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/lib/global-functions.sh#L95">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/lib/global-functions.sh#L95</a></p>
<p>Then default.conf could be like</p>
<pre><code>##
# USE_RAMDISK
#
# Configure rescue system to create and pivot to a ramdisk instead of initramfs.
#
# This is required by some backup software that wants to check for actually available disk space.
# Examples are: GALAXY11
#
# Set to 'true' (or any value that is recognized as 'yes' by the is_true function)
# to use a ramdisk with default size (usually 50% of physical RAM, see 'size' in "man tmpfs").
# Set to a number to use a ramdisk with available free disk space in MiB.
# This will probably crash if you don't have enough physical memory
# for the ReaR recovery system (minimum about 250 MiB up to more than 1 GiB)
# plus the specified available free disk space, see KEEP_BUILD_DIR how to check
# the ReaR recovery system content in $TMPDIR/rear.XXXXXXXXXXXXXXX/rootfs/
USE_RAMDISK="no"
</code></pre>
<p>and<br />
rescue/GNU/Linux/295_configure_ramdisk_rootfs.sh<br />
could be like</p>
<pre><code># Prepare rescue system to switch_root to a ramdisk:

is_false "$USE_RAMDISK" &amp;&amp; return

if is_positive_integer "$USE_RAMDISK" ; then
    DebugPrint "Configuring Rescue system with ramdisk and free disk space of $USE_RAMDISK MiB"
    echo $USE_RAMDISK &gt;$ROOTFS_DIR/etc/ramdisk-free-space
else
    is_true "$USE_RAMDISK" || return 0
    DebugPrint "Configuring Rescue system with default ramdisk size (usually 50% of physical RAM)"
fi

REQUIRED_PROGS+=(switch_root du)
KERNEL_CMDLINE+=" rdinit=/etc/scripts/ramdisk-rootfs"
</code></pre>
<p>I also exchanged by the way "MB" by "MiB"<br />
according to what "man tmpfs" tells about 'size'.</p>
<p>FYI<br />
regarding usual ReaR recovery system size values, see<br />
<a href="https://github.com/rear/rear/discussions/2640#discussioncomment-908335">https://github.com/rear/rear/discussions/2640#discussioncomment-908335</a></p>
<h4 id="jsmeix_commented_at_2023-02-21_1106"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438288284">2023-02-21 11:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-21_1106" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
thank you for the USE_RAMDISK functionality!</p>
<p>I did not know that initramfs behaves fundamentally different<br />
compared to hwo a normal "disk thingy" behaves.</p>
<p>I am reading now things like<br />
<a href="https://stackoverflow.com/questions/10603104/the-difference-between-initrd-and-initramfs">https://stackoverflow.com/questions/10603104/the-difference-between-initrd-and-initramfs</a></p>
<p>Ugh!<br />
Why has all that computing stuff become so complicated :-(<br />
I want my home computer back - the one from 40 years ago ;-)</p>
<h4 id="schlomo_commented_at_2023-02-21_1222"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438389847">2023-02-21 12:22</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-21_1222" title="Permanent link">&para;</a></h4>
<p>@jsmeix I had similar thoughts and was also considering introducing 2
variables:</p>
<ol>
<li><code>USE_RAMDISK</code> as true boolean</li>
<li><code>RAMDISK_FREE_SPACE</code> for the free space</li>
</ol>
<p>Or maybe we should use a numeric value and only use a
<code>RESCUE_RAMDISK_FREE_SPACE</code> which defaults to 0 to indicate not to do
anything and can be set to a number to indicate that we need a ramdisk
with X MiB free space.</p>
<p>I'm also really not sure where in the long <code>default.conf</code> to add this
new variable, any suggestions about the name or place are most welcome.</p>
<h4 id="jsmeix_commented_at_2023-02-21_1232"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438403528">2023-02-21 12:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-21_1232" title="Permanent link">&para;</a></h4>
<p>Regarding the place in default.conf<br />
I think before or after the REAR_INITRD_COMPRESSION part<br />
looks reasonable because ramdisk is related to initrd.</p>
<h4 id="jsmeix_commented_at_2023-02-21_1254"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438431791">2023-02-21 12:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-21_1254" title="Permanent link">&para;</a></h4>
<p>Regarding two variables for "one thing":</p>
<p>I introduced several variables with "ternary semantics", cf.<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L35">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L35</a><br />
and personally I have only good experience with it.</p>
<p>It makes all simpler in practice because<br />
there is only one thing to deal with<br />
so the code is simpler (at least this is how I experienced it)<br />
and it is simpler for the user to specify what he wants.</p>
<p>From a theoretical point of view "ternary semantics"<br />
mixes boolean type with data (integer/string/array) type<br />
but because there is no real boolean type in bash<br />
this does not matter - as long as the boolean values<br />
'True T true t Yes Y yes y 1' and 'False F false f No N no n 0'<br />
cannot appear as data values so one can reliably distinguish<br />
the three cases with 'is_true', 'is-false', and "something else".</p>
<p>E.g. if USE_RAMDISK would be the size in GiB then</p>
<pre><code>USE_RAMDISK=1
</code></pre>
<p>to specify 1 GiB ramdisk size (or free space)<br />
could conflict with <code>is_true "$USE_RAMDISK"</code>.</p>
<p>Spontaneously I like<br />
"only use a RESCUE_RAMDISK_FREE_SPACE which defaults to 0"<br />
most.</p>
<p>In particular because the variable name tells what it does<br />
and even <code>is_false "$RESCUE_RAMDISK_FREE_SPACE"</code> can be used<br />
as a generic test when the user does not want a ramdisk<br />
i.e. the user can also specify <code>RESCUE_RAMDISK_FREE_SPACE="no"</code><br />
when he does not want a ramdisk so the code could be like</p>
<pre><code># Prepare rescue system to switch_root to a ramdisk:

is_false "$RESCUE_RAMDISK_FREE_SPACE" &amp;&amp; return

is_positive_integer "$RESCUE_RAMDISK_FREE_SPACE" || Error "RESCUE_RAMDISK_FREE_SPACE='$RESCUE_RAMDISK_FREE_SPACE' is not a positive integer"

DebugPrint "Configuring Rescue system with ramdisk and free disk space of $RESCUE_RAMDISK_FREE_SPACE MiB"
echo $RESCUE_RAMDISK_FREE_SPACE &gt;$ROOTFS_DIR/etc/ramdisk-free-space

REQUIRED_PROGS+=(switch_root du)
KERNEL_CMDLINE+=" rdinit=/etc/scripts/ramdisk-rootfs"
</code></pre>
<h4 id="schlomo_commented_at_2023-02-21_1306"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438455385">2023-02-21 13:06</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-21_1306" title="Permanent link">&para;</a></h4>
<p>Sounds good, however I'd like to keep the size in MiB and not GiB</p>
<h4 id="jsmeix_commented_at_2023-02-21_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1438503415">2023-02-21 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-21_1335" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I think you misunderstood.<br />
The size should be in MiB because if it was in GiB then<br />
a conflict could appear what the value '1' means.<br />
In this particular case it would be even OK if<br />
the value '1' would mean both 'true' and '1 GiB'<br />
but at least this would look "hairy".</p>
<p>Furthermore any non-integer numbers call for problems<br />
and strings are the worst of all (because all what<br />
hardware can actually do is computing integers).</p>
<h4 id="jsmeix_commented_at_2023-02-22_0731"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1439552220">2023-02-22 07:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-22_0731" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I like your last ramdisk implementation via<br />
<a href="https://github.com/rear/rear/pull/2937/files/549cb99adb2566725310fbcfab6ec74c061fbde1..15b763af73e7ade480c6e226062bdb59efad0e01">https://github.com/rear/rear/pull/2937/files/549cb99adb2566725310fbcfab6ec74c061fbde1..15b763af73e7ade480c6e226062bdb59efad0e01</a><br />
very much because it keeps the simple boolean<br />
USE_RAMDISK="yes" vs. USE_RAMDISK="no" functionality<br />
where USE_RAMDISK="yes" creates a ramdisk with default size<br />
which helps the user if he cannot decide what the right size is<br />
and 50% of of physical RAM by default looks reasonable<br />
on nowadays systems with usually 4 GiB RAM and more because<br />
for me only 2 GiB RAM "just work" on my VMs for testing ReaR<br />
but normally I use a small ReaR recovery system of about 200 MiB, cf.<br />
<a href="https://github.com/rear/rear/discussions/2640#discussioncomment-908335">https://github.com/rear/rear/discussions/2640#discussioncomment-908335</a></p>
<h4 id="schlomo_commented_at_2023-02-22_0735"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1439555643">2023-02-22 07:35</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-22_0735" title="Permanent link">&para;</a></h4>
<p>@rear/contributors can you imagine any reason why we shouldn't be able
to remove support for older CommVault versions?</p>
<p>According to
<a href="https://ma.commvault.com/Support/ProductEOLMessages">https://ma.commvault.com/Support/ProductEOLMessages</a>
currently only GALAXY11 is actually supported by CommVault and users
with a legacy CommVault version probably also use a legacy Linux distro
and can also keep using their legacy ReaR version<br />
<img alt="image" src="https://user-images.githubusercontent.com/101384/220553111-36be61da-17e5-4638-b704-8d785f957156.png" /></p>
<p>Personally, I really would like to reduce the amount of <strong>untestable</strong>
and <strong>unmaintainable</strong> code in ReaR</p>
<h4 id="jsmeix_commented_at_2023-02-22_1025"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1439773886">2023-02-22 10:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-22_1025" title="Permanent link">&para;</a></h4>
<p>OK - let's be venturous here<br />
and disable support for older CommVault versions.</p>
<p>Note the different wording "remove" vs. "disable".</p>
<p>With "disable" I mean something like a new<br />
usr/share/rear/init/default/500_disable_deprecated.sh<br />
script that errors out for deprecated functionality<br />
so users can if needed modify that script<br />
to still use deprecated functionality<br />
until we actually remove the code.</p>
<p>For example<br />
(only an offhanded quick initial attempt):</p>
<pre><code># Error out for deprecated functionality.
# If really needed users may skip this:
#return 0

local deprecated_error=''

# As of this writing on Wed Feb 22 2023 according to
# https://ma.commvault.com/Support/ProductEOLMessages
# currently only GALAXY11 is actually supported by CommVault:
for deprecated_backup_galaxy in GALAXY GALAXY7 GALAXY10 ; do
    if test "$BACKUP" = $deprecated_backup_galaxy ; then
        LogPrintError "BACKUP=$deprecated_backup_galaxy is deprecated functionality"
        deprecated_error="yes"
    fi
done

is_true $deprecated_error || return 0
Error "Deprecated functionality is no longer supported"
</code></pre>
<p>Instead of using a local deprecated_error variable<br />
we may introduce a new DEPRECATED_ERROR user confing variable<br />
but then users may too easily set it to "no" without telling us<br />
that they really need this or that deprecated functionality?</p>
<h4 id="schlomo_commented_at_2023-02-22_1038"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1439793011">2023-02-22 10:38</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-22_1038" title="Permanent link">&para;</a></h4>
<p>I'm actually against this approach @jsmeix because it won't remove the
code from ReaR and that is my objective here: Getting rid of untested
and unmaintainable code.</p>
<p>What is bad with pointing users of old CommVault to either use old ReaR
or sponsor/contribute proper support in new ReaR? After all, it won't be
difficult to bring the scripts back from an older version, if needed. Or
somebody could extract them into an add-on that can be installed on top
of ReaR (ReaR was always meant to be extensible via dropping more files
into it), which would allow the truly interested parties to maintain
legacy CommVault support outside of our upstream development.</p>
<p>I'm really talking about upstream ReaR here, whatever we do won't affect
anybody with ReaR 2.7 installed.</p>
<h4 id="schlomo_commented_at_2023-02-22_1310"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1439992157">2023-02-22 13:10</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-22_1310" title="Permanent link">&para;</a></h4>
<p>I'll add the decrepation feature here as well, no problems. Good
discussion and arguments, especially from #2944</p>
<h4 id="schlomo_commented_at_2023-02-27_1854"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1446880461">2023-02-27 18:54</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-27_1854" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix for your thoughts. Here is the new deprecation feature:</p>
<h3 id="deprecation_error">deprecation error<a class="headerlink" href="#deprecation_error" title="Permanent link">&para;</a></h3>
<pre><code>[root@rear-ol8u7 rear]# rear -C g -v mkrescue
Relax-and-Recover 2.7 / Git
Running rear mkrescue (PID 61473 date 2023-02-27 19:27:45)
Using log file: /var/log/rear/rear-rear-ol8u7.log
Sourcing additional configuration file '/etc/rear/g.conf'
Running workflow mkrescue on the normal/original system
ERROR: Deprecation of &gt;galaxy10&lt;
Reason: CommVault Galaxy 10 is EOL since 2018 according to https://ma.commvault.com/Support/ProductEOLMessages

This feature or code path has been deprecated in ReaR and will
be removed eventually. If you disagree with that, then please
go to https://github.com/rear/rear/issues and create an issue
explaining for us why we should not deprecate this code path.

Meanwhile, in order to continue using this feature, you can add
DISABLE_DEPRECATION_ERRORS+=( galaxy10 )
to your ReaR configuration to disable this error.
Use debug mode '-d' for some debug messages or debugscript mode '-D' for full debug messages with 'set -x' output
Aborting due to an error, check /var/log/rear/rear-rear-ol8u7.log for details
Exiting rear mkrescue (PID 61473) and its descendant processes ...
Running exit tasks
Terminated
</code></pre>
<h3 id="deprecation_override">deprecation override<a class="headerlink" href="#deprecation_override" title="Permanent link">&para;</a></h3>
<pre><code>[root@rear-ol8u7 rear]# rear -C g -v mkrescue
Relax-and-Recover 2.7 / Git
Running rear mkrescue (PID 52094 date 2023-02-27 19:27:13)
Using log file: /var/log/rear/rear-rear-ol8u7.log
Sourcing additional configuration file '/etc/rear/g.conf'
Running workflow mkrescue on the normal/original system
Disabled deprecation error for &gt;galaxy10&lt;
Using autodetected kernel '/boot/vmlinuz-5.15.0-7.86.6.1.el8uek.x86_64' as kernel in the recovery system
...
</code></pre>
<h3 id="rear_dump_also_shows_it_and_-c_extra_configs_too">rear dump also shows it, and -C extra configs too<a class="headerlink" href="#rear_dump_also_shows_it_and_-c_extra_configs_too" title="Permanent link">&para;</a></h3>
<pre><code>[root@rear-ol8u7 rear]# rear -C g dump
# Begin dumping out configuration and system information:
# This is a 'Linux-x86_64' system, compatible with 'Linux-i386'.
# Configuration tree:
  # Linux-i386.conf : OK
  # GNU/Linux.conf : OK
  # Fedora.conf : missing/empty
  # Fedora/i386.conf : missing/empty
  # Fedora/8.7.conf : missing/empty
  # Fedora/8.7/i386.conf : missing/empty
  # RedHatEnterpriseServer.conf : missing/empty
  # RedHatEnterpriseServer/i386.conf : missing/empty
  # RedHatEnterpriseServer/8.7.conf : missing/empty
  # RedHatEnterpriseServer/8.7/i386.conf : missing/empty
  # site.conf : missing/empty
  # local.conf : OK
  # /etc/rear/g.conf : OK
# System definition:
  ARCH="Linux-i386"
  OS="GNU/Linux"
  OS_MASTER_VENDOR="Fedora"
  OS_MASTER_VERSION="8.7"
  OS_MASTER_VENDOR_ARCH="Fedora/i386"
  OS_MASTER_VENDOR_VERSION="Fedora/8.7"
  OS_MASTER_VENDOR_VERSION_ARCH="Fedora/8.7/i386"
  OS_VENDOR="RedHatEnterpriseServer"
  OS_VERSION="8.7"
  OS_VENDOR_ARCH="RedHatEnterpriseServer/i386"
  OS_VENDOR_VERSION="RedHatEnterpriseServer/8.7"
  OS_VENDOR_VERSION_ARCH="RedHatEnterpriseServer/8.7/i386"
  DISABLE_DEPRECATION_ERRORS=("galaxy10")
# Backup with GALAXY10:
  GALAXY10_BACKUPSET=""
  GALAXY10_Q_ARGUMENTFILE=""
...
</code></pre>
<h4 id="jsmeix_commented_at_2023-02-28_1007"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1447903595">2023-02-28 10:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-28_1007" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I like the new deprecation error functionality very much!</p>
<h4 id="schlomo_commented_at_2023-03-19_1210"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1475232964">2023-03-19 12:10</a>:<a class="headerlink" href="#schlomo_commented_at_2023-03-19_1210" title="Permanent link">&para;</a></h4>
<p>I updated this PR and would like to merge it now, happy to fix any small
stuff you see but bigger things will have to go into a follow-up PR as
this round of on-site testing is over.</p>
<h4 id="schlomo_commented_at_2023-03-19_1213"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2937#issuecomment-1475233505">2023-03-19 12:13</a>:<a class="headerlink" href="#schlomo_commented_at_2023-03-19_1213" title="Permanent link">&para;</a></h4>
<p>FYI, some of the changes (especially around copy-as-is logic) were
required to properly test ReaR without installing it each time.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-02-17.2937.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
