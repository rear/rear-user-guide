<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1975 Issue closed: Missing libraries in Rescue ISO causing executables to fail - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1975 Issue closed: Missing libraries in Rescue ISO causing executables to fail";
        var mkdocs_page_input_path = "issues/2018-11-20.1975.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1975 Issue closed: Missing libraries in Rescue ISO causing executables to fail</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1975_issue_closed_missing_libraries_in_rescue_iso_causing_executables_to_fail"><a href="https://github.com/rear/rear/issues/1975">#1975 Issue</a> <code>closed</code>: Missing libraries in Rescue ISO causing executables to fail<a class="headerlink" href="#1975_issue_closed_missing_libraries_in_rescue_iso_causing_executables_to_fail" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="rmetrich_opened_issue_at_2018-11-20_1603"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> opened issue at <a href="https://github.com/rear/rear/issues/1975">2018-11-20 16:03</a>:<a class="headerlink" href="#rmetrich_opened_issue_at_2018-11-20_1603" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): <strong>2.4 master</strong></p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"): <strong>RHEL7</strong></p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>COPY_AS_IS+=( /non-standard-dir/lib64/* )
#PROGS+=( /lib/udev/rename_device )
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>When adding programs into the Rescue ISO using <code>COPY_AS_IS</code> (typically
done when using NetBackup in real life) and the directories specified
contain files with same names as standard libraries (but likely at
different version), the corresponding standard libraries are not
included, causing some binaries that are added anyway to not be
usable.<br />
The related code is
<code>/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh</code>.<br />
However, if a program is specified using PROG, then the required system
libraries will be included anyway, because there is additional code
running in
<code>/usr/share/rear/build/GNU/Linux/390_copy_binaries_libraries.sh</code>.</p>
<h2 id="reproducer">Reproducer<a class="headerlink" href="#reproducer" title="Permanent link">&para;</a></h2>
<p>Create a non standard path and copy "libglib" into it:</p>
<pre><code># mkdir -p /non-standard-dir/lib64
# cp /lib64/libglib-2.0.so.0 /non-standard-dir/lib64/

# rear -dD mkrescue
...
There are binaries or libraries in the ReaR recovery system that need additional libraries
/usr/lib/udev/rename_device requires additional libraries
    libglib-2.0.so.0 =&gt; not found
/usr/lib/udev/udev-kvm-check requires additional libraries
    libglib-2.0.so.0 =&gt; not found
...

# find /tmp/rear.* -name "libglib*"
/tmp/rear.gg4yN2RSDWWhD1M/rootfs/non-standard-dir/lib64/libglib-2.0.so.0
</code></pre>
<p>We can see from there that <code>libglib-2.0.so.0</code> was not included, even
though it's a must for <code>/usr/lib/udev/rename_device</code>.</p>
<p>I'm currently investigating this.</p>
<h4 id="jsmeix_commented_at_2018-11-21_0939"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440598527">2018-11-21 09:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-21_0939" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
again many thanks for your continuous and careful testing<br />
that reveals such hidden bugs that only happen in special cases!</p>
<h4 id="jsmeix_commented_at_2018-11-21_0946"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440600852">2018-11-21 09:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-21_0946" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
I wonder about your reproducer:<br />
I think one cannot "just change" the actual libraries files<br />
without also adapting the dynamic linker configuration<br />
i.e. adapt dynamic linker config files like /etc/ld.so.conf<br />
and finally run <code>ldconfig</code> - or do I misunderstand it?</p>
<h4 id="rmetrich_commented_at_2018-11-21_0948"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440601587">2018-11-21 09:48</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-11-21_0948" title="Permanent link">&para;</a></h4>
<p>That's just an example. In real life, this happens when doing relaxed
COPY_AS_IS such as the one done for ... NetBackup ... :
<code>/usr/openv/lib</code> which contains unrelated libraries and probably
unneeded ones.</p>
<h4 id="jsmeix_commented_at_2018-11-21_1022"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440611871">2018-11-21 10:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-21_1022" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
your
<a href="https://github.com/rear/rear/pull/1976">https://github.com/rear/rear/pull/1976</a>
explains it all.<br />
It is a generic bug in ReaR.</p>
<h4 id="jsmeix_commented_at_2018-11-21_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440619873">2018-11-21 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-21_1047" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1976">https://github.com/rear/rear/pull/1976</a>
merged<br />
this issue should be fixed.</p>
<p>@rmetrich<br />
many thanks for your analysis what the root cause was and your fix!</p>
<h4 id="jsmeix_commented_at_2018-11-21_1353"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440669326">2018-11-21 13:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-21_1353" title="Permanent link">&para;</a></h4>
<p>I found a simple reproducer that emphasizes<br />
this generic bug (before the fix here) even more.</p>
<p>I only added to my etc/rear/local.conf</p>
<pre>
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/sbin/postfix /doesnotexist/usr/lib/postfix/libpostfix-global.so )
</pre>

<p>and "rear -D mkrescue" failed with</p>
<pre>
Testing that the recovery system in /tmp/rear.8eGP5wvyks7HAf1/rootfs contains a usable system
There are binaries or libraries in the ReaR recovery system that need additional libraries
/bin/postfix requires additional libraries (fatal error)
        libpostfix-global.so => not found
ReaR recovery system in '/tmp/rear.8eGP5wvyks7HAf1/rootfs' needs additional libraries, check /root/rear.github.master/var/log/rear/rear-g243.log for details
ERROR: ReaR recovery system in '/tmp/rear.8eGP5wvyks7HAf1/rootfs' not usable (required libraries are missing)
</pre>

<p>For me <code>ldd /usr/sbin/postfix</code> shows in particular</p>
<pre>
libpostfix-global.so => /usr/lib/postfix/libpostfix-global.so
</pre>

<p>but copying <code>/usr/lib/postfix/libpostfix-global.so</code> is skipped<br />
in build/GNU/Linux/100_copy_as_is.sh because<br />
the copy_as_is_filelist_file contains</p>
<pre>
tar: /doesnotexist/usr/lib/postfix/libpostfix-global.so: Cannot stat: No such file or directory
</pre>

<p>cf. the comment in build/GNU/Linux/100_copy_as_is.sh about<br />
"make it work fail-safe even in case of non-existent files in the
COPY_AS_IS array"</p>
<p>I.e. even files that failed to copy may have matched before this fix
here.</p>
<h4 id="rmetrich_commented_at_2018-11-21_1356"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/1975#issuecomment-440670050">2018-11-21 13:56</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-11-21_1356" title="Permanent link">&para;</a></h4>
<p>Good point!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-11-20.1975.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
