<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3451 Issue closed: SAS Ultrium9 tape drive: dd: error writing '/dev/nst0': Invalid argument - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3451 Issue closed: SAS Ultrium9 tape drive: dd: error writing \u0027/dev/nst0\u0027: Invalid argument";
        var mkdocs_page_input_path = "issues/2025-04-08.3451.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3451 Issue closed: SAS Ultrium9 tape drive: dd: error writing '/dev/nst0': Invalid argument</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3451_issue_closed_sas_ultrium9_tape_drive_dd_error_writing_devnst0_invalid_argument"><a href="https://github.com/rear/rear/issues/3451">#3451 Issue</a> <code>closed</code>: SAS Ultrium9 tape drive: dd: error writing '/dev/nst0': Invalid argument<a class="headerlink" href="#3451_issue_closed_sas_ultrium9_tape_drive_dd_error_writing_devnst0_invalid_argument" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>special hardware or VM</code></p>
<h4 id="debianguru_opened_issue_at_2025-04-08_1303"><img src="https://avatars.githubusercontent.com/u/63314820?v=4" width="50"><a href="https://github.com/DebianGuru">DebianGuru</a> opened issue at <a href="https://github.com/rear/rear/issues/3451">2025-04-08 13:03</a>:<a class="headerlink" href="#debianguru_opened_issue_at_2025-04-08_1303" title="Permanent link">&para;</a></h4>
<h3 id="requesting_support_or_just_a_question">Requesting support or just a question<a class="headerlink" href="#requesting_support_or_just_a_question" title="Permanent link">&para;</a></h3>
<p>Is this a blocksize issue?</p>
<h3 id="platform">Platform<a class="headerlink" href="#platform" title="Permanent link">&para;</a></h3>
<p>Debian12,<br />
rear installed from Debian repository.<br />
Relax-and-Recover 2.7 / Git.<br />
New Lenovo Server with Ultrium9 SAS drive.</p>
<p>See the info in<br />
<a href="https://github.com/rear/rear/issues/3448">https://github.com/rear/rear/issues/3448</a></p>
<h3 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h3>
<p>I'm new to rear with tape storage.</p>
<p>I am trying to backup to my new tape drive and getting the error above.</p>
<p>I looked at dmesg and saw</p>
<pre><code>st 1:0:0:0: [st0] Write not multiple of tape block size.
</code></pre>
<p>a few times.</p>
<p>Makes me think there's a "mismatch" between whatever block size rear is
trying to use vs what my tape drive wants.</p>
<p>I can't seem to find the answer or if I'm on the right track.</p>
<h4 id="jsmeix_commented_at_2025-04-09_0717"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2788586530">2025-04-09 07:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-04-09_0717" title="Permanent link">&para;</a></h4>
<p>@DebianGuru<br />
in usr/share/rear/conf/default.conf there is</p>
<pre><code># Tape block size, default is to leave it up to the tape-device:
TAPE_BLOCKSIZE=
</code></pre>
<p>Perhaps setting this appropriately helps?</p>
<h4 id="debianguru_commented_at_2025-04-16_1422"><img src="https://avatars.githubusercontent.com/u/63314820?v=4" width="50"><a href="https://github.com/DebianGuru">DebianGuru</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2809755375">2025-04-16 14:22</a>:<a class="headerlink" href="#debianguru_commented_at_2025-04-16_1422" title="Permanent link">&para;</a></h4>
<p>If this help, I saw in the logs, that the command that was running to
backup was:</p>
<p><code>tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.dOwUF559mjej0dx/tmp/backup-exclude.txt -C / -c -f - /home / /tmp /var /boot/efi /boot /var/log/rear/rear-wn-kvm01-pri.281105.log | dd of=/dev/nst0 bs=1M</code></p>
<p>So I pasted it directly to bash. It fails with "dd: error writing
'/dev/nst0': Invalid argument"</p>
<p>I see from this command that tar is outputting to stdout with the "-f -
" then piping that to the "dd" command. So I did a bit of testing.
Skipping the piping to dd an writing directly to tape like so:<br />
<code>tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.dOwUF559mjej0dx/tmp/backup-exclude.txt -C / -c -f /dev/nst0 /home / /tmp /var /boot/efi /boot /var/log/rear/rear-wn-kvm01-pri.281105.log</code><br />
runs just fine and throws no errors.</p>
<p>I also discovered that just removing the '--gzip' switch in tar allowed
me to run it like so:<br />
<code>tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls -X /var/tmp/rear.dOwUF559mjej0dx/tmp/backup-exclude.txt -C / -c -f - /home / /tmp /var /boot/efi /boot /var/log/rear/rear-wn-kvm01-pri.281105.log | dd of=/dev/nst0 bs=1M</code><br />
Again, this works with no errors.</p>
<p>So it appear that running tar with gzip, then piping it out through dd
is causing an issue.</p>
<p>I then followed up by modifying the two previous examples by replacing
"-f /dev/nst0" with "-f /root/backup.tar.gz" in the first example. In
the second example, I replaced "of=/dev/nst0" with
"of=/root/backup2.tar.gz". Both times, these ran fine and generated an
appropriate .tar.gz file.</p>
<p>So it appears, that the combination of --gzip and dd only fail with a
tape drive. If you output to a hard drive, they work fine. Any guesses?</p>
<p>Is there a reason the default is to pipe the output of tar throught dd
rather than just writing to my tape?</p>
<h4 id="jsmeix_commented_at_2025-04-16_1529"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2809953210">2025-04-16 15:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-04-16_1529" title="Permanent link">&para;</a></h4>
<p>I think the script which makes the backup in your case is<br />
usr/share/rear/backup/NETFS/default/500_make_backup.sh</p>
<p>See therein the comment:</p>
<pre><code># Check if the backup needs to be split or not (on multiple ISOs).
# Dummy split command when the backup is not split (the default case).
# Let 'dd' read and write up to 1M=1024*1024 bytes at a time to speed up things
# for example from only 500KiB/s (with the 'dd' default of 512 bytes)
# via a 100MBit network connection to about its full capacity
# cf. https://github.com/rear/rear/issues/2369
SPLIT_COMMAND="dd of=$backuparchive bs=1M"
</code></pre>
<p>Perhaps a tape drive does not like up to 1MiB at once?</p>
<p>Meanwhile I think that in "man rear"<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a><br />
the part</p>
<pre><code>When using BACKUP=NETFS you must provide the backup target location
through the BACKUP_URL variable. Possible BACKUP_URL settings are:
...
BACKUP_URL=tape://
To backup to tape device, use BACKUP_URL=tape:///dev/nst0
or alternatively, simply define TAPE_DEVICE=/dev/nst0
</code></pre>
<p>could have become meanwhile outdated and be no longer valid<br />
because I think ReaR with tape devices is no longer tested<br />
since a long time and also it is likely no longer used since<br />
a long time - in particular not recent ReaR versions.<br />
Perhaps there are some users who still use old ReaR versions<br />
which work for their tape devices since a long time?</p>
<h4 id="gdha_commented_at_2025-04-19_0556"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2816557345">2025-04-19 05:56</a>:<a class="headerlink" href="#gdha_commented_at_2025-04-19_0556" title="Permanent link">&para;</a></h4>
<p>@DebianGuru As you mentioned that backup to tape works fine without
<code>--gzip</code> you can make it work by defining in your <code>/etc/rear/local.conf</code>
the following:</p>
<pre><code>BACKUP_PROG_COMPRESS_OPTIONS=( )
</code></pre>
<p>(see the details in the <code>/usr/share/rear/conf/default.conf</code>)</p>
<h4 id="gdha_commented_at_2025-04-24_1348"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2827699202">2025-04-24 13:48</a>:<a class="headerlink" href="#gdha_commented_at_2025-04-24_1348" title="Permanent link">&para;</a></h4>
<p>@DebianGuru can you confirm above statement please?</p>
<h4 id="gdha_commented_at_2025-04-29_1403"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2839055115">2025-04-29 14:03</a>:<a class="headerlink" href="#gdha_commented_at_2025-04-29_1403" title="Permanent link">&para;</a></h4>
<p>@DebianGuru could you show us your <code>/etc/rear/local.conf</code> file?</p>
<h4 id="debianguru_commented_at_2025-04-29_1443"><img src="https://avatars.githubusercontent.com/u/63314820?v=4" width="50"><a href="https://github.com/DebianGuru">DebianGuru</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2839199213">2025-04-29 14:43</a>:<a class="headerlink" href="#debianguru_commented_at_2025-04-29_1443" title="Permanent link">&para;</a></h4>
<p>@gdha ,<br />
I kind of abandoned the efforts out of frustration. As it turns out, my
need (to backup a bare-metal level kvm hypervisor) was met by using Rear
onto a flash drive. The big data (the VMs) are being sent to the tape
drive via tar. I really do appreciate your help and effort. And yes, at
one point, I did try using BACKUP_PROG_COMPRESS_OPTIONS=( ). It just
seemed like if I could get a backup to run, then the restore would
refuse to run. In the end, I'm using Rear with a USB flash and the
backup and recovery work great. Thanks again for your help.</p>
<h4 id="jsmeix_commented_at_2025-04-30_0722"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2841051182">2025-04-30 07:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-04-30_0722" title="Permanent link">&para;</a></h4>
<p>@DebianGuru</p>
<p>I think you did "the excat right thing" by separating<br />
disaster recovery of the basic operating system<br />
from restore of the big data, cf.<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Basics">https://en.opensuse.org/SDB:Disaster_Recovery#Basics</a><br />
(excerpt)</p>
<pre><code>In this particular case "disaster recovery" means
to recreate the basic operating system
(i.e. what you had initially installed from an
... Linux ... install medium).

In particular special third party applications
(e.g. a third party database system which often requires
special actions to get it installed and set up)
must usually be recreated in an additional separate step.
</code></pre>
<p>In your case the basic operating system<br />
is the KVM host system (the hypervisor)<br />
and the "special third party applications"<br />
are the VMs on that KVM host system.</p>
<p>In general I recommend to not have big data<br />
in the backup which is meant for disaster recovery<br />
because when you have big data in the backup<br />
which is meant for disaster recovery, then<br />
the disaster recovery process takes very long<br />
(restoring the backup takes most of the time)<br />
until you have your basic system back.</p>
<p>Furthermore I think a huge "all-in-one" backup<br />
may have a higher likelihood to fail<br />
(during backup and in particular during restore)<br />
than several separated backups, e.g. in your case<br />
one backup for the basic operating system<br />
and as needed separated backups for the VMs, cf.<br />
<a href="https://github.com/rear/rear/pull/3177#issuecomment-1985926458">https://github.com/rear/rear/pull/3177#issuecomment-1985926458</a></p>
<p>Finally I think several separated backups<br />
are easier to handle in practice because<br />
you can backup separated things individually as needed,<br />
e.g. in your case you can backup the basic operating system<br />
as needed independent of backups of the VMs as needed, cf.<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore">https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore</a><br />
(excerpts)</p>
<pre><code>after each change of the basic system
(in particular after a change of the disk layout)
"rear mkbackup" needs to be run to create
a new ReaR recovery system together with
a matching new backup of the files
(or when third party backup software is used
"rear mkrescue" needs to be run to create
a new ReaR recovery system and additionally
a matching new backup of the files must be created).
</code></pre>
<h4 id="jsmeix_commented_at_2025-05-23_0752"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3451#issuecomment-2903589992">2025-05-23 07:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-05-23_0752" title="Permanent link">&para;</a></h4>
<p>From what I wrote above in<br />
<a href="https://github.com/rear/rear/issues/3451#issuecomment-2841051182">https://github.com/rear/rear/issues/3451#issuecomment-2841051182</a><br />
I derived a new part</p>
<pre><code>ReaR versus "big data" backup
</code></pre>
<p>in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore">https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2025-04-08.3451.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
