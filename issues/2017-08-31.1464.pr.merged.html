<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1464 PR merged: Implement new YUM backup method (based on ZYPPER) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1464 PR merged: Implement new YUM backup method (based on ZYPPER)";
        var mkdocs_page_input_path = "issues/2017-08-31.1464.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1464 PR merged: Implement new YUM backup method (based on ZYPPER)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1464_pr_merged_implement_new_yum_backup_method_based_on_zypper"><a href="https://github.com/rear/rear/pull/1464">#1464 PR</a> <code>merged</code>: Implement new YUM backup method (based on ZYPPER)<a class="headerlink" href="#1464_pr_merged_implement_new_yum_backup_method_based_on_zypper" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="n3wwn_opened_issue_at_2017-08-31_1811"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> opened issue at <a href="https://github.com/rear/rear/pull/1464">2017-08-31 18:11</a>:<a class="headerlink" href="#n3wwn_opened_issue_at_2017-08-31_1811" title="Permanent link">&para;</a></h4>
<p>Hi!</p>
<p>This is my first major commit to this project, so I hope that I'm doing
this correctly.</p>
<p>This PR is to add a YUM backup method which will recreate a RPM-based
system that uses the yum package manager in the same manner as the
ZYPPER backup method.</p>
<p>I symlinked files where possible and copied and updated files when
changes were necessary for the YUM method.</p>
<p>I have also updated a couple of existing files to [hopefully] improve
them. The primary changes which could likely be made common to all
methods are:</p>
<ul>
<li>
<p>usr/share/rear/rescue/default/500_ssh.sh</p>
<ul>
<li>improved detection of the ssh user and don't duplicate an
    existing user</li>
</ul>
</li>
<li>
<p>usr/share/rear/rescue/default/900_clone_users_and_groups.sh</p>
<ul>
<li>improve extraction of users and groups and don't duplicate an
    existing user</li>
</ul>
</li>
<li>
<p>usr/share/rear/restore/YUM/default/405_clone_users_and_groups.sh</p>
<ul>
<li>clone the users and groups only if the same user or group does
    not exist. Previously, the entire line had to match, resulting
    in duplicate entries if, for instance, the UID differed for the
    same user.</li>
</ul>
</li>
<li>
<p>usr/share/rear/restore/YUM/default/940_generate_fstab.sh</p>
<ul>
<li>improve detection of existing fstab entries to avoid duplication</li>
</ul>
</li>
</ul>
<p>If you'd prefer that I submit separate PRs for each, please let me know.</p>
<p>Upon acceptance of the YUM method, I will submit another PR which adds a
file backup option to the YUM method. This will recreate the system from
RPM and restore any non-RPM-originated files or RPM-originated files
which may have changed (or been removed).</p>
<p>Let me know if there's a better way for me to submit changes of this
type or if there's anything I can do to help with the acceptance of this
PR.</p>
<p>Thanks!</p>
<p>-Rich Alloway (Rogue Wave)</p>
<h4 id="jsmeix_commented_at_2017-09-01_1200"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326562786">2017-09-01 12:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-01_1200" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
wow!<br />
Many thanks for that!</p>
<p>Because I made the current (rather initial and experimental)<br />
support for 'ZYPPER' I assign your pull request to me.</p>
<p>I added the other ReaR upstream members as reviewers<br />
in particular because your pull request also contains<br />
changes in other general files.</p>
<p>Regarding your other PR which adds a file backup option<br />
to the YUM method:<br />
I look forward to seeing it because this is what I<br />
also like to implement for the 'ZYPPER' method.<br />
For me a main purpose of restoring files from a backup<br />
after the initial RPM installation is to provide ready-made<br />
config-files so that afterwards the system is ready-to-use.<br />
This method is also done by the KIWI image installation, cf.<br />
<a href="https://en.wikipedia.org/wiki/KIWI_%28openSUSE%29">https://en.wikipedia.org/wiki/KIWI_%28openSUSE%29</a><br />
After the initial KIWI image installation a tar.gz archive<br />
with ready-mde config-files (or whatever other files)<br />
can get installed (optionally).</p>
<h4 id="jsmeix_commented_at_2017-09-01_1236"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326568980">2017-09-01 12:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-01_1236" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
I noticed a few</p>
<pre>
    Debug "WARNING: ..."
</pre>

<p>I wonder if a warning as a debug message makes much sense.<br />
I think - if at all - warnings are meant directly for the user?<br />
For background information about warnings in general see<br />
<a href="http://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">http://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a></p>
<h4 id="jsmeix_commented_at_2017-09-01_1249"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326571589">2017-09-01 12:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-01_1249" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
in your restore/YUM/default/405_clone_users_and_groups.sh</p>
<p>In general instead of things like</p>
<pre>
if [[ "$CLONE_ALL_USERS_GROUPS" =~ ^[yY1] ]]; then
</pre>

<p>use</p>
<pre>
if is_true "$CLONE_ALL_USERS_GROUPS" ; then
</pre>

<p>cf. "Relax-and-Recover functions" at<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>For me it looks af if you misunderstood or misuse how<br />
CLONE_USERS CLONE_GROUPS CLONE_ALL_USERS_GROUPS<br />
are meant to be used.<br />
As far as I understand it those are meant to copy<br />
users and groups from the original system<br />
where "rear mkrescue/mkbackup" runs into the<br />
ReaR recovery system but those variables are not meant<br />
to copy users and groups during "rear recover"<br />
into the recreated system.<br />
Or I misunderstand how your<br />
restore/YUM/default/405_clone_users_and_groups.sh<br />
is meant in your use-case.</p>
<h4 id="jsmeix_commented_at_2017-09-01_1255"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326572818">2017-09-01 12:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-01_1255" title="Permanent link">&para;</a></h4>
<p>Nice!<br />
This way it became clear that<br />
rescue/default/900_clone_users_and_groups.sh<br />
(last actual code change dated 2013)<br />
also needs some code cleanup.<br />
In particular the "WARNING" messages therein<br />
had been implemented in 2009 by @schlomo himself ;-)<br />
provided</p>
<pre>
git log -p --follow usr/share/rear/rescue/default/900_clone_users_and_groups.sh
</pre>

<p>tells the truth.</p>
<h4 id="jsmeix_commented_at_2017-09-01_1305"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326574931">2017-09-01 13:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-01_1305" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
you wrote</p>
<pre>
YUM backup method which will recreate a RPM-based system
that uses the yum package manager in the same manner
as the ZYPPER backup method
</pre>

<p>The "recreate" therein might be a misunderstanding about the<br />
actual primary idea behind the ZYPPER "backup" method:</p>
<p>See<br />
<a href="https://github.com/rear/rear/issues/1085">https://github.com/rear/rear/issues/1085</a><br />
that reads (excerpt)</p>
<pre>
the new BACKUP=ZYPPER method is intended
to ... "install a system from scratch"
.
.
.
also use ReaR generically for all kind of installations
.
.
.
ReaR system deployment
</pre>

<p>and<br />
<a href="https://hackweek.suse.com/15/projects/2242">https://hackweek.suse.com/15/projects/2242</a><br />
and<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Using_ReaR_as_generic_installer_in_any_installation_system">https://en.opensuse.org/SDB:Disaster_Recovery#Using_ReaR_as_generic_installer_in_any_installation_system</a></p>
<h4 id="n3wwn_commented_at_2017-09-01_1540"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326613824">2017-09-01 15:40</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-01_1540" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Looks like I can't respond to each msg, so I'll have to do so all at
once :)</p>
<blockquote>
<p>Regarding your other PR which adds a file backup option<br />
to the YUM method:<br />
I look forward to seeing it because this is what I<br />
also like to implement for the 'ZYPPER' method.<br />
For me a main purpose of restoring files from a backup<br />
after the initial RPM installation is to provide ready-made<br />
config-files so that afterwards the system is ready-to-use.<br />
This method is also done by the KIWI image installation</p>
</blockquote>
<p>Though I wasn't aware of KIWI before now, I could definitely see this as
an option using BACKUP_PROG_INCLUDE/BACKUP_PROG_EXCLUDE!</p>
<p>My goal was to be able to have as small of a backup ISO as possible but
with a complete system restore. The versions of the packages may change
since we're installing from YUM repos, but I haven't seen it as a
problem with the CentOS 6.x and CentOS 7.x testing that I've done,
purposely using older 6.x and 7.x VMs that were restored with the latest
RPMs from the public repos.</p>
<p>I make VMs a LOT for supporting our customers and would like to be able
to take a full system backup without storing all of the files that are
the same as what is in the RPMs so that I can destroy the VM and have a
minimal-size backup. I used to use ReaR to make full backups:</p>
<p><code>OUTPUT=ISO</code><br />
<code>BACKUP=NETFS</code><br />
<code>BACKUP_PROG=tar</code><br />
<code>BACKUP_URL=iso://backup</code><br />
<code>OUTPUT_URL=null</code></p>
<p>That method took 2.7GB of dynamic disk and turned it into about a 1.4GB
ISO.</p>
<p>The same 2.7GB of dynamic disk, but with BACKUP=YUM is now a 210MB ISO.
:)</p>
<blockquote>
<p>Debug "WARNING: ..."</p>
</blockquote>
<p>Those were in the original files that I modified, but can certainly
strip them out or alter them to be included in the log only.</p>
<p>We can keep the history of those Debug messages between ourselves. ;)</p>
<blockquote>
<p>CLONE_ALL_USERS_GROUPS</p>
</blockquote>
<p>The <code>if</code> statement there was also originally from the code I cloned out
of the ReaR repo
(usr/share/rear/rescue/default/900_clone_users_and_groups.sh), but
can adjust it to use <code>is_true</code>.</p>
<p>I saw that the users/groups were being cloned into the rescue system and
just carried that forward to cloning from the rescue system into the
restore system.</p>
<p>My reasoning being that, since the system was installed from scratch via
RPM, which causes the user and group IDs sometimes change (they did in
my testing), the files will be restored with the wrong UID and/or GID
during the file restore (which will be included a later PR). Instead of
completely reinventing the wheel, I just painted it a different color.
:)</p>
<blockquote>
<p>YUM backup method which will recreate a RPM-based system<br />
that uses the yum package manager in the same manner<br />
as the ZYPPER backup method</p>
</blockquote>
<p>Would it be better to say
<code>YUM backup method which will recreate a RPM-based system that uses the yum package manager in a _similar_ manner as the ZYPPER backup method</code>?<br />
Or perhaps
<code>YUM backup method will install a system from scratch in a _similar_ manner as the ZYPPER backup method, but utilizing the yum package manager</code>?</p>
<p>As it sits now, with the exception of the cloning of users and groups, I
think that the YUM method is behaving the same as the ZYPPER method (but
without the repository specification), but I may be missing something as
I've not used ZYPPER itself very much.</p>
<p>Thanks for all of the feedback so far! I'm excited to contribute and am
thrilled that you seem to be equally excited about my contribution! :)</p>
<p>Just let me know how you'd like me to proceed...</p>
<h4 id="jsmeix_commented_at_2017-09-04_1555"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-326992901">2017-09-04 15:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-04_1555" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
many thanks for your descriptions.</p>
<p>Your use case (get the backup smaller) is very interesting!<br />
As YUM and ZYPPER backup methods work basically same<br />
(o.k. - I need to add backup support to ZYPPER)<br />
your use-case also applies for ZYPPER.<br />
I think we should keep how YUM and ZYPPER work the same<br />
as much as we can because I do not see any reason why<br />
they should behave really different for the user.</p>
<p>Regarding clone_users_and_groups I did right now<br />
<a href="https://github.com/rear/rear/pull/1471">https://github.com/rear/rear/pull/1471</a><br />
which will conflict with your changes in<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
I would appreciate it if you have a look if<br />
<a href="https://github.com/rear/rear/pull/1471">https://github.com/rear/rear/pull/1471</a><br />
works o.k. for you or if I did something wrong.</p>
<p>Regarding using the CLONE_USERS CLONE_GROUPS<br />
CLONE_ALL_USERS_GROUPS also to clone them<br />
from the recovery system into the recreated system:<br />
I do not like that duplicated usage.<br />
I would very much prefer to keep separated things separated<br />
(cf. RFC 1925 item 5:
<a href="https://www.ietf.org/rfc/rfc1925.txt">https://www.ietf.org/rfc/rfc1925.txt</a>
).<br />
In this case I think all what is needed is a new config variable<br />
e.g. named RECREATE_USERS_GROUPS=yes/no<br />
so that the user can specify whether or not he really<br />
wants to have all the users and groups from the<br />
recovery system also in the recreated system.</p>
<h4 id="jsmeix_commented_at_2017-09-05_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327129008">2017-09-05 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-05_0954" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
I think we can move forward a lot<br />
if you could split this pull request into parts:</p>
<p>One main part with all what is strictly additional<br />
(i.e. what cannot change any existing behaviour)<br />
which is - as far as I see - all except your changes in<br />
usr/share/rear/rescue/default/500_ssh.sh<br />
and<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
This main part only adds the YUM backup method<br />
and I can and would like to "just merge" it as is<br />
because it is your code and you tested it and<br />
I assume in case of issues with the YUM backup method<br />
you would fix issues there (i.e. you maintain your own code).</p>
<p>The rest which might possibly change any existing behaviour<br />
should be in separated pull requests i.e. your changes in<br />
usr/share/rear/rescue/default/500_ssh.sh<br />
and<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
because changes in existing scripts can cause<br />
some discussion until all is clear.</p>
<p>Because I assume your changes in<br />
usr/share/rear/rescue/default/500_ssh.sh<br />
are independent of your changes in<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
I would recommend to do two additional and separated<br />
new pull requests for them.</p>
<p>It seems your changes in<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
would be mostly obsoleted when I merge my<br />
<a href="https://github.com/rear/rear/pull/1471">https://github.com/rear/rear/pull/1471</a><br />
and if not you may prefer to do a follow-up pull request later<br />
based on my
<a href="https://github.com/rear/rear/pull/1471">https://github.com/rear/rear/pull/1471</a></p>
<h4 id="jsmeix_commented_at_2017-09-05_1016"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327133801">2017-09-05 10:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-05_1016" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
mostly out of curiosity:<br />
I do not yet understand the actual reason why you need<br />
this double cloning of users/gropus.<br />
You wrote that your reasoning is "that, since the system<br />
was installed from scratch via RPM, which causes the<br />
user and group IDs sometimes change".<br />
I understand this as if user and group IDs sometimes change<br />
in /etc/passwd and /etc/group after RPM installation<br />
and with your double cloning of users/gropus you fix that.<br />
But I would expect that basically all in /etc/ is in the backup<br />
so that after backup restore you should have the right<br />
/etc/passwd and /etc/group - or what do I misunderstand?</p>
<h4 id="n3wwn_commented_at_2017-09-05_1925"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327277722">2017-09-05 19:25</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-05_1925" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I was wondering if I should have broken up the PRs into much smaller
bites, and I guess I should have. ;)</p>
<p>I believe that we should be able to add file backups to ZYPPER by
symlinking to the appropriate files in the YUM tree.</p>
<p>IIRC, I kept the file backups and RPM backups segregated completely
since I planned on separate PRs for those two segments of the feature.</p>
<p>The changes to
usr/share/rear/rescue/default/900_clone_users_and_groups.sh look
good and appear to address the issues I saw with duplicate users and
groups.</p>
<blockquote>
<p>Regarding using the CLONE_USERS CLONE_GROUPS<br />
CLONE_ALL_USERS_GROUPS also to clone them<br />
from the recovery system into the recreated system:<br />
I do not like that duplicated usage.<br />
I would very much prefer to keep separated things separated</p>
</blockquote>
<p>For the new configuration item, RECREATE_USERS_GROUPS=yes/no, do you
think that would be best set up per backup method? i.e.
YUM_RECREATE_USERS_GROUPS and ZYPPER_RECREATE_USERS_GROUPS?</p>
<p>Would it be appropriate to duplicate the code from
usr/share/rear/rescue/default/900_clone_users_and_groups.sh in
usr/share/rear/restore/YUM/default/405_clone_users_and_groups.sh
(basically as it is now) but using the new RECREATE_USERS_GROUPS
config item?</p>
<p>Or would it be preferred that this code be extracted as functions in a
library?</p>
<p>Duplicating the code will allow us to more easily merge the main YUM
feature code as it won't touch any existing code, but, by definition,
duplicates code in a project.</p>
<blockquote>
<p>I assume in case of issues with the YUM backup method<br />
you would fix issues there (i.e. you maintain your own code).</p>
</blockquote>
<p>Yes, not a problem at all. I'm totally on-board with ongoing support of
the changes.</p>
<p>Do I need to "unpull" #1464 or anything to break it into 3 distinct PRs
(YUM, usr/share/rear/rescue/default/500_ssh.sh and
usr/share/rear/rescue/default/900_clone_users_and_groups.sh)?</p>
<h4 id="n3wwn_commented_at_2017-09-05_2004"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327287675">2017-09-05 20:04</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-05_2004" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>mostly out of curiosity:<br />
I do not yet understand the actual reason why you need<br />
this double cloning of users/gropus.<br />
You wrote that your reasoning is "that, since the system<br />
was installed from scratch via RPM, which causes the<br />
user and group IDs sometimes change".<br />
I understand this as if user and group IDs sometimes change<br />
in /etc/passwd and /etc/group after RPM installation<br />
and with your double cloning of users/gropus you fix that.<br />
But I would expect that basically all in /etc/ is in the backup<br />
so that after backup restore you should have the right<br />
/etc/passwd and /etc/group - or what do I misunderstand?</p>
</blockquote>
<p>The issues derived from how/where user IDs and group IDs are stored and
how they differ on the three systems involved: the source system, the
rescue/recovery system and the target system.</p>
<p>Let's say that we have 2 system users sshd and postfix (users randomly
picked, this issue <em>may</em> not show up with these particular users,
especially since these users may have predefined UIDs on many systems).</p>
<p>On the source system, postfix was installed with the OS and ssh was
added later, so let's say that postfix has a UID of 80 and sshd has a
UID of 90. From the tar info pertaining to the <code>--same-owner</code> parameter:</p>
<blockquote>
<p>When writing an archive, 'tar' writes the user ID and user name<br />
separately. If it can't find a user name (because the user ID is<br />
not in '/etc/passwd'), then it does not write one. When restoring,<br />
it tries to look the name (if one was written) up in '/etc/passwd'.<br />
If it fails, then it uses the user ID stored in the archive<br />
instead.</p>
</blockquote>
<p>This means the archive contains stuff like /etc/ssh/sshd_config with a
user of sshd and a UID of 90 and /var/lib/postfix/master.lock with a
user of postfix and a UID of 80.</p>
<p>On the target system, we reinstall the RPMs and the UIDs no longer
match... let's say sshd is now UID 80 and postfix is now UID 90.</p>
<p>We perform the file restore on the rescue/recovery system, which thinks
these users have their original IDs, funny things can happen, even if we
chroot into the target system to do the file restore.</p>
<p>I fought with this for days; only a few files would have incorrect
ownership and/or SELinux contexts after an otherwise successful restore.
Usually, the system would be usable, but I just wasn't content with
having the differences.</p>
<p>rear/usr/share/rear/restore/YUM/default/405_clone_users_and_groups.sh
actually excludes /etc/passwd, /etc/group and /etc/shadow from being
restored. We still include them in the archive so we can see the
contents later if we need to reference them, though.</p>
<p>The reason for excluding them from the restore goes along with these
other issues... if any UID or GID change or are otherwise different
between the source and target systems, the UID and GID on the target
system disk won't match the UID and/or GID specified in the files in
/etc.</p>
<p>Let me know if my rambling is making sense or if I need to dig up the
exact circumstances where the issues arose.</p>
<h4 id="jsmeix_commented_at_2017-09-06_0948"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327433717">2017-09-06 09:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-06_0948" title="Permanent link">&para;</a></h4>
<p>To get your YUM backup method merged, just leave out the<br />
usr/share/rear/rescue/default/500_ssh.sh<br />
and<br />
usr/share/rear/rescue/default/900_clone_users_and_groups.sh<br />
files from this pull request.<br />
I think (but not tested) it should work when you copy the current<br />
ones from current ReaR upstream over your changed ones<br />
in your git checkout branch for this pull request<br />
so that there are no longer changes in those files and then<br />
redo a "git push ..." which updates this pull request.</p>
<p>Regarding symlinking YUM and ZYPPER scripts:</p>
<p>I would prefer to wait with symlinking YUM and ZYPPER scripts<br />
until both implementations stabilized because currently<br />
both are unfinished and work-in-progress so that I would prefer<br />
that you can "just change what you like" in your YUM scripts<br />
and I can "just change what I like" in my ZYPPER scripts<br />
(i.e. so that we both are free in what we develop).<br />
I am curious what I can learn from your YUM scripts<br />
that is also useful for my ZYPPER scripts.<br />
Later when we found out which scripts are really same<br />
and work stable we can link them where we must decide<br />
who becomes the main-maintainer of a script (i.e. the<br />
one who maintains the actual script - not the symlink).</p>
<p>Regarding "double-clone-users-and-groups":</p>
<p>Many thanks for your descriptive and explanatory<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-327287675">https://github.com/rear/rear/pull/1464#issuecomment-327287675</a><br />
where you describe that your "double-clone-users-and-groups"<br />
functionality is a generically useful functionality.</p>
<p>If I understand it correctly wrong numerical user IDs<br />
and/or wrong numerical group IDs might even happen with<br />
any backup restore software. Not only with 'tar' and not limited<br />
to a particular backup method like YUM or ZYPPER because<br />
any backup restore software runs "inside" the ReaR recovery<br />
system with the users and groups there and not with the<br />
users and groups of the original system.</p>
<p>Accordingly - as far as I see probably even by default - the<br />
ReaR recovery system should contain all users and groups<br />
of the original system to ensure any backup restore software<br />
can restore the files with the right user names and IDs<br />
and group names and IDs.<br />
This would mean another general enhancement of the current<br />
rescue/default/900_clone_users_and_groups.sh<br />
functionality.</p>
<p>In particular for the backup methods YUM and ZYPPER<br />
your "double-clone-users-and-groups" functionality<br />
is additionally needed but I do not see why that<br />
"double-clone-users-and-groups" functionality must be<br />
limited to only the backup methods YUM and ZYPPER.</p>
<p>I would implement a generic RECREATE_USERS_GROUPS<br />
functionality that must be by default disabled in default.conf<br />
to avoid behavioural changes (i.e. stay backward compatible).</p>
<p>I would recommend to implement RECREATE_USERS_GROUPS<br />
as a bash array to be prepared for future enhancements,<br />
cf. how the MODULES and FIRMWARE_FILES arrays work.</p>
<p>Instead of restore/YUM/default/405_clone_users_and_groups.sh<br />
use e.g. restore/default/395_recreate_users_and_groups.sh<br />
that starts with something like:</p>
<pre>
# 395_recreate_users_and_groups.sh
#
# Recreate the same users and groups that exist
# in the ReaR recovery system also in the target system.

# Skip if not needed.
# For the 'test' one must have all array members
# as a single word i.e. "${name[*]}" because
# it should succeed when there is any non-empty
# array member, not necessarily the first one:
test "${RECREATE_USERS_GROUPS[*]}" || return
</pre>

<p>I think the script number must be less than the script number<br />
of the script that actually restores the backup which is<br />
usually 400_restore_clone.sh because otherwise<br />
"Excluding group, password and shadow files from restore"<br />
cannot work because that must happen before the backup<br />
gets restored.</p>
<p>Check the "rear -s recover" output in which ordering the<br />
scripts will be actually sourced (i.e. run) in your case.</p>
<p>Alternatively if NNN_recreate_users_and_groups.sh<br />
should run after the backup was restored<br />
(e.g. to ensure that the backup restore cannot overwrite<br />
etc/passwd etc/group etc/shadow that was writen by<br />
the NNN_recreate_users_and_groups.sh script)<br />
you can use BACKUP_RESTORE_MOVE_AWAY<br />
to move the restored etc/passwd etc/group etc/shadow<br />
files away, see its description in default.conf<br />
but note that the BACKUP_RESTORE_MOVE_AWAY<br />
functionality is run very late in the 'restore' stage as<br />
restore/default/990_move_away_restored_files.sh<br />
so that the NNN_recreate_users_and_groups.sh script<br />
would have to run after that e.g. as<br />
restore/default/993_recreate_users_and_groups.sh<br />
or perhaps even better it should run in the 'finalize' stage<br />
where all such final clean up tasks are done - preferably<br />
very early in the 'finalize' stage to ensure the right<br />
user names and IDs and group names and IDs<br />
are there for the other 'finalize' scripts.</p>
<p>In any case also the implementation of a generic<br />
RECREATE_USERS_GROUPS functionality<br />
should be submitted as a separated pull request.</p>
<p>Until a generic RECREATE_USERS_GROUPS functionality<br />
gets actually implemented just keep your current<br />
restore/YUM/default/405_clone_users_and_groups.sh<br />
in this pull request - it can be deleted any time later<br />
in the separated pull request where the generic<br />
RECREATE_USERS_GROUPS functionality<br />
is implemented.</p>
<h4 id="schlomo_commented_at_2017-09-06_1058"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327449099">2017-09-06 10:58</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-06_1058" title="Permanent link">&para;</a></h4>
<p>👍 to splitting PRs into different topics.</p>
<p>This discussion made me curious about one detail: Why do our users so
far not report lots of problems with restoring files while the users and
groups are not defined?</p>
<p>My only guess is that all tools behave like tar: If the user <strong>name</strong> is
not known then simply set the user <strong>id</strong> (which is the only thing that
is stored in the file system in any case) and hope for the best.</p>
<p>As all backup strategies will <strong>both</strong> restore <code>/etc/passwd</code> /
<code>/etc/group</code> together with the files the system actually works correctly
after it boots up from the restored file system. The crucial part here
is the fact that both the user/group database and the files where stored
together in the backup and recovered together into the <strong>blank</strong> system.</p>
<p>With both the YUM and ZYPPER recovery methods this strong correlation
between user/group database and file content is on purpose broken. The
user/group database is recovered via RPM and then <strong>some</strong> files are
recovered from a backup. In my opinion this discrepancy is the root
cause for these problems that you are describing here.</p>
<p>ReaR has always prided itself in correctly separating between the rescue
system and the recovered target system. The current implementation of
YUM and ZYPPER also breaks with this separation and the complexity you
describe here is a result of that.</p>
<p>I can imagine a slightly different approach that might be easier to
follow:</p>
<ul>
<li>Use ReaR to recreate the disk layout and mount the filesystems</li>
<li>Use RPM to reinstall the base system</li>
<li>Restore the additional files in a <strong>chroot</strong> environment <strong>within</strong>
    the reinstalled base system</li>
<li>Use ReaR to adjust the recovered system to the new hardware</li>
</ul>
<p>The main difference is running the restore of the additional files in
the context of the system that was installed via RPM. There of course
the tar logic of first looking up users in the database and then falling
back to IDs works as intended. If the UIDs will have changed in the
recovered system then the restored files will also get the new UIDs.</p>
<p>This for sure works well for all users and groups created in RPM package
scripts. If you want to also handle manually created users then I
suggest to add the users that are <strong>missing</strong> in the target system after
installing all the RPMs instead of creating all users beforehand.</p>
<p>The whole point of this exercise is maintaining a strict separation of
concerns between files (and information) governed by different owners:</p>
<ol>
<li>files and users owned by an RPM package</li>
<li>files and users created manually</li>
</ol>
<p>To summarize: I have the impression that if YUM and ZYPPER use chroot
where applicable that then the users and groups in the rescue system
don't matter.</p>
<p>About the actual installation of the chroot via yum, I haven't done this
myself before but I remember building chroot environments with steps
like the ones mentioned in
<a href="http://blog.parahard.com/2011/06/five-steps-to-create-fedora-chroot-jail.html">http://blog.parahard.com/2011/06/five-steps-to-create-fedora-chroot-jail.html</a>,
especially the part of initializing the RPM DB, installing some basic
RPMs via rpm (and not yum) and putting some files into the chroot to
make the scripts happy.</p>
<p>Could you maybe also let us know why you don't use existing tools like
<a href="https://github.com/dozzie/yumbootstrap">https://github.com/dozzie/yumbootstrap</a>
or
<a href="https://github.com/rpm-software-management/mock">https://github.com/rpm-software-management/mock</a>
which already contain a lot of expert knowledge about creating a fresh
RPM-based setup in a chroot?</p>
<h4 id="jsmeix_commented_at_2017-09-06_1204"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327462474">2017-09-06 12:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-06_1204" title="Permanent link">&para;</a></h4>
<p>@N3WWN @schlomo<br />
have a look at my current 900_clone_users_and_groups.sh<br />
in
<a href="https://github.com/rear/rear/pull/1472">https://github.com/rear/rear/pull/1472</a><br />
regardless if "copy all 'getent' users and gropus" is really needed<br />
or only needed in exceptional cases (like the YUM method)<br />
it should now be at least possible (provided my code is o.k.)<br />
to clone all available users and groups if needed.<br />
There should be still no behavioural changes compared<br />
to the 'old' 900_clone_users_and_groups.sh<br />
(i.e. before I touched it).</p>
<h4 id="n3wwn_commented_at_2017-09-07_2150"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-327936575">2017-09-07 21:50</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-07_2150" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Thanks for the info on how to update the PR to exclude the common files.
I'm still testing 900_clone_users_and_groups.sh for both "YUM" and
"YUM+file backup" but hope to get the PR updated before the weekend.</p>
<blockquote>
<p>I would prefer to wait with symlinking YUM and ZYPPER scripts<br />
until both implementations stabilized because currently<br />
both are unfinished and work-in-progress</p>
</blockquote>
<p>Right now I'm symlinking to some ZYPPER files, but will remove the
symlinks and create copies of the files before I update the PR so they
exist in isolation until they stabilize.</p>
<p>@jsmeix and @schlomo</p>
<blockquote>
<p>double-clone-users-and-groups</p>
</blockquote>
<p>I think the problem stems from having a system that has dynamic UID/GID
assignment during package installation. Source system has UIDs/GIDs
assigned dynamically when it was built. Those UIDs/GIDs are copied over
to the ReaR rescue/restore system. Target system has UIDs/GIDs assigned
dynamically when it is built by the ReaR rescue/restore system and there
exist files on the target filesystem which adhere to those UIDs/GIDs. We
now have two databases with dissimilar assignment of those UIDs/GIDs
within one running OS. The tar archive also has a mapping of username
and group to UID and GID.</p>
<p>If the ReaR rescue/restore system performs the restore natively
(non-chroot), tar will use the ReaR rescue/restore system's UID/GID
mappings when writing the files.</p>
<p>If the ReaR rescue/restore system performs the restore via chroot within
the target environment, tar will use the target system's UID/GID
mappings when writing the files. This is almost perfect, except when the
user or group doesn't exist and tar has to fall back on the UID or GID
stored in the tar archive. What happens then is that the files are
restored with the wrong UID and/or GID.</p>
<p>The double-clone-users-and-groups should take care of this by ensuring
that all users and groups that exist on the source system will exist
(well, <em>should</em> exist) on the target system when the files are restored.</p>
<blockquote>
<p>Why do our users so far not report lots of problems with restoring
files while the users and groups are not defined?</p>
</blockquote>
<p>I think because it requires a perfect storm of using tar (or other
backup method that stores both usernames/groups and UIDs/GIDs and falls
back to UID/GID if the username or group are missing) and a system
rebuilt from a method that does so from scratch using packages (ZYPPER
or YUM).</p>
<p>Since I ran into it in my testing, I worked on a solution to resolve it
should anyone else encounter it, regardless of how often it may actually
occur. 🎲</p>
<blockquote>
<p>yumbootstrap and/or mock</p>
</blockquote>
<p>I suppose there may exist other tools that may be a better solution at
this time... I haven't looked, honestly, since I have been advocating
ReaR within my organization since I first fell in love with it many
months ago. When I saw the brand new functionality that ZYPPER provides,
I saw an opportunity to contribute a similar YUM feature (based heavily
on the ZYPPER code) and thought I'd add a file backup capability, also.</p>
<p>The double-clone-users-and-groups solution is actually only required for
the file backup capability, so I could exclude it from the initial YUM
PR, also, if that would be better. Then, YUM and ZYPPER will operate
almost identically.</p>
<blockquote>
<p>RECREATE_USERS_GROUPS and 395_recreate_users_and_groups.sh</p>
</blockquote>
<p>I understand where you're coming from and going with this and will
attempt to get this done ASAP, also. 😁</p>
<p>Thanks!</p>
<h4 id="jsmeix_commented_at_2017-09-08_1128"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328078995">2017-09-08 11:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-08_1128" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-327449099">https://github.com/rear/rear/pull/1464#issuecomment-327449099</a><br />
"Restore the additional files in a chroot environment<br />
within the reinstalled base system":</p>
<p>This is a very interesting new functionality for ReaR<br />
which basically matches what I wrote in the<br />
"Other possible ways to do native disaster recovery with AutoYaST"<br />
section at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
which reads (excerpt):</p>
<pre>
... let AutoYaST install all RPM software packages
of the complete system and afterwards restore
a backup that only contains those files that are
added or changed compared to the original files
in the RPM software packages.
In this case the restore script could run
as a so called "chroot script"
(with "chrooted=false" or "chrooted=true"
as needed in the particular case). 
</pre>

<p>Backup restore via chroot within the target system<br />
requires an already configured target system at least<br />
up to the point so that the backup restore software<br />
can successfully run within the target system.</p>
<p>For third-party backup software backup restore<br />
within the target system requires that the third-party<br />
backup restore software and all what it needs to run<br />
is already there "ready-to-use" in the target system.</p>
<p>In contrast backup restore in the ReaR recovery system<br />
already "just works" also for various third-party backup<br />
software.</p>
<p>Therefore from my current point of view I would first and<br />
foremost try to get the usual backup restore in the ReaR<br />
recovery system also working well for YUM and ZYPPER<br />
so that users can use the YUM and ZYPPER methods<br />
in the same way as any other method.</p>
<p>In general regarding backup restore for YUM and ZYPPER<br />
see my current ZYPPER description in default.conf<br />
that reads (excerpts):</p>
<pre>
it is not an usual file-based backup/restore
method
...
During "rear mkbackup" it will basically only
save a list of installed RPM packages
...
during "rear recover" it will basically
only install those RPM packages as
pristine RPM packages
...
Any other files that should be restored
(e.g. prepared config files or /home directories)
must be done by
"Using Multiple Backups for Relax-and-Recover",
see doc/user-guide/11-multiple-backups.adoc
</pre>

<p>Now as I read this again I wonder meanwhile<br />
if I ever need to implement a particular<br />
file-based backup/restore for ZYPPER,<br />
i.e. I wonder if I need to implement something in<br />
backup/ZYPPER/default/500_make_backup.sh</p>
<p>@N3WWN I have a question:<br />
In<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-327287675">https://github.com/rear/rear/pull/1464#issuecomment-327287675</a><br />
you wrote about 'tar' and<br />
"We perform the file restore on the rescue/recovery system"<br />
but in<br />
<a href="https://github.com/rear/rear/pull/1464/files">https://github.com/rear/rear/pull/1464/files</a><br />
I don't see any usage of 'tar' or any file-based backup restore.<br />
Now I wonder what you mean with 'tar' and<br />
"We perform the file restore on the rescue/recovery system"?<br />
Do you need a special file-based backup/restore for YUM?<br />
Or do you already use<br />
"Using Multiple Backups for Relax-and-Recover"<br />
for YUM?</p>
<h4 id="jsmeix_commented_at_2017-09-08_1523"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328134114">2017-09-08 15:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-08_1523" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
In Germany it is evening so that I do not merge it today<br />
and perhaps you like to do some minor adaptions.<br />
If there are no strict objections I would like to merge<br />
your YUM additions on Monday.<br />
Have a nice weekend and many thanks for your<br />
valuable contributions that help to move ReaR<br />
forward to new use-cases!</p>
<h4 id="n3wwn_commented_at_2017-09-08_1616"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328148311">2017-09-08 16:16</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-08_1616" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>...current point of view I would first and<br />
foremost try to get the usual backup restore in the ReaR<br />
recovery system also working well for YUM and ZYPPER<br />
so that users can use the YUM and ZYPPER methods<br />
in the same way as any other method.</p>
</blockquote>
<p>In my dev branch that contains the yet-to-be-submitted YUM+backup PR, I
used the NETFS backup workflow as my starting point, but forced the use
of tar. Now that I'm becoming more and more familiar with the inner
workings of ReaR, I see that I may be able to alter how the backup is
performed to use whatever other file backup methods ReaR supports.</p>
<p>Regarding the lack of any mention of 'tar', that's because that'll be in
a future PR 😁</p>
<p>Sadly, the somewhat interconnectedness of
usr/share/rear/rescue/default/900_clone_users_and_groups.sh between
YUM and YUM+backup have blurred the lines between those two in the
discussion.</p>
<p>With the future work that I'll do for RECREATE_USERS_GROUPS and
395_recreate_users_and_groups.sh, which I think will be entirely
within the YUM+backup PR, that interconnectedness will cease, at least
for the time being.</p>
<p>Merging on Monday sounds great. I think I've finished the changes that
I'm going to commit for this PR, so it should be stable between now and
Monday.</p>
<p>Thanks and have a great weekend!</p>
<h4 id="jsmeix_commented_at_2017-09-11_1050"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328493711">2017-09-11 10:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1050" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
in your<br />
restore/YUM/default/970_set_root_password.sh<br />
I noticed</p>
<pre>
test "$ZYPPER_ROOT_PASSWORD" && root_password="$ZYPPER_ROOT_PASSWORD"
</pre>

<p>perhaps you meant to use YUM_ROOT_PASSWORD?</p>
<h4 id="jsmeix_commented_at_2017-09-11_1150"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328505691">2017-09-11 11:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1150" title="Permanent link">&para;</a></h4>
<p>Regardless of minor issues like<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-328493711">https://github.com/rear/rear/pull/1464#issuecomment-328493711</a><br />
I will merge it right now as is because further issues<br />
can be fixed via subsequent pull requests as needed.</p>
<h4 id="n3wwn_commented_at_2017-09-12_1445"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-328875412">2017-09-12 14:45</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-12_1445" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Thank you sir! 😀</p>
<p>I'll get the &lt;<em>X</em>&gt;_ROOT_PASSWORD thing sorted out and will
submit a new PR for it.</p>
<h4 id="jsmeix_commented_at_2017-09-13_0929"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-329112123">2017-09-13 09:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-13_0929" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
you are welcome!</p>
<p>FYI:<br />
I have an idea regarding files backup for YUM and ZYPPER<br />
that is related to what I wrote in<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-328078995">https://github.com/rear/rear/pull/1464#issuecomment-328078995</a></p>
<p>Because one cannot have two BACKUP=... at the same time<br />
"Using Multiple Backups for Relax-and-Recover"<br />
is the only way to restore a real files backup<br />
(e.g. databases or tons of files in user home directores)<br />
for YUM and ZYPPER.</p>
<p>But the plain YUM and ZYPPER RPM package installation<br />
restults a pristine/raw unconfigured system.</p>
<p>To only get some configuration files coiped into the<br />
target system after the RPM package installation<br />
"Using Multiple Backups for Relax-and-Recover"<br />
looks like a bit too big hammer for that purpose.</p>
<p>Therefore my idea to only get some files coiped into<br />
the target system is to do basically the same as<br />
init/default/030_update_recovery_system.sh<br />
implements currently for the ReaR recovery system.</p>
<p>I.e. my idea is to add something like a<br />
finalize/default/150_update_target_system.sh<br />
script with a TARGET_SYSTEM_UPDATE_URL<br />
(cf. RECOVERY_UPDATE_URL in default.conf)<br />
that points to a download location wherefrom it<br />
downloads a tar.gz archive and extracts that<br />
at $TARGET_FS_ROOT i.e. into the root directory<br />
of the target system.</p>
<h4 id="pcahyna_commented_at_2021-05-18_2244"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-843615776">2021-05-18 22:44</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-18_2244" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I symlinked files where possible and copied and updated files when
changes were necessary for the YUM method.</p>
</blockquote>
<p>Hello @N3WWN,</p>
<p>according to the diff, there are actually many files that could have
been symlinked, because they contain no significant changes. Those
are:<br />
usr/share/rear/verify/YUM/default/980_umount_YUM_dir.sh<br />
usr/share/rear/verify/YUM/default/070_set_backup_archive.sh<br />
usr/share/rear/verify/YUM/default/060_mount_YUM_path.sh<br />
usr/share/rear/verify/YUM/default/050_check_YUM_requirements.sh<br />
usr/share/rear/restore/YUM/default/980_umount_YUM_dir.sh<br />
usr/share/rear/restore/YUM/default/100_mount_YUM_path.sh<br />
usr/share/rear/prep/YUM/default/070_set_backup_archive.sh<br />
usr/share/rear/build/YUM/default/600_create_python_symlink.sh</p>
<p>Why have you converted those symlinks to copies? I am asking because I
am doing a cleanup and having to change so many identical files is not
very productive.</p>
<h4 id="jsmeix_commented_at_2021-05-19_0648"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-843796672">2021-05-19 06:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-19_0648" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
see what I wrote "Regarding symlinking YUM and ZYPPER scripts" in<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-327433717">https://github.com/rear/rear/pull/1464#issuecomment-327433717</a><br />
and for an example where that separation was useful see<br />
<a href="https://github.com/rear/rear/pull/1740#pullrequestreview-99619497">https://github.com/rear/rear/pull/1740#pullrequestreview-99619497</a></p>
<p>Since a longer time there have been almost no further changes<br />
so it seems things had stabilized meanwhile.</p>
<p>In particular I noticed zero user interest about my ZYPPER method<br />
so the ZYPPER method is not further developed by me.<br />
Things may change if there is user interest in particular<br />
by SUSE customers who in the end pay my salary.</p>
<p>In contrast the YUM method was further developed<br />
in particular by
<a href="https://github.com/rear/rear/pull/1740">https://github.com/rear/rear/pull/1740</a><br />
so currently the YUM code is the leading and active code<br />
while the ZYPPER code rests (at least for now) in peace.</p>
<p>Accordingly when there are duplicated scritps<br />
the YUM scripts should contain the actual code<br />
with matching ZYPPER scripts as symlinks.</p>
<h4 id="jsmeix_commented_at_2021-05-19_0738"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-843833424">2021-05-19 07:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-19_0738" title="Permanent link">&para;</a></h4>
<p>Oops - I think I misunderstood<br />
<a href="https://github.com/rear/rear/pull/1464#issuecomment-843615776">https://github.com/rear/rear/pull/1464#issuecomment-843615776</a></p>
<p>It is not about duplicates of YUM and ZYPPER scripts.</p>
<p>It is about YUM scripts that are basically copies of other scripts.<br />
In this case I think the YUM scripts should be usually symlinks.</p>
<h4 id="pcahyna_commented_at_2021-05-19_0800"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-843848583">2021-05-19 08:00</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-19_0800" title="Permanent link">&para;</a></h4>
<p>@jsmeix indeed most of the files I am concerned with are not from ZYPPER
but from NETFS (and were converted to copies in commit
3d9cc245799317102ec5311d67c104494da1cbaf).<br />
The ZYPPER ones are usually a bit different from the YUM ones. It would
be nice to unify them using some parameters, but it would be more work
and I don't attempt to do this here.</p>
<h4 id="jsmeix_commented_at_2021-05-19_0806"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1464#issuecomment-843853560">2021-05-19 08:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-19_0806" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
don't worry about ZYPPER.<br />
If ZYPPER scripts need adaptions I would do it.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-08-31.1464.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
