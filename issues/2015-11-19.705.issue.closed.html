<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#705 Issue closed: Some NSR Remarks - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#705 Issue closed: Some NSR Remarks";
        var mkdocs_page_input_path = "issues/2015-11-19.705.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#705 Issue closed: Some NSR Remarks</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="705_issue_closed_some_nsr_remarks"><a href="https://github.com/rear/rear/issues/705">#705 Issue</a> <code>closed</code>: Some NSR Remarks<a class="headerlink" href="#705_issue_closed_some_nsr_remarks" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>needs sponsorship</code>, <code>external tool</code></p>
<h4 id="fireclown_opened_issue_at_2015-11-19_1521"><img src="https://avatars.githubusercontent.com/u/15926853?v=4" width="50"><a href="https://github.com/fireclown">fireclown</a> opened issue at <a href="https://github.com/rear/rear/issues/705">2015-11-19 15:21</a>:<a class="headerlink" href="#fireclown_opened_issue_at_2015-11-19_1521" title="Permanent link">&para;</a></h4>
<p>While using the ReaR NSR-Mode, i found some things that did not<br />
work like expected. Well, I do not like it that ReaR is doing<br />
it's NetWorker stuff at a few hundred Systems ;-)</p>
<p>I did some changes to some of the rear scripts, to make it easier to<br />
handle for me and i hope some of that will be also useful for you.</p>
<h5 id="first_you_will_find_some_remarks_to_that_changes">First you will find some remarks to that changes:<a class="headerlink" href="#first_you_will_find_some_remarks_to_that_changes" title="Permanent link">&para;</a></h5>
<p><strong>/usr/share/rear/output/NSR/default/95_nsr_save_result_files.sh</strong><br />
<em>PATCH1:</em><br />
It is not smart form me that "rear mkrescue" will do a save-command<br />
automatically. If I really want to do one, there is the possibility<br />
to do "rear mkbackup"<br />
-&gt; To Skip it I added NSR_SAVE-Variable in /etc/rear/local.conf:
NSR_SAVE="NO"</p>
<p><em>PATCH2:</em><br />
In many Cases it is not possible to identify the correct Pool.<br />
The Client could be saved to different Pools or in a worse case<br />
the datas are also stored in a Clone-Pool.<br />
For the moment I have no idea how to do it automatically.<br />
-&gt; My Workaround is to set the NSR_DEFAULT_POOL_N in
/etc/rear/local.conf.</p>
<p><em>PATCH3:</em><br />
In many Cases the Part to verify the backup will not work correctly,<br />
in cause that the Saveset will be the Filesystem and not the files<br />
itself.<br />
I changed that part. But for me that part it is only useful if i<br />
really need to debug. Or maybe if I do the rear-command manually.</p>
<p><strong>/usr/share/rear/conf/default.conf</strong><br />
The basic NSR-Config will cause in space-problem in the
/tmp-filesystem<br />
if i use it with a NetWorker-Server.<br />
-&gt; Idea: handle the exclude-variable within /etc/rear/local.conf<br />
-&gt; Workaround: For the Moment I changed COPY_AS_IS_EXCLUDE_NSR<br />
in the default.conf<br />
Anyway it could be a good thing to check if ther will be enough space<br />
in the /tmp Filesystem</p>
<p><strong>One last remark:</strong><br />
The new Enhancement (from #653), that should check if there is a ISO<br />
in the Backup, should also be managed (enable/disable) by a Variable<br />
in /etc/rear/local.conf</p>
<p><strong>My version of 95_nsr_save_result_files.sh:</strong></p>
<pre><code>#
# saving result files via NSR

########## PATCH1 - START ##########
### Prohibit direkt Backup 
if [ "$NSR_SAVE" = "NO" ]; then
    Log      "Do not save files with NSR (EMC NetWorker)"
    LogPrint "Do not save files with NSR (EMC NetWorker)"
    exit 0
fi
########## PATCH1 - END ##########
test ${#RESULT_FILES[@]} -gt 0 || Error "No files to copy (RESULT_FILES is empty)"

LogPrint "Saving result files with NSR (EMC NetWorker)"
NSR_RESULT_FILES=()

# decide where to put the result files for saving them with NSR
# if NSR_RESULT_FILE_PATH is unset, then save the result files where they are
# NOTE: Make sure that your NSR installation will not silently skip files in $TMP_DIR !
test -z "$NSR_RESULT_FILE_PATH" &amp;&amp; NSR_RESULT_FILE_PATH=$TMP_DIR

if ! test -d "$NSR_RESULT_FILE_PATH" ; then
     mkdir -v -p "$NSR_RESULT_FILE_PATH" 1&gt;&amp;8
     StopIfError "Could not create '$NSR_RESULT_FILE_PATH'"
fi


if test "$NSR_RESULT_FILE_PATH" != "$TMP_DIR" ; then
    cp -v  "${RESULT_FILES[@]}" "$NSR_RESULT_FILE_PATH" 1&gt;&amp;8
    StopIfError "Could not copy result files to '$NSR_RESULT_FILE_PATH'"
    NSR_RESULT_FILES=( 
        $(
            for fname in "${RESULT_FILES[@]}" ; do 
                echo "$NSR_RESULT_FILE_PATH/$(basename "$fname")"
            done
         )
    )
else
    NSR_RESULT_FILES=( "${RESULT_FILES[@]}" )
fi

if test -s "$CONFIG_DIR/templates/RESULT_usage_$OUTPUT.txt" ; then
    cp -v $CONFIG_DIR/templates/RESULT_usage_$OUTPUT.txt "$NSR_RESULT_FILE_PATH/README" 1&gt;&amp;8
    StopIfError "Could not copy '$CONFIG_DIR/templates/RESULT_usage_$OUTPUT.txt'"
    NSR_RESULT_FILES=( "${NSR_RESULT_FILES[@]}" "$NSR_RESULT_FILE_PATH"/README )
fi

NSRSERVER=$(cat $VAR_DIR/recovery/nsr_server )
CLIENTNAME=$(hostname)
########## PATCH2 - START ##########
### In many Cases it is not possible to identify the correct Pool,
### Even if it is a Clone-Pool.
### Workaround in /etc/rear/local.conf: NSR_DEFAULT_POOL_NAME="TestPool"
#POOLNAME="$( mminfo -s $NSRSERVER -a -q "client=$CLIENTNAME" -r "pool" | head -1 )"
POOLNAME="TestPool"
########## PATCH2 - END ##########
[[ -z "$POOLNAME" ]] &amp;&amp; POOLNAME="$NSR_DEFAULT_POOL_NAME"
[[ -z "$NSR_RETENTION_TIME" ]] &amp;&amp; NSR_RETENTION_TIME="1 day"

Log "Saving files '${NSR_RESULT_FILES[@]}' with save"
save -s $NSRSERVER -c $CLIENTNAME -b "$POOLNAME" -y "$NSR_RETENTION_TIME" "${NSR_RESULT_FILES[@]}" 1&gt;&amp;8
StopIfError "Could not save result files with save"

# show the saved result files
LogPrint "If the NSR_RETENTION_TIME=\"$NSR_RETENTION_TIME\" is too low please add NSR_RETENTION_TIME variable in $CONFIG_DIR/local.conf"
########## PATCH3 - START ##########
### ! In many Cases the Part to verify the backup will not work correctly
LogPrint "ssid       pool     files savetime    retent  name"
LogPrint "============================================"
read TIME OUT &lt;&lt;&lt; $(mminfo -s $NSRSERVER -aot -q client=epsdist -r 'nsavetime,ssid(11),pool,nfiles(5),savetime,ssretent,name'|tail -1)
echo $OUT 
echo
echo "Files:"
nsrinfo -s $NSRSERVER -t $TIME epsdist | grep -E $( echo ${NSR_RESULT_FILES[@]} | sed -e "s/ /|/g") &gt; $TMP_DIR/saved_result_files
########## PATCH3 - END ##########
LogPrint "$(cat $TMP_DIR/saved_result_files)"
</code></pre>
<h4 id="gdha_commented_at_2015-11-19_1537"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-158092439">2015-11-19 15:37</a>:<a class="headerlink" href="#gdha_commented_at_2015-11-19_1537" title="Permanent link">&para;</a></h4>
<p>@fireclown Which version of rear were you using? In github sources there
were some serious modification made around NSR. It would be nice that
you verify this as it could resolve already some of your issues
mentioned above?</p>
<h4 id="fireclown_commented_at_2015-11-19_1551"><img src="https://avatars.githubusercontent.com/u/15926853?v=4" width="50"><a href="https://github.com/fireclown">fireclown</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-158097849">2015-11-19 15:51</a>:<a class="headerlink" href="#fireclown_commented_at_2015-11-19_1551" title="Permanent link">&para;</a></h4>
<p>i am using rear-1.17.2-1.el5 from the epel-repository.</p>
<p>I will look tomorrow for changes in you soruces.</p>
<h4 id="fireclown_commented_at_2015-11-20_0808"><img src="https://avatars.githubusercontent.com/u/15926853?v=4" width="50"><a href="https://github.com/fireclown">fireclown</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-158317125">2015-11-20 08:08</a>:<a class="headerlink" href="#fireclown_commented_at_2015-11-20_0808" title="Permanent link">&para;</a></h4>
<p>Alright, now, i have checked ReaR with the actual git-sources and<br />
I'm sorry it does not really help :(</p>
<p>(PATCH1) "rear mkrescue" will do already a NetWorker save-command.<br />
Solution: Only "rear mkbackup" should do that.<br />
Suggestion: If ther will be no other way Enable/Disable by Variable in
local.conf</p>
<p>(PATCH2) maybe a good idea, but it only work for jukebox devices. I am<br />
also using a DataDomain, so it does not work for me and also<br />
not for AFTD-Devices.<br />
The other open Problem is to avoid Clone-Pools.<br />
Suggestion: Sorry, open for automatic detection.</p>
<p>(PATCH3) it is better, now you can find the saveset, for me that's ok,<br />
I suggest also showing the ssid.<br />
Just that part wanted also to show the files in the backup, then<br />
you will need my part of that script, to show the files in the saveset.</p>
<p>./conf/default.conf<br />
Makes the same problems then before, i run out of space in /tmp,<br />
so i have to extend the COPY_AS_IS_EXCLUDE_NSR-Variable.<br />
Suggestion: Possibility to extend Exclude in local.conf</p>
<p>default/65_check_iso_recoverable.sh<br />
I do not like it to be done with "rear mkrescue"<br />
mkrescue should only create an ISO like doing it with NETFS<br />
and like it is written in the help.<br />
&gt; mkbackup create rescue media and backup system<br />
&gt; mkbackuponly backup system without creating rescue media<br />
&gt; mkrescue create rescue media only<br />
or there should be a possibility to Enable/Disable it.<br />
or it one smart way could be to integrate within a "rear checklayout"</p>
<h4 id="gdha_commented_at_2015-11-20_0856"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-158328923">2015-11-20 08:56</a>:<a class="headerlink" href="#gdha_commented_at_2015-11-20_0856" title="Permanent link">&para;</a></h4>
<p>@fireclown Thank you for taking your time to check out the latest
code.<br />
Just want to emphasize when external backup programs are involved there
is no need to run <em>rear mkbackup</em> as only a rescue image is required,
therefore, <em>rear mkrescue</em> is sufficient.</p>
<p>Concerning <strong>Patch 1</strong> I would prefer a generic variable to save the ISO
image (with external backup programs) and the default should be <em>1</em> (yes
save ISO).<br />
Currently, we already have a variable as such in place:</p>
<pre><code>./conf/default.conf:TSM_RESULT_SAVE=y
./output/TSM/default/95_dsmc_save_result_files.sh:if [[ "$TSM_RESULT_SAVE" = "n" ]]; then
</code></pre>
<p>However, I think we should broaden the variable in the sense it is
understandable and useable by other backup mechanism such as TSM, DP,
NSR, BAREOS and so on. What do you think?<br />
Any suggestions?</p>
<p>Concerning <strong>Patch 2</strong> - define your definition in
<code>NSR_DEFAULT_POOL_NAME</code> could be the trick. Perhaps, take some time to
write a small article about it and we would be glad to publish it on our
rear website?</p>
<p>Concerning <strong>Patch 3</strong> - I'm not a NSR user and therefore, I'm not sure
what ssid means for NSR. There are other NSR users, perhaps, they can
discuss the pro/contra's with you as I have no clue.</p>
<p>Concerning <code>COPY_AS_IS_EXCLUDE_NSR</code> - running out of space in <code>/tmp</code>:
have you seen:</p>
<pre><code>./conf/default.conf:# the TMPDIR influences the mktemp command to define an alternative basedir instead of /tmp
./conf/default.conf:TMPDIR=""
</code></pre>
<p>Concerning <code>default/65_check_iso_recoverable.sh</code> - see <strong>Patch 1</strong>
remarks. It is about the same.</p>
<h4 id="fireclown_commented_at_2015-11-20_1342"><img src="https://avatars.githubusercontent.com/u/15926853?v=4" width="50"><a href="https://github.com/fireclown">fireclown</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-158406097">2015-11-20 13:42</a>:<a class="headerlink" href="#fireclown_commented_at_2015-11-20_1342" title="Permanent link">&para;</a></h4>
<p><strong>Patch1:</strong><br />
yes, that looks like that what i need. I think it will be helpful if<br />
you can make it generic and available for all Backup-Programs.</p>
<p>My motivation is, that i am also a NetWorker-Admin and i want to have<br />
more control about the external accesses to it. The *Result_SAVE can<br />
prevent a few hundred requests (maybe at the same time).</p>
<p><strong>Patch2:</strong><br />
the automatic pool research is a little bit tricky, I am just<br />
trying to find a solution. I will tell you ;-)</p>
<p><strong>Patch3:</strong><br />
Yes I can make it, but my ISO will be very huge (189GB) if<br />
I don't Exclude other Directories.</p>
<p>The <strong>ssid</strong> is the saveset id</p>
<p>so it could be added like that:</p>
<pre><code>mminfo -s $NSRSERVER -a -q "client=$CLIENTNAME,name=${SNAME},pool=${POOLNAME}" \
    -r "pool,ssid,ssretent,name" &gt; $TMP_DIR/saved_result_files
</code></pre>
<h4 id="gdha_commented_at_2015-12-08_1359"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-162887017">2015-12-08 13:59</a>:<a class="headerlink" href="#gdha_commented_at_2015-12-08_1359" title="Permanent link">&para;</a></h4>
<p>See also the discussions of issue #634</p>
<h4 id="gdha_commented_at_2017-05-17_1320"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/705#issuecomment-302087832">2017-05-17 13:20</a>:<a class="headerlink" href="#gdha_commented_at_2017-05-17_1320" title="Permanent link">&para;</a></h4>
<p>As we cannot do anything here without 'being contracted' by a NSR
customer I close this issue until further notice</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-11-19.705.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
