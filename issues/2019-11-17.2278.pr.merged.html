<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2278 PR merged: Feature rawdisk and opalpba improvements - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2278 PR merged: Feature rawdisk and opalpba improvements";
        var mkdocs_page_input_path = "issues/2019-11-17.2278.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2278 PR merged: Feature rawdisk and opalpba improvements</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2278_pr_merged_feature_rawdisk_and_opalpba_improvements"><a href="https://github.com/rear/rear/pull/2278">#2278 PR</a> <code>merged</code>: Feature rawdisk and opalpba improvements<a class="headerlink" href="#2278_pr_merged_feature_rawdisk_and_opalpba_improvements" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="olivero2_opened_issue_at_2019-11-17_1929"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> opened issue at <a href="https://github.com/rear/rear/pull/2278">2019-11-17 19:29</a>:<a class="headerlink" href="#olivero2_opened_issue_at_2019-11-17_1929" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong> + <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Supersedes PR: #2277</p>
</li>
<li>
<p>Resolves issue (URL): #2275</p>
</li>
<li>
<p>How was this pull request tested? Creating and booting PBAs on
    Ubuntu 18.04.3 LTS.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
<ol>
<li>RAWDISK: include additional Grub modules from /boot/grub (and
    /boot/grub2) which had formerly been missing</li>
<li>OPALPBA: improve Plymouth boot animation on Ubuntu, provide
    integration capabilities for other distros</li>
<li>RAWDISK: add support for distros which use 'grub2' naming (fix
    #2275)</li>
</ol>
</li>
</ul>
<h4 id="olivero2_commented_at_2019-11-17_1933"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-554778237">2019-11-17 19:33</a>:<a class="headerlink" href="#olivero2_commented_at_2019-11-17_1933" title="Permanent link">&para;</a></h4>
<p>@franciscohosting Here is the promised patch. I'd be happy if you could
test this on CentOS 7 and report your experiences here.</p>
<h4 id="olivero2_commented_at_2019-11-17_2156"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-554791749">2019-11-17 21:56</a>:<a class="headerlink" href="#olivero2_commented_at_2019-11-17_2156" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p><a href="https://github.com/rear/rear/pull/2277#issuecomment-554368834">https://github.com/rear/rear/pull/2277#issuecomment-554368834</a></p>
<blockquote>
<p>So I look forward to your improvements regarding secure boot.<br />
Hopefully we could use same code for same functionality in ReaR.</p>
</blockquote>
<p>I am a bit afraid that you might be disappointed: The code I have just
committed does not change the secure boot functionality at all in
RAWDISK output but is a leftover from trying to make Grub 2 (UEFI) play
nicely with a graphical boot animation afterwards, which I wanted for
the TCG Opal 2 PBA (disk unlocking system). I had used syslinux before
as it boots faster, but on a system configured for secure boot Grub 2 is
a must.</p>
<p>I tried hard to get all that boot-time video support, mode switching and
whatever as close to the original system as possible. As Grub 2 is
scarcely documented there was much guesswork involved. I had two
machines to test on with different graphics hardware (bare metal
required) and both behaved differently. One insisted on booting into a
black screen. There was an invisible password prompt waiting until
Return was pressed once. Only then the display appeared.</p>
<p>After all it turned out that an incomplete Grub 2 configuration was not
that much the culprit: It was a missing shared library: Plymouth could
not dynamically load <code>/usr/lib/x86_64-linux-gnu/plymouth/script.so</code> as
this referenced <code>/lib/x86_64-linux-gnu/libply-splash-graphics.so.4</code>
which was missing on the PBA system. The first library was included as
part of a directory via <code>COPY_AS_IS</code>, but that did <strong>not</strong> automatically
pull in libraries referenced by it. <code>build/GNU/Linux/100_copy_as_is.sh</code>
handles executable dependencies but overlooks those of <code>*.so</code> files.
Once I got that right, Grub 2 booted nicely into a graphical screen.</p>
<p>With respect to the remaining UEFI code in ReaR, it seems that there is
some confusion about which code is responsible for which part. An
example:<br />
<a href="https://github.com/rear/rear/blob/2f66b904fdc1f69d31f1c9fa64e13a0964c21a38/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh#L46">https://github.com/rear/rear/blob/2f66b904fdc1f69d31f1c9fa64e13a0964c21a38/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh#L46</a></p>
<p>However, <code>efibootmgr</code> is not a boot loader, so it cannot replace Grub 2.
It is just a tool to change UEFI variables which are stored in
non-volatile memory on your motherboard. For example, <code>efibootmgr</code> can
select the boot disk devices and the order of boot device preference. So
instead of selecting boot devices in the BIOS setup you could use
<code>efibootmgr</code> to the same effect.</p>
<p>If I understand ReaR code correctly (and I have only had a glimpse),
<code>660_install_grub2.sh</code> is only used to install a legacy (BIOS)
bootloader. That's why it contains</p>
<pre><code>is_true $USING_UEFI_BOOTLOADER &amp;&amp; return
</code></pre>
<p>Installing an UEFI bootloader seems to be done in
<code>output/ISO/Linux-i386/820_create_iso_image.sh</code> and
<code>usr/share/rear/finalize/SUSE_LINUX/i386/675_install_shim.sh</code> by
mechanisms I don't know about. <code>shim-install</code> seems SUSE-specific, it
actually does install Grub 2 and may be worth a look as it is all-bash:
<a href="https://build.opensuse.org/package/view_file/devel:openSUSE:Factory/shim/shim-install?expand=1">https://build.opensuse.org/package/view_file/devel:openSUSE:Factory/shim/shim-install?expand=1</a></p>
<p>On shim: Linux distributions use <code>shimx64.efi</code> as their first stage boot
loader, which is signed by Microsoft and thus works with secure boot at
factory defaults. (Shim is used, as for legal reasons Grub cannot be
signed directly.)</p>
<p>If you'd like more details, see <a href="https://www.linuxjournal.com/content/take-control-your-pc-uefi-secure-boot">Take Control of Your PC with UEFI
Secure Boot | Linux
Journal</a>.</p>
<p>Hope this helps...</p>
<h4 id="jsmeix_commented_at_2019-11-18_0958"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-554942607">2019-11-18 09:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-18_0958" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
I would appreciate a second review from another ReaR maintainer<br />
to be more on the safe side against possible regressions.</p>
<h4 id="jsmeix_commented_at_2019-11-18_1010"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-554947084">2019-11-18 10:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-18_1010" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for your explanation in your<br />
<a href="https://github.com/rear/rear/pull/2278#issuecomment-554791749">https://github.com/rear/rear/pull/2278#issuecomment-554791749</a></p>
<p>Yes, it helps because you also think that the current way<br />
how ReaR re-installs UEFI booting during "rear recover"<br />
at least looks a bit fishy and needs a closer look and<br />
may perhaps need some cleanup and enhancement.</p>
<p>But for now how ReaR re-installs UEFI booting<br />
seems to "work sufficiently in most cases" and<br />
I think @gozora explained why in his<br />
<a href="https://github.com/rear/rear/issues/2275#issuecomment-554028783">https://github.com/rear/rear/issues/2275#issuecomment-554028783</a></p>
<p>So no need to rush - better carefully and step by step,<br />
cf. RFC 1925 items (2) and (2a)<br />
<a href="https://tools.ietf.org/html/rfc1925">https://tools.ietf.org/html/rfc1925</a></p>
<h4 id="jsmeix_commented_at_2019-11-18_1447"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-555046879">2019-11-18 14:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-18_1447" title="Permanent link">&para;</a></h4>
<p>A side note related to<br />
<a href="https://github.com/rear/rear/pull/2278#discussion_r347282498">https://github.com/rear/rear/pull/2278#discussion_r347282498</a></p>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/28ba2bb8367a7750ef940c07f19e7f537bbf6213">https://github.com/rear/rear/commit/28ba2bb8367a7750ef940c07f19e7f537bbf6213</a><br />
I added a more explanatory comment in default.conf how COPY_AS_IS<br />
versus LIBS, PROGS, and REQUIRED_PROGS are meant to be used.</p>
<h4 id="jsmeix_commented_at_2019-11-22_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-557528076">2019-11-22 13:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-22_1317" title="Permanent link">&para;</a></h4>
<p>I would like to wait until next monday<br />
for a second review from another ReaR maintainer.</p>
<p>When there is no objection I would merge it next monday afternoon.</p>
<h4 id="jsmeix_commented_at_2019-11-26_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2278#issuecomment-558508086">2019-11-26 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-26_0759" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for your continuous fixes and improvements for ReaR.<br />
In particular I appreciate it that you cuntinuously maintain<br />
those features that you had initially contributed to ReaR<br />
i.e. you care about "your code".</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-11-17.2278.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
