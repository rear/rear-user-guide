<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2833 Issue closed: Issue with ReaR and Borg - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2833 Issue closed: Issue with ReaR and Borg";
        var mkdocs_page_input_path = "issues/2022-07-01.2833.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2833 Issue closed: Issue with ReaR and Borg</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2833_issue_closed_issue_with_rear_and_borg"><a href="https://github.com/rear/rear/issues/2833">#2833 Issue</a> <code>closed</code>: Issue with ReaR and Borg<a class="headerlink" href="#2833_issue_closed_issue_with_rear_and_borg" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="zenadmin-ops_opened_issue_at_2022-07-01_0530"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> opened issue at <a href="https://github.com/rear/rear/issues/2833">2022-07-01 05:30</a>:<a class="headerlink" href="#zenadmin-ops_opened_issue_at_2022-07-01_0530" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.6</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    Ubuntu 22.04</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>this_file_name=$( basename ${BASH_SOURCE[0]} )
LOGFILE="$LOG_DIR/rear-$HOSTNAME-$WORKFLOW-${this_file_name%.*}.log"
BACKUP=BORG
BACKUP_ONLY_INCLUDE="yes"
BACKUP_PROG_INCLUDE=( '/home/*' '/opt/*' )
BORGBACKUP_ARCHIVE_PREFIX="rear"
# BORGBACKUP_HOST="borg.server.name"
# BORGBACKUP_USERNAME="borg_server_username"
# BORGBACKUP_REPO="/path/to/borg/repository/on/borg/server"
BORGBACKUP_PRUNE_KEEP_DAILY=7
BORGBACKUP_PRUNE_KEEP_WEEKLY=5
BORGBACKUP_PRUNE_KEEP_MONTHLY=12
BORGBACKUP_COMPRESSION="zlib,9"
BORGBACKUP_ENC_TYPE="keyfile"
export BORG_KEYS_DIR="~/root/.config/borg/keys"
# export BORG_CACHE_DIR=" /root/.config/borg/cache"
export BORG_PASSPHRASE='actual phrase removed'
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
export BORG_REMOTE_PATH="/media/zen/REAR-000/Borg"
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    Hyper-V VM. Gen 2</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    Local USB formatted by Rear</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):<br />
    N/A</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>Hello,</p>
<p>I am posting this question on the Github issue tracker, because the
rear-users list is not working at the moment.</p>
<p>I think that my issue is more than likely a configuration issue on my
part, rather than a Rear issue.</p>
<p>I'm new to Rear. I currently have a working Rear backup to a local USB
drive using NETFS.</p>
<p>I want to integrate Borg into my Rear config.</p>
<p>I currently have Borg backup to the local USB drive working when I use
Borg directly.</p>
<p>The issue that I'm having is when trying to call Borg via Rear.</p>
<p>I've tried a number of different settings in the conf file and none have
worked</p>
<p>Here is an extract of the error from Rear</p>
<pre><code>$ sudo rear -C borg_backup mkbackuponly -v
Relax-and-Recover 2.6 / Git
Running rear mkbackuponly (PID 86844)
Using log file: /var/log/rear/rear-Ubuntu-DR6.86844.log
Sourcing additional configuration file '/etc/rear/borg_backup.conf'
Running workflow mkbackuponly on the normal/original system
Couldn't list Borg repository '' on USB
Borg: /tmp/rear.X1bb8vA4MPiJqXK/borg_backup is not a valid repository. Check repo config.
ERROR: Failed to initialize Borg repository, borg rc 2!
Some latest log messages since the last called script 300_init_archive.sh:
  2022-07-01 15:12:03.633219635 Including prep/BORG/default/300_init_archive.sh
  2022-07-01 15:12:04.330816517 Couldn't list Borg repository '' on USB
  2022-07-01 15:12:04.336928993 Borg: /tmp/rear.X1bb8vA4MPiJqXK/borg_backup is not a valid repository. Check repo config.
Aborting due to an error, check /var/log/rear/rear-Ubuntu-DR6.86844.log for details
Exiting rear mkbackuponly (PID 86844) and its descendant processes ...
Running exit tasks
</code></pre>
<p>In an ideal world, if someone can see the error in my conf file, that
would be awesome.</p>
<p>Failing that, some troubleshooting suggestions would be appreciated.</p>
<p>Thank you</p>
<p>Vaughan</p>
<h4 id="jsmeix_commented_at_2022-07-01_1142"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1172256249">2022-07-01 11:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-01_1142" title="Permanent link">&para;</a></h4>
<p>@ZENAdmin-Ops<br />
I am not a Borg backup user so I cannot actually help with<br />
Borg backup specific issues.</p>
<p>Do you know about our Borg backup documentation in<br />
doc/user-guide/04-scenarios.adoc<br />
which is currently online at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/04-scenarios.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/04-scenarios.adoc</a><br />
therein the section "ReaR with Borg back end"?</p>
<p>Your above posted site.conf or local.conf looks incomplete.<br />
I am missing generic things like</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://foo.bar.xy/mnt/backup/iso
</code></pre>
<p>or alternatively</p>
<pre><code>OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
</code></pre>
<p>Also without a complete "rear -D mkrescue"<br />
and/or a "rear -D mkbackup" debug log file<br />
we have basically no chance to imagine<br />
what is actually going on on your system.</p>
<h4 id="zenadmin-ops_commented_at_2022-07-01_1411"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1172392435">2022-07-01 14:11</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2022-07-01_1411" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I have the following working configuration (but this doesn't use Borg)</p>
<p>I have been able to restore this backup. But I don't want to run this
daily.</p>
<pre><code>/etc/rear/basic_system.conf
sudo rear -C basic_system mkbackup

OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
USB_UEFI_PART_SIZE=1000
USB_RETAIN_BACKUP_NR=10
</code></pre>
<p>Thanks for your post.</p>
<p>I have been using a different example as my template for the integration
of the Borg backup<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a></p>
<p>After your comments, I had a closer look at the section of the user
guide which you refer to. And while I still don't have a working config
as I write. I have been able to correct the error with Rear being unable
to locate the Borg repository.</p>
<p>This is definitely progress.</p>
<p>Thanks!</p>
<p>Sometimes you just need a fresh set of eyes to provide a different
perspective.</p>
<p>I'll do some further testing tomorrow.</p>
<h4 id="zenadmin-ops_commented_at_2022-07-02_0427"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1172831815">2022-07-02 04:27</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2022-07-02_0427" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>Here's my latest attempt</p>
<pre><code>sudo rear -C borg_backup mkbackuponly -v
Relax-and-Recover 2.6 / Git
Running rear mkbackuponly (PID 93493)
Using log file: /var/log/rear/rear-Ubuntu-DR6.93493.log
Sourcing additional configuration file '/etc/rear/borg_backup.conf'
Running workflow mkbackuponly on the normal/original system
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-5.15.0-39-generic' as kernel in the recovery system
Creating disk layout
Using guessed bootloader 'EFI' (found in first bytes on /dev/sda)
Verifying that the entries in /tmp/rear.EyiICJA28bUrrvG/tmp/backuplayout.conf are correct ...
Creating backup archive 'rear_2' in Borg repository /Borg on USB
Creating archive at "/tmp/rear.EyiICJA28bUrrvG/borg_backup/Borg::rear_2"
/home/*: [Errno 2] No such file or directory: '*'
/opt/*: [Errno 2] No such file or directory: '*'
ERROR: Borg failed to create backup archive, borg rc 1!
Some latest log messages since the last called script 500_make_backup.sh:
  2022-07-02 14:14:04.909088454 Including backup/BORG/default/500_make_backup.sh
  2022-07-02 14:14:04.918857173 Creating backup archive 'rear_2' in Borg repository /Borg on USB
  Creating archive at "/tmp/rear.EyiICJA28bUrrvG/borg_backup/Borg::rear_2"
  /home/*: [Errno 2] No such file or directory: '*'
  /opt/*: [Errno 2] No such file or directory: '*'
Aborting due to an error, check /var/log/rear/rear-Ubuntu-DR6.93493.log for details
Exiting rear mkbackuponly (PID 93493) and its descendant processes ...
Running exit tasks
Terminated
</code></pre>
<p>Failing because of the backup selection</p>
<pre><code>/home/*: [Errno 2] No such file or directory: '*'
/opt/*: [Errno 2] No such file or directory: '*'
</code></pre>
<p>Here is the: borg_backup.conf</p>
<pre><code>this_file_name=$( basename ${BASH_SOURCE[0]} )
LOGFILE="$LOG_DIR/rear-$HOSTNAME-$WORKFLOW-${this_file_name%.*}.log"

OUTPUT=USB
BACKUP=BORG

USB_DEVICE=/dev/disk/by-label/REAR-000

BORGBACKUP_REPO="/Borg"
# BORGBACKUP_UMASK="0002"

BACKUP_ONLY_INCLUDE="yes"
BACKUP_PROG_INCLUDE=( '/home/*' '/opt/*' )
BORGBACKUP_ARCHIVE_PREFIX="rear"
# BORGBACKUP_HOST="borg.server.name"
# BORGBACKUP_USERNAME="borg_server_username"
# BORGBACKUP_REPO="/path/to/borg/repository/on/borg/server"
BORGBACKUP_PRUNE_KEEP_DAILY=7
BORGBACKUP_PRUNE_KEEP_WEEKLY=5
BORGBACKUP_PRUNE_KEEP_MONTHLY=12
BORGBACKUP_COMPRESSION="zlib,9"
BORGBACKUP_ENC_TYPE="keyfile"

COPY_AS_IS_BORG=( "$ROOT_HOME_DIR/.config/borg/keys/" )
export BORG_KEYS_DIR=( "$ROOT_HOME_DIR/.config/borg/keys/" )

export BORG_PASSPHRASE='&lt;passphrase-here&gt;'
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
</code></pre>
<p>The issue appears to be this statement</p>
<pre><code>BACKUP_PROG_INCLUDE=( '/home/*' '/opt/*' )
</code></pre>
<p>But the syntax looks OK to me?</p>
<h4 id="zenadmin-ops_commented_at_2022-07-02_0434"><img src="https://avatars.githubusercontent.com/u/62083231?v=4" width="50"><a href="https://github.com/ZENAdmin-Ops">ZENAdmin-Ops</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1172832632">2022-07-02 04:34</a>:<a class="headerlink" href="#zenadmin-ops_commented_at_2022-07-02_0434" title="Permanent link">&para;</a></h4>
<p>The answer appears to be to change</p>
<pre><code>BACKUP_PROG_INCLUDE=( '/home/*' '/opt/*' )
</code></pre>
<p>To this</p>
<pre><code>BACKUP_PROG_INCLUDE=( '/home/' '/opt/' )
</code></pre>
<p>Which seems odd, because the default.conf includes examples like the
following</p>
<pre><code>BACKUP_PROG_EXCLUDE=( '/tmp/*' '/dev/shm/*' "$VAR_DIR/output/*" )
</code></pre>
<h4 id="jsmeix_commented_at_2022-07-05_1146"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1174966416">2022-07-05 11:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-05_1146" title="Permanent link">&para;</a></h4>
<p>@ZENAdmin-Ops<br />
I am not a Borg backup user so I cannot actually help with<br />
Borg backup specific issues.</p>
<p>From what is see in the code it goes like this:</p>
<p>With <code>BACKUP_PROG_INCLUDE=( '/home/*' '/opt/*' )</code><br />
usr/share/rear/backup/BORG/default/400_create_include_exclude_files.sh<br />
creates $TMP_DIR/backup-include.txt which contains</p>
<pre><code>/home/*
/opt/*
</code></pre>
<p>that is read by<br />
usr/share/rear/backup/BORG/default/500_make_backup.sh<br />
into a <code>include_list</code> array which then contains<br />
the array elements <code>/home/*</code> and <code>/opt/*</code><br />
and that array is used in the borg_create() function in<br />
usr/share/rear/lib/borg-functions.sh<br />
in a <code>borg create</code> call like</p>
<pre><code>borg create ... "${include_list[@]}"
</code></pre>
<p>which evaluates to</p>
<pre><code>borg create ... /home/* /opt/*
</code></pre>
<p>which seems to let 'borg' fail with</p>
<pre><code>/home/*: [Errno 2] No such file or directory: '*'
/opt/*: [Errno 2] No such file or directory: '*'
</code></pre>
<p>so it seems 'borg' does not do "globbing"<br />
i.e. what bash does as "pathname expansion"<br />
or something similar.</p>
<p>In contrast with <code>BACKUP_PROG_INCLUDE=( '/home/' '/opt/' )</code><br />
usr/share/rear/backup/BORG/default/400_create_include_exclude_files.sh<br />
creates $TMP_DIR/backup-include.txt which contains</p>
<pre><code>/home/
/opt/
</code></pre>
<p>that is read by<br />
usr/share/rear/backup/BORG/default/500_make_backup.sh<br />
into a <code>include_list</code> array which then contains<br />
the array elements <code>/home/</code> and <code>/opt/</code><br />
and that array is used in the borg_create() function in<br />
usr/share/rear/lib/borg-functions.sh<br />
in a <code>borg create</code> call like</p>
<pre><code>borg create ... "${include_list[@]}"
</code></pre>
<p>which evaluates to</p>
<pre><code>borg create ... /home/ /opt/
</code></pre>
<p>which works with 'borg'.</p>
<p>Tertium datur:<br />
With <code>BACKUP_PROG_INCLUDE=( /home/* /opt/* )</code><br />
usr/share/rear/backup/BORG/default/400_create_include_exclude_files.sh<br />
creates $TMP_DIR/backup-include.txt which contains<br />
what bash pathname expansion results for <code>/home/*</code> and <code>/opt/*</code><br />
i.e. what</p>
<pre><code># echo /home/* /opt/*
</code></pre>
<p>outputs which is all files and directories in <code>/home/</code> and <code>/opt/</code><br />
(but not recursively for files in directories and sub-directories)<br />
and then $TMP_DIR/backup-include.txt is read by<br />
usr/share/rear/backup/BORG/default/500_make_backup.sh<br />
into a <code>include_list</code> array which then contains<br />
all files and directories in <code>/home/</code> and <code>/opt/</code><br />
and that array is used in the borg_create() function in<br />
usr/share/rear/lib/borg-functions.sh<br />
in a <code>borg create</code> call like</p>
<pre><code>borg create ... "${include_list[@]}"
</code></pre>
<p>which evaluates to</p>
<pre><code>borg create ... [all files and directories in /home/ and /opt/]
</code></pre>
<p>which likely also works with 'borg'.</p>
<h4 id="jsmeix_commented_at_2022-07-05_1206"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1174982322">2022-07-05 12:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-05_1206" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/9fc626918dc61b855e796d38b7fcee579136e88c">https://github.com/rear/rear/commit/9fc626918dc61b855e796d38b7fcee579136e88c</a><br />
there is now a a more generic description in default.conf<br />
about quoting to avoid bash pathname expansion<br />
and a better example</p>
<pre><code>BACKUP_PROG_INCLUDE=( /some/directory /path/to/some/file )
</code></pre>
<h4 id="jsmeix_commented_at_2022-07-05_1241"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1175013847">2022-07-05 12:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-05_1241" title="Permanent link">&para;</a></h4>
<p>Note the subtle difference:</p>
<pre><code>BACKUP_PROG_INCLUDE=( /home/* /opt/* )
</code></pre>
<p>evaluates to all files and directories in /home/ and /opt/<br />
(but not recursively for files in directories and sub-directories<br />
and also not to the directories /home and /opt itself)<br />
like on my current system</p>
<pre><code># echo /home/* /opt/*
/home/johannes /home/rear /opt/containerd /opt/google
</code></pre>
<p>so a backup tool that is called as</p>
<pre><code>backup_tool /home/johannes /home/rear /opt/containerd /opt/google
</code></pre>
<p>will backup all in</p>
<pre><code>/home/johannes /home/rear /opt/containerd /opt/google
</code></pre>
<p>but it may not backup the parent directories</p>
<pre><code>/home /opt
</code></pre>
<p>(in particular owner group permissions of that parent directories)<br />
so restoring that backup may not restore those parent directories<br />
(but create them anew from scratch with some default settings).</p>
<p>So in general it is better to keep it simple and specify</p>
<pre><code>BACKUP_PROG_INCLUDE=( /home /opt )
</code></pre>
<p>(bash pathname expansion for '/home' and '/opt' results '/home' and
'/opt')<br />
to backup the directories <code>/home</code> and <code>/opt</code><br />
with all what those directories contain.</p>
<h4 id="jsmeix_commented_at_2022-07-07_0625"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2833#issuecomment-1177144226">2022-07-07 06:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-07_0625" title="Permanent link">&para;</a></h4>
<p>I assume this issue is sufficiently answered so I close it.<br />
Further comments may be added regardless that it is closed<br />
or it could be reopened if needed.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-07-01.2833.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
