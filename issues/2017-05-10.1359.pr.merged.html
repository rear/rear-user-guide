<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2017 05 10.1359.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2017 05 10.1359.pr.merged";
        var mkdocs_page_input_path = "issues/2017-05-10.1359.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2017 05 10.1359.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1359_pr_merged_enhancement_what_modules_get_included_in_the_reovery_system"><a href="https://github.com/rear/rear/pull/1359">#1359 PR</a> <code>merged</code>: Enhancement what MODULES get included in the reovery system<a class="headerlink" href="#1359_pr_merged_enhancement_what_modules_get_included_in_the_reovery_system" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>, <code>cleanup</code>,
<code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="jsmeix_opened_issue_at_2017-05-10_1457"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/1359">2017-05-10 14:57</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2017-05-10_1457" title="Permanent link">&para;</a></h4>
<p>Implemented support for additional meta values like<br />
MODULES=( 'none' )<br />
MODULES=( 'all' )<br />
MODULES=( 'loaded' )<br />
in build/GNU/Linux/400_copy_modules.sh<br />
what MODULES get included in the recovery system<br />
see
<a href="https://github.com/rear/rear/issues/1202">https://github.com/rear/rear/issues/1202</a><br />
and
<a href="https://github.com/rear/rear/issues/1355">https://github.com/rear/rear/issues/1355</a></p>
<h4 id="jsmeix_commented_at_2017-05-10_1459"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300509810">2017-05-10 14:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-10_1459" title="Permanent link">&para;</a></h4>
<p>Do not yet merge it.<br />
This is only a very first attempt mainly FYI<br />
so that you could have a very first look.<br />
For now I only tested that the current default behaviour<br />
did not change for me (on SLES12), nothing else is tested yet.</p>
<h4 id="ubeaut_commented_at_2017-05-11_0540"><img src="https://avatars.githubusercontent.com/u/28617101?v=4" width="50"><a href="https://github.com/ubeaut">ubeaut</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300687841">2017-05-11 05:40</a>:<a class="headerlink" href="#ubeaut_commented_at_2017-05-11_0540" title="Permanent link">&para;</a></h4>
<p>Hi.<br />
I am new to this git stuff and I don't know if this is the correct place
for this comment.<br />
I have noticed that if I create a rescue disk on a headless system (no
keyboard or screen) and then I have to do a restore the usb keyboard
doesn't work. So if I need to enter anything on the screen I can't.<br />
I got around this problem by using a computer without a usb keyboard.<br />
Once I restored the system I plugged a USB keyboard into the restored
system and then created a rescue disk and then I tested that rescue disk
and the usb keyboard worked. I could enter things via keyboard.<br />
So my question is how can I insert the modules for a usb keyboard into
the rescue disk?<br />
Maybe have the usb modules for keyboard loaded by default?<br />
Other than that problem the restore worked well.<br />
Thanks</p>
<h4 id="jsmeix_commented_at_2017-05-11_0911"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300731176">2017-05-11 09:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_0911" title="Permanent link">&para;</a></h4>
<p>@ubeaut<br />
please use a separated GitHub issue<br />
to report things with USB keyboards.<br />
In general when reporting issues see<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/.github/ISSUE_TEMPLATE.md">https://raw.githubusercontent.com/rear/rear/master/.github/ISSUE_TEMPLATE.md</a><br />
In particular regarding USB keyboards have a look<br />
at the comments in<br />
<a href="https://github.com/rear/rear/pull/1244">https://github.com/rear/rear/pull/1244</a><br />
Do you use current ReaR GitHub master code?</p>
<h4 id="jsmeix_commented_at_2017-05-11_0951"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300741033">2017-05-11 09:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_0951" title="Permanent link">&para;</a></h4>
<p>@schlomo</p>
<p>I agree that MODULES=( 'all' ) should mean<br />
all modules that match $KERNEL_VERSION<br />
because no other kernel exists in the recovery system.</p>
<p>Regarding the ResolveModules and ModulesCopyTo<br />
functions: For my very first attempt I do all directly<br />
in the script. Later I will see to what extent it helps<br />
to extract things into separated functions. Then<br />
I may adapt linux-functions.sh appropriately.</p>
<p>Regarding the artificial 'for' loop:<br />
Depending on the particular case I prefer it<br />
over lengthy global 'if elif else fi' or 'case' constructs<br />
which add unnecessary levels of nesting and indentation.<br />
The artificial 'for' loop is my general way to make an<br />
arbitrary code block wherefrom I can jump forward<br />
and out at any place.<br />
It is my way to implement 'goto' as it is normally used<br />
in C to jump straight forward usually to some kind of<br />
"finishing" or "cleanup" code at the bottom, cf.<br />
<a href="http://stackoverflow.com/questions/245742/examples-of-good-gotos-in-c-or-c">http://stackoverflow.com/questions/245742/examples-of-good-gotos-in-c-or-c</a></p>
<h4 id="jsmeix_commented_at_2017-05-11_1117"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300759479">2017-05-11 11:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1117" title="Permanent link">&para;</a></h4>
<p>Now modules in EXCLUDE_MODULES are generically removed<br />
regardless if the module name or the module filename is<br />
specified in EXCLUDE_MODULES, cf.<br />
<a href="https://github.com/rear/rear/pull/1244#issuecomment-286718122">https://github.com/rear/rear/pull/1244#issuecomment-286718122</a></p>
<p>Now EXCLUDE_MODULES are removed in any case,<br />
also for MODULES=( 'all' ) and MODULES=( 'loaded' )<br />
so that the user has the final power.</p>
<h4 id="schlomo_commented_at_2017-05-11_1244"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300777593">2017-05-11 12:44</a>:<a class="headerlink" href="#schlomo_commented_at_2017-05-11_1244" title="Permanent link">&para;</a></h4>
<p>@jsmeix, I think that goto doesn't lead to clean code so that I would<br />
really prefer an if construct here. If the blocks are too long for
your<br />
taste then this is rather a sign that you should extract the block into
a<br />
function instead.</p>
<p>On 11 May 2017 at 13:17, Johannes Meixner <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>
wrote:</p>
<blockquote>
<p>Now modules in EXCLUDE_MODULES are generically removed<br />
regardless if the module name or the module filename is<br />
specified in EXCLUDE_MODULES, cf.<br />
#1244 (comment)
<a href="https://github.com/rear/rear/pull/1244">https://github.com/rear/rear/pull/1244</a></p>
<p>Now EXCLUDE_MODULES are removed in any case,<br />
also for MODULES=( 'all' ) and MODULES=( 'loaded' )<br />
so that the user has the final power.</p>
<p>—<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/1359#issuecomment-300759479">https://github.com/rear/rear/pull/1359#issuecomment-300759479</a>,
or mute<br />
the thread<br />
<a href="https://github.com/notifications/unsubscribe-auth/AAGMCIzjzlVmPpMyeJZM0i18AqaWxlrWks5r4u5MgaJpZM4NWyh8">https://github.com/notifications/unsubscribe-auth/AAGMCIzjzlVmPpMyeJZM0i18AqaWxlrWks5r4u5MgaJpZM4NWyh8</a><br />
.</p>
</blockquote>
<h4 id="jsmeix_commented_at_2017-05-11_1325"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300788323">2017-05-11 13:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1325" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I think we need to agree that we disagree here<br />
because from my point of view that 'goto' usage<br />
leads to cleaner code (of course "from my point of view"<br />
because otherwise I would not implement it this way).<br />
Perhaps there is a more obvious way in bash<br />
how to "jump out and straight forward"?<br />
I think it is a matter of taste who understands<br />
some kind of coding patterns better than others.</p>
<h4 id="jsmeix_commented_at_2017-05-11_1355"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300796580">2017-05-11 13:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1355" title="Permanent link">&para;</a></h4>
<p>I noticed that I have in "rear -d -D mkrescue" log<br />
things like (excerpts):</p>
<pre>
+ source /root/rear/usr/share/rear/rescue/GNU/Linux/260_storage_drivers.sh
...
++ IsInArray Module rbd xen-blkback ... nosy find: ''\''/lib/modules/4.4.21-69-default/kernel/drivers/ide'\'':' No such file or directory pata_sch ...
</pre>

<h4 id="jsmeix_commented_at_2017-05-11_1409"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300800995">2017-05-11 14:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1409" title="Permanent link">&para;</a></h4>
<p>According to</p>
<pre>
git log -p --follow usr/share/rear/rescue/GNU/Linux/230_storage_and_network_modules.sh
</pre>

<p>it seems<br />
rescue/GNU/Linux/230_storage_and_network_modules.sh<br />
was falsely fixed via<br />
<a href="https://github.com/rear/rear/commit/d6d1ff253a244dde4dbf5e0b5676150d028f1cf7">https://github.com/rear/rear/commit/d6d1ff253a244dde4dbf5e0b5676150d028f1cf7</a><br />
that reads</p>
<pre>
dropping find error messages
</pre>

<p>but implements it by adding '2&gt;&amp;1' that results</p>
<pre>
..._DRIVERS=( $( find ... 2>&1 | sed ... ) )
</pre>

<p>which adds the find error messages to the module arrays.<br />
I really appreciate the commment in that commit that tells what<br />
it intent is so that I can now easily fix it (without blind guessing<br />
what might have been actually meant with strange looking code).</p>
<h4 id="jsmeix_commented_at_2017-05-11_1506"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300818668">2017-05-11 15:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1506" title="Permanent link">&para;</a></h4>
<p>FYI: This is still work in progress and<br />
under somewhat heavy development<br />
but I think I make good progress towards<br />
more reliable, predicatable, and configurable<br />
kernel modules inclusion in the recovery system.</p>
<h4 id="jsmeix_commented_at_2017-05-11_1539"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-300829232">2017-05-11 15:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-11_1539" title="Permanent link">&para;</a></h4>
<p>At first glance the current code seems to work too good for me<br />
(on my SLES12 test system) - so that I believe there must be<br />
at least one evil regression hidden somewhere ;-)</p>
<p>On my SLES12 test system "rear mkbackup/mkrescue"<br />
and "rear recover" work for the default and<br />
for MODULES=( 'all_modules' )<br />
and MODULES=( 'loaded_modules' )<br />
and MODULES=( 'no_modules' ).</p>
<p>Even with MODULES=( 'no_modules' ) my recovery system<br />
comes up somewhat successfully to some extent but<br />
e.g. there is no networking because there is no network<br />
driver module (and things like that - as expected).</p>
<p>FYI:<br />
on my SLES12 test system I get<br />
those recovery system ISO sizes<br />
by default: 77M<br />
with MODULES=( 'all_modules' ): 94M<br />
with MODULES=( 'loaded_modules' ): 64M<br />
with MODULES=( 'no_modules' ): 61M</p>
<p>I made the recovery system ISOs<br />
with gzip default compression<br />
cf.
<a href="https://github.com/rear/rear/issues/1142">https://github.com/rear/rear/issues/1142</a><br />
and with FIRMWARE_FILES=( 'No' )<br />
cf.
<a href="https://github.com/rear/rear/issues/1216">https://github.com/rear/rear/issues/1216</a></p>
<h4 id="jsmeix_commented_at_2017-05-12_1205"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301059104">2017-05-12 12:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-12_1205" title="Permanent link">&para;</a></h4>
<p>Now I use those more explicit special MODULES values<br />
MODULES=( 'all_modules' )<br />
MODULES=( 'loaded_modules' )<br />
MODULES=( 'no_modules' )<br />
and I adapted my last comment<br />
<a href="https://github.com/rear/rear/pull/1359#issuecomment-300829232">https://github.com/rear/rear/pull/1359#issuecomment-300829232</a><br />
accordingly.</p>
<h4 id="jsmeix_commented_at_2017-05-12_1246"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301067026">2017-05-12 12:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-12_1246" title="Permanent link">&para;</a></h4>
<p>My current code works so well for me that I will merge it<br />
so that also others can test it and report if there are issues<br />
or even regressions which I will of course fix.</p>
<h4 id="schlomo_commented_at_2017-05-12_1256"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301069020">2017-05-12 12:56</a>:<a class="headerlink" href="#schlomo_commented_at_2017-05-12_1256" title="Permanent link">&para;</a></h4>
<p>Please make sure to also test the negative code flows, e.g. if a
module<br />
cannot be found.</p>
<p>On 12 May 2017 at 14:51, Johannes Meixner <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>
wrote:</p>
<blockquote>
<p>Merged #1359
<a href="https://github.com/rear/rear/pull/1359">https://github.com/rear/rear/pull/1359</a>.</p>
<p>—<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/1359#event-1079917314">https://github.com/rear/rear/pull/1359#event-1079917314</a>,
or mute the<br />
thread<br />
<a href="https://github.com/notifications/unsubscribe-auth/AAGMCNP-C7ynBSKEHqkaUneiPBZv1Tbiks5r5FW-gaJpZM4NWyh8">https://github.com/notifications/unsubscribe-auth/AAGMCNP-C7ynBSKEHqkaUneiPBZv1Tbiks5r5FW-gaJpZM4NWyh8</a><br />
.</p>
</blockquote>
<h4 id="jsmeix_commented_at_2017-05-12_1309"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301071974">2017-05-12 13:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-12_1309" title="Permanent link">&para;</a></h4>
<p>I had tested MODULES=( 'qqqq' ) and got<br />
in "rear -d -D recover" log</p>
<pre>
++ echo -e 'Copying kernel modules'
++ for module in '"${MODULES[@]}"'
++ module=qqqq
++ module=qqqq
++ modinfo qqqq
++ continue
++ for module in '"${MODULES[@]}"'
++ module=nfs
++ module=nfs
++ modinfo nfs
+++ modprobe --ignore-install --set-version 4.4.21-69-default --show-depends nfs
</pre>

<p>i.e. the non-existent module qqqq is silently ignored<br />
which is backward compatible - i.e. it matches the<br />
behaviour in ResolveModules</p>
<pre>
        for module in "$@"; do
            ...
                # Check if the module actually exists
                if ! modinfo $module &>/dev/null; then
                        continue
                fi
</pre>

<h4 id="jsmeix_commented_at_2017-05-12_1330"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301076650">2017-05-12 13:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-12_1330" title="Permanent link">&para;</a></h4>
<p>Now I did a more evil test (on my SLES12 system):</p>
<pre>
# modprobe --dry-run --show-depends lp
insmod /lib/modules/4.4.21-69-default/kernel/drivers/parport/parport.ko 
insmod /lib/modules/4.4.21-69-default/kernel/drivers/char/lp.ko 

# mv /lib/modules/4.4.21-69-default/kernel/drivers/parport/parport.ko /lib/modules/4.4.21-69-default/kernel/drivers/parport/away_parport.ko
# mv /lib/modules/4.4.21-69-default/kernel/drivers/parport/parport_pc.ko /lib/modules/4.4.21-69-default/kernel/drivers/parport/away_parport_pc.ko

# modprobe --dry-run --show-depends lp
modprobe: ERROR: ctx=0x22f0010 path=/lib/modules/4.4.21-69-default/kernel/drivers/parport/parport.ko error=No such file or directory
modprobe: ERROR: ctx=0x22f0010 path=/lib/modules/4.4.21-69-default/kernel/drivers/parport/parport.ko error=No such file or directory
insmod /lib/modules/4.4.21-69-default/kernel/drivers/char/lp.ko 
</pre>

<p>I have set in local.conf<br />
MODULES=( 'qqqq' 'lp' )<br />
and did with the old code</p>
<pre>
# usr/sbin/rear -d -D mkrescue
...
Copying binaries and libraries
Copying kernel modules
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='No')
</pre>

<p>No error about the missing 'parport' modules.</p>
<p>I got same bahavior with my new code</p>
<pre>
# usr/sbin/rear -d -D mkrescue
...
Copying binaries and libraries
Copying kernel modules
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='No')
</pre>

<p>so that I am sufficiently backward compatible<br />
but I wonder if such errors should better be detected<br />
and at least reported to the user via LogPrint?</p>
<h4 id="jsmeix_commented_at_2017-05-12_1425"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301091148">2017-05-12 14:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-12_1425" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
regarding your above question<br />
"Why do we need to support old distros seemingly forever?<br />
IMHO we should be able to draw a line and say that old<br />
distros stay on old ReaR versions."</p>
<p>In general see<br />
<a href="https://github.com/rear/rear/issues/1173">https://github.com/rear/rear/issues/1173</a></p>
<p>I do fully agree and SLES10 is already "out of support", see<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a><br />
at about line 1328:</p>
<pre>
Rear-2.00 dropped officially support for the following
Linux based operating systems:
  o Fedora <22
  o RHEL 3 and 4
  o SLES 9 and 10
  o openSUSE <11
  o Debian <6
  o Ubuntu <12
</pre>

<p>Unfortunately in this particular case I detected the crappy<br />
old modinfo behaviour by "bad luck" while playing around<br />
with the modules stuff also on my SLES10 system (just to<br />
get some experience how things work in a traditional way)<br />
but since I knew that misbehaviour I could not "just ignore" it<br />
so that I tried to make code that should behave reasonably<br />
even for the crappy old modinfo because I do not want<br />
to break SLES10 support knowingly as long as I can keep<br />
it working even on SLES10 (with reasonable effort) and<br />
perhaps also on whatever other "elderly" systems<br />
that may also have that crappy modinfo and<br />
might be even still "supported" by ReaR<br />
(I don't know what there is on RHEL 5 or CentOS 5).</p>
<p>Next time I will not play around on SLES10 ;-)</p>
<h4 id="jsmeix_commented_at_2017-05-15_1411"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1359#issuecomment-301487171">2017-05-15 14:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-15_1411" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1365">https://github.com/rear/rear/pull/1365</a>
merged<br />
stderr is no longer needlessly redirected to /dev/null<br />
see
<a href="https://github.com/rear/rear/pull/1359#discussion_r116239195">https://github.com/rear/rear/pull/1359#discussion_r116239195</a></p>
<p>In particular non-existent modules are now at least reported in the
log<br />
cf.
<a href="https://github.com/rear/rear/pull/1359#issuecomment-301071974">https://github.com/rear/rear/pull/1359#issuecomment-301071974</a></p>
<p>On the other hand useless stderr warnings from 'cp'<br />
are avoided by removing duplicate module files<br />
in the 'modprobe --show-depends' output, cf.<br />
<a href="http://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">http://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-05-10.1359.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
