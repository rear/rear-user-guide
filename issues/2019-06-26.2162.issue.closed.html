<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2162 Issue closed: NSRSERVER is missing - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2162 Issue closed: NSRSERVER is missing";
        var mkdocs_page_input_path = "issues/2019-06-26.2162.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2162 Issue closed: NSRSERVER is missing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2162_issue_closed_nsrserver_is_missing"><a href="https://github.com/rear/rear/issues/2162">#2162 Issue</a> <code>closed</code>: NSRSERVER is missing<a class="headerlink" href="#2162_issue_closed_nsrserver_is_missing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>external tool</code></p>
<h4 id="viper1986_opened_issue_at_2019-06-26_1244"><img src="https://avatars.githubusercontent.com/u/19300597?v=4" width="50"><a href="https://github.com/viper1986">viper1986</a> opened issue at <a href="https://github.com/rear/rear/issues/2162">2019-06-26 12:44</a>:<a class="headerlink" href="#viper1986_opened_issue_at_2019-06-26_1244" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4 / 2018-06-21</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    OS_VENDOR=SUSE_LINUX<br />
    OS_VERSION=12.4 PPC64</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>BACKUP=NSR
OUTPUT=ISO
OUTPUT_URL=nfs://169.254.251.200/rear
NSRSERVER=c301bcksrv1.bck.service.itdn.org
OUTPUT_OPTIONS="nfsvers=3,nolock"
KEEP_OLD_OUTPUT_COPY=y
POOLNAME=dd_os_all
NSR_RETENTION_TIME=Month
USE_CFG2HTML=y
AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PoverVM LPAR</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    PPC64LE</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    GRUB</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    I use BACKUP=NSR and setup NSRSERVER in site.conf file.<br />
    This is first backup and the /nsr/res/nsrladb is not exist, also I
    don't use servers file.</p>
</li>
</ul>
<p>When I run rear mkbackup variable NSRSERVER is set to none by script
650_check_iso_recoverable.sh:</p>
<pre><code>2019-06-26 13:57:32.916617483 Including layout/save/default/450_check_network_files.sh
2019-06-26 13:57:32.920296595 Including layout/save/GNU/Linux/500_extract_vgcfg.sh
2019-06-26 13:57:33.134367561 Including layout/save/GNU/Linux/510_current_disk_usage.sh
2019-06-26 13:57:33.142667368 Including layout/save/default/600_snapshot_files.sh
2019-06-26 13:57:33.149829316 Including layout/save/NSR/default/650_check_iso_recoverable.sh
cat: /var/lib/rear/recovery/nsr_server: No such file or directory
2019-06-26 13:57:33.156270045 No Networker ISO Backups found.
2019-06-26 13:57:33.157700480 Finished running 'layout/save' stage in 8 seconds
2019-06-26 13:57:33.158781120 ======================
2019-06-26 13:57:33.159677787 Running 'rescue' stage
2019-06-26 13:57:33.160673863 ======================
...
2019-06-26 13:57:37.030321758 Created the EMC NetWorker nsrexecd start-up script (90-networker.sh) for ReaR
2019-06-26 13:57:37.034303022 Including rescue/NSR/default/460_save_nsr_server_name.sh
2019-06-26 13:57:37.038205971 The EMC NetWorker server name could not be found automatically.
2019-06-26 13:57:37.039712655 ERROR: Please define manually the EMC NetWorker server name under /nsr/res/servers
==== Stack trace ====
Trace 0: /usr/sbin/nsr_rear:543 main
Trace 1: /usr/share/rear/lib/mkbackup-workflow.sh:13 WORKFLOW_mkbackup
Trace 2: /usr/share/rear/lib/framework-functions.sh:101 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:49 Source
Trace 4: /usr/share/rear/rescue/NSR/default/460_save_nsr_server_name.sh:14 source
Message: Please define manually the EMC NetWorker server name under /nsr/res/servers
</code></pre>
<p>I add echo "$NSRSERVER" in front of NSRSERVER=$(cat
$VAR_DIR/recovery/nsr_server ) in file 650_check_iso_recoverable.sh
:</p>
<pre><code>2019-06-26 14:27:23.199212379 Including layout/save/NSR/default/650_check_iso_recoverable.sh
c301bcksrv1.bck.service.itdn.org
cat: /var/lib/rear/recovery/nsr_server: No such file or directory
2019-06-26 14:27:23.205755228 No Networker ISO Backups found.
2019-06-26 14:27:23.207091227 Finished running 'layout/save' stage in 8 seconds
...
2019-06-26 14:27:27.164521295 Created the EMC NetWorker nsrexecd start-up script (90-networker.sh) for ReaR
2019-06-26 14:27:27.168189601 Including rescue/NSR/default/460_save_nsr_server_name.sh
2019-06-26 14:27:27.171916754 The EMC NetWorker server name could not be found automatically.
2019-06-26 14:27:27.173309183 ERROR: Please define manually the EMC NetWorker server name under /nsr/res/servers
==== Stack trace ====
Trace 0: /usr/sbin/nsr_rear:543 main
Trace 1: /usr/share/rear/lib/mkbackup-workflow.sh:13 WORKFLOW_mkbackup
Trace 2: /usr/share/rear/lib/framework-functions.sh:101 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:49 Source
Trace 4: /usr/share/rear/rescue/NSR/default/460_save_nsr_server_name.sh:14 source
Message: Please define manually the EMC NetWorker server name under /nsr/res/servers
</code></pre>
<p>I'm not sure that this should work in that way. There should be some if
statement to detect if NSRSERVER is set or not.</p>
<h4 id="jsmeix_commented_at_2019-06-27_0855"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-506257639">2019-06-27 08:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-27_0855" title="Permanent link">&para;</a></h4>
<p>@viper1986<br />
regarding <code>BACKUP=NSR</code>:<br />
In general there is nothing at all what I could do in case of issues<br />
with third-party backup tools or any other third-party software<br />
because I do not have such software on my test systems<br />
so that I can neither test nor reproduce anything.</p>
<p>The last two adaptions and enhancements<br />
for <code>BACKUP=NSR</code> were done by<br />
@hpannenb via<br />
<a href="https://github.com/rear/rear/pull/2058">https://github.com/rear/rear/pull/2058</a><br />
and<br />
<a href="https://github.com/rear/rear/pull/1584">https://github.com/rear/rear/pull/1584</a></p>
<p>@hpannenb<br />
could you have a look here?</p>
<h4 id="gdha_commented_at_2019-09-11_1211"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-530352203">2019-09-11 12:11</a>:<a class="headerlink" href="#gdha_commented_at_2019-09-11_1211" title="Permanent link">&para;</a></h4>
<p>@viper1986 Please check the script
<code>/usr/share/rear/rescue/NSR/default/460_save_nsr_server_name.sh</code> which
should have safed the NSRSERVER content to the file
<code>$VAR_DIR/recovery/nsr_server</code><br />
Please run <code>rear vD mkrescue</code> for debugging output. It will allow you to
see what really happens in the above mentioned script.</p>
<h4 id="hpannenb_commented_at_2019-09-13_0543"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-531106136">2019-09-13 05:43</a>:<a class="headerlink" href="#hpannenb_commented_at_2019-09-13_0543" title="Permanent link">&para;</a></h4>
<p>@viper1986 and @gdha: Sorry for answering so late. As far as I can see
the code changes I made do not affect the NSRSERVER variable. In my
environment the NSRSERVER will be automatically detected with means of
the code of <code>460_save_nsr_server_name.sh</code>.</p>
<h4 id="gdha_commented_at_2019-10-05_1001"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-538635986">2019-10-05 10:01</a>:<a class="headerlink" href="#gdha_commented_at_2019-10-05_1001" title="Permanent link">&para;</a></h4>
<p>@hpannenb Code changes you made? Sorry, are you referring to an older
PR? (And now I'm so late with my answer)</p>
<h4 id="viper1986_commented_at_2019-10-07_1105"><img src="https://avatars.githubusercontent.com/u/19300597?v=4" width="50"><a href="https://github.com/viper1986">viper1986</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-538954241">2019-10-07 11:05</a>:<a class="headerlink" href="#viper1986_commented_at_2019-10-07_1105" title="Permanent link">&para;</a></h4>
<p>Hello all,<br />
@hpannenb in 460_save_nsr_server_name.sh there is a if:</p>
<pre><code>if [[ ! -z "$NSRSERVER" ]]; then
    : # do nothing
elif [[ -f $NSR_ROOT_DIR/res/servers ]]; then
    NSRSERVER=$( cat $NSR_ROOT_DIR/res/servers | head -1 )
elif [[ -d $NSR_ROOT_DIR/res/nsrladb/03 ]]; then
    NSRSERVER=$(grep servers $NSR_ROOT_DIR/res/nsrladb/*/* | tail -1 | awk '{print $2}' | sed -e 's/[;,]//' )
fi
</code></pre>
<ul>
<li>$NSR_ROOT_DIR/res/servers - I do not use this file</li>
<li>$NSR_ROOT_DIR/res/nsrladb/03 - is not exist when there is no
    backup performed before</li>
<li>$NSRSERVER - is set to null by script
    650_check_iso_recoverable.sh which is running before
    460_save_nsr_server_name.sh</li>
</ul>
<p>Script 650_check_iso_recoverable.sh contains line:</p>
<pre><code>NSRSERVER=$(cat $VAR_DIR/recovery/nsr_server )
</code></pre>
<ul>
<li>file $VAR_DIR/recovery/nsr_server is not exist in my case because
    this is first backup of this server.</li>
</ul>
<p>I think that script 650_check_iso_recoverable.sh contains should
looks a little bit different for example<br />
if file $VAR_DIR/recovery/nsr_server is not exist, use variable from
file site.conf or os.conf ... or something like that.</p>
<h4 id="hpannenb_commented_at_2019-10-12_1705"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-541343374">2019-10-12 17:05</a>:<a class="headerlink" href="#hpannenb_commented_at_2019-10-12_1705" title="Permanent link">&para;</a></h4>
<p>@gdha and @viper1986: What I mean is I did not write the main code for
the Legato Networker and just added few snippets (the NSR_CLIENT_MODE)
to the existing NSR workflow.</p>
<p>@viper1986:<br />
Proposed workaround(s):<br />
In <code>650_check_iso_recoverable.sh</code> comment in the line as follows<br />
<code>#NSRSERVER=$(cat $VAR_DIR/recovery/nsr_server )</code><br />
or<br />
use the more sofisticated code snippet taken from <code>400_verify_nsr.sh</code>
instead:<br />
[...]</p>
<pre><code>if [[ ! -z "$NSRSERVER" ]]; then
    Log "NSRSERVER ($NSRSERVER) was defined in $CONFIG_DIR/local.conf"
elif [[ -f $VAR_DIR/recovery/nsr_server ]]; then
    NSRSERVER=$( cat $VAR_DIR/recovery/nsr_server )
else
    Error "Could not retrieve the EMC NetWorker Server name. Define NSRSERVER in $CONFIG_DIR/local.conf file"
fi
</code></pre>
<p>[...]</p>
<p>Please let us know if this working for You. I think a final code change
will be required in the script otherwise Your NSR approach will not work
for anyone.</p>
<p>P.S.:<br />
I checked the 1st workaround in my company's environment and it is
working as supposed:</p>
<ol>
<li>Set the <code>NSRSERVER=testing</code> in<code>local.conf</code>: In script
    <code>650_check_iso_recoverable.sh</code> the <code>nsrinfo -s testing -N ...</code>
    fails. =&gt; "testing" server does not exist: OK.</li>
<li>Set NSRSERVER to the correct name in <code>local.conf</code>: Networker backup
    of ISO works as supposed to. =&gt; OK.</li>
<li>Remove NSRSERVER in <code>local.conf</code>: NSRSERVER is gathered from
    <code>/nsr/resr/nsrladb/...</code>and Networker backup of ISO works as
    supposed to. =&gt; OK.</li>
<li>Remove NSRSERVER in <code>local.conf</code> and re-create <code>/nsr/res/servers</code>
    (default in my company: Networker backup of ISO works as supposed
    to. =&gt; OK.</li>
</ol>
<p>So IMHO removing the line
<code>NSRSERVER=$(cat $VAR_DIR/recovery/nsr_server )</code> from the script
<code>650_check_iso_recoverable.sh</code> in the existing code will not harm the
execution of the NSR workflow.</p>
<h4 id="jsmeix_commented_at_2019-11-05_1334"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2162#issuecomment-549824698">2019-11-05 13:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-05_1334" title="Permanent link">&para;</a></h4>
<p>I do not use NSR but I hope<br />
with
<a href="https://github.com/rear/rear/pull/2271">https://github.com/rear/rear/pull/2271</a>
merged<br />
this issue is fixed.</p>
<p>@hpannenb<br />
thank you for your fix!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-06-26.2162.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
