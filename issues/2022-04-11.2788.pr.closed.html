<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2788 PR closed: Detect by UUIDs if restored config files do not match what was recreated - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2788 PR closed: Detect by UUIDs if restored config files do not match what was recreated";
        var mkdocs_page_input_path = "issues/2022-04-11.2788.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2788 PR closed: Detect by UUIDs if restored config files do not match what was recreated</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2788_pr_closed_detect_by_uuids_if_restored_config_files_do_not_match_what_was_recreated"><a href="https://github.com/rear/rear/pull/2788">#2788 PR</a> <code>closed</code>: Detect by UUIDs if restored config files do not match what was recreated<a class="headerlink" href="#2788_pr_closed_detect_by_uuids_if_restored_config_files_do_not_match_what_was_recreated" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>won't fix / can't fix / obsolete</code></p>
<h4 id="jsmeix_opened_issue_at_2022-04-11_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/2788">2022-04-11 13:17</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2022-04-11_1317" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>High</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2787">https://github.com/rear/rear/issues/2787</a><br />
<a href="https://github.com/rear/rear/issues/2785">https://github.com/rear/rear/issues/2785</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Curently only a "rear mkrescue" test on my homeoffice laptop</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>During "rear mkrescue/mkbackup/mkbackuponly/savelayout"<br />
save which UUIDs in disklayout.conf appear<br />
in a config file in CHECK_CONFIG_FILES<br />
which is used for comparison during "rear recover"<br />
if those UUIDs in disklayout.conf still appear<br />
in a restored config file in CHECK_CONFIG_FILES<br />
in the recreated system under /mnt/local</p>
<p>The main reason is to avoid false alarm<br />
when UUIDs in disklayout.conf do not appear in a config file<br />
on the original system - then those UUIDs do not need to<br />
be checked in the recreated system.</p>
<h4 id="jsmeix_commented_at_2022-04-11_1336"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1095062442">2022-04-11 13:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-11_1336" title="Permanent link">&para;</a></h4>
<p>The default CHECK_CONFIG_FILES is insufficient<br />
(in particular /etc/fstab is missing)<br />
so that needs to be adapted to make it useful</p>
<p>For my test I have in my etc/rear/local.conf</p>
<pre><code>CHECK_CONFIG_FILES+=( /etc )
</code></pre>
<p>On my rather slow Intel i3 Laptop with a spinning disk<br />
I did a test after a reeboot so that the file buffer caches are cold<br />
and usr/share/rear/layout/save/default/600_snapshot_files.sh<br />
did run from 2022-04-12 10:42:49.598645397<br />
until 2022-04-12 10:42:55.001197954<br />
so about 5 seconds to check whole /etc/ with cold caches.</p>
<p>I got this /var/tmp/rear.GSxN9PoPwczFS6f/rootfs/etc/rear/rescue.conf<br />
(excerpt):</p>
<pre><code># The following line was added by layout/save/default/600_snapshot_files.sh
DISKLAYOUT_UUIDS_IN_CONFIG_FILES='259dac9c-f2fd-4181-a351-83603398e465 4a42395e-4f9d-4056-9948-6d5d9d92d990 4c4a923d-1562-4254-a1fa-4e761278c02f 54fc77c5-8ec2-457f-b558-9deda3b843b2 6d8f8998-dd20-412a-bcc2-618eed858662 a6dba0d8-5be8-4970-b1e7-a272ae0cafdd f05af948-6075-40a3-9191-354b0a0a9afc '
</code></pre>
<p>The lines with a UUID in disklayout.conf</p>
<pre><code># grep "uuid=[[:alnum:]]" var/lib/rear/layout/disklayout.conf

fs /dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part3 / ext4 uuid=f05af948-6075-40a3-9191-354b0a0a9afc label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16383 default_mount_options=user_xattr,acl options=rw,relatime
fs /dev/sda4 /nfs ext4 uuid=4c4a923d-1562-4254-a1fa-4e761278c02f label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw,relatime
fs /dev/sda5 /var/lib/libvirt ext4 uuid=4a42395e-4f9d-4056-9948-6d5d9d92d990 label= blocksize=4096 reserved_blocks=1% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw,relatime
#fs /dev/sda6 /other ext2 uuid=259dac9c-f2fd-4181-a351-83603398e465 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw,relatime
swap /dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part2 uuid=6d8f8998-dd20-412a-bcc2-618eed858662 label=
crypt /dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part3 /dev/sda3 type=luks1 cipher=aes-xts-plain64 key_size=256 hash=sha256 uuid=a6dba0d8-5be8-4970-b1e7-a272ae0cafdd 
crypt /dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part2 /dev/sda2 type=luks1 cipher=aes-xts-plain64 key_size=256 hash=sha256 uuid=54fc77c5-8ec2-457f-b558-9deda3b843b2
</code></pre>
<p>The UUIDs in files in /etc:</p>
<pre><code># for u in f05af948-6075-40a3-9191-354b0a0a9afc 4c4a923d-1562-4254-a1fa-4e761278c02f 4a42395e-4f9d-4056-9948-6d5d9d92d990 259dac9c-f2fd-4181-a351-83603398e465 6d8f8998-dd20-412a-bcc2-618eed858662 a6dba0d8-5be8-4970-b1e7-a272ae0cafdd 54fc77c5-8ec2-457f-b558-9deda3b843b2 ; do find /etc -type f | xargs grep $u ; echo ; done

/etc/fstab:UUID=f05af948-6075-40a3-9191-354b0a0a9afc  /                 ext4  acl,user_xattr  0  1
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/f05af948-6075-40a3-9191-354b0a0a9afc",

/etc/fstab:UUID=4c4a923d-1562-4254-a1fa-4e761278c02f  /nfs              ext4  defaults        0  2
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/4c4a923d-1562-4254-a1fa-4e761278c02f",

/etc/fstab:UUID=4a42395e-4f9d-4056-9948-6d5d9d92d990  /var/lib/libvirt  ext4  defaults        0  2
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/4a42395e-4f9d-4056-9948-6d5d9d92d990",

/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/259dac9c-f2fd-4181-a351-83603398e465",

/etc/fstab:UUID=6d8f8998-dd20-412a-bcc2-618eed858662  swap              swap  defaults        0  0
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/6d8f8998-dd20-412a-bcc2-618eed858662",

/etc/crypttab:cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part3  UUID=a6dba0d8-5be8-4970-b1e7-a272ae0cafdd
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/a6dba0d8-5be8-4970-b1e7-a272ae0cafdd",

/etc/crypttab:cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part2  UUID=54fc77c5-8ec2-457f-b558-9deda3b843b2
/etc/lvm/cache/.cache:          "/dev/disk/by-uuid/54fc77c5-8ec2-457f-b558-9deda3b843b2",
</code></pre>
<p>My block devices:</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT,UUID

NAME                                     KNAME     PKNAME    TRAN   TYPE  FSTYPE      LABEL   SIZE MOUNTPOINT       UUID
/dev/sda                                 /dev/sda            sata   disk                    465.8G                  
|-/dev/sda1                              /dev/sda1 /dev/sda         part                        8M                  
|-/dev/sda2                              /dev/sda2 /dev/sda         part  crypto_LUKS           4G                  54fc77c5-8ec2-457f-b558-9deda3b843b2
| `-/dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part2
|                                        /dev/dm-1 /dev/sda2        crypt swap                  4G [SWAP]           6d8f8998-dd20-412a-bcc2-618eed858662
|-/dev/sda3                              /dev/sda3 /dev/sda         part  crypto_LUKS         200G                  a6dba0d8-5be8-4970-b1e7-a272ae0cafdd
| `-/dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part3
|                                        /dev/dm-0 /dev/sda3        crypt ext4                200G /                f05af948-6075-40a3-9191-354b0a0a9afc
|-/dev/sda4                              /dev/sda4 /dev/sda         part  ext4                100G /nfs             4c4a923d-1562-4254-a1fa-4e761278c02f
|-/dev/sda5                              /dev/sda5 /dev/sda         part  ext4                150G /var/lib/libvirt 4a42395e-4f9d-4056-9948-6d5d9d92d990
|-/dev/sda6                              /dev/sda6 /dev/sda         part  ext2                  8G /other           259dac9c-f2fd-4181-a351-83603398e465
|-/dev/sda7                              /dev/sda7 /dev/sda         part  crypto_LUKS           1G                  1b4198c9-d9b0-4c57-b9a3-3433e391e706
`-/dev/sda8                              /dev/sda8 /dev/sda         part  crypto_LUKS           1G                  3e874a28-7415-4f8c-9757-b3f28a96c4d2
/dev/sr0                                 /dev/sr0            sata   rom                      1024M
</code></pre>
<p>This are quick raw results from my very first test.<br />
I did not check any details.</p>
<h4 id="jsmeix_commented_at_2022-04-11_1345"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1095073103">2022-04-11 13:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-11_1345" title="Permanent link">&para;</a></h4>
<p>I will continue tomorrow with the "rear recover" part (as time permits).</p>
<h4 id="jsmeix_commented_at_2022-04-12_1013"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1096502115">2022-04-12 10:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-12_1013" title="Permanent link">&para;</a></h4>
<p>I will test now the "rear recover" part...</p>
<h4 id="jsmeix_commented_at_2022-04-12_1227"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1096661054">2022-04-12 12:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-12_1227" title="Permanent link">&para;</a></h4>
<p>Now "rear recover" reports when a UUID that was in at least one of the
config files<br />
in CHECK_CONFIG_FILES at the time when disklayout.conf was created<br />
is not in at least one of the restored config files in
CHECK_CONFIG_FILES.</p>
<p>I did this "rear mkbackup" and "rear recover" test here<br />
on a different system (now on two same VMs)<br />
than the above so UUIDs are different here.</p>
<p>I tested it by modifying a UUID in
DISKLAYOUT_UUIDS_IN_CONFIG_FILES<br />
in /etc/rear/rescue.conf in the ReaR recovery system before running
"rear recover"<br />
and got on the terminal</p>
<pre><code>Running 'finalize' stage ======================
...
UUID QQQe2NM5J-brmg-6kic-exST-oBwb-GY2h-KREbYJ not found in a restored config file (likely this must be manually corrected)
</code></pre>
<p>(I prepended the UUID with <code>QQQ</code> in /etc/rear/rescue.conf).</p>
<h4 id="jsmeix_commented_at_2022-04-12_1229"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1096663907">2022-04-12 12:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-12_1229" title="Permanent link">&para;</a></h4>
<p>@pcahyna @rear/contributors<br />
could you please have a look here and tell me what you think about it.</p>
<p>See in particular my explanatory comment about it at the beginning of<br />
usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh</p>
<h4 id="jsmeix_commented_at_2022-04-12_1255"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1096692345">2022-04-12 12:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-12_1255" title="Permanent link">&para;</a></h4>
<p>@bwelterl<br />
if you like you may try out what I have here up to now.</p>
<h4 id="jsmeix_commented_at_2022-04-13_0938"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1097814777">2022-04-13 09:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-13_0938" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/pull/2788/commits/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa">https://github.com/rear/rear/pull/2788/commits/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa</a><br />
I explained in default.conf that CHECK_CONFIG_FILES is also used
during "rear recover"<br />
to detect if restored config files do not match what was recreated<br />
and<br />
I added /etc/fstab and /etc/crypttab to the default
CHECK_CONFIG_FILES<br />
because they can contain UUIDs that are relevant for "rear recover"<br />
according to what I currently get on my homeoffice laptop:</p>
<pre><code># lsblk -ipo KNAME,TYPE,FSTYPE,MOUNTPOINT,UUID,PTUUID,PARTUUID

KNAME     TYPE  FSTYPE      MOUNTPOINT       UUID                                 PTUUID                               PARTUUID
/dev/sda  disk                                                                    9be0015e-cf90-4c6b-80ac-c4ea89832553 
/dev/sda1 part                                                                    9be0015e-cf90-4c6b-80ac-c4ea89832553 4a795619-730c-4e74-854b-59ea03e4f1ab
/dev/sda2 part  crypto_LUKS                  54fc77c5-8ec2-457f-b558-9deda3b843b2 9be0015e-cf90-4c6b-80ac-c4ea89832553 ab0c1a1e-729a-4f9d-9961-9a090fc850f4
/dev/sda3 part  crypto_LUKS                  a6dba0d8-5be8-4970-b1e7-a272ae0cafdd 9be0015e-cf90-4c6b-80ac-c4ea89832553 27533ab0-2616-4e49-89c3-8d7158636d30
/dev/sda4 part  ext4        /nfs             4c4a923d-1562-4254-a1fa-4e761278c02f 9be0015e-cf90-4c6b-80ac-c4ea89832553 047a5693-3b2f-4586-9d9f-5b4b25680f81
/dev/sda5 part  ext4        /var/lib/libvirt 4a42395e-4f9d-4056-9948-6d5d9d92d990 9be0015e-cf90-4c6b-80ac-c4ea89832553 a42060c3-33d5-4986-8a9f-41753ab83aa1
/dev/sda6 part  ext2                         259dac9c-f2fd-4181-a351-83603398e465 9be0015e-cf90-4c6b-80ac-c4ea89832553 630abca0-e067-44a0-bc97-8d8fac21b067
/dev/sda7 part  crypto_LUKS                  1b4198c9-d9b0-4c57-b9a3-3433e391e706 9be0015e-cf90-4c6b-80ac-c4ea89832553 1ffae0c8-1212-428c-bf9e-4c3e635763bb
/dev/sda8 part  crypto_LUKS                  3e874a28-7415-4f8c-9757-b3f28a96c4d2 9be0015e-cf90-4c6b-80ac-c4ea89832553 3af73460-4ed7-4000-b471-7c1eb35b6bc7
/dev/sr0  rom                                                                                                          
/dev/dm-0 crypt swap        [SWAP]           6d8f8998-dd20-412a-bcc2-618eed858662                                      
/dev/dm-1 crypt ext4        /                f05af948-6075-40a3-9191-354b0a0a9afc

# for uuid in $( lsblk -no UUID,PTUUID,PARTUUID ) ; do find /etc -type f | xargs grep -il $uuid ; done | sort -u

/etc/crypttab
/etc/fstab
/etc/lvm/cache/.cache

# for u in $( lsblk -no UUID,PTUUID,PARTUUID ) ; do grep -io $u var/lib/rear/layout/disklayout.conf ; done | sort -u

1b4198c9-d9b0-4c57-b9a3-3433e391e706
259dac9c-f2fd-4181-a351-83603398e465
3e874a28-7415-4f8c-9757-b3f28a96c4d2
4a42395e-4f9d-4056-9948-6d5d9d92d990
4c4a923d-1562-4254-a1fa-4e761278c02f
54fc77c5-8ec2-457f-b558-9deda3b843b2
6d8f8998-dd20-412a-bcc2-618eed858662
a6dba0d8-5be8-4970-b1e7-a272ae0cafdd
f05af948-6075-40a3-9191-354b0a0a9afc

# for uuid in $( for u in $( lsblk -no UUID,PTUUID,PARTUUID ) ; do grep -io $u var/lib/rear/layout/disklayout.conf ; done | sort -u ) ; do find /etc -type f | xargs grep -il $uuid ; done | sort -u

/etc/crypttab
/etc/fstab
/etc/lvm/cache/.cache
</code></pre>
<p>I ignored <code>/etc/lvm/cache/.cache</code> because I think this one<br />
is not actually relevant for "rear recover".</p>
<h4 id="jsmeix_commented_at_2022-04-13_0952"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1097835984">2022-04-13 09:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-13_0952" title="Permanent link">&para;</a></h4>
<p>From my current point of view this pull request should be now OK<br />
(but I did not yet test what UUIDs are used with LVM and RAID<br />
so some more config files may need to be added to<br />
the default CHECK_CONFIG_FILES).</p>
<p>If there are no objections I would like to merge it next week<br />
(as time permits probably on Wednesday afternoon or a bit later)<br />
so that there will be at least a simple test during "rear recover"<br />
that can detect if restored config files do not match what was
recreated,<br />
cf.
<a href="https://github.com/rear/rear/issues/2787#issuecomment-1091793474">https://github.com/rear/rear/issues/2787#issuecomment-1091793474</a></p>
<h4 id="jsmeix_commented_at_2022-04-13_1021"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1097873697">2022-04-13 10:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-13_1021" title="Permanent link">&para;</a></h4>
<p>Automated fixing UUIDs in restored config files<br />
if UUIDs in restored config files do not match the UUIDS in
disklayout.conf<br />
will not be part of this pull request.</p>
<p>Reasons:</p>
<p>In general:<br />
First things first, one step at a time, and one after the other.</p>
<p>In particular:<br />
Currently I have no idea how to implement such automated fixing.<br />
Assume we save /etc/fstab at "rear mkrescue" time in the recovery
system<br />
(so UUIDs in the saved fstab match those in disklayout.conf).<br />
Assume UUIDs in the restored fstab differ.<br />
How could we know what is the right UUID to replace a wrong UUID<br />
without specific context knowledge of the particular file?<br />
One of the UUIDs in disklayout.conf is the right UUID<br />
but what is the matching wrong UUID in fstab?<br />
I think we cannot rely on line numbers.<br />
So I think we need specific context knowledge of the particular file.<br />
But this requires a specific parser for each particular config file<br />
which is not what I would implement.</p>
<p>Conclusion:<br />
From my current point of view I think a test during "rear recover"<br />
that shows such issues to the user is all what we can implement<br />
and continuously maintain in the future with reasonable effort.</p>
<p>A possible further enhancement (not in this pull request):<br />
When we save the config files in CHECK_CONFIG_FILES<br />
at "rear mkrescue" time somewhere in the recovery system,<br />
we could show better info to the user because we could<br />
show which specific config file does not match<br />
and<br />
the user could see the differences in the file which would provide<br />
needed file specific context to the user so it should be much easier<br />
for the user to manually correct such issues, cf.<br />
<a href="https://github.com/rear/rear/issues/2785#issuecomment-1091802968">https://github.com/rear/rear/issues/2785#issuecomment-1091802968</a></p>
<h4 id="pcahyna_commented_at_2022-04-13_1622"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1098247136">2022-04-13 16:22</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-13_1622" title="Permanent link">&para;</a></h4>
<p>@jsmeix sorry for my late reaction, I took a day off yesterday. I will
have a look at your changes and comment.</p>
<h4 id="pcahyna_commented_at_2022-04-14_1330"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1099189225">2022-04-14 13:30</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-14_1330" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>The main reason is to avoid false alarm<br />
when UUIDs in disklayout.conf do not appear in a config file<br />
on the original system - then those UUIDs do not need to<br />
be checked in the recreated system.</p>
</blockquote>
<p>can you please give an example of this false alarm? Does this false
alarm occur with the current ReaR code?</p>
<h4 id="pcahyna_commented_at_2022-04-14_1337"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1099195961">2022-04-14 13:37</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-14_1337" title="Permanent link">&para;</a></h4>
<p>@jsmeix isn't it a mistake that
<code>layout/compare/default/510_compare_files.sh</code> is not executed after
restoring the backup (the checksums seem to be used only at
<code>checklayout</code>)? I think it would be enough to detect the problem, and
likely other problems due to inconsistent backups as well.</p>
<h4 id="bwelterl_commented_at_2022-04-14_1354"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1099211846">2022-04-14 13:54</a>:<a class="headerlink" href="#bwelterl_commented_at_2022-04-14_1354" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@jsmeix</p>
<blockquote>
<p>The main reason is to avoid false alarm<br />
when UUIDs in disklayout.conf do not appear in a config file<br />
on the original system - then those UUIDs do not need to<br />
be checked in the recreated system.</p>
</blockquote>
<p>can you please give an example of this false alarm? Does this false
alarm occur with the current ReaR code?</p>
</blockquote>
<p>From the list of files that are checked
([b]oot/{grub.conf,menu.lst,device.map} [e]tc/grub.*
[b]oot/grub/{grub.conf,grub.cfg,menu.lst,device.map}
[b]oot/grub2/{grub.conf,grub.cfg,menu.lst,device.map}
[e]tc/sysconfig/grub [e]tc/sysconfig/bootloader [e]tc/lilo.conf
[e]tc/elilo.conf [e]tc/mtab [e]tc/fstab [e]tc/mtools.conf
[e]tc/smartd.conf [e]tc/sysconfig/smartmontools
[e]tc/sysconfig/rawdevices [e]tc/security/pam_mount.conf.xml
[b]oot/efi/<em>/</em>/grub.cfg),some are restored but does not include
automatically the UUID that should be updated (seen the issue with
grub.cfg for example).</p>
<h4 id="pcahyna_commented_at_2022-04-14_1403"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1099220366">2022-04-14 14:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-14_1403" title="Permanent link">&para;</a></h4>
<blockquote>
<p>From the list of files that are checked
([b]oot/{grub.conf,menu.lst,device.map} [e]tc/grub.*
[b]oot/grub/{grub.conf,grub.cfg,menu.lst,device.map}
[b]oot/grub2/{grub.conf,grub.cfg,menu.lst,device.map}
[e]tc/sysconfig/grub [e]tc/sysconfig/bootloader [e]tc/lilo.conf
[e]tc/elilo.conf [e]tc/mtab [e]tc/fstab [e]tc/mtools.conf
[e]tc/smartd.conf [e]tc/sysconfig/smartmontools
[e]tc/sysconfig/rawdevices [e]tc/security/pam_mount.conf.xml
[b]oot/efi/<em>/</em>/grub.cfg),some are restored but does not include
automatically the UUID that should be updated (seen the issue with
grub.cfg for example).</p>
</blockquote>
<p>Sure, but does this lead to any alarm currently?</p>
<p>My point is that</p>
<blockquote>
<p>The main reason is to avoid false alarm<br />
when UUIDs in disklayout.conf do not appear in a config file<br />
on the original system - then those UUIDs do not need to<br />
be checked in the recreated system.</p>
</blockquote>
<p>sounds like an explanation of the reason for this change, but is it the
intent really?</p>
<h4 id="jsmeix_commented_at_2022-04-20_0845"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103634790">2022-04-20 08:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0845" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your questions in<br />
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1099189225">https://github.com/rear/rear/pull/2788#issuecomment-1099189225</a></p>
<pre><code>can you please give an example of this false alarm?
Does this false alarm occur with the current ReaR code?
</code></pre>
<p>Currently I cannot give an example<br />
that a UUIDs in disklayout.conf does not appear in a config file.<br />
On my homeoffice laptop all UUIDs in disklayout.conf<br />
appear either in /etc/fstab or in /etc/crypttab<br />
but none appears in both files.</p>
<p>There is no false alarm with the current ReaR master code<br />
simply because there is not any alarm in ReaR master code<br />
when UUIDs in disklayout.conf that had been in a config file<br />
do no longer appear in a restored config file.</p>
<p>It is the whole purpose of this pull request to implement<br />
to raise alarm when a UUID in disklayout.conf that had been in a config
file<br />
does no longer appear in a restored config file.</p>
<p>Of course this current pull request does not prove that<br />
a UUID in disklayout.conf that had been in several config files<br />
still appears in all those restored config files.</p>
<p>Assume a UUID in disklayout.conf was in /etc/fstab and in
/etc/crypttab<br />
but in the restored config files it appears only in /etc/fstab but<br />
no longer in /etc/crypttab<br />
then<br />
the test in this current pull request detects the UUID<br />
in the restored /etc/fstab but falsely does not raise alarm<br />
that this UUID is missing in the resored /etc/crypttab</p>
<h4 id="jsmeix_commented_at_2022-04-20_0901"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103657692">2022-04-20 09:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0901" title="Permanent link">&para;</a></h4>
<p>This pull request is not meant as some final solution<br />
that proves whether or not all restored config files<br />
match the actually recreated system, cf.<br />
<a href="https://github.com/rear/rear/issues/2787#issuecomment-1095029576">https://github.com/rear/rear/issues/2787#issuecomment-1095029576</a></p>
<p>I like to do first things first, one step at a time, and one after the
other<br />
in particular to get step by step sufficient understanding of an issue<br />
to be able to develop step by step a reasonable solution in practice.</p>
<p>But if the final solution is the only thing that is acceptable,<br />
someone else would have to implement it completely and properly.</p>
<p>My main reason is that I like to get ReaR 2.7 released<br />
in the next weeks and not postponed indefinitely<br />
and I have many other things to do to get there, cf.<br />
<a href="https://github.com/rear/rear/issues/2751">https://github.com/rear/rear/issues/2751</a></p>
<h4 id="jsmeix_commented_at_2022-04-20_0921"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103686488">2022-04-20 09:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0921" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your<br />
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1099195961">https://github.com/rear/rear/pull/2788#issuecomment-1099195961</a></p>
<pre><code>isn't it a mistake that layout/compare/default/510_compare_files.sh
is not executed after restoring the backup
(the checksums seem to be used only at checklayout)?
I think it would be enough to detect the problem, and likely
other problems due to inconsistent backups as well.
</code></pre>
<p>Interesting idea!</p>
<p>We would need to run layout/compare/default/510_compare_files.sh<br />
before any "finalize" script may modify some restored files<br />
so we may run layout/compare/default/510_compare_files.sh<br />
at the end of the "restore" stage e.g. as something like<br />
usr/share/rear/restore/default/992_compare_files.sh</p>
<p>We would still have to enhance what there is<br />
by default in CHECK_CONFIG_FILES<br />
in particular add files liks /etc/fstab and /etc/crypttab<br />
and likely some more of those generic config files.</p>
<h4 id="jsmeix_commented_at_2022-04-20_0926"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103693063">2022-04-20 09:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0926" title="Permanent link">&para;</a></h4>
<p>Cf. what I wote in<br />
<a href="https://github.com/rear/rear/issues/2787#issuecomment-1092853451">https://github.com/rear/rear/issues/2787#issuecomment-1092853451</a></p>
<pre><code>For internal backup methods we may run what checklayout does
during mkbackuponly to avoid that an inconsistent backup
is taken with mkbackuponly after mkrescue.
</code></pre>
<p>So it seems the needed code is already there.<br />
It only needs to be called more often<br />
(and enhanced as needed).</p>
<h4 id="pcahyna_commented_at_2022-04-20_0928"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103696701">2022-04-20 09:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-20_0928" title="Permanent link">&para;</a></h4>
<p>@jsmeix should I try to implement and test this idea? I think it would
be both simpler and more reliable than what you propose in this PR.</p>
<h4 id="jsmeix_commented_at_2022-04-20_0930"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103698693">2022-04-20 09:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0930" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I would very much appreciate it if you try to implement and test this
idea!<br />
Thank you so much in advance!</p>
<h4 id="jsmeix_commented_at_2022-04-20_0939"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103711774">2022-04-20 09:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_0939" title="Permanent link">&para;</a></h4>
<p>Something more related to my<br />
<a href="https://github.com/rear/rear/issues/2787#issuecomment-1092853451">https://github.com/rear/rear/issues/2787#issuecomment-1092853451</a><br />
<code>When an inconsistent backup was taken before mkrescue ...</code></p>
<p>I think we may run layout/save/default/600_snapshot_files.sh<br />
at the end of <code>mkbackuponly</code> and as counterpart<br />
run layout/compare/default/510_compare_files.sh<br />
at the beginning of <code>mkrescue</code> to detect<br />
when the backup that was taken before <code>mkrescue</code> is now outdated<br />
(i.e. when files in CHECK_CONFIG_FILES changed meanwhile)<br />
so it could be inconsistent with what <code>mkrescue</code> stores in
disklayout.conf.</p>
<h4 id="pcahyna_commented_at_2022-04-20_0956"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103734728">2022-04-20 09:56</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-20_0956" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Something more related to my <a href="https://github.com/rear/rear/issues/2787#issuecomment-1092853451">#2787
(comment)</a>
<code>When an inconsistent backup was taken before mkrescue ...</code></p>
<p>I think we may run layout/save/default/600_snapshot_files.sh at the
end of <code>mkbackuponly</code> and as counterpart run
layout/compare/default/510_compare_files.sh at the beginning of
<code>mkrescue</code> to detect when the backup that was taken before <code>mkrescue</code>
is now outdated (i.e. when files in CHECK_CONFIG_FILES changed
meanwhile) so it could be inconsistent with what <code>mkrescue</code> stores in
disklayout.conf.</p>
</blockquote>
<p>That was the point of
<a href="https://github.com/rear/rear/issues/2787#issuecomment-1094988418">https://github.com/rear/rear/issues/2787#issuecomment-1094988418</a>
. But you would need a different place for information saved by
<code>mkbackuponly</code> and checked by <code>mkrescue</code> than for information saved by
<code>mkrescue</code> and checked by <code>mkbackuponly</code>. Otherwise you would not know
whether it is the backup or the rescue image that is out of date. (You
certainly don't need to detect and warn in <code>mkrescue</code> about the
inconsistency with a previous <code>mkrescue</code> run - only with a previous
<code>mkbackuponly</code> run.)</p>
<h4 id="jsmeix_commented_at_2022-04-20_1045"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103789709">2022-04-20 10:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_1045" title="Permanent link">&para;</a></h4>
<p>Only an offhanded idea:</p>
<p>I wonder if the most generic way to detect inconsistencies could be<br />
to save existing var/lib/rear/layout/ and var/lib/rear/recovery/
directories<br />
before a new layout is created e.g. in<br />
layout/save/GNU/Linux/100_create_layout_file.sh via</p>
<pre><code>mv -f $v $VAR_DIR/layout $VAR_DIR/layout.old
mv -f $v $VAR_DIR/recovery $VAR_DIR/recovery.old
</code></pre>
<p>and store in a file in the new created $VAR_DIR/layout<br />
what workflow was used to create the new layout.</p>
<p>Then we can compare as we like the old layout with the current one<br />
and do what is appropriate for any sequence of workflows.</p>
<p>Because of <code>COPY_AS_IS=( $SHARE_DIR $VAR_DIR )</code> in default.conf<br />
also $VAR_DIR/layout.old and $VAR_DIR/recovery.old get included<br />
in the recovery system so we could even compare things<br />
during "rear recover" and do what is appropriate and<br />
also the user could manually compare things in the recovery system<br />
when he needs to fix things manually.</p>
<h4 id="jsmeix_commented_at_2022-04-20_1053"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103795943">2022-04-20 10:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_1053" title="Permanent link">&para;</a></h4>
<p>Sigh - as always offhanded ideas are incomplete:</p>
<p>A simple</p>
<pre><code>mv -f $v $VAR_DIR/layout $VAR_DIR/layout.old
mv -f $v $VAR_DIR/recovery $VAR_DIR/recovery.old
</code></pre>
<p>is insufficient because when the user runs on arbitrary days</p>
<pre><code>rear mkrescue
rear mkbackuponly
rear mkbackuponly
</code></pre>
<p>the layout at <code>mkrescue</code> time is no longer saved.</p>
<h4 id="pcahyna_commented_at_2022-04-20_1058"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103799884">2022-04-20 10:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-20_1058" title="Permanent link">&para;</a></h4>
<p>yes - that's why I wrote "But you would need a different place for
information saved by mkbackuponly and checked by mkrescue than for
information saved by mkrescue and checked by mkbackuponly"</p>
<h4 id="jsmeix_commented_at_2022-04-20_1100"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103801803">2022-04-20 11:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_1100" title="Permanent link">&para;</a></h4>
<p>I am thinking about a generic way to detect inconsistencies<br />
because there are many possible combinations of the<br />
mkrescue mkbackuponly mkbackup workflows.</p>
<h4 id="pcahyna_commented_at_2022-04-20_1106"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103806208">2022-04-20 11:06</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-20_1106" title="Permanent link">&para;</a></h4>
<p>I believe that one needs to determine what are the things that may
become inconsistent and design the detection according to that. In this
case, there seem to be two things that may have inconsistencies between
them : backup and rescue image. It seems that it is then enough for each
one to record what is current when they got created (by mkbackuponly and
mkrescue respectively) and, and check what the other has recorded. So
far, it does not seem that anything more generic is needed.</p>
<h4 id="jsmeix_commented_at_2022-04-20_1116"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103814720">2022-04-20 11:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_1116" title="Permanent link">&para;</a></h4>
<p>My problem is this part in
layout/save/GNU/Linux/100_create_layout_file.sh</p>
<pre><code>Log "Creating layout directories (when not existing)"
mkdir -p $v $VAR_DIR/layout
mkdir -p $v $VAR_DIR/recovery
mkdir -p $v $VAR_DIR/layout/config
</code></pre>
<p>The hardcoded '$VAR_DIR/layout' '$VAR_DIR/recovery'
'$VAR_DIR/layout/config'<br />
indicate this names are also used hardcoded at many other places in our
code.<br />
Yes, I can find them in about 150 lines of code.</p>
<p>So I am thinking about to somehow only appropriately<br />
move/rename those directories when the "layout/save" stage<br />
was not run by 'mkrescue' or 'mkbackup' to keep the names<br />
'$VAR_DIR/layout' '$VAR_DIR/recovery' '$VAR_DIR/layout/config'<br />
only for what is created by 'mkrescue' or 'mkbackup'<br />
i.e. for what will be used for recreating during "rear recover".</p>
<p>Perhaps an additional final script of the "layout/save" stage like<br />
usr/share/rear/layout/save/default/995_move_layout_directories.sh<br />
could do that when the "layout/save" stage<br />
was not run by 'mkrescue' or 'mkbackup'?</p>
<h4 id="jsmeix_commented_at_2022-04-20_1135"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1103829213">2022-04-20 11:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-20_1135" title="Permanent link">&para;</a></h4>
<p>I think that moving away the layout base directories<br />
'$VAR_DIR/layout' and '$VAR_DIR/recovery'<br />
when the "layout/save" stage was not run by 'mkrescue' or 'mkbackup'<br />
is a good thing because in this case it makes clear that there is<br />
no up-to-date layout in $VAR_DIR on the original system.<br />
The layout information that will be used for recreating<br />
is then only inside the recovery system (e.g. in its ISO image).</p>
<p>Only when the "layout/save" stage was run by 'mkrescue' or 'mkbackup'<br />
there is an up-to-date layout in $VAR_DIR also on the original system.</p>
<h4 id="pcahyna_commented_at_2022-04-21_1359"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1105249183">2022-04-21 13:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-21_1359" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna I would very much appreciate it if you try to implement and
test this idea! Thank you so much in advance!</p>
</blockquote>
<p>I am working on it now.</p>
<p>Do you please know why does
<code>layout/compare/default/510_compare_files.sh</code> save md5sums into a file
and compares the file with the original, instead of using the
<code>md5sum -c</code> command, which seems suitable for this purpose?</p>
<h4 id="jsmeix_commented_at_2022-04-22_0656"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106073580">2022-04-22 06:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_0656" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
the actual code in layout/compare/default/510_compare_files.sh<br />
is dated 2011 and I don't know why the code therein is as it is.</p>
<p>In general feel free to also mercilessly clean up things<br />
if you need to adapt or enhance certain code parts.</p>
<p>By the way:<br />
Normally <code>diff</code> is not the right tool to only compare if files differ<br />
and <code>diff -u</code> is plain wrong for that - if at all <code>diff -s</code> or <code>diff -q</code>
may be used</p>
<pre><code># find usr/share/rear -type f | xargs grep 'diff -u'

usr/share/rear/output/default/940_grub_rescue.sh:
if ! diff -u $grub_conf $TMP_DIR/menu.lst &gt;&amp;2; then

usr/share/rear/output/default/940_grub2_rescue.sh:
    if ! diff -u $grub_conf $generated_grub_conf &gt;&amp;2 ; then

usr/share/rear/layout/recreate/default/250_verify_mount.sh:
if diff -u &lt;( df -P $TARGET_FS_ROOT ) &lt;( df -P / ) &gt;/dev/null ; then

usr/share/rear/layout/compare/default/510_compare_files.sh:
    if ! diff -u $TMP_DIR/files.md5sum $VAR_DIR/layout/config/files.md5sum ; then
</code></pre>
<p>Sigh :-(</p>
<p>To only compare if files differ <code>cmp -s</code> should be used,<br />
e.g. see layout/compare/default/500_compare_layout.sh and<br />
<a href="https://github.com/rear/rear/issues/1657#issuecomment-353353529">https://github.com/rear/rear/issues/1657#issuecomment-353353529</a></p>
<p>And layout/compare/default/500_compare_layout.sh<br />
even shows an example how <code>diff -U0</code> could be used.</p>
<p>For an <code>md5sum -c</code> example you may have a look at<br />
skel/default/etc/scripts/system-setup</p>
<h4 id="pcahyna_commented_at_2022-04-22_0936"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106255105">2022-04-22 09:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_0936" title="Permanent link">&para;</a></h4>
<p>@jsmeix the advantage of <code>diff -u</code> may be that it shows what is the
actual difference, which is what the user likes to know in this case -
<code>cmp</code> would not do that.<br />
I tried to use <code>md5sum -c</code> instead of <code>diff -u</code> in <code>layout/compare</code> and
it seems to work, but not sure if I am going to clean this up as part of
this effort, solving the original problem has a higher priority and
there is more to do.<br />
By the way, you proposed to run this check as
<code>usr/share/rear/restore/default/992_compare_files.sh</code>. Wouldn't it be
more logical to add it to the <code>finalize</code> stage as one of the first
steps, instead of adding it to the <code>restore</code> stage as one of the last
steps? To me it seems that such checks belong more to the finalize
stage, but I am not that sure about the separation into stages.</p>
<h4 id="pcahyna_commented_at_2022-04-22_0938"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106258857">2022-04-22 09:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_0938" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think that moving away the layout base directories
'$VAR_DIR/layout' and '$VAR_DIR/recovery' when the "layout/save"
stage was not run by 'mkrescue' or 'mkbackup' is a good thing because
in this case it makes clear that there is no up-to-date layout in
$VAR_DIR on the original system. The layout information that will be
used for recreating is then only inside the recovery system (e.g. in
its ISO image).</p>
<p>Only when the "layout/save" stage was run by 'mkrescue' or 'mkbackup'
there is an up-to-date layout in $VAR_DIR also on the original
system.</p>
</blockquote>
<p>It seems that it leads to a complicated discussion, so I would say let's
focus on detecting inconsistencies during recovery first, and treat the
approaches to prevent inconsistencies at backup time separately.</p>
<h4 id="jsmeix_commented_at_2022-04-22_1005"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106324632">2022-04-22 10:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1005" title="Permanent link">&para;</a></h4>
<p>I fully agree with focus on detecting inconsistencies during recovery
first,<br />
and treat the approaches to prevent inconsistencies at backup time
separately.</p>
<h4 id="jsmeix_commented_at_2022-04-22_1014"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106335404">2022-04-22 10:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1014" title="Permanent link">&para;</a></h4>
<p>My thinking why to run this check at the end of the 'restore' stage
was<br />
that we like to detect inconsistencies because of the restored files<br />
so the check belongs to the 'restore' stage<br />
i.e. it is an additional "was the restore OK?" check.</p>
<p>Furthermore we have the "restoreonly" workflow to restore several
backups, cf.<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a><br />
So a check to detect inconsistencies because of restored files<br />
is perhaps better done separatedly for each individual restore.<br />
On the other hand a check to detect inconsistencies because of restored
files<br />
might be perhaps better done after all restores were done but then<br />
it is not clear to the user which backup restore caused what
inconsistencies.</p>
<h4 id="pcahyna_commented_at_2022-04-22_1019"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106340261">2022-04-22 10:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_1019" title="Permanent link">&para;</a></h4>
<p>By the way : @bwelterl 's original problem (#2785) seems to be the
volume ID of the FAT filesystem used on the EFI system partition. #2546
seems to address this case: it recreates the FAT filesystem using the
original volume ID, so no need to transform the ID using <code>sed</code>, because
the recreated ID will be correct -&gt; we get rid of one error-prone
transformation of the recreated system. (He was using ReaR 2.6, not the
development version.)</p>
<p>Of course, the problem will now be that even without <code>sed</code>, the restored
<code>/etc/fstab</code> will still be out of sync with the recovered system,
because the rescue ISO is not consistent with the backup. This IMO shows
that focusing on the files transformed using <code>sed</code> is not the right
approach, <code>sed</code> is not the real problem - the real problem is the
inconsistency and we should detect it regardless of whether <code>sed</code> is
used on the file or not.</p>
<h4 id="pcahyna_commented_at_2022-04-22_1039"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106363648">2022-04-22 10:39</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_1039" title="Permanent link">&para;</a></h4>
<blockquote>
<p>So a check to detect inconsistencies because of restored files<br />
is perhaps better done separatedly for each individual restore.</p>
</blockquote>
<p>I am afraid that multiple backups will have problem with UUID
adjustements anyway, because the HOWTO for multiple backups instructs
the user to first do <code>rear recover</code> and then <code>rear restoreonly</code>, so the
<code>finalize</code> steps will not run on files restored by the later
<code>restoreonly</code>, and if there are UUIDs to migrate, they will not get
migrated.<br />
Additionally, if there were UUIDs to migrate during the first <code>recover</code>,
running the check at the end of each <code>restoreonly</code> will cause false
alarms, because even if the md5sums matched at the beginning, after the
UUID migration (performed during <code>finalize</code>) they will not match anymore
(which is fine, but there is no way to know that).</p>
<h4 id="jsmeix_commented_at_2022-04-22_1049"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106370410">2022-04-22 10:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1049" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1106340261">https://github.com/rear/rear/pull/2788#issuecomment-1106340261</a></p>
<p>Yes, that is what I meant in my<br />
<a href="https://github.com/rear/rear/issues/2785#issuecomment-1091773765">https://github.com/rear/rear/issues/2785#issuecomment-1091773765</a><br />
which is why I did not approve<br />
<a href="https://github.com/rear/rear/pull/2786">https://github.com/rear/rear/pull/2786</a></p>
<p>I also tried to explain that with long winded words in my<br />
code comment in this pull request in particular starting at this line<br />
<a href="https://github.com/rear/rear/blob/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa/usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh#L23">https://github.com/rear/rear/blob/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa/usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh#L23</a></p>
<h4 id="jsmeix_commented_at_2022-04-22_1102"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106401815">2022-04-22 11:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1102" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1106363648">https://github.com/rear/rear/pull/2788#issuecomment-1106363648</a></p>
<p>Multiple backups work well when done correctly as described in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a><br />
which reads (excerpt)</p>
<pre><code>Recovery of that system could be done
by calling in the ReaR recovery/rescue system:

rear -C basic_system recover
rear -C home_backup restoreonly
rear -C opt_backup restoreonly

Note that system recovery with multiple backups requires
that first and foremost the basic system is recovered
where all files must be restored that are needed
to install the bootloader and to boot the basic system
into a normal usable state.

Nowadays systemd usually needs files in the /usr directory
so that in practice in particular all files in the /usr directory
must be restored during the initial basic system recovery
plus whatever else is needed to boot and run the basic system.

Multiple backups cannot be used to split the files of the basic system
into several backups. The files of the basic system must be in
one single backup and that backup must be restored during
the initial recovery of the basic system.
</code></pre>
<p>It could happen that all is well for <code>rear -C basic_system recover</code><br />
but a subsequent <code>rear -C some_other_backup restoreonly</code><br />
restores files that are inconsistent with the recreaded system<br />
(e.g. because some_other_backup contains an inconsistent etc/fstab).</p>
<p>So a check to detect inconsistencies because of restored files<br />
must be done separatedly for each individual restore to detect
possible<br />
inconsistencies by a subsequent
<code>rear -C some_other_backup restoreonly</code><br />
where no 'finalize' stage is run.</p>
<p>In general it is a user error to have basic system files (e.g.
etc/fstab)<br />
also in another subsequent backup so when UUIDs in etc/fstab<br />
were modified (which is not the usual case because UUIDs are normally<br />
recreated as they were on the original system) during <code>rear recover</code><br />
and then the check at the end of a subsequent <code>rear restoreonly</code><br />
causes alarm it is OK because "something is wrong" then (regardless<br />
that the alarm was raised because of a different technical reason).</p>
<h4 id="jsmeix_commented_at_2022-04-22_1113"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106410919">2022-04-22 11:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1113" title="Permanent link">&para;</a></h4>
<p>Oops!</p>
<p>I think it is exactly the other way round!</p>
<p>Because the test does not test only the restored files of the last
restored backup<br />
but the test tests files in a fixed list (e.g. those in
CHECK_CONFIG_FILES)<br />
it means when that test is run also for a subsequent
<code>rear restoreonly</code><br />
and during the <code>rear recover</code> before files were modified in 'finalize'
stage<br />
then the second run of that test during subsequent <code>rear restoreonly</code><br />
will actually cause false alarm for all those modified files.</p>
<p>So that test must not be run at the end of the 'restore' stage<br />
but at the beginning of the 'finalize' stage<br />
to ensure that test is run only once<br />
before resored files may get modified in 'finalize' stage.</p>
<p>This matches the intent of that test which is only to check<br />
inconsistencies in basic system files.</p>
<h4 id="pcahyna_commented_at_2022-04-22_1115"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106412178">2022-04-22 11:15</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_1115" title="Permanent link">&para;</a></h4>
<blockquote>
<p>It could happen that all is well for <code>rear -C basic_system recover</code>
but a subsequent <code>rear -C some_other_backup restoreonly</code> restores
files that are inconsistent with the recreaded system (e.g. because
some_other_backup contains an inconsistent etc/fstab).</p>
</blockquote>
<p>Then the backups are not taken according to the HOWTO that you quoted.
We can detect this kind of misconfiguration, but should we?</p>
<blockquote>
<p>So a check to detect inconsistencies because of restored files must be
done separatedly for each individual restore to detect possible
inconsistencies by a subsequent
<code>rear -C some_other_backup restoreonly</code> where no 'finalize' stage is
run.</p>
</blockquote>
<p>This would work if we check only inconsistencies in files restored by
this particular <code>restoreonly</code> run. But I am afraid that there is no
general way of knowing what files were restored by a particular run, so
we will check everything at the end of each <code>restoreonly</code> run, leading
to the false alarm that I have described.</p>
<blockquote>
<p>In general it is a user error to have basic system files (e.g.
etc/fstab) also in another subsequent backup so when UUIDs in
etc/fstab were modified (which is not the usual case because UUIDs are
normally recreated as they were on the original system) during
<code>rear recover</code> and then the check at the end of a subsequent
<code>rear restoreonly</code> causes alarm it is OK because "something is wrong"
then (regardless that the alarm was raised because of a different
technical reason).</p>
</blockquote>
<p>The trouble is, the user will get this alarm even if all is well and
fstab (or any other file with patched IDs) was not included in the
subsequently restored backup.</p>
<h4 id="jsmeix_commented_at_2022-04-22_1117"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106413638">2022-04-22 11:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1117" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I am sorry - I was confused.</p>
<p>You are right to run the test at the beginning of the 'finalize' stage,
see my<br />
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1106410919">https://github.com/rear/rear/pull/2788#issuecomment-1106410919</a></p>
<h4 id="pcahyna_commented_at_2022-04-22_1118"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106414434">2022-04-22 11:18</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-22_1118" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Regarding <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106340261">#2788
(comment)</a></p>
<p>Yes, that is what I meant in my <a href="https://github.com/rear/rear/issues/2785#issuecomment-1091773765">#2785
(comment)</a>
which is why I did not approve #2786</p>
<p>I also tried to explain that with long winded words in my code comment
in this pull request in particular starting at this line</p>
<p><a href="https://github.com/rear/rear/blob/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa/usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh#L23">https://github.com/rear/rear/blob/21f500abaec9b70d76d484a5c0ba9a8f3d44fbaa/usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh#L23</a></p>
</blockquote>
<p>Sorry, it was not meant as a critique of your approach, more of the
assumptions in the original bug report. And sorry for commenting on
something that you have already addressed, I lost the context of this
issue a bit.</p>
<h4 id="jsmeix_commented_at_2022-04-22_1123"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1106418124">2022-04-22 11:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_1123" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
no problem - don't worry!<br />
I appreciate all your comments.</p>
<p>I also got lost in overcomplicated thinking<br />
and your comments helped me to find the way out :-)</p>
<p>It proves that such issues are actually rather complicated and need<br />
such discussions so we together can find a solution that really works.</p>
<h4 id="jsmeix_commented_at_2022-04-27_1012"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1110823015">2022-04-27 10:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_1012" title="Permanent link">&para;</a></h4>
<p>This one is obsoleted by
<a href="https://github.com/rear/rear/pull/2795">https://github.com/rear/rear/pull/2795</a></p>
<h4 id="jsmeix_commented_at_2022-04-27_1014"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1110824446">2022-04-27 10:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_1014" title="Permanent link">&para;</a></h4>
<p>I keep the branch of this pull request for now as reference<br />
<a href="https://github.com/rear/rear/tree/jsmeix-UUIDs-consistency-check">jsmeix-UUIDs-consistency-check</a></p>
<h4 id="jsmeix_commented_at_2022-04-27_1017"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2788#issuecomment-1110827109">2022-04-27 10:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_1017" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for your
<a href="https://github.com/rear/rear/pull/2795">https://github.com/rear/rear/pull/2795</a><br />
which looks much cleaner and simpler and more straightforward<br />
than what I did here.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-04-11.2788.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
