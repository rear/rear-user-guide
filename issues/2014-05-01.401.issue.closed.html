<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#401 Issue closed: lvm data on san disks are wiped - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#401 Issue closed: lvm data on san disks are wiped";
        var mkdocs_page_input_path = "issues/2014-05-01.401.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#401 Issue closed: lvm data on san disks are wiped</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="401_issue_closed_lvm_data_on_san_disks_are_wiped"><a href="https://github.com/rear/rear/issues/401">#401 Issue</a> <code>closed</code>: lvm data on san disks are wiped<a class="headerlink" href="#401_issue_closed_lvm_data_on_san_disks_are_wiped" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="cocampbe_opened_issue_at_2014-05-01_1559"><img src="https://avatars.githubusercontent.com/u/2211329?u=4cd2be2e33c0e225dd2ffa8fe52fc0015c498af1&v=4" width="50"><a href="https://github.com/cocampbe">cocampbe</a> opened issue at <a href="https://github.com/rear/rear/issues/401">2014-05-01 15:59</a>:<a class="headerlink" href="#cocampbe_opened_issue_at_2014-05-01_1559" title="Permanent link">&para;</a></h4>
<p>I am not sure what I am missing. I have looked at case #291 but it did
not provide me with an answer. I figures out how to exclude backups of
my san disks on case #398. Now the issue is that the san disks are
wiped during the recovery. What I need is rear to only backup vg00 (the
OS). All other disks can be excluded. And when the recovery is complete,
the system should boot up and all san volumes should be mounted intact.
I have been working with lvm volumes and ocfs file systems and they are
wiped everytime. Here is my <code>local.conf</code> file:</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://192/168.1.34/var/opt/ignite/rear/"
NETFS_KEEP_OLD_BACKUP_COPY=1
ONLY_INCLUDE_VG=( vg00 )
EXCLUDE_MOUNTPOINTS=($(df -Pl | grep -v 'vg00\|boot\|tmpfs\|Filesystem' | awk '{print $6}'))
EXCLUDE_RECREATE=( "${EXCLUDE_RECREATE[@]}" )
EXCLUDE_RECREATE+=($(df -Pl | grep -v 'vg00\|boot\|tmpfs\|Filesystem' | awk '{print "fs:"$6}'))
</code></pre>
<p>This only backs up vg00 data. Here is the content of the disklayout.conf
file.</p>
<pre><code>disk /dev/sda 450064605184 msdos
part /dev/sda 524288000 1048576 primary boot /dev/sda1
part /dev/sda 449539211264 525336576 primary lvm /dev/sda2
#disk /dev/sdb 21474836480 msdos
#disk /dev/sdc 26843545600 msdos
#disk /dev/sdd 10737418240 msdos
#disk /dev/sde 21474836480 msdos
#disk /dev/sdf 26843545600 msdos
#disk /dev/sdg 10737418240 msdos
#disk /dev/sdh 21474836480 msdos
#disk /dev/sdi 26843545600 msdos
#disk /dev/sdj 10737418240 msdos
#disk /dev/sdk 21474836480 msdos
#disk /dev/sdl 26843545600 msdos
#disk /dev/sdm 10737418240 msdos
#lvmdev /dev/vgtest /dev/mapper/test IMreTj-ZCep-joFo-eY28-cD2b-SGXN-3qJeQK 41943040
lvmdev /dev/vg00 /dev/sda2 YOpd1n-4cgu-bQ19-O8p9-vFJp-JGhq-swDcCY 878006272
#lvmgrp /dev/vgtest 4096 5116 20955136
lvmgrp /dev/vg00 4096 107178 439001088
#lvmvol /dev/vgtest test 5116 41910272
lvmvol /dev/vg00 lv_swap 992 8126464
lvmvol /dev/vg00 lvol3 512 4194304
lvmvol /dev/vg00 lvol4 1280 10485760
lvmvol /dev/vg00 lvol5 2560 20971520
lvmvol /dev/vg00 lvol6 512 4194304
lvmvol /dev/vg00 lvol7 2560 20971520
lvmvol /dev/vg00 lvol8 2560 20971520
lvmvol /dev/vg00 lvol9 1280 10485760
fs /dev/mapper/vg00-lvol3 / ext4 uuid=b9348931-1e3b-4d33-bfcd-1b3b5168f1e6 label= blocksize=4096 reserved_blocks=2% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/sda1 /boot ext4 uuid=ee7ad465-fff4-4089-927d-e5fe6f528d4a label= blocksize=1024 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=4063 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol4 /home ext4 uuid=ecfadc88-4a7e-4ef9-8af3-2c113241d0c7 label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol9 /oma ext4 uuid=d03e8613-3fa5-4127-a27b-c945f16a45d8 label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol5 /opt ext4 uuid=93093ee1-0268-4a22-b1d7-e733a4e1e208 label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol6 /tmp ext4 uuid=1fdbbb47-8285-488d-b16d-74838b144121 label= blocksize=4096 reserved_blocks=2% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol7 /usr ext4 uuid=d532f502-ffcc-4171-bb58-e1e89aee2caa label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg00-lvol8 /var ext4 uuid=28b27949-286f-4966-aa1d-8e00190f3e0d label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
#fs /dev/mapper/vgtest-test /test ext4 uuid=ce7fdd15-a660-40e9-ad18-b9bac5b3c411 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16371 default_mount_options=user_xattr,acl options=rw
swap /dev/mapper/vg00-lv_swap uuid=369d10ed-6e53-40cd-848d-fbe8d0233185 label=
logicaldrive /dev/sda 0|A|1 raid=1 drives=1I:1:1,1I:1:2, spares= sectors=32 stripesize=256
smartarray 0
#multipath /dev/mapper/test_ocfs /dev/sdc,/dev/sdf,/dev/sdi,/dev/sdl
#multipath /dev/mapper/test /dev/sdb,/dev/sde,/dev/sdh,/dev/sdk
#multipath /dev/mapper/fmw_ocfs /dev/sdd,/dev/sdg,/dev/sdj,/dev/sdm
</code></pre>
<p>I saw that the multipath disks were commented out. So I assumed that the
AUTOEXCLUDE_MULTUIPATH was already set to a default of y. I am not sure
which part of the restore is removing the lvm headers on those disks.
Here is a copy of the disktodo.conf. Hopefully this is enough info.
Thanks.</p>
<pre><code>todo /dev/sda disk
todo /dev/sda1 part
todo /dev/sda2 part
done /dev/sdb disk
done /dev/sdc disk
done /dev/sdd disk
done /dev/sde disk
done /dev/sdf disk
done /dev/sdg disk
done /dev/sdh disk
done /dev/sdi disk
done /dev/sdj disk
done /dev/sdk disk
done /dev/sdl disk
done /dev/sdm disk
done pv:/dev/mapper/test lvmdev
todo pv:/dev/sda2 lvmdev
done /dev/vgtest lvmgrp
todo /dev/vg00 lvmgrp
done /dev/mapper/vgtest-test lvmvol
todo /dev/mapper/vg00-lv_swap lvmvol
todo /dev/mapper/vg00-lvol3 lvmvol
todo /dev/mapper/vg00-lvol4 lvmvol
todo /dev/mapper/vg00-lvol5 lvmvol
todo /dev/mapper/vg00-lvol6 lvmvol
todo /dev/mapper/vg00-lvol7 lvmvol
todo /dev/mapper/vg00-lvol8 lvmvol
todo /dev/mapper/vg00-lvol9 lvmvol
todo fs:/ fs
todo fs:/boot fs
todo fs:/home fs
todo fs:/oma fs
todo fs:/opt fs
todo fs:/tmp fs
todo fs:/usr fs
todo fs:/var fs
done fs:/test fs
todo swap:/dev/mapper/vg00-lv_swap swap
done /dev/mapper/test_ocfs multipath
done /dev/mapper/test multipath
done /dev/mapper/fmw_ocfs multipath
</code></pre>
<h4 id="gdha_commented_at_2014-05-01_1904"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/401#issuecomment-41944548">2014-05-01 19:04</a>:<a class="headerlink" href="#gdha_commented_at_2014-05-01_1904" title="Permanent link">&para;</a></h4>
<p>Could you upload the diskrestore.sh script which is created during
recover workflow?</p>
<p>Gratien</p>
<blockquote>
<p>Op 1-mei-2014 om 17:59 heeft Court <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> het
volgende geschreven:</p>
<p>I am not sure what I am missing. I have looked at case #291 but it
did not provide me with an answer. I figures out how to exclude
backups of my san disks on case #398. Now the issue is that the san
disks are wiped during the recovery. What I need is rear to only
backup vg00 (the OS). All other disks can be excluded. And when the
recovery is complete, the system should boot up and all san volumes
should be mounted intact. I have been working with lvm volumes and
ocfs file systems and they are wiped everytime. Here is my local.conf
file:</p>
<p>OUTPUT=ISO<br />
BACKUP=NETFS<br />
BACKUP_URL="nfs://192/168.1.34/var/opt/ignite/rear/"<br />
NETFS_KEEP_OLD_BACKUP_COPY=1<br />
ONLY_INCLUDE_VG=( vg00 )<br />
EXCLUDE_MOUNTPOINTS=($(df -Pl | grep -v 'vg00|boot|tmpfs|Filesystem'
| awk '{print $6}'))<br />
EXCLUDE_RECREATE=( "${EXCLUDE_RECREATE[@]}" )<br />
EXCLUDE_RECREATE+=($(df -Pl | grep -v 'vg00|boot|tmpfs|Filesystem' |
awk '{print "fs:"$6}'))</p>
<p>This only backs up vg00 data. Here is the content of the
disklayout.conf file.</p>
<p>disk /dev/sda 450064605184 msdos<br />
part /dev/sda 524288000 1048576 primary boot /dev/sda1<br />
part /dev/sda 449539211264 525336576 primary lvm /dev/sda2<br />
#disk /dev/sdb 21474836480 msdos<br />
#disk /dev/sdc 26843545600 msdos<br />
#disk /dev/sdd 10737418240 msdos<br />
#disk /dev/sde 21474836480 msdos<br />
#disk /dev/sdf 26843545600 msdos<br />
#disk /dev/sdg 10737418240 msdos<br />
#disk /dev/sdh 21474836480 msdos<br />
#disk /dev/sdi 26843545600 msdos<br />
#disk /dev/sdj 10737418240 msdos<br />
#disk /dev/sdk 21474836480 msdos<br />
#disk /dev/sdl 26843545600 msdos<br />
#disk /dev/sdm 10737418240 msdos<br />
#lvmdev /dev/vgtest /dev/mapper/test
IMreTj-ZCep-joFo-eY28-cD2b-SGXN-3qJeQK 41943040<br />
lvmdev /dev/vg00 /dev/sda2 YOpd1n-4cgu-bQ19-O8p9-vFJp-JGhq-swDcCY
878006272<br />
#lvmgrp /dev/vgtest 4096 5116 20955136<br />
lvmgrp /dev/vg00 4096 107178 439001088<br />
#lvmvol /dev/vgtest test 5116 41910272<br />
lvmvol /dev/vg00 lv_swap 992 8126464<br />
lvmvol /dev/vg00 lvol3 512 4194304<br />
lvmvol /dev/vg00 lvol4 1280 10485760<br />
lvmvol /dev/vg00 lvol5 2560 20971520<br />
lvmvol /dev/vg00 lvol6 512 4194304<br />
lvmvol /dev/vg00 lvol7 2560 20971520<br />
lvmvol /dev/vg00 lvol8 2560 20971520<br />
lvmvol /dev/vg00 lvol9 1280 10485760<br />
fs /dev/mapper/vg00-lvol3 / ext4
uuid=b9348931-1e3b-4d33-bfcd-1b3b5168f1e6 label= blocksize=4096
reserved_blocks=2% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/sda1 /boot ext4 uuid=ee7ad465-fff4-4089-927d-e5fe6f528d4a
label= blocksize=1024 reserved_blocks=5% max_mounts=-1
check_interval=0d bytes_per_inode=4063
default_mount_options=user_xattr,acl options=rw<br />
fs /dev/mapper/vg00-lvol4 /home ext4
uuid=ecfadc88-4a7e-4ef9-8af3-2c113241d0c7 label= blocksize=4096
reserved_blocks=5% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/mapper/vg00-lvol9 /oma ext4
uuid=d03e8613-3fa5-4127-a27b-c945f16a45d8 label= blocksize=4096
reserved_blocks=5% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/mapper/vg00-lvol5 /opt ext4
uuid=93093ee1-0268-4a22-b1d7-e733a4e1e208 label= blocksize=4096
reserved_blocks=5% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/mapper/vg00-lvol6 /tmp ext4
uuid=1fdbbb47-8285-488d-b16d-74838b144121 label= blocksize=4096
reserved_blocks=2% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/mapper/vg00-lvol7 /usr ext4
uuid=d532f502-ffcc-4171-bb58-e1e89aee2caa label= blocksize=4096
reserved_blocks=5% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
fs /dev/mapper/vg00-lvol8 /var ext4
uuid=28b27949-286f-4966-aa1d-8e00190f3e0d label= blocksize=4096
reserved_blocks=5% max_mounts=-1 check_interval=0d
bytes_per_inode=16384 default_mount_options=user_xattr,acl
options=rw<br />
#fs /dev/mapper/vgtest-test /test ext4
uuid=ce7fdd15-a660-40e9-ad18-b9bac5b3c411 label= blocksize=4096
reserved_blocks=4% max_mounts=-1 check_interval=0d
bytes_per_inode=16371 default_mount_options=user_xattr,acl
options=rw<br />
swap /dev/mapper/vg00-lv_swap
uuid=369d10ed-6e53-40cd-848d-fbe8d0233185 label=<br />
logicaldrive /dev/sda 0|A|1 raid=1 drives=1I:1:1,1I:1:2, spares=
sectors=32 stripesize=256<br />
smartarray 0<br />
#multipath /dev/mapper/test_ocfs
/dev/sdc,/dev/sdf,/dev/sdi,/dev/sdl<br />
#multipath /dev/mapper/test /dev/sdb,/dev/sde,/dev/sdh,/dev/sdk<br />
#multipath /dev/mapper/fmw_ocfs /dev/sdd,/dev/sdg,/dev/sdj,/dev/sdm</p>
<p>I saw that the multipath disks were commented out. So I assumed that
the AUTOEXCLUDE_MULTUIPATH was already set to a default of y. I am
not sure which part of the restore is removing the lvm headers on
those disks. Here is a copy of the disktodo.conf. Hopefully this is
enough info. Thanks.</p>
<p>todo /dev/sda disk<br />
todo /dev/sda1 part<br />
todo /dev/sda2 part<br />
done /dev/sdb disk<br />
done /dev/sdc disk<br />
done /dev/sdd disk<br />
done /dev/sde disk<br />
done /dev/sdf disk<br />
done /dev/sdg disk<br />
done /dev/sdh disk<br />
done /dev/sdi disk<br />
done /dev/sdj disk<br />
done /dev/sdk disk<br />
done /dev/sdl disk<br />
done /dev/sdm disk<br />
done pv:/dev/mapper/test lvmdev<br />
todo pv:/dev/sda2 lvmdev<br />
done /dev/vgtest lvmgrp<br />
todo /dev/vg00 lvmgrp<br />
done /dev/mapper/vgtest-test lvmvol<br />
todo /dev/mapper/vg00-lv_swap lvmvol<br />
todo /dev/mapper/vg00-lvol3 lvmvol<br />
todo /dev/mapper/vg00-lvol4 lvmvol<br />
todo /dev/mapper/vg00-lvol5 lvmvol<br />
todo /dev/mapper/vg00-lvol6 lvmvol<br />
todo /dev/mapper/vg00-lvol7 lvmvol<br />
todo /dev/mapper/vg00-lvol8 lvmvol<br />
todo /dev/mapper/vg00-lvol9 lvmvol<br />
todo fs:/ fs<br />
todo fs:/boot fs<br />
todo fs:/home fs<br />
todo fs:/oma fs<br />
todo fs:/opt fs<br />
todo fs:/tmp fs<br />
todo fs:/usr fs<br />
todo fs:/var fs<br />
done fs:/test fs<br />
todo swap:/dev/mapper/vg00-lv_swap swap<br />
done /dev/mapper/test_ocfs multipath<br />
done /dev/mapper/test multipath<br />
done /dev/mapper/fmw_ocfs multipath</p>
<p>â€”<br />
Reply to this email directly or view it on GitHub.</p>
</blockquote>
<h4 id="cocampbe_commented_at_2014-05-01_2042"><img src="https://avatars.githubusercontent.com/u/2211329?u=4cd2be2e33c0e225dd2ffa8fe52fc0015c498af1&v=4" width="50"><a href="https://github.com/cocampbe">cocampbe</a> commented at <a href="https://github.com/rear/rear/issues/401#issuecomment-41954434">2014-05-01 20:42</a>:<a class="headerlink" href="#cocampbe_commented_at_2014-05-01_2042" title="Permanent link">&para;</a></h4>
<pre><code>#!/bin/bash

LogPrint "Start system layout restoration."

mkdir -p /mnt/local
if create_component "vgchange" "rear" ; then
    lvm vgchange -a n &gt;&amp;8
    component_created "vgchange" "rear"
fi

set -e
set -x

if create_component "/dev/sda" "disk" ; then
# Create /dev/sda (disk)
Log "Erasing MBR of disk /dev/sda"
dd if=/dev/zero of=/dev/sda bs=512 count=1
sync
LogPrint "Creating partitions for disk /dev/sda (msdos)"
parted -s /dev/sda mklabel msdos &gt;&amp;2
parted -s /dev/sda mkpart '"primary"' 1048576B 525336575B &gt;&amp;2
parted -s /dev/sda set 1 boot on &gt;&amp;2
parted -s /dev/sda mkpart '"primary"' 525336576B 450064547839B &gt;&amp;2
parted -s /dev/sda set 2 lvm on &gt;&amp;2
partprobe -s /dev/sda &gt;&amp;2
# Wait some time before advancing
sleep 10

# Make sure device nodes are visible (eg. in RHEL4)
my_udevtrigger
my_udevsettle
component_created "/dev/sda" "disk"
else
    LogPrint "Skipping /dev/sda (disk) as it has already been created."
fi

if create_component "/dev/sda1" "part" ; then
# Create /dev/sda1 (part)
component_created "/dev/sda1" "part"
else
    LogPrint "Skipping /dev/sda1 (part) as it has already been created."
fi

if create_component "/dev/sda2" "part" ; then
# Create /dev/sda2 (part)
component_created "/dev/sda2" "part"
else
    LogPrint "Skipping /dev/sda2 (part) as it has already been created."
fi

if create_component "pv:/dev/sda2" "lvmdev" ; then
# Create pv:/dev/sda2 (lvmdev)
LogPrint "Creating LVM PV /dev/sda2"
lvm vgchange -a n vg00 || true
lvm pvcreate -ff --yes -v --uuid "YOpd1n-4cgu-bQ19-O8p9-vFJp-JGhq-swDcCY" --restorefile /var/lib/rear/layout/lvm/vg00.cfg /dev/sda2 &gt;&amp;2
component_created "pv:/dev/sda2" "lvmdev"
else
    LogPrint "Skipping pv:/dev/sda2 (lvmdev) as it has already been created."
fi

if create_component "/dev/vg00" "lvmgrp" ; then
# Create /dev/vg00 (lvmgrp)
LogPrint "Restoring LVM VG vg00"
if [ -e /dev/vg00 ] ; then
    rm -rf /dev/vg00
fi
lvm vgcfgrestore -f /var/lib/rear/layout/lvm/vg00.cfg vg00 &gt;&amp;2
lvm vgchange --available y vg00 &gt;&amp;2
component_created "/dev/vg00" "lvmgrp"
else
    LogPrint "Skipping /dev/vg00 (lvmgrp) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lv_swap" "lvmvol" ; then
# Create /dev/mapper/vg00-lv_swap (lvmvol)
component_created "/dev/mapper/vg00-lv_swap" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lv_swap (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol3" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol3 (lvmvol)
component_created "/dev/mapper/vg00-lvol3" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol3 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol4" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol4 (lvmvol)
component_created "/dev/mapper/vg00-lvol4" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol4 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol5" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol5 (lvmvol)
component_created "/dev/mapper/vg00-lvol5" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol5 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol6" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol6 (lvmvol)
component_created "/dev/mapper/vg00-lvol6" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol6 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol7" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol7 (lvmvol)
component_created "/dev/mapper/vg00-lvol7" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol7 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol8" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol8 (lvmvol)
component_created "/dev/mapper/vg00-lvol8" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol8 (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/vg00-lvol9" "lvmvol" ; then
# Create /dev/mapper/vg00-lvol9 (lvmvol)
component_created "/dev/mapper/vg00-lvol9" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/vg00-lvol9 (lvmvol) as it has already been created."
fi

if create_component "fs:/" "fs" ; then
# Create fs:/ (fs)
LogPrint "Creating ext4-filesystem / on /dev/mapper/vg00-lvol3"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol3 &gt;&amp;2
tune2fs -U b9348931-1e3b-4d33-bfcd-1b3b5168f1e6 /dev/mapper/vg00-lvol3 &gt;&amp;2
tune2fs  -m 0 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol3 &gt;&amp;2
LogPrint "Mounting filesystem /"
mkdir -p /mnt/local/
mount -o rw /dev/mapper/vg00-lvol3 /mnt/local/
component_created "fs:/" "fs"
else
    LogPrint "Skipping fs:/ (fs) as it has already been created."
fi

if create_component "fs:/boot" "fs" ; then
# Create fs:/boot (fs)
LogPrint "Creating ext4-filesystem /boot on /dev/sda1"
mkfs -t ext4 -b 1024 -i 4031 /dev/sda1 &gt;&amp;2
tune2fs -U ee7ad465-fff4-4089-927d-e5fe6f528d4a /dev/sda1 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/sda1 &gt;&amp;2
LogPrint "Mounting filesystem /boot"
mkdir -p /mnt/local/boot
mount -o rw /dev/sda1 /mnt/local/boot
component_created "fs:/boot" "fs"
else
    LogPrint "Skipping fs:/boot (fs) as it has already been created."
fi

if create_component "fs:/home" "fs" ; then
# Create fs:/home (fs)
LogPrint "Creating ext4-filesystem /home on /dev/mapper/vg00-lvol4"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol4 &gt;&amp;2
tune2fs -U ecfadc88-4a7e-4ef9-8af3-2c113241d0c7 /dev/mapper/vg00-lvol4 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol4 &gt;&amp;2
LogPrint "Mounting filesystem /home"
mkdir -p /mnt/local/home
mount -o rw /dev/mapper/vg00-lvol4 /mnt/local/home
component_created "fs:/home" "fs"
else
    LogPrint "Skipping fs:/home (fs) as it has already been created."
fi

if create_component "fs:/oma" "fs" ; then
# Create fs:/oma (fs)
LogPrint "Creating ext4-filesystem /oma on /dev/mapper/vg00-lvol9"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol9 &gt;&amp;2
tune2fs -U d03e8613-3fa5-4127-a27b-c945f16a45d8 /dev/mapper/vg00-lvol9 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol9 &gt;&amp;2
LogPrint "Mounting filesystem /oma"
mkdir -p /mnt/local/oma
mount -o rw /dev/mapper/vg00-lvol9 /mnt/local/oma
component_created "fs:/oma" "fs"
else
    LogPrint "Skipping fs:/oma (fs) as it has already been created."
fi

if create_component "fs:/opt" "fs" ; then
# Create fs:/opt (fs)
LogPrint "Creating ext4-filesystem /opt on /dev/mapper/vg00-lvol5"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol5 &gt;&amp;2
tune2fs -U 93093ee1-0268-4a22-b1d7-e733a4e1e208 /dev/mapper/vg00-lvol5 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol5 &gt;&amp;2
LogPrint "Mounting filesystem /opt"
mkdir -p /mnt/local/opt
mount -o rw /dev/mapper/vg00-lvol5 /mnt/local/opt
component_created "fs:/opt" "fs"
else
    LogPrint "Skipping fs:/opt (fs) as it has already been created."
fi

if create_component "fs:/tmp" "fs" ; then
# Create fs:/tmp (fs)
LogPrint "Creating ext4-filesystem /tmp on /dev/mapper/vg00-lvol6"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol6 &gt;&amp;2
tune2fs -U 1fdbbb47-8285-488d-b16d-74838b144121 /dev/mapper/vg00-lvol6 &gt;&amp;2
tune2fs  -m 0 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol6 &gt;&amp;2
LogPrint "Mounting filesystem /tmp"
mkdir -p /mnt/local/tmp
mount -o rw /dev/mapper/vg00-lvol6 /mnt/local/tmp
component_created "fs:/tmp" "fs"
else
    LogPrint "Skipping fs:/tmp (fs) as it has already been created."
fi

if create_component "fs:/usr" "fs" ; then
# Create fs:/usr (fs)
LogPrint "Creating ext4-filesystem /usr on /dev/mapper/vg00-lvol7"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol7 &gt;&amp;2
tune2fs -U d532f502-ffcc-4171-bb58-e1e89aee2caa /dev/mapper/vg00-lvol7 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol7 &gt;&amp;2
LogPrint "Mounting filesystem /usr"
mkdir -p /mnt/local/usr
mount -o rw /dev/mapper/vg00-lvol7 /mnt/local/usr
component_created "fs:/usr" "fs"
else
    LogPrint "Skipping fs:/usr (fs) as it has already been created."
fi

if create_component "fs:/var" "fs" ; then
# Create fs:/var (fs)
LogPrint "Creating ext4-filesystem /var on /dev/mapper/vg00-lvol8"
mkfs -t ext4 -b 4096 -i 16384 /dev/mapper/vg00-lvol8 &gt;&amp;2
tune2fs -U 28b27949-286f-4966-aa1d-8e00190f3e0d /dev/mapper/vg00-lvol8 &gt;&amp;2
tune2fs  -m 5 -c -1 -i 0d -o user_xattr,acl /dev/mapper/vg00-lvol8 &gt;&amp;2
LogPrint "Mounting filesystem /var"
mkdir -p /mnt/local/var
mount -o rw /dev/mapper/vg00-lvol8 /mnt/local/var
component_created "fs:/var" "fs"
else
    LogPrint "Skipping fs:/var (fs) as it has already been created."
fi

if create_component "swap:/dev/mapper/vg00-lv_swap" "swap" ; then
# Create swap:/dev/mapper/vg00-lv_swap (swap)
LogPrint "Creating swap on /dev/mapper/vg00-lv_swap"
mkswap -U 369d10ed-6e53-40cd-848d-fbe8d0233185 /dev/mapper/vg00-lv_swap &gt;&amp;2
component_created "swap:/dev/mapper/vg00-lv_swap" "swap"
else
    LogPrint "Skipping swap:/dev/mapper/vg00-lv_swap (swap) as it has already been created."
fi


set +x
set +e

LogPrint "Disk layout created."
</code></pre>
<h4 id="cocampbe_commented_at_2014-05-01_2048"><img src="https://avatars.githubusercontent.com/u/2211329?u=4cd2be2e33c0e225dd2ffa8fe52fc0015c498af1&v=4" width="50"><a href="https://github.com/cocampbe">cocampbe</a> commented at <a href="https://github.com/rear/rear/issues/401#issuecomment-41955037">2014-05-01 20:48</a>:<a class="headerlink" href="#cocampbe_commented_at_2014-05-01_2048" title="Permanent link">&para;</a></h4>
<p>I have to add that I made one change as I was waiting for a reply. I set
AUTOEXCLUDE_MULTIPATH=n. I am not exactly sure how that would have
affected it since my last run. But upon reboot the server halted on
trying to mount /dev/mapper/vgtest-test.</p>
<h4 id="cocampbe_commented_at_2014-05-06_1254"><img src="https://avatars.githubusercontent.com/u/2211329?u=4cd2be2e33c0e225dd2ffa8fe52fc0015c498af1&v=4" width="50"><a href="https://github.com/cocampbe">cocampbe</a> commented at <a href="https://github.com/rear/rear/issues/401#issuecomment-42298094">2014-05-06 12:54</a>:<a class="headerlink" href="#cocampbe_commented_at_2014-05-06_1254" title="Permanent link">&para;</a></h4>
<p>Well. I solved the mystery. Nothing wrong with rear. I was doing a
rebuild on the servers before doing a recovery. I missed the fact that
the kickstart script was wiping all partitions. Sorry for the ghost
chase.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2014-05-01.401.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
