<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2023 05 25.2992.issue.open - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2023 05 25.2992.issue.open";
        var mkdocs_page_input_path = "issues/2023-05-25.2992.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2023 05 25.2992.issue.open</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2992_issue_open_rear_not_honoring_kernel_parameter_netifnames0_and_renaming_interfaces_question"><a href="https://github.com/rear/rear/issues/2992">#2992 Issue</a> <code>open</code>: Rear not honoring kernel parameter net.ifnames=0 and renaming interfaces (question)<a class="headerlink" href="#2992_issue_open_rear_not_honoring_kernel_parameter_netifnames0_and_renaming_interfaces_question" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="ccamacho_opened_issue_at_2023-05-25_0829"><img src="https://avatars.githubusercontent.com/u/17335512?u=14c6f2ce3e8cc205ef54d505e008b1b9481f92b1&v=4" width="50"><a href="https://github.com/ccamacho">ccamacho</a> opened issue at <a href="https://github.com/rear/rear/issues/2992">2023-05-25 08:29</a>:<a class="headerlink" href="#ccamacho_opened_issue_at_2023-05-25_0829" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>We are facing an issue after running Rear in some of our testing
environments.</p>
<p>We have a Jenkins pipeline that runs Rear in order to test that we are
able to do some backups of some guest VMs, after restoring the backup
images we noticed that the guests are unresponsive and this is because
the network interfaces are renamed from eth0 to ens3, eth1 to ens4 and
eth2 to ens5.</p>
<p>This is something that should be fixed as we should be using predictable
naming for all the network interfaces.</p>
<p>The initial state of the VMs is (net.ifnames=0)<br />
Before restoring the images:</p>
<pre><code>[root@undercloud-0 stack]# cat /proc/cmdline
BOOT_IMAGE=(hd0,gpt3)/vmlinuz-5.14.0-283.el9.x86_64 root=UUID=62b51192-13b0-4838-a267-e410f86ee01e console=tty0 console=ttyS0,115200n8 no_timer_check net.ifnames=0 crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M
</code></pre>
<p>After restoring the images:</p>
<pre><code>[root@undercloud-0 stack]# cat /proc/cmdline
BOOT_IMAGE=(hd0,gpt3)/vmlinuz-5.14.0-283.el9.x86_64 root=UUID=62b51192-13b0-4838-a267-e410f86ee01e ro
</code></pre>
<p>Not having 'net.ifnames=0' anymore.</p>
<p>We played with the following configuration parameters in the local.conf
without any additional change.</p>
<ul>
<li>Default values.</li>
<li>COPY_KERNEL_PARAMETERS=( 'net.ifnames')</li>
<li>GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"</li>
</ul>
<p>If we reboot the guest VMs without running Rear there is no change in
the interface naming.</p>
<p>When creating the backups of the images we see these lines:</p>
<pre><code>2023-05-09 13:59:33.470942363 Adding net.ifnames=0 to KERNEL_CMDLINE
2023-05-09 13:59:33.711087009 Modified kernel commandline to: 'selinux=0 net.ifnames=0 console=ttyS0,115200 console=tty0
</code></pre>
<p>And when running the restore we have this:</p>
<pre><code>2023-05-11 11:30:21.811225857 Including finalize/GNU/Linux/300_create_mac_mapping.sh
2023-05-11 11:30:21.822929609 Including finalize/GNU/Linux/310_migrate_udev_rules.sh
2023-05-11 11:30:21.827879926 Including finalize/GNU/Linux/320_migrate_network_configuration_files.sh
2023-05-11 11:30:21.830587664 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-br-ctlplane
2023-05-11 11:30:21.833158409 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-ens3
2023-05-11 11:30:21.835679147 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth0
2023-05-11 11:30:21.838289485 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth1
2023-05-11 11:30:21.840801955 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth2
2023-05-11 11:30:21.843472096 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-lo
</code></pre>
<p>We would like to understand what change is introducing Rear that is
triggering the renaming of the network interfaces, we are using
Relax-and-Recover 2.6 / 2020-06-17.</p>
<p>Is there a BACKUP_RESTORE_MOVE_AWAY_FILES, POST_RECOVERY_SCRIPT or
PRE_RECOVERY_SCRIPT configuration parameter we could use to avoid
having <code>udevadm trigger</code> renaming all the network interfaces?</p>
<p>There is also another reference #1818 where we might have a similar
situation, that is, Rear is not able to restore the previous network
configuration and the init scripts are regenerated.</p>
<p>Thanks,<br />
@fdiazbra and @ccamacho</p>
<h4 id="jsmeix_commented_at_2023-05-25_0914"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562562356">2023-05-25 09:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-25_0914" title="Permanent link">&para;</a></h4>
<p>@ccamacho<br />
as far as I know the "Modified kernel commandline" stuff only belongs<br />
to the kernel commandline of the ReaR recovery system,<br />
see usr/share/rear/conf/default.conf where<br />
KERNEL_CMDLINE and COPY_KERNEL_PARAMETERS are described<br />
only for the "rescue/recovery system" / "rescue image"<br />
(i.e. the ReaR recovery system).</p>
<p>Off the top of my head I think how the kernel commandline<br />
of the original system is saved and recovered happens as<br />
follows:<br />
In the "finalize" stage the bootloader gets installed<br />
via 'chroot' inside the recreated target system<br />
after the backup was restored so the bootloader gets installed<br />
with the restored bootloader config files from the backup.<br />
For example on my current openSUSE Leap 15.4 system I have<br />
in /etc/default/grub</p>
<pre><code>GRUB_CMDLINE_LINUX_DEFAULT="resume=... mitigations=..."
</code></pre>
<p>so this kernel commandline parameters are used when GRUB2<br />
is installed and this kernel commandline parameters appear<br />
in my /boot/grub2/grub.cfg like</p>
<pre><code>linux   /boot/vmlinuz... root=... resume=... mitigations=...
</code></pre>
<p>Accordingly I assume that in your case your bootloader config files<br />
on your original system may not contain the kernel commandline<br />
parameters which you are missing.</p>
<p>Regarding
finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
see the comments in this script how it works.<br />
When those automated more or less hardcoded modifications<br />
of the restored files get in your way the direct workaround<br />
is to skip those automated modifications by skipping the whole<br />
finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
by inserting an additional</p>
<pre><code>return 0
</code></pre>
<p>line at the beginning of this script - also as needed for<br />
other "finalize" scripts that modify restored files.<br />
You can add that 'return 0' line<br />
either<br />
when you are logged in as 'root' inside the ReaR recovery system<br />
before you run "rear recover"<br />
or<br />
you add that line on your original system and recreate the<br />
ReaR recovery system via "rear mkrescue" or "rear mkbackup".</p>
<h4 id="jsmeix_commented_at_2023-05-25_0916"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562565218">2023-05-25 09:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-25_0916" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
do you know @ccamacho ?<br />
I ask because<br />
<a href="https://github.com/ccamacho">https://github.com/ccamacho</a><br />
shows him as belonging to RedHatOfficial<br />
<a href="https://github.com/RedHatOfficial">https://github.com/RedHatOfficial</a></p>
<h4 id="pcahyna_commented_at_2023-05-25_0945"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562606975">2023-05-25 09:45</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-25_0945" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks for noticing, I contacted them</p>
<h4 id="jsmeix_commented_at_2023-05-25_0958"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562624707">2023-05-25 09:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-25_0958" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for having a look here!</p>
<h4 id="pcahyna_commented_at_2023-05-25_1101"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562706337">2023-05-25 11:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-25_1101" title="Permanent link">&para;</a></h4>
<pre><code>2023-05-11 11:30:21.830587664 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-br-ctlplane
2023-05-11 11:30:21.833158409 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-ens3
2023-05-11 11:30:21.835679147 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth0
2023-05-11 11:30:21.838289485 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth1
2023-05-11 11:30:21.840801955 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-eth2
2023-05-11 11:30:21.843472096 Patching /mnt/local/etc/sysconfig/network-scripts/ifcfg-lo
</code></pre>
<p>it would be interesting to know what changes (if any) have been made by
the patching process. @ccamacho can you please diff these files after
recovery process and before the recovery process?<br />
Also, how are the interfaces called in the rescue system? And what is
the kernel command line in the rescue system? I suppose it has
<code>net.ifnames=0</code> because of your KERNEL_CMDLINE and/or
COPY_KERNEL_PARAMETERS settings, and interfaces are called the same as
in the original install - <code>eth1</code>, <code>eth2</code>, <code>eth3</code>, but I would like to
confirm that.<br />
Also, are you restoring to exactly the same hardware as the backup was
made on, or to some replacement hardware? (Are the network interfaces
and their MAC addresses the same in the original and recovered system?)</p>
<h4 id="fdiazbra_commented_at_2023-05-25_1232"><img src="https://avatars.githubusercontent.com/u/97961319?v=4" width="50"><a href="https://github.com/fdiazbra">fdiazbra</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562826267">2023-05-25 12:32</a>:<a class="headerlink" href="#fdiazbra_commented_at_2023-05-25_1232" title="Permanent link">&para;</a></h4>
<p>The files: ifcfg-eth0, ifcfg-eth1, ifcfg-eth2, ifcfg-br-ctlplane, and
ifcfg-lo identical in the original and rescued system. The file
ifcfg-ens3 only exists in the rescued machine.<br />
The interface names are called "ethX" in the rescue system, as in the
original deployment.<br />
About the hardware, there is no replacement. We have both vms over the
same hypervisor.</p>
<h4 id="pcahyna_commented_at_2023-05-25_1336"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1562922939">2023-05-25 13:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-25_1336" title="Permanent link">&para;</a></h4>
<p>after some discussion it looks that re-adding <code>net.ifnames=0</code> to the
recovered system makes this work again. So the only question is why is
the whole
<code>console=tty0 console=ttyS0,115200n8 no_timer_check net.ifnames=0 crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M</code>
part missing from the restored kernel command line, and I smell some
misconfiguration here, aka GIGO (garbage in, garbage out).</p>
<h4 id="pcahyna_commented_at_2023-05-25_1621"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2992#issuecomment-1563182234">2023-05-25 16:21</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-25_1621" title="Permanent link">&para;</a></h4>
<blockquote>
<p>We played with the following configuration parameters in the
local.conf without any additional change.</p>
<pre><code>* Default values.

* COPY_KERNEL_PARAMETERS=( 'net.ifnames')

* GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"
</code></pre>
</blockquote>
<p>Those additions shouldn't be necessary, default.conf contains this:</p>
<pre><code># - Check net.ifnames and biosdevname kernel parameter as it may impact the network interface name during recovery/migration.
COPY_KERNEL_PARAMETERS=( 'net.ifnames' 'biosdevname' )
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-05-25.2992.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
