<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2021 05 26.2619.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2021 05 26.2619.issue.closed";
        var mkdocs_page_input_path = "issues/2021-05-26.2619.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2021 05 26.2619.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2619_issue_closed_missing_backup_duplicity_options_in_restore_script"><a href="https://github.com/rear/rear/issues/2619">#2619 Issue</a> <code>closed</code>: Missing BACKUP_DUPLICITY_OPTIONS in restore script<a class="headerlink" href="#2619_issue_closed_missing_backup_duplicity_options_in_restore_script" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="greenblood_opened_issue_at_2021-05-26_1007"><img src="https://avatars.githubusercontent.com/u/6583431?v=4" width="50"><a href="https://github.com/GreenBlood">GreenBlood</a> opened issue at <a href="https://github.com/rear/rear/issues/2619">2021-05-26 10:07</a>:<a class="headerlink" href="#greenblood_opened_issue_at_2021-05-26_1007" title="Permanent link">&para;</a></h4>
<p>Hi, Duplicity restore script seems to be missing the extended arguments
from BACKUP_DUPLICITY_OPTIONS on the command line call.</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.6-git.4355.3a699396.master.changed (still valid in current master)</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
<ul>
<li>Install rear and configure it with a Duplicity backup</li>
<li>Include specific BACKUP_DUPLICITY_OPTIONS arguments<ul>
<li>In my case it was duplicity's --s3-endpoint-url as I don't
    use AWS S3 storage</li>
</ul>
</li>
<li>Build rescue image and start recover</li>
<li>Duplicity might fail if the additionnal options are required for
    the backup data to be accessed (e.g S3 endpoints)</li>
</ul>
</li>
<li>
<p>Workaround, if any:<br />
    Haven't found any easy one, apart from modifying
    400_restore_duplicity.sh by hand (pull request to come)</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
<a href="https://github.com/rear/rear/files/6545818/rear-reard2c.log">rear-reard2c.log</a></p>
</li>
</ul>
<p>As mentionned, I'll create a pull request with what I did on my files to
make it work,</p>
<p>Regards</p>
<h4 id="jsmeix_commented_at_2021-05-27_0837"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2619#issuecomment-849449946">2021-05-27 08:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-27_0837" title="Permanent link">&para;</a></h4>
<p>@GreenBlood<br />
I am not a BACKUP=DUPLICITY user so I cannot reproduce or test
anything<br />
and all what I write here is only from plain looking at the code.</p>
<p>Could BACKUP_DUPLICITY_OPTIONS while the backup is made<br />
be different compared to options that are needed during restore?<br />
If yes would it perhaps be better to have a separated<br />
BACKUP_DUPLICITY_RESTORE_OPTIONS<br />
config variable or is that overkill?</p>
<p>Could BACKUP_DUPLICITY_OPTIONS contain sectets<br />
like whatever kind of passwords/passphrases or things like that?</p>
<h4 id="jsmeix_commented_at_2021-05-27_0845"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2619#issuecomment-849454914">2021-05-27 08:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-27_0845" title="Permanent link">&para;</a></h4>
<p>@GreenBlood<br />
by the way:</p>
<p>I had a quick look at the counterpart script<br />
usr/share/rear/backup/DUPLICITY/default/500_make_duplicity_backup.sh<br />
I noticed the strange looking DUP_OPTIONS usage therein.<br />
Do you perhaps know why the extra variable DUP_OPTIONS is interposed
there<br />
and why not just BACKUP_DUPLICITY_OPTIONS is directly used as is?<br />
To me this looks like yet another RFC 1925 item 6a implementation<br />
"It is always possible to add another level of indirection".</p>
<h4 id="greenblood_commented_at_2021-05-27_1125"><img src="https://avatars.githubusercontent.com/u/6583431?v=4" width="50"><a href="https://github.com/GreenBlood">GreenBlood</a> commented at <a href="https://github.com/rear/rear/issues/2619#issuecomment-849553842">2021-05-27 11:25</a>:<a class="headerlink" href="#greenblood_commented_at_2021-05-27_1125" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>If yes would it perhaps be better to have a separated<br />
BACKUP_DUPLICITY_RESTORE_OPTIONS<br />
config variable or is that overkill?</p>
</blockquote>
<p>Looking at the arguments listings, I'm not sure this would be very
helpful, but I'm not a very advanced duplicity user either so I may not
see the full picture. Anyway adding a restore-specific option (maybe
"cloning" it from backup options by default) does not seems technically
very hard.</p>
<blockquote>
<p>Could BACKUP_DUPLICITY_OPTIONS contain sectets</p>
</blockquote>
<p>Encryption password are generally either prompted when running the
command, or passed through environment variable. For example the basic
case, rear uses the setting named
"BACKUP_DUPLICITY_GPG_ENC_PASSPHRASE", which is transferred to
"PASSPHRASE" when passed to duplicity (
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/DUPLICITY/default/500_make_duplicity_backup.sh#L41">https://github.com/rear/rear/blob/master/usr/share/rear/backup/DUPLICITY/default/500_make_duplicity_backup.sh#L41</a>
).</p>
<p>Likewise, in my case the backup storage backend I'm authenticating
against is an cloud object storage and I have to use environment
variables to connect to it, as there is no specific option to do that.</p>
<p>Some duplicity options are security-related (like specifying which GPG
key to use when using asymetric encryption) but from what I can see in
the arguments, nothing ressembling a passphrase or something that would
be VERY private.</p>
<blockquote>
<p>I had a quick look at the counterpart script<br />
usr/share/rear/backup/DUPLICITY/default/500_make_duplicity_backup.sh<br />
I noticed the strange looking DUP_OPTIONS usage therein.<br />
Do you perhaps know why the extra variable DUP_OPTIONS is interposed
there<br />
and why not just BACKUP_DUPLICITY_OPTIONS is directly used as is?<br />
To me this looks like yet another RFC 1925 item 6a implementation<br />
"It is always possible to add another level of indirection".</p>
</blockquote>
<p>I saw this variable usage too and assumed it was related to the
<code># todo: check parameters</code> a few lines above. But like you said, is it
seems there is no other processing of those variable involved, it looks
to me that both variable are exactly the same. (BKP_URL in the same
file has the same weird usage)</p>
<h4 id="jsmeix_commented_at_2021-05-27_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2619#issuecomment-849617528">2021-05-27 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-27_1304" title="Permanent link">&para;</a></h4>
<p>Regarding <code>BACKUP_DUPLICITY_GPG_ENC_PASSPHRASE</code><br />
it seems the <code>ENC</code> therein does not mean the passphrase value is
encrypted therein<br />
but that it contains the unencrypted passphrase to <code>ENC</code>rypt the
backup<br />
as far as I can imagine what its little comment in default.conf means.</p>
<p>When a variable can contain a secret value special code is needed<br />
to avoid that the secret value leaks out, see the issue<br />
<a href="https://github.com/rear/rear/issues/2155">https://github.com/rear/rear/issues/2155</a><br />
and the special code that is used to fix it in<br />
<a href="https://github.com/rear/rear/pull/2156">https://github.com/rear/rear/pull/2156</a></p>
<h4 id="jsmeix_commented_at_2021-05-28_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2619#issuecomment-850412479">2021-05-28 13:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-28_1317" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2620">https://github.com/rear/rear/pull/2620</a>
merged<br />
this issue should be fixed.</p>
<p><a href="https://github.com/rear/rear/issues/2619#issuecomment-849617528">https://github.com/rear/rear/issues/2619#issuecomment-849617528</a><br />
will be done separatedly</p>
<p>@GreenBlood<br />
thank you for your issue report and even more thanks for your fix!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-05-26.2619.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
