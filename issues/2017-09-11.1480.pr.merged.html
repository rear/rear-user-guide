<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2017 09 11.1480.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2017 09 11.1480.pr.merged";
        var mkdocs_page_input_path = "issues/2017-09-11.1480.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2017 09 11.1480.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1480_pr_merged_avoid_apply_layout_mappings_error_if_input_file_is_empty"><a href="https://github.com/rear/rear/pull/1480">#1480 PR</a> <code>merged</code>: Avoid apply_layout_mappings Error if input file is empty<a class="headerlink" href="#1480_pr_merged_avoid_apply_layout_mappings_error_if_input_file_is_empty" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="schabrolles_opened_issue_at_2017-09-11_1051"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> opened issue at <a href="https://github.com/rear/rear/pull/1480">2017-09-11 10:51</a>:<a class="headerlink" href="#schabrolles_opened_issue_at_2017-09-11_1051" title="Permanent link">&para;</a></h4>
<ul>
<li>@schlomo, The change made in
    d89623404c08cf8b4b485e35295fb4caf2a35232 can produce error in some
    Linux Distro (like Sles11).<br />
    It is not directly link with the Linux version, but how scripts are
    dealing with <code>apply_layout_mappings()</code> function. In
    <code>250_migrate_disk_devices_layout.sh</code> a list of file to migrate is
    provided to the function. Depending to the configuration, some of
    them can e empty (or a link which point to an empty file.)</li>
</ul>
<p>I think we just need to be sure that the function is called with 1
argument...<br />
But the fact to provide an empty file to the function should not produce
an ERROR which kill the recovery process. After all, if the file is
empty, no modification will be done.</p>
<ul>
<li>I also made some changes in <code>250_migrate_disk_devices_layout.sh</code> in
    order to modify link target when absolute path is used. @schlomo
    @jsmeix your feedback/review is welcome here. (other scripts in
    finalize workflow should be modified in the same way, but lets
    validate this one before changing the others.)</li>
</ul>
<h4 id="jsmeix_commented_at_2017-09-12_0841"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1480#issuecomment-328784659">2017-09-12 08:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-12_0841" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I fail to understand how $1 is used in your<br />
apply_layout_mappings function because I find '$1'<br />
therein only in</p>
<pre>
    [ "$1" ] || BugError "..."
...
    if [ -s "$1" ] ; then
</pre>

<p>but afterwards it seems $1 is nowhere used?</p>
<p>FYI only a cosmetical proposal:<br />
In your apply_layout_mappings function you could eliminate the outer</p>
<pre>
    # Only apply layout mapping on non-empty file.
    if [ -s "$1" ] ; then
        ...
    fi
</pre>

<p>clause by "Return early, return often" coding style via</p>
<pre>
    # Only apply layout mapping on non-empty file:
    test -s "$1" || return 0
</pre>

<p>Is the apply_layout_mappings function perhaps meant like this:</p>
<pre>
function apply_layout_mappings() {

    # Nothing to do if not in migration mode:
    test "$MIGRATION_MODE" || return 0

    local file_to_migrate="$1"

    # apply_layout_mappings needs one argument:
    [ "$file_to_migrate" ] || BugError "apply_layout_mappings function called without argument (file_to_migrate)."

    # Only apply layout mapping on non-empty file:
    test -s "$file_to_migrate" || return 0

    ...
</pre>

<h4 id="schabrolles_commented_at_2017-09-12_0901"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1480#issuecomment-328789859">2017-09-12 09:01</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-12_0901" title="Permanent link">&para;</a></h4>
<p>@jsmeix, I've seen the <code>$1</code> issue during my test this morning. it is
corrected now.<br />
I also really like your test proposal.... It is very clean. I will
certainly update the code with it.</p>
<h4 id="schabrolles_commented_at_2017-09-12_1006"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1480#issuecomment-328806714">2017-09-12 10:06</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-12_1006" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schlomo Updated with @jsmeix test proposal. Feedback welcome.</p>
<h4 id="jsmeix_commented_at_2017-09-12_1225"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1480#issuecomment-328836801">2017-09-12 12:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-12_1225" title="Permanent link">&para;</a></h4>
<p>From plain looking at the code it looks very good now<br />
and I even understand what the apply_layout_mappings<br />
function is meant to do :-)</p>
<h4 id="schabrolles_commented_at_2017-09-13_0925"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1480#issuecomment-329110912">2017-09-13 09:25</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_0925" title="Permanent link">&para;</a></h4>
<p>I'm gonna merge this one soon (this afternoon)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-09-11.1480.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
