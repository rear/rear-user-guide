<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2999 Issue closed: NETFS shouldn't store /var/tmp - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2999 Issue closed: NETFS shouldn\u0027t store /var/tmp";
        var mkdocs_page_input_path = "issues/2023-05-31.2999.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2999 Issue closed: NETFS shouldn't store /var/tmp</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2999_issue_closed_netfs_shouldnt_store_vartmp"><a href="https://github.com/rear/rear/issues/2999">#2999 Issue</a> <code>closed</code>: NETFS shouldn't store /var/tmp<a class="headerlink" href="#2999_issue_closed_netfs_shouldnt_store_vartmp" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>discuss / RFC</code>, <code>won't fix / can't fix / obsolete</code></p>
<h4 id="schlomo_opened_issue_at_2023-05-31_2106"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/2999">2023-05-31 21:06</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-05-31_2106" title="Permanent link">&para;</a></h4>
<p>I noticed that <code>NETFS</code> stores the content of <code>/var/tmp</code> which is IMHO a
mistake.</p>
<p>I'm wondering where to add <code>/var/tmp</code>?</p>
<ol>
<li>to <code>BACKUP_PROG_EXCLUDE</code></li>
<li>to <code>AUTOEXCLUDE_PATH</code></li>
<li>to both?</li>
</ol>
<p>@jsmeix what do you think?</p>
<h4 id="jsmeix_commented_at_2023-06-01_0649"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571457550">2023-06-01 06:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-01_0649" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
is <code>/var/mp</code> a typo in<br />
<a href="https://github.com/rear/rear/issues/2999#issue-1735023344">https://github.com/rear/rear/issues/2999#issue-1735023344</a><br />
?</p>
<p>What exactly do you mean with 'store'?<br />
Do you mean "NETFS shouldn't backup /var/tmp"<br />
?</p>
<p>In general I think /var/tmp should be included in the backup by
default<br />
because according to how I understand what /var/tmp is meant for:</p>
<pre><code># man file-hierarchy
...
  /var/tmp/
    The place for larger and persistent temporary files.
    In contrast to /tmp/, this directory is usually mounted from a
    persistent physical file system and can thus accept larger files.
    (Use /tmp/ for small ephemeral files.)
    This directory is generally not flushed at boot-up,
    but time-based cleanup of files that have not been accessed
    for a certain time is applied.
</code></pre>
<p>Therein the crucial parts related to this issue are for me<br />
"persistent temporary files" and "not flushed at boot-up"<br />
from which I deduce that /var/tmp/ should also by default<br />
persist disaster recovery i.e. not flushed at disaster recovery.</p>
<p>See also what I think what disaster recovery should do<br />
in "Goal: Recreate a destroyed system" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<pre><code>... recreate it as much as possible as it was before ...
</code></pre>
<p>Only if data in /var/tmp/ can never be useful<br />
after the system was recreated, then /var/tmp<br />
could be excluded from the backup by default.</p>
<h4 id="schlomo_commented_at_2023-06-01_0654"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571463345">2023-06-01 06:54</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-01_0654" title="Permanent link">&para;</a></h4>
<p>So if it gets cleaned time based then we can also skip it in backups to
reduce backup size and speed up restores</p>
<p>By definition nobody should expect those files to persist, it must be ok
to delete then any time.</p>
<p>Therefore my question: to which variable should i add the directory to
excite it from backup?</p>
<p>And yes, I want to minimize the backup by default.</p>
<h4 id="jsmeix_commented_at_2023-06-01_0702"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571473924">2023-06-01 07:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-01_0702" title="Permanent link">&para;</a></h4>
<p>No,<br />
when it gets cleaned time based, we cannot skip it in backups<br />
because we have no right to overwrite<br />
the user's time based cleanup procedure.</p>
<p>E.g. when the user wants to keep files in /var/tmp<br />
that have not been accessed for more than one month<br />
and a disaster recovery happens, then after backup restore<br />
all files in /var/tmp that have not been accessed for<br />
less than one month must have been restored by default.<br />
This way on the recreated system the user's time based cleanup<br />
method will continue to behave as it did on his original system.</p>
<h4 id="jsmeix_commented_at_2023-06-01_0705"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571477147">2023-06-01 07:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-01_0705" title="Permanent link">&para;</a></h4>
<p>You are free to minimize your backup as you like<br />
but STOP to impose your will on our users!</p>
<h4 id="pcahyna_commented_at_2023-06-01_0916"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571665692">2023-06-01 09:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-01_0916" title="Permanent link">&para;</a></h4>
<p><code>/var/tmp</code> is typically used for editor temporary files (if not saved
next to the file being edited). When your machine crashes, you don't
want to lose the files you had been editing but had not saved. That's
why the recovery files should be kept in a place that does not get
cleaned up on boot.</p>
<p>Whether it should be included in the backup is a matter of taste for me.
If this is desired, <code>BACKUP_PROG_EXCLUDE</code> is the right place IMO
(currently the default value is</p>
<pre><code>BACKUP_PROG_EXCLUDE=( '/tmp/*' '/dev/shm/*' "$VAR_DIR/output/*" )
</code></pre>
<p>I hope that in any case, ReaR's temporary directory is not included in
the backup (I changed the default location to <code>/var/tmp</code> in #2664)</p>
<h4 id="pcahyna_commented_at_2023-06-01_0941"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571702987">2023-06-01 09:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-01_0941" title="Permanent link">&para;</a></h4>
<p>it is not: <code>BACKUP_PROG_EXCLUDE+=( "$BUILD_DIR" )</code> in <code>usr/sbin/rear</code></p>
<h4 id="schlomo_commented_at_2023-06-01_1136"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1571884232">2023-06-01 11:36</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-01_1136" title="Permanent link">&para;</a></h4>
<p>Thank you @pcahyna, the argument about crash recovery files is really
good.</p>
<h4 id="jsmeix_commented_at_2023-06-02_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1573318531">2023-06-02 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-02_0759" title="Permanent link">&para;</a></h4>
<p>Only FYI<br />
as an example how /var/tmp/ looks<br />
on my homeoffice laptop that I use since March 2020<br />
(the time when I started to work in homeoffice)<br />
and I had never cleaned up /var/tmp/ since then:</p>
<p>My /var/tmp/ is only 16 MiB so nothing to worry about.</p>
<p>Therein 15 MiB are many /var/tmp/zypp.* leftover directories, cf.<br />
<a href="https://forums.opensuse.org/t/all-versions-there-are-over-500-000-zypp-directories-in-var-tmp-a-fix/141834">https://forums.opensuse.org/t/all-versions-there-are-over-500-000-zypp-directories-in-var-tmp-a-fix/141834</a></p>
<p>The rest are mainly /var/tmp/systemd* directories from only today<br />
(i.e. systemd properly cleans up its stuff in /var/tmp)<br />
so almost nothing is left from other programs in /var/tmp.</p>
<p>In my case an empty /var/tmp/efi_virt/ directory is the only<br />
thing in /var/tmp except /var/tmp/zypp.* and /var/tmp/systemd*</p>
<p>Details:</p>
<pre><code># du -hs /var/tmp
16M     /var/tmp

# ls -ldt /var/tmp/*
drwx------ 3 root root 4096 Jun  2 08:13 /var/tmp/systemd-private-bd...c6-fwupd.service-0x9BAg
drwx------ 3 root root 4096 Jun  2 08:12 /var/tmp/systemd-private-bd...c6-colord.service-zxFH5f
drwx------ 3 root root 4096 Jun  2 08:12 /var/tmp/systemd-private-bd...c6-rtkit-daemon.service-UD64Qg
drwx------ 3 root root 4096 Jun  2 08:12 /var/tmp/systemd-private-bd...c6-upower.service-XGX4Dg
drwx------ 3 root root 4096 Jun  2 08:12 /var/tmp/systemd-private-bd...c6-power-profiles-daemon.service-IYKYvg
drwx------ 3 root root 4096 Jun  2 08:12 /var/tmp/systemd-private-bd...c6-chronyd.service-qIr6Xe
drwx------ 3 root root 4096 Jun  2 08:11 /var/tmp/systemd-private-bd...c6-ModemManager.service-jfbufi
drwx------ 3 root root 4096 Jun  2 08:11 /var/tmp/systemd-private-bd...c6-systemd-logind.service-MHuppi
drwx------ 3 root root 4096 Jun  2 08:11 /var/tmp/systemd-private-bd...c6-iio-sensor-proxy.service-a8qe6g
drwx------ 4 root root 4096 Apr 19 15:14 /var/tmp/zypp.BoRG4u
drwx------ 4 root root 4096 Feb 21 08:38 /var/tmp/zypp.UD898a
drwx------ 4 root root 4096 Jan 19 16:22 /var/tmp/zypp.pyhUqR
drwxr-xr-x 2 root root 4096 Jan 13 09:52 /var/tmp/efi_virt
drwx------ 4 root root 4096 Jan  2 08:57 /var/tmp/zypp.VlyVC2
drwx------ 5 root root 4096 Jul 27  2022 /var/tmp/zypp.7c1em7
...
[281 more /var/tmp/zypp.* directories]
...
drwx------ 4 root root 4096 Mar 11  2020 /var/tmp/zypp.FJREJZ
drwx------ 4 root root 4096 Mar 11  2020 /var/tmp/zypp.7y5jOT

# du -hsc /var/tmp/zypp*
64K     /var/tmp/zypp.03ibYt
28K     /var/tmp/zypp.0L2cMk
...
[284 more /var/tmp/zypp.* directories]
...
200K    /var/tmp/zypp.YdE4fp
64K     /var/tmp/zypp.YfvnIn
15M     total

# du -hs --exclude='zypp*' /var/tmp
92K     /var/tmp
</code></pre>
<h4 id="pcahyna_commented_at_2023-06-02_0914"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1573416179">2023-06-02 09:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-02_0914" title="Permanent link">&para;</a></h4>
<p>@jsmeix if running ReaR often you could have ReaR leftovers there :-)
(ReaR uses <code>/var/tmp</code> by default not because it needs persistence across
reboot, but because it needs lots of space. Unfortunately, FHS does not
seem to have a place for temporary files intended to have lots of space
and at the same time not persistent.)</p>
<h4 id="jsmeix_commented_at_2023-06-02_1021"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2999#issuecomment-1573501340">2023-06-02 10:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-02_1021" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I think since you reworked how ReaR cleanes up its build area<br />
ReaR behaves perfectly well i.e. it behaves as good as possible,<br />
in particular without blindly removing unintended data by accident.</p>
<p>That there is no place for big non-persistent temporary files<br />
is the root cause of all nowadays mess with temporary files.</p>
<p>See what I had written (meanwhile this part became removed) in<br />
<a href="https://en.opensuse.org/index.php?title=openSUSE:Tmp_on_tmpfs&amp;oldid=50818">https://en.opensuse.org/index.php?title=openSUSE:Tmp_on_tmpfs&amp;oldid=50818</a></p>
<pre><code>Consequence

Applications that write huge files to /tmp/ which are
not meant to be preserved between system reboots work
in compliance with the Filesystem Hierarchy Standard
and cannot be "fixed" by using /var/tmp/ instead
because files in /var/tmp/ cannot be cleaned up
automatically when the system is booted.

This conflicts with what is requested regarding
"My CD burning application writes huge .iso files
 to /tmp, and this breaks on tmpfs! - The application
 should be fixed to use /var/tmp."
at Fedora in
https://fedoraproject.org/wiki/Features/tmp-on-tmpfs#Comments_and_Discussion

If /tmp/ is on tmpfs there is the question what the right place is
for arbitrary kind of huge temporary files which are not meant
to be preserved between system reboots?
</code></pre>
<p>This question is not properly answered up to now.<br />
Instead postings that ask this question get removed.<br />
I am fed up and finished with any discussions<br />
about "the right handling" of temporary files.<br />
All is lost unless the basic questions get solved.<br />
And this is not something that belongs to ReaR.</p>
<p>Modernized question:<br />
"My application writes huge files to /var/tmp<br />
but when the system crashes (e.g. kernel panic)<br />
those huge files are still there after reboot."</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-05-31.2999.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
