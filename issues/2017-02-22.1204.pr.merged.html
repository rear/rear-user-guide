<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1204 PR merged: Enhancement: find 64-bit systemd UEFI bootloader - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1204 PR merged: Enhancement: find 64-bit systemd UEFI bootloader";
        var mkdocs_page_input_path = "issues/2017-02-22.1204.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1204 PR merged: Enhancement: find 64-bit systemd UEFI bootloader</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1204_pr_merged_enhancement_find_64-bit_systemd_uefi_bootloader"><a href="https://github.com/rear/rear/pull/1204">#1204 PR</a> <code>merged</code>: Enhancement: find 64-bit systemd UEFI bootloader<a class="headerlink" href="#1204_pr_merged_enhancement_find_64-bit_systemd_uefi_bootloader" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="probackup-nl_opened_issue_at_2017-02-22_2150"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> opened issue at <a href="https://github.com/rear/rear/pull/1204">2017-02-22 21:50</a>:<a class="headerlink" href="#probackup-nl_opened_issue_at_2017-02-22_2150" title="Permanent link">&para;</a></h4>
<p>As seen on UEFI 64-bit Arch Linux distributions with efibootmgr package
installed.<br />
Upon "bootctl install" the .efi files are:<br />
Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" to
"/boot/EFI/systemd/systemd-bootx64.efi".<br />
Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" to
"/boot/EFI/BOOT/BOOTX64.EFI".</p>
<p>When system is booting withing having a listing in the UEFI boot menu
(efivars) then the UEFI boot will most likely be booted using file
/boot/EFI/BOOT/BOOTX64.EFI.</p>
<h4 id="jsmeix_commented_at_2017-02-23_0845"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-281930769">2017-02-23 08:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-23_0845" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I think this one is a successor of<br />
<a href="https://github.com/rear/rear/pull/1203">https://github.com/rear/rear/pull/1203</a></p>
<h4 id="gozora_commented_at_2017-02-23_0856"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-281933249">2017-02-23 08:56</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-23_0856" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>yes, noticed that ;-). But #1203 was closed during I wrote my
<a href="https://github.com/rear/rear/pull/1203#discussion_r102582886">https://github.com/rear/rear/pull/1203#discussion_r102582886</a>,
so I've stayed and commented, there ...</p>
<h4 id="gozora_commented_at_2017-02-23_1655"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282051743">2017-02-23 16:55</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-23_1655" title="Permanent link">&para;</a></h4>
<p>Uffff, I don't remember last time when Linux distro installation took me
more than 15 minutes, oh wait, I know "Linux From Scratch" :-). You
should warn me @ProBackup-nl!<br />
But on the other hand, it is nice to see how lazy I've become over time!</p>
<p>I have a question here. From what I've understood you have to prepare
everything by your self in Arch live environment. Isn't there some
magical command like
<code>pacstrap --i-have-no-idea-what-to-do=ofcourse just_do_some_default_partitioning_and_install_my_freaking_efi_system</code>
?</p>
<p>Do I get it right that having whole <em>/boot</em> on vfat was your own
decision?</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-02-23_1936"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282096912">2017-02-23 19:36</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-23_1936" title="Permanent link">&para;</a></h4>
<p>Hello @ProBackup-nl,<br />
Looks like this will require a bit more work to make ReaR running on
Arch...</p>
<p>From my first testing:</p>
<ol>
<li>OUTPUT=ISO does not work at all for me (did not check deeper for
    reason)</li>
<li>OUTPUT=USB works somehow (when I manually set
    <em>USING_UEFI_BOOTLOADER=1</em> which should be IMHO opaque variable)</li>
<li>Patch you've provided did not work you my Arch distro because I had
    <em>/boot/EFI/grub/grubx64.efi</em> instead of yours <em>BOOTX64.EFI</em></li>
<li>I did not check deeper for possible problems when <em>/boot/EFI</em> is
    used directly and not as part of "standard" <em>/boot/efi/EFI</em></li>
</ol>
<p>In general I'd say that current ReaR code does not work on Arch Linux.<br />
@gdha, @jsmeix, @schlomo, @didacog or anybody else that might get this
message, please let me know if there is someone running ReaR flawlessly
on Arch Linux.</p>
<p>I'll continue to work on this topic next days and see how much effort
would it require to make ReaR behave correctly on Arch.</p>
<p>I'll keep you posted.</p>
<p>V.</p>
<h4 id="probackup-nl_commented_at_2017-02-23_2331"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282156147">2017-02-23 23:31</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-02-23_2331" title="Permanent link">&para;</a></h4>
<p>@gozora Because UEFI has got a boot menu implementation in itself, I
prefer not to chain another boot menu after that. In fact I prefer to
most quickly (directly) UEFI boot the Linux kernel (using EFISTUB, which
is enabled by default in Arch Linux).<br />
<a href="https://bbs.archlinux.org/viewtopic.php?pid=1149530#p1149530">Arch Linux also moved to
systemd</a>,
so systemd gets installed by default, and that comes with
<a href="https://wiki.archlinux.org/index.php/systemd-boot">systemd-boot</a>, which
can only start EFI executables. EFI booting is all I need. <a href="https://wiki.archlinux.org/index.php/Category:Boot_loaders">systemd-boot
only boots from
VFAT</a>. It is
my decision to not install an additional boot loader. There is not much
choice in using /boot. Anything else is even more manual labour:</p>
<blockquote>
<p>Note: systemd-boot cannot load EFI binaries from other partitions. It
is therefore recommended to mount your ESP to /boot. In case you want
to separate /boot from the ESP see
<a href="https://wiki.archlinux.org/index.php/Systemd-boot#Manually">#Manually</a>
for more information.</p>
</blockquote>
<p>Arch can use many different boot loaders, my interest is only in
<strong><a href="https://wiki.archlinux.org/index.php/systemd-boot">systemd-boot</a></strong>,
UEFI, 64-bit.</p>
<h4 id="gozora_commented_at_2017-02-24_0628"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282215307">2017-02-24 06:28</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-24_0628" title="Permanent link">&para;</a></h4>
<p>@ProBackup-nl<br />
Did you somehow manipulate with <em>USING_UEFI_BOOTLOADER</em> variable?</p>
<h4 id="didacog_commented_at_2017-02-24_0905"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282240724">2017-02-24 09:05</a>:<a class="headerlink" href="#didacog_commented_at_2017-02-24_0905" title="Permanent link">&para;</a></h4>
<p>Hi @gozora,</p>
<p>I've used Archlinux, but the "problem" I see with that distro, from the
ReaR point of view, is that you can define boot partition, bootloader,
fstypes,... as you want and there is nothing strictly standard like on
other distros, with archlinux is always the user choice. Will be more
difficult make it work flawessly like on RHEL, Debian, SLES,... that
have, more or less, standard installation methods.</p>
<h4 id="gozora_commented_at_2017-02-24_0907"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282241214">2017-02-24 09:07</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-24_0907" title="Permanent link">&para;</a></h4>
<p>Thanks @didacog!<br />
That's what I actually thought! But as I'm Arch noob I wanted to be sure
that I did not overlooked something.</p>
<p>V.</p>
<h4 id="didacog_commented_at_2017-02-24_0910"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282241872">2017-02-24 09:10</a>:<a class="headerlink" href="#didacog_commented_at_2017-02-24_0910" title="Permanent link">&para;</a></h4>
<p>@gozora I love Arch, but if you think in standard stuff, will be
difficult to find 2 installations with same config... :-P</p>
<h4 id="gozora_commented_at_2017-02-24_0930"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282245966">2017-02-24 09:30</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-24_0930" title="Permanent link">&para;</a></h4>
<p>@didacog, I like the idea of clean system (Arch) as well, it can be
certainly useful in certain scenarios. Lets see if I can make ReaR like
it as well :-)</p>
<h4 id="jsmeix_commented_at_2017-02-24_1003"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282252947">2017-02-24 10:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-24_1003" title="Permanent link">&para;</a></h4>
<p>I think we should better open a separated<br />
ReaR GitHub enhancement issue regarding<br />
"ReaR support for Arch Linux".</p>
<p>In general regarding<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282240724">https://github.com/rear/rear/pull/1204#issuecomment-282240724</a></p>
<pre>
... with that distro, from the ReaR point of view, is
that you can define boot partition, bootloader, fstypes,...
as you want and there is nothing strictly standard like
on other distros ...
</pre>

<p>For me there are way too much secretly working<br />
"magic automatisms" in ReaR that try to do "things right"<br />
but of course no automatism is infallible in parctice<br />
so that when such automatisms fail it results often<br />
really bad user experience because for the user it looks<br />
as if the "whole ReaR thing" behaves inexplicable.</p>
<p>Therefore I like to get ReaR step by step moved<br />
away from secretly working automatisms towards<br />
procedures that can be fully controlled by the user<br />
via appropriate variable settings if needed but that<br />
also use reasonable defaults or fallback values<br />
when those variables are not specified.</p>
<p>This way the current default behaviour of ReaR<br />
does not change but if needed the user can specify<br />
what ReaR should do in this or that particular case.</p>
<p>When there are no standards in Arch Linux<br />
then Arch Linux is only a good template case<br />
for any specific arbitrary Linux installation<br />
where the admin could have set up anything<br />
in his arbitrary special non-standard way.</p>
<p>Ideally - in the future - ReaR should be able<br />
to also work in such cases - of course not<br />
automatically right out of the box - but the user<br />
should be able to tell ReaR about each and any<br />
of his special non-standard things.</p>
<h4 id="jsmeix_commented_at_2017-02-24_1005"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282253347">2017-02-24 10:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-24_1005" title="Permanent link">&para;</a></h4>
<p>@gozora regarding your question in<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282096912">https://github.com/rear/rear/pull/1204#issuecomment-282096912</a></p>
<p>I never used Arch Linux.</p>
<h4 id="jsmeix_commented_at_2017-02-24_1028"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-282258366">2017-02-24 10:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-24_1028" title="Permanent link">&para;</a></h4>
<p>What looks wrong in this particular case is that<br />
in default.conf there is only USING_UEFI_BOOTLOADER<br />
but the actual thing UEFI_BOOTLOADER is set<br />
by a "secretly working automatism".</p>
<p>I would prefer there is also UEFI_BOOTLOADER<br />
documented and specified in default.conf<br />
so that the user knows how to set it right<br />
if needed in /etc/local.conf.</p>
<p>Perhaps - only an offhanded idea - the default setting of<br />
UEFI_BOOTLOADER in default.conf could be a list<br />
or an array of file names or even bash globbing expressions<br />
and the actual code searches in the ordering of that list<br />
for one single file and the first match is then used as<br />
actual UEFI_BOOTLOADER value i.e. something like</p>
<pre>
test "${UEFI_BOOTLOADER[*]:-}" || Error "Empty UEFI_BOOTLOADER"
local found_uefi_bootloader=""
for uefi_bootloader in "${UEFI_BOOTLOADER[@]}" ; do
    if test -f "$uefi_bootloader" ; then
        UEFI_BOOTLOADER=( "$uefi_bootloader" )
        found_uefi_bootloader="yes"
        LogPrint "Using UEFI bootloader '$uefi_bootloader'"
        break
    fi
done
test "$found_uefi_bootloader" || Error "No UEFI bootloader found"
</pre>

<h4 id="probackup-nl_commented_at_2017-02-28_1307"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283033844">2017-02-28 13:07</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-02-28_1307" title="Permanent link">&para;</a></h4>
<p>@gozora I started without modifying local.conf. After some error
messages I ended up with /etc/rear/local.conf:</p>
<pre><code>USING_UEFI_BOOTLOADER=1
UEFI_BOOTLOADER=/boot/EFI/BOOT/BOOTX64.EFI
</code></pre>
<h4 id="jsmeix_commented_at_2017-02-28_1333"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283039670">2017-02-28 13:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1333" title="Permanent link">&para;</a></h4>
<p>@ProBackup-nl<br />
do I understand your<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-283033844">https://github.com/rear/rear/pull/1204#issuecomment-283033844</a><br />
that it works for you without any modifications in the ReaR scripts<br />
only by specifying in /etc/rear/local.conf</p>
<pre>
USING_UEFI_BOOTLOADER=1
UEFI_BOOTLOADER=/boot/EFI/BOOT/BOOTX64.EFI
</pre>

<p>?</p>
<p>If yes, I think at least for now it should help to also<br />
document the UEFI_BOOTLOADER variable<br />
in default.conf.</p>
<h4 id="probackup-nl_commented_at_2017-02-28_1350"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283043793">2017-02-28 13:50</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-02-28_1350" title="Permanent link">&para;</a></h4>
<p>@jsmeix Comment
<a href="https://github.com/rear/rear/pull/1204#issuecomment-283033844">https://github.com/rear/rear/pull/1204#issuecomment-283033844</a>
is a reply to
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282215307">https://github.com/rear/rear/pull/1204#issuecomment-282215307</a>:</p>
<blockquote>
<p>Did you somehow manipulate with USING_UEFI_BOOTLOADER variable?</p>
</blockquote>
<p>After making these changes, Rear still errors out.</p>
<h4 id="jsmeix_commented_at_2017-02-28_1358"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283045547">2017-02-28 13:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1358" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/1204#issue-209592311">https://github.com/rear/rear/pull/1204#issue-209592311</a></p>
<pre>
/boot/EFI/BOOT/BOOTX64.EFI
</pre>

<p>versus<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282096912">https://github.com/rear/rear/pull/1204#issuecomment-282096912</a></p>
<pre>
/boot/EFI/grub/grubx64.efi
</pre>

<p>In general how to find a file by its name<br />
regardless of case I suggest to use</p>
<pre>
find /boot/EFI -iname "BOOTX64.EFI"
</pre>

<p>cf.<br />
<a href="http://unix.stackexchange.com/questions/32155/find-command-how-to-ignore-case">http://unix.stackexchange.com/questions/32155/find-command-how-to-ignore-case</a></p>
<p>I tested it down to SUSE Linux Enterprise Server 10<br />
and even there find supports '-iname':</p>
<pre>
# cat /etc/issue
Welcome to SUSE Linux Enterprise Server 10 SP4  (x86_64) ...

# find --version
GNU find version 4.2.27

# find /boot -iname 'system*'
/boot/System.map-2.6.16.60-0.85.1-default
</pre>

<h4 id="jsmeix_commented_at_2017-02-28_1506"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283064105">2017-02-28 15:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1506" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I also think merging this pull request should not do any harm<br />
so that - if you do not object - I could merge it soon<br />
or you could merge it yourself if you can and like.</p>
<p>Later we can do further enhancements.</p>
<h4 id="jsmeix_commented_at_2017-02-28_1553"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283078049">2017-02-28 15:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1553" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
why should stderr be redicrectet to /dev/null ?<br />
I think stderr goes to the ReaR log file and<br />
I would want to see in particular any errors<br />
in the ReaR log file.</p>
<p>For me it behaves well on command line:</p>
<pre>
# foo=$( find /boot -name "vmlinux*" | tail -1 ) ; echo "'$foo'"
'/boot/vmlinux-3.0.101-0.47.71-pae.gz'

# foo=$( find /boot -name "qqq" | tail -1 ) ; echo "'$foo'"
''

# foo=$( find qqq -name "qqq" | tail -1 ) ; echo "'$foo'"
find: `qqq': No such file or directory
''
</pre>

<h4 id="gdha_commented_at_2017-02-28_1608"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283082962">2017-02-28 16:08</a>:<a class="headerlink" href="#gdha_commented_at_2017-02-28_1608" title="Permanent link">&para;</a></h4>
<p>@jsmeix redirect to /dev/null makes sense as the next if block checks if
the UEFI_BOOTLOADER variable is empty and if so then it will bail out
with an error. It is a matter of taste. If you prefer to see an extra
error then you make merge the pull request. I have no real objections.</p>
<h4 id="gozora_commented_at_2017-02-28_1611"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283083908">2017-02-28 16:11</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-28_1611" title="Permanent link">&para;</a></h4>
<p>@jsmeix, @gdha,<br />
Of topic, but are there some special rules for merging pull request, or
it is enought to hit that big <s>red</s> green button?</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-02-28_1620"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283086909">2017-02-28 16:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1620" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
to merge a pull request hit that big green [Merge pull request]<br />
button and then you need (you really need) to provide<br />
a meaningful merge commit log message<br />
(the default message is usually mostly useless)<br />
that tells the essentials about 'what' and 'why' of it<br />
preferably without too bad typos ;-) because one cannot<br />
fix git commit log messages later with reasonable effort.</p>
<h4 id="gozora_commented_at_2017-02-28_1624"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283088150">2017-02-28 16:24</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-28_1624" title="Permanent link">&para;</a></h4>
<p>Ah typos, thanks for pointing this out :-) (You can never use enough
spellcheckers)</p>
<p>Would something like this be suitable for this merge message?</p>
<pre><code>fix for finding UEFI boot loader on Arch Linux
</code></pre>
<h4 id="jsmeix_commented_at_2017-02-28_1629"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283089625">2017-02-28 16:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1629" title="Permanent link">&para;</a></h4>
<p>I agree it is a matter of taste to some degree.<br />
I would prefer to see all stderr messages because<br />
it makes a difference if the named file is not found<br />
or if the directory where find should search does<br />
not exist, cf. my above example<br />
e.g. when there is in the ReaR log</p>
<pre>
find: `/boot/EFI': No such file or directory
Error "Cannot find a proper UEFI_BOOTLOADER...
</pre>

<p>versus only</p>
<pre>
Error "Cannot find a proper UEFI_BOOTLOADER...
</pre>

<h4 id="jsmeix_commented_at_2017-02-28_1632"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283090703">2017-02-28 16:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1632" title="Permanent link">&para;</a></h4>
<p>I think this pull request in not yet a real<br />
"fix for finding UEFI boot loader on Arch Linux"<br />
because currently it only implements to</p>
<pre>
Try to find UEFI_BOOTLOADER file BOOTX64.EFI in /boot/EFI
where it could be located in particular on Arch Linux.
</pre>

<h4 id="gozora_commented_at_2017-02-28_1641"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283093539">2017-02-28 16:41</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-28_1641" title="Permanent link">&para;</a></h4>
<p>Right, thanks @jsmeix, for valuable lesson!<br />
I'll watch ReaR commit comments more carefully, and who knows, maybe I
will learn something! :-)</p>
<p>I'll use</p>
<pre><code>Try to find UEFI_BOOTLOADER file BOOTX64.EFI in /boot/EFI
where it could be located in particular on Arch Linux.
</code></pre>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-02-28_1707"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283101494">2017-02-28 17:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-28_1707" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
only FYI:<br />
My preferred command to view git log messages is something like</p>
<pre>
git log --format="%ae %ad%n%s :%n%b%n" --graph | fmt -w 120 -u -t | less
</pre>

<p>cf.<br />
<a href="https://github.com/rear/rear/issues/1073#issuecomment-270373403">https://github.com/rear/rear/issues/1073#issuecomment-270373403</a></p>
<h4 id="probackup-nl_commented_at_2017-02-28_2040"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283154106">2017-02-28 20:40</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-02-28_2040" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
A clarification.</p>
<p>The location /boot/EFI/ has got very little to do with "Arch Linux", it
is the <strong>UEFI spec ‘Fallback path’</strong> mount point for most Linux
installation:</p>
<ol>
<li>/boot is the name that most Linux variants use to mount the ESP to</li>
<li>/EFI/ or even more specific /EFI/BOOT/BOOTX64.EFI (or
    \EFI\BOOT\BOOTX64.EFI from UEFI's point of view) is the location
    where most (crippled) 64-bit UEFI firmware will only look to further
    progress boot.</li>
</ol>
<blockquote>
<p>What it actually looks for is \EFI\BOOT\BOOT{machine type
short-name}.EFI – ‘x64’ is the “machine type short-name” for x86-64
PCs. The other possibilities are BOOTIA32.EFI (x86-32), BOOTIA64.EFI
(Itanium), BOOTARM.EFI (AArch32 – that is, 32-bit ARM) and
BOOTAA64.EFI (AArch64 – that is, 64-bit ARM).</p>
<p>This mechanism is not designed for booting permanently-installed OSes.
It’s more designed for booting hotpluggable, device-agnostic media,
like live images and OS install media...</p>
</blockquote>
<h4 id="gozora_commented_at_2017-02-28_2057"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283158016">2017-02-28 20:57</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-28_2057" title="Permanent link">&para;</a></h4>
<p>I'm a bit lazy lately doing partition layouts so I just tell installer
"do partitioning your self, I don't care" and here are couple of
examples how partitioning was decided by my 8.7 Debian and Centos 7.2</p>
<pre><code>root@debian:~# bdf | grep boot
/dev/sda1                 118M   77M   35M  70% /boot
/dev/sda2                 121M  766K  120M   1% /boot/efi

centos:(/root)(root)# bdf | grep boot
/dev/sda2                 194M   66M  119M  36% /boot
/dev/sda1                  64M   10M   54M  16% /boot/efi
</code></pre>
<p>For SLES12 SP1 running SAP HANA it is quite similar</p>
<pre><code>/dev/mapper/vg_root-lv_root    100G   12G   89G  12% /
/dev/sda1                      156M  4,9M  151M   4% /boot/efi
</code></pre>
<p>It have nothing to do with technical solution but I simply don't like
heaving /boot files (kernel, initrd, ...) on VFAT ...</p>
<p>Here I'd refer to <a href="https://tools.ietf.org/html/rfc1925">RFC 1925</a>
section 2.3</p>
<pre><code>With sufficient thrust, pigs fly just fine. However, this is
not necessarily a good idea. It is hard to be sure where they
are going to land, and it could be dangerous sitting under them
as they fly overhead.
</code></pre>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-03-01_0851"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283280887">2017-03-01 08:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-01_0851" title="Permanent link">&para;</a></h4>
<p>As time permits I will try to enhance<br />
rescue/default/850_save_sysfs_uefi_vars.sh<br />
plus appropriate documentation in default.conf<br />
to make UEFI_BOOTLOADER work in a more general way.</p>
<h4 id="jsmeix_commented_at_2017-03-01_1301"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283333605">2017-03-01 13:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-01_1301" title="Permanent link">&para;</a></h4>
<p>For a first proposal how to enhance<br />
rescue/default/850_save_sysfs_uefi_vars.sh<br />
plus appropriate documentation in default.conf see<br />
<a href="https://github.com/rear/rear/pull/1212">https://github.com/rear/rear/pull/1212</a></p>
<h4 id="jsmeix_commented_at_2017-03-03_1418"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-283964438">2017-03-03 14:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-03_1418" title="Permanent link">&para;</a></h4>
<p>@ProBackup-nl<br />
I would appreciate it if you could test<br />
whether or not it still works for you<br />
with current ReaR GitHub master code<br />
where the follow-up<br />
<a href="https://github.com/rear/rear/pull/1212">https://github.com/rear/rear/pull/1212</a><br />
is merged.</p>
<h4 id="probackup-nl_commented_at_2017-03-03_2339"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-284101007">2017-03-03 23:39</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-03-03_2339" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I did a <code># git stash &amp;&amp; git pull</code></p>
<pre><code>From https://github.com/rear/rear
   e310a6e7..1917742e  master     -&gt; origin/master
Updating e310a6e7..1917742e
Fast-forward
 usr/share/rear/conf/default.conf                          |  20 ++++++++++
 usr/share/rear/prep/RSYNC/GNU/Linux/200_selinux_in_use.sh |   7 ++++
 usr/share/rear/rescue/default/850_save_sysfs_uefi_vars.sh | 194 +++++++++++++++++++++++++++++++++++++++++++++++++++++++-----------------------------------
 3 files changed, 145 insertions(+), 76 deletions(-)
</code></pre>
<p><code># usr/sbin/rear -v mkrescue</code> (still having syslinux package removed)
outputs:</p>
<p><code>ERROR: Could not find file 'mbr.bin'. Syslinux version 3.08 or newer is required, 4.x prefered!</code></p>
<pre><code># tail -n20 /root/rear/var/log/rear/rear-d2.log
2017-03-04 00:35:09 Including prep/GNU/Linux/300_include_grub_tools.sh
2017-03-04 00:35:09 Including prep/GNU/Linux/310_include_cap_utils.sh
2017-03-04 00:35:09 Including prep/default/310_include_uefi_tools.sh
2017-03-04 00:35:09 Including prep/default/320_include_uefi_env.sh
2017-03-04 00:35:09 Including prep/USB/Linux-i386/340_find_mbr_bin.sh
2017-03-04 00:35:09 ERROR: Could not find file 'mbr.bin'. Syslinux version 3.08 or newer is required, 4.x prefered!
==== Stack trace ====
Trace 0: usr/sbin/rear:504 main
Trace 1: /root/rear/usr/share/rear/lib/mkrescue-workflow.sh:12 WORKFLOW_mkrescue
Trace 2: /root/rear/usr/share/rear/lib/framework-functions.sh:85 SourceStage
Trace 3: /root/rear/usr/share/rear/lib/framework-functions.sh:45 Source
Trace 4: /root/rear/usr/share/rear/prep/USB/Linux-i386/340_find_mbr_bin.sh:22 source
Trace 5: /root/rear/usr/share/rear/lib/_input-output-functions.sh:132 StopIfError
Message: Could not find file 'mbr.bin'. Syslinux version 3.08 or newer is required, 4.x prefered!
== End stack trace ==
</code></pre>
<h4 id="jsmeix_commented_at_2017-03-06_0925"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1204#issuecomment-284343898">2017-03-06 09:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-03-06_0925" title="Permanent link">&para;</a></h4>
<p>@ProBackup-nl<br />
please do not post new unrelated issues<br />
at arbitrary existing issues.<br />
Create new separated GitHub issues for separated issues.<br />
Your<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-284101007">https://github.com/rear/rear/pull/1204#issuecomment-284101007</a><br />
is about prep/USB/Linux-i386/340_find_mbr_bin.sh<br />
which was not changed recently.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-02-22.1204.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
