<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#882 Issue closed: HP Superdome-X servers using multipath an booting from SAN not backing up de ROOT filesystem! - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#882 Issue closed: HP Superdome-X servers using multipath an booting from SAN not backing up de ROOT filesystem!";
        var mkdocs_page_input_path = "issues/2016-06-16.882.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#882 Issue closed: HP Superdome-X servers using multipath an booting from SAN not backing up de ROOT filesystem!</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="882_issue_closed_hp_superdome-x_servers_using_multipath_an_booting_from_san_not_backing_up_de_root_filesystem"><a href="https://github.com/rear/rear/issues/882">#882 Issue</a> <code>closed</code>: HP Superdome-X servers using multipath an booting from SAN not backing up de ROOT filesystem!<a class="headerlink" href="#882_issue_closed_hp_superdome-x_servers_using_multipath_an_booting_from_san_not_backing_up_de_root_filesystem" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="didacog_opened_issue_at_2016-06-16_1236"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> opened issue at <a href="https://github.com/rear/rear/issues/882">2016-06-16 12:36</a>:<a class="headerlink" href="#didacog_opened_issue_at_2016-06-16_1236" title="Permanent link">&para;</a></h4>
<h1 id="relax-and-recover_rear_issue_template">Relax-and-Recover (rear) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h1>
<p>Please fill in the following items before submitting a new issue:</p>
<ul>
<li>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 1.17.2 / Git</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    LSB Version:
    :base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch<br />
    Distributor ID: RedHatEnterpriseServer<br />
    Description: Red Hat Enterprise Linux Server release 6.6
    (Santiago)<br />
    Release: 6.6<br />
    Codename: Santiago</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
</ul>
<!-- -->

<pre><code>    DRLM_NAME=sdomeX01
    OUTPUT=PXE
    OUTPUT_PREFIX=$OUTPUT
    OUTPUT_PREFIX_PXE=$DRLM_NAME/$OUTPUT_PREFIX
    OUTPUT_URL=nfs://192.168.1.100/DRLM/STORE/${DRLM_NAME}
    BACKUP=NETFS
    BACKUP_URL=nfs://192.168.1.100/DRLM/STORE/${DRLM_NAME}
    NETFS_PREFIX=BKP
    EXCLUDE_VG=( 'vgDATA' )
    SSH_ROOT_PASSWORD=rear
    USING_UEFI_BOOTLOADER=1
    AUTOEXCLUDE_MULTIPATH=n
    BOOT_OVER_SAN=y
</code></pre>
<ul>
<li>Brief description of the issue</li>
</ul>
<p>We are playing with new HP Superdome-X servers. These brand new servers
are using multipath an booting from SAN.</p>
<p>On disk layout collection never gets info from root filesystem (/) but
for other partitions in same device collects all info with no problems.
The problem is that is not backing up de ROOT filesystem!</p>
<p>There is an issue with this file:
/usr/share/rear/layout/save/GNU/Linux/23_filesystem_layout.sh</p>
<p>this line:</p>
<pre><code>read_filesystems_command="$findmnt_command **-nrv** -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"

# findmnt command looks on  /proc/self/mountinfo by default and gets this info of (/):

$ cat /proc/self/mountinfo | grep ext3
21 1 253:12 / / rw,relatime - ext3 /dev/mapper/**360002ac000000000000000040001a624p4** rw,errors=continue,user_xattr,acl,barrier=1,data=ordered
23 21 253:10 / /boot rw,relatime - ext3 /dev/mapper/vvbootp2 rw,errors=continue,user_xattr,acl,barrier=1,data=ordered
</code></pre>
<p>In this case is informing the device WWN from SAN instead of the mpath
alias name used in all rear scripts.</p>
<pre><code># mount command uses /etc/mtab by default gets the correct device info:

$ cat /etc/mtab | grep ext3
/dev/mapper/**vvbootp4** / ext3 rw 0 0
/dev/mapper/vvbootp2 /boot ext3 rw 0 0
</code></pre>
<ul>
<li>Work-around, if any</li>
</ul>
<p>Proposal:</p>
<p>/usr/share/rear/layout/save/GNU/Linux/23_filesystem_layout.sh</p>
<p>Change this line:</p>
<pre><code>read_filesystems_command="$findmnt_command **-nrv** -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"
</code></pre>
<p>to:</p>
<pre><code>read_filesystems_command="$findmnt_command **-mnrv** -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"
</code></pre>
<p>This will force findmnt command to use /etc/mtab instead of
/proc/self/mountinfo and provide the correct info resulting in the
correct disklayout file:</p>
<pre><code>fs /dev/mapper/**vvbootp4** / ext3 uuid=2cf46bd1-892b-4154-8f87-c6fc79fcc2a5 label=HANA_ROOT blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16381 default_mount_options=user_xattr,acl options=rw
</code></pre>
<p>I've tested it and now is getting the correct info, but prior to sending
a pull request I would ask if you guys have any concern about this
modification.</p>
<p>Kind Regards!</p>
<p>Didac</p>
<h4 id="jsmeix_commented_at_2016-06-16_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226475391">2016-06-16 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1250" title="Permanent link">&para;</a></h4>
<p>The code that uses the findmnt command is from me<br />
therefore I assign the issue to me.</p>
<p>I do not run RHEL (and I do not know what is special on RHEL)<br />
therefore I assign the issue also to @gdha</p>
<p>@didacog<br />
simply do a GitHub Pull Request (regardless how good your code<br />
currently is) so that we have something real to discuss it<br />
and so that I can test if it still works on SLES with your changes.<br />
Please use the current rear GitHub master code<br />
as base for your Pull Request.</p>
<p>@didacog<br />
the code snippets in your comment avobe are very hard to read<br />
because of the automated formatting in GitHub.<br />
For code snippets I enclose them<br />
in HTML <pre> and </pre> tags which works o.k.<br />
for me but one has to write &lt; as HTML &lt;<br />
Perhaps there is something even better how to<br />
specify preformatted texts in GitHub?</p>
<h4 id="didacog_commented_at_2016-06-16_1301"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226478116">2016-06-16 13:01</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1301" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix @gdha,</p>
<p>Ok I will prepare the pull request. this is the code to change, just one
findmnt option:</p>
<pre>
/usr/share/rear/layout/save/GNU/Linux/23_filesystem_layout.sh
Change this line:
read_filesystems_command="$findmnt_command -nrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"
to:
read_filesystems_command="$findmnt_command -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"
</pre>

<p>I will also check if any modification needed for this other issue:</p>
<p>2016-06-16 13:22:34.103712191 Could not determine start of partition
vvbootp1.<br />
2016-06-16 13:22:34.111206812 Could not determine start of partition
vvbootp2.<br />
2016-06-16 13:22:34.118799098 Could not determine start of partition
vvbootp3.<br />
2016-06-16 13:22:34.126096733 Could not determine start of partition
vvbootp4.</p>
<p>resulting in /var/lib/rear/layout/disklayout.conf:</p>
<p>part /dev/mapper/vvboot 536870912 unknown rear-noname boot
/dev/mapper/vvbootp1<br />
part /dev/mapper/vvboot 536870912 unknown rear-noname none
/dev/mapper/vvbootp2<br />
part /dev/mapper/vvboot 2147483648 unknown rear-noname none
/dev/mapper/vvbootp3<br />
part /dev/mapper/vvboot 271623127040 unknown rear-noname none
/dev/mapper/vvbootp4</p>
<p>And provide a pull request with all modifications needed.</p>
<p>Thanks!</p>
<p>Didac</p>
<h4 id="jsmeix_commented_at_2016-06-16_1303"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226478405">2016-06-16 13:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1303" title="Permanent link">&para;</a></h4>
<p>I changed the initial comment to<br />
use HTML <pre> and </pre> tags<br />
and now I can better read it.</p>
<p>On very first glance I do not like to</p>
<pre>
force findmnt command to use /etc/mtab instead of /proc/self/mountinfo
</pre>

<p>because think using /etc/mtab is an indirection (cf. RFC1925 6a)<br />
that can cause whatever unexpected failures instead of<br />
asking the kernel directly (via /proc/self/mountinfo).</p>
<p>@didacog<br />
nevertheless do your Pull Request.</p>
<h4 id="jsmeix_commented_at_2016-06-16_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226481877">2016-06-16 13:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1317" title="Permanent link">&para;</a></h4>
<p>On my SLES12-SP1 system with its default btrfs structure<br />
the output of the proposed new "findmnt -mnrv ..." is the same<br />
as the output of the currently used "findmnt -nrv ..." so that<br />
from my current point of view the proposed change seems<br />
to be o.k. (i.e. it seems to cause no regression for SLE).</p>
<p>What I did:</p>
<pre>
# cat /etc/os-release 
NAME="SLES"
VERSION="12-SP1"
VERSION_ID="12.1"
PRETTY_NAME="SUSE Linux Enterprise Server 12 SP1"
...
# /usr/bin/findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs >/tmp/findmnt-mnrv
# /usr/bin/findmnt -nrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs >/tmp/findmnt-nrv
# diff -s /tmp/findmnt-nrv /tmp/findmnt-mnrv
Files /tmp/findmnt-nrv and /tmp/findmnt-mnrv are identical
</pre>

<h4 id="jsmeix_commented_at_2016-06-16_1324"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226483601">2016-06-16 13:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1324" title="Permanent link">&para;</a></h4>
<p>Nevertheless I need to inspect what the actual difference is<br />
between /etc/mtab which is a link to /proc/self/mounts<br />
versus /proc/self/mountinfo</p>
<h4 id="didacog_commented_at_2016-06-16_1325"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226483948">2016-06-16 13:25</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1325" title="Permanent link">&para;</a></h4>
<p>@jsmeix you are really fast! ;)</p>
<p>I think this will be the same behaviour as using mount command if
findmnt is not present, and should work.</p>
<p>I'm now deeping with the other issue with partition layouts and after
that I will provide a pull request.</p>
<p>Thanks!</p>
<h4 id="didacog_commented_at_2016-06-16_1330"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226485148">2016-06-16 13:30</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1330" title="Permanent link">&para;</a></h4>
<p>@jsmeix i found this post regarding /proc/self/mounts vs
/proc/self/mountinfo:</p>
<p><a href="http://serverfault.com/questions/581178/proc-self-mountinfo-per-mount-options-vs-per-super-options/581180">http://serverfault.com/questions/581178/proc-self-mountinfo-per-mount-options-vs-per-super-options/581180</a></p>
<h4 id="jsmeix_commented_at_2016-06-16_1333"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226485825">2016-06-16 13:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1333" title="Permanent link">&para;</a></h4>
<p>If it is really the exact same behaviour as the old mount command<br />
I could not accept it because I need new findmnt features to deal<br />
correctly with btrfs subvolumes.</p>
<p>See also my comment regarding "man 8 mount"<br />
in 23_filesystem_layout.sh but this comment only<br />
tells to use findmnt instead of mount so that<br />
"findmnt -m..." could be the right thing.</p>
<p>On the other hand perhaps using "findmnt -m..."<br />
might be not an actually right future-proof solution<br />
but merely some kind of workaround that only hides<br />
to deal correctly with the actual root cause?</p>
<h4 id="jsmeix_commented_at_2016-06-16_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226487815">2016-06-16 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1340" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
when you are currently "playing with new HP Superdome-X servers"<br />
could you also test if your changes also work with SLE12-SP1<br />
and its default btrfs subvolume structure?</p>
<p>Obviously I cannot do such a test myself because I do not<br />
have a HP Superdome-X server to play around ;-)</p>
<p>Such a test would help a lot to ensure that also btrfs subvolumes<br />
on RHEL still work on that new hardware or to reveal the<br />
actual root cause (e.g. something like better general support<br />
when the root filesystem is on SAN via multipath.</p>
<p>I never tested rear myself with SAN and multipath.</p>
<p>I blindly guess that general support when the root filesystem<br />
is on SAN via multipath might be currently poor in rear.</p>
<h4 id="jsmeix_commented_at_2016-06-16_1349"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226490277">2016-06-16 13:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1349" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
many thanks for the link in<br />
<a href="https://github.com/rear/rear/issues/882#issuecomment-226485148">https://github.com/rear/rear/issues/882#issuecomment-226485148</a></p>
<p>I do not yet fully understand what is meant in<br />
<a href="http://serverfault.com/questions/581178/proc-self-mountinfo-per-mount-options-vs-per-super-options/581180">http://serverfault.com/questions/581178/proc-self-mountinfo-per-mount-options-vs-per-super-options/581180</a><br />
with (excerpt)</p>
<pre>
/proc/self/mountinfo is the most authoritative source to check your mounts.
/proc/mounts is a deprecated source to check the status of your mounts.
...
 /proc/mounts symlinks to /proc/self/mounts
</pre>

<p>As far as I understand it this means that<br />
/proc/self/mounts (and its symlinks like /proc/mounts or /etc/mtab)<br />
are deprecated sources to check the status of your mounts.</p>
<p>Accordingly it seems "findmnt -m..."<br />
is not an actually right future-proof solution.</p>
<h4 id="didacog_commented_at_2016-06-16_1353"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226491392">2016-06-16 13:53</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1353" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I think that with the root partition on mpath device, the problem is
when kernel loading the root partiton booting from SAN, this partition
has not yet the mpath alias defined in kernel and keeps its WWN name on
the /proc/self/mountinfo file.</p>
<p>Maybe an exeption when booting from SAN? the problem is that if not
properly identified with this name, root filesystem is not present in
disklayout file and does not backup of (/).</p>
<p>I will figure out other solutions and use this as workarround in the
meantime, and if is possible i will test with SLES, but I cannot promise
because those SuperdomeX are not mine :P</p>
<h4 id="didacog_commented_at_2016-06-16_1403"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226494500">2016-06-16 14:03</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1403" title="Permanent link">&para;</a></h4>
<p>@jsmeix This case is not with Boot from SAN on SuperdomeX but same
output from findmnt command with -m option with btrfs subvolumes on
SLES11 SP3:</p>
<p>$ findmnt -nrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t btrfs<br />
/dev/sda4 / btrfs rw,relatime,space_cache<br />
/dev/sda4 /srv btrfs rw,relatime,space_cache<br />
/dev/sda4 /opt btrfs rw,relatime,space_cache<br />
/dev/sda4 /tmp btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/spool btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/run btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/log btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/crash btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/tmp btrfs rw,relatime,space_cache</p>
<p>$ findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t btrfs<br />
/dev/sda4 / btrfs rw,relatime,space_cache<br />
/dev/sda4 /srv btrfs rw,relatime,space_cache<br />
/dev/sda4 /opt btrfs rw,relatime,space_cache<br />
/dev/sda4 /tmp btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/spool btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/run btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/log btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/crash btrfs rw,relatime,space_cache<br />
/dev/sda4 /var/tmp btrfs rw,relatime,space_cache</p>
<p>Also I've seen that /etc/mtab is a softlink to /proc/self/mounts in SLES
but not in RHEL.</p>
<p>SLES:<br />
$ ls -l /etc/mtab<br />
lrwxrwxrwx 1 root root 17 Feb 15 13:47 /etc/mtab -&gt; /proc/self/mounts</p>
<p>RHEL6:<br />
$ ls -l /etc/mtab<br />
-rw-r--r-- 1 root root 990 Jun 16 13:52 /etc/mtab</p>
<p>Maybe we need to use a different approach for each OS.</p>
<h4 id="jsmeix_commented_at_2016-06-16_1420"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226499432">2016-06-16 14:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1420" title="Permanent link">&para;</a></h4>
<p>In general I am agianst using different approaches<br />
that depend on the Linux distrubution and version<br />
because this is again an indirection (RFC 1925 6a)<br />
that leads to weird unexpected failures because such<br />
code just breaks if on an older Linux distrubution/version<br />
newer software is installed so that the older distrubution<br />
actually behaves like a newer distrubution.</p>
<p>In contrast I prefer to use different approaches<br />
that depend on real existing conditions in the<br />
current system.</p>
<p>I.e. I am against code like</p>
<pre>
case "$OS_VENDOR" in
    (SUSE_LINUX)
        do_this
        ;;
    (RedHatEnterpriseServer)
        do_that
        ;;
    (*)
        do_default
        ;;
esac
</pre>

<p>In contrast I prefer code like</p>
<pre>
if CONDITION ; then
   do_this
else
    do_that
fi
</pre>

<p>where CONDITION is something real that can be directly<br />
tested on the current system and not something vague<br />
like a version string.</p>
<p>For example I tried to implement my btrfs support code<br />
so that it works generically on SLE and RHEL without<br />
testing things like "$OS_VENDOR" and "$OS_VERSION".</p>
<h4 id="jsmeix_commented_at_2016-06-16_1430"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226502639">2016-06-16 14:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-16_1430" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
note that in layout/save/GNU/Linux/23_filesystem_layout.sh<br />
I use findmnt at several places:</p>
<p>First to make "fs" entries in disklayout.conf.</p>
<p>Afterwards to make "btrfs..." entries in disklayout.comf.</p>
<p>For the first usage (make "fs" entries) see my comment</p>
<pre>
# The only difference is that the traditional mount command output has the list of options in parenthesis.
</pre>

<p>so that here - at last for now - using "findmnt -m"<br />
should be o.k.</p>
<p>In contrast for the other usages (make "btrfs..." entries)<br />
the traditional mount format is insufficient, see my<br />
comment in 23_filesystem_layout.sh and I try to<br />
work aound that by awkward "grepping" in /etc/fstab<br />
which is not a reliably working solution.</p>
<p>Therefore to make make "btrfs..." entries I assume<br />
"findmnt -m" cannot be used - but I did not yet chek it.</p>
<h4 id="didacog_commented_at_2016-06-16_1526"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226520578">2016-06-16 15:26</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-16_1526" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Ok, maybe tomorrow I can try to run a backup with this modified on one
of the development SLES servers with btrfs subvolumes and check if
working ok with findmnt -m.</p>
<p>I guess this should work because, as you can see on the SLES outputs I
provided are the same and the origin file format Is very different, but
anyway, tomorrow I would clear those doubts :P</p>
<h4 id="jsmeix_commented_at_2016-06-17_0733"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226700826">2016-06-17 07:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-17_0733" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
very many thanks in advance for your testing.<br />
This is a very valuabe cuntribution to rear!</p>
<p>According to what I wrote above in
<a href="https://github.com/rear/rear/issues/882#issuecomment-226502639">https://github.com/rear/rear/issues/882#issuecomment-226502639</a><br />
I also think that<br />
at least for now using (deprecated) "findmnt -m"<br />
for making "fs" entries in disklayout.conf should be o.k.<br />
(i.e. adding '-m' for the 'read_filesystems_command')<br />
while in contrast<br />
I think that one cannot use "findmnt -m"<br />
for making "btrfsmountedsubvol" entries in disklayout.conf<br />
(i.e. no '-m' for the 'read_mounted_btrfs_subvolumes_command').</p>
<p>@didacog<br />
because I have basically no knowledge about SAN and multipath<br />
I have a basic question regarding what you wrote in your<br />
initial comment
<a href="https://github.com/rear/rear/issues/882#issue-160650954">https://github.com/rear/rear/issues/882#issue-160650954</a></p>
<pre>
device WWN from SAN instead of the mpath alias name
</pre>

<p>Colud you explain (or provide an URL to explanatory info)<br />
what 'device WWN from SAN' versus 'mpath alias name'<br />
is about?</p>
<p>Via quick "Googling" I found<br />
<a href="http://www.datadisk.co.uk/html_docs/redhat/rh_multipathing.htm">http://www.datadisk.co.uk/html_docs/redhat/rh_multipathing.htm</a><br />
but that talks about "WWID".<br />
Is "WWID" the same as "WWN"?</p>
<p>Perhaps the actually right future-proof solution is<br />
to implement in rear a function that gets as input a<br />
'WWID' or 'WWN' and outputs the matching 'mpath alias name'<br />
so that we could still use findmnt without '-m'.</p>
<p>Must each 'WWID' or 'WWN' have exactly one<br />
associated 'mpath alias name' in any case<br />
or could there be none or several 'mpath alias names'<br />
for one 'WWID' or 'WWN'?</p>
<p>Perhaps there is already some ready-to-use command line tool<br />
in the system to find the matching 'mpath alias name'<br />
because I assume when "findmnt -m" outputs<br />
the 'mpath alias name' it may use such kind of mapping<br />
function between WWID or WWN and mpath alias name?</p>
<h4 id="didacog_commented_at_2016-06-17_0927"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226723612">2016-06-17 09:27</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-17_0927" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I've tested with SLES and here my results:</p>
<pre>
...
SLES11 SP3 (rear log):
2016-06-17 10:57:04.940394305 Begin saving filesystem layout
2016-06-17 10:57:04.943144580 Saving filesystem layout (using the findmnt command).
/usr/share/rear/layout/save/GNU/Linux/23_filesystem_layout.sh: line 123: dosfslabel: command not found
findmnt: unknown column: FSROOT
2016-06-17 10:57:05.103735053 End saving filesystem layout
...
</pre>

<p>I've tested this on shell:</p>
<pre>
        ########################################
        # Mounted btrfs subvolumes:
        if test -x "$findmnt_command" ; then
            read_mounted_btrfs_subvolumes_command="$findmnt_command -nrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs"
        else
            read_mounted_btrfs_subvolumes_command="mount -t btrfs | cut -d ' ' -f 1,3,6"
        fi
</pre>

<pre>
SLES:
$ findmnt -nrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs
findmnt: unknown column: FSROOT
RHEL:
$ findmnt -nrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs
findmnt: unknown column: FSROOT
</pre>

<p>Seems this command is not working at this time.</p>
<p>the resulting disklayout have same output format (because in fact the
first findmnt command is getting the fs list and the specific btrfs
command is not working)</p>
<pre>
supported_filesystems="ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs"
read_filesystems_command="$findmnt_command -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t $supported_filesystems"
</pre>

<p>findmnt -m ... is working also with BTRFS subvols and the dedicated
btrfs command is not working.</p>
<p>Look at disklayout outputs:</p>
<pre>
# grep btrfssnap disklayout.conf (with findmnt -m ... )
# Format: btrfssnapshotsubvol <device> <mountpoint> <btrfs_subvolume_ID> <btrfs_subvolume_path>
#btrfssnapshotsubvol /dev/sda4 / 276 @/.snapshots/1/snapshot
#btrfssnapshotsubvol /dev/sda4 / 277 @/opt/.snapshots/1/snapshot
#btrfssnapshotsubvol /dev/sda4 / 283 @/.snapshots/4/snapshot
#btrfssnapshotsubvol /dev/sda4 / 284 @/.snapshots/5/snapshot
#btrfssnapshotsubvol /dev/sda4 / 470 @/.snapshots/98/snapshot
#btrfssnapshotsubvol /dev/sda4 / 471 @/opt/.snapshots/96/snapshot
#btrfssnapshotsubvol /dev/sda4 / 608 @/.snapshots/167/snapshot
#btrfssnapshotsubvol /dev/sda4 / 609 @/.snapshots/168/snapshot
#btrfssnapshotsubvol /dev/sda4 / 610 @/.snapshots/169/snapshot
#btrfssnapshotsubvol /dev/sda4 / 611 @/.snapshots/170/snapshot
#btrfssnapshotsubvol /dev/sda4 / 1595 @/.snapshots/662/snapshot
#btrfssnapshotsubvol /dev/sda4 / 1596 @/opt/.snapshots/656/snapshot
#btrfssnapshotsubvol /dev/sda4 / 3036 @/.snapshots/1382/snapshot
#btrfssnapshotsubvol /dev/sda4 / 3037 @/opt/.snapshots/1376/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4261 @/.snapshots/1993/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4262 @/.snapshots/1994/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4263 @/.snapshots/1995/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4265 @/.snapshots/1996/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4532 @/.snapshots/2130/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4533 @/opt/.snapshots/2120/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4820 @/.snapshots/2274/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4821 @/opt/.snapshots/2264/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4868 @/.snapshots/2298/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4869 @/opt/.snapshots/2288/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4916 @/.snapshots/2322/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4917 @/opt/.snapshots/2312/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4964 @/.snapshots/2346/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4965 @/opt/.snapshots/2336/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5012 @/.snapshots/2370/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5013 @/opt/.snapshots/2360/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5060 @/.snapshots/2394/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5061 @/opt/.snapshots/2384/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5108 @/.snapshots/2418/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5109 @/opt/.snapshots/2408/snapshot
...
...
$ grep btrfssnap disklayout.conf.orig (without findmnt -m ... )
# Format: btrfssnapshotsubvol <device> <mountpoint> <btrfs_subvolume_ID> <btrfs_subvolume_path>
#btrfssnapshotsubvol /dev/sda4 / 276 @/.snapshots/1/snapshot
#btrfssnapshotsubvol /dev/sda4 / 277 @/opt/.snapshots/1/snapshot
#btrfssnapshotsubvol /dev/sda4 / 283 @/.snapshots/4/snapshot
#btrfssnapshotsubvol /dev/sda4 / 284 @/.snapshots/5/snapshot
#btrfssnapshotsubvol /dev/sda4 / 470 @/.snapshots/98/snapshot
#btrfssnapshotsubvol /dev/sda4 / 471 @/opt/.snapshots/96/snapshot
#btrfssnapshotsubvol /dev/sda4 / 608 @/.snapshots/167/snapshot
#btrfssnapshotsubvol /dev/sda4 / 609 @/.snapshots/168/snapshot
#btrfssnapshotsubvol /dev/sda4 / 610 @/.snapshots/169/snapshot
#btrfssnapshotsubvol /dev/sda4 / 611 @/.snapshots/170/snapshot
#btrfssnapshotsubvol /dev/sda4 / 1595 @/.snapshots/662/snapshot
#btrfssnapshotsubvol /dev/sda4 / 1596 @/opt/.snapshots/656/snapshot
#btrfssnapshotsubvol /dev/sda4 / 3036 @/.snapshots/1382/snapshot
#btrfssnapshotsubvol /dev/sda4 / 3037 @/opt/.snapshots/1376/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4261 @/.snapshots/1993/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4262 @/.snapshots/1994/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4263 @/.snapshots/1995/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4265 @/.snapshots/1996/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4532 @/.snapshots/2130/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4533 @/opt/.snapshots/2120/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4772 @/.snapshots/2250/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4773 @/opt/.snapshots/2240/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4820 @/.snapshots/2274/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4821 @/opt/.snapshots/2264/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4868 @/.snapshots/2298/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4869 @/opt/.snapshots/2288/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4916 @/.snapshots/2322/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4917 @/opt/.snapshots/2312/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4964 @/.snapshots/2346/snapshot
#btrfssnapshotsubvol /dev/sda4 / 4965 @/opt/.snapshots/2336/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5012 @/.snapshots/2370/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5013 @/opt/.snapshots/2360/snapshot
#btrfssnapshotsubvol /dev/sda4 / 5060 @/.snapshots/2394/snapshot
...
...
</pre>

<p>Regarding to WWN, yes is WWID, the unique name/ID of a Storage LUN. The
problem is that after the multipath is loaded to the kernel and applied
all aliases, /dev/mapper/WWIDpX no longer exists on system, only the
alias /dev/mapper/vvbootp4. This is the cause rear is not able to get
(/) information from system getting findmnt info from
/proc/self/mountinfo because the block device is trying to get info no
longer exists.</p>
<h4 id="jsmeix_commented_at_2016-06-17_1019"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226734203">2016-06-17 10:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-17_1019" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
many thanks for your testing on SLE11.</p>
<p>You are right.<br />
On SLE11:</p>
<pre>
# findmnt -nrv -o SOURCE,TARGET,OPTIONS,FSROOT
findmnt: unknown column: FSROOT
</pre>

<p>The reason why this was not noticed up to now is<br />
that on SLE11 in parctice "nobody" uses btrfs<br />
(and I never tested btrfs on SLE11).</p>
<p>On SLE12 findmnt knows about FSROOT<br />
(and I tested btrfs only on SLE12).</p>
<p>I will provide a fix soon via
<a href="https://github.com/rear/rear/issues/883">https://github.com/rear/rear/issues/883</a></p>
<h4 id="didacog_commented_at_2016-06-17_1028"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226735901">2016-06-17 10:28</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-17_1028" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
No problem! we are here to help! ;)</p>
<p>What about -m option? did you test it on SLES12?</p>
<p>On SLES11 with btrfs subvols the output with or without (-m) is the
same. Anyway I cannot test it with SLES12 and not sure if something
changes with FSROOT option.</p>
<h4 id="jsmeix_commented_at_2016-06-17_1133"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226746945">2016-06-17 11:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-17_1133" title="Permanent link">&para;</a></h4>
<p>I merged
<a href="https://github.com/rear/rear/pull/884">https://github.com/rear/rear/pull/884</a><br />
because it still works for me on SLE12-SP1<br />
with its default btrfs structure.</p>
<p>Furthermore with
<a href="https://github.com/rear/rear/pull/884">https://github.com/rear/rear/pull/884</a><br />
I use 'findmnt -m' to make the 'fs' entries<br />
(but not for other findmnt commands),<br />
cf.
<a href="https://github.com/rear/rear/issues/882#issuecomment-226700826">https://github.com/rear/rear/issues/882#issuecomment-226700826</a></p>
<p>@didacog<br />
please upgrade to the current rear master to have
<a href="https://github.com/rear/rear/pull/884">https://github.com/rear/rear/pull/884</a><br />
and do your further work based on that one.</p>
<p>I did not yet test whether or not SLE11 with btrfs<br />
works with
<a href="https://github.com/rear/rear/pull/884">https://github.com/rear/rear/pull/884</a><br />
because I need a bit of time to prepare a<br />
SLE11 test system with btrfs...</p>
<h4 id="didacog_commented_at_2016-06-17_1143"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226748654">2016-06-17 11:43</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-17_1143" title="Permanent link">&para;</a></h4>
<p>Ok, I will test it and provide some feedback ASAP ;)</p>
<h4 id="jsmeix_commented_at_2016-06-17_1313"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226765335">2016-06-17 13:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-17_1313" title="Permanent link">&para;</a></h4>
<p>A quick test with SLE11-SP4 with btrfs<br />
works for me with
<a href="https://github.com/rear/rear/pull/884">https://github.com/rear/rear/pull/884</a></p>
<p>During initial installation of SLE11-SP4<br />
I selected in the YaST partitioning dialog<br />
to use the whole harddisk and then<br />
to use btrfs on it.</p>
<p>I got this partitioning:</p>
<pre>
# parted -l
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sda: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Number  Start   End     Size    Type     File system     Flags
 1      1049kB  165MB   164MB   primary  ext3            boot, type=83
 2      165MB   1735MB  1571MB  primary  linux-swap(v1)  type=82
 3      1735MB  21.5GB  19.7GB  primary  btrfs           type=83
</pre>

<p>and that btrfs subvolumes:</p>
<pre>
# btrfs subvolume list -a /        
ID 256 gen 194 top level 5 path <FS_TREE>/@
ID 258 gen 195 top level 256 path @/tmp
ID 259 gen 166 top level 256 path @/opt
ID 260 gen 166 top level 256 path @/srv
ID 261 gen 126 top level 256 path @/var/crash
ID 262 gen 209 top level 256 path @/var/spool
ID 263 gen 208 top level 256 path @/var/log
ID 264 gen 208 top level 256 path @/var/run
ID 265 gen 166 top level 256 path @/var/tmp
ID 268 gen 195 top level 256 path @/.snapshots
</pre>

<p>I used this /etc/rear/local.conf</p>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs
NETFS_KEEP_OLD_BACKUP_COPY=yes
BACKUP_PROG_INCLUDE=( '/var/tmp/*' '/var/run/*' '/var/spool/*' '/var/log/*' '/var/crash/*' '/tmp/*' '/srv/*' '/opt/*' )
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
KEEP_BUILD_DIR=""
</pre>

<p>I did not fully verify it all is really correct after "rear recover"<br />
but the recovered system works and looks o.k.</p>
<h4 id="jsmeix_commented_at_2016-06-17_1352"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226774212">2016-06-17 13:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-17_1352" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
regarding your
<a href="https://github.com/rear/rear/issues/882#issuecomment-226735901">https://github.com/rear/rear/issues/882#issuecomment-226735901</a><br />
"I cannot test it with SLES12"</p>
<p>I wonder why you cannot test it with SLES12?</p>
<p>We (i.e. SUSE) have SLE12 installation images available<br />
for free download at<br />
<a href="https://www.suse.com/download-linux">https://www.suse.com/download-linux</a></p>
<p>Furthermore there is the new public SUSE Beta Program, see<br />
<a href="https://www.suse.com/support/beta-program">https://www.suse.com/support/beta-program</a></p>
<h4 id="didacog_commented_at_2016-06-17_1432"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-226784832">2016-06-17 14:32</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-17_1432" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Tested on SLES12SP1. ;)</p>
<p>findmnt command shows same output with or without (-m) option. In this
case, maybe using (-mnrv) on all cases could be a good solution.</p>
<p>here the evidence:</p>
<pre>
linux-hxww:~ # lsb_release -a
LSB Version:    n/a
Distributor ID: SUSE LINUX
Description:    SUSE Linux Enterprise Server 12 SP1
Release:    12.1
Codename:   n/a
linux-hxww:~ # findmnt -nrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs
/dev/sda2 / rw,relatime,space_cache,subvolid=257,subvol=/@ /@
/dev/sda2 /var/tmp rw,relatime,space_cache,subvolid=275,subvol=/@/var/tmp /@/var/tmp
/dev/sda2 /var/lib/mariadb rw,relatime,space_cache,subvolid=268,subvol=/@/var/lib/mariadb /@/var/lib/mariadb
/dev/sda2 /var/spool rw,relatime,space_cache,subvolid=274,subvol=/@/var/spool /@/var/spool
/dev/sda2 /var/lib/libvirt/images rw,relatime,space_cache,subvolid=266,subvol=/@/var/lib/libvirt/images /@/var/lib/libvirt/images
/dev/sda2 /var/opt rw,relatime,space_cache,subvolid=273,subvol=/@/var/opt /@/var/opt
/dev/sda2 /var/log rw,relatime,space_cache,subvolid=272,subvol=/@/var/log /@/var/log
/dev/sda2 /var/lib/pgsql rw,relatime,space_cache,subvolid=271,subvol=/@/var/lib/pgsql /@/var/lib/pgsql
/dev/sda2 /var/lib/named rw,relatime,space_cache,subvolid=270,subvol=/@/var/lib/named /@/var/lib/named
/dev/sda2 /var/lib/mysql rw,relatime,space_cache,subvolid=269,subvol=/@/var/lib/mysql /@/var/lib/mysql
/dev/sda2 /var/lib/mailman rw,relatime,space_cache,subvolid=267,subvol=/@/var/lib/mailman /@/var/lib/mailman
/dev/sda2 /var/crash rw,relatime,space_cache,subvolid=265,subvol=/@/var/crash /@/var/crash
/dev/sda2 /usr/local rw,relatime,space_cache,subvolid=264,subvol=/@/usr/local /@/usr/local
/dev/sda2 /tmp rw,relatime,space_cache,subvolid=263,subvol=/@/tmp /@/tmp
/dev/sda2 /opt rw,relatime,space_cache,subvolid=261,subvol=/@/opt /@/opt
/dev/sda2 /srv rw,relatime,space_cache,subvolid=262,subvol=/@/srv /@/srv
/dev/sda2 /home rw,relatime,space_cache,subvolid=260,subvol=/@/home /@/home
/dev/sda2 /boot/grub2/x86_64-efi rw,relatime,space_cache,subvolid=259,subvol=/@/boot/grub2/x86_64-efi /@/boot/grub2/x86_64-efi
/dev/sda2 /boot/grub2/i386-pc rw,relatime,space_cache,subvolid=258,subvol=/@/boot/grub2/i386-pc /@/boot/grub2/i386-pc
linux-hxww:~ # findmnt -mnrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs
/dev/sda2 / rw,relatime,space_cache,subvolid=257,subvol=/@ /@
/dev/sda2 /var/tmp rw,relatime,space_cache,subvolid=275,subvol=/@/var/tmp /@/var/tmp
/dev/sda2 /var/lib/mariadb rw,relatime,space_cache,subvolid=268,subvol=/@/var/lib/mariadb /@/var/lib/mariadb
/dev/sda2 /var/spool rw,relatime,space_cache,subvolid=274,subvol=/@/var/spool /@/var/spool
/dev/sda2 /var/lib/libvirt/images rw,relatime,space_cache,subvolid=266,subvol=/@/var/lib/libvirt/images /@/var/lib/libvirt/images
/dev/sda2 /var/opt rw,relatime,space_cache,subvolid=273,subvol=/@/var/opt /@/var/opt
/dev/sda2 /var/log rw,relatime,space_cache,subvolid=272,subvol=/@/var/log /@/var/log
/dev/sda2 /var/lib/pgsql rw,relatime,space_cache,subvolid=271,subvol=/@/var/lib/pgsql /@/var/lib/pgsql
/dev/sda2 /var/lib/named rw,relatime,space_cache,subvolid=270,subvol=/@/var/lib/named /@/var/lib/named
/dev/sda2 /var/lib/mysql rw,relatime,space_cache,subvolid=269,subvol=/@/var/lib/mysql /@/var/lib/mysql
/dev/sda2 /var/lib/mailman rw,relatime,space_cache,subvolid=267,subvol=/@/var/lib/mailman /@/var/lib/mailman
/dev/sda2 /var/crash rw,relatime,space_cache,subvolid=265,subvol=/@/var/crash /@/var/crash
/dev/sda2 /usr/local rw,relatime,space_cache,subvolid=264,subvol=/@/usr/local /@/usr/local
/dev/sda2 /tmp rw,relatime,space_cache,subvolid=263,subvol=/@/tmp /@/tmp
/dev/sda2 /opt rw,relatime,space_cache,subvolid=261,subvol=/@/opt /@/opt
/dev/sda2 /srv rw,relatime,space_cache,subvolid=262,subvol=/@/srv /@/srv
/dev/sda2 /home rw,relatime,space_cache,subvolid=260,subvol=/@/home /@/home
/dev/sda2 /boot/grub2/x86_64-efi rw,relatime,space_cache,subvolid=259,subvol=/@/boot/grub2/x86_64-efi /@/boot/grub2/x86_64-efi
/dev/sda2 /boot/grub2/i386-pc rw,relatime,space_cache,subvolid=258,subvol=/@/boot/grub2/i386-pc /@/boot/grub2/i386-pc
linux-hxww:~ # findmnt -nrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs > findmnt.out
linux-hxww:~ # findmnt -mnrv -o SOURCE,TARGET,OPTIONS,FSROOT -t btrfs > findmnt-m.out
linux-hxww:~ # diff findmnt.out findmnt-m.out
</pre>

<h4 id="didacog_commented_at_2016-06-28_1342"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-229052508">2016-06-28 13:42</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-28_1342" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Tomorrow I will test to recover on SLES12 with your latest code for the
FSROOT option, but anyway the findmnt (-m ) should be on BTRFS section
also, because if not, in case of BTRFS with BOOT from SAN it will fail
with same issue. With my last test the output is the same on both
cases.<br />
If you haven't any complaint about this, i will test your code with (-m)
on btrfs section also and send a pull request with this and other issues
i found playing with Boot from SAN these last days.</p>
<p>I will open an issue for them also together with the pull request.</p>
<p>Regards,<br />
Didac</p>
<h4 id="jsmeix_commented_at_2016-06-28_1426"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-229065688">2016-06-28 14:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-28_1426" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
since I had written that new famous<br />
"Dirty hacks welcome" section in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
any properly documented code that intends<br />
to make it work everywhere is welcome.</p>
<p>In this particular case:<br />
As long as "findmnt -m" works everywhere it is o.k.<br />
and as long as it is properly documented <em>why</em> that '-m'<br />
is used one could easily later change it as needed.</p>
<h4 id="didacog_commented_at_2016-06-28_1432"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-229067497">2016-06-28 14:32</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-28_1432" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Ok, tomorrow I will submit a new pull request with those changes
properly documented.</p>
<p>Regards,<br />
Didac</p>
<h4 id="didacog_commented_at_2016-07-05_0914"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-230427317">2016-07-05 09:14</a>:<a class="headerlink" href="#didacog_commented_at_2016-07-05_0914" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix,</p>
<p>I've submitted a new pull request #903 solving findmnt problems
(findmnt -m).</p>
<p>I've tested it on SLES 12 and worked.</p>
<p>Also meet a problem with chattr missing on rescue image. Should be
solved with the pull request.</p>
<p>I had problems with
usr/share/rear/finalize/Linux-i386/23_run_efibootmgr.sh. But is solved
in 1.18 with this code:</p>
<pre>
if [[ ${Dev/mapper//} != $Dev ]] ; then # we have 'mapper' in devname
    # we only expect mpath_partX  or mpathpX or mpath-partX
    case $Disk in
        (*p)     Disk=${Disk%p} ;;
        (*-part) Disk=${Disk%-part} ;;
        (*_part) Disk=${Disk%_part} ;;
        (*)      Log "Unsupported kpartx partition delimiter for $Dev"
    esac
fi
</pre>

<p>Regards,</p>
<h4 id="jsmeix_commented_at_2016-07-07_1148"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-231055969">2016-07-07 11:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-07_1148" title="Permanent link">&para;</a></h4>
<p>Damn!<br />
I made a typo in the git commit message for
<a href="https://github.com/rear/rear/pull/903">https://github.com/rear/rear/pull/903</a><br />
where I falsely wrote
<a href="https://github.com/rear/rear/issues/822">https://github.com/rear/rear/issues/822</a><br />
instead of the right issue
<a href="https://github.com/rear/rear/issues/882">https://github.com/rear/rear/issues/882</a></p>
<h4 id="jsmeix_commented_at_2016-07-07_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-231058176">2016-07-07 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-07_1201" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
regarding "chattr missing on rescue image" see<br />
usr/share/rear/conf/examples/SLE12-SP1-btrfs-example.conf<br />
With your
<a href="https://github.com/rear/rear/pull/903">https://github.com/rear/rear/pull/903</a><br />
this should now "just work" even automatically.<br />
Many thanks for it!</p>
<p>Regarding your "problems with ... 23_run_efibootmgr.sh"<br />
in
<a href="https://github.com/rear/rear/issues/882#issuecomment-230427317">https://github.com/rear/rear/issues/882#issuecomment-230427317</a></p>
<p>I think it would be better when you submit a new separated<br />
GitHub issue for that to avoid that several actually separated<br />
issues get mixed up in one single big and fat monster issue.</p>
<p>In particular because I am not at all an expert regarding<br />
bootloader issues I would prefer a separated issue.</p>
<p>Or perhaps just do a separated GitHub pull request that<br />
fixes your "problems with ... 23_run_efibootmgr.sh"?</p>
<h4 id="jsmeix_commented_at_2016-07-07_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-231068060">2016-07-07 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-07_1250" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
I think I misunderstood what you meant with<br />
your "problems with ... 23_run_efibootmgr.sh"<br />
in
<a href="https://github.com/rear/rear/issues/882#issuecomment-230427317">https://github.com/rear/rear/issues/882#issuecomment-230427317</a></p>
<p>In current rear master code your mentioned code<br />
is already there so that you <em>had</em> problems<br />
that are already fixed in current rear master.</p>
<p>FYI:</p>
<p>"git blame" shows for 23_run_efibootmgr.sh<br />
that your mentioned code was provided by<br />
Pavol Domin via git commit bf6742be<br />
and sarching for that git commit ID in<br />
"git log" shows that commit is about<br />
"SAN booting related improvements" which leads to<br />
git commit 42be8008cbd79193fbd00228aef0e005ed9d940f<br />
that reads "Merge pull request #695 from pavoldomin/sanboot"<br />
so that we finally know it was
<a href="https://github.com/rear/rear/pull/695">https://github.com/rear/rear/pull/695</a></p>
<p>@didacog<br />
can I close this particular issue?</p>
<p>I.e. is this particular issue fixed for you<br />
with
<a href="https://github.com/rear/rear/pull/903">https://github.com/rear/rear/pull/903</a><br />
and
<a href="https://github.com/rear/rear/pull/695">https://github.com/rear/rear/pull/695</a></p>
<h4 id="didacog_commented_at_2016-07-07_1327"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/882#issuecomment-231076875">2016-07-07 13:27</a>:<a class="headerlink" href="#didacog_commented_at_2016-07-07_1327" title="Permanent link">&para;</a></h4>
<p>@jsmeix Yes you can close this issue. Thanks! ;)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-06-16.882.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
