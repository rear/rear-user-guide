<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#415 Issue closed: mkfs -t btrfs missing force mode - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#415 Issue closed: mkfs -t btrfs missing force mode";
        var mkdocs_page_input_path = "issues/2014-05-23.415.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#415 Issue closed: mkfs -t btrfs missing force mode</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="415_issue_closed_mkfs_-t_btrfs_missing_force_mode"><a href="https://github.com/rear/rear/issues/415">#415 Issue</a> <code>closed</code>: mkfs -t btrfs missing force mode<a class="headerlink" href="#415_issue_closed_mkfs_-t_btrfs_missing_force_mode" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code></p>
<h4 id="gdha_opened_issue_at_2014-05-23_1245"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/415">2014-05-23 12:45</a>:<a class="headerlink" href="#gdha_opened_issue_at_2014-05-23_1245" title="Permanent link">&para;</a></h4>
<p>I found an issue with <code>mkfs -t  btrfs</code>:</p>
<pre><code>--- usr/share/rear/layout/prepare/GNU/Linux/13_include_filesystem_code.sh.orig
+++ usr/share/rear/layout/prepare/GNU/Linux/13_include_filesystem_code.sh
@@ -94,7 +94,11 @@ EOF
 cat &gt;&gt; $LAYOUT_CODE &lt;&lt;EOF
 LogPrint "Creating $fstype-filesystem $mp on $device"
 # if $device is already mounted, skip
-mount | grep -q $device || mkfs -t $fstype $device
+# mkfs.btrfs needs an explicit '-f' (same as mkfs.xfs) to
+# force overwrite when an existing filesystem is detected
+# otherwise "rear recover" fails here with an error
+# see https://bugzilla.novell.com/show_bug.cgi?id=878870
+mount | grep -q $device || mkfs -t $fstype -f $device
 EOF
             if [ -n "$label" ] ; then
                 echo "mount | grep -q $device || btrfs filesystem label $device $label &gt;&amp;2" &gt;&gt; $LAYOUT_CODE
</code></pre>
<p>Details:</p>
<p>I think when rear creates filesystems it must be enforced to do that<br />
even when an existing filesystem is detected.</p>
<p>Some mkfs.* tools need an explicit '-f' to do that<br />
but for other mkfs.* tools '-f' has a different meaning<br />
so that a careful case by case implementation is needed.</p>
<p>Currently on my system the mkfs.* man pages show:</p>
<pre><code># for f in /sbin/mkfs.* ; do m=$( basename $f ) ; \
 echo $m ; man -7 $m | tr -s ' ' | grep -A2 -- '^ -f' ; \
 echo ================================ ; done | fold -s -w70 | grep -v '^$'

mkfs.bfs
================================
mkfs.btrfs
 -f, --force
 Force overwrite when an existing filesystem is detected on the
device. By default, mkfs.btrfs will not write to the device if it
suspects that there is
 a filesystem or partition table on the device already.
================================
mkfs.cramfs
================================
mkfs.ext2
 -f fragment-size
 Specify the size of fragments in bytes.
================================
mkfs.ext3
 -f fragment-size
 Specify the size of fragments in bytes.
================================
mkfs.ext4
 -f fragment-size
 Specify the size of fragments in bytes.
================================
mkfs.minix
================================
mkfs.msdos
 -f number-of-FATs
 Specify the number of file allocation tables in the filesystem. The
default is 2. Currently the Linux MS-DOS filesystem does not support
more than 2 FATs.
================================
mkfs.reiserfs
 -f Forces mkreiserfs to continue even when the device is the whole
disk, looks mounted, or is not a block device. If -f is specified
more than once, it
 allows the user to avoid asking for confirmation.
================================
mkfs.xfs
 -f Force overwrite when an existing filesystem is detected on the
device. By default, mkfs.xfs will not write to the device if it
suspects that there is a
 filesystem or partition table on the device already.
================================
------------------------------------------------------------------------------

This means only for btrfs and xfs an explicit '-f' in
/usr/share/rear/layout/prepare/GNU/Linux/13_include_filesystem_code.sh
is needed. For xfs it is already there, only for btrfs it is missing:
-------------------------------------------------------------------------------
    case $fstype in
...
        xfs)
cat &gt;&gt; $LAYOUT_CODE &lt;&lt;EOF
LogPrint "Creating $fstype-filesystem $mp on $device"
mkfs.xfs -f  $device
EOF
...
        btrfs)
cat &gt;&gt; $LAYOUT_CODE &lt;&lt;EOF
LogPrint "Creating $fstype-filesystem $mp on $device"
# if $device is already mounted, skip
mount | grep -q $device || mkfs -t $fstype $device
EOF
</code></pre>
<p>Kind Regards<br />
Johannes Meixner</p>
<h4 id="gdha_commented_at_2014-06-04_0930"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-45070030">2014-06-04 09:30</a>:<a class="headerlink" href="#gdha_commented_at_2014-06-04_0930" title="Permanent link">&para;</a></h4>
<p>rear-1.16.1 should have the btrfs --force fix on board.</p>
<h4 id="flyinfistofjuda_commented_at_2015-02-12_1003"><img src="https://avatars.githubusercontent.com/u/8214847?u=d8948551db2a040d963cee5cddf0362117594e47&v=4" width="50"><a href="https://github.com/FlyinFistOfJuda">FlyinFistOfJuda</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-74045762">2015-02-12 10:03</a>:<a class="headerlink" href="#flyinfistofjuda_commented_at_2015-02-12_1003" title="Permanent link">&para;</a></h4>
<p>Hi i'm on Debian 7.8 with rear 1.16.1-git201502062115.<br />
Recover run fails with mkfs.btrfs: invalid option -- 'f' . Also, --force
is invalid. (Btrfs Btrfs v0.19)</p>
<h4 id="gdha_commented_at_2015-02-12_1018"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-74047531">2015-02-12 10:18</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-12_1018" title="Permanent link">&para;</a></h4>
<p>@FlyinFistOfJuda could you show the option: <code>mkfs.btrfs --help</code> ?</p>
<h4 id="flyinfistofjuda_commented_at_2015-02-12_1325"><img src="https://avatars.githubusercontent.com/u/8214847?u=d8948551db2a040d963cee5cddf0362117594e47&v=4" width="50"><a href="https://github.com/FlyinFistOfJuda">FlyinFistOfJuda</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-74069625">2015-02-12 13:25</a>:<a class="headerlink" href="#flyinfistofjuda_commented_at_2015-02-12_1325" title="Permanent link">&para;</a></h4>
<p>Well, even help is no option. :)<br />
Here's the output on the running system:<br />
<code></p>
<p>mkfs.btrfs: unrecognized option '--help'</p>
<p>usage: mkfs.btrfs [options] dev [ dev ... ]</p>
<p>options:</p>
<pre><code>     -A --alloc-start the offset to start the FS

     -b --byte-count total number of bytes in the FS

     -d --data data profile, raid0, raid1, raid10 or single

     -l --leafsize size of btree leaves

     -L --label set a label

     -m --metadata metadata profile, values like data profile

     -M --mixed mix metadata and data together

     -n --nodesize size of btree nodes

     -s --sectorsize min block allocation

     -r --rootdir the source directory
</code></pre>
<p>Btrfs Btrfs v0.19<br />
</code></p>
<p>Anyway, didn't want to file a support request. Idea was to comment that
with rear 1.16.1 there's still a problem with usage of force regarding
the bug.</p>
<h4 id="gdha_commented_at_2015-02-12_1443"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-74081307">2015-02-12 14:43</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-12_1443" title="Permanent link">&para;</a></h4>
<p>@FlyinFistOfJuda as such this not an issue with rear but with the
version of btrfs you are using (quite old). The man page of mkfs.btrfs
shows all options (more then what you listed)</p>
<h4 id="flyinfistofjuda_commented_at_2015-02-12_1503"><img src="https://avatars.githubusercontent.com/u/8214847?u=d8948551db2a040d963cee5cddf0362117594e47&v=4" width="50"><a href="https://github.com/FlyinFistOfJuda">FlyinFistOfJuda</a> commented at <a href="https://github.com/rear/rear/issues/415#issuecomment-74084868">2015-02-12 15:03</a>:<a class="headerlink" href="#flyinfistofjuda_commented_at_2015-02-12_1503" title="Permanent link">&para;</a></h4>
<p>Yes, just also figured that out. An outdated man-page reflected my
output. Thanks for clarification.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2014-05-23.415.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
