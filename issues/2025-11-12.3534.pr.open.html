<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3534 PR open: Refactor SELinux support and enable SElinux in permissive mode in the rescue system - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3534 PR open: Refactor SELinux support and enable SElinux in permissive mode in the rescue system";
        var mkdocs_page_input_path = "issues/2025-11-12.3534.pr.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3534 PR open: Refactor SELinux support and enable SElinux in permissive mode in the rescue system</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3534_pr_open_refactor_selinux_support_and_enable_selinux_in_permissive_mode_in_the_rescue_system"><a href="https://github.com/rear/rear/pull/3534">#3534 PR</a> <code>open</code>: Refactor SELinux support and enable SElinux in permissive mode in the rescue system<a class="headerlink" href="#3534_pr_open_refactor_selinux_support_and_enable_selinux_in_permissive_mode_in_the_rescue_system" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>cleanup</code></p>
<h4 id="pcahyna_opened_issue_at_2025-11-12_0926"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/3534">2025-11-12 09:26</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2025-11-12_0926" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong> / <strong>Cleanup</strong></p>
</li>
<li>
<p>Impact: <strong>High</strong></p>
</li>
<li>
<p>Reference to related issue (URL):</p>
</li>
<li>
<p>How was this pull request tested?</p>
</li>
<li>
<p>Description of the changes in this pull request:<br />
    Refactor SELinux support to make various aspects independent and
    replace file-based communication between scripts by use of global
    variables. Also fix a bug where SELinux was enabled in enforcing
    mode in the rescue system, which did not work. SELinux in the rescue
    system is now always enabled in permissive mode (<code>enforcing=0</code>) when
    SELinux is in use on the original system.</p>
</li>
</ul>
<p>SELinux support has multiple aspects:</p>
<ol>
<li>detecting whether SELinux is in use</li>
<li>enabling SELinux in the rescue system</li>
<li>adding SELinux utilities to the rescue system</li>
<li>switching off SELinux during backup (<code>BACKUP_SELINUX_DISABLE</code>)</li>
<li>detecting whether the backup program (tar, rsync) supports saving
    and restoring SELinux file labels</li>
<li>forcing autorelabel after recovery</li>
</ol>
<p>All SELinux support used to be controlled by item 4. -
<code>BACKUP_SELINUX_DISABLE</code> - make it independent. The decision whether to
disable SELinux during backup is really not related to any other aspects
of SELinux handling, and I believe it is misguided and would like to
remove it anyway in a follow-up. 2. (enabling SELinux in the rescue
system) and 3. (adding SELinux utilities to the rescue system) now
depends purely on 1. Item 5. (SELinux save/restore by the backup
program) is independent, as the tools are able to backup and restore
SELinux labels just fine even if SELinux is not enabled (I tested this).</p>
<p>The decision of 6. (forcing autorelabel after recovery) now depends on
the outcome of 5. (whether labels are backed up and restored). To
preserve compatibility for now, autorelabel is still enforced by a
separate script when <code>BACKUP_SELINUX_DISABLE</code> is set (the default) - see
issue #1957. I plan to change this aspect in the future.</p>
<p>Introduce a new variable <code>BACKUP_PROG_SELINUX</code> that allows the user to
indicate whether the NETFS backup program (if neither tar nor rsync)
supports SELinux label backup and restore, as for custom backup programs
we have no way to detect this.</p>
<p>For this PR, I am experimenting with code generation by Claude Code,
which also wrote most of the commit messages (therefore they are quite
verbose and don't follow my usual style). The refactoring plan was
created by me and I supervised the tool and reviewed the results in
detail.</p>
<h4 id="jsmeix_commented_at_2025-11-12_1313"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3521878193">2025-11-12 13:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-11-12_1313" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for such major overhauling and cleanup work.<br />
I appreciate it very much because rather often<br />
there is only time for "duct tape" fixes.</p>
<h4 id="jsmeix_commented_at_2025-11-12_1332"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3521968275">2025-11-12 13:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-11-12_1332" title="Permanent link">&para;</a></h4>
<p>I had a quick first look and I noticed:</p>
<p>(1)<br />
<code>adding SELinux utilities to the rescue system</code><br />
happens via PROGS and not via REQUIRED_PROGS.<br />
Is this intentional? If yes, why?<br />
I think, when it was autodetected or specified<br />
that SELinux should be used, then its programs<br />
are required to be in the ReaR recovery system.</p>
<p>(2)<br />
The link<br />
usr/share/rear/prep/YUM/default/200_selinux_in_use.sh<br />
-&gt; ../../RSYNC/GNU/Linux/200_selinux_in_use.sh<br />
is removed but there is still the user config variable<br />
<code>YUM_BACKUP_SELINUX_CONTEXTS</code><br />
Is the BACKUP=YUM code OK with the changes in this pull request<br />
or would the BACKUP=YUM code need adaptions?<br />
In general regarding BACKUP=YUM cf.<br />
<a href="https://github.com/rear/rear/issues/3428#issuecomment-3350712028">https://github.com/rear/rear/issues/3428#issuecomment-3350712028</a><br />
so if the BACKUP=YUM code needs difficult adaptions<br />
we may simply declare it unsupported right now<br />
if YUM_BACKUP_SELINUX_CONTEXTS is not 'no' and<br />
Error out in this case so the user is informed<br />
(of course this would be not very friendly<br />
but still better than to blindly proceed knowingly<br />
that YUM_BACKUP_SELINUX_CONTEXTS='yes' is unsupported).</p>
<h4 id="pcahyna_commented_at_2025-11-12_1403"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3522106920">2025-11-12 14:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-11-12_1403" title="Permanent link">&para;</a></h4>
<blockquote>
<p><code>adding SELinux utilities to the rescue system</code><br />
happens via PROGS and not via REQUIRED_PROGS.<br />
Is this intentional? If yes, why?<br />
I think, when it was autodetected or specified<br />
that SELinux should be used, then its programs<br />
are required to be in the ReaR recovery system.</p>
</blockquote>
<p>It is in PROGS because the utilities are not actually used for anything
(yet) so they are added only because the admin might need them if
SELinux is in use (and if SELinux is not in use, they don't get added in
order to save space in the ramdisk - Claude Code convinced me to do
this).</p>
<h4 id="pcahyna_commented_at_2025-11-12_1405"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3522118466">2025-11-12 14:05</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-11-12_1405" title="Permanent link">&para;</a></h4>
<p>Regarding YUM: I will check what the variable does, but IIRC it saves
the contexts entirely independently of the script under RSYNC and thus
the symlink is not needed. In any case, the script now handles only
rsync and YUM does not use rsync (it has tar hardcoded), so the script
would not do anything useful even if the symlink existed.</p>
<h4 id="pcahyna_commented_at_2025-11-12_1407"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3522125777">2025-11-12 14:07</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-11-12_1407" title="Permanent link">&para;</a></h4>
<p>@jsmeix IIRC SLES now uses SELinux as well - can you test the change on
SLES, please? Ideally with <code>BACKUP_SELINUX_DISABLE=0</code>.</p>
<h4 id="jsmeix_commented_at_2025-11-12_1437"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/3534#issuecomment-3522276323">2025-11-12 14:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-11-12_1437" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes, I know that SLES also uses SELinux<br />
in particular the new SLES 16 uses it by default,<br />
see "Transition to SELinux" in<br />
<a href="https://www.suse.com/c/what-is-new-in-suse-linux-enterprise-server-16-0/">https://www.suse.com/c/what-is-new-in-suse-linux-enterprise-server-16-0/</a></p>
<p>Nevertheless I have no experience with SELinux.<br />
I have no experience with most of what there is in Linux.<br />
For most of what there is in Linux I am just a user,<br />
e.g. kernel, glibc, X11/Wayland, browser, audio/video,...</p>
<p>As time permits I will have a look regarding<br />
testing ReaR on SLES with SELinux enabled.<br />
But don't wait for me.<br />
Feel free to mercilessly overhaul and cleanup things<br />
right now as you think what seems to be best.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2025-11-12.3534.pr.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
