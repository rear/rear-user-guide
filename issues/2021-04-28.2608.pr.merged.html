<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2608 PR merged: Fix setting boot path in case of UEFI partition (ESP) on MD RAID - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2608 PR merged: Fix setting boot path in case of UEFI partition (ESP) on MD RAID";
        var mkdocs_page_input_path = "issues/2021-04-28.2608.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2608 PR merged: Fix setting boot path in case of UEFI partition (ESP) on MD RAID</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2608_pr_merged_fix_setting_boot_path_in_case_of_uefi_partition_esp_on_md_raid"><a href="https://github.com/rear/rear/pull/2608">#2608 PR</a> <code>merged</code>: Fix setting boot path in case of UEFI partition (ESP) on MD RAID<a class="headerlink" href="#2608_pr_merged_fix_setting_boot_path_in_case_of_uefi_partition_esp_on_md_raid" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2021-04-28_1809"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2608">2021-04-28 18:09</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2021-04-28_1809" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>High</strong></p>
</li>
<li>
<p>Reference to related issue (URL): #2595</p>
</li>
<li>
<p>How was this pull request tested?<br />
    Backup &amp; restore on a RHEL 8 host with UEFI but without RAID and on
    a CentOS 7 host with UEFI and RAID (ESP on RAID). Examination of
    logs to check that correct efibootmgr commands were executed.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>Use dependencies when determining partitions for UEFI</p>
<p>The ESP may be located on a RAID device. In this case, we need to
determine the physical RAID components and call efibootmgr on them
(after restoring - during the finalize step), because efibootmgr does
not know how to tell the firmware to boot from RAID. Moreover, the
current code tries to parse a device like <code>/dev/md125</code> into a disk
called <code>/dev/md</code> and partition <code>125</code>.</p>
<p>Fix by using storage dependencies: RAID components (the actual ESP
copies) can be found as dependencies of the ESP block device. For
consistency, use dependencies also to locate the ESP block device itself
(the old method is preserved as a fallback). Similar strategy is used by
the GRUB2 installation code
(finalize/Linux-i386/660_install_grub2.sh), which is able to install
GRUB2 on the RAID components correctly.</p>
<p>In addition, clean up
usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh a bit and add
more logging to ease analysis when something goes wrong in this area.</p>
<p>TODO: finalize/Linux-i386/610_EFISTUB_run_efibootmgr.sh needs a
similar fix.</p>
<p>Fixes #2595</p>
<h4 id="pcahyna_commented_at_2021-04-29_1858"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-829508756">2021-04-29 18:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-04-29_1858" title="Permanent link">&para;</a></h4>
<p>@gdha hello, should it have the <strong>enhancement</strong> label, when it Fixes
#2595, which has the <strong>bug</strong> label?</p>
<h4 id="pcahyna_commented_at_2021-04-29_1859"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-829509260">2021-04-29 18:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-04-29_1859" title="Permanent link">&para;</a></h4>
<p>@rmetrich hello, please review, as you reported the problem.</p>
<h4 id="rmetrich_commented_at_2021-04-30_1051"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830012452">2021-04-30 10:51</a>:<a class="headerlink" href="#rmetrich_commented_at_2021-04-30_1051" title="Permanent link">&para;</a></h4>
<p>Hi @pcahyna I'm all good with your code, thanks a lot for the effort.</p>
<h4 id="jsmeix_commented_at_2021-04-30_1125"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830028354">2021-04-30 11:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1125" title="Permanent link">&para;</a></h4>
<p>I agree that ReaR is expected to restore a software RAID also on UEFI
systems<br />
so the issue is a missing expected functionality a.k.a. "bug".</p>
<p>On the other hand there are zillions of other "reasonably expected"
functionalitries<br />
that are currently missing in ReaR so such issues are also
enhancements<br />
in particular when "reasonably expected" code for that is just not
there.</p>
<p>For me a plain "bug" is only when code that is there does not work as
intended.</p>
<p>I.e. it is also not a plain "bug" when code that is there does work as
intended<br />
but the current intention is not what others "reasonably expect" so such
code<br />
is "buggy" and needs some enhancement to behave as "reasonably
expected".</p>
<h4 id="jsmeix_commented_at_2021-04-30_1129"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830030528">2021-04-30 11:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1129" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for your additional cleanup work like your recent<br />
<a href="https://github.com/rear/rear/pull/2608/commits/8228246d16b1374be5cc25fb7a1244c7102b804a">https://github.com/rear/rear/pull/2608/commits/8228246d16b1374be5cc25fb7a1244c7102b804a</a></p>
<p>I do very much appreciate it!<br />
It helps so much to get ReaR's code step by step into a better state<br />
where others can easily understand WHY and WHAT and HOW things are done
in ReaR<br />
so that others can easily adapt and enhance ReaR in the future.</p>
<h4 id="pcahyna_commented_at_2021-04-30_1237"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830064811">2021-04-30 12:37</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-04-30_1237" title="Permanent link">&para;</a></h4>
<p>@jsmeix, glad you like it! You know,<br />
<a href="https://despair.com/products/quality">https://despair.com/products/quality</a></p>
<p>I can also replace the non-standard case identifiers like <code>Dev</code> and
<code>ParNr</code> by something that conforms to the style guide, if you think that
it makes sense to do it in the same PR.</p>
<h4 id="jsmeix_commented_at_2021-04-30_1310"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830084073">2021-04-30 13:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1310" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes, feel free to mercilessly replace old non-standard identifiers with
better names<br />
in particular if needed with more explanatory names<br />
cf. "Code must be easy to read" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>I appreciate it!</p>
<h4 id="jsmeix_commented_at_2021-04-30_1331"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830096328">2021-04-30 13:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1331" title="Permanent link">&para;</a></h4>
<p>I wish you all a relaxed and recovering weekend!</p>
<h4 id="jsmeix_commented_at_2021-04-30_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-830103010">2021-04-30 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1340" title="Permanent link">&para;</a></h4>
<p>Some "famous words" before weekend regarding<br />
<a href="https://despair.com/products/quality">https://despair.com/products/quality</a></p>
<pre><code>The race for quality has no finish line- so technically,
it's more like a death march.
</code></pre>
<p>Yes, we all will be dead at some time.</p>
<p>But if we made code as intended by<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
our code can evolve (it may not evolve but it can evolve)<br />
so from our code future code can be derived (this may not happen but it
can happen)<br />
in contrast to code that (amost) nobody understands which will be
completely removed<br />
and replaced by other completely new code from scratch<br />
so code that is hard to understand dies out<br />
while code that is easy to understand can have descendants.</p>
<h4 id="jsmeix_commented_at_2021-05-03_1248"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831237081">2021-05-03 12:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-03_1248" title="Permanent link">&para;</a></h4>
<p>It seems there is a dilemma where in the code<br />
the <code>Creating EFI Boot Manager entries...</code> info<br />
should be done.</p>
<p>Current finalize/Linux-i386/670_run_efibootmgr.sh code in this pull
request is (excerpts)</p>
<pre><code>LogPrint "Creating EFI Boot Manager entries..."
...
if [ "$esp_mountpoint" = "/" ] ; then
    esp_mountpoint="$TARGET_FS_ROOT/boot/efi"
    Log "Mountpoint of $TARGET_FS_ROOT/$UEFI_BOOTLOADER not found, trying $esp_mountpoint"
fi
...
test -d "$esp_mountpoint" || return 0
</code></pre>
<p>so it could tell the user <code>Creating EFI Boot Manager entries...</code><br />
but then it exits silently and does nothing.</p>
<p>I think when <code>test -d "$esp_mountpoint"</code> fails is must no longer exit
silently<br />
so a matching message should be added like</p>
<pre><code>if ! test -d "$esp_mountpoint" ; then
    LogPrint "Skip creating EFI Boot Manager entries (no ESP mountpoint found)"
fi
</code></pre>
<p>Or my<br />
<a href="https://github.com/rear/rear/pull/2608/files#r622957244">https://github.com/rear/rear/pull/2608/files#r622957244</a><br />
was wrong and nothing should be shown to the user about<br />
<code>Mountpoint of /mnt/local/UEFI_BOOTLOADER not found, trying /mnt/local/boot/efi</code><br />
and the <code>LogPrint "Creating EFI Boot Manager entries..."</code><br />
should be moved after the <code>test -d "$esp_mountpoint" || return 0</code>.</p>
<h4 id="pcahyna_commented_at_2021-05-03_1335"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831263524">2021-05-03 13:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-03_1335" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think when <code>test -d "$esp_mountpoint"</code> fails is must no longer exit
silently</p>
</blockquote>
<p>This part caught my attention as well. Is it even wise to return 0 in
this case? At this point we know that a UEFI bootloader should be used,
so skipping the rest of the file is almost certainly a serious error.<br />
(Not so much related to the subject of the PR anymore though. For now, I
can add the other LogPrint as you suggest.)</p>
<h4 id="pcahyna_commented_at_2021-05-03_1407"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831283209">2021-05-03 14:07</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-03_1407" title="Permanent link">&para;</a></h4>
<blockquote>
<p>For now, I can add the other LogPrint as you suggest</p>
</blockquote>
<p>Done (I changed the message a bit.)</p>
<h4 id="jsmeix_commented_at_2021-05-03_1507"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831321942">2021-05-03 15:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-03_1507" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your
<a href="https://github.com/rear/rear/pull/2608#issuecomment-831263524">https://github.com/rear/rear/pull/2608#issuecomment-831263524</a></p>
<pre><code>At this point we know that a UEFI bootloader should be used,
so skipping the rest of the file is almost certainly a serious error.
</code></pre>
<p>Then show it as an error to the user so he is informed something went
wrong<br />
(e.g. use wording like <code>failed to ...</code> or <code>cannot ...</code> that tells
something went wrong)<br />
and the user knows he may have to fix something manually after "rear
recover"<br />
and leave the script with <code>return 1</code> (the <code>Source</code> function doesn't
abort)<br />
but do not error out of "rear recover", cf.
finalize/Linux-i386/660_install_grub2.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh</a></p>
<h4 id="pcahyna_commented_at_2021-05-03_1526"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831339455">2021-05-03 15:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-03_1526" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Then show it as an error to the user so he is informed something went
wrong<br />
(e.g. use wording like <code>failed to ...</code> or <code>cannot ...</code> that tells
something went wrong)<br />
and the user knows he may have to fix something manually after "rear
recover"<br />
and leave the script with <code>return 1</code></p>
</blockquote>
<p>I can do that, but I feel this deviates a lot from the subject of this
PR (the questionable return 0 is inherited from the original code).</p>
<h4 id="pcahyna_commented_at_2021-05-03_2057"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831529369">2021-05-03 20:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-03_2057" title="Permanent link">&para;</a></h4>
<p>@jsmeix I believe that I addressed all your comments except for the
<code>return 0</code> in some places where it had existed before my changes. Please
review again. If everything is ok, I will force push to squash some
commits together.</p>
<h4 id="pcahyna_commented_at_2021-05-03_2059"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831530180">2021-05-03 20:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-03_2059" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna<br />
yes, feel free to mercilessly replace old non-standard identifiers
with better names<br />
in particular if needed with more explanatory names<br />
cf. "Code must be easy to read" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>I appreciate it!</p>
</blockquote>
<p>One of the last commits does that now.</p>
<h4 id="jsmeix_commented_at_2021-05-04_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831887918">2021-05-04 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1201" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for all your work here - in particular for your additional
cleanup work!</p>
<h4 id="jsmeix_commented_at_2021-05-04_1202"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831888279">2021-05-04 12:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1202" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
if there are no objections I would like to merge it tomorrow afternoon.</p>
<h4 id="jsmeix_commented_at_2021-05-04_1215"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831895902">2021-05-04 12:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1215" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
the <code>return 0</code> when there is
<code>no ESP mountpoint directory $esp_mountpoint</code> is from me via<br />
<a href="https://github.com/rear/rear/commit/cb6fe3be719c1361b22d0484cd940c681752a973">https://github.com/rear/rear/commit/cb6fe3be719c1361b22d0484cd940c681752a973</a></p>
<p>I am sure I could not think about if <code>return 1</code> could be better for this
particular case<br />
because at that time I did not know your reasoning why <code>return 1</code> is
right here in your<br />
<a href="https://github.com/rear/rear/pull/2608#issuecomment-831263524">https://github.com/rear/rear/pull/2608#issuecomment-831263524</a></p>
<h4 id="pcahyna_commented_at_2021-05-04_1251"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831916709">2021-05-04 12:51</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-04_1251" title="Permanent link">&para;</a></h4>
<p>@jsmeix are there any guidelines for return codes from scripts? ReaR
does not seem to care that much, actually. There is just
<code>Debug "Source function: 'source $source_file' returns $source_return_code"</code>
in the <code>Source()</code> function. So it looks like returning 1 when problems
are discovered is not enough to get them noticed by the user and one
should complain very loudly (<code>LogPrintError</code>, probably).</p>
<h4 id="jsmeix_commented_at_2021-05-04_1309"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-831929130">2021-05-04 13:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1309" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes, what you describe in your<br />
<a href="https://github.com/rear/rear/pull/2608#issuecomment-831916709">https://github.com/rear/rear/pull/2608#issuecomment-831916709</a><br />
is exactly the current state in ReaR's code.</p>
<p>See also<br />
<a href="https://github.com/rear/rear/pull/1970">https://github.com/rear/rear/pull/1970</a></p>
<p>So currently there is no difference in user experience between<br />
leaving a script with <code>return 0</code> versus <code>return 1</code>.</p>
<p>But for those who read the code of the script it makes clear<br />
if things were expected and all is well with leaving the script at that
place<br />
versus an error-like issue happened why the script cannot be continued<br />
(which is not a fatal error to <code>Error</code> out of the whole
<code>rear &lt;workflow&gt;</code>).</p>
<p>It would take some longer time until all scripts are fixed that
currently<br />
exit with non-zero exit code by accident when the last command<br />
in the script exits with non-zero exit code which is the reason why<br />
there is no user alert when a script exits with non-zero exit code.</p>
<p>Currently it is intentionally only a <code>Debug</code> message because<br />
some users inspect the ReaR log and raise issues here<br />
for all what looks like an error to them ;-)</p>
<p>See
<a href="https://github.com/rear/rear/issues/2416">https://github.com/rear/rear/issues/2416</a><br />
and as an example the therein mentioned<br />
<a href="https://github.com/rear/rear/issues/2473">https://github.com/rear/rear/issues/2473</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/2479">https://github.com/rear/rear/issues/2479</a></p>
<h4 id="pcahyna_commented_at_2021-05-04_1631"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832077669">2021-05-04 16:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-04_1631" title="Permanent link">&para;</a></h4>
<p>@jsmeix please check if you approve the latest change, esp. the wording
of the error messages. If yes, I consider this PR functionally complete
and I will rebase and force-push the branch to squash related commits
together.</p>
<h4 id="jsmeix_commented_at_2021-05-05_0718"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832469736">2021-05-05 07:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-05_0718" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your final adaptions and enhancements.<br />
Even if those kind of smaller things might look unimportant or
nitpicking<br />
I appreciate them so much because at least for me such smaller things
are important<br />
because they can make a bigger difference how others can understand what
goes on.</p>
<p>I dared to do some further tiny adaptions and enhancements regarding
such smaller things<br />
via my recent commits here - I hope that is OK for you @pcahyna</p>
<p>Now all looks very well to me<br />
and I would like to merge it today afternoon<br />
unless there are objections from other @rear/contributors</p>
<h4 id="jsmeix_commented_at_2021-05-05_0735"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832478972">2021-05-05 07:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-05_0735" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
no need to rebase and force-push the branch to squash related commits
together.<br />
Just keep the individual development commits as is.</p>
<p>The merge commit will automatically be the one that has all of them in
one commit.</p>
<p>I even prefer when all the individual development commits are kept as
is.<br />
It preserves the development history in the master branch<br />
i.e. I perfer to not remove information unless there is a serious reason
to do so.</p>
<p>In my local <code>git clone https://github.com/rear/rear.git</code> I often use</p>
<pre><code>git log --format="%ae %H %ad%n%s :%n%b%n" --graph | fmt -w 120 -u -t | less
</code></pre>
<p>to show the whole git history in the master branch and there<br />
all the individual development commits often help me<br />
to better understand in retrospect why things were changed<br />
without the need to dig out the GitHub issue and pull request<br />
and read through all the details there.</p>
<p>Having all the individual development commits in the master branch
history<br />
is often even crucial to understand in retrospect what was actually
changed<br />
because the merge commit message is often only rather meaningless, e.g.:</p>
<pre><code>* | | | gratien.dhaese@gmail.com 285c0c7660caca184ea53dbec5525a69af1fdcc9 Tue Jan 26 14:44:39 2021 +0100
|\ \ \ \ Merge pull request #2544 from pcahyna/netbackup-vxpbx_exchanged :
| | | | | Changes for NetBackup (NBU) support
| | | | |
| * | | | pcahyna@redhat.com 9a0fcbfd0dcfecdfce5921e24a89e3918d962467 Wed Dec 16 11:08:14 2020 +0100
| | | | | Changes for NetBackup (NBU) support :
| | | | | Add /usr/openv/tmp directory to the NBU skeleton
| | | | |
| | | | |
| * | | | pcahyna@redhat.com 0c6909ed2c37dfa92f87b0714b62af7cae4720c9 Wed Dec 16 10:40:55 2020 +0100
| |/ / / Changes for NetBackup (NBU) support :
| | | | Copy NetBackup PBX related files to the rescue system and start
| | | | vxpbx_exchanged on boot
</code></pre>
<p>The merge commit message <code>Changes for NetBackup (NBU) support</code> alone<br />
tells nothing what was changed.</p>
<h4 id="pcahyna_commented_at_2021-05-05_0835"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832515463">2021-05-05 08:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-05_0835" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>your newest commits are ok. But I don't entirely agree with</p>
<blockquote>
<p>no need to rebase and force-push the branch to squash related commits
together.<br />
Just keep the individual development commits as is.</p>
</blockquote>
<p>There are commits marked as squash! and fixup! and those were intended
to be squashed with others. My intent was to preserve the history, but
not all of the commits, there were commits that merely amend earlier
commits and the history would IMO look better with them squashed into
earlier commits. The squash! and fixup! log messages will look
particularly ugly in the history because they were not intended to be
part of the final history.</p>
<h4 id="jsmeix_commented_at_2021-05-05_0844"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832520539">2021-05-05 08:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-05_0844" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
feel free to squash your commits as you like<br />
provided the commit messages of the commits you finally keep<br />
still show sufficient information so that others can understand in
retrospect<br />
what was changed without the need to dig out the GitHub issue<br />
and pull request and read through all the details there.</p>
<p>In particular we need that understanding in retrospect<br />
when we make the doc/rear-release-notes.txt<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a><br />
cf. "compile the information for the release notes" in<br />
<a href="https://github.com/rear/rear/wiki/Release-process">https://github.com/rear/rear/wiki/Release-process</a></p>
<h4 id="pcahyna_commented_at_2021-05-05_1128"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832614577">2021-05-05 11:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-05_1128" title="Permanent link">&para;</a></h4>
<p>@jsmeix rebase done.</p>
<h4 id="jsmeix_commented_at_2021-05-05_1204"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832633810">2021-05-05 12:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-05_1204" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you.</p>
<p>I will merge it soon today.</p>
<h4 id="pcahyna_commented_at_2021-05-05_1908"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-832939131">2021-05-05 19:08</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-05_1908" title="Permanent link">&para;</a></h4>
<p>Oops. I accidentally made the file executable in
27de4cd95dabe86f531f132108744459b2dbcfd0 @jsmeix can you please revert
the mode change, or should I submit a new PR reverting it?</p>
<h4 id="jsmeix_commented_at_2021-05-07_0944"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2608#issuecomment-834219708">2021-05-07 09:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-07_0944" title="Permanent link">&para;</a></h4>
<p>@pcahyna regarding executable
finalize/Linux-i386/670_run_efibootmgr.sh<br />
you could simply submit it with mode <code>-rw-r--r--</code> as "by the way"
addon<br />
via your next PR without mentioning it in a commit message<br />
(but you can mention it in a separated PR comment).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-04-28.2608.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
