<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#183 Issue closed: parted complains with "Error: Partition doesn't exist" - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#183 Issue closed: parted complains with \"Error: Partition doesn\u0027t exist\"";
        var mkdocs_page_input_path = "issues/2012-11-30.183.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#183 Issue closed: parted complains with "Error: Partition doesn't exist"</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="183_issue_closed_parted_complains_with_error_partition_doesnt_exist"><a href="https://github.com/rear/rear/issues/183">#183 Issue</a> <code>closed</code>: parted complains with "Error: Partition doesn't exist"<a class="headerlink" href="#183_issue_closed_parted_complains_with_error_partition_doesnt_exist" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code></p>
<h4 id="gdha_opened_issue_at_2012-11-30_1159"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/183">2012-11-30 11:59</a>:<a class="headerlink" href="#gdha_opened_issue_at_2012-11-30_1159" title="Permanent link">&para;</a></h4>
<p>During a recover exercise on SAN based disks I get an error during the
partitioning:</p>
<pre><code>+++ echo '2012-11-30 13:48:37 Erasing MBR of disk /dev/mapper/36001438005deb05d0000e00005c40000'
2012-11-30 13:48:37 Erasing MBR of disk /dev/mapper/36001438005deb05d0000e00005c40000
+++ dd if=/dev/zero of=/dev/mapper/36001438005deb05d0000e00005c40000 bs=512 count=1
1+0 records in
1+0 records out
512 bytes (512 B) copied, 0.000169116 s, 3.0 MB/s
+++ sync
+++ LogPrint 'Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)'
+++ Log 'Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)'
+++ test 1 -gt 0
++++ Stamp
++++ date '+%Y-%m-%d %H:%M:%S '
+++ echo '2012-11-30 13:48:37 Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)'
2012-11-30 13:48:37 Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)
+++ Print 'Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)'
+++ test 1
+++ echo -e 'Creating partitions for disk /dev/mapper/36001438005deb05d0000e00005c40000 (msdos)'
+++ parted -s /dev/mapper/36001438005deb05d0000e00005c40000 mklabel msdos
+++ parted -s /dev/mapper/36001438005deb05d0000e00005c40000 mkpart primary 32768B 1069286911B
+++ parted -s /dev/mapper/36001438005deb05d0000e00005c40000 set 400001 boot on
Error: Partition doesn't exist.
2012-11-30 13:48:37 An error occured during layout recreation.
</code></pre>
<p>When we look on the devices with parted we see the following:</p>
<pre><code># parted /dev/mapper/36001438005deb05d0000e00005c40000
GNU Parted 1.8.8
Using /dev/mapper/36001438005deb05d0000e00005c40000
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print
Model: Linux device-mapper (dm)
Disk /dev/mapper/36001438005deb05d0000e00005c40000: 322GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End     Size    Type     File system  Flags
 1      32.8kB  1069MB  1069MB  primary  ext3         , , , , , , , , , type=83, ,
</code></pre>
<p>And when we look at one of the multipath devices with its physical name:</p>
<pre><code>Model: HP HSV450 (scsi)
Disk /dev/sda: 322GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system  Name     Flags
 1      32.8kB  1069MB  1069MB  ext3         primary  boot, , , , , , , , , , ,
 2      1069MB  322GB   321GB                primary  , , , , , lvm, , , , , ,
</code></pre>
<p>Before restarting the recovery we dd all devices belonging to dm-0</p>
<pre><code>dd if=/dev/zero of=/dev/mapper/36001438005deb05d0000e00005c40000 bs=512 count=1
dd if=/dev/zero of=/dev/sda bs=512 count=1
...
</code></pre>
<p>but it still complains</p>
<h4 id="gdha_commented_at_2012-11-30_1353"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-10889620">2012-11-30 13:53</a>:<a class="headerlink" href="#gdha_commented_at_2012-11-30_1353" title="Permanent link">&para;</a></h4>
<p>+++ parted -s /dev/mapper/36001438005deb05d0000e00005c40000 set 400001
boot on<br />
Error: Partition doesn't exist</p>
<p>the 400001 should be a 1 ! The layout code somehow wrongly converted
this.</p>
<h4 id="gdha_commented_at_2012-12-21_0901"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-11606704">2012-12-21 09:01</a>:<a class="headerlink" href="#gdha_commented_at_2012-12-21_0901" title="Permanent link">&para;</a></h4>
<p>Digging into the code for this issue (script
<code>layout/prepare/GNU/Linux/10_include_partition_code.sh</code>) and the lines
of interest producing above mentioned lines are:</p>
<pre><code>        # Get the partition number from the name
        local number=$(echo "$partition" | grep -o -E "[0-9]+$")
</code></pre>
<p>Simulating the input as follows:</p>
<pre><code>$ partition=/dev/mapper/36001438005deb05d0000e00005c400001
$ echo "$partition" | grep -o -E "[0-9]+$"
400001
</code></pre>
<p>Under normal circumstances we give the following entries as input:</p>
<pre><code>$ partition=/dev/cciss/c0d0p1
$ echo "$partition" | grep -o -E "[0-9]+$"
1
</code></pre>
<p>@jhoekx : how shall we fix this? Cutting the last 2 digits?</p>
<h4 id="jhoekx_commented_at_2012-12-21_0915"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-11607048">2012-12-21 09:15</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-12-21_0915" title="Permanent link">&para;</a></h4>
<p>No, that is too much of a hack :-)</p>
<p>What is the normal path of one of the partitions?</p>
<h4 id="gdha_commented_at_2012-12-21_1026"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-11608673">2012-12-21 10:26</a>:<a class="headerlink" href="#gdha_commented_at_2012-12-21_1026" title="Permanent link">&para;</a></h4>
<p>@jhoekx In the following gist several input files are listed so you've
get an idea of how the <code>diskrestore.sh</code> script was created:</p>
<p><a href="https://gist.github.com/4351993">https://gist.github.com/4351993</a></p>
<h4 id="jhoekx_commented_at_2012-12-21_1040"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-11608960">2012-12-21 10:40</a>:<a class="headerlink" href="#jhoekx_commented_at_2012-12-21_1040" title="Permanent link">&para;</a></h4>
<p>I see, that leaves us no choice at all if we want to support that. So go
ahead and add the cut. I think we also need to strip leading zeros.</p>
<h4 id="gdha_commented_at_2013-01-22_1314"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-12543718">2013-01-22 13:14</a>:<a class="headerlink" href="#gdha_commented_at_2013-01-22_1314" title="Permanent link">&para;</a></h4>
<p>Need to review the code as input device name does not have any
indication of a partition layout yet...need some more thoughts.</p>
<h4 id="gdha_commented_at_2013-01-25_0846"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-12692464">2013-01-25 08:46</a>:<a class="headerlink" href="#gdha_commented_at_2013-01-25_0846" title="Permanent link">&para;</a></h4>
<p>I think the problem we have with SAN disks is due to missing code in
<code>layout/prepare/default/32_apply_mappings.sh</code><br />
The case statement does not cope with SAN disks (yet):</p>
<pre><code># Replace all replacements with their target
while read source target junk ; do
    replacement=$(get_replacement "$source")
    # Replace whole device
    sed -i -r "\|$replacement|s|$replacement\&gt;|$target|g" $LAYOUT_FILE
    # Replace partitions
    case "$target" in
        *rd[/!]c[0-9]d[0-9]|*cciss[/!]c[0-9]d[0-9]|*ida[/!]c[0-9]d[0-9]|*amiraid[/!]ar[0-9]|*emd[/!][0-9]|*ataraid[/!]d[0-9]|*carmel[/!][0-9])
            target="${target}p" # append p between main device and partitions
            ;;
    esac
    sed -i -r "\|$replacement|s|$replacement([0-9]+)|$target\1|g" $LAYOUT_FILE
</code></pre>
<p>Therefore replacement disk
<code>/dev/mapper/36001438005deb05d0000e00005c40000</code> becomes
<code>/dev/mapper/36001438005deb05d0000e00005c400001</code> instead of
<code>/dev/mapper/36001438005deb05d0000e00005c40000_part1</code></p>
<p>Wow - it took a while to trace this one.</p>
<p>I'm not sure SAN disk devices are always presented this way? Can we
assume <code>/dev/mapper/</code> is an indication or not?</p>
<h4 id="jhoekx_commented_at_2013-01-25_0855"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-12692698">2013-01-25 08:55</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-01-25_0855" title="Permanent link">&para;</a></h4>
<p>If you are restoring to the same SAN LUN the replacement code shouldn't
be triggered at all. If it is, that's the problem?</p>
<h4 id="gdha_commented_at_2013-01-28_1248"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-12780179">2013-01-28 12:48</a>:<a class="headerlink" href="#gdha_commented_at_2013-01-28_1248" title="Permanent link">&para;</a></h4>
<p>it was a migration from a (source) system with cciss-internal disk to a
(target) system with only SAN-disk(s)</p>
<h4 id="dagwieers_commented_at_2013-02-01_1549"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-12999706">2013-02-01 15:49</a>:<a class="headerlink" href="#dagwieers_commented_at_2013-02-01_1549" title="Permanent link">&para;</a></h4>
<p>@gdha I have never seen anything other than the following convention:</p>
<ul>
<li>If the blockdevice ends with a letter, add the partition number</li>
<li>If the blockdevice ends with a number, add 'p' followed by the
    partition number</li>
</ul>
<p>So disk /dev/mapper/36001438005deb05d0000e00005c40000 has first
partition /dev/mapper/36001438005deb05d0000e00005c40000p1</p>
<h4 id="gdha_commented_at_2013-03-10_1200"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-14680199">2013-03-10 12:00</a>:<a class="headerlink" href="#gdha_commented_at_2013-03-10_1200" title="Permanent link">&para;</a></h4>
<p>The mail thread of
<a href="http://pikachu.3ti.be/pipermail/rear-users/2013-February/002642.html">http://pikachu.3ti.be/pipermail/rear-users/2013-February/002642.html</a>
gives some interesting background material for this issue.</p>
<h4 id="probackup-nl_commented_at_2017-04-14_1847"><img src="https://avatars.githubusercontent.com/u/515451?u=4f985fa15d087babc5049c337be90b42b56c8b8b&v=4" width="50"><a href="https://github.com/ProBackup-nl">ProBackup-nl</a> commented at <a href="https://github.com/rear/rear/issues/183#issuecomment-294212464">2017-04-14 18:47</a>:<a class="headerlink" href="#probackup-nl_commented_at_2017-04-14_1847" title="Permanent link">&para;</a></h4>
<p>@gdha In ReaR <code>2.00 git</code> there is still a similar issue for sd to nvme
device migrations.<br />
The source drive device was named: <code>/dev/sda</code><br />
The target drive device is named: <code>/dev/nvme0n1</code></p>
<p><code>rear recover</code> tries to:<br />
<code>+++ parted -s /dev/nvme0n1 set 11 boot on</code></p>
<p>The <code>11</code> should be a <code>1</code>.</p>
<p>disklayout.conf (shortened) lists:</p>
<pre><code>...
part /dev/nvme0n1 1G 4M EFIboot boot /dev/nvme0n11
part /dev/nvme0n1 172G 107G root none /dev/nvme0n12
...
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2012-11-30.183.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
