<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1380 Issue closed: ReaR recovery fails when the OS contains a Thin Pool/Volume - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1380 Issue closed: ReaR recovery fails when the OS contains a Thin Pool/Volume";
        var mkdocs_page_input_path = "issues/2017-06-09.1380.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1380 Issue closed: ReaR recovery fails when the OS contains a Thin Pool/Volume</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1380_issue_closed_rear_recovery_fails_when_the_os_contains_a_thin_poolvolume"><a href="https://github.com/rear/rear/issues/1380">#1380 Issue</a> <code>closed</code>: ReaR recovery fails when the OS contains a Thin Pool/Volume<a class="headerlink" href="#1380_issue_closed_rear_recovery_fails_when_the_os_contains_a_thin_poolvolume" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="gdha_opened_issue_at_2017-06-09_1511"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/1380">2017-06-09 15:11</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-06-09_1511" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): 1.17.2_3 (and 2.0)</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): RHEL 7.3</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf): BACKUP=NETFS</li>
<li>Are you using legacy BIOS or UEFI boot? no</li>
<li>Brief description of the issue:<br />
    When using ReaR, the recovery process of a system which has a VG
    which contains a Thin Pool/Volume fails and the system is no longer
    recoverable. This has a high impact because ReaR will not be able to
    restore the system back to an operational state. The location of the
    Thin Pool is independent of the VG which contains it, that is, it
    does not matter if the Thin Pool is contained in the rootvg or in an
    independent VG.</li>
<li>Work-around, if any: see RH bug report
    <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1450667">https://bugzilla.redhat.com/show_bug.cgi?id=1450667</a></li>
</ul>
<h4 id="gdha_commented_at_2017-07-19_1507"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-316417452">2017-07-19 15:07</a>:<a class="headerlink" href="#gdha_commented_at_2017-07-19_1507" title="Permanent link">&para;</a></h4>
<p>post-pone to release 2.3</p>
<h4 id="jmazanek_commented_at_2017-09-04_1316"><img src="https://avatars.githubusercontent.com/u/16332741?v=4" width="50"><a href="https://github.com/jmazanek">jmazanek</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-326961209">2017-09-04 13:16</a>:<a class="headerlink" href="#jmazanek_commented_at_2017-09-04_1316" title="Permanent link">&para;</a></h4>
<p>With the rear-2.00 the system recovery works, but the thin pool is not
preserved.<br />
Here are the details of the testing we did:</p>
<p>Details of a new reproducer in my lab using the latest version of ReaR:</p>
<p>Version installed: rear-2.00-2.el7.x86_64<br />
Hypervisor: ofamera-devel.usersys.redhat.com<br />
Original machine: fvm-rhel-7-3-34 &lt;-- Executed 'rear mkbackup'<br />
Recovery machine: fvm-rhel-7-3-38 &lt;-- Executed 'rear recover'<br />
NFS backup server: fvm-rhel-7-3-44<br />
User: root<br />
Pass: testtest</p>
<hr />
<p>*** BACKUP TEST ***</p>
<hr />
<p>RESULT: Backup taken successfully. ISO + backup.tar.gz were sent to the
NFS server</p>
<p>-&gt; Original system (fvm-rhel-7-3-34):</p>
<p>[root@fvm-rhel-7-3-34 ~]# rear -d -v mkbackup<br />
Relax-and-Recover 2.00 / Git<br />
Using log file: /var/log/rear/rear-fvm-rhel-7-3-34.log<br />
Using backup archive 'backup.tar.gz'<br />
Creating disk layout<br />
Creating root filesystem layout<br />
Copying logfile /var/log/rear/rear-fvm-rhel-7-3-34.log into initramfs as
'/tmp/rear-fvm-rhel-7-3-34-partial-2017-08-21T10:14:10+0200.log'<br />
Copying files and directories<br />
Copying binaries and libraries<br />
Copying kernel modules<br />
Creating initramfs<br />
Making ISO image<br />
Wrote ISO image: /var/lib/rear/output/rear-fvm-rhel-7-3-34.iso (134M)<br />
Copying resulting files to nfs location<br />
Saving /var/log/rear/rear-fvm-rhel-7-3-34.log as
rear-fvm-rhel-7-3-34.log to nfs location<br />
Creating tar archive
'/tmp/rear.WaTt8XedE2CpdJ3/outputfs/fvm-rhel-7-3-34/backup.tar.gz'<br />
Archived 850 MiB [avg 3349 KiB/sec] OK<br />
Archived 850 MiB in 261 seconds [avg 3336 KiB/sec]<br />
You should also rm -Rf /tmp/rear.WaTt8XedE2CpdJ3<br />
[root@fvm-rhel-7-3-34 ~]# lvs<br />
LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert<br />
root_lv r7vg -wi-ao---- 4.88g<br />
swap_lv r7vg -wi-ao---- 256.00m<br />
lv_thin vg_thin Vwi-a-tz-- 1.00g lv_thinpool 0.00<br />
lv_thinpool vg_thin twi-aotz-- 92.00m 0.00 0.98</p>
<p>-&gt; NFS backup server (fvm-rhel-7-3-44):</p>
<p>[root@fvm-rhel-7-3-44 ~]# ls -l /media/backups/fvm-rhel-7-3-34/<br />
total 1010332<br />
-rw-------. 1 nfsnobody nfsnobody 2252128 Aug 21 10:20 backup.log<br />
-rw-------. 1 nfsnobody nfsnobody 891757428 Aug 21 10:20 backup.tar.gz<br />
-rw-------. 1 nfsnobody nfsnobody 202 Aug 21 10:16 README<br />
-rw-------. 1 nfsnobody nfsnobody 140369920 Aug 21 10:15
rear-fvm-rhel-7-3-34.iso<br />
-rw-------. 1 nfsnobody nfsnobody 183744 Aug 21 10:16
rear-fvm-rhel-7-3-34.log<br />
-rw-------. 1 nfsnobody nfsnobody 0 Aug 21 10:20 selinux.autorelabel<br />
-rw-------. 1 nfsnobody nfsnobody 273 Aug 21 10:16 VERSION</p>
<hr />
<p>*** RECOVERY TEST ***</p>
<hr />
<p>RESULT: It recovered the system (it was able to boot afterwards) but
only the OS itself (root VG/LVs), not the LVM Thin Pool/Volumes in the
second disk</p>
<p>-&gt; Original system (fvm-rhel-7-3-34):</p>
<p>[jserrano@ofamera-devel ~]$ fast-vm ssh 34<br />
[inf] checking the 192.168.33.34 for active SSH connection (ctrl+c to
interrupt)<br />
[inf]<br />
SSH ready<br />
Warning: Permanently added '192.168.33.34' (ECDSA) to the list of known
hosts.</p>
<p>System is booting up. See pam_nologin(8)<br />
Last login: Mon Aug 21 12:35:16 2017 from gateway</p>
<p>[root@fvm-rhel-7-3-34 ~]# lvs<br />
LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert<br />
root_lv r7vg -wi-ao---- 4.88g<br />
swap_lv r7vg -wi-ao---- 256.00m<br />
lv_thin vg_thin Vwi-a-tz-- 1.00g lv_thinpool 0.00<br />
lv_thinpool vg_thin twi-aotz-- 92.00m 0.00 0.98<br />
[root@fvm-rhel-7-3-34 ~]#<br />
[root@fvm-rhel-7-3-34 ~]# lsblk<br />
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
sda 8:0 0 6G 0 disk<br />
├─sda1 8:1 0 500M 0 part /boot<br />
└─sda2 8:2 0 5.5G 0 part<br />
├─r7vg-root_lv 253:0 0 4.9G 0 lvm /<br />
└─r7vg-swap_lv 253:1 0 256M 0 lvm [SWAP]<br />
sdb 8:16 0 102.4M 0 disk<br />
├─vg_thin-lv_thinpool_tmeta 253:2 0 4M 0 lvm<br />
│ └─vg_thin-lv_thinpool-tpool 253:4 0 92M 0 lvm<br />
│ ├─vg_thin-lv_thinpool 253:5 0 92M 0 lvm<br />
│ └─vg_thin-lv_thin 253:6 0 1G 0 lvm<br />
└─vg_thin-lv_thinpool_tdata 253:3 0 92M 0 lvm<br />
└─vg_thin-lv_thinpool-tpool 253:4 0 92M 0 lvm<br />
├─vg_thin-lv_thinpool 253:5 0 92M 0 lvm<br />
└─vg_thin-lv_thin 253:6 0 1G 0 lvm<br />
sr0 11:0 1 1024M 0 rom</p>
<p>-&gt; Recovery machine (fvm-rhel-7-3-38) -after 'rear recover'-:</p>
<p>[jserrano@ofamera-devel ~]$ fast-vm ssh 38<br />
[inf] checking the 192.168.33.38 for active SSH connection (ctrl+c to
interrupt)<br />
[inf]<br />
SSH ready<br />
Warning: Permanently added '192.168.33.38' (ECDSA) to the list of known
hosts.<br />
Last login: Mon Aug 21 12:26:46 2017</p>
<p>[root@fvm-rhel-7-3-34 ~]# lvs<br />
LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert<br />
root_lv r7vg -wi-ao---- 4.88g<br />
swap_lv r7vg -wi-ao---- 256.00m</p>
<p>[root@fvm-rhel-7-3-34 ~]# lsblk<br />
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
sda 8:0 0 6G 0 disk<br />
├─sda1 8:1 0 500M 0 part /boot<br />
└─sda2 8:2 0 5.5G 0 part<br />
├─r7vg-root_lv 253:0 0 4.9G 0 lvm /<br />
└─r7vg-swap_lv 253:1 0 256M 0 lvm [SWAP]<br />
sdb 8:16 0 102.4M 0 disk</p>
<h4 id="gdha_commented_at_2017-10-31_1605"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-340812057">2017-10-31 16:05</a>:<a class="headerlink" href="#gdha_commented_at_2017-10-31_1605" title="Permanent link">&para;</a></h4>
<p>@jmazanek Thank you for your comments (it is also part of the RH BZ
report). As I wrote in the BZ we should start with a prep script to
capture the required binaries in the rescue image. Afterwards it will be
easier to add the missing pieces</p>
<h4 id="gdha_commented_at_2017-11-27_1647"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-347243751">2017-11-27 16:47</a>:<a class="headerlink" href="#gdha_commented_at_2017-11-27_1647" title="Permanent link">&para;</a></h4>
<p>We are very sorry but we will postpone this for a later release</p>
<h4 id="gdha_commented_at_2018-05-15_0659"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-389063768">2018-05-15 06:59</a>:<a class="headerlink" href="#gdha_commented_at_2018-05-15_0659" title="Permanent link">&para;</a></h4>
<p>@rmetrich Are you able to assist us with this issue? Is was originally
reported via RedHat. Would be nice if it could be added for ReaR v2.5?</p>
<h4 id="rmetrich_commented_at_2018-05-15_0711"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-389066611">2018-05-15 07:11</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-15_0711" title="Permanent link">&para;</a></h4>
<p>@gdha Hello, I will assist, but for now we do not have a fix on the RH
side as well. I need to sync with LVM specialists to have that move
forward.<br />
It's in my TODO now :-)</p>
<h4 id="rmetrich_commented_at_2018-05-16_1456"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-389549470">2018-05-16 14:56</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-16_1456" title="Permanent link">&para;</a></h4>
<p>@gdha See above pull request</p>
<h4 id="gdha_commented_at_2018-09-19_1325"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1380#issuecomment-422802295">2018-09-19 13:25</a>:<a class="headerlink" href="#gdha_commented_at_2018-09-19_1325" title="Permanent link">&para;</a></h4>
<p>as it is part of ReaR 2.4 already this one can be closed - thanks to
Renaud @rmetrich</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-06-09.1380.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
