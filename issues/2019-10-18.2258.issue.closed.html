<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2258 Issue closed: 500_make_backup.sh fails inexplicably because of a hidden 'no space left on device' error - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2258 Issue closed: 500_make_backup.sh fails inexplicably because of a hidden \u0027no space left on device\u0027 error";
        var mkdocs_page_input_path = "issues/2019-10-18.2258.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2258 Issue closed: 500_make_backup.sh fails inexplicably because of a hidden 'no space left on device' error</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2258_issue_closed_500_make_backupsh_fails_inexplicably_because_of_a_hidden_no_space_left_on_device_error"><a href="https://github.com/rear/rear/issues/2258">#2258 Issue</a> <code>closed</code>: 500_make_backup.sh fails inexplicably because of a hidden 'no space left on device' error<a class="headerlink" href="#2258_issue_closed_500_make_backupsh_fails_inexplicably_because_of_a_hidden_no_space_left_on_device_error" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>,
<code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="jacekadamus88_opened_issue_at_2019-10-18_1337"><img src="https://avatars.githubusercontent.com/u/55064819?v=4" width="50"><a href="https://github.com/jacekadamus88">jacekadamus88</a> opened issue at <a href="https://github.com/rear/rear/issues/2258">2019-10-18 13:37</a>:<a class="headerlink" href="#jacekadamus88_opened_issue_at_2019-10-18_1337" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>Relax-and-Recover 2.5 / 2019-05-10</p>
</li>
<li>
<p>Centos 7</p>
</li>
<li></li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=null
ISO_DIR=/var/backup/main
ISO_PREFIX=dr-backup-$(hostname)-$(date "+%Y-%m-%dT%H-%M-%S")
BACKUP=NETFS
BACKUP_URL=iso://backup
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media/*' '/mnt/*' '/var/tmp/*' '/var/crash/*' '/var/backup/*' '/tmp/*')
USING_UEFI_BOOTLOADER=1
SECURE_BOOT_BOOTLOADER="/boot/efi/EFI/centos/shim.efi"
</code></pre>
<ul>
<li>
<p>BareMetal</p>
</li>
<li>
<p>x86_64</p>
</li>
<li>
<p>UEFI</p>
</li>
<li>
<p>NVMe</p>
</li>
<li>
<p>rear -v mkbackup</p>
</li>
<li>
<p>Haven't found any. Everything was used to work a month ago, last
    successful backup has been taken 22nd SEP. Nothing really changed on
    the system, expect updates and new apps.</p>
</li>
<li>
<p>Currently there is a problem with creating a tar archive due to
    unknown reasons, or at least I couldn't find out the reason by
    myself. Would really appreciate any piece of advice on how to get
    Rear working again.</p>
</li>
</ul>
<p>Console output of the rear -dv mkbackup command</p>
<pre><code>```
rear mkbackup -dv
Relax-and-Recover 2.5 / 2019-05-10
Running rear mkbackup (PID 22225)
Using log file: /var/log/rear/rear-main.log
Using backup archive '/tmp/rear.Azj8RJHxymh4LIx/tmp/isofs/backup/backup.tar.gz'
Found EFI system partition /dev/nvme0n1p1 on /boot/efi type vfat
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-3.10.0-1062.1.2.el7.x86_64' as kernel in the recovery system
Creating disk layout
Docker is running, skipping filesystems mounted below Docker Root Dir /var/lib/docker
Using guessed bootloader 'EFI' (found in first bytes on /dev/nvme0n1)
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
Creating root filesystem layout
Skipping 'docker0': not bound to any physical interface.
Handling network interface 'eno1'
eno1 is a physical device
Handled network interface 'eno1'
To log into the recovery system via ssh set up /root/.ssh/authorized_keys or specify SSH_ROOT_PASSWORD
Using '/boot/efi/EFI/centos/shim.efi' as UEFI bootloader file
Copying logfile /var/log/rear/rear-main.log into initramfs as '/tmp/rear-main-partial-2019-10-18T13:48:08+0200.log'
Copying files and directories
Copying binaries and libraries
Copying all kernel modules in /lib/modules/3.10.0-1062.1.2.el7.x86_64 (MODULES contains 'all_modules')
Copying all files in /lib*/firmware/
Broken symlink '/usr/lib/firmware/3.10.0-957.12.2.el7.x86_64/intel-ucode/06-55-06' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.12.2.el7.x86_64/intel-ucode/06-55-05' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.12.2.el7.x86_64/intel-ucode/06-55-03' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.21.3.el7.x86_64/intel-ucode/06-55-06' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.21.3.el7.x86_64/intel-ucode/06-55-05' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.21.3.el7.x86_64/intel-ucode/06-55-03' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.12.1.el7.x86_64/intel-ucode/06-55-06' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.12.1.el7.x86_64/intel-ucode/06-55-05' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.12.1.el7.x86_64/intel-ucode/06-55-03' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.el7.x86_64/intel-ucode/06-55-06' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.el7.x86_64/intel-ucode/06-55-05' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/firmware/3.10.0-957.el7.x86_64/intel-ucode/06-55-03' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/modules/3.10.0-1062.1.2.el7.x86_64/source' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/usr/lib/modules/3.10.0-1062.1.2.el7.x86_64/build' in recovery system because 'readlink' cannot determine its link target
Broken symlink '/etc/grub2.cfg' in recovery system because 'readlink' cannot determine its link target
Skip copying broken symlink '/etc/mtab' target '/proc/3462/mounts' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.Azj8RJHxymh4LIx/rootfs contains a usable system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (257938795 bytes) in 18 seconds
Creating tar archive '/tmp/rear.Azj8RJHxymh4LIx/tmp/isofs/backup/backup.tar.gz'
```
</code></pre>
<p>Bottom of the /var/log/rear/rear-main.log file, containing the error
message details</p>
<pre><code>```
2019-10-18 13:49:04.918909713 Creating tar archive '/tmp/rear.Azj8RJHxymh4LIx/tmp/isofs/backup/backup.tar.gz'
2019-10-18 14:04:08.976409464 ERROR:  failed with return code  and below output:
  ---snip---

  ----------
This means that the archiving process ended prematurely, or did
not even start. As a result it is unlikely you can recover this
system properly. Relax-and-Recover is therefore aborting execution.

===== Stack trace =====
Trace 0: /sbin/rear:541 main
Trace 1: /usr/share/rear/lib/mkbackup-workflow.sh:20 WORKFLOW_mkbackup
Trace 2: /usr/share/rear/lib/framework-functions.sh:116 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:56 Source
Trace 4: /usr/share/rear/backup/NETFS/default/500_make_backup.sh:252 source
=== End stack trace ===
2019-10-18 14:04:08.981680420 Exiting rear mkbackup (PID 22225) and its descendant processes ...
2019-10-18 14:04:12.095056301 rear,22225 /sbin/rear mkbackup -dv
  `-rear,28022 /sbin/rear mkbackup -dv
      `-pstree,28023 -Aplau 22225
/usr/share/rear/lib/_input-output-functions.sh: line 146: kill: (28028) - No such process
2019-10-18 14:04:12.127059373 Running exit tasks
2019-10-18 14:04:12.128386525 Exit task 'rmdir -v /tmp/rear.Azj8RJHxymh4LIx/outputfs &gt;&amp;2'
rmdir: removing directory, '/tmp/rear.Azj8RJHxymh4LIx/outputfs'
2019-10-18 14:04:12.130638577 Exit task 'cleanup_build_area_and_end_program'
2019-10-18 14:04:12.131872508 Finished in 968 seconds
2019-10-18 14:04:12.133013772 You should also rm -Rf /tmp/rear.Azj8RJHxymh4LIx
2019-10-18 14:04:12.134191381 End of program reached
2019-10-18 14:04:12.135424790 Exit task '(( EXIT_FAIL_MESSAGE )) &amp;&amp; echo 'rear mkbackup failed, check /var/log/rear/rear-main.log for details' 1&gt;&amp;8'
2019-10-18 14:04:12.136660273 Exit task 'exec 8&gt;&amp;-'
2019-10-18 14:04:12.137862904 Exit task 'exec 7&gt;&amp;-'
2019-10-18 14:04:12.139110342 Exit task 'exec 6&lt;&amp;-'
2019-10-18 14:04:12.140367359 Exit task ''
```
</code></pre>
<h4 id="jacekadamus88_commented_at_2019-10-21_0007"><img src="https://avatars.githubusercontent.com/u/55064819?v=4" width="50"><a href="https://github.com/jacekadamus88">jacekadamus88</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544307011">2019-10-21 00:07</a>:<a class="headerlink" href="#jacekadamus88_commented_at_2019-10-21_0007" title="Permanent link">&para;</a></h4>
<p>Seems like, after many hours, I have managed to work around the problem.</p>
<p>Despite the fact that I had my <strong>S3 buckets</strong> excluded from the backup,
they have been root cause of this issue, Everything has been resolved
after umounting them completely. It was quite a big surprise to me. I
have tried to understand the reason. Although it is not my area of
expertise, I strongly believe this might be related to the <strong>dd</strong>
command.</p>
<p>I would appreciate it if someone with bigger knowledge could explain the
reason and tell me whether this is a bug in the <strong>REAR</strong> or somewhere
else.</p>
<h4 id="jsmeix_commented_at_2019-10-21_1059"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544463123">2019-10-21 10:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-21_1059" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
I never used anything like Amazon Simple Storage Service (S3)<br />
where its storage objects are organized into so called 'buckets'<br />
(I read
<a href="https://en.wikipedia.org/wiki/Amazon_S3">https://en.wikipedia.org/wiki/Amazon_S3</a>
for the first time)<br />
so I know nothing at all about its implications in relation to <code>tar</code>.</p>
<p>According to your<br />
<a href="https://github.com/rear/rear/issues/2258#issuecomment-544307011">https://github.com/rear/rear/issues/2258#issuecomment-544307011</a></p>
<pre><code>I had my S3 buckets excluded from the backup,
they have been root cause of this issue,
Everything has been resolved after umounting them completely.
</code></pre>
<p>I guess the following happened in your case:</p>
<p>By default ReaR has some automatism what disk components<br />
(like partitions, filesystems, mountpounts) get included or excluded<br />
and some (other but related) automatism what directories get<br />
included or excluded in the backup which do most of the time<br />
what is usually expected but no automatism works perfect.</p>
<p>From my experience with other issues the backup include/exclude
functionality<br />
versus the disk components include/exclude functionality in ReaR gets
"hairy"<br />
when it comes to unusual cases.</p>
<p>By default ReaR includes basically "what is mounted"<br />
while "rear mkrescue/mkbackup" is running<br />
except some automatically excluded things,<br />
cf.
<a href="https://github.com/rear/rear/issues/2229">https://github.com/rear/rear/issues/2229</a></p>
<p>Regarding the backup I implemented some time ago<br />
BACKUP_ONLY_INCLUDE and BACKUP_ONLY_EXCLUDE<br />
see its documentation in the default.conf file<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L999">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L999</a><br />
that should help to specify explicitly what gets included in the backup.</p>
<p>Note that things like BACKUP_ONLY_INCLUDE and BACKUP_ONLY_EXCLUDE<br />
and many other BACKUP_* variables only</p>
<pre><code>apply to all cases of internal Relax-and-Recover backup
</code></pre>
<p>see<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L893">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L893</a></p>
<p>Run <code>rear -D mkbackup</code> (-D is debugscript mode)<br />
and inspect the log file what exactly happens while<br />
usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh">https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh</a><br />
is running.<br />
That should (hopefully) show why a particular directory<br />
is automatically included in the backup,<br />
cf. the section "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Furthermore use <code>KEEP_BUILD_DIR="yes"</code> cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128</a><br />
so that you can after <code>rear mkbackup</code> inspect the contents of the files</p>
<pre><code>$TMPDIR/rear.XXXXXXXXXXXXXXX/tmp/backup-include.txt
$TMPDIR/rear.XXXXXXXXXXXXXXX/tmp/backup-exclude.txt
</code></pre>
<p>to see what directories are actually included and excluded in the
backup.</p>
<h4 id="gdha_commented_at_2019-10-21_1138"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544475400">2019-10-21 11:38</a>:<a class="headerlink" href="#gdha_commented_at_2019-10-21_1138" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88 were the s3 buckets mounted according article
<a href="https://tecadmin.net/mount-s3-bucket-centosrhel-ubuntu-using-s3fs/">https://tecadmin.net/mount-s3-bucket-centosrhel-ubuntu-using-s3fs/</a>
?<br />
If that is the case, then we can confirm that this is not (yet)
supported by ReaR. However, you are most welcome to prepare a PR for it
- we would really appreciate it.</p>
<h4 id="jsmeix_commented_at_2019-10-21_1141"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544476253">2019-10-21 11:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-21_1141" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
can we please have a complete <code>rear -D mkbackup</code> debug log file<br />
from your case where it errors out with</p>
<pre><code>2019-10-18 13:49:04.918909713 Creating tar archive '/tmp/rear.Azj8RJHxymh4LIx/tmp/isofs/backup/backup.tar.gz'
2019-10-18 14:04:08.976409464 ERROR:  failed with return code  and below output:
  ---snip---

  ----------
</code></pre>
<p>because the matching code in<br />
usr/share/rear/backup/NETFS/default/500_make_backup.sh<br />
is</p>
<pre><code>                rc=$(cat $FAILING_BACKUP_PROG_RC_FILE)
                Error "$prog failed with return code $rc and below output:
  ---snip---
$(grep "^$prog: " "${TMP_DIR}/${BACKUP_PROG_ARCHIVE}.log" | sed -e 's/^/  /' | tail -n3)
  ----------
</code></pre>
<p>but in your case both <code>cat $FAILING_BACKUP_PROG_RC_FILE</code><br />
and <code>grep '^tar: ' "${TMP_DIR}/${BACKUP_PROG_ARCHIVE}.log"</code><br />
result empty output which is not how things are expected to work.<br />
I would like to understand why in your case there is no such output.<br />
I guess your case is a special case where there is no such output<br />
but then we should be prepared for that case with reasonable<br />
fallback values to avoid such emptiness in the output.</p>
<h4 id="jsmeix_commented_at_2019-10-21_1159"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544481671">2019-10-21 11:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-21_1159" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
because<br />
<a href="https://tecadmin.net/mount-s3-bucket-centosrhel-ubuntu-using-s3fs/">https://tecadmin.net/mount-s3-bucket-centosrhel-ubuntu-using-s3fs/</a><br />
reads (excerpt)</p>
<pre><code>S3FS is FUSE (File System in User Space) based solution
to mount an Amazon S3 buckets
</code></pre>
<p>I wonder about if <code>rear mkbackup</code> could get in trouble<br />
in general when there are things mouned via FUSE?</p>
<h4 id="jacekadamus88_commented_at_2019-10-22_0051"><img src="https://avatars.githubusercontent.com/u/55064819?v=4" width="50"><a href="https://github.com/jacekadamus88">jacekadamus88</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544766719">2019-10-22 00:51</a>:<a class="headerlink" href="#jacekadamus88_commented_at_2019-10-22_0051" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I appreciate your detailed reply about <strong>ReaR</strong> configuration.<br />
<a href="https://github.com/rear/rear/issues/2258#issuecomment-544463123">Regarding your
reply</a></p>
<blockquote>
<p>By default ReaR has some automatism what disk components<br />
(like partitions, filesystems, mountpounts) get included or excluded<br />
and some (other but related) automatism what directories get<br />
included or excluded in the backup which do most of the time<br />
what is usually expected but no automatism works perfect.</p>
<p>From my experience with other issues the backup include/exclude
functionality<br />
versus the disk components include/exclude functionality in ReaR gets
"hairy"<br />
when it comes to unusual cases.</p>
<p>By default ReaR includes basically "what is mounted"<br />
while "rear mkrescue/mkbackup" is running<br />
except some automatically excluded things,<br />
cf. #2229</p>
<p>Regarding the backup I implemented some time ago<br />
BACKUP_ONLY_INCLUDE and BACKUP_ONLY_EXCLUDE</p>
</blockquote>
<p>I haven't tested this yet, but these two configuration parameters could
probably be considered the second workaround in this particular case.</p>
<p>I have recovered the system from the backup into the virtual machine and
run <code>rear -D mkbackup</code> as advised.<br />
Thankfully issue is reproducible after mounting s3fs.</p>
<pre><code>df -P -T /mnt/*
Filesystem     Type       1024-blocks  Used    Available Capacity Mounted on
s3fs           fuse.s3fs 274877906944     0 274877906944       0% /mnt/s3archive
s3fs           fuse.s3fs 274877906944     0 274877906944       0% /mnt/s3backups
</code></pre>
<p>Output from the execution (shrink)<br />
<a href="https://github.com/rear/rear/files/3753431/rear_debug_mode.txt">rear_debug_mode.txt</a></p>
<p>Additionally:<br />
backup-include.txt</p>
<pre><code>/home
/
/boot/efi
/boot
</code></pre>
<p>backup-exclude.txt</p>
<pre><code>/tmp/*
/dev/shm/*
/var/lib/rear/output/*
/media/*
/mnt/*
/var/tmp/*
/var/crash/*
/var/backup/*
/tmp/*
/tmp/rear.DoKltaTo385Ap5K
</code></pre>
<p>@gdha<br />
I believe, more or less to the mentioned article.<br />
These are exact commands i use to mount s3 buckets</p>
<pre><code>s3fs -o umask=0007,uid=0,gid=1008 -o allow_other aws-backups /mnt/s3backups
s3fs -o umask=0007,uid=0,gid=1008 -o allow_other aws-archive /mnt/s3archive
</code></pre>
<blockquote>
<p>I wonder about if rear mkbackup could get in trouble<br />
in general when there are things mouned via FUSE?</p>
</blockquote>
<p>I am afraid this is the case here, although the issue might be related
to one of the internally used commands (<strong>tar</strong>, <strong>dd</strong>)?</p>
<h4 id="jsmeix_commented_at_2019-10-22_0918"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-544875184">2019-10-22 09:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_0918" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
thank you for your prompt and detailed reply.</p>
<p>Regarding</p>
<pre><code>the issue might be related to one of the
internally used commands (tar, dd)?
</code></pre>
<p>ReaR calls <code>tar</code> with the <code>--one-file-system</code> option, see<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L136">https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L136</a><br />
for the whole <code>tar</code> command.</p>
<p>So you could try out how <code>tar</code> behaves in your particular case<br />
while you have things mounted via FUSE at some sub-directory of
<code>/mnt/</code><br />
when you try out things like</p>
<pre><code>tar -czvf /dev/null --no-wildcards-match-slash --one-file-system --anchored --exclude='/mnt/*' --exclude='/tmp/*' /  2&gt;&amp;1 | tee /tmp/tar.out
</code></pre>
<p>For me (on openSUSE Leap 15.0) that seems to work.<br />
For my test I use a sshfs mounted via FUSE (excerpts):</p>
<pre><code># pwd
/root

# mkdir ~/fusessh

# sshfs root@localhost:/tmp/ ~/fusessh
Password: ...

# mount | grep fuse
...
root@localhost:/tmp/ on /root/fusessh type fuse.sshfs (rw,nosuid,nodev,relatime,user_id=0,group_id=0)
...

# tar -czvf /dev/null --no-wildcards-match-slash --one-file-system --anchored /root/ 2&gt;&amp;1 | grep fuse
/root/fusessh/
tar: /root/fusessh/: file is on a different filesystem; not dumped
</code></pre>
<p>so for me <code>tar --one-file-system</code> excludes my sshfs mounted via FUSE.</p>
<h4 id="jacekadamus88_commented_at_2019-10-23_0043"><img src="https://avatars.githubusercontent.com/u/55064819?v=4" width="50"><a href="https://github.com/jacekadamus88">jacekadamus88</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-545214210">2019-10-23 00:43</a>:<a class="headerlink" href="#jacekadamus88_commented_at_2019-10-23_0043" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thank you for providing that tar command.<br />
<code>tar -czvf /dev/null --no-wildcards-match-slash --one-file-system --anchored --exclude='/mnt/*' --exclude='/tmp/*' /  2&gt;&amp;1 | tee /tmp/tar.out</code><br />
Seems like it executed successfully.</p>
<p>I have run <code>rear -v mkbackuponly</code> and still no success.</p>
<p>Since tar behaves properly, I would say the issue might be somewhere
within "exit code" logic. In order, to track it down probably some
500_make_backup.sh code changes are necessary.</p>
<h4 id="jsmeix_commented_at_2019-10-23_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-545376612">2019-10-23 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-23_1024" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
because your<br />
<a href="https://github.com/rear/rear/files/3753431/rear_debug_mode.txt">https://github.com/rear/rear/files/3753431/rear_debug_mode.txt</a><br />
contains only (excerpts)</p>
<pre><code>++ ProgressInfo 'Archived 12506 MiB [avg 5349 KiB/sec] '
++ echo -en '\e[2K\rArchived 12506 MiB [avg 5349 KiB/sec] \e7'
++ sleep 1
++ kill -0 14877
++ ProgressStop
++ echo -e '\e8\e[KOK'
++ transfertime=2395
++ wait 14877
++ backup_prog_rc=2
</code></pre>
<p>I also need your <code>backup.log</code> file which contains<br />
the debug output for the backup program subshell<br />
that is run by backup/NETFS/default/500_make_backup.sh</p>
<p>Usually the <code>backup.log</code> file is copied to your NETFS output location<br />
but you use <code>OUTPUT_URL=null</code>.<br />
The <code>backup.log</code> file ist is also available where <code>rear -D mkbackup</code> is
run<br />
there in <code>/tmp/rear.XXXXXXXX/tmp/backup.log</code><br />
provided you have <code>KEEP_BUILD_DIR="yes"</code> set,<br />
see the KEEP_BUILD_DIR description in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128</a></p>
<p>For example one of my <code>backup.log</code> files contains (excerpts)</p>
<pre><code>++ dd of=/tmp/rear.y426ClQIfRgufom/outputfs/linux-44ml/backup.tar.gz
+++ cat /tmp/rear.y426ClQIfRgufom/tmp/backup-include.txt
++ tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /tmp/rear.y426ClQIfRgufom/tmp/backup-exclude.txt -C / -c -f - / /root/rear.jsmeix/var/log/rear/rear-linux-44ml.log
tar: Removing leading `/' from member names
block 0: /
block 3: /etc/
block 6: /etc/fstab
...
block 6279792: /root/rear.jsmeix/var/log/rear/rear-linux-44ml.log
Total bytes written: 3215257600 (3.0GiB, 15MiB/s)
3390977+1 records in
3390977+1 records out
1736180480 bytes (1.7 GB, 1.6 GiB) copied, 217.798 s, 8.0 MB/s
++ pipes_rc=(${PIPESTATUS[@]})
++ let index=3-1
++ '[' 2 -ge 0 ']'
++ rc=0
++ '[' 0 -ne 0 ']'
++ let index--
++ '[' 1 -ge 0 ']'
++ rc=0
++ '[' 0 -ne 0 ']'
++ let index--
++ '[' 0 -ge 0 ']'
++ rc=0
++ '[' 0 -ne 0 ']'
++ let index--
++ '[' -1 -ge 0 ']'
++ exit 0
</code></pre>
<p>Additionally to better see how the <code>Exit code logic</code><br />
actually behaves in your case please insert in your<br />
usr/share/rear/backup/NETFS/default/500_make_backup.sh<br />
the line</p>
<pre><code>for e in "${pipes_rc[@]}" ; do echo "pipes_rc array element is '$e' " ; done
</code></pre>
<p>at</p>
<pre><code>  let index=${#pipes_rc[@]}-1
  for e in "${pipes_rc[@]}" ; do echo "pipes_rc array element is '$e' " ; done
  while [ $index -ge 0 ] ; do
</code></pre>
<p>and then provide your <code>backup.log</code> file<br />
for a `rear -D mkbackup' run that fails for you.</p>
<p>Furthermore you should inspect your <code>backup.log</code> file<br />
for suspicious (error) messages that my indicate<br />
why things fail in your particular case.</p>
<h4 id="jacekadamus88_commented_at_2019-10-24_2033"><img src="https://avatars.githubusercontent.com/u/55064819?v=4" width="50"><a href="https://github.com/jacekadamus88">jacekadamus88</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546091056">2019-10-24 20:33</a>:<a class="headerlink" href="#jacekadamus88_commented_at_2019-10-24_2033" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thank you for your next great reply</p>
<p>I have followed all suggested hints including <code>KEEP_BUILD_DIR="yes"</code> and
exit logic debug</p>
<pre><code>for e in "${pipes_rc[@]}" ; do echo "pipes_rc array element is '$e' " ; done
</code></pre>
<p>Looks like those things helped me to find out the real error being
thrown on that VM.<br />
It was simle</p>
<pre><code>No space left on device
</code></pre>
<p>I have recovered some space to accommodate the "build" directory and iso
image.<br />
And it went through.</p>
<p>The output from the backup.log</p>
<pre><code>Total bytes written: 28176240640 (27GiB, 11MiB/s)
23338923+1 records in
23338923+1 records out
11949529084 bytes (12 GB) copied, 2542.86 s, 4.7 MB/s
++ pipes_rc=(${PIPESTATUS[@]})
++ let index=2-1
++ for e in '"${pipes_rc[@]}"'
++ echo 'pipes_rc array element is '\''1'\'' '
++ for e in '"${pipes_rc[@]}"'
++ echo 'pipes_rc array element is '\''0'\'' '
++ '[' 1 -ge 0 ']'
++ rc=0
++ '[' 0 -ne 0 ']'
++ let index--
++ '[' 0 -ge 0 ']'
++ rc=1
++ '[' 1 -ne 0 ']'
++ echo tar
++ echo 1
++ '[' 1 -eq 1 ']'
++ '[' tar '!=' tar ']'
++ exit 1
</code></pre>
<p>Although this doesn't answer what was the root cause of the issue on the
Real server, however, space issues can be excluded from the list of
<em>unexpected</em> issues.</p>
<p>Currently, I am not able to kick off the backup on real server, however,
I will make use of the suggested hints to track it down there whenever
possible.</p>
<p>I claimed that the root cause of the issue is somewhere within Rear,
however, this is not true. Seems like ReaR does handle s3fs well (at
least it ignores it properly when configured to do so).</p>
<p>I believe we can close that issue.</p>
<p>I would like to thank @jsmeix for the pieces of advice, that helped me
to get to the bottom of the problem. Hopefully, anyone else struggling
with a similar problem will benefit from this conversation.</p>
<h4 id="jsmeix_commented_at_2019-10-25_0934"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546281119">2019-10-25 09:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_0934" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
thank you for your explanatory feedback.</p>
<p>As time permits I will try to reproduce it on my VMs<br />
because I would like to understand why such a hard error<br />
like "No space left on device" was somehow hidden<br />
so that 500_make_backup.sh failed inexplicably.</p>
<p>If I can reproduce it I wish I could get the root cause error message<br />
so that 500_make_backup.sh can show that error message to the user.</p>
<p>And this issue shows another problem in 500_make_backup.sh:</p>
<p>Parts of the <code>set -e</code> debug output are not in the usual log file<br />
but hidden in the separated <code>backup.log</code> file which is bad<br />
because we needed so much time and effort to find out<br />
where the root cause error actually is.<br />
The separated <code>backup.log</code> file contradicts</p>
<pre><code>All what could be useful for later debugging
in case of issues must appear in ReaR's log file.
</code></pre>
<p>in the section "What to do with stdin, stdout, and stderr" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>My immediate untested offhanded idea is to somehow get<br />
the <code>set -e</code> debug output of the backup subshell process<br />
also in the normal log file (in addition to the <code>backup.log</code> file).</p>
<p>Furthermore this issue may show a redirection problem<br />
in 500_make_backup.sh:</p>
<pre><code>(
case "$(basename ${BACKUP_PROG})" in
    ...
esac 2&gt; "${TMP_DIR}/${BACKUP_PROG_ARCHIVE}.log"
...
) &amp;
BackupPID=$!
</code></pre>
<p>Only stderr is redirected into the <code>backup.log</code> file<br />
but not also stdout as it should be normally done nowadays<br />
according to "What to do with stdin, stdout, and stderr" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
so stdout messages from the backup subshell would<br />
appear in the normal ReaR log file needlessly split apart<br />
matching stderr messages from the backup subshell.</p>
<p>Finally this issue shows one more problem in ReaR:</p>
<p>The <code>backup.log</code> file does not appear as the normal ReaR log file<br />
in var/log/rear locally on the system where 'rear mkbackup' was run<br />
at least not for me with</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL=nfs://your.NFS.server.IP/path/to/your/rear/backup
</code></pre>
<p>where the <code>backup.log</code> file only appears on my remote NFS share<br />
but not locally in var/log/rear.</p>
<h4 id="jsmeix_commented_at_2019-10-25_0935"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546281616">2019-10-25 09:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_0935" title="Permanent link">&para;</a></h4>
<p>The support question part of this issue is solved<br />
but the found minor bugs and needed enhancements<br />
keep this issue open.</p>
<h4 id="jsmeix_commented_at_2019-10-25_0940"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546283140">2019-10-25 09:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_0940" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
if you find futher issues in ReaR because of what still fails for you<br />
I would prefer if you open new separated GitHub issues<br />
each one for each separated issue in ReaR so that<br />
we can handle separated issues separatedly.</p>
<h4 id="pcahyna_commented_at_2019-10-25_1003"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546290888">2019-10-25 10:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-10-25_1003" title="Permanent link">&para;</a></h4>
<p>PR #1914 was supposed to fix error reporting from tar (e.g. in case of
no space left on device).</p>
<h4 id="jsmeix_commented_at_2019-10-25_1027"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546298752">2019-10-25 10:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1027" title="Permanent link">&para;</a></h4>
<p>Yes, I know,<br />
but it seems in this case the <code>tar</code> exit code is <code>1</code><br />
see "The output from the backup.log" in<br />
<a href="https://github.com/rear/rear/issues/2258#issuecomment-546091056">https://github.com/rear/rear/issues/2258#issuecomment-546091056</a><br />
which should output (excerpt)</p>
<pre><code>This means that files have been modified during the archiving
</code></pre>
<p>but that does not match the initial comment here<br />
<a href="https://github.com/rear/rear/issues/2258#issue-509086552">https://github.com/rear/rear/issues/2258#issue-509086552</a><br />
where the output is (excerpt)</p>
<pre><code>This means that the archiving process ended prematurely
</code></pre>
<p>which happens when exit code &gt; 1 according to the code<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L262">https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L262</a></p>
<p>Puzzling...</p>
<h4 id="jsmeix_commented_at_2019-10-25_1233"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546335320">2019-10-25 12:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1233" title="Permanent link">&para;</a></h4>
<p>I can reproduce it:</p>
<p>I use a virtual machine with a separated filesystem for /tmp<br />
that has 1GiB size which is too small to store the backup<br />
there via <code>BACKUP_URL=file:///tmp</code>.</p>
<p>I use in etc/rear/local.conf</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=file:///tmp
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
PROGRESS_MODE=plain
PROGRESS_WAIT_SECONDS=3
KEEP_BUILD_DIR="yes"
FIRMWARE_FILES=( no )
AUTOEXCLUDE_PATH=( /media /run /mnt /tmp )
</code></pre>
<p>I get no var/log/rear/backup.log file.<br />
I have only the one in /tmp/rear.XXXX/tmp<br />
I.e. without KEEP_BUILD_DIR="yes" I would have<br />
no backup.log file at all.</p>
<p>In my /tmp/rear.XXXX/tmp/backup.log there is (excerpts)</p>
<pre><code>...
++++ echo tar
+++ basename tar
++++ awk '{ print $1 }'
++++ echo '/usr/bin/openssl des3 -salt -k '
+++ basename /usr/bin/openssl
++++ awk '{ print $1 }'
++++ echo 'dd of=/tmp/linux-4lv0/backup.tar.gz'
+++ basename dd
...
++ dd of=/tmp/linux-4lv0/backup.tar.gz
+++ cat /tmp/rear.lwYlarbzswNQcsq/tmp/backup-include.txt
++ tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /tmp/rear.lwYlarbzswNQcsq/tmp/backup-exclude.txt -C / -c -f - / /home /root/rear.github.master/var/log/rear/rear-linux-4lv0.log
tar: Removing leading `/' from member names
block 0: /
block 3: /mnt/
...
block 1930133: /usr/lib/git/git-http-push
dd: writing to '/tmp/linux-4lv0/backup.tar.gz': No space left on device
750497+0 records in
750496+0 records out
384253952 bytes (384 MB, 366 MiB) copied, 51.0999 s, 7.5 MB/s
++ pipes_rc=(${PIPESTATUS[@]})
++ let index=2-1
++ '[' 1 -ge 0 ']'
++ rc=1
++ '[' 1 -ne 0 ']'
++ echo openssl
/root/rear.github.master/usr/share/rear/backup/NETFS/default/500_make_backup.sh: line 162: echo: write error: No space left on device
++ echo 1
/root/rear.github.master/usr/share/rear/backup/NETFS/default/500_make_backup.sh: line 163: echo: write error: No space left on device
++ '[' 1 -eq 1 ']'
++ '[' openssl '!=' tar ']'
++ rc=2
++ exit 2
</code></pre>
<p>In my var/log/rear/rear-linux-4lv0.log there is (excerpt):</p>
<pre><code>++ case "$(basename $BACKUP_PROG)" in
+++ basename tar
++ ((  2 != 0  ))
+++ cat /tmp/rear.lwYlarbzswNQcsq/tmp/failing_backup_prog
++ prog=
++ ((  2 == 1  ))
+++ cat /tmp/rear.lwYlarbzswNQcsq/tmp/failing_backup_prog_rc
++ rc=
+++ sed -e 's/^/  /'
+++ tail -n3
+++ grep '^: ' /tmp/rear.lwYlarbzswNQcsq/tmp/backup.log
++ Error ' failed with return code  and below output:
  ---snip---

  ----------
This means that the archiving process ended prematurely, or did
not even start. As a result it is unlikely you can recover this
system properly. Relax-and-Recover is therefore aborting execution.
'
</code></pre>
<p>The reason for the emptiness of exit code and<br />
backup program error message in the output<br />
is the emptiness of the files<br />
/tmp/rear.lwYlarbzswNQcsq/tmp/failing_backup_prog<br />
and<br />
/tmp/rear.lwYlarbzswNQcsq/tmp/failing_backup_prog_rc<br />
that should contain that info but cannot contain that info<br />
because those files cannot be written</p>
<pre><code>++ echo openssl
... echo: write error: No space left on device
++ echo 1
... echo: write error: No space left on device
</code></pre>
<p>This shows there is one more bug in 500_make_backup.sh<br />
that is related to the code</p>
<pre><code>        # Variable used to record the short name of piped commands in case of
        # error, e.g. ( "tar" "cat" "dd" ) in case of unencrypted and unsplit backup.
        backup_prog_shortnames=(
            "$(basename $(echo "$BACKUP_PROG" | awk '{ print $1 }'))"
            "$(basename $(echo "$BACKUP_PROG_CRYPT_OPTIONS" | awk '{ print $1 }'))"
            "$(basename $(echo "$SPLIT_COMMAND" | awk '{ print $1 }'))"
        )
</code></pre>
<p>that leads to</p>
<pre><code>backup_prog_shortnames[0]="tar"
backup_prog_shortnames[1]="openssl"
backup_prog_shortnames[2]="dd"
</code></pre>
<p>But <code>openssl</code> is not used in the backup pipe in my case<br />
because BACKUP_PROG_CRYPT_ENABLED is not true<br />
which leads to a wrong <code>echo openssl</code> instead of <code>echo dd</code><br />
for the failed program name in the backup pipe<br />
which would result a wrong $prog value for the code</p>
<pre><code>            else
                rc=$(cat $FAILING_BACKUP_PROG_RC_FILE)
                Error "$prog failed with return code $rc and below output:
  ---snip---
$(grep "^$prog: " "${TMP_DIR}/${BACKUP_PROG_ARCHIVE}.log" | sed -e 's/^/  /' | tail -n3)
  ----------
This means that the archiving process ended prematurely, or did
not even start. As a result it is unlikely you can recover this
system properly. Relax-and-Recover is therefore aborting execution.
"
            fi
</code></pre>
<p>This last found bug in 500_make_backup.sh is a result<br />
of my
<a href="https://github.com/rear/rear/pull/2156">https://github.com/rear/rear/pull/2156</a></p>
<h4 id="jsmeix_commented_at_2019-10-25_1236"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546336186">2019-10-25 12:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1236" title="Permanent link">&para;</a></h4>
<p>@jacekadamus88<br />
thank you for your issue report.<br />
It revealed several issues in
backup/NETFS/default/500_make_backup.sh<br />
and perhaps also in restore/NETFS/default/400_restore_backup.sh ...</p>
<h4 id="gdha_commented_at_2019-10-25_1249"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546340315">2019-10-25 12:49</a>:<a class="headerlink" href="#gdha_commented_at_2019-10-25_1249" title="Permanent link">&para;</a></h4>
<p>@jsmeix perhaps a simple trick like I used in
<a href="https://github.com/gdha/upgrade-ux/blob/master/opt/upgrade-ux/scripts/postexecute/default/96_call_for_action_after_preview.sh">https://github.com/gdha/upgrade-ux/blob/master/opt/upgrade-ux/scripts/postexecute/default/96_call_for_action_after_preview.sh</a>
would be sufficient? We should not try to do/foresee everything in ReaR.</p>
<h4 id="jsmeix_commented_at_2019-10-25_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546343183">2019-10-25 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1258" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
yes, we must not try to do/foresee everything in ReaR<br />
but we should be prepared for unexpected cases<br />
with a reasonable fallback behaviour, cf.<br />
<a href="https://github.com/rear/rear/issues/2258#issuecomment-544476253">https://github.com/rear/rear/issues/2258#issuecomment-544476253</a><br />
and "Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>So I will now try even harder to care about possible errors in<br />
NETFS 500_make_backup.sh and 400_restore_backup.sh<br />
;-)</p>
<h4 id="jsmeix_commented_at_2019-10-25_1301"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546344448">2019-10-25 13:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1301" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I think I will now really add a new section</p>
<pre><code>Beware of the emptiness!
</code></pre>
<p>to
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
cf.
<a href="https://github.com/rear/rear/issues/2220#issuecomment-527489396">https://github.com/rear/rear/issues/2220#issuecomment-527489396</a></p>
<h4 id="jsmeix_commented_at_2019-10-25_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546345451">2019-10-25 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1304" title="Permanent link">&para;</a></h4>
<p>FYI:<br />
Next week I am not in the office so I wish all of you<br />
a nice weekend, a relaxed working week, and one more nice weekend!</p>
<h4 id="jsmeix_commented_at_2019-10-25_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2258#issuecomment-546346114">2019-10-25 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-25_1306" title="Permanent link">&para;</a></h4>
<p>I close this issue because the found minor bugs<br />
and needed enhancements will be handled via<br />
<a href="https://github.com/rear/rear/issues/2265">https://github.com/rear/rear/issues/2265</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-10-18.2258.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
