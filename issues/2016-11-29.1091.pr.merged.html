<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1091 PR merged: Split restoreonly workflow from recover workflow - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1091 PR merged: Split restoreonly workflow from recover workflow";
        var mkdocs_page_input_path = "issues/2016-11-29.1091.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1091 PR merged: Split restoreonly workflow from recover workflow</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1091_pr_merged_split_restoreonly_workflow_from_recover_workflow"><a href="https://github.com/rear/rear/pull/1091">#1091 PR</a> <code>merged</code>: Split restoreonly workflow from recover workflow<a class="headerlink" href="#1091_pr_merged_split_restoreonly_workflow_from_recover_workflow" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2016-11-29_1608"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/1091">2016-11-29 16:08</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2016-11-29_1608" title="Permanent link">&para;</a></h4>
<p>Now there is a new restoreonly workflow<br />
that is a part of the (unchanged) recover workflow<br />
namely the part that does only restore a backup,<br />
see
<a href="https://github.com/rear/rear/issues/987">https://github.com/rear/rear/issues/987</a><br />
which is a prerequirement for<br />
<a href="https://github.com/rear/rear/issues/1088">https://github.com/rear/rear/issues/1088</a><br />
"support multiple backups".</p>
<h4 id="jsmeix_commented_at_2016-11-29_1616"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263616702">2016-11-29 16:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-29_1616" title="Permanent link">&para;</a></h4>
<p>If there are no furious objections I will merge it soon.</p>
<p>I tested that usual "rear mkbackup" and "rear recover"<br />
still work (at least for me).</p>
<h4 id="gdha_commented_at_2016-11-29_1626"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263619962">2016-11-29 16:26</a>:<a class="headerlink" href="#gdha_commented_at_2016-11-29_1626" title="Permanent link">&para;</a></h4>
<p>@jsmeix only merge it when you are 100% sure it won't break the
<strong>recover</strong> workflow.</p>
<h4 id="jsmeix_commented_at_2016-11-29_1632"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263621714">2016-11-29 16:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-29_1632" title="Permanent link">&para;</a></h4>
<p>There are two additional other workflows that are<br />
other parts of the (unchanged) recover workflow:<br />
layoutonly: recreate only the disk layout<br />
finalizeonly: only finalize the recovery</p>
<p>For me 'layoutonly' followed by 'restoreonly' seemd to work<br />
but the final 'finalizeonly' failed to install the bootloader.<br />
I.e. currently the recover workflow is not yet correctly<br />
split into separated sub-workflows.</p>
<p>What works for me is 'recover' which restores an initial<br />
backup of the basic system and installs the bootloader<br />
followed by 'restoreonly' that restores an additional backup.</p>
<p>One must use the new '-C' option to specify the right<br />
config files for 'recover' versus 'restoreonly'.</p>
<p>Here an example that had worked for me:</p>
<pre>
d25:~/rear # grep -v '^#' etc/rear/local.conf

OUTPUT=ISO
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"

d25:~/rear # grep -v '^#' etc/rear/base.conf  

this_file_name=$( basename ${BASH_SOURCE[0]} )
LOGFILE="$LOG_DIR/rear-$HOSTNAME-$WORKFLOW-${this_file_name%.*}.log"
BACKUP_PROG_EXCLUDE=( /root/* /home/* )
BACKUP_PROG_ARCHIVE="backup-${this_file_name%.*}"
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs

d25:~/rear # grep -v '^#' etc/rear/rest.conf 

this_file_name=$( basename ${BASH_SOURCE[0]} )
LOGFILE="$LOG_DIR/rear-$HOSTNAME-$WORKFLOW-${this_file_name%.*}.log"
BACKUP_ONLY_INCLUDE="yes"
BACKUP_PROG_INCLUDE=( /root/* /home/* )
BACKUP_PROG_ARCHIVE="backup-${this_file_name%.*}"
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs

d25:~/rear # usr/sbin/rear -C base -d -D mkbackup

Relax-and-Recover 1.19 / Git
Using log file: /root/rear/var/log/rear/rear-d25.log
Sourcing additional configuration file '/root/rear/etc/rear/base.conf'
Using backup archive 'backup-base.tar.gz'
Creating disk layout
Creating root filesystem layout
Copying logfile /root/rear/var/log/rear/rear-d25.log into initramfs as '/tmp/rear-d25-mkbackup-base-partial-2016-11-29T16:17:38+01:00.log'
Copying files and directories
Copying binaries and libraries
Copying kernel modules
Creating initramfs
Making ISO image
Wrote ISO image: /root/rear/var/lib/rear/output/rear-d25.iso (150M)
Copying resulting files to nfs location
Saving /root/rear/var/log/rear/rear-d25.log as rear-d25-mkbackup-base.log to network output location
Creating tar archive '/tmp/rear.5HVHqErloTlXdAE/outputfs/d25/backup-base.tar.gz'
Archived 1249 MiB [avg 8647 KiB/sec] OK
Archived 1249 MiB in 149 seconds [avg 8589 KiB/sec]
Saving /root/rear/var/log/rear/rear-d25.log as /root/rear/var/log/rear/rear-d25-mkbackup-base.log

d25:~/rear # usr/sbin/rear -C rest -d -D mkbackuponly

Relax-and-Recover 1.19 / Git
Using log file: /root/rear/var/log/rear/rear-d25.log
Sourcing additional configuration file '/root/rear/etc/rear/rest.conf'
Using backup archive 'backup-rest.tar.gz'
Creating disk layout
Creating tar archive '/tmp/rear.5UTB72OsoKkZkEB/outputfs/d25/backup-rest.tar.gz'
Archived 158 MiB [avg 23257 KiB/sec] OK
Archived 158 MiB in 8 seconds [avg 20350 KiB/sec]
Saving /root/rear/var/log/rear/rear-d25.log as /root/rear/var/log/rear/rear-d25-mkbackuponly-rest.log
</pre>

<p>That results on the NFS server those files:</p>
<pre>
README
VERSION
backup-base.log
backup-base.tar.gz
backup-rest.log
backup-rest.tar.gz
rear-d25-mkbackup-base.log
rear-d25.iso
</pre>

<p>The var/log/rear/rear-d25-mkbackuponly-rest.log<br />
is curently not yet copied to the NFS server.</p>
<p>The recovery looks like this:</p>
<pre>
RESCUE d25:~ # rear -C base -d -D recover

Relax-and-Recover 1.19 / Git
Using log file: /var/log/rear/rear-d25.log
Sourcing additional configuration file '/etc/rear/base.conf'
Running workflow recover within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
Started rpc.statd.
RPC status rpc.statd available.
Using backup archive 'backup-base.tar.gz'
NOTICE: Will do driver migration
Calculating backup archive size
Backup archive size is 1.3G     /tmp/rear.AXfryZMO4qR9DI4/outputfs/d25/backup-base.tar.gz (compressed)
Comparing disks.
Disk configuration is identical, proceeding with restore.
Start system layout restoration.
Creating partitions for disk /dev/sda (msdos)
Creating filesystem of type ext4 with mount point / on /dev/sda2.
Mounting filesystem /
Creating swap on /dev/sda1
Disk layout created.
Restoring from '/tmp/rear.AXfryZMO4qR9DI4/outputfs/d25/backup-base.tar.gz'...
Restored 2704 MiB [avg 76936 KiB/sec] OK
Restored 2704 MiB in 37 seconds [avg 74857 KiB/sec]
Restoring finished.
Restore the Mountpoints (with permissions) from /var/lib/rear/recovery/mountpoint_permissions
Installing GRUB2 boot loader
Finished recovering your system. You can explore it under '/mnt/local'.
Saving /var/log/rear/rear-d25.log as /var/log/rear/rear-d25-recover-base.log

RESCUE d25:~ # rear -C rest -d -D restoreonly
Relax-and-Recover 1.19 / Git
Using log file: /var/log/rear/rear-d25.log
Sourcing additional configuration file '/etc/rear/rest.conf'
Running workflow restoreonly within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
RPC status rpc.statd available.
Using backup archive 'backup-rest.tar.gz'
NOTICE: Will do driver migration
Calculating backup archive size
Backup archive size is 160M     /tmp/rear.XRRC8EHMewgstLn/outputfs/d25/backup-rest.tar.gz (compressed)
Restoring from '/tmp/rear.XRRC8EHMewgstLn/outputfs/d25/backup-rest.tar.gz'...
Restored 34 MiB [avg 17415 KiB/sec] OK
Restored 34 MiB in 3 seconds [avg 11610 KiB/sec]
Restoring finished.
Restore the Mountpoints (with permissions) from /var/lib/rear/recovery/mountpoint_permissions
Finished recovering your system. You can explore it under '/mnt/local'.
Saving /var/log/rear/rear-d25.log as /var/log/rear/rear-d25-restoreonly-rest.log

RESCUE d25:~ # reboot
umounting all filesystems
...
syncing disks... waiting 3 seconds before reboot
</pre>

<h4 id="jsmeix_commented_at_2016-11-29_1635"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263622600">2016-11-29 16:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-29_1635" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I cannot be 100% sure because I cannot test all and everything.</p>
<p>I really tried hard to implement all in an only-additional way<br />
(i.e. without changing any current behaviour).</p>
<p>But I am not a 100% perfect machine ;-)</p>
<h4 id="gdha_commented_at_2016-11-29_1643"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263625116">2016-11-29 16:43</a>:<a class="headerlink" href="#gdha_commented_at_2016-11-29_1643" title="Permanent link">&para;</a></h4>
<p>@jsmeix sure understood (nobody is prefect ;)<br />
Do I understand it correctly that the <em>restoreonly</em> is only useful when
we had a previous <em>mkbackuponly</em>?</p>
<h4 id="jsmeix_commented_at_2016-11-29_1658"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263630023">2016-11-29 16:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-29_1658" title="Permanent link">&para;</a></h4>
<p>Normally one or more restoreonly would match<br />
one or more previous mkbackuponly when it is used<br />
as I did above (i.e. for multiple backups).</p>
<p>But I intend that restoreonly should also be useful<br />
when it is used as described in<br />
<a href="https://github.com/rear/rear/issues/987">https://github.com/rear/rear/issues/987</a><br />
i.e. to recover a system from soft errors<br />
(like deleting all of /lib/) or in general when<br />
the disk layout is not damaged but one cannot<br />
restore the backup from within the running system.</p>
<h4 id="jsmeix_commented_at_2016-11-29_1728"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263638707">2016-11-29 17:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-29_1728" title="Permanent link">&para;</a></h4>
<p>The current restoreonly workflow does not yet work<br />
for the usecase as described in<br />
<a href="https://github.com/rear/rear/issues/987">https://github.com/rear/rear/issues/987</a><br />
because currently there is nothing mounted<br />
at /mnt/local.<br />
With manual mounting the right stuff at /mnt/local before<br />
the restoreonly workflow seems to work for me:</p>
<pre>
f231:~ # rm -rf /lib*

f231:~ # cat /etc/rear/local.conf
-bash: /usr/bin/cat: No such file or directory

f231:~ # reboot
-bash: /sbin/reboot: No such file or directory

f231:~ # init 6
-bash: /sbin/init: No such file or directory

I did a hard power off switch and
booted the local "Relax-and-Recover" GRUB entry
then in the recovery system I did:

RESCUE f231:~ # mount /dev/sda2 /mnt/local
RESCUE f231:~ # 
RESCUE f231:~ # mount | grep sd
/dev/sda2 on /mnt/local type ext4 (rw,relatime,data=ordered)
RESCUE f231:~ # 
RESCUE f231:~ # rear -d -D restoreonly
Relax-and-Recover 1.19 / Git
Using log file: /var/log/rear/rear-f231.log
Running workflow restoreonly within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
Started rpc.statd.
RPC status rpc.statd available.
Using backup archive 'backup.tar.gz'
NOTICE: Will do driver migration
Calculating backup archive size
Backup archive size is 1.2G     /tmp/rear.VSrN7cjHqW8Hggh/outputfs/f231/backup.tar.gz (compressed)
Restoring from '/tmp/rear.VSrN7cjHqW8Hggh/outputfs/f231/backup.tar.gz'...
Restored 2406 MiB [avg 60097 KiB/sec] OK
Restored 2406 MiB in 42 seconds [avg 58666 KiB/sec]
Restoring finished.
Restore the Mountpoints (with permissions) from /var/lib/rear/recovery/mountpoint_permissions
Finished recovering your system. You can explore it under '/mnt/local'.

RESCUE f231:~ # find /mnt/local/lib* | wc -l
4131

RESCUE f231:~ # reboot
umounting all filesystems
...

I booted the original system entry in GRUB
and I am back to normal operation:

f231:~ # mount | grep sda
/dev/sda2 on / type ext4 (rw,relatime,data=ordered)

f231:~ # grep -v '^#' /etc/rear/local.conf
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
KEEP_BUILD_DIR=""
GRUB_RESCUE="yes"
</pre>

<h4 id="jsmeix_commented_at_2016-11-30_0901"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263819084">2016-11-30 09:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-30_0901" title="Permanent link">&para;</a></h4>
<p>Slept over it for one night,<br />
still no dark foreboding,<br />
I think I merge it today.</p>
<p>Of course its current state is only an initial step<br />
but I think it is a first step into the right direction<br />
that should be in GitHub master code so that also<br />
others can easily try it out and report shortcomings<br />
or even regressions that I overlooked so that I could<br />
get things fixed before the official ReaR 2.0 release.</p>
<h4 id="jsmeix_commented_at_2016-11-30_0904"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1091#issuecomment-263819775">2016-11-30 09:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-11-30_0904" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/1091#issuecomment-263638707">https://github.com/rear/rear/pull/1091#issuecomment-263638707</a></p>
<p>The current restoreonly workflow implements<br />
only what its name tells (strictly speaking):<br />
Currently it only restores - nothing more.</p>
<p>I.e. the current restoreonly workflow does not implement<br />
<a href="https://github.com/rear/rear/issues/987">https://github.com/rear/rear/issues/987</a>
cf.<br />
<a href="https://github.com/rear/rear/issues/987#issue-173428037">https://github.com/rear/rear/issues/987#issue-173428037</a></p>
<pre>
What is needed to recover from such soft errors is
to get the tree of filesystems mounted at /mnt/local
and then restore the backup therein.
</pre>

<p>The "get the tree of filesystems mounted at /mnt/local" part<br />
is currently missing - and as far as I see - that part will get<br />
really complicated.</p>
<p>Reason:</p>
<p>Currently - as far as I know - mounting the tree of filesystems<br />
at /mnt/local happens somewhat intermixed with recreating<br />
the layout which is - as far as I see - basically a broken design<br />
in the current "rear recover" implementation.</p>
<p>As far as I know the current "rear recover" implementation<br />
works disk-device by disk-device and for each one it does<br />
partitioning, making filesystem(s), and mounting it/them.</p>
<p>As far as I can imagine this way leads to (currently unsolvable)<br />
issues with "interwoven mounts", cf.<br />
<a href="https://github.com/rear/rear/commit/548965e045ac33c8aa02d5d284d590e7c0846ac9">https://github.com/rear/rear/commit/548965e045ac33c8aa02d5d284d590e7c0846ac9</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/497#issuecomment-67485838">https://github.com/rear/rear/issues/497#issuecomment-67485838</a><br />
and<br />
<a href="https://bugzilla.opensuse.org/show_bug.cgi?id=908854#c3">https://bugzilla.opensuse.org/show_bug.cgi?id=908854#c3</a></p>
<p>A clean design would split the recreating layout part into<br />
separated sub-parts and it would do each sub-part for<br />
all used device nodes and/or filesystem-like thingies:</p>
<ol>
<li></li>
</ol>
<p>Clean up all used disk devices<br />
cf.
<a href="https://github.com/rear/rear/issues/799">https://github.com/rear/rear/issues/799</a></p>
<ol>
<li></li>
</ol>
<p>Create lower level block devices (i.e. partitions)<br />
on all used disk devices (i.e. run parted)</p>
<ol>
<li></li>
</ol>
<p>Create higher level block devices (e.g. LVM)</p>
<ol>
<li></li>
</ol>
<p>Create filesystems on the right block devices<br />
(i.e. run mkfs.*)</p>
<ol>
<li></li>
</ol>
<p>Create btrfs subvolumes (if needed)</p>
<ol>
<li></li>
</ol>
<p>Mounting of filesystems and/or btrfs subvolumes<br />
to create the target tree of filesystem-like thingies<br />
below /mnt/local</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-11-29.1091.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
