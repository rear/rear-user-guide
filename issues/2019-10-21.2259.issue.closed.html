<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2259 Issue closed: Recover fails to recreate LVM (lvmvol entries missing in disklayout.conf with older LVM that does not support 'pool_lv' et al.) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2259 Issue closed: Recover fails to recreate LVM (lvmvol entries missing in disklayout.conf with older LVM that does not support \u0027pool_lv\u0027 et al.)";
        var mkdocs_page_input_path = "issues/2019-10-21.2259.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2259 Issue closed: Recover fails to recreate LVM (lvmvol entries missing in disklayout.conf with older LVM that does not support 'pool_lv' et al.)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2259_issue_closed_recover_fails_to_recreate_lvm_lvmvol_entries_missing_in_disklayoutconf_with_older_lvm_that_does_not_support_pool_lv_et_al"><a href="https://github.com/rear/rear/issues/2259">#2259 Issue</a> <code>closed</code>: Recover fails to recreate LVM (lvmvol entries missing in disklayout.conf with older LVM that does not support 'pool_lv' et al.)<a class="headerlink" href="#2259_issue_closed_recover_fails_to_recreate_lvm_lvmvol_entries_missing_in_disklayoutconf_with_older_lvm_that_does_not_support_pool_lv_et_al" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>documentation</code>, <code>cleanup</code>,
<code>fixed / solved / done</code></p>
<h4 id="abbbi_opened_issue_at_2019-10-21_1442"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> opened issue at <a href="https://github.com/rear/rear/issues/2259">2019-10-21 14:42</a>:<a class="headerlink" href="#abbbi_opened_issue_at_2019-10-21_1442" title="Permanent link">&para;</a></h4>
<p>Trying to recover a SLES12 based system with MDADM RAID1 and identical
disk layout results in basically no MDADM raid or any partition/fs to be
created. I tried with identical disk size and slightly bigger disks.</p>
<p>Im not quite sure where the issue is here, the recovery fails with:</p>
<p><em>No code has been generated to recreate fs:/usr (fs)</em></p>
<p>but it does not attempt to create any of the partitions or mdadm raid
settings. I tried with REAR 2.4 and REAR 2.5, and recent GIT checkout,
is there anything im missing?</p>
<p>Complete recover log and layout in:</p>
<p><a href="http://grinser.de/~abi/layout.tar.gz">http://grinser.de/~abi/layout.tar.gz</a></p>
<blockquote>
<p>UserInput: Valid choice number result 'Confirm disk mapping and
continue 'rear recover''<br />
User confirmed disk mapping<br />
Applied disk layout mappings to /var/lib/rear/layout/disklayout.conf<br />
Applied disk layout mappings to /var/lib/rear/layout/config/df.txt<br />
Applied disk layout mappings to /etc/rear/rescue.conf<br />
Examining msdos disk /dev/sda to automatically resize its last active
partition<br />
Checking /dev/sda1 if it is the last partition on /dev/sda<br />
Checking /dev/sda2 if it is the last partition on /dev/sda<br />
Checking /dev/sda3 if it is the last partition on /dev/sda<br />
Found 'primary' partition /dev/sda3 as last partition on /dev/sda<br />
Determining if last partition /dev/sda3 is resizeable<br />
Determining new size for last partition /dev/sda3<br />
Determining if last partition /dev/sda3 actually needs to be increased
or shrinked<br />
New /dev/sda is 111384567808 bytes bigger than old disk<br />
Skip increasing last partition /dev/sda3 (new disk less than 10%
bigger)<br />
Examining msdos disk /dev/sdb to automatically resize its last active
partition<br />
Checking /dev/sdb1 if it is the last partition on /dev/sdb<br />
Checking /dev/sdb2 if it is the last partition on /dev/sdb<br />
Checking /dev/sdb3 if it is the last partition on /dev/sdb<br />
Found 'primary' partition /dev/sdb3 as last partition on /dev/sdb<br />
Determining if last partition /dev/sdb3 is resizeable<br />
Determining new size for last partition /dev/sdb3<br />
Determining if last partition /dev/sdb3 actually needs to be increased
or shrinked<br />
New /dev/sdb is 111384567808 bytes bigger than old disk<br />
Skip increasing last partition /dev/sdb3 (new disk less than 10%
bigger)<br />
UserInput -I LAYOUT_FILE_CONFIRMATION needed in
/usr/share/rear/layout/prepare/default/500_confirm_layout_file.sh
line 26<br />
Confirm or edit the disk layout file</p>
<ol>
<li>Confirm disk layout and continue 'rear recover'</li>
<li>Edit disk layout (/var/lib/rear/layout/disklayout.conf)</li>
<li>View disk layout (/var/lib/rear/layout/disklayout.conf)</li>
<li>View original disk space usage
    (/var/lib/rear/layout/config/df.txt)</li>
<li>Use Relax-and-Recover shell and return back to here</li>
<li>Abort 'rear recover'<br />
    (default '1' timeout 300 seconds)<br />
    1<br />
    UserInput: Valid choice number result 'Confirm disk layout and
    continue 'rear recover''<br />
    User confirmed disk layout file<br />
    No code has been generated to recreate fs:/usr (fs).<br />
    To recreate it manually add code to
    /var/lib/rear/layout/diskrestore.sh or abort.<br />
    UserInput -I ADD_CODE_TO_RECREATE_MISSING_FSUSRFS needed in
    /usr/share/rear/layout/prepare/default/600_show_unprocessed.sh
    line 33<br />
    Manually add code that recreates fs:/usr (fs)</li>
<li>View /var/lib/rear/layout/diskrestore.sh</li>
<li>Edit /var/lib/rear/layout/diskrestore.sh</li>
<li>Go to Relax-and-Recover shell</li>
<li>Continue 'rear recover'</li>
<li>Abort 'rear recover'<br />
    (default '4' timeout 300 seconds)</li>
</ol>
</blockquote>
<h4 id="abbbi_commented_at_2019-10-21_1457"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544554190">2019-10-21 14:57</a>:<a class="headerlink" href="#abbbi_commented_at_2019-10-21_1457" title="Permanent link">&para;</a></h4>
<p>As a side note; i also tried with</p>
<p><em>export MIGRATION_MODE='true'</em></p>
<p>which results in the same situation.<br />
As i see it there is the root filesystem on /dev/md1, and the rest of
the filesystems of the system are<br />
placed on LVM volumes on another raid device.</p>
<p>It seems to me the recovery script stops after the first filesystem, as
the created diskrestore.sh only creates code for this Filesystem to be
created. All others are missing from diskrestore.sh.</p>
<p>From the log it can be seen that create_fs is only called once during
recovery, for the / file system:</p>
<p><em>Begin create_fs ( fs:/ )</em></p>
<p>all others are, for some reason, skipped:</p>
<blockquote>
<p>grep "create_fs" recover.log<br />
++ type -t create_fs<br />
++ create_fs fs:/<br />
++ Log 'Begin create_fs( fs:/ )'<br />
++ echo '2019-10-21 16:39:09.488672395 Begin create_fs( fs:/ )'<br />
2019-10-21 16:39:09.488672395 Begin create_fs( fs:/ )<br />
++ Log 'End create_fs( fs:/ )'<br />
++ echo '2019-10-21 16:39:09.498287615 End create_fs( fs:/ )'<br />
2019-10-21 16:39:09.498287615 End create_fs( fs:/ )</p>
</blockquote>
<h4 id="jsmeix_commented_at_2019-10-22_0801"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544848531">2019-10-22 08:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_0801" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
without your complete <code>rear -D recover</code> debug log file<br />
(ideally together with your diskrestore.sh file)<br />
there is basically nothing what I could tell right now.</p>
<p>I would need much more time to reproduce it<br />
because I would need to set up a test system<br />
with a similar disk layout as yours.</p>
<p>I can hardly imagine from plain looking at your disklayout.conf file<br />
how things would work during <code>rear recover</code> in your particular case<br />
because I am not a regular RAID and/or LVM user.</p>
<p>What looks unexpected to me (as neither a RAID nor a LVM expert)<br />
in your disklayout.conf file is that it does not contain <code>lvmvol</code>
entries<br />
according to what I read in the section "Disk layout file syntax" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
which tells about three kind of LVM related entries in disklayout.conf</p>
<pre><code>Physical Volumes
lvmdev ...

Volume Groups
lvmgrp ...

Logical Volumes
lvmvol ...
</code></pre>
<p>so that I would normally expect <code>lvmvol</code> entries in the disklayout.conf
file<br />
as shown in the disklayout.conf file example in the section<br />
"Layout information gathered during rescue image creation" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<p>But in your disklayout.conf file there is only <code>lvmdev</code><br />
and <code>lvmgrp</code> but no <code>lvmvol</code> so I would expect that<br />
no logical volumes can be re-created which looks like the reason<br />
why subsequently no filesystems on LVM can be created.</p>
<p>If my above analysis is right, I would also need<br />
your complete <code>rear -D mkrescue/mkbackup</code> debug log file<br />
to have a chance to find the root cause (i.e. the reason why<br />
there are no <code>lvmvol</code> entries in your disklayout.conf file).</p>
<p>See the item</p>
<pre><code>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover" debug log files)
</code></pre>
<p>in
<a href="https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md">https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md</a><br />
and see "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="abbbi_commented_at_2019-10-22_1327"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544961204">2019-10-22 13:27</a>:<a class="headerlink" href="#abbbi_commented_at_2019-10-22_1327" title="Permanent link">&para;</a></h4>
<p>Ah, i think the problem is with lvs parameters, it can be seen that
during the mkrescue following command is called, that creates the help
output, instead an correct information to create the<br />
disk layout.</p>
<pre><code>++ lvm lvs --separator=: --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,modules,pool_lv,chunk_size,stripes
++ read line
  Logical Volume Fields
  ---------------------
    lv_all               - All fields in this section.
    lv_uuid              - Unique identifier.
    lv_name              - Name.  LVs created for internal use are enclosed in brackets.
    lv_path              - Full pathname for LV.
</code></pre>
<p>Error is:</p>
<p><em>Unrecognised field: pool_lv</em></p>
<p>I can confirm that after changing</p>
<p><em>/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh</em></p>
<p>and removing the pool_lv options, my generated disklayout.conf does
include all needed lvm volumes.<br />
But it seems that the missing pool_lv value may result in other issues,
as disklayout.conf now references /dev/mapper/* devices for the
filesystems, which then are not correctly mapped during<br />
recovery (No code has been generated to recreate /dev/mapper/vg00-home
(lvmvol).)</p>
<pre><code>lvmvol /dev/vg00 home 4294967296b linear thinpool:0 chunksize:1b stripesize:4294967296b
lvmvol /dev/vg00 srv 268435456000b linear thinpool:0 chunksize:1b stripesize:4294967296b
 [..]
fs /dev/mapper/vg00-usr /usr ext4 uuid=8a2c2ab9-89f4-4796-8cb5-d4395c7d4494 label=usr blocksize=4096 reserved_blocks=4% max_mounts=34 check_interval=150d bytes_per_inode=16384 options=rw,relatime,user_xattr,acl,barrier=1,data=ordered
</code></pre>
<p>log with -D (without any changes done to rear GIT)</p>
<p><a href="http://www.grinser.de/~abi/mkrescue.log">http://www.grinser.de/~abi/mkrescue.log</a></p>
<h4 id="jsmeix_commented_at_2019-10-22_1410"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544981877">2019-10-22 14:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_1410" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
thank you for your debugging and your prompt response.</p>
<p>According to</p>
<pre><code># find usr/share/rear -name '*.sh' | xargs grep -l 'pool_lv'

usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
</code></pre>
<p>the only script that contains <code>pool_lv</code> is<br />
usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh<br />
and according to the output of</p>
<pre><code># git log -p --follow usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
</code></pre>
<p>the first time when <code>pool_lv</code> appears in that output is (excerpts)</p>
<pre><code>commit b184194f37dd22a7e55655ff388579297239e73c
...
+    lvm 8&gt;&amp;- 7&gt;&amp;- lvs --separator=":" --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,lv_layout,pool_lv,chunk_size,stripes | while read line ; do
</code></pre>
<p>which is<br />
<a href="https://github.com/rear/rear/commit/b184194f37dd22a7e55655ff388579297239e73c">https://github.com/rear/rear/commit/b184194f37dd22a7e55655ff388579297239e73c</a><br />
that points to<br />
<a href="https://github.com/rear/rear/issues/1380">https://github.com/rear/rear/issues/1380</a><br />
so it seems this issue here is just one additional chapter<br />
in the never ending LVM Thin Pool/Volume story...</p>
<h4 id="jsmeix_commented_at_2019-10-22_1413"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544983184">2019-10-22 14:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_1413" title="Permanent link">&para;</a></h4>
<p>@rmetrich @pcahyna<br />
could you please have a look here because recently<br />
you had worked on the LVM related code in ReaR.<br />
Many thanks in advance!</p>
<h4 id="abbbi_commented_at_2019-10-22_1418"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544985471">2019-10-22 14:18</a>:<a class="headerlink" href="#abbbi_commented_at_2019-10-22_1418" title="Permanent link">&para;</a></h4>
<p>hi!</p>
<p>thanks for YOUR response in the first place. I went back to commit
e4eb0e1786d0346adea0383f02fdea18e7c799a9 and re-created an iso image,
which then results in REAR doing a correct recovery:</p>
<pre><code>Start system layout restoration.
Creating partitions for disk /dev/sda (msdos)
Creating partitions for disk /dev/sdb (msdos)
Creating software RAID /dev/md1
Creating software RAID /dev/md3
Creating LVM PV /dev/md3
Creating LVM VG vg00
Creating LVM volume vg00/usr
Creating LVM volume vg00/var
Creating LVM volume vg00/home
Creating LVM volume vg00/srv
Creating filesystem of type ext3 with mount point / on /dev/md1.
Mounting filesystem /
Creating filesystem of type ext4 with mount point /usr on /dev/mapper/vg00-usr.
Mounting filesystem /usr
Creating filesystem of type ext4 with mount point /home on /dev/mapper/vg00-home.
Mounting filesystem /home
Creating filesystem of type ext4 with mount point /srv on /dev/mapper/vg00-srv.
</code></pre>
<h4 id="jsmeix_commented_at_2019-10-22_1425"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544988871">2019-10-22 14:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_1425" title="Permanent link">&para;</a></h4>
<p>When I use the <code>git blame</code> view of
layout/save/GNU/Linux/220_lvm_layout.sh<br />
<a href="https://github.com/rear/rear/blame/b184194f37dd22a7e55655ff388579297239e73c/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh">https://github.com/rear/rear/blame/b184194f37dd22a7e55655ff388579297239e73c/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh</a><br />
that matches the commit b184194f37dd22a7e55655ff388579297239e73c<br />
where <code>pool_lv</code> was introduced and therein I go back<br />
to one commit before by clicking on the small symbol next to the top
line<br />
of the code block that contains the change where <code>pool_lv</code> was added<br />
(that symbol shows the mouse-over text
<code>View blame prior to this change</code>)<br />
I get<br />
<a href="https://github.com/rear/rear/blame/e4eb0e1786d0346adea0383f02fdea18e7c799a9/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh">https://github.com/rear/rear/blame/e4eb0e1786d0346adea0383f02fdea18e7c799a9/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh</a><br />
which matches the commit that also @abbbi had found.</p>
<p>I guess in layout/save/GNU/Linux/220_lvm_layout.sh<br />
the code in the fallback case for older LVM versions</p>
<pre><code>    else
        # Compatibility with older LVM versions (e.g. &lt;= 2.02.98)
        # No support for 'lv_layout', too bad, do our best!
</code></pre>
<p>needs to be adapted.</p>
<h4 id="jsmeix_commented_at_2019-10-22_1447"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-544999137">2019-10-22 14:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-22_1447" title="Permanent link">&para;</a></h4>
<p>@rmetrich @pcahyna<br />
while you are at it:</p>
<p>I wonder about the strange looking way how <code>lvm</code> is called</p>
<pre><code>lvm 8&gt;&amp;- 7&gt;&amp;- ...
</code></pre>
<p>that goes back to<br />
<a href="https://github.com/rear/rear/commit/b383dcda0e37f85e45a57c43d7fa92f79ce8910e">https://github.com/rear/rear/commit/b383dcda0e37f85e45a57c43d7fa92f79ce8910e</a><br />
see the "use file descriptor 7 for real STDOUT so th.." changes in<br />
<a href="https://github.com/rear/rear/blame/e4eb0e1786d0346adea0383f02fdea18e7c799a9/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh">https://github.com/rear/rear/blame/e4eb0e1786d0346adea0383f02fdea18e7c799a9/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh</a></p>
<p>I wonder why fd7 and fd8 need to be closed for the <code>lvm</code> commands<br />
because in a usual pipe like <code>COMMAND1 | COMMAND2</code><br />
stdin of COMMAND2 is set to stdout of COMMAND1<br />
and other fds like fd7 and fd8 should not matter at all.</p>
<p>So - if you agree - I would like to get rid of that <code>8&gt;&amp;- 7&gt;&amp;-</code><br />
and just use an usual pipe</p>
<pre><code>   lvm ... | while read line ; do
</code></pre>
<h4 id="jsmeix_commented_at_2019-11-15_1303"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-554350909">2019-11-15 13:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-15_1303" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
there are SLE12 systems where the <code>lvm</code> command supports <code>pool_lv</code><br />
so your particular case seems to be an exceptional case.</p>
<p>A colleague at SUSE tried to reproduce the issue<br />
but on his SLES12-SP2 system things worked.</p>
<p>Here what he reports:</p>
<pre><code>LVM commands during recover:

&gt; # grep '^+* lvm ' /var/log/rear/recover/rear-linux-4qvu.log 
&gt; +++ lvm version
&gt; +++ lvm vgchange -a n
&gt; +++ lvm vgchange -a n system
&gt; +++ lvm pvcreate -ff --yes -v --uuid X9rQQ7-rnfM-i1zl-rnFm-Amji-Vo6w-2J2aKs --restorefile /var/lib/rear/layout/lvm/system.cfg /dev/mapper/0QEMU_QEMU_HARDDISK_0001-part2
&gt; +++ lvm vgcfgrestore -f /var/lib/rear/layout/lvm/system.cfg system
&gt; +++ lvm vgchange --available y system

LVM commands during mkbackup:

# grep '^+* lvm ' /var/log/rear/rear-linux-4qvu.log
++ lvm pvdisplay -c
++ lvm vgdisplay -c
++ lvm lvs -o lv_layout
++ lvm lvs --separator=: --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,lv_layout,pool_lv,chunk_size,stripes,stripe_size
++ lvm vgcfgbackup -f /var/lib/rear/layout/lvm/%s.cfg

The mkbackup operation invoked an lvm command with "pool_lv"
but it was successful. The mkbackup log shows:

&gt; ++ lvm lvs --separator=: --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,lv_layout,pool_lv,chunk_size,stripes,stripe_size
&gt; ++ read line
&gt; ++ '[' 0 -eq 0 ']'
&gt; ++ echo '# Format for LVM LVs'
&gt; ++ echo '# lvmvol &lt;volume_group&gt; &lt;name&gt; &lt;size(bytes)&gt; &lt;layout&gt; [key:value ...]'
&gt; ++ header_printed=1
&gt; +++ awk -F : '{ print $1 }'
&gt; +++ echo :root:system:17003708416:linear::0:1:0

Running the command outside of ReaR (directly in terminal):

&gt; # lvm lvs --separator=: --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,lv_layout,pool_lv,chunk_size,stripes,stripe_size
&gt;   :root:system:17003708416:linear::0:1:0
</code></pre>
<p>FYI<br />
what LVM versions we provide in SLE12 in its various service packs:</p>
<pre><code>SLE-12 GA: LVM2.2.02.98

SLE-12 SP1 SP2 SP3: LVM2.2.02.120

SLE-12 SP4: LVM2.2.02.180
</code></pre>
<p>@abbbi<br />
perhaps you do not use an up-to-date LVM version?</p>
<h4 id="abbbi_commented_at_2019-11-19_1751"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-555627642">2019-11-19 17:51</a>:<a class="headerlink" href="#abbbi_commented_at_2019-11-19_1751" title="Permanent link">&para;</a></h4>
<p>hi,<br />
sorry apparently this seems to be an opensuse:</p>
<pre><code>:~ # lsb_release -a
LSB Version:    n/a
Distributor ID: SUSE LINUX
Description:    openSUSE 12.1 (x86_64)
Release:        12.1
Codename:       Asparagus

:~ # rpm -qa | grep lvm
lvm2-2.02.84-19.8.1.x86_64
</code></pre>
<h4 id="jsmeix_commented_at_2019-11-21_0956"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-557008397">2019-11-21 09:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-21_0956" title="Permanent link">&para;</a></h4>
<p>I am not at all a LVM expert but<br />
I found a command that collects the supported LVM <code>lvs</code> fields</p>
<pre><code>lvs_supported_fields=( $( lvs -o help 2&gt;&amp;1 | cut -s -d '-' -f 1 ) )
</code></pre>
<p>which works for me both on SLES11-SP4 with lvm2-2.02.98<br />
and on openSUSE Leap 15.0 with lvm2-2.02.177.</p>
<p>Perhaps it is possible with reasonable effort to enhance the code<br />
so that only those LVM fileds are used that are actually supported.</p>
<h4 id="jsmeix_commented_at_2019-11-21_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-557019729">2019-11-21 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-11-21_1024" title="Permanent link">&para;</a></h4>
<p>The following seems to work for me:</p>
<pre><code>logical_volumes="$( lvs --separator=/ --noheadings --nosuffix -o vg_name,lv_name )"

lvs_supported_fields=( $( lvs -o help 2&gt;&amp;1 | cut -s -d '-' -f 1 ) )
lvs_fields="origin lv_size lv_layout pool_lv chunk_size stripes stripe_size"

for lvs_field in $lvs_fields ; do
    for lvs_supported_field in "${lvs_supported_fields[@]}" ; do
        test "$lvs_supported_field" = "$lvs_field" || continue
        lvs_variable_name="lvs_$lvs_field"
        for logical_volume in $logical_volumes ; do
            declare $lvs_variable_name="$( echo $( lvs --noheadings --units b --nosuffix -o $lvs_field $logical_volume ) )"
            echo "$lvs_field for $logical_volume has value: '${!lvs_variable_name}'"
        done
    done
done
</code></pre>
<p>The crazy <code>$( echo $( lvs ...</code> is there to get rid of<br />
various whitespace charactes that <code>lvs</code> has in its output.</p>
<p>On SLE-12 SP4 with lvm2-2.02.180 it results</p>
<pre><code>origin for system/root has value: ''
origin for system/swap has value: ''
lv_size for system/root has value: '19927138304'
lv_size for system/swap has value: '1535115264'
lv_layout for system/root has value: 'linear'
lv_layout for system/swap has value: 'linear'
pool_lv for system/root has value: ''
pool_lv for system/swap has value: ''
chunk_size for system/root has value: '0'
chunk_size for system/swap has value: '0'
stripes for system/root has value: '1'
stripes for system/swap has value: '1'
stripe_size for system/root has value: '0'
stripe_size for system/swap has value: '0'
</code></pre>
<h4 id="jsmeix_commented_at_2019-12-13_1254"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2259#issuecomment-565431370">2019-12-13 12:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-12-13_1254" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2291">https://github.com/rear/rear/pull/2291</a>
merged<br />
this issue is now avoided because now it errors out<br />
in layout/save/GNU/Linux/220_lvm_layout.sh<br />
during "rear mkrescue" in case of insufficient LVM tools<br />
and in layout/save/default/950_verify_disklayout_file.sh<br />
a simple test was added to verify that the 'lvm...' entries<br />
in disklayout.conf look syntactically correct.</p>
<p>On the other hand this means that ReaR does no longer<br />
support Linux distributions where too old LVM tools are used<br />
that do not support the needed options of the "lvm ..." calls<br />
in layout/save/GNU/Linux/220_lvm_layout.sh</p>
<p>According to<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a></p>
<pre><code>ReaR-2.5 is supported on the following Linux based
operating systems:

  o Fedora 28 and 29
  o RHEL 5, 6 and 7
  o CentOS 5, 6 and 7
  o ScientificLinux 6 and 7
  o SLES 11, 12 and 15
  o openSUSE Leap and openSUSE Tumbleweed
  o Debian 6, 7, 8 and 9
  o Ubuntu 12, 14, 16, 17 and 18

ReaR-2.5 dropped official support for the following
Linux based operating systems:

  o Fedora &lt; 28
  o RHEL 3 and 4
  o SLES 9 and 10
  o openSUSE &lt;= 13
  o Debian &lt; 6
  o Ubuntu &lt; 12
</code></pre>
<p>openSUSE 12.1 is already documented to be no longer supported.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-10-21.2259.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
