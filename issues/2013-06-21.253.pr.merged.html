<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2013 06 21.253.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2013 06 21.253.pr.merged";
        var mkdocs_page_input_path = "issues/2013-06-21.253.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2013 06 21.253.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="253_pr_merged_fix_uefi_detection_on_some_distributions"><a href="https://github.com/rear/rear/pull/253">#253 PR</a> <code>merged</code>: Fix UEFI detection on some distributions<a class="headerlink" href="#253_pr_merged_fix_uefi_detection_on_some_distributions" title="Permanent link">&para;</a></h1>
<h4 id="florent38_opened_issue_at_2013-06-21_0722"><img src="https://avatars.githubusercontent.com/u/2429198?v=4" width="50"><a href="https://github.com/Florent38">Florent38</a> opened issue at <a href="https://github.com/rear/rear/pull/253">2013-06-21 07:22</a>:<a class="headerlink" href="#florent38_opened_issue_at_2013-06-21_0722" title="Permanent link">&para;</a></h4>
<p>For example in RHEL where efivarskernel module is builtin. The check of
/sys/firmware/efi/{efi,efivars} is enough IMHO.<br />
Example on RHEL 6.4 on an UEFI system:</p>
<h1 id="modprobe_efivars">modprobe efivars<a class="headerlink" href="#modprobe_efivars" title="Permanent link">&para;</a></h1>
<p>FATAL: Module efivars not found.</p>
<h4 id="florent38_commented_at_2013-06-21_0834"><img src="https://avatars.githubusercontent.com/u/2429198?v=4" width="50"><a href="https://github.com/Florent38">Florent38</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19804117">2013-06-21 08:34</a>:<a class="headerlink" href="#florent38_commented_at_2013-06-21_0834" title="Permanent link">&para;</a></h4>
<p>efivars module create and populate /sys/firmware/efi directory. On a
BIOS system, this directory will never be created.<br />
After the modprobe command, rear test if this directory exists and
return if not. According to the test-efivars in Systemd, we see that the
test of the directory is enough :</p>
<p>Systemd test the efi boot with this function :<br />
bool is_efi_boot(void) {<br />
return access("/sys/firmware/efi", F_OK) &gt;= 0;<br />
}</p>
<h4 id="dagwieers_commented_at_2013-06-21_1043"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19809154">2013-06-21 10:43</a>:<a class="headerlink" href="#dagwieers_commented_at_2013-06-21_1043" title="Permanent link">&para;</a></h4>
<p>@Florent38 Alright, I understand it now. The patch looks fine.</p>
<p>There is one other thing I don't like from that same file, which are the
'||' and '&amp;&amp;' statements. For me they break the flow of the logic and I
always have a hard time interpreting the intended flow. (In the past I
wanted a coding standard to avoid certain shell statements and have a
more consistent way of writing shell).</p>
<p>Especially this I find confusing:</p>
<pre><code>cat /proc/cmdline | grep -q noefi || {    # 'noefi' option not found, so check for the dir itself
    if [ -d /sys/firmware/efi/vars ]; then
        SYSFS_DIR_EFI_VARS=/sys/firmware/efi/vars
    elif [ -d /sys/firmware/efi/efivars ]; then
        SYSFS_DIR_EFI_VARS=/sys/firmware/efi/efivars
    else 
        return    # when UEFI is enabled the dir is there
    fi
    }
</code></pre>
<p>I would expect that in case someone would configure the kernel to not do
EFI by setting <code>noefi</code> that we would not bother including UEFI support.
So I would expect this:</p>
<pre><code>if grep -qE '\bnoefi\b' /proc/cmdline; then
    return
fi

if [ -d /sys/firmware/efi/vars ]; then
    SYSFS_DIR_EFI_VARS=/sys/firmware/efi/vars
elif [ -d /sys/firmware/efi/efivars ]; then
    SYSFS_DIR_EFI_VARS=/sys/firmware/efi/efivars
else 
    return    # when UEFI is enabled the dir is there
fi
</code></pre>
<p>Now it seems that if <code>noefi</code> was specified on the kernel command line,
it will not bother checking <em>/sys/firmware/efi/vars</em> and continues using
UEFI. What am I missing ? :-)</p>
<h4 id="florent38_commented_at_2013-06-21_1215"><img src="https://avatars.githubusercontent.com/u/2429198?v=4" width="50"><a href="https://github.com/Florent38">Florent38</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19812424">2013-06-21 12:15</a>:<a class="headerlink" href="#florent38_commented_at_2013-06-21_1215" title="Permanent link">&para;</a></h4>
<p>I'm agree with you.</p>
<p>The noefi option on the kernel command line instructs the kernel not to
access the UEFI Runtime Services (don't load efivars module in fact, so
the directory in /sys/firmware/efi isn't populated).<br />
What do you think about the rear handling of this noefi option ?</p>
<p>Why don't use the -w option of grep instead of the -E "\befi\b" ?</p>
<p>Source for noefi option :
<a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface">https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface</a></p>
<h4 id="gdha_commented_at_2013-06-21_1346"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19816649">2013-06-21 13:46</a>:<a class="headerlink" href="#gdha_commented_at_2013-06-21_1346" title="Permanent link">&para;</a></h4>
<p>Be careful - <code>noefi</code> does not mean that UEFI cannot be used. Only that
it is not visible to us. Very confusing, but is that not the purpose of
UEFI??</p>
<h4 id="dagwieers_commented_at_2013-06-21_1417"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19818359">2013-06-21 14:17</a>:<a class="headerlink" href="#dagwieers_commented_at_2013-06-21_1417" title="Permanent link">&para;</a></h4>
<p>@gdha Agreed, but if the user decides that UEFI should not be visible,
the intention is there to not use UEFI. What else is the purpose. Or to
put it differently, if a system without UEFI has got the <code>noefi</code> keyword
set, we don't want to assume the system <em>does</em> have UEFI, because we
cannot tell. So my hunch is "if <code>noefi</code>, we don't do UEFI". No matter if
the system has the capability.</p>
<p>@Florent38 Because I didn't know about the <code>-w</code> option to grep ;-)
Thanks for that, something we could reuse in Relax-and-Recover, no
doubt.</p>
<h4 id="dagwieers_commented_at_2013-06-21_1909"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/pull/253#issuecomment-19834956">2013-06-21 19:09</a>:<a class="headerlink" href="#dagwieers_commented_at_2013-06-21_1909" title="Permanent link">&para;</a></h4>
<p>@gdha Can we merge the original pull request ? And then decide what to
do with <code>noefi</code> ?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2013-06-21.253.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
