<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2993 Issue open: Rubrik CDM agent missing after ReaR recovery - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2993 Issue open: Rubrik CDM agent missing after ReaR recovery";
        var mkdocs_page_input_path = "issues/2023-05-25.2993.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2993 Issue open: Rubrik CDM agent missing after ReaR recovery</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2993_issue_open_rubrik_cdm_agent_missing_after_rear_recovery"><a href="https://github.com/rear/rear/issues/2993">#2993 Issue</a> <code>open</code>: Rubrik CDM agent missing after ReaR recovery<a class="headerlink" href="#2993_issue_open_rubrik_cdm_agent_missing_after_rear_recovery" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>external tool</code></p>
<h4 id="drakkainenn_opened_issue_at_2023-05-25_0900"><img src="https://avatars.githubusercontent.com/u/111309896?v=4" width="50"><a href="https://github.com/drakkainenn">drakkainenn</a> opened issue at <a href="https://github.com/rear/rear/issues/2993">2023-05-25 09:00</a>:<a class="headerlink" href="#drakkainenn_opened_issue_at_2023-05-25_0900" title="Permanent link">&para;</a></h4>
<!-- Relax-and-Recover (ReaR) Issue Template

Fill in the following items before submitting a new issue.
(quick response is not guaranteed with free support):

Please use proper GitHub Flavoured Markdown,
see "Basic writing and formatting syntax" at
https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax

-- You can safely remove this comment block
-->

<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.7 / 2023-04-25</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    RHEL 8.4</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    BACKUP=CDM<br />
    OUTPUT=ISO<br />
    TIMESYNC=NTP<br />
    ONLY_INCLUDE_VG=("vg_system")<br />
    GRUB_RESCUE=n<br />
    COPY_AS_IS=( "${COPY_AS_IS[@]}" "/etc/rubrik"
    "/usr/bin/rubrik" "/var/log/rubrik" "/etc/pki" )<br />
    UEFI_BOOTLOADER=/boot/efi/EFI/redhat/grubx64.efi<br />
    SECURE_BOOT_BOOTLOADER=/boot/efi/EFI/redhat/shimx64.efi<br />
    DISKS_TO_BE_WIPED='/dev/sdaa'</p>
</li>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    HP</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    N/A</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    N/A</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):<br />
    N/A</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    Rubrik agent is missing after recovery:</p>
</li>
</ul>
<p>[root@server rear]# ls -la /etc/rubrik<br />
ls: cannot access '/etc/rubrik': No such file or directory</p>
<p>Original issue:
<a href="https://github.com/rear/rear/issues/2483">https://github.com/rear/rear/issues/2483</a><br />
Issue still exist<br />
Rubrik version: 8.0.1</p>
<ul>
<li>Workaround, if any:<br />
    After recovery but before rebooting copy /etc/rubrik to
    /mnt/local/rubrik. Also copy /usr/bin/rubrik to
    /mnt/local/usr/bin/rubrik. Both copies should also copy the file
    permissions.</li>
</ul>
<h4 id="schlomo_commented_at_2023-05-29_1017"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2993#issuecomment-1566915060">2023-05-29 10:17</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-29_1017" title="Permanent link">&para;</a></h4>
<p>(Sorry, new to the topic) So ReaR should put the CDM agent back into the
recovered system, right? Will you submit a PR for this or do you need
<a href="https://relax-and-recover.org/support/#:~:text=means%20for%20sponsoring-,Professional%20Support,-If%20your%20company">assistance from
us</a>?</p>
<p>I can offer some additional thoughts about the CDM:</p>
<ul>
<li>Currently ReaR waits for recovery and starts a <code>rear_shell</code> to wait
    for the user to confirm. We could extend this to wait for the
    appearance of a file, similar to how <code>NFS4SERVER</code> is implemented and
    thereby faciliate automated recovery without user input.</li>
<li>Can you be sure that the CDM agent is always installed under the
    hard coded paths? If not, then maybe dynamically determine the paths
    and use that instead, similar to how we handle this now for
    <code>GALAXY11</code></li>
</ul>
<h4 id="pcahyna_commented_at_2023-05-29_1020"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2993#issuecomment-1566923980">2023-05-29 10:20</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-29_1020" title="Permanent link">&para;</a></h4>
<p>@DamaniN can you please have a look ?</p>
<h4 id="schlomo_commented_at_2023-05-29_1205"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2993#issuecomment-1567053261">2023-05-29 12:05</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-29_1205" title="Permanent link">&para;</a></h4>
<p>BTW, would it be possible to also update the test matrix in
<code>16-Rubrik-CDM.adoc</code> to reflect the version tested and possibly also add
more recent distros?</p>
<h4 id="drakkainenn_commented_at_2023-06-14_0719"><img src="https://avatars.githubusercontent.com/u/111309896?v=4" width="50"><a href="https://github.com/drakkainenn">drakkainenn</a> commented at <a href="https://github.com/rear/rear/issues/2993#issuecomment-1590617334">2023-06-14 07:19</a>:<a class="headerlink" href="#drakkainenn_commented_at_2023-06-14_0719" title="Permanent link">&para;</a></h4>
<blockquote>
<p>(Sorry, new to the topic) So ReaR should put the CDM agent back into
the recovered system, right? Will you submit a PR for this or do you
need <a href="https://relax-and-recover.org/support/#:~:text=means%20for%20sponsoring-,Professional%20Support,-If%20your%20company">assistance from
us</a>?</p>
<p>I can offer some additional thoughts about the CDM:</p>
<ul>
<li>Currently ReaR waits for recovery and starts a <code>rear_shell</code> to
    wait for the user to confirm. We could extend this to wait for the
    appearance of a file, similar to how <code>NFS4SERVER</code> is implemented
    and thereby faciliate automated recovery without user input.</li>
<li>Can you be sure that the CDM agent is always installed under the
    hard coded paths? If not, then maybe dynamically determine the
    paths and use that instead, similar to how we handle this now for
    <code>GALAXY11</code></li>
</ul>
</blockquote>
<p>Could you help with PR ?</p>
<p>List of files:</p>
<blockquote>
<p>[root@server~]# rpm -ql rubrik-agent<br />
/etc/cron.d/rubrik<br />
/etc/init.d/rubrikagents<br />
/etc/logrotate.d/rubrik<br />
/etc/rubrik<br />
/etc/rubrik/check_and_restart_agents.sh<br />
/etc/rubrik/conf<br />
/etc/rubrik/conf/agent_flags.conf<br />
/etc/rubrik/conf/agent_version<br />
/etc/rubrik/conf/bootstrap_flags.conf<br />
/etc/rubrik/conf/certificate_info<br />
/etc/rubrik/db2<br />
/etc/rubrik/gen_tls_cert.sh<br />
/etc/rubrik/jobs<br />
/etc/rubrik/keys<br />
/etc/rubrik/keys/rubrik.crt<br />
/etc/rubrik/rba-keygen.sh<br />
/etc/rubrik/start_stop.sh<br />
/etc/rubrik/start_stop_agent.sh<br />
/etc/rubrik/start_stop_bootstrap.sh<br />
/etc/rubrik/stop_all.sh<br />
/etc/systemd/system/rubrikagents-backup.service<br />
/etc/systemd/system/rubrikagents-bootstrap.service<br />
/usr/bin/rubrik<br />
/usr/bin/rubrik/backup_agent_main<br />
/usr/bin/rubrik/bootstrap_agent_main<br />
/usr/bin/rubrik/db2<br />
/usr/bin/rubrik/db2/db2_fetch_log_main<br />
/usr/bin/rubrik/db2/rubrik_db2_tool.pex<br />
/usr/bin/rubrik/db2/vendorlib<br />
/usr/bin/rubrik/oracle_agent_main<br />
/usr/bin/rubrik/sap_hana<br />
/usr/bin/rubrik/sap_hana/sap_hana_agent_main<br />
/usr/bin/rubrik/sap_hana/sap_hana_bootstrap_main<br />
/usr/bin/rubrik/sap_hana_v2<br />
/usr/bin/rubrik/sap_hana_v2/sap_hana_backint_main<br />
/usr/bin/rubrik/sap_hana_v2/sap_hana_restore.pex<br />
/usr/bin/rubrik/timeout<br />
/usr/lib/.build-id<br />
/usr/lib/.build-id/0b<br />
/usr/lib/.build-id/0b/d24bea2752053a80479109d0d860512b34efe7<br />
/usr/lib/.build-id/1d<br />
/usr/lib/.build-id/1d/7facb752179b86c88adefc74c897c8c3466ad3<br />
/usr/lib/.build-id/28<br />
/usr/lib/.build-id/28/ba79c778f7402713aec6af319ee0fbaf3a8014<br />
/usr/lib/.build-id/2a<br />
/usr/lib/.build-id/2a/4ae7d03b8e5290a81a03858523cc0a0059ba36<br />
/usr/lib/.build-id/3c<br />
/usr/lib/.build-id/3c/0fd30d9df62825bebe3caf0c5c391a947bbe10<br />
/usr/lib/.build-id/52<br />
/usr/lib/.build-id/52/ecaa413ac4b8c84de29115a9f58c51877654b1<br />
/usr/lib/.build-id/64<br />
/usr/lib/.build-id/64/dffb10c0b7de102c6c2f1208f0f779cfd0ebe3<br />
/usr/lib/.build-id/7b<br />
/usr/lib/.build-id/7b/9caade8d6aea0bf99095101245bbf8b2bc1745<br />
/usr/lib/.build-id/81<br />
/usr/lib/.build-id/81/e118d25e2289dae7772b23b96c079d4d103995<br />
/usr/lib/.build-id/d2<br />
/usr/lib/.build-id/d2/542992691af1071a152d85156cc7e7db0a480f<br />
/usr/lib64/libinject.so<br />
/var/log/rubrik<br />
/var/log/rubrik/db2</p>
</blockquote>
<p>so we need directories:<br />
/etc/rubrik<br />
/usr/bin/rubrik/<br />
/var/log/rubrik</p>
<p>and files:<br />
/etc/cron.d/rubrik<br />
/etc/init.d/rubrikagents<br />
/etc/logrotate.d/rubrik<br />
/etc/systemd/system/rubrikagents-backup.service<br />
/etc/systemd/system/rubrikagents-bootstrap.service</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-05-25.2993.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
