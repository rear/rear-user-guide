<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1636 PR closed: Follow symbolic link with COPY_AS_IS targets - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1636 PR closed: Follow symbolic link with COPY_AS_IS targets";
        var mkdocs_page_input_path = "issues/2017-12-08.1636.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1636 PR closed: Follow symbolic link with COPY_AS_IS targets</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1636_pr_closed_follow_symbolic_link_with_copy_as_is_targets"><a href="https://github.com/rear/rear/pull/1636">#1636 PR</a> <code>closed</code>: Follow symbolic link with COPY_AS_IS targets<a class="headerlink" href="#1636_pr_closed_follow_symbolic_link_with_copy_as_is_targets" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>won't fix / can't fix / obsolete</code>, <code>minor bug</code></p>
<h4 id="gdha_opened_issue_at_2017-12-08_1036"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/pull/1636">2017-12-08 10:36</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-12-08_1036" title="Permanent link">&para;</a></h4>
<ul>
<li>added the "-h" option to tar to follow the symbolic links<br />
    instead of adding just the symbolic link to the tar archive<br />
    We run into this issue with /etc/localtime (issue #1635)</li>
<li>commented out in skel/default/etc/scripts/dhcp-setup-functions.sh<br />
    the localtime copy lines (as the /usr/share/zoneinfo is not<br />
    present anyway in the rescue environment)</li>
</ul>
<h4 id="gdha_commented_at_2017-12-08_1037"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350231292">2017-12-08 10:37</a>:<a class="headerlink" href="#gdha_commented_at_2017-12-08_1037" title="Permanent link">&para;</a></h4>
<p>I think this is serious enough to still push it into the release 2.3,
agree?</p>
<h4 id="jsmeix_commented_at_2017-12-08_1138"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350243425">2017-12-08 11:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-12-08_1138" title="Permanent link">&para;</a></h4>
<p>As far as I see this is a backward incompatible change<br />
because without '-h' tar copies symbolic links as symbolic links<br />
so that there can be symbolic links in the recovery system<br />
while with '-h' tar copies the files symbolic links point to<br />
so that there can be no longer symbolic links in the recovery system<br />
which might blow up the recovery system with several copies<br />
of the same (possibly big) file where several symbolic links<br />
point to on the original system.</p>
<p>I fear such a backward incompatible change will cause<br />
unexpected and unwanted bad side effects in this or that<br />
unforeseen special cases.</p>
<p>Couldn't the actual issue
<a href="https://github.com/rear/rear/issues/1635">https://github.com/rear/rear/issues/1635</a><br />
be solved with a specific solution only for that issue e.g. like</p>
<pre>
localtime_link_target="$( readlink -e /etc/localtime )"
COPY_AS_IS=( "${COPY_AS_IS[@]}" /etc/localtime "$localtime_link_target" )
</pre>

<p>FYI:</p>
<p>On my SLES11 system:</p>
<pre>
# ls -l /etc/localtime
-rw-r--r-- 3 root root 2335 Jun 17  2015 /etc/localtime

# readlink -e /etc/localtime
/etc/localtime
</pre>

<p>On my SLES12 system:</p>
<pre>
# ls -l /etc/localtime
lrwxrwxrwx 1 root root 35 Jul 28 10:40 /etc/localtime -> ../usr/share/zoneinfo/Europe/Berlin

# readlink -e /etc/localtime
/usr/share/zoneinfo/Europe/Berlin
</pre>

<h4 id="jsmeix_commented_at_2017-12-08_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350247362">2017-12-08 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-12-08_1201" title="Permanent link">&para;</a></h4>
<p>I even found some broken symbolic links in the recovery system:</p>
<pre>
# for l in $( find /tmp/rear.n8XNBDuAB0fhlXn/rootfs -xtype l ) ; do file $l ; done
/tmp/rear.n8XNBDuAB0fhlXn/rootfs/etc/localtime: broken symbolic link to `../usr/share/zoneinfo/Europe/Berlin'
/tmp/rear.n8XNBDuAB0fhlXn/rootfs/dev/device-mapper: broken symbolic link to `mapper/control'
/tmp/rear.n8XNBDuAB0fhlXn/rootfs/dev/char/10:236: broken symbolic link to `../mapper/control'
</pre>

<h4 id="jsmeix_commented_at_2017-12-08_1305"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350258366">2017-12-08 13:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-12-08_1305" title="Permanent link">&para;</a></h4>
<p>The change</p>
<pre>
--- a/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh
+++ b/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh

-if ! tar -v -X $copy_as_is_exclude_file -P -C / -c "${COPY_AS_IS[@]}" 2>$copy_as_is_filelist_file | tar $v -C $ROOTFS_DIR/ -x 1>/dev/null ; then
+if ! tar -v -X $copy_as_is_exclude_file -h -P -C / -c "${COPY_AS_IS[@]}" 2>$copy_as_is_filelist_file | tar $v -C $ROOTFS_DIR/ -x 1>/dev/null ; then
</pre>

<p>has horrible consequences on my SLES12 test system:</p>
<p>Now "usr/sbin/rear -D mkrescue" takes ages at<br />
"Copying files and directories" so that I aborted it<br />
and the recovery system size before was 208M<br />
but with that change (and aborted "Copying files and directories")<br />
it became 1.8G</p>
<h4 id="schlomo_commented_at_2017-12-08_1317"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350260790">2017-12-08 13:17</a>:<a class="headerlink" href="#schlomo_commented_at_2017-12-08_1317" title="Permanent link">&para;</a></h4>
<p>I would like to caution against this change: IMHO symlinks should be
copied as-is into the rescue system and not converted into files or
directories. IMHO the danger to mess up the system is way too big and
especially the danger to bloat up the rescue image (as @jsmeix
observed). I think that in most cases the symlinks were put in place
purposefully so that we should leave them as there were intended.</p>
<p>For the few known cases where this is a problem we should add extra code
to handle it, e.g. <code>/etc/localtime</code>.</p>
<p>If you want to help with finding such places then I would suggest to add
code that checks symlinks and reports broken symlinks, especially if
they were not broken in the source system.</p>
<h4 id="jsmeix_commented_at_2017-12-08_1331"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350263575">2017-12-08 13:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-12-08_1331" title="Permanent link">&para;</a></h4>
<p>With the added '-h' it seems "rear mkrescue" even hangs up at<br />
"Copying files and directories" because since several minutes<br />
the ReaR log file stays at</p>
<pre>
# tail /root/rear.master/var/log/rear/rear-f48.log
...
++ tar -v -C /tmp/rear.9h061udK1yV7mTo/rootfs/ -x
++ tar -v -X /tmp/rear.9h061udK1yV7mTo/tmp/copy-as-is-exclude -h -P -C / -c /root/rear.master/usr/share/rear /root/rear.master/var/lib/rear /dev /etc/inputrc ...
tar: Removing leading `/' from member names
tar: Removing leading `/' from hard link targets
</pre>

<p>The recovery system does no longer grow noticeable<br />
because since several minutes it stays at 1.8G</p>
<pre>
# du -hs /tmp/rear.9h061udK1yV7mTo/rootfs/
1.8G    /tmp/rear.9h061udK1yV7mTo/rootfs/
</pre>

<p>but when counting bytes one can see it still grows slowly:</p>
<pre>
# for i in 1 2 3 ; do date +%T ; du -bs /tmp/rear.9h061udK1yV7mTo/rootfs/ ; sleep 10 ; done
14:29:17
1739527435      /tmp/rear.9h061udK1yV7mTo/rootfs/
14:29:28
1739533555      /tmp/rear.9h061udK1yV7mTo/rootfs/
14:29:38
1739541339      /tmp/rear.9h061udK1yV7mTo/rootfs/
</pre>

<p>so that something is still creeping on...<br />
...<br />
...after more than half an hour I aborted it again<br />
and got:</p>
<pre>
# date +%T ; du -bs /tmp/rear.9h061udK1yV7mTo/rootfs/
14:56:02
1740243069      /tmp/rear.9h061udK1yV7mTo/rootfs/
</pre>

<h4 id="gdha_commented_at_2017-12-11_0757"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-350647850">2017-12-11 07:57</a>:<a class="headerlink" href="#gdha_commented_at_2017-12-11_0757" title="Permanent link">&para;</a></h4>
<p>Good that I asked your opinion! As issue #1638 has been made to tackle
this I will close this PR without merging. We can solve it differently.</p>
<h4 id="jsmeix_commented_at_2018-10-09_0924"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1636#issuecomment-428123089">2018-10-09 09:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-10-09_0924" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/54101043aea22ea09af04322b63d894485440035">https://github.com/rear/rear/commit/54101043aea22ea09af04322b63d894485440035</a><br />
I documented that symbolic links must be copied as symbolic links<br />
(i.e. why 'tar -h' must not be used for COPY_AS_IS).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-12-08.1636.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
