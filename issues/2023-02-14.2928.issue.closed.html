<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2928 Issue closed: NETFS tar backup no btrfs subvolumes by default - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2928 Issue closed: NETFS tar backup no btrfs subvolumes by default";
        var mkdocs_page_input_path = "issues/2023-02-14.2928.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2928 Issue closed: NETFS tar backup no btrfs subvolumes by default</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2928_issue_closed_netfs_tar_backup_no_btrfs_subvolumes_by_default"><a href="https://github.com/rear/rear/issues/2928">#2928 Issue</a> <code>closed</code>: NETFS tar backup no btrfs subvolumes by default<a class="headerlink" href="#2928_issue_closed_netfs_tar_backup_no_btrfs_subvolumes_by_default" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code></p>
<h4 id="schlomo_opened_issue_at_2023-02-14_0759"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/2928">2023-02-14 07:59</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-02-14_0759" title="Permanent link">&para;</a></h4>
<p>ReaR 2.7 on Leap 15.4 x86_64</p>
<p>Config:</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL=nfs://&lt;REDACTED-SERVER-NAME&gt;/srv/scratch
REQUIRED_PROGS+=(chattr)
</code></pre>
<p>Disk layout is typical SUSE default</p>
<pre><code>rear-sle15sp4:~ # df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        4,0M     0  4,0M   0% /dev
tmpfs           985M     0  985M   0% /dev/shm
tmpfs           394M   17M  378M   5% /run
tmpfs           4,0M     0  4,0M   0% /sys/fs/cgroup
/dev/sda2       8,0G  6,7G  1,1G  87% /
/dev/sda2       8,0G  6,7G  1,1G  87% /boot/grub2/x86_64-efi
/dev/sda2       8,0G  6,7G  1,1G  87% /home
/dev/sda2       8,0G  6,7G  1,1G  87% /boot/grub2/i386-pc
/dev/sda2       8,0G  6,7G  1,1G  87% /opt
/dev/sda2       8,0G  6,7G  1,1G  87% /root
/dev/sda2       8,0G  6,7G  1,1G  87% /srv
/dev/sda2       8,0G  6,7G  1,1G  87% /tmp
/dev/sda2       8,0G  6,7G  1,1G  87% /usr/local
/dev/sda2       8,0G  6,7G  1,1G  87% /var
tmpfs           197M  4,0K  197M   1% /run/user/0
</code></pre>
<p>The <strong>problem</strong> is that important content from <code>/var</code> is missing from
the backup archive (checking on the backup server):</p>
<pre><code>$ tar -tvzf /srv/scratch/rear-sle15sp4/backup.tar.gz | grep " var/"
drwxr-xr-x root/root         0 2023-02-12 21:38 var/
-rw------- root/root     1509845 2023-02-14 08:30 var/log/rear/rear-rear-sle15sp4.log
</code></pre>
<p>The root cause for this is that the actual backup tar command looks like
this and includes only <code>/</code> and not the other BTRFS subvolumes. But it
also has the <code>--one-file-system</code> option set so that <code>tar</code> won't descend
into the subvolumes:</p>
<pre><code>++ Print 'Creating tar archive '\''/var/tmp/rear.1fX2nBnGHRya4cJ/outputfs/rear-sle15sp4/backup.tar.gz'\'''
++ ProgressStart 'Preparing archive operation'
++ echo -en '\e[2K\rPreparing archive operation\e7'
++ BackupPID=5297
++ starttime=61
++ sleep 1
2023-02-14 08:28:36.965871429 tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.1fX2nBnGHRya4cJ/tmp/backup-exclude.txt -C / -c -f - / /var/log/rear/rear-rear-sle15sp4.log | dd of=/var/tmp/rear.1fX2nBnGHRya4cJ/outputfs/rear-sle15sp4/backup.tar.gz bs=1M
</code></pre>
<p>And the root cause for that is that the <code>backup-include.txt</code> only
contains <code>/</code></p>
<p>It seems like we don't add the subvolumes to the backup automatically on
BTRFS?? I'm wondering how many SUSE users stumble over that?</p>
<p>And yes, the SUSE-related example config actually explains the problem
and provides the solution (thanks for including that @jsmeix !)</p>
<p>Maybe we should add some logic to automatically set the following in
case <code>BACKUP_PROG_INCLUDE</code> is <em>not</em> defined:</p>
<pre><code>BACKUP_PROG_INCLUDE=( $(findmnt -n -r -o TARGET -t btrfs | grep -v '^/$' | egrep -v 'snapshots|crash') )
</code></pre>
<p>Another question: On other systems not using BTRFS, does ReaR behave the
same and include only <code>/</code> in the backup or all filesystems? If on
non-BTRFS systems we include everything by default unless configured
differently then I'd suggest to make ReaR behave the same on BTRFS
systems too.</p>
<h4 id="jsmeix_commented_at_2023-02-14_1155"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429621441">2023-02-14 11:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1155" title="Permanent link">&para;</a></h4>
<p>Technically it behaves as btrfs behaves.<br />
For btrfs a subvolume means for 'tar' with '--one-file-system'<br />
that the btrfs subvolume is not included.</p>
<p>If we changed that we would make things behave incosistently<br />
in ReaR because then 'tar' with '--one-file-system' would behave<br />
different in ReaR for btrfs subvolumes than what plain 'tar'<br />
would do with '--one-file-system' for btrfs subvolumes and<br />
ReaR would behave different for btrfs subvolumes than for<br />
other things that are not included with '--one-file-system'.</p>
<p>Making the backup is in general external functionality in ReaR<br />
cf. "Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>ReaR calls a backup tool but ReaR is not meant to be<br />
backup configuration or management software so it is<br />
the user's task to specify things in ReaR for 'tar'<br />
in the same way as when he makes a backup whith plain 'tar'.</p>
<p>Perhaps I should explain this in more detail in default.conf<br />
what it means that 'tar' is called with '--one-file-system'<br />
so the user is informed to specify things as he needs it.<br />
Because as far as I see we do not tell our users<br />
that we call 'tar' with '--one-file-system'<br />
neither in default.conf nor in a doc/* file.</p>
<h4 id="pcahyna_commented_at_2023-02-14_1158"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429625602">2023-02-14 11:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1158" title="Permanent link">&para;</a></h4>
<p>ISTR @antonvoznia saw a similar issue on Fedora, where the default is
now also BTRFS and /home got excluded from backup (because it was a
subvolume).</p>
<h4 id="pcahyna_commented_at_2023-02-14_1200"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429628867">2023-02-14 12:00</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1200" title="Permanent link">&para;</a></h4>
<p>IMO ReaR should treat subvolumes the same way as it does for separate
filesystems: pass their mountpoints to the tar command explicitly. But
maybe I misunderstand how it works - I have not yet dug deeper in the
internal backup inclusion/exclusion code.</p>
<h4 id="schlomo_commented_at_2023-02-14_1208"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429640648">2023-02-14 12:08</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_1208" title="Permanent link">&para;</a></h4>
<p>All correct. My question would be "what does the user expect?"</p>
<p>And my answer would be: "By default the backup should cover everything"</p>
<p>That is why I would like to suggest that by default ReaR NETFS backup
should always perform a "full backup" of the system.</p>
<h4 id="pcahyna_commented_at_2023-02-14_1218"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429658677">2023-02-14 12:18</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1218" title="Permanent link">&para;</a></h4>
<p>I would not expect a different behavior if <code>/home</code> is a separate BTRFS
subvolume and if it is a separate XFS filesystem.</p>
<h4 id="schlomo_commented_at_2023-02-14_1319"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429737770">2023-02-14 13:19</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_1319" title="Permanent link">&para;</a></h4>
<p>So what happens on a not-BTRFS system where different directories like
<code>/home</code> or <code>/var</code> are on different file systems? Will ReaR automatically
include them all in the backup by default or only after explicit
configuration?</p>
<h4 id="pcahyna_commented_at_2023-02-14_1324"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429745052">2023-02-14 13:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1324" title="Permanent link">&para;</a></h4>
<p>I am quite sure it is the former - all disk-based filesystems are added
to backup by default.</p>
<h4 id="schlomo_commented_at_2023-02-14_1331"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429754096">2023-02-14 13:31</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_1331" title="Permanent link">&para;</a></h4>
<p>Then I'd like to see that behaviour for SUSE as well, regardless of the
filesystem used</p>
<h4 id="jsmeix_commented_at_2023-02-14_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1429758548">2023-02-14 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1335" title="Permanent link">&para;</a></h4>
<p>Offhandedly I may agree that there should not be a different behavior<br />
if /somedir is a btrfs subvolume or if it is a separate filesystem<br />
but when I think about it I get stuck in the dilemma<br />
that I described above:</p>
<p>'tar' with '--one-file-system' has same behavior<br />
when /somedir is a btrfs subvolume or a filesystem.</p>
<p>But now ReaR should have a differnt behavior<br />
when /somedir is a btrfs subvolume versus a filesystem.</p>
<p>How should ReaR behave consistently and trustworthy?</p>
<p>When the user knows 'tar' is called with '--one-file-system'<br />
then he must be able to trust ReaR to behave accordingly.</p>
<p>FYI:<br />
I will not enter a discussion what users expect.<br />
I had that in a totally different area in the past<br />
more than enough ad nauseam (yes, really AD NAUSEAM).<br />
It only wastes my energy and likely the energy of others too.<br />
I would stop contributing to ReaR (except SUSE forces me)<br />
if I had to deal with user expectation discussions.<br />
I want ReaR to stay as it always was and still is:<br />
A lower level expert tool (like 'parted' and such).<br />
I would appreciate a fully separated user frontend<br />
when someone makes it (e.g DRLM is some kind of that)<br />
but I would not contribute to that.</p>
<p>I leave this issue now and let other ReaR maintainers<br />
find out how to solve it.</p>
<h4 id="jsmeix_commented_at_2023-02-16_1436"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1433185314">2023-02-16 14:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1436" title="Permanent link">&para;</a></h4>
<p>FYI<br />
for clarification to avoid misunderstandings:</p>
<p>I refuse to think about what is commonly<br />
called "user expectations" or similar.</p>
<p>It is right to ask for what one himself needs.</p>
<p>It is OK to forward truthfully what others asked for<br />
but it would be better when they speak for themselves.</p>
<p>It is false to "impersonate" others and speak for them.</p>
<p>It works best to only focus on hard (technical) facts<br />
and avoid to fade away into wishful thinking and the like.</p>
<h4 id="jsmeix_commented_at_2023-02-16_1452"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1433208559">2023-02-16 14:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1452" title="Permanent link">&para;</a></h4>
<p>FYI<br />
see also<br />
<a href="https://github.com/rear/rear/issues/2604">https://github.com/rear/rear/issues/2604</a></p>
<h4 id="schlomo_commented_at_2023-02-21_2151"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1439137333">2023-02-21 21:51</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-21_2151" title="Permanent link">&para;</a></h4>
<p>I guess that this is currently by design. I'm fine with leaving this as
it is till somebody is willing to sponsor a better BTRFS support in
ReaR.</p>
<h4 id="jsmeix_commented_at_2023-02-22_0841"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1439629727">2023-02-22 08:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-22_0841" title="Permanent link">&para;</a></h4>
<p>After sleeping on it for some time now<br />
I meanwhile got a vague tentative untested idea<br />
how it might be possible to implement that some<br />
btrfs subvolumes get automatically included in the backup.</p>
<p>Please be patient - I need to try that out.</p>
<p>For me crucial parts are<br />
"final power to the user"<br />
so that the user must not have to work against the automatism<br />
(i.e. an automatism must never enforce its stuff on the user)<br />
and<br />
backward compatibility<br />
i.e. users who have specified</p>
<pre><code>BACKUP_PROG_INCLUDE=( specific btrfs subvolumes )
</code></pre>
<p>must not get a changed behaviour because a new automatism<br />
adds some more btrfs subvolumes that are not wanted.</p>
<h4 id="pcahyna_commented_at_2023-03-14_1023"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1467816637">2023-03-14 10:23</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-03-14_1023" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix ,<br />
I also checked the behavior of tar with <code>--one-file-system</code> and btrfs
subvolumes on and it is consistent with its behavior on mounted
filesystems: if tar is called on <code>/</code>, the <code>/home</code> filesystem is not
included in the backup if it is a separate mounted filesystem, and
neither if it is a mounted btrfs subvolume. The problem is that ReaR
does not pass the subvolume mount point to tar (while it passes the
mount point to tar if it is a regular mounted FS like XFS), as described
in #2604 .<br />
I agree that snapshot subvolumes are a problem, even if one wants to
include btrfs subvolumes, one should skip snapshots (at least in the
first version). Maybe this is not particularly different from LVM
snapshots? I don't even know how those would behave.<br />
I am sorry that I can't provide a more concrete advice on btrfs as it
seems fairly complicated and I am not familiar with it.<br />
I can provide information on how it is configured by default on Fedora,
though (the default install uses btrfs).<br />
Do you want to see a disklayout.conf from a Fedora installation?</p>
<h4 id="pcahyna_commented_at_2023-03-14_1024"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1467818504">2023-03-14 10:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-03-14_1024" title="Permanent link">&para;</a></h4>
<p>@jsmeix If you have a proposed fix, I can also test it on Fedora.</p>
<h4 id="jsmeix_commented_at_2023-03-14_1045"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1467853718">2023-03-14 10:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-14_1045" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
could you show me on a Fedora installation the output of</p>
<pre><code># lsblk -ipo NAME,KNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINTS
</code></pre>
<p>if this works on Fedora (i.e. with 'MOUNTPOINTS' plural)<br />
plus the disklayout.conf file.</p>
<p>The current layout/save/GNU/Linux/100_create_layout_file.sh<br />
does not yet use 'MOUNTPOINTS' but only 'MOUNTPOINT'<br />
in contrast to the function lsblk_output() in<br />
layout/recreate/default/200_run_layout_code.sh<br />
(I know - I need to align them - as time permits).</p>
<h4 id="pcahyna_commented_at_2023-03-14_1126"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1467921570">2023-03-14 11:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-03-14_1126" title="Permanent link">&para;</a></h4>
<p>Fedora 37:</p>
<pre><code>lsblk -ipo NAME,KNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINTS

NAME       KNAME     TRAN TYPE FSTYPE LABEL                     SIZE MOUNTPOINTS
/dev/sda   /dev/sda  sas  disk                                465.7G 
|-/dev/sda1
|          /dev/sda1      part                                    1M 
|-/dev/sda2
|          /dev/sda2      part ext4                               1G /boot
`-/dev/sda3
           /dev/sda3      part btrfs  fedora_hpe-dl360gen8-01 464.7G /home
                                                                     /
/dev/zram0 /dev/zram0
                          disk                                    8G [SWAP]
</code></pre>
<p>disklayout.conf:</p>
<pre><code># Disk layout dated 20230314053733 (YYYYmmddHHMMSS)
# NAME        KNAME      PKNAME   TRAN TYPE FSTYPE LABEL                     SIZE MOUNTPOINT UUID                                 WWN
# /dev/sda    /dev/sda            sas  disk                                465.7G                                                 0x600508b1001c3b7c2286e4a50ffeb61f
# |-/dev/sda1 /dev/sda1  /dev/sda      part                                    1M                                                 0x600508b1001c3b7c2286e4a50ffeb61f
# |-/dev/sda2 /dev/sda2  /dev/sda      part ext4                               1G /boot      19baee1c-778c-49b8-90d5-a08e45618d1d 0x600508b1001c3b7c2286e4a50ffeb61f
# `-/dev/sda3 /dev/sda3  /dev/sda      part btrfs  fedora_hpe-dl360gen8-01 464.7G /home      12b9da8a-6151-49c1-a9af-fe6896f4d9f8 0x600508b1001c3b7c2286e4a50ffeb61f
# /dev/zram0  /dev/zram0               disk                                    8G [SWAP]                                          
# Disk /dev/sda
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/sda 500051402752 gpt
# Partitions on /dev/sda
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/sda 1048576 1048576 rear-noname bios_grub /dev/sda1
part /dev/sda 1073741824 2097152 rear-noname none /dev/sda2
part /dev/sda 498975375360 1075838976 rear-noname none /dev/sda3
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/sda2 /boot ext4 uuid=19baee1c-778c-49b8-90d5-a08e45618d1d label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw,relatime,stripe=128
fs /dev/sda3 / btrfs uuid=12b9da8a-6151-49c1-a9af-fe6896f4d9f8 label='fedora_hpe-dl360gen8-01' options=rw,relatime,compress=zstd:1,space_cache=v2,subvolid=257,subvol=/root
# Btrfs default subvolume for /dev/sda3 at /
# Format: btrfsdefaultsubvol &lt;device&gt; &lt;mountpoint&gt; &lt;btrfs_subvolume_ID&gt; &lt;btrfs_subvolume_path&gt;
btrfsdefaultsubvol /dev/sda3 / 5 /
# Btrfs normal subvolumes for /dev/sda3 at /
# Format: btrfsnormalsubvol &lt;device&gt; &lt;mountpoint&gt; &lt;btrfs_subvolume_ID&gt; &lt;btrfs_subvolume_path&gt;
btrfsnormalsubvol /dev/sda3 / 256 home
btrfsnormalsubvol /dev/sda3 / 257 root
btrfsnormalsubvol /dev/sda3 / 258 root/var/lib/portables
# All mounted btrfs subvolumes (including mounted btrfs default subvolumes and mounted btrfs snapshot subvolumes).
# Determined by the findmnt command that shows the mounted btrfs_subvolume_path.
# Format: btrfsmountedsubvol &lt;device&gt; &lt;subvolume_mountpoint&gt; &lt;mount_options&gt; &lt;btrfs_subvolume_path&gt;
btrfsmountedsubvol /dev/sda3 / rw,relatime,seclabel,compress=zstd:1,space_cache=v2,subvolid=257,subvol=/root root
btrfsmountedsubvol /dev/sda3 /home rw,relatime,seclabel,compress=zstd:1,space_cache=v2,subvolid=256,subvol=/home home
# Mounted btrfs subvolumes that have the 'no copy on write' attribute set.
# Format: btrfsnocopyonwrite &lt;btrfs_subvolume_path&gt;
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/zram0 uuid=cc5ac272-70ae-4538-b9e6-ace9852465a8 label=zram0
</code></pre>
<h4 id="github-actions_commented_at_2023-05-14_0223"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1546791115">2023-05-14 02:23</a>:<a class="headerlink" href="#github-actions_commented_at_2023-05-14_0223" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-07-15_0251"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1636634773">2023-07-15 02:51</a>:<a class="headerlink" href="#github-actions_commented_at_2023-07-15_0251" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-09-16_0200"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1722103634">2023-09-16 02:00</a>:<a class="headerlink" href="#github-actions_commented_at_2023-09-16_0200" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-11-18_0207"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1817327016">2023-11-18 02:07</a>:<a class="headerlink" href="#github-actions_commented_at_2023-11-18_0207" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2024-01-20_0208"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-1901591564">2024-01-20 02:08</a>:<a class="headerlink" href="#github-actions_commented_at_2024-01-20_0208" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2024-03-23_0202"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-2016305081">2024-03-23 02:02</a>:<a class="headerlink" href="#github-actions_commented_at_2024-03-23_0202" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2024-05-25_0208"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-2130665052">2024-05-25 02:08</a>:<a class="headerlink" href="#github-actions_commented_at_2024-05-25_0208" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="jsmeix_commented_at_2024-05-27_0709"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2928#issuecomment-2132791771">2024-05-27 07:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-27_0709" title="Permanent link">&para;</a></h4>
<p>This issue will be fixed by<br />
<a href="https://github.com/rear/rear/pull/3175">https://github.com/rear/rear/pull/3175</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2026 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-02-14.2928.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
