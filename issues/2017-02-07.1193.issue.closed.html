<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1193 Issue closed: rear miss grub2-efi-modules dependency: fails mkrescue with Error occurred during grub2-mkimage of BOOTX64.efi - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1193 Issue closed: rear miss grub2-efi-modules dependency: fails mkrescue with Error occurred during grub2-mkimage of BOOTX64.efi";
        var mkdocs_page_input_path = "issues/2017-02-07.1193.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1193 Issue closed: rear miss grub2-efi-modules dependency: fails mkrescue with Error occurred during grub2-mkimage of BOOTX64.efi</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1193_issue_closed_rear_miss_grub2-efi-modules_dependency_fails_mkrescue_with_error_occurred_during_grub2-mkimage_of_bootx64efi"><a href="https://github.com/rear/rear/issues/1193">#1193 Issue</a> <code>closed</code>: rear miss grub2-efi-modules dependency: fails mkrescue with Error occurred during grub2-mkimage of BOOTX64.efi<a class="headerlink" href="#1193_issue_closed_rear_miss_grub2-efi-modules_dependency_fails_mkrescue_with_error_occurred_during_grub2-mkimage_of_bootx64efi" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="gdha_opened_issue_at_2017-02-07_1306"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/1193">2017-02-07 13:06</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-02-07_1306" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): rear-2.00-1.fc25.x86_64</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): f25</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
<li>Are you using legacy BIOS of UEFI boot? UEFI</li>
<li>Brief description of the issue:<br />
    When running<br />
<code>/usr/sbin/rear mkrescue</code></li>
</ul>
<p>On a EFI system</p>
<p>it fails with error:</p>
<pre><code>Error occurred during grub2-mkimage of BOOTX64.efi

[...]
2017-02-06 01:36:32 Including output/ISO/Linux-i386/250_populate_efibootimg.sh
grub2-mkimage: error: cannot open `/usr/lib/grub/x86_64-efi/moddep.lst': No
such file or directory.
2017-02-06 01:36:32 ERROR: Error occurred during grub2-mkimage of BOOTX64.efi
==== Stack trace ====
Trace 0: /usr/sbin/rear:504 main
Trace 1: /usr/share/rear/lib/mkrescue-workflow.sh:22 WORKFLOW_mkrescue
Trace 2: /usr/share/rear/lib/framework-functions.sh:85 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:45 Source
Trace 4: /usr/share/rear/output/ISO/Linux-i386/250_populate_efibootimg.sh:69
source
Trace 5: /usr/share/rear/lib/uefi-functions.sh:50 build_bootx86_efi
Trace 6: /usr/share/rear/lib/_input-output-functions.sh:132 StopIfError
Message: Error occurred during grub2-mkimage of BOOTX64.efi
== End stack trace ==
</code></pre>
<p>This is caused by the miss of /usr/lib/grub/x86_64-efi/moddep.lst ,
provided on<br />
Fedora by "grub2-efi-modules" package</p>
<ul>
<li>Work-around, if any:<br />
    Original bug report originates from <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1419521">RedHat Bugzilla
    1419521</a></li>
</ul>
<h4 id="gdha_commented_at_2017-02-14_0818"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-279637404">2017-02-14 08:18</a>:<a class="headerlink" href="#gdha_commented_at_2017-02-14_0818" title="Permanent link">&para;</a></h4>
<p>@gozora Does this issue ring any bell with you?</p>
<h4 id="gozora_commented_at_2017-02-14_0902"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-279647358">2017-02-14 09:02</a>:<a class="headerlink" href="#gozora_commented_at_2017-02-14_0902" title="Permanent link">&para;</a></h4>
<p>Hello @gdha,</p>
<p>Thanks for my first assigned issue! :-)</p>
<p>Yes, it does ring a bell,
(<a href="https://github.com/rear/rear/issues/849#issuecomment-227459162">https://github.com/rear/rear/issues/849#issuecomment-227459162</a>).<br />
When talking about dependencies, this one is similar to
<a href="https://github.com/rear/rear/issues/1198">https://github.com/rear/rear/issues/1198</a>.</p>
<p>In my opinion, satisfy all dependencies we would need to install ALL
programs ReaR is supporting, which is just waste. Because during
installation of ReaR we basically don't know what backup type will be
used. :-(<br />
Not talking about solving nightmare where different distributions are
using different names with different content...</p>
<p>This specific case is mentioned in
<a href="https://github.com/rear/rear#requirements">docu</a>, but yes, who is
reading documentation nowadays?</p>
<p>Currently only idea I have, is something like <code>rear configcheck</code> which
would check user created configuration and inform him about possibly
missing packages ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-02-15_1056"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-279980248">2017-02-15 10:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-15_1056" title="Permanent link">&para;</a></h4>
<p>I think it is perfectly right and o.k. when<br />
"rear mkbackup/mkrescue" errors out<br />
with a meaningful error message in such cases.</p>
<p>When the user gets something like</p>
<pre>
Error: '/usr/lib/grub/x86_64-efi/moddep.lst': No such file or directory.
</pre>

<p>he is sufficiently informed what is missing.</p>
<p>Only an offhanded further comment:</p>
<p>I don't think a new workflow "configcheck" is needed.<br />
I think during "rear mkbackup/mkrescue"<br />
all needed checks should be done.</p>
<p>See also<br />
<a href="https://github.com/rear/rear/issues/892">https://github.com/rear/rear/issues/892</a><br />
and in particular note<br />
<a href="https://github.com/rear/rear/issues/755#issuecomment-171603580">https://github.com/rear/rear/issues/755#issuecomment-171603580</a><br />
and subsequent comments.<br />
I.e. for me "rear mkbackup/mkrescue" did not error out<br />
if a program in REQUIRED_PROGS does not exist.<br />
I think during "rear mkbackup/mkrescue" according to the<br />
values in /etc/rear/local.conf the REQUIRED_PROGS array<br />
should be extended and if something is missing<br />
"rear mkbackup/mkrescue" should error out.</p>
<p>For specific required files an additional array REQUIRED_FILES<br />
might be useful where each array member is a list of files<br />
separated by space where one of them must be present<br />
so that one can specify AND and OR conditions like</p>
<pre>
REQUIRED_FILES=( '/path1/foo' '/path2/this /path3/that' '/path4/bar' )
</pre>

<p>which means that those files must exist<br />
/path1/foo<br />
AND<br />
/path2/this OR /path3/that<br />
AND<br />
/path4/bar</p>
<h4 id="gdha_commented_at_2017-02-15_1218"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-279996520">2017-02-15 12:18</a>:<a class="headerlink" href="#gdha_commented_at_2017-02-15_1218" title="Permanent link">&para;</a></h4>
<p>OK - we mark this one as <strong>won't fix</strong> then. I'll update the according
RH bugzilla with our decision.<br />
The following text was added to the RHBZ:<br />
<em>Using UEFI is not by default the standard boot mechanism, and
therefore, we do not advise to add this rpm requirement to the rear spec
file.<br />
If needed a prep script can be added or enhanced to capture this
short-coming. Your input is more then welcome - here and in the upstream
story</em></p>
<h4 id="gdha_commented_at_2019-01-04_1359"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-451450705">2019-01-04 13:59</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-04_1359" title="Permanent link">&para;</a></h4>
<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1492177">https://bugzilla.redhat.com/show_bug.cgi?id=1492177</a>
explains how RH fixed the issue via a simple script:<br />
I propose the following change: add a file
<code>usr/share/rear/output/ISO/Linux-i386/249_check_rhel_grub2_efi_package.sh</code>
with this content:</p>
<pre><code># 249_check_rhel_grub2_efi_package.sh

is_true $USING_UEFI_BOOTLOADER || return    # empty or 0 means NO UEFI

(
    VERBOSE=1
    test -r /usr/lib/grub/x86_64-efi/moddep.lst
    PrintIfError "WARNING: /usr/lib/grub/x86_64-efi/moddep.lst not found, grub2-mkimage will likely fail. Please install the grub2-efi-x64-modules package to fix this."
)
</code></pre>
<p>Output of "rear mkrescue" with this change:</p>
<p><strong>WARNING: /usr/lib/grub/x86_64-efi/moddep.lst not found, grub2-mkimage
will likely fail. Please install the grub2-efi-x64-modules package to
fix this.<br />
ERROR: Error occurred during grub2-mkimage of BOOTX64.efi<br />
Aborting due to an error, check /var/log/rear/rear-localhost.log for
details</strong></p>
<p>Note from @gdha : if we decide to add this we should verify the OS
version - probably only a script meant for RHEL</p>
<h4 id="jsmeix_commented_at_2019-01-07_1121"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-451904092">2019-01-07 11:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-07_1121" title="Permanent link">&para;</a></h4>
<p>At least on openSUSE Leap 15.0 (probably on all SUSE systems)<br />
the directory is not <code>/usr/lib/grub/</code> but <code>/usr/lib/grub2/</code><br />
so that the test should be<br />
<code>test -r /usr/lib/grub*/x86_64-efi/moddep.lst</code></p>
<p>In current ReaR we have the <code>LogPrintError</code> function<br />
for messages that should appear in the log file and also<br />
on the user's terminal regardless whether or not the<br />
user launched 'rear' in verbose mode.</p>
<p>Finally I think we should better error out here because<br />
I assume it cannot work on UEFI without the GRUB2 <code>moddep.lst</code> file,
cf.<br />
<a href="https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a></p>
<h4 id="jsmeix_commented_at_2019-01-07_1124"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-451904968">2019-01-07 11:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-07_1124" title="Permanent link">&para;</a></h4>
<p>I will try out something and do a pull request...</p>
<h4 id="jsmeix_commented_at_2019-01-07_1418"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-451948692">2019-01-07 14:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-07_1418" title="Permanent link">&para;</a></h4>
<p>In general I do not like to have one kind of functionality<br />
split into pieces and spread over several scripts<br />
(because it makes it harder to maintain that particular<br />
functionality as a whole).</p>
<p>Accordingly I implemented all test for the prerequirements<br />
to make a bootable EFI image of GRUB2 at the one same place<br />
where the bootable EFI image of GRUB2 is actually made in the<br />
<code>build_bootx86_efi</code> function via
<a href="https://github.com/rear/rear/pull/2013">https://github.com/rear/rear/pull/2013</a></p>
<h4 id="jsmeix_commented_at_2019-01-09_0848"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1193#issuecomment-452617591">2019-01-09 08:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_0848" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2013">https://github.com/rear/rear/pull/2013</a>
merged<br />
this issue should be sufficiently solved:</p>
<p>Now it errors out if no <code>/usr/lib/grub*/x86_64-efi/moddep.lst</code><br />
file is found with</p>
<pre>
ERROR: grub2-mkimage would not make bootable EFI image of GRUB2
(no /usr/lib/grub*/x86_64-efi/moddep.lst file)
</pre>

<p>cf.
<a href="https://github.com/rear/rear/pull/2013#issue-242669421">https://github.com/rear/rear/pull/2013#issue-242669421</a></p>
<p>In general when some program or file is missing, we try to tell what is
missing<br />
but often things will just fail with a generic system error because we
cannot<br />
check all and every preconditions, cf. the section about<br />
"No disaster recovery without testing and continuous validation" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>If we detect something is missing, we will not tell the user what
software package<br />
(e.g. a rpm or deb package or whatever else) he must install to get the
missing piece<br />
because we cannot continuously track and maintain for all those various
kind<br />
of different Linux distributions what particular software package
provides<br />
what program or file in what version of each Linux distribution.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-02-07.1193.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
