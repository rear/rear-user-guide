<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2822 PR merged: Fix vi in the rescue system on Fedora and RHEL 9 - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2822 PR merged: Fix vi in the rescue system on Fedora and RHEL 9";
        var mkdocs_page_input_path = "issues/2022-06-16.2822.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2822 PR merged: Fix vi in the rescue system on Fedora and RHEL 9</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2822_pr_merged_fix_vi_in_the_rescue_system_on_fedora_and_rhel_9"><a href="https://github.com/rear/rear/pull/2822">#2822 PR</a> <code>merged</code>: Fix vi in the rescue system on Fedora and RHEL 9<a class="headerlink" href="#2822_pr_merged_fix_vi_in_the_rescue_system_on_fedora_and_rhel_9" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2022-06-16_1448"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2822">2022-06-16 14:48</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2022-06-16_1448" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>High</strong></p>
</li>
<li>
<p>Reference to related issue (URL):
    <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2097437">https://bugzilla.redhat.com/show_bug.cgi?id=2097437</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    without the change:</p>
</li>
</ul>
<!-- -->

<pre><code># echo 'PROGS+=( timeout )' &gt;&gt; /etc/rear/local.conf
# rear -d mkrescue
...
Testing that the recovery system in /var/tmp/rear.sewWahfi7dNgMlf/rootfs contains a usable system
...
# chroot /var/tmp/rear.sewWahfi7dNgMlf/rootfs timeout 10 vi +q
# echo $?
124
</code></pre>
<p>with the change, the return code is 0 and manually executing vi in the
chroot works properly.</p>
<ul>
<li>Brief description of the changes in this pull request:</li>
</ul>
<p>In recent Fedora and RHEL 9, <code>vi</code> is a shell script that executes <code>vim</code>
if found, so linking <code>vim</code> to <code>vi</code> leads to an infinite loop. Fix by
removing the symlink (I find it more confusing than helpful anyway, and
it is good to reduce the amount of special handling) and adding
<code>/usr/libexec/vi</code> (the real executable, executed by <code>vi</code> if <code>vim</code> is not
found) to <code>COPY_AS_IS</code>.</p>
<p>One could add vim as well, but I am afraid that it would bloat the
rescue ramdisk in case vim is compiled with a rich set of features.</p>
<h4 id="pcahyna_commented_at_2022-06-16_1450"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2822#issuecomment-1157749840">2022-06-16 14:50</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-16_1450" title="Permanent link">&para;</a></h4>
<p>Impact is High, because <code>vi</code> in the rescue system is currently broken
without the change.</p>
<h4 id="pcahyna_commented_at_2022-06-16_1505"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2822#issuecomment-1157767347">2022-06-16 15:05</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-16_1505" title="Permanent link">&para;</a></h4>
<p>@gdha I was thinking about it, but the problem is, this "just in case"
may get quite expensive in terms of ramdisk size, if <code>vim</code> is linked
against e.g. Perl, Python, TCL and GTK (I believe on Ubuntu / Debian
this can be the case).</p>
<h4 id="jsmeix_commented_at_2022-06-20_0742"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2822#issuecomment-1160089194">2022-06-20 07:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-20_0742" title="Permanent link">&para;</a></h4>
<p>I found 'vim' at those code places</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'vim' | grep -v '# vim: set et ts=4 sw=4'

usr/share/rear/build/GNU/Linux/005_create_symlinks.sh:
ln -sf $v vi $ROOTFS_DIR/bin/vim &gt;&amp;2

usr/share/rear/build/OPALPBA/Linux-i386/106_remove_files_copied_unconditionally.sh:
    bin/vim
</code></pre>
<p>Perhaps with the changes in this pull request in<br />
build/OPALPBA/Linux-i386/106_remove_files_copied_unconditionally.sh</p>
<pre><code># Remove symlinks whose targets have been excluded on the PBA system
local symlinks_to_remove=(
    bin/vim
    var/lib/rear
)
</code></pre>
<p>could be simplified or cleaned up to</p>
<pre><code># Remove symlinks whose targets have been excluded on the PBA system
local symlinks_to_remove=(
    var/lib/rear
)
</code></pre>
<p>?</p>
<p>build/OPALPBA/Linux-i386/106_remove_files_copied_unconditionally.sh<br />
originates from<br />
<a href="https://github.com/rear/rear/commit/e9f61ccc74f5b5be8106b43f67b219983e955956">https://github.com/rear/rear/commit/e9f61ccc74f5b5be8106b43f67b219983e955956</a><br />
which points to<br />
<a href="https://github.com/rear/rear/pull/2448">https://github.com/rear/rear/pull/2448</a><br />
but I found no explanation why the 'bin/vim' symlink is removed<br />
especially in case of OUTPUT=RAWDISK</p>
<h4 id="pcahyna_commented_at_2022-06-20_1136"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2822#issuecomment-1160336475">2022-06-20 11:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-20_1136" title="Permanent link">&para;</a></h4>
<p>@jsmeix good catch, I have no idea why that symlink gets removed, but
since we now avoid creating it. I guess it makes sense to avoid removing
it as well.</p>
<h4 id="pcahyna_commented_at_2022-06-20_1235"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2822#issuecomment-1160394254">2022-06-20 12:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-20_1235" title="Permanent link">&para;</a></h4>
<p>I addressed both comments, so I will rebase and merge the PR.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-06-16.2822.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
