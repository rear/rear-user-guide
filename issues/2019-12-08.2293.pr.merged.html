<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2293 PR merged: Use grub-mkstandalone instead of grub-mkimage for UEFI - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2293 PR merged: Use grub-mkstandalone instead of grub-mkimage for UEFI";
        var mkdocs_page_input_path = "issues/2019-12-08.2293.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2293 PR merged: Use grub-mkstandalone instead of grub-mkimage for UEFI</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2293_pr_merged_use_grub-mkstandalone_instead_of_grub-mkimage_for_uefi"><a href="https://github.com/rear/rear/pull/2293">#2293 PR</a> <code>merged</code>: Use grub-mkstandalone instead of grub-mkimage for UEFI<a class="headerlink" href="#2293_pr_merged_use_grub-mkstandalone_instead_of_grub-mkimage_for_uefi" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2019-12-08_2225"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2293">2019-12-08 22:25</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2019-12-08_2225" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong> / <strong>Cleanup</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
    #2199 #2283 #2001
    <a href="https://github.com/rear/rear/issues/1996#issuecomment-445201012">https://github.com/rear/rear/issues/1996#issuecomment-445201012</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    the two cases that use the code touched by this PR:</p>
<ul>
<li>creating a rescue ISO on a RHEL 8.1 UEFI system and booting it</li>
<li>creating a rescue system using GRUB_RESCUE and booting it using
    the EFI boot menu</li>
<li>repeating both with GRUB2_MODULES=(part_gpt part_msdos fat
    ext2 normal chain boot configfile linux jfs iso9660 usb usbms
    usb_keyboard video udf ntfs all_video gzio efi_gop reboot
    search test echo btrfs lvm)</li>
</ul>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    There have been several cases recently where ReaR on UEFI was broken
    due to either a wrong assumption about what Grub2 modules to load
    (#2001) or, in an attempt to fix it, a wrong assumption about where
    to search for them (see #2199). I believe that such Grub internal
    details are better handled by Grub itself and we should not hardcode
    them (making them configurable is only a workaround - the default
    should work in most scenarios). Therefore this change switches to
    using grub-mkstandalone for te Grub2 UEFI image generation, which,
    unlike grub-mkimage, relies less on supplied information about
    modules. It embeds a ramdisk in the Grub2 image and by defaults
    includes all modules in it.<br />
    I found that the current method is broken at least on RHEL and
    GRUB_RESCUE, because the current default set of modules does not
    include xfs and /boot is XFS by default on RHEL, making it
    inaccessible from Grub2. This change also fixes this, therefore it
    is a bugfix in addition to a cleanup.<br />
    I found that the image creation using grub-mkstandalone still needs
    to be told to load partition modules, otherwise partitions will not
    be detected out of the box. I therefore added a dynamic detection of
    all modules needed to access /boot (partitions, filesystems, and
    others like lvm, should it be needed) using grub-probe, as it is
    more robust and relies on less assumptions than trying to guess a
    reasonable set of default modules.<br />
    The change still honors GRUB2_MODULES, but changes it into an
    array. (Other lists in configuration are specified as arrays
    already, like MODULES, so having GRUB2_MODULES an a string with
    blank-separated words is not consistent with the rest of the
    configuration.) If GRUB2_MODULES is set and nonempty, only the
    specified modules will be embedded in the standalone image ramdisk
    and also only those will be loaded. The detection using grub-probe
    will be switched off.</p>
</li>
</ul>
<h4 id="gozora_commented_at_2019-12-09_0909"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563135443">2019-12-09 09:09</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_0909" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna,</p>
<p>I just run a simple test and created ReaR rescue system with your
code.<br />
On ISO boot, I don't get Grub2 boot menu but first boot entry is booted
immediately without any prompt. Can you please fix this behavior ?</p>
<p>Thanks</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_0928"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563142921">2019-12-09 09:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_0928" title="Permanent link">&para;</a></h4>
<p>Hi @gozora ,<br />
thank you for testing, unfortunately I tested this case and it worked
fine for me, so I don't know how to reproduce the problem, what is your
distribution and Grub2 version?</p>
<h4 id="gozora_commented_at_2019-12-09_0930"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563143812">2019-12-09 09:30</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_0930" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna,</p>
<p>I've used SLES12SP4 for SAP ...</p>
<pre><code># cat /etc/os-release
NAME="SLES"
VERSION="12-SP4"
VERSION_ID="12.4"
PRETTY_NAME="SUSE Linux Enterprise Server 12 SP4"
ID="sles"
ANSI_COLOR="0;32"
CPE_NAME="cpe:/o:suse:sles_sap:12:sp4"
</code></pre>
<p>V.</p>
<h4 id="gozora_commented_at_2019-12-09_0934"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563145413">2019-12-09 09:34</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_0934" title="Permanent link">&para;</a></h4>
<p>Excerpt from debug log:</p>
<pre><code>...
++ cp -v /boot/efi/EFI/sles/grubx64.efi /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/BOOTX64.efi
'/boot/efi/EFI/sles/grubx64.efi' -&gt; '/tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/BOOTX64.efi'
+++ dirname /boot/efi/EFI/sles/grubx64.efi
++ local uefi_bootloader_dirname=/boot/efi/EFI/sles
++ test -f ''
+++ basename /usr/bin/xorrisofs
++ test ebiso = xorrisofs
+++ type -p grub
++ [[ -n '' ]]
++ create_grub2_cfg
+++ get_root_disk_UUID
++++ grep ' on / '
++++ awk '{print $1}'
++++ xargs blkid -s UUID -o value
++++ mount
+++ echo 7e36992b-b7a6-48a2-89d1-499c93a825ed
++ root_uuid=7e36992b-b7a6-48a2-89d1-499c93a825ed
++ cat
++ test -f ''
++ build_bootx86_efi /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/BOOTX64.efi /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/grub.cfg
++ local outfile=/tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/BOOTX64.efi
++ local embedded_config=
++ local gmkstandalone=
++ local gprobe=
++ dirs=()
++ local dirs
++ modules=(${GRUB2_MODULES:+"${GRUB2_MODULES[@]}"})
++ local modules
++ shift
++ [[ -n /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/grub.cfg ]]
++ embedded_config=/boot/grub/grub.cfg=/tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/grub.cfg
++ shift
++ dirs=(${@:+"$@"})
++ has_binary grub-mkstandalone
++ for bin in '$@'
++ type grub-mkstandalone
/usr/share/rear/lib/_input-output-functions.sh: line 476: type: grub-mkstandalone: not found
++ return 1
++ has_binary grub2-mkstandalone
++ for bin in '$@'
++ type grub2-mkstandalone
++ return 0
++ gmkstandalone=grub2-mkstandalone
++ ((  0  ))
++ test /usr/lib/grub2/x86_64-efi/moddep.lst
++ grub2-mkstandalone -v -O x86_64-efi -o /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/BOOTX64.efi /boot/grub/grub.cfg=/tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/grub.cfg
grub2-mkstandalone: info: copying `/usr/lib/grub2/x86_64-efi/acpi.mod' -&gt; `/tmp/grub.rKUK6E/boot/grub/x86_64-efi/acpi.mod'.
grub2-mkstandalone: info: copying `/usr/lib/grub2/x86_64-efi/adler32.mod' -&gt; `/tmp/grub.rKUK6E/boot/grub/x86_64-efi/adler32.mod'.
...

# cat /tmp/rear.IEzPq6u2M2oANaW/tmp/mnt/EFI/BOOT/grub.cfg
set default="0"

insmod efi_gop
insmod efi_uga
insmod video_bochs
insmod video_cirrus
insmod all_video

set gfxpayload=keep
insmod gzio
insmod part_gpt
insmod ext2

set timeout=5

search --no-floppy --file /boot/efiboot.img --set
#set root=(cd0)

menuentry "Relax-and-Recover (no Secure Boot)"  --class gnu-linux --class gnu --class os {
     echo 'Loading kernel ...'
     linux /isolinux/kernel root=UUID=7e36992b-b7a6-48a2-89d1-499c93a825ed  selinux=0 biosdevname=1 net.ifnames=0
     echo 'Loading initial ramdisk ...'
     initrd /isolinux/initrd.cgz
}

menuentry "Relax-and-Recover (Secure Boot)"  --class gnu-linux --class gnu --class os {
     echo 'Loading kernel ...'
     linuxefi /isolinux/kernel root=UUID=7e36992b-b7a6-48a2-89d1-499c93a825ed  selinux=0 biosdevname=1 net.ifnames=0
     echo 'Loading initial ramdisk ...'
     initrdefi /isolinux/initrd.cgz
}

menuentry "Reboot" {
     reboot
}

menuentry "Exit to EFI Shell" {
     exit
}
</code></pre>
<h4 id="gozora_commented_at_2019-12-09_0945"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563149735">2019-12-09 09:45</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_0945" title="Permanent link">&para;</a></h4>
<p>@pcahyna do not spent your time on this for now!<br />
I've reset my server several times an sometimes menu is shown and
sometimes not.<br />
This might indicate possible problem with my firmware, and display of
menu might be related to bigger size of bootx64.efi.</p>
<p>I'll run couple of deeper tests in upcoming days and let you know if I
find something ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_0948"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563150572">2019-12-09 09:48</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_0948" title="Permanent link">&para;</a></h4>
<p>@gozora , thanks. I suggest that you also try GRUB_RESCUE, which uses
the same code.</p>
<h4 id="gozora_commented_at_2019-12-09_1018"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563162469">2019-12-09 10:18</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1018" title="Permanent link">&para;</a></h4>
<p>@pcahyna I've tested GRUB_RESCUE as you've suggested and got following:</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/12116358/70427452-05431680-1a75-11ea-9885-5f9c738ecdeb.png" /></p>
<p>I'm pretty sure that kernel and initrd are available but Grub2 somehow
can't locate them:</p>
<pre><code># ls /boot/
System.map-4.12.14-95.24-default  initrd-4.12.14-95.24-default        symvers-4.12.14-95.24-default.gz
boot.readme                       initrd-4.12.14-95.24-default-kdump  sysctl.conf-4.12.14-95.24-default
config-4.12.14-95.24-default      initrd-4.4.176-94.88-default        vmlinux-4.12.14-95.24-default.gz
efi                               rear-initrd.cgz                     vmlinuz
grub2                             rear-kernel                         vmlinuz-4.12.14-95.24-default
initrd                            symtypes-4.12.14-95.24-default.gz
</code></pre>
<p>Same ReaR configuration works fine with "old" code ...<br />
It can be related to fact that my <em>/boot/</em> is located on BTRFS.<br />
Can you maybe extend your tests for <em>/boot</em> on BTRFS ?</p>
<p>Thanks</p>
<p>V.</p>
<h4 id="gozora_commented_at_2019-12-09_1023"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563164559">2019-12-09 10:23</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1023" title="Permanent link">&para;</a></h4>
<p>@pcahyna I just realized that I'm running my server from BTRFS snapshot
...<br />
Can it be that build_bootx86_efi() (grub-mkstandalone) somehow can't
deal with with BTRFS snapshots ?</p>
<p>V.</p>
<h4 id="gozora_commented_at_2019-12-09_1028"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563167013">2019-12-09 10:28</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1028" title="Permanent link">&para;</a></h4>
<p>@pcahyna just FYI:<br />
My structure looks something like this:</p>
<pre><code># findmnt /
TARGET SOURCE                              FSTYPE OPTIONS
/      /dev/sda3[/@/.snapshots/1/snapshot] btrfs  rw,relatime,space_cache,subvolid=279,subvol=/@/.snapshots/1/snapshot

# df -h /boot
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda3        48G  9.2G   39G  20% /
</code></pre>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1032"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563168973">2019-12-09 10:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1032" title="Permanent link">&para;</a></h4>
<p>@gozora has the build code loaded a btrfs and LVM module in Grub2? If
not, can you manuallly load them (insmod btrfs, insmod lvm) and try the
menu again?</p>
<h4 id="pcahyna_commented_at_2019-12-09_1034"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563170217">2019-12-09 10:34</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1034" title="Permanent link">&para;</a></h4>
<p>P.S. you will see what modules get loaded from the grub2-mkstandalone
command from the debug log. (I also added a separate log statement which
will show them)</p>
<h4 id="gozora_commented_at_2019-12-09_1035"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563170656">2019-12-09 10:35</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1035" title="Permanent link">&para;</a></h4>
<p>I assume that all modules were loaded, because I was able to read
content <em>/boot</em> directory from Grub2 command line without any problems.</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1037"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563171773">2019-12-09 10:37</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1037" title="Permanent link">&para;</a></h4>
<p>@gozora you are able to read the content, but is the content correct? If
yes, I don't see how you are able to read the content but not able to
boot a kernel which is part of the very same content.</p>
<h4 id="gozora_commented_at_2019-12-09_1055"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563180410">2019-12-09 10:55</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1055" title="Permanent link">&para;</a></h4>
<p>I just simply read content of directory in Grub2 cmdline . I dont know
what content / directory is the "correct" one for Grub2. <code>grub-mkimage</code>
in old code worked well though ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1101"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563183177">2019-12-09 11:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1101" title="Permanent link">&para;</a></h4>
<p>I mean if you read the content of the directory, do you see the kernel
and initrd that you want to load?</p>
<h4 id="jsmeix_commented_at_2019-12-09_1108"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563186126">2019-12-09 11:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-12-09_1108" title="Permanent link">&para;</a></h4>
<p>From my experience with the SUSE's special btrfs default structure<br />
basically everything that can go wrong will go wrong with it.</p>
<p>From my personal point of view it is just too complicated.<br />
What I mean is it does not behave sufficiently fail-safe in practice.</p>
<p>When all and everything is fully correctly set up for it,<br />
it provides some extradordinary and powerful functionality.</p>
<p>But from my experience things fall apart as soon<br />
as something is not set up fully correctly.</p>
<p>As far as I know (but I am not at all a real expert in this area)<br />
one main reason of confusion is that what looks like <code>/dir</code> in the<br />
normal running system is not <code>/dir</code> in the whole btrfs tree<br />
because in the normal running system '/' is not the root of the btrfs<br />
but a sub-directory of the btrfs tree (actually a btrfs subvolume)<br />
that get mounted as '/' in the normal running system.</p>
<p>With SUSE's special btrfs default structure what is mounted as '/' in
the<br />
normal running system is a snapper snapshot sub-directory/subvolume<br />
of the btrfs tree.</p>
<p>And then other sub-directories of the btrfs tree (actually btrfs
subvolumes)<br />
get mounted below what is mounted as '/' in the normal running system.</p>
<p>To see what of the btrfs tree is acually mounted one must mount<br />
the root of the btrfs at a separated mountpoint so that one can<br />
inspect the whole btrfs tree starting at its actual root.</p>
<p>For example on my current SLES12-SP4 system with LVM and btrfs<br />
but with BIOS and not with UEFI, it is the same system as in<br />
<a href="https://github.com/rear/rear/pull/2291#issuecomment-561224611">https://github.com/rear/rear/pull/2291#issuecomment-561224611</a><br />
I have</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                        KNAME     PKNAME    TRAN TYPE FSTYPE       SIZE MOUNTPOINT
/dev/sda                    /dev/sda            ata  disk               20G 
`-/dev/sda1                 /dev/sda1 /dev/sda       part LVM2_member   20G 
  |-/dev/mapper/system-swap /dev/dm-0 /dev/sda1      lvm  swap         1.4G [SWAP]
  `-/dev/mapper/system-root /dev/dm-1 /dev/sda1      lvm  btrfs       18.6G /
/dev/sr0                    /dev/sr0            ata  rom  iso9660      3.8G

# findmnt -at btrfs
TARGET                    SOURCE                                             FSTYPE OPTIONS
/                         /dev/mapper/system-root[/@/.snapshots/1/snapshot]  btrfs  rw,relatime,s
|-/usr/local              /dev/mapper/system-root[/@/usr/local]              btrfs  rw,relatime,s
|-/var/opt                /dev/mapper/system-root[/@/var/opt]                btrfs  rw,relatime,s
|-/var/lib/mysql          /dev/mapper/system-root[/@/var/lib/mysql]          btrfs  rw,relatime,s
|-/boot/grub2/i386-pc     /dev/mapper/system-root[/@/boot/grub2/i386-pc]     btrfs  rw,relatime,s
|-/.snapshots             /dev/mapper/system-root[/@/.snapshots]             btrfs  rw,relatime,s
|-/var/crash              /dev/mapper/system-root[/@/var/crash]              btrfs  rw,relatime,s
|-/var/lib/pgsql          /dev/mapper/system-root[/@/var/lib/pgsql]          btrfs  rw,relatime,s
|-/var/spool              /dev/mapper/system-root[/@/var/spool]              btrfs  rw,relatime,s
|-/var/lib/mailman        /dev/mapper/system-root[/@/var/lib/mailman]        btrfs  rw,relatime,s
|-/opt                    /dev/mapper/system-root[/@/opt]                    btrfs  rw,relatime,s
|-/var/cache              /dev/mapper/system-root[/@/var/cache]              btrfs  rw,relatime,s
|-/home                   /dev/mapper/system-root[/@/home]                   btrfs  rw,relatime,s
|-/var/lib/mariadb        /dev/mapper/system-root[/@/var/lib/mariadb]        btrfs  rw,relatime,s
|-/var/tmp                /dev/mapper/system-root[/@/var/tmp]                btrfs  rw,relatime,s
|-/boot/grub2/x86_64-efi  /dev/mapper/system-root[/@/boot/grub2/x86_64-efi]  btrfs  rw,relatime,s
|-/srv                    /dev/mapper/system-root[/@/srv]                    btrfs  rw,relatime,s
|-/var/lib/named          /dev/mapper/system-root[/@/var/lib/named]          btrfs  rw,relatime,s
|-/var/lib/machines       /dev/mapper/system-root[/@/var/lib/machines]       btrfs  rw,relatime,s
|-/var/lib/libvirt/images /dev/mapper/system-root[/@/var/lib/libvirt/images] btrfs  rw,relatime,s
`-/var/log                /dev/mapper/system-root[/@/var/log]                btrfs  rw,relatime,s

# ls -l /boot/grub2
drwxr-xr-x 1 root root    0 Jul 12  2017 backgrounds
-rw-r--r-- 1 root root   15 Nov 21 11:51 device.map
drwxr-xr-x 1 root root   22 Nov 21 11:52 fonts
-rw------- 1 root root 7910 Nov 21 11:52 grub.cfg
-rw-r--r-- 1 root root 1024 Nov 21 11:51 grubenv
drwxr-xr-x 1 root root 6186 Nov 21 11:52 i386-pc
drwxr-xr-x 1 root root  356 Nov 21 11:52 locale
drwxr-xr-x 1 root root    6 Nov 21 11:50 themes
drwxr-xr-x 1 root root    0 Nov 21 11:47 x86_64-efi

# mkdir /tmp/btrfsroot

# mount -t btrfs -o subvolid=0 /dev/mapper/system-root /tmp/btrfsroot

# ls -l /tmp/btrfsroot
drwxr-xr-x 1 root root 72 Nov 21 11:47 @

# ls -l /tmp/btrfsroot/@
drwxr-x--- 1 root root   42 Nov 21 11:54 .snapshots
drwxr-xr-x 1 root root   10 Nov 21 11:47 boot
drwxr-xr-x 1 root root   14 Nov 21 11:47 etc
drwxr-xr-x 1 root root   16 Nov 21 11:51 home
drwxr-xr-x 1 root root    0 Jun 27  2017 opt
drwxr-xr-x 1 root root   12 Nov 21 11:47 srv
drwxrwxrwt 1 root root 1032 Dec  9 11:46 tmp
drwxr-xr-x 1 root root   10 Nov 21 11:47 usr
drwxr-xr-x 1 root root   54 Nov 21 11:47 var

# ls -l /tmp/btrfsroot/@/boot/
drwxr-xr-x 1 root root 34 Nov 21 11:47 grub2

# ls -l /tmp/btrfsroot/@/boot/grub2/
drwxr-xr-x 1 root root 6186 Nov 21 11:52 i386-pc
drwxr-xr-x 1 root root    0 Nov 21 11:47 x86_64-efi
</code></pre>
<p>so what looks like <code>/boot/grub2/i386-pc</code> on SLES12 with btrfs<br />
is actually <code>/@/boot/grub2/i386-pc</code> in the whole btrfs tree.</p>
<p>I guess with UEFI the same kind of confusion could happen.</p>
<p>I think what file and directory paths a GRUB2 command "sees"<br />
while it runs inside a normal running SLES with btrfs<br />
is different compared to what file and directory paths<br />
the GRUB2 bootloader "sees" on plain btrfs during booting.</p>
<p>Again:<br />
I am not at all an expert in this area so something of what I wrote
above<br />
could be wrong.</p>
<p>But what is true is that file and directory paths look different<br />
from inside a running SLES12 with its mounted btrfs stuff<br />
compared to when looking directly at the plain whole btrfs.</p>
<p>Cf. my fun with it in<br />
<a href="https://github.com/rear/rear/issues/1828">https://github.com/rear/rear/issues/1828</a><br />
see in particular<br />
<a href="https://github.com/rear/rear/issues/1828#issuecomment-396913152">https://github.com/rear/rear/issues/1828#issuecomment-396913152</a><br />
which proves things depend on how btrfs stuff is mounted inside SLE12.</p>
<h4 id="gozora_commented_at_2019-12-09_1134"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563195805">2019-12-09 11:34</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1134" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix i coldnt explain it better!<br />
It looks like <code>grub-mkstandalone</code> is doing something differently
compared to <code>grub-mkimage</code> ...</p>
<p>V.</p>
<h4 id="gozora_commented_at_2019-12-09_1248"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563223220">2019-12-09 12:48</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1248" title="Permanent link">&para;</a></h4>
<p>When I'm using "old" code ReaR executes code as follows:</p>
<pre><code>grub2-mkimage -v -O x86_64-efi --config /boot/grub2/rear_embed.cfg -o /boot/efi/EFI/BOOT/rear.efi -p /EFI/BOOT part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs lvm
</code></pre>
<p>However with "new" code, I have only following modules:</p>
<pre><code>2019-12-09 12:30:04.779046992 GRUB2 modules to load: btrfs fat part_gpt
</code></pre>
<p>Any idea why only 3 modules are auto-detected? (a site note; on this
server I don't have BTRFS located on LVM, so missing modules should not
be a showstopper for booting)</p>
<p>Excerpt from debug log:</p>
<pre><code>++ for bin in '$@'
++ type grub2-probe
++ return 0
++ gprobe=grub2-probe
++ '[' -n grub2-probe ']'
++ modules=($( for p in "${dirs[@]}" ; do
                             $gprobe --target=fs "$p"
                             $gprobe --target=partmap "$p" | sed -e 's/^/part_/'
                             $gprobe --target=abstraction "$p"
                         done | sort -u ))
+++ sort -u
+++ for p in '"${dirs[@]}"'
+++ grub2-probe --target=fs /boot
+++ sed -e 's/^/part_/'
+++ grub2-probe --target=partmap /boot
+++ grub2-probe --target=abstraction /boot
+++ for p in '"${dirs[@]}"'
+++ grub2-probe --target=fs /boot/efi
+++ sed -e 's/^/part_/'
+++ grub2-probe --target=partmap /boot/efi
+++ grub2-probe --target=abstraction /boot/efi
++ Log 'GRUB2 modules to load: btrfs fat part_gpt'
++ echo '2019-12-09 12:30:04.779046992 GRUB2 modules to load: btrfs fat part_gpt'
2019-12-09 12:30:04.779046992 GRUB2 modules to load: btrfs fat part_gpt
</code></pre>
<p>If I add modules manually by:</p>
<pre><code>GRUB2_MODULES="part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs lvm"
</code></pre>
<p>It still doesn't work though ... (when I type <code>ls</code> I get message
<code>ls module is missing</code> ...`</p>
<p>V.</p>
<h4 id="gozora_commented_at_2019-12-09_1253"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563224969">2019-12-09 12:53</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1253" title="Permanent link">&para;</a></h4>
<p>I can see that bootx64.efi and rear.efi are created differently:</p>
<pre><code>++ build_bootx86_efi /boot/efi/EFI/BOOT/rear.efi /boot/grub2/rear.cfg /boot /boot/efi

++ build_bootx86_efi /tmp/rear.g3pKTRZrSI3pKGk/tmp/mnt/EFI/BOOT/BOOTX64.efi /tmp/rear.g3pKTRZrSI3pKGk/tmp/mnt/EFI/BOOT/grub.cfg
</code></pre>
<p>What is the purpose of $3 and $4 when creating rear.efi ?</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1259"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563227236">2019-12-09 12:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1259" title="Permanent link">&para;</a></h4>
<blockquote>
<pre><code>++ build_bootx86_efi /boot/efi/EFI/BOOT/rear.efi /boot/grub2/rear.cfg /boot /boot/efi
</code></pre>
<p>What is the purpose of $3 and $4 when creating rear.efi ?</p>
</blockquote>
<p>The purpose is to pass directories/files that must be accessible from
Grub. My code makes sure that Grub modules needed to access those are
loaded. Without this feature, you would risk not having part_gpt and /
or btrfs modules loaded and you would not even see your /boot. (The log
snipped you have shown proves that this part is working correctly.)</p>
<h4 id="gozora_commented_at_2019-12-09_1301"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563228099">2019-12-09 13:01</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1301" title="Permanent link">&para;</a></h4>
<p>@pcahyna I guess I understand the purpose now! I'm in rush so I don't
read carefully :-(<br />
When <code>build_bootx86_efi()</code> gets $3 and 4$ it does some kind of
auto-detection otherwise you will include all available modules, right?</p>
<p>I guess this is not a good idea, since ESP can be located anywhere and
<em>/boot</em> doesn't need to exist at all ... Try to somehow reasonably
detect where is ESP located instead of hard-coding it.</p>
<p>It however still doesn't solve the problem that is auto-detection is
used <em>rear.efi</em> doesn't boot (at lest on SLES12SP4).</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1307"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563230169">2019-12-09 13:07</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1307" title="Permanent link">&para;</a></h4>
<blockquote>
<p>However with "new" code, I have only following modules:</p>
<pre><code>2019-12-09 12:30:04.779046992 GRUB2 modules to load: btrfs fat part_gpt
</code></pre>
<p>Any idea why only 3 modules are auto-detected? (a site note; on this
server I don't have BTRFS located on LVM, so missing modules should
not be a showstopper for booting)</p>
</blockquote>
<p>Because you don't need any other modules to access /boot, at least the
code thinks so. (As you say, missing lvm module is not a showstopper for
booting, so this part was detected correctly.)</p>
<p>Those three are not the only modules that get loaded. Those are
additional modules that are determined to be needed to access /boot.
Even with no modules here, grub-mkstandalone creates a basically usable
system (but it risks not being able to see /boot).</p>
<blockquote>
<p>If I add modules manually by:</p>
<pre><code>GRUB2_MODULES="part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs lvm"
</code></pre>
</blockquote>
<p>This shows that the problem is probably somewhere else than in a missing
module. I suspect a difference in the grub.cfg files.</p>
<blockquote>
<p>It still doesn't work though ... (when I type <code>ls</code> I get message
<code>ls module is missing</code> ...`</p>
</blockquote>
<p>Yes, that is a possible weakness in my treatment of GRUB2_MODULES. When
GRUB2_MODULES are given, they not only specify what modules to load,
but also what modules to install in the standalone image ramdisk. The
<code>ls</code> module is normally not loaded by default, but it is autoloaded when
needed. But since it has not been even installed, it can not be
autoloaded. Maybe I should use GRUB2_MODULES only to determine what
modules to load, and install all modules, or use a separate variable to
determine what modules to install.</p>
<h4 id="gozora_commented_at_2019-12-09_1309"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563230577">2019-12-09 13:09</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1309" title="Permanent link">&para;</a></h4>
<p>This one might help you a bit:</p>
<p>With "old" working code:<br />
<img alt="image" src="https://user-images.githubusercontent.com/12116358/70437853-d769cc00-1a8c-11ea-9c84-73e62d205afa.png" /><br />
Notice that <code>ls (hd1,gpt3)/boot</code> returns data from my BTRFS snapshot</p>
<p>Where "new" code:<br />
<img alt="image" src="https://user-images.githubusercontent.com/12116358/70437923-fd8f6c00-1a8c-11ea-9409-144ab59e28e0.png" /></p>
<p>Sees bare root filesystem when <code>ls (hd1,gpt3)</code> is executed, exactly as
@jsmeix mentioned in his
<a href="https://github.com/rear/rear/pull/2293#issuecomment-563186126">https://github.com/rear/rear/pull/2293#issuecomment-563186126</a>.</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1314"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563232699">2019-12-09 13:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1314" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna I guess I understand the purpose now! I'm in rush so I don't
read carefully :-(<br />
When <code>build_bootx86_efi()</code> gets $3 and 4$ it does some kind of
auto-detection otherwise you will include all available modules,
right?</p>
</blockquote>
<p>It always includes all available modules, but does not load all of them.
This autodetection determines additional modules to load. I.e. it does
not restrict modules to be loaded, it extends them.</p>
<blockquote>
<p>I guess this is not a good idea, since ESP can be located anywhere and
<em>/boot</em> doesn't need to exist at all ... Try to somehow reasonably
detect where is ESP located instead of hard-coding it.</p>
</blockquote>
<p>What is an ESP?</p>
<p>This hardcoding of <code>/boot</code> was already there, I did not change it. See
<a href="https://github.com/rear/rear/blob/60e19be52c3b93b1c8e70d71f35c9f11189809d0/usr/share/rear/output/default/940_grub2_rescue.sh#L42">https://github.com/rear/rear/blob/60e19be52c3b93b1c8e70d71f35c9f11189809d0/usr/share/rear/output/default/940_grub2_rescue.sh#L42</a></p>
<blockquote>
<p>It however still doesn't solve the problem that is auto-detection is
used <em>rear.efi</em> doesn't boot (at lest on SLES12SP4).</p>
</blockquote>
<p>Yes, I suppose it is unrelated to the modules issue. i don't think that
the module detection part malfunctioned here. Must be something in the
cfg file. Try setting btrfs_relative_path=y which I perhaps
overzealously removed in
<a href="https://github.com/rear/rear/pull/2293/files#diff-7f052550597fa70483fe418e92ef6f8cL164">https://github.com/rear/rear/pull/2293/files#diff-7f052550597fa70483fe418e92ef6f8cL164</a></p>
<h4 id="pcahyna_commented_at_2019-12-09_1315"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563233164">2019-12-09 13:15</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1315" title="Permanent link">&para;</a></h4>
<blockquote>
<p>This one might help you a bit:</p>
</blockquote>
<p>Thanks! Please try <code>btrfs_relative_path=y</code>.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1319"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563234574">2019-12-09 13:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1319" title="Permanent link">&para;</a></h4>
<p>ESP = EFI system partition, right? If so, this also has been hardcoded
before to <code>/boot/efi</code>, i.e. there is no support for having it located
"anywhere".<br />
<a href="https://github.com/rear/rear/blob/60e19be52c3b93b1c8e70d71f35c9f11189809d0/usr/share/rear/output/default/940_grub2_rescue.sh#L180">https://github.com/rear/rear/blob/60e19be52c3b93b1c8e70d71f35c9f11189809d0/usr/share/rear/output/default/940_grub2_rescue.sh#L180</a></p>
<h4 id="gozora_commented_at_2019-12-09_1323"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563236269">2019-12-09 13:23</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1323" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna</p>
<p><code>btrfs_relative_path=y</code> did the trick, <code>rear.efi</code> is booting now ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1324"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563236627">2019-12-09 13:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1324" title="Permanent link">&para;</a></h4>
<p>Thanks! I will add it back to the generated .cfg.</p>
<h4 id="gozora_commented_at_2019-12-09_1329"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563238743">2019-12-09 13:29</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1329" title="Permanent link">&para;</a></h4>
<blockquote>
<p>ESP = EFI system partition, right? If so, this also has been hardcoded
before to boot/efi, i.e. there is no support for having it located
"anywhere".</p>
</blockquote>
<p>This is not a good example, code you are referring to is buggy, I'm
currently working on PR to fix it, (see
<a href="https://github.com/gozora/rear/commit/b368b73a6b599f4d81bda45ff5b6a58547911c84">https://github.com/gozora/rear/commit/b368b73a6b599f4d81bda45ff5b6a58547911c84</a>)</p>
<h4 id="pcahyna_commented_at_2019-12-09_1343"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563244125">2019-12-09 13:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1343" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<p>ESP = EFI system partition, right? If so, this also has been
hardcoded before to boot/efi, i.e. there is no support for having it
located "anywhere".</p>
</blockquote>
<p>This is not a good example, code you are referring to is buggy, I'm
currently working on PR to fix it, (see
<a href="https://github.com/gozora/rear/commit/b368b73a6b599f4d81bda45ff5b6a58547911c84">gozora@b368b73</a>)</p>
</blockquote>
<p>I was working with what was there - if you introduce a variable for it,
I will use it.</p>
<p>Concerning your commit, I think you can use <code>grub2-probe -t device</code>
instead of <code>mount | grep "$esp_mountpoint" | awk '{print $1}'</code>.
<code>grub2-probe -t disk</code> and <code>grub2-probe -t fs_uuid</code> and
<code>grub2-mkrelpath</code> could also be very useful to simplify this code.</p>
<h4 id="gozora_commented_at_2019-12-09_1407"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563254078">2019-12-09 14:07</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1407" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Concerning your commit, I think you can use grub2-probe -t device
instead of mount | grep "$esp_mountpoint" | awk '{print $1}'.
grub2-probe -t disk and grub2-probe -t fs_uuid and grub2-mkrelpath
could also be very useful to simplify this code.</p>
</blockquote>
<p>Thanks, but I personally like <code>mount ...</code> better.</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-09_1412"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563255789">2019-12-09 14:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-09_1412" title="Permanent link">&para;</a></h4>
<p>The problem is, there is a lot of text-processing magic (which encodes
lots of special cases) to remove the partition identifier later down in
your code, and <code>grub2-probe -t disk</code> would probably be more robust, if
it works correctly.</p>
<h4 id="gozora_commented_at_2019-12-09_1421"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-563260195">2019-12-09 14:21</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-09_1421" title="Permanent link">&para;</a></h4>
<p>That text-processing magic is needed by<code>efibootmgr</code>.<br />
Because <code>efibootmgr</code> requires disk and partition to be entered
separately.</p>
<pre><code>efibootmgr --disk ${Disk} --part ${ParNr} ...
</code></pre>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-10_1335"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564034735">2019-12-10 13:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-10_1335" title="Permanent link">&para;</a></h4>
<p>@rmetrich , good catch! I rebased the PR to fix this and also to add
back btrfs_relative_path=y which should fix @gozora's btrfs case.</p>
<h4 id="pcahyna_commented_at_2019-12-10_1654"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564127654">2019-12-10 16:54</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-10_1654" title="Permanent link">&para;</a></h4>
<blockquote>
<p>That text-processing magic is needed by<code>efibootmgr</code>.<br />
Because <code>efibootmgr</code> requires disk and partition to be entered
separately.</p>
<pre><code>efibootmgr --disk ${Disk} --part ${ParNr} ...
</code></pre>
</blockquote>
<p>I see. You still need the magic to extract <code>${ParNr}</code>. But this is the
simpler part of the code, the most complicated and full of special cases
part is the one to extract <code>${Disk}</code>. And this is the part which would
IMHO benefit the most from using a single command like
<code>grub2-probe -t disk</code>, if it DTRT (needs to be tested especially on the
special cases like multipath, NVMe and MMC of course).</p>
<p>By the way, are those variables going to be used in another file? If
not, shouldn't they be lowercase and <code>local</code>?</p>
<h4 id="gozora_commented_at_2019-12-10_1709"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564134607">2019-12-10 17:09</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-10_1709" title="Permanent link">&para;</a></h4>
<p>Most of that code is borrowed from
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh">670_run_efibootmgr.sh</a>
and not written by me ...<br />
But I agree that everything can be written simpler and more elegant ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-10_1715"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564137081">2019-12-10 17:15</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-10_1715" title="Permanent link">&para;</a></h4>
<blockquote>
<p>If I add modules manually by:</p>
<pre><code>GRUB2_MODULES="part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs lvm"
</code></pre>
<p>It still doesn't work though ... (when I type <code>ls</code> I get message
<code>ls module is missing</code> ...`</p>
</blockquote>
<p>I dislike this part of the PR. I think that the error that you got is
unexpected and unhelpful. The PR changed semantics of GRUB2_MODULES a
bit: formerly it determined what modules to load, now it determines also
what modules to install into the standalone image ramdisk (and thus are
accessible for autoloading). I would like to change it back to
determining only what modules to load, and install all the modules, as
it is the default for grub-mkstandalone.<br />
For this, however, I would prefer to change the name of the variable to
GRUB2_MODULES_LOAD for symmetry with MODULES_LOAD. MODULES_LOAD is
an array of kernel modules that should be loaded, so in an analogy, the
list of GRUB2 modules to be loaded should be called
GRUB2_MODULES_LOAD. This opens the possibility of using GRUB2_MODULES
for the list of GRUB2 modules to install (if needed), in an analogy with
MODULES (which is a list of kernel modules to install). What do you
think?</p>
<h4 id="gozora_commented_at_2019-12-10_1805"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564158434">2019-12-10 18:05</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-10_1805" title="Permanent link">&para;</a></h4>
<p>@pcahyna don't forget to use reasonable defaults. We don't want users to
reconfigure ReaR after upgrade!<br />
Systems that booted fine prior this PR must boot after it as well ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-10_1814"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564162565">2019-12-10 18:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-10_1814" title="Permanent link">&para;</a></h4>
<p>The autodetection of modules that this PR adds actually moves in this
direction, as there will be (hopefully) less cases of broken GRUB2
images due to missing modules and inaccessible /boot.<br />
Concerning <code>GRUB2_MODULES</code>, there has not been a release with it yet, so
I hope it is acceptable to change the name, if we agree that
<code>GRUB2_MODULES_LOAD</code> is better suitable.</p>
<h4 id="jsmeix_commented_at_2019-12-11_0847"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564439509">2019-12-11 08:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-12-11_0847" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I like your config variable names cleanup proposal in your<br />
<a href="https://github.com/rear/rear/pull/2293#issuecomment-564137081">https://github.com/rear/rear/pull/2293#issuecomment-564137081</a></p>
<p>Normally we cannot change established config variable names<br />
because that would result regressions for users who use the<br />
old name in their etc/rear/local.conf file but in this case all is
o.k.<br />
because the GRUB2_MODULES config variable was introduced by<br />
<a href="https://github.com/rear/rear/commit/4ac6b69f77fe2952d479f2b441a8b8890d63853e">https://github.com/rear/rear/commit/4ac6b69f77fe2952d479f2b441a8b8890d63853e</a><br />
so that the GRUB2_MODULES config variable was never used<br />
in a released ReaR version.</p>
<p>We could even change an established config variable name<br />
if there is a serious reason for such a change but then we must<br />
either<br />
have backward compatibility code that maps values in the old named
variable<br />
into the new named variable (if such mapping is possible at all)<br />
or<br />
we must error out with a meaningful error message<br />
after reading all config files if the old name is used by the user<br />
so that the user is informed.</p>
<p>The question is when backward compatibility code is possible<br />
why the variable name needs to be changed at all<br />
and when backward compatibility code is there<br />
it needs to be maintained ad infinitum<br />
so perhaps the cleaner way is to error out if the old name is used<br />
because it is better to make a painful break than to draw out the pain.</p>
<h4 id="pcahyna_commented_at_2019-12-11_1045"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-564484690">2019-12-11 10:45</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-11_1045" title="Permanent link">&para;</a></h4>
<p>@jsmeix I pushed a commit to introduce GRUB2_MODULES_LOAD and to
change the semantics of GRUB2_MODULES to determine what modules are to
be installed in the ramdisk. I am not sure that GRUB2_MODULES is needed
at all after the introduction of GRUB2_MODULES_LOAD (will there ever
be a problem with the default of installing all modules
unconditionally)? but I added it for symmetry with MODULES and
MODULES_LOAD.</p>
<h4 id="gozora_commented_at_2019-12-15_2007"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-565842067">2019-12-15 20:07</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-15_2007" title="Permanent link">&para;</a></h4>
<p>Unfortunately I've found another problem while running some tests on
SLE15.<br />
When I tried to boot <code>rear.efi</code> I got stuck in boot process with
following message:<br />
<img alt="Screenshot from 2019-12-15
20-03-37" src="https://user-images.githubusercontent.com/12116358/70868030-76566280-1f7c-11ea-9c3f-224f9f747220.png" /><br />
I had to add <code>all_video</code> to GRUB2_MODULES_LOAD to fix this problem.<br />
I'm not really sure how this could efficiently solved, looks like hard
coding of at least some modules will be required after all ...</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2019-12-15_2215"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-565852543">2019-12-15 22:15</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-15_2215" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Unfortunately I've found another problem while running some tests on
SLE15.<br />
When I tried to boot <code>rear.efi</code> I got stuck in boot process with
following message:<br />
<img alt="Screenshot from 2019-12-15
20-03-37" src="https://user-images.githubusercontent.com/12116358/70868030-76566280-1f7c-11ea-9c3f-224f9f747220.png" /><br />
I had to add <code>all_video</code> to GRUB2_MODULES_LOAD to fix this
problem.<br />
I'm not really sure how this could efficiently solved, looks like hard
coding of at least some modules will be required after all ...</p>
<p>V.</p>
</blockquote>
<p>@gozora thanks for the test. The <code>all_video</code> module should not be built
into the image, grub-install does not do it either. Rather, there should
be a command to load it it the grub config file (look at your
distribution grub.cfg). create_grub2_cfg in
lib/bootloader-functions.sh does this already:<br />
<a href="https://github.com/rear/rear/blob/d8946bcc1cc61086b392e5d85ce956fdcd7d69cf/usr/share/rear/lib/bootloader-functions.sh#L497">https://github.com/rear/rear/blob/d8946bcc1cc61086b392e5d85ce956fdcd7d69cf/usr/share/rear/lib/bootloader-functions.sh#L497</a>,
so you should not have the problem with the ISO, but
940_grub2_rescue.sh does not use it (the function is not ready to be
used this way).<br />
The problem is, we have unified Grub2 image creation between the ISO and
GRUB2_RESCUE, but we have not unified the config file creation.</p>
<h4 id="pcahyna_commented_at_2019-12-15_2259"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-565856170">2019-12-15 22:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2019-12-15_2259" title="Permanent link">&para;</a></h4>
<p>@gozora hope your issue is fixed now. I just copied the graphics-related
code from create_grub2_cfg, because sharing the code would mean a
bigger refactoring.</p>
<h4 id="gozora_commented_at_2019-12-19_2057"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-567674054">2019-12-19 20:57</a>:<a class="headerlink" href="#gozora_commented_at_2019-12-19_2057" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna,</p>
<p>Thanks for your update, I'll test it again soon ...</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-01-20_2009"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-576415087">2020-01-20 20:09</a>:<a class="headerlink" href="#gozora_commented_at_2020-01-20_2009" title="Permanent link">&para;</a></h4>
<p>After running several other tests this PR looks good to me.<br />
If there aren't any further objections I'll merge it soon.</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2020-01-20_2023"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-576419593">2020-01-20 20:23</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-01-20_2023" title="Permanent link">&para;</a></h4>
<p>@gozora thanks for testing! Does it fix your btrfs-on-lvm case without
the need of setting GRUB2_MODULES(_LOAD) manually?</p>
<h4 id="gozora_commented_at_2020-01-20_2058"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-576428204">2020-01-20 20:58</a>:<a class="headerlink" href="#gozora_commented_at_2020-01-20_2058" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna, yes btrfs-on-lvm problem is now solved without any
explicit Grub module configuration inside ReaR.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-01-21_0949"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-576601904">2020-01-21 09:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-21_0949" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
currently you request changes here.<br />
Is your request still valid or is it meanwhile outdated or solved?</p>
<h4 id="gozora_commented_at_2020-01-23_1908"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-577828738">2020-01-23 19:08</a>:<a class="headerlink" href="#gozora_commented_at_2020-01-23_1908" title="Permanent link">&para;</a></h4>
<p>@pcahyna thanks for your work on this PR, it is appreciated!</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2020-01-30_1426"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2293#issuecomment-580277802">2020-01-30 14:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-01-30_1426" title="Permanent link">&para;</a></h4>
<blockquote>
<p>By the way, are those variables going to be used in another file? If
not, shouldn't they be lowercase and <code>local</code>?</p>
<p>Most of that code is borrowed from
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh">670_run_efibootmgr.sh</a>
and not written by me ...<br />
But I agree that everything can be written simpler and more elegant
...</p>
</blockquote>
<p>#2324</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-12-08.2293.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
