<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3189 Issue closed: BACKUP=TSM booting rescue system (ISO) on POWER fails (initrd bigger than 123 MiB) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3189 Issue closed: BACKUP=TSM booting rescue system (ISO) on POWER fails (initrd bigger than 123 MiB)";
        var mkdocs_page_input_path = "issues/2024-04-02.3189.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3189 Issue closed: BACKUP=TSM booting rescue system (ISO) on POWER fails (initrd bigger than 123 MiB)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3189_issue_closed_backuptsm_booting_rescue_system_iso_on_power_fails_initrd_bigger_than_123_mib"><a href="https://github.com/rear/rear/issues/3189">#3189 Issue</a> <code>closed</code>: BACKUP=TSM booting rescue system (ISO) on POWER fails (initrd bigger than 123 MiB)<a class="headerlink" href="#3189_issue_closed_backuptsm_booting_rescue_system_iso_on_power_fails_initrd_bigger_than_123_mib" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>external tool</code>, <code>special hardware or VM</code></p>
<h4 id="kai-uwe-rommel_opened_issue_at_2024-04-02_1317"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> opened issue at <a href="https://github.com/rear/rear/issues/3189">2024-04-02 13:17</a>:<a class="headerlink" href="#kai-uwe-rommel_opened_issue_at_2024-04-02_1317" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.7</p>
</li>
<li>
<p>If your ReaR version is not the current version, explain why you
    can't upgrade:<br />
    comes from SLES repository</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    NAME="SLES"<br />
    VERSION="15-SP5"<br />
    VERSION_ID="15.5"<br />
    PRETTY_NAME="SUSE Linux Enterprise Server 15 SP5"<br />
    ID="sles"<br />
    ID_LIKE="suse"<br />
    ANSI_COLOR="0;32"<br />
    CPE_NAME="cpe:/o:suse:sles:15:sp5"</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    OUTPUT=ISO<br />
    OUTPUT_URL=nfs://prometheus/nim/rear<br />
    BACKUP=TSM</p>
</li>
</ul>
<p>(The ISO file is then copied from the NFS server into the VIOS media
library and mounted into the new PowerVM LPAR as a virtual optical
drive.)</p>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    IBM PowerVM LPAR</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    PPC64LE</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    SAN w/multipath</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):<br />
<a href="https://github.com/rear/rear/files/14837097/lsblk.txt">lsblk.txt</a></p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    The rear invocation creates an ISO file and that looks fine to me.<br />
    When booting it in a new/blank PowerVM LPAR, it ends up with a
    kernel panic.<br />
    To me it looks like it does not load the initrd.<br />
    But the initrd file is in the ISO and seems to be referenced
    properly in the grub.cfg file.<br />
<a href="https://github.com/rear/rear/files/14837101/boot.log">boot.log</a><br />
    Please see content of the boot log file.</p>
</li>
<li>
<p>Workaround, if any:<br />
    unfortunately, none - need help</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2024-04-02_1446"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2032246470">2024-04-02 14:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-02_1446" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
please attach a "rear -D mkrescue" (or "rear -D mkbackup")<br />
debug log file.</p>
<p>In general:<br />
Caution with possible secrets in a debug log file:<br />
When 'rear' is run via '-D' in debugscript mode<br />
it logs executed commands via the bash command 'set -x'<br />
that print commands and their arguments as they are executed.<br />
So in particular when arguments contain secret values<br />
(e.g. something like a password or whatever else)<br />
such secret values may appear in the log file.<br />
Also secrets may be stored in some other files<br />
like /var/lib/rear/layout/disklayout.conf<br />
or /var/lib/rear/layout/diskrestore.sh<br />
cf. <code>[password=&lt;password&gt;]</code> in the section<br />
"Disk layout file syntax" in<br />
doc/user-guide/06-layout-configuration.adoc<br />
online at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc</a><br />
So before you attach your debug log file or other files here<br />
(GitHub is a public accessible place), inspect your files<br />
and verify that they do not accidentally cointain secrets.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-03_1631"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2035067568">2024-04-03 16:31</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-03_1631" title="Permanent link">&para;</a></h4>
<p>The mkrescue debug log:<br />
<a href="https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log">rear-mkrescue-debug.log</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-03_1632"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2035069769">2024-04-03 16:32</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-03_1632" title="Permanent link">&para;</a></h4>
<p>Also, let me know if you need access to the generated ISO file.</p>
<h4 id="jsmeix_commented_at_2024-04-08_0734"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042056222">2024-04-08 07:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-08_0734" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
it seems your<br />
<a href="https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log">https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log</a><br />
is only the terminal output of "rear -D mkrescue" (excerpts)</p>
<pre><code>hermes:~ # rear -D mkrescue
Relax-and-Recover 2.7 / 2022-07-13
Running rear mkrescue (PID 11791 date 2024-04-03 18:22:27)
Command line options: /usr/sbin/rear -D mkrescue
Using log file: /var/log/rear/rear-hermes.log
...
Running 'output' stage ======================
Making ISO image
Making ISO image
Wrote ISO image: /var/lib/rear/output/rear-hermes.iso (319M)
</code></pre>
<p>but I liked to get the debug log <strong>file</strong> i.e. the<br />
<code>log file: /var/log/rear/rear-hermes.log</code><br />
(except secret values if any).</p>
<p>Additionally please attach the terminal output of</p>
<pre><code># rear -s mkrescue
</code></pre>
<p>because in your<br />
<a href="https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log">https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log</a><br />
I am missing messages that tell a bootloader gets installed<br />
before the ISO is made.</p>
<p>For comparison on my x86_64 UEFI homeoffice workstation<br />
(excerpts):</p>
<pre><code># grep -v '^#' etc/rear/local.conf 
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL=file:///other/
...

# usr/sbin/rear -s mkrescue
...
Source output/ISO/Linux-i386/250_populate_efibootimg.sh
Source output/ISO/Linux-i386/260_EFISTUB_populate.sh
Source output/ISO/Linux-i386/300_create_isolinux.sh
Source output/default/400_copy_disk_struct_files.sh
Source output/ISO/Linux-i386/700_create_efibootimg.sh
Source output/ISO/Linux-i386/800_create_isofs.sh
Source output/ISO/Linux-i386/810_prepare_multiple_iso.sh
Source output/ISO/Linux-i386/820_create_iso_image.sh
Source output/ISO/Linux-i386/830_create_iso_image_EFISTUB.sh
Source output/ISO/Linux-i386/850_check_for_errors.sh
</code></pre>
<p>For PPC64LE we have</p>
<pre><code># ls -1 usr/share/rear/output/ISO/Linux-ppc64le
300_create_grub2.sh
800_create_isofs.sh
810_prepare_multiple_iso.sh
820_create_iso_image.sh
</code></pre>
<p>but usr/share/rear/output/ISO/Linux-ppc64le/300_create_grub2.sh<br />
does no output on the terminal and it does not error out when</p>
<pre><code>grub2-mkimage -O powerpc-ieee1275 ...
</code></pre>
<p>fails - at least this needs to be fixed, cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style#try-hard-to-care-about-possible-errors">https://github.com/rear/rear/wiki/Coding-Style#try-hard-to-care-about-possible-errors</a></p>
<p>So I need your debug log file /var/log/rear/rear-hermes.log<br />
to see in particular what goes on on your particular system<br />
while the GRUB2 bootloader is installed for the iso image.</p>
<h4 id="jsmeix_commented_at_2024-04-08_0743"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042071677">2024-04-08 07:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-08_0743" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
in your initial description you wrote</p>
<pre><code>But the initrd file is in the ISO and
seems to be referenced properly in the grub.cfg file.
https://github.com/rear/rear/files/14837101/boot.log
Please see content of the boot log file.
</code></pre>
<p>but I fail to see in your<br />
<a href="https://github.com/rear/rear/files/14837101/boot.log">https://github.com/rear/rear/files/14837101/boot.log</a><br />
that the initrd file is in the ISO and<br />
that it is referenced properly in the grub.cfg file,<br />
in particular I fail to see the grub.cfg file?</p>
<h4 id="jsmeix_commented_at_2024-04-08_0805"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042114550">2024-04-08 08:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-08_0805" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
see my "FYI (2)" part in<br />
<a href="https://github.com/rear/rear/discussions/3184#discussioncomment-8902863">https://github.com/rear/rear/discussions/3184#discussioncomment-8902863</a><br />
how you may use <code>KEEP_BUILD_DIR="yes"</code><br />
to inspect the recovery system contents after "rear mkrescue"<br />
so you could inspect in particular your grub.cfg file<br />
in your ReaR recovery system.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-08_1241"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042647866">2024-04-08 12:41</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-08_1241" title="Permanent link">&para;</a></h4>
<p>This is the output of "rear -s mkrescue":</p>
<pre><code>hermes:~ # rear -s mkrescue
Relax-and-Recover 2.7 / 2022-07-13
Running rear mkrescue (PID 8073 date 2024-04-08 14:39:53)
Using log file: /var/log/rear/rear-hermes.log
Simulation mode activated, Relax-and-Recover base directory: /usr/share/rear
Source conf/Linux-ppc64le.conf
Source conf/GNU/Linux.conf
Source conf/SUSE_LINUX.conf
Source init/default/005_verify_os_conf.sh
Source init/default/010_EFISTUB_check.sh
Source init/default/010_set_drlm_env.sh
Source init/default/030_update_recovery_system.sh
Source init/default/050_check_rear_recover_mode.sh
Source init/default/950_check_missing_programs.sh
Source prep/default/005_remove_workflow_conf.sh
Source prep/default/020_translate_url.sh
Source prep/default/030_translate_tape.sh
Source prep/default/035_valid_backup_methods.sh
Source prep/default/036_valid_output_methods.sh
Source prep/default/040_check_backup_and_output_scheme.sh
Source prep/default/050_check_keep_old_output_copy_var.sh
Source prep/default/100_init_workflow_conf.sh
Source prep/GNU/Linux/200_include_getty.sh
Source prep/GNU/Linux/200_include_serial_console.sh
Source prep/GNU/Linux/210_include_dhclient.sh
Source prep/GNU/Linux/220_include_lvm_tools.sh
Source prep/GNU/Linux/230_include_md_tools.sh
Source prep/GNU/Linux/240_include_multipath_tools.sh
Source prep/GNU/Linux/280_include_systemd.sh
Source prep/GNU/Linux/280_include_virtualbox.sh
Source prep/GNU/Linux/280_include_vmware_tools.sh
Source prep/GNU/Linux/290_include_drbd.sh
Source prep/GNU/Linux/300_check_backup_and_output_url.sh
Source prep/ISO/default/300_check_iso_dir.sh
Source prep/GNU/Linux/300_include_grub_tools.sh
Source prep/GNU/Linux/310_include_cap_utils.sh
Source prep/ISO/default/320_check_cdrom_size.sh
Source prep/default/320_include_uefi_env.sh
Source prep/ISO/GNU/Linux/320_verify_mkisofs.sh
Source prep/default/321_EFISTUB_check_uefi_env.sh
Source prep/default/330_include_uefi_tools.sh
Source prep/ISO/GNU/Linux/340_add_isofs_module.sh
Source prep/default/340_include_password_tools.sh
Source prep/ISO/GNU/Linux/360_EFISTUB_prechecks.sh
Source prep/default/380_include_opal_tools.sh
Source prep/GNU/Linux/400_guess_kernel.sh
Source prep/TSM/default/400_prep_tsm.sh
Source prep/default/400_save_directories.sh
Source prep/default/490_store_write_protect_settings.sh
Source prep/GNU/Linux/500_EFISTUB_check_kernel.sh
Source layout/save/GNU/Linux/100_create_layout_file.sh
Source layout/save/GNU/Linux/150_save_diskbyid_mappings.sh
Source layout/save/GNU/Linux/190_opaldisk_layout.sh
Source layout/save/GNU/Linux/200_partition_layout.sh
Source layout/save/GNU/Linux/210_raid_layout.sh
Source layout/save/GNU/Linux/220_lvm_layout.sh
Source layout/save/GNU/Linux/230_filesystem_layout.sh
Source layout/save/GNU/Linux/240_swaps_layout.sh
Source layout/save/GNU/Linux/250_drbd_layout.sh
Source layout/save/GNU/Linux/260_crypt_layout.sh
Source layout/save/GNU/Linux/270_hpraid_layout.sh
Source layout/save/GNU/Linux/280_multipath_layout.sh
Source layout/save/default/300_list_dependencies.sh
Source layout/save/default/310_autoexclude_usb.sh
Source layout/save/default/310_include_exclude.sh
Source layout/save/default/320_autoexclude.sh
Source layout/save/default/330_remove_exclusions.sh
Source layout/save/default/335_remove_excluded_multipath_vgs.sh
Source layout/save/GNU/Linux/340_false_blacklisted.sh
Source layout/save/default/340_generate_mountpoint_device.sh
Source layout/save/GNU/Linux/350_copy_drbdtab.sh
Source layout/save/default/350_save_partitions.sh
Source layout/save/default/400_check_backup_special_files.sh
Source layout/save/default/445_guess_bootloader.sh
Source layout/save/default/450_check_bootloader_files.sh
Source layout/save/default/450_check_network_files.sh
Source layout/save/default/490_check_files_to_patch.sh
Source layout/save/GNU/Linux/500_extract_vgcfg.sh
Source layout/save/GNU/Linux/510_current_disk_usage.sh
Source layout/save/default/600_snapshot_files.sh
Source layout/save/default/950_verify_disklayout_file.sh
Source rescue/default/010_merge_skeletons.sh
Source rescue/default/100_hostname.sh
Source rescue/default/200_etc_issue.sh
Source rescue/GNU/Linux/220_load_modules_from_initrd.sh
Source rescue/GNU/Linux/230_storage_and_network_modules.sh
Source rescue/GNU/Linux/240_kernel_modules.sh
Source rescue/GNU/Linux/250_udev.sh
Source rescue/GNU/Linux/260_collect_initrd_modules.sh
Source rescue/GNU/Linux/260_storage_drivers.sh
Source rescue/GNU/Linux/290_kernel_cmdline.sh
Source rescue/GNU/Linux/300_dns.sh
Source rescue/default/300_patch_root_home.sh
Source rescue/GNU/Linux/310_network_devices.sh
Source rescue/GNU/Linux/320_inet6.sh
Source rescue/GNU/Linux/350_routing.sh
Source rescue/GNU/Linux/390_check_usb_modules.sh
Source rescue/GNU/Linux/400_use_serial_console.sh
Source rescue/GNU/Linux/410_use_xen_console.sh
Source rescue/default/430_prepare_timesync.sh
Source rescue/GNU/Linux/500_clone_keyboard_mappings.sh
Source rescue/default/500_ssh.sh
Source rescue/GNU/Linux/550_copy_ldconfig.sh
Source rescue/default/550_vagrant.sh
Source rescue/default/850_save_sysfs_uefi_vars.sh
Source rescue/default/860_set_uefi_vars.sh
Source rescue/default/900_clone_users_and_groups.sh
Source rescue/default/910_copy_logfile.sh
Source rescue/GNU/Linux/950_cfg2html.sh
Source rescue/GNU/Linux/960_collect_MC_serviceguard_infos.sh
Source rescue/GNU/Linux/990_sysreqs.sh
Source build/GNU/Linux/005_create_symlinks.sh
Source build/GNU/Linux/090_create_lib_directories_and_symlinks.sh
Source build/GNU/Linux/100_copy_as_is.sh
Source build/GNU/Linux/110_touch_empty_files.sh
Source build/GNU/Linux/130_create_dotfiles.sh
Source build/GNU/Linux/150_adjust_permissions.sh
Source build/GNU/Linux/390_copy_binaries_libraries.sh
Source build/GNU/Linux/400_copy_modules.sh
Source build/GNU/Linux/420_copy_firmware_files.sh
Source build/GNU/Linux/450_symlink_mingetty.sh
Source build/default/490_fix_broken_links.sh
Source build/default/500_ssh_setup.sh
Source build/default/501_check_ssh_keys.sh
Source build/default/502_include_mdadm_conf.sh
Source build/default/503_store_tty_root_password.sh
Source build/GNU/Linux/600_verify_and_adjust_udev.sh
Source build/SUSE_LINUX/610_link_systemd_lib.sh
Source build/GNU/Linux/610_verify_and_adjust_udev_systemd.sh
Source build/GNU/Linux/620_verify_os_release_file.sh
Source build/GNU/Linux/630_simplify_systemd_reboot_halt_poweroff_shutdown.sh
Source build/GNU/Linux/630_verify_resolv_conf_file.sh
Source build/GNU/Linux/640_verify_lvm_conf.sh
Source build/default/950_check_missing_programs.sh
Source build/default/960_remove_encryption_keys.sh
Source build/default/970_add_rear_release.sh
Source build/default/975_update_os_conf.sh
Source build/default/990_verify_rootfs.sh
Source build/default/995_md5sums_rootfs.sh
Source pack/GNU/Linux/900_create_initramfs.sh
Source output/default/010_set_umask.sh
Source output/default/100_mount_output_path.sh
Source output/default/150_save_copy_of_prefix_dir.sh
Source output/default/200_make_boot_dir.sh
Source output/default/200_make_prefix_dir.sh
Source output/default/250_create_lock.sh
Source output/ISO/Linux-ppc64le/300_create_grub2.sh
Source output/default/400_copy_disk_struct_files.sh
Source output/ISO/Linux-ppc64le/800_create_isofs.sh
Source output/ISO/Linux-ppc64le/810_prepare_multiple_iso.sh
Source output/ISO/Linux-ppc64le/820_create_iso_image.sh
Source output/default/940_grub2_rescue.sh
Source output/default/940_grub_rescue.sh
Source output/default/950_copy_result_files.sh
Source output/TSM/default/950_dsmc_save_result_files.sh
Source output/default/950_email_result_files.sh
Source output/TSM/default/960_dsmc_verify_isofile.sh
Source output/default/970_remove_lock.sh
Source output/default/980_umount_output_dir.sh
Exiting rear mkrescue (PID 8073) and its descendant processes ...
Running exit tasks
</code></pre>
<h4 id="kai-uwe-rommel_commented_at_2024-04-08_1242"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042650472">2024-04-08 12:42</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-08_1242" title="Permanent link">&para;</a></h4>
<p>And this is the actual debug log from /var/log/rear:<br />
<a href="https://github.com/rear/rear/files/14905510/rear-mkrescue-debug.log">rear-mkrescue-debug.log</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-08_1244"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042658547">2024-04-08 12:44</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-08_1244" title="Permanent link">&para;</a></h4>
<p>After the "rear mkrescue" and after the failed boot I inspected the ISO
file:</p>
<pre><code>C:\IBM\Temp&gt;7z l rear-hermes.iso                                                     
7-Zip 22.00 (x64) : Copyright (c) 1999-2022 Igor Pavlov : 2022-06-15                 
Scanning the drive for archives:                                                     
1 file, 333985792 bytes (319 MiB)                                                    
Listing archive: rear-hermes.iso                                                     
--                                                                                   
Path = rear-hermes.iso                                                               
Type = Iso                                                                           
Physical Size = 333985792                                                            
Created = 2024-04-06 14:01:04.00                                                     
Modified = 2024-04-06 14:01:04.00                                                    
   Date      Time    Attr         Size   Compressed  Name                            
------------------- ----- ------------ ------------  ------------------------        
2024-04-06 14:01:04 D....                            boot                            
2024-04-06 14:01:03 D....                            boot\grub                       
2024-04-06 14:01:03 .....          115          115  boot\grub\grub.cfg              
2024-04-06 14:01:03 .....       383756       383756  boot\grub\powerpc.elf           
2024-04-06 14:01:00 .....    285125611    285125611  initrd.cgz                      
2024-02-12 13:14:40 .....     48086576     48086576  kernel                          
2024-04-06 14:01:04 D....                            ppc                             
2024-04-06 14:01:03 .....          160          160  ppc\bootinfo.txt                
------------------- ----- ------------ ------------  ------------------------        
2024-04-06 14:01:04          333596218    333596218  5 files, 3 folders
</code></pre>
<p>So there is both the initrd.cgz and the grub.cfg files.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-08_1245"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042660324">2024-04-08 12:45</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-08_1245" title="Permanent link">&para;</a></h4>
<p>And the grub.cfg file in the ISO contains:</p>
<pre><code>set timeout=100

menuentry "Relax-and-Recover" {
    linux   /kernel root=/dev/ram0  selinux=0
    initrd  /initrd.cgz
}
</code></pre>
<h4 id="jsmeix_commented_at_2024-04-08_1427"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2042901448">2024-04-08 14:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-08_1427" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
thank you for your prompt replies!</p>
<p>Now I am stuck because everything looks OK<br />
(as far as I can see) but things are not OK.</p>
<p>I am not a booting expert and I know basically nothing<br />
about POWER architecure specific things - I only know<br />
that low-level things when booting on POWER architecture<br />
are rather different compared to booting on x86 architecture.</p>
<p>As far as I know currently we do not have<br />
an active ReaR upstream maintainer who is an<br />
expert in POWER architecure specific things.</p>
<p>The /etc/os-release in your initial comment shows<br />
you have "SUSE Linux Enterprise Server 15 SP5".</p>
<p>Is this exactly what you actually have or do you perhaps have<br />
a SUSE product/extension where SUSE officially supports ReaR?</p>
<p>Because in your initial comment you wrote (excerpts):</p>
<pre><code>ReaR version 2.7
...
comes from SLES repository
</code></pre>
<p>it indicates that you have a SUSE product/extension<br />
where SUSE officially supports ReaR because otherwise<br />
I assume you won't have ReaR from a SLES repository<br />
(I mean from an official SUSE SLES repository).</p>
<p>See the section "SUSE support for Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>For example - as far as I know (no warranty) - the<br />
SUSE Linux Enterprise High Availability Extension<br />
is included in<br />
SUSE Linux Enterprise Server for SAP Applications.</p>
<p>If you have a SUSE product/extension<br />
where SUSE officially supports ReaR<br />
I would recommend that you file<br />
an official support request at SUSE<br />
via your official support contact at SUSE.<br />
If you do that please provide an URL to this issue<br />
in your SUSE support request.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-09_1436"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2045343704">2024-04-09 14:36</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-09_1436" title="Permanent link">&para;</a></h4>
<p>It is indeed a SLES 15 and might even be a SLES 15 for SAP, I will have
to check.<br />
When I started this, I just looked and found that SUSE made ReaR
available through their SLES 15 repository so this made things easier as
I did not have to add some other repo or install it manually.<br />
When it comes from the standard SLES 15 repo, will SUSE then support
it?<br />
I will open a ticket and try to get support ...</p>
<h4 id="jsmeix_commented_at_2024-04-09_1519"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2045457648">2024-04-09 15:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-09_1519" title="Permanent link">&para;</a></h4>
<p>As far as I know - at least in the usual cases -<br />
SUSE provides Relax-and-Recover (ReaR) only via the<br />
SUSE Linux Enterprise High Availability Extension (SLE-HA)<br />
which is the only SUSE product/extension<br />
where SUSE officially supports ReaR.</p>
<p>But what matters in the end is what your particular<br />
support contract states.</p>
<p>It cannot be wrong to open a ticket at SUSE.<br />
In the worst case you get notified that ReaR is not<br />
supported with your current support contract.</p>
<p>Your<br />
<a href="https://github.com/rear/rear/files/14837097/lsblk.txt">https://github.com/rear/rear/files/14837097/lsblk.txt</a><br />
shows "/hana/" mountpoints which indicate you run SAP HANA<br />
which further indicates you have SLES for SAP Applications<br />
which is rather common for SAP HANA on POWER architecture.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-09_1520"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2045459753">2024-04-09 15:20</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-09_1520" title="Permanent link">&para;</a></h4>
<p>I have checked and we do have</p>
<ul>
<li>High Availability Extension</li>
<li>SLES for SAP Applications<br />
    So we should be covered.</li>
</ul>
<h4 id="kai-uwe-rommel_commented_at_2024-04-09_1528"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2045485364">2024-04-09 15:28</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-09_1528" title="Permanent link">&para;</a></h4>
<p>The strange thing is that the SUSE customer portal does not let me
create a support case and insists that "You are not currently entitled
to use the support system" - we will have te check what is missing
there.</p>
<h4 id="jsmeix_commented_at_2024-04-12_1238"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2051683257">2024-04-12 12:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-12_1238" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel</p>
<p>an offhanded idea based on what I vaguely remember<br />
from the past about booting issues which we had<br />
here at ReaR upstream with POWER architecture:</p>
<p>You use 'BACKUP=TSM' which means<br />
all what TSM needs to restore a TSM backup<br />
gets included in the ReaR recovery system.</p>
<p>As far as I vaguely remember those TSM restore parts<br />
are relatively big so the initrd which contains the<br />
ReaR recovery system becomes relatively big.<br />
In your case according to your<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2042658547">https://github.com/rear/rear/issues/3189#issuecomment-2042658547</a></p>
<pre><code>   Date      Time    Attr         Size   Compressed  Name
...
2024-04-06 14:01:00 .....    285125611    285125611  initrd.cgz
</code></pre>
<p>your initrd is about 272 MiB big<br />
(285125611 / 1024 / 1024 = 271.9).</p>
<p>As far as I vaguely remember there can be<br />
weird (inexplicable) booting issues on POWER architecture<br />
when the initrd is "somehow too big".<br />
As far as I vaguely remember in such cases<br />
there are no helpful (error) messages during booting<br />
but it only "just somehow does not work".</p>
<p>To find out if the initrd size causes this issue here<br />
I would like to suggest that you replace<br />
'BACKUP=TSM' with 'BACKUP=REQUESTRESTORE' i.e.</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://prometheus/nim/rear
BACKUP=REQUESTRESTORE
</code></pre>
<p>then make a new ReaR recovery system ISO image with</p>
<pre><code># rear -D mkrescue
</code></pre>
<p>and inspect the new ISO same as what you did for your<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2042658547">https://github.com/rear/rear/issues/3189#issuecomment-2042658547</a><br />
and post the numbers for the new ISO here.</p>
<p>Also try out if that boots the ReaR recovery system<br />
i.e. if it works that you can log in as 'root'<br />
in the booted ReaR recovery system.</p>
<p>You cannot use that new ISO to recreate a system<br />
because with 'BACKUP=REQUESTRESTORE'<br />
no backup restore software is included<br />
in the ReaR recovery system, see the<br />
'BACKUP=REQUESTRESTORE' description in "man rear"<br />
e.g. online at<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a></p>
<p>That new ISO is only used here to find out<br />
if the initrd size causes this issue here.</p>
<h4 id="jsmeix_commented_at_2024-04-12_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2051701776">2024-04-12 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-12_1250" title="Permanent link">&para;</a></h4>
<p>Only as a side note FYI:<br />
I found an older issue about initrd size on POWER architecture<br />
<a href="https://github.com/rear/rear/issues/1142">https://github.com/rear/rear/issues/1142</a><br />
but that one is about booting on ppc64 via yaboot<br />
while here GRUB2 is used as bootloader.</p>
<h4 id="jsmeix_commented_at_2024-04-12_1308"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2051730662">2024-04-12 13:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-12_1308" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
another offhanded idea what might help:</p>
<p>In your<br />
<a href="https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log">https://github.com/rear/rear/files/14855435/rear-mkrescue-debug.log</a><br />
I see</p>
<pre><code>Using '/usr/bin/mkisofs' to create ISO filesystem images
</code></pre>
<p>Nowadays 'xorrisofs' is in general considered "better"<br />
than the traditional 'mkisofs' (I know basically nothing<br />
about the details of making ISO images so I cannot explain<br />
why 'xorrisofs' is considered "better" than 'mkisofs').<br />
Using 'xorrisofs' preferred was added via<br />
<a href="https://github.com/rear/rear/commit/fb5bebca167ce5e4ca151292c00958f41f4d9ba4">https://github.com/rear/rear/commit/fb5bebca167ce5e4ca151292c00958f41f4d9ba4</a><br />
that points to<br />
<a href="https://github.com/rear/rear/pull/962">https://github.com/rear/rear/pull/962</a><br />
but there is no explanation WHY 'xorrisofs' is preferred.<br />
I guess at that time it was preferred just because<br />
'xorrisofs' worked for Debian where the other ones<br />
had issues.<br />
But at least<br />
<a href="https://github.com/rear/rear/issues/3084">https://github.com/rear/rear/issues/3084</a><br />
shows a case where 'xorrisofs' is better on UEFI systems<br />
where otherwise 'ebiso' was needed as a workaround, cf.<br />
<a href="https://github.com/rear/rear/issues/3084#issuecomment-1835840904">https://github.com/rear/rear/issues/3084#issuecomment-1835840904</a></p>
<p>By default on SLES 15 you get '/usr/bin/mkisofs' installed<br />
but 'xorrisofs' (in RPM package 'xorriso') should be also<br />
available for SLES 15, cf.<br />
<a href="https://github.com/rear/rear/issues/3084#issuecomment-1833496190">https://github.com/rear/rear/issues/3084#issuecomment-1833496190</a></p>
<p>When you install the RPM package 'xorriso' (this is possible<br />
in addition to an already installed RPM package 'mkisofs')<br />
then ReaR will automatically use 'xorrisofs' via how<br />
ISO_MKISOFS_BIN is set in usr/share/rear/conf/default.conf<br />
see<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L893">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L893</a><br />
and you will see that during "rear -D mkrescue" as</p>
<pre><code>Using '/usr/bin/xorrisofs' to create ISO filesystem images
</code></pre>
<p>So please also try out if it helps in your case<br />
when you use 'xorrisofs' to make the ISO image.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-24_1514"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075190336">2024-04-24 15:14</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-24_1514" title="Permanent link">&para;</a></h4>
<p>Sorry for being quiet for two weeks ...</p>
<p>I just tested with BACKUP=REQUESTRESTORE and this results in a initrd of
size 116 MB compared to the 278 MB with TSM client. The resulting ISO
booted successfully and I end up with a root shell of the rescue system.</p>
<p>Next I changed back to BACKUP=TSM, installed the xorriso package and got
a new ISO with a 278 MB sized initrd again. Booting this ISO led to the
same kernel panic (initrd not loaded) like the original one.</p>
<p>So regardless of mkisofs or xorrisofs this seems to be a problem of
initrd size ... which options do we have now? Where to report the
problem so that it gets a chance of being fixed?</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-24_1525"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075212421">2024-04-24 15:25</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-24_1525" title="Permanent link">&para;</a></h4>
<p>Since we use TSM here I thought this would really have been a very
convenient solution.<br />
For the time being I will look for other options. So I just tried with
BACKUP=NETFS to the same NFS location.<br />
Strangely, a "rear mkbackup" resulted in an empty backup.tar.gz file
being created there except for a log file in it:</p>
<pre><code>root@prometheus:/nim/rear/hermes # gzip -dc backup.tar.gz |tar tvf -
-rw------- 0   0    50348 Apr 24 17:17:47 2024 var/log/rear/rear-hermes.8241.log
</code></pre>
<p>Probably I somewhere have to define some include/exclude list (such as
of filesystems) what to back up?</p>
<p>Does rear create the backup.tar.gz really first completely on local disk
and copies it to NFS afterwards?<br />
So always need to have enough local space but currently there definitely
is.</p>
<h4 id="jsmeix_commented_at_2024-04-24_1551"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075276666">2024-04-24 15:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-24_1551" title="Permanent link">&para;</a></h4>
<p>Regarding compression of the initramfs/initrd<br />
see REAR_INITRD_COMPRESSION in default.conf<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L3425">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L3425</a><br />
so perhaps</p>
<pre><code>REAR_INITRD_COMPRESSION="lzma"
</code></pre>
<p>may help to get a sufficiently small initrd, see also<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/RHEL7-PPC64LE-Multipath-PXE-GRUB.conf#L42">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/RHEL7-PPC64LE-Multipath-PXE-GRUB.conf#L42</a></p>
<p>I suggest to report the problem with initrd size<br />
on POWER architecture to SUSE because we have people at SUSE<br />
who know much more than I about POWER architecture.<br />
Alternatively or additionally I suggest to also report<br />
that generic problem with initrd size on POWER architecture<br />
to IBM because they should know better than anyone else<br />
what one could do to boot a POWER machine<br />
with a relatively big initrd.</p>
<p>Regarding BACKUP=NETFS:</p>
<p>Please provide a "rear -D mkbackup" debug log file<br />
for the BACKUP=NETFS case so that I could (hopefully)<br />
understand why you get an empty backup.tar.gz.</p>
<p>You may have a look at my examples in<br />
<a href="https://github.com/rear/rear/wiki/Test-Matrix-ReaR-2.7">https://github.com/rear/rear/wiki/Test-Matrix-ReaR-2.7</a><br />
how I used BACKUP=NETFS for my tests.<br />
In most of my cases I used the SUSE default btrfs structure<br />
so I needed some special settings in etc/rear/local.conf<br />
according to<br />
usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf</a></p>
<p>If you use the SUSE default btrfs structure without that<br />
special settings your backup.tar.gz would be incomplete<br />
but (as far as I currently imagine) you should not get an<br />
empty backup.tar.gz (something should be directly in '/').</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-24_1635"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075384966">2024-04-24 16:35</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-24_1635" title="Permanent link">&para;</a></h4>
<p>Using the compression got the initrd down to 211 MB but it still does
not load.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-24_1654"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075417949">2024-04-24 16:54</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-24_1654" title="Permanent link">&para;</a></h4>
<p>Here is the log file from a "rear -D mkbackup".<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">rear-hermes.log</a><br />
I would like to get just the entire root file system into the backup.<br />
We have installed everything into one / file system except the actual
SAP installation and data.<br />
And the root file system is the only logical volume in the "system"
volume group.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-24_1716"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2075453837">2024-04-24 17:16</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-24_1716" title="Permanent link">&para;</a></h4>
<p>I have created a SUSE support case.</p>
<h4 id="jsmeix_commented_at_2024-04-25_1113"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2076939562">2024-04-25 11:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-25_1113" title="Permanent link">&para;</a></h4>
<p>Regarding initrd size I see now<br />
that also on POWER the newer default</p>
<pre><code>MODULES=( 'all_modules' )
</code></pre>
<p>is used and accordingly your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
contains (excerpts)</p>
<pre><code>+ source /usr/share/rear/build/GNU/Linux/400_copy_modules.sh
...
++ LogPrint 'Copying all kernel modules in /lib/modules/5.14.21-150500.55.49-default (MODULES contains '\''all_modules'\'')'
</code></pre>
<p>so it should help to get a noticeably smaller initrd<br />
when you use something like</p>
<pre><code>MODULES=( 'loaded_modules' )
</code></pre>
<p>see the <code>MODULES</code> description in<br />
usr/share/rear/conf/default.conf<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1540">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1540</a></p>
<p><code>MODULES=( 'all_modules' )</code> was introduced<br />
in ReaR version 2.5 (May 2019), see<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/doc/rear-release-notes.txt#L2242">https://github.com/rear/rear/blob/rear-2.7/doc/rear-release-notes.txt#L2242</a><br />
for the reasoning behind why that was set as default.</p>
<h4 id="jsmeix_commented_at_2024-04-25_1126"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2076960341">2024-04-25 11:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-25_1126" title="Permanent link">&para;</a></h4>
<p>FYI<br />
regarding firmware files which make the initrd really big,<br />
see my numbers on x86<br />
<a href="https://github.com/rear/rear/discussions/2640#discussioncomment-908335">https://github.com/rear/rear/discussions/2640#discussioncomment-908335</a></p>
<pre><code>On my openSUSE Leap 15.2 system
I get this ReaR recovery system sizes:
By default:
-----------------------------------------------
# du -hs /tmp/rear.EHYoS4gnFtyPRE4/rootfs/
953M    /tmp/rear.EHYoS4gnFtyPRE4/rootfs/
-----------------------------------------------

With FIRMWARE_FILES=( 'no' ):
-----------------------------------------------
# du -hs /tmp/rear.GuUugJjsXSfC3G2/rootfs/
454M    /tmp/rear.GuUugJjsXSfC3G2/rootfs/
-----------------------------------------------

With FIRMWARE_FILES=( 'no' ) and MODULES=( 'loaded_modules' ):
-----------------------------------------------
# du -hs /tmp/rear.OF6uW70Cp1l2yv1/rootfs/
201M    /tmp/rear.OF6uW70Cp1l2yv1/rootfs/
-----------------------------------------------

So I get about 200M for the bare ReaR recovery system
plus about 250M for all kernel modules
plus about 500M for the firmware files.
</code></pre>
<p>Those numbers are the uncompressed ReaR recovery system<br />
files in /tmp/rear.XXXXXXXXXXXXXXX/rootfs/</p>
<p>On POWER this is different by default<br />
because we set <code>FIRMWARE_FILES=( 'no' )</code> in<br />
usr/share/rear/conf/Linux-ppc64.conf and<br />
usr/share/rear/conf/Linux-ppc64le.conf<br />
when the default 'FIRMWARE_FILES=()' is used<br />
so on POWER by default no firmware files are included<br />
in the initrd and accordingly there is in your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a></p>
<pre><code>+ source /usr/share/rear/build/GNU/Linux/420_copy_firmware_files.sh
...
++ LogPrint 'Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='\''no'\'')'
</code></pre>
<h4 id="jsmeix_commented_at_2024-04-25_1157"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077011476">2024-04-25 11:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-25_1157" title="Permanent link">&para;</a></h4>
<p>I see that the NETFS backup.tar.gz is empty<br />
but currently I do not yet understand why...</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-25_1224"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077059682">2024-04-25 12:24</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-25_1224" title="Permanent link">&para;</a></h4>
<p>When I look at the backup.log I can see that tar is called explicitly
with (only) the log file path/name as the argument of what to store.
Instead, / should have been passed. It also already gets
--one-file-system passed. Based on that, it is no wonder that a
backup.tar.gz is produced with only the log file included. If / would
have been passed to it (with the --one-file-system) it would have been
correct. The question is, why is the tar command constructed this way?
Also, there is some strange include/exclude file magic. The log shows a
command to "cat" a backup-include.txt but the tar command gets a
backup-exclude.txt file passed with the -X option.<br />
<a href="https://github.com/rear/rear/files/15109661/backup.log">backup.log</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-25_1245"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077095800">2024-04-25 12:45</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-25_1245" title="Permanent link">&para;</a></h4>
<p>Using MODULES=( 'loaded_modules' ) (and compression) gets the initrd
down to 162 MB with BACKUP=TSM. Unfortunately, this still does not load
but ends up in a kernel panic. We know (see above) that a 116 MB one
would work ... but I guess we do not have any more options to further
reduce the size.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-25_1252"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077109845">2024-04-25 12:52</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-25_1252" title="Permanent link">&para;</a></h4>
<p>The question is now what the actual limit of initrd size is. And why
grub (is it grub's problem?) imposes it.</p>
<h4 id="jsmeix_commented_at_2024-04-25_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077138656">2024-04-25 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-25_1306" title="Permanent link">&para;</a></h4>
<p>Regarding the size of what is included<br />
in the ReaR recovery system for TSM<br />
see in usr/share/rear/conf/default.conf<br />
the things about COPY_AS_IS_TSM<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L2087">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L2087</a></p>
<p>That part originated at<br />
<a href="https://github.com/rear/rear/commit/1e5236dc99d223861c6cca17fc98a8bf469b3a9a">https://github.com/rear/rear/commit/1e5236dc99d223861c6cca17fc98a8bf469b3a9a</a><br />
which points to<br />
<a href="https://github.com/rear/rear/pull/1566">https://github.com/rear/rear/pull/1566</a><br />
from @schabrolles who contributed so much<br />
for POWER support in ReaR but he is no longer<br />
an active ReaR upstream maintainer.</p>
<p>It depends on what you actually need from TSM<br />
during "rear recover" to restore a TSM backup.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-25_1323"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077172591">2024-04-25 13:23</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-25_1323" title="Permanent link">&para;</a></h4>
<p>Thanks for the pointer. See my comment on
<a href="https://github.com/rear/rear/pull/1566">https://github.com/rear/rear/pull/1566</a>.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-25_1437"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2077367609">2024-04-25 14:37</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-25_1437" title="Permanent link">&para;</a></h4>
<p>Sounds like getting POWER and grub to load a larger initrd is not an
option?</p>
<h4 id="jsmeix_commented_at_2024-04-26_0656"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2078747358">2024-04-26 06:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-26_0656" title="Permanent link">&para;</a></h4>
<p>I am not a booting expert but I think GRUB is not the reason.<br />
I think GRUB can load the initrd because I assume otherwise<br />
there would be some GRUB or kernel error message, e.g. as in<br />
<a href="https://www.ibm.com/support/pages/system-boot-ends-grub-out-memory-oom">https://www.ibm.com/support/pages/system-boot-ends-grub-out-memory-oom</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-26_1725"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2079794186">2024-04-26 17:25</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-26_1725" title="Permanent link">&para;</a></h4>
<p>I finally got a rescue image with TSM client small enough. From the SUSE
support case I got the information that the initrd image inside the ISO
needs to be smaller than the limit of 124 MB for POWER.</p>
<p>I decided to not use an explicit file list in COPY_AS_IS_TSM but
stick with the default values for it and instead specifically exclude
large but not needed files (most of them foreign language files) from
the image. This approach should be safer for future changes of the TSM
client.</p>
<p>That saved a LOT and got the initrd down to 120 MB even with default
gzip compression. With lzma it is only 77 MB. Of course,
MODULES=('loaded_modules') is also needed. But when using lzma
compression, the "rear mkrescue" runs 3 instead of 1 minute.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-26_1726"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2079795619">2024-04-26 17:26</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-26_1726" title="Permanent link">&para;</a></h4>
<p>The values used now are:</p>
<pre><code>COPY_AS_IS_TSM=( /etc/adsm
                 /opt/tivoli/tsm/client
                 /usr/local/ibm/gsk8* )
COPY_AS_IS_EXCLUDE_TSM=( /opt/tivoli/tsm/client/ba/bin/*.jar
                         /opt/tivoli/tsm/client/ba/bin/*.log*
                         /opt/tivoli/tsm/client/ba/bin/CS_CZ
                         /opt/tivoli/tsm/client/ba/bin/DE_DE
                         /opt/tivoli/tsm/client/ba/bin/ES_ES
                         /opt/tivoli/tsm/client/ba/bin/FR_FR
                         /opt/tivoli/tsm/client/ba/bin/HU_HU
                         /opt/tivoli/tsm/client/ba/bin/IT_IT
                         /opt/tivoli/tsm/client/ba/bin/JA_JP
                         /opt/tivoli/tsm/client/ba/bin/KO_KR
                         /opt/tivoli/tsm/client/ba/bin/PL_PL
                         /opt/tivoli/tsm/client/ba/bin/PT_BR
                         /opt/tivoli/tsm/client/ba/bin/RU_RU
                         /opt/tivoli/tsm/client/ba/bin/ZH_CN
                         /opt/tivoli/tsm/client/ba/bin/ZH_TW
                         /opt/tivoli/tsm/client/api/bin64/CS_CZ
                         /opt/tivoli/tsm/client/api/bin64/DE_DE
                         /opt/tivoli/tsm/client/api/bin64/ES_ES
                         /opt/tivoli/tsm/client/api/bin64/FR_FR
                         /opt/tivoli/tsm/client/api/bin64/HU_HU
                         /opt/tivoli/tsm/client/api/bin64/IT_IT
                         /opt/tivoli/tsm/client/api/bin64/JA_JP
                         /opt/tivoli/tsm/client/api/bin64/KO_KR
                         /opt/tivoli/tsm/client/api/bin64/PL_PL
                         /opt/tivoli/tsm/client/api/bin64/PT_BR
                         /opt/tivoli/tsm/client/api/bin64/RU_RU
                         /opt/tivoli/tsm/client/api/bin64/ZH_CN
                         /opt/tivoli/tsm/client/api/bin64/ZH_TW )
</code></pre>
<p>Yes, the exclude line is very long ...</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-26_1738"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2079811746">2024-04-26 17:38</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-26_1738" title="Permanent link">&para;</a></h4>
<p>And with some brainstorming about a smarter wildcard, I got that to
collapse quite neatly into a very short list:</p>
<pre><code>COPY_AS_IS_TSM=( /etc/adsm
                 /opt/tivoli/tsm/client
                 /usr/local/ibm/gsk8* )
COPY_AS_IS_EXCLUDE_TSM=( /opt/tivoli/tsm/client/ba/bin/*.jar
                         /opt/tivoli/tsm/client/ba/bin/*.log*
                         /opt/tivoli/tsm/client/*/*/[A-Z][!N]_?? )
</code></pre>
<h4 id="kai-uwe-rommel_commented_at_2024-04-26_1743"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2079818321">2024-04-26 17:43</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-26_1743" title="Permanent link">&para;</a></h4>
<p>Ok, problem solved. What's left:</p>
<p>Shouldn't we solve the BACKUP=NETFS issue with the empty backup.tar.gz
file? Probably I should open a separate issue?</p>
<h4 id="jsmeix_commented_at_2024-04-29_0725"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082048824">2024-04-29 07:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_0725" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
thank you so much for the information how one can get<br />
the TSM client in the ReaR recovery system smaller.<br />
I will enhance things accordingly.</p>
<p>Usually we at ReaR upstream do not have or use<br />
third-party backup tools (in particular not<br />
if a third-party backup tool is proprietary software)<br />
so usually we cannot reproduce issues<br />
with third-party backup tools.<br />
Therefore we totally depend on contributions and<br />
help from users who use and know about a specific<br />
third-party backup tool.</p>
<p>Regarding your<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2079811746">https://github.com/rear/rear/issues/3189#issuecomment-2079811746</a></p>
<pre><code>COPY_AS_IS_EXCLUDE_TSM=( ...
                         /opt/tivoli/tsm/client/*/*/[A-Z][!N]_?? )
</code></pre>
<p>I assume <code>[A-Z][!N]_</code> is to exclude <code>EN_</code><br />
to keep English language files?</p>
<p>Regarding the empty NETFS backup:<br />
I did not further analyze its root cause<br />
because I assumed TSM is more important for you.<br />
Will analyze the empty NETFS backup root cause.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-29_0730"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082056158">2024-04-29 07:30</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-29_0730" title="Permanent link">&para;</a></h4>
<p>Yes, the wildard excludes all but the EN_US language subdirectory.</p>
<p>Sure the route using TSM is my primary goal. But since I discovered the
NETFS issue as a collateral, I think it should be fixed as well. Also,
I'm not done with a complete recovery test with TSM yet. I may encounter
other issues, even showstoppers. So I think that NETFS may be important
as a fallback for us.</p>
<h4 id="jsmeix_commented_at_2024-04-29_0734"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082061363">2024-04-29 07:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_0734" title="Permanent link">&para;</a></h4>
<p>Yes of course NETFS is the ReaR standard method<br />
so the "empty NETFS backup" root cause needs to be found.<br />
It was only what to do with highest priority in your case.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-29_0906"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082216549">2024-04-29 09:06</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-29_0906" title="Permanent link">&para;</a></h4>
<p>If you touch this: by default, it should exclude /var/lib/rear/output.</p>
<h4 id="jsmeix_commented_at_2024-04-29_0913"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082229604">2024-04-29 09:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_0913" title="Permanent link">&para;</a></h4>
<p>As far as I can see /var/lib/rear/output<br />
is excluded from the ReaR recovery system via<br />
those settings in default.conf:</p>
<pre><code>COPY_AS_IS=( $SHARE_DIR $VAR_DIR )

COPY_AS_IS_EXCLUDE=( $VAR_DIR/output/\* dev/.udev dev/shm dev/shm/\* dev/oracleasm dev/mapper dev/watchdog\* )
</code></pre>
<p>where VAR_DIR is set in usr/sbin/rear</p>
<pre><code>VAR_DIR="$REAR_DIR_PREFIX/var/lib/rear"
</code></pre>
<h4 id="kai-uwe-rommel_commented_at_2024-04-29_0915"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082234235">2024-04-29 09:15</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-29_0915" title="Permanent link">&para;</a></h4>
<p>I may have overlooked it but I thought I did not see it in the actually
generated tar command in the NETFS backup log.</p>
<h4 id="jsmeix_commented_at_2024-04-29_1234"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082615405">2024-04-29 12:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1234" title="Permanent link">&para;</a></h4>
<p>Ah! I misunderstood.<br />
You meant to exclude /var/lib/rear/output<br />
by default from the NETFS backup.</p>
<p>For this we have in default.conf</p>
<pre><code># BACKUP_PROG_EXCLUDE is an array of strings that get written into a backup-exclude.txt file
# that is used e.g. in 'tar -X backup-exclude.txt' to get things excluded from the backup.
...
BACKUP_PROG_EXCLUDE=( '/tmp/*' '/dev/shm/*' "$VAR_DIR/output/*" )
</code></pre>
<p>so var/lib/rear/output is excluded by default<br />
from the NETFS backup.</p>
<p>You won't see that exclusion directly in the tar command<br />
but only indirecly via <code>tar ... -X backup-exclude.txt</code>.</p>
<p>The backup-exclude.txt content is shown in the<br />
normal ReaR log file (not the backup log file) via<br />
usr/share/rear/backup/NETFS/default/500_make_backup.sh</p>
<pre><code># Log what is included in the backup and what is excluded from the backup
# cf. backup/NETFS/default/400_create_include_exclude_files.sh
Log "Backup include list (backup-include.txt contents):"
while read -r backup_include_item ; do
    test "$backup_include_item" &amp;&amp; Log "  $backup_include_item"
done &lt; $TMP_DIR/backup-include.txt
Log "Backup exclude list (backup-exclude.txt contents):"
while read -r backup_exclude_item ; do
    test "$backup_exclude_item" &amp;&amp; Log "  $backup_exclude_item"
done &lt; $TMP_DIR/backup-exclude.txt
</code></pre>
<p>Accordingly your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
contains (excerpts - only actual 'Log()' messages):</p>
<pre><code>2024-04-24 18:38:20.254914145 Using build area: /var/tmp/rear.aQ2zh33mXgievJm
...
2024-04-24 18:39:07.171830692 Backup include list (backup-include.txt contents):
2024-04-24 18:39:07.175749525 Backup exclude list (backup-exclude.txt contents):
2024-04-24 18:39:07.179574293   /tmp/*
2024-04-24 18:39:07.183286446   /dev/shm/*
2024-04-24 18:39:07.186897500   /var/lib/rear/output/*
2024-04-24 18:39:07.190769423   /var/tmp/rear.aQ2zh33mXgievJm
...
2024-04-24 18:39:07.209802648 tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.aQ2zh33mXgievJm/tmp/backup-exclude.txt -C / -c -f - /var/log/rear/rear-hermes.log | dd of=/var/tmp/rear.aQ2zh33mXgievJm/outputfs/hermes/backup.tar.gz bs=1M
</code></pre>
<p>So your backup-include.txt is empty which is why I wrote above<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2077011476">https://github.com/rear/rear/issues/3189#issuecomment-2077011476</a></p>
<p>For comparison:</p>
<p>How it looks on one of my test VMs with ReaR 2.7<br />
on x86_64 with the SUSE default btrfs structure:</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINTS /dev/sda
NAME        KNAME     PKNAME   TRAN TYPE FSTYPE SIZE MOUNTPOINTS
/dev/sda    /dev/sda           ata  disk         15G 
|-/dev/sda1 /dev/sda1 /dev/sda      part          8M 
|-/dev/sda2 /dev/sda2 /dev/sda      part btrfs   13G /var
|                                                    /root
|                                                    /tmp
|                                                    /usr/local
|                                                    /boot/grub2/i386-pc
|                                                    /srv
|                                                    /opt
|                                                    /boot/grub2/x86_64-efi
|                                                    /home
|                                                    /.snapshots
|                                                    /
`-/dev/sda3 /dev/sda3 /dev/sda      part swap     2G [SWAP]
</code></pre>
<p>Using this ReaR config:</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://192.168.178.66/nfs
REQUIRED_PROGS+=( snapper chattr )
PROGS+=( lsattr )
COPY_AS_IS+=( /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
BACKUP_PROG_INCLUDE=( /boot/grub2/i386-pc /boot/grub2/x86_64-efi /home /opt /root /srv /tmp /usr/local /var )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
SSH_ROOT_PASSWORD='rear'
USE_DHCLIENT="yes"
PROGRESS_MODE="plain"
PROGRESS_WAIT_SECONDS="5"
MODULES=( loaded_modules )
FIRMWARE_FILES=( no )
</code></pre>
<p>"rear -D mkbackup" log excerpts - only actual 'Log()' messages:</p>
<pre><code>2024-04-29 14:45:49.329755032 Including backup/NETFS/default/500_make_backup.sh
2024-04-29 14:45:49.331440517 Entering debugscript mode via 'set -x'.
2024-04-29 14:45:49.339585602 Making backup (using backup method NETFS)
2024-04-29 14:45:49.347139698 Backup include list (backup-include.txt contents):
2024-04-29 14:45:49.349245934   /boot/grub2/i386-pc
2024-04-29 14:45:49.351251309   /boot/grub2/x86_64-efi
2024-04-29 14:45:49.353379145   /home
2024-04-29 14:45:49.355323537   /opt
2024-04-29 14:45:49.357239244   /root
2024-04-29 14:45:49.359060043   /srv
2024-04-29 14:45:49.360984958   /tmp
2024-04-29 14:45:49.362798965   /usr/local
2024-04-29 14:45:49.364743496   /var
2024-04-29 14:45:49.366581308   /
2024-04-29 14:45:49.368497576 Backup exclude list (backup-exclude.txt contents):
2024-04-29 14:45:49.370376595   /tmp/*
2024-04-29 14:45:49.372303543   /dev/shm/*
2024-04-29 14:45:49.374119013   /root/rear.2.7/var/lib/rear/output/*
2024-04-29 14:45:49.375999263   /var/tmp/rear.1HOOD1P1tTy6Eyn
2024-04-29 14:45:49.378041589 Creating tar archive '/var/tmp/rear.1HOOD1P1tTy6Eyn/outputfs/localhost/backup.tar.gz'
2024-04-29 14:45:49.387479061 tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.1HOOD1P1tTy6Eyn/tmp/backup-exclude.txt -C / -c -f - /boot/grub2/i386-pc /boot/grub2/x86_64-efi /home /opt /root /srv /tmp /usr/local /var / /root/rear.2.7/var/log/rear/rear-localhost.log | dd of=/var/tmp/rear.1HOOD1P1tTy6Eyn/outputfs/localhost/backup.tar.gz bs=1M
</code></pre>
<p>And without BACKUP_PROG_INCLUDE in local.conf</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://192.168.178.66/nfs
REQUIRED_PROGS+=( snapper chattr )
PROGS+=( lsattr )
COPY_AS_IS+=( /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
SSH_ROOT_PASSWORD='rear'
USE_DHCLIENT="yes"
PROGRESS_MODE="plain"
PROGRESS_WAIT_SECONDS="5"
MODULES=( loaded_modules )
FIRMWARE_FILES=( no )
USER_INPUT_UNATTENDED_TIMEOUT=1
</code></pre>
<p>I get in the "rear -D mkbackup" log<br />
(excerpts - only actual 'Log()' messages):</p>
<pre><code>2024-04-29 15:07:39.125849969 Including backup/NETFS/default/500_make_backup.sh
2024-04-29 15:07:39.127581460 Entering debugscript mode via 'set -x'.
2024-04-29 15:07:39.135772001 Making backup (using backup method NETFS)
2024-04-29 15:07:39.138247680 Backup include list (backup-include.txt contents):
2024-04-29 15:07:39.140505651   /
2024-04-29 15:07:39.142441997 Backup exclude list (backup-exclude.txt contents):
2024-04-29 15:07:39.144371891   /tmp/*
2024-04-29 15:07:39.146287468   /dev/shm/*
2024-04-29 15:07:39.148164082   /root/rear.2.7/var/lib/rear/output/*
2024-04-29 15:07:39.150046748   /var/tmp/rear.M11HPUBIGuYyivX
2024-04-29 15:07:39.152145038 Creating tar archive '/var/tmp/rear.M11HPUBIGuYyivX/outputfs/localhost/backup.tar.gz'
2024-04-29 15:07:39.167986757 tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /var/tmp/rear.M11HPUBIGuYyivX/tmp/backup-exclude.txt -C / -c -f - / /root/rear.2.7/var/log/rear/rear-localhost.log | dd of=/var/tmp/rear.M11HPUBIGuYyivX/outputfs/localhost/backup.tar.gz bs=1M
</code></pre>
<p>So normally at least '/' is in backup-include.txt</p>
<h4 id="jsmeix_commented_at_2024-04-29_1326"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082747052">2024-04-29 13:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1326" title="Permanent link">&para;</a></h4>
<p>Your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
contains (excerpt):</p>
<pre><code>+ source /usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh
++ is_true no
++ case "$1" in
++ return 1
++ '[' NO '!=' YES ']'
++ read mountpoint device junk
++ for backup_exclude_item in "${BACKUP_PROG_EXCLUDE[@]}"
</code></pre>
<p>while mine (without BACKUP_PROG_INCLUDE in local.conf)<br />
contains (excerpt):</p>
<pre><code>+ source /root/rear.2.7/usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh
++ is_true no
++ case "$1" in
++ return 1
++ '[' NO '!=' YES ']'
++ read mountpoint device junk
++ IsInArray /
++ return 1
++ echo /
++ read mountpoint device junk
++ for backup_exclude_item in "${BACKUP_PROG_EXCLUDE[@]}"
</code></pre>
<p>The matching code in<br />
usr/share/rear/backup/NETFS/default/400_create_include_exclude_files.sh<br />
is</p>
<pre><code># Backup all that is explicitly specified in BACKUP_PROG_INCLUDE:
for backup_include_item in "${BACKUP_PROG_INCLUDE[@]}" ; do
    test "$backup_include_item" &amp;&amp; echo "$backup_include_item"
done &gt; $TMP_DIR/backup-include.txt

# Implicitly also backup all local filesystems as defined in mountpoint_device
# except BACKUP_ONLY_INCLUDE or MANUAL_INCLUDE is set:
if ! is_true "$BACKUP_ONLY_INCLUDE" ; then
    if [ "${MANUAL_INCLUDE:-NO}" != "YES" ] ; then
        # Add the mountpoints that will be recovered to the backup include list
        # unless a mountpoint is excluded:
        while read mountpoint device junk ; do
            if ! IsInArray "$mountpoint" "${EXCLUDE_MOUNTPOINTS[@]}" ; then
                echo "$mountpoint"
            fi
        done &lt;"$VAR_DIR/recovery/mountpoint_device" &gt;&gt; $TMP_DIR/backup-include.txt
    fi
fi

# Exclude all that is explicitly specified in BACKUP_PROG_EXCLUDE:
for backup_exclude_item in "${BACKUP_PROG_EXCLUDE[@]}" ; do
</code></pre>
<p>so it seems your "$VAR_DIR/recovery/mountpoint_device" is empty<br />
while mine contains</p>
<pre><code># cat var/lib/rear/recovery/mountpoint_device
/ /dev/sda2
</code></pre>
<p>@kai-uwe-rommel<br />
is your var/lib/rear/recovery/mountpoint_device empty?<br />
If not, what does it contain?</p>
<p>Because in your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
there is only</p>
<pre><code>++ '[' NO '!=' YES ']'
++ read mountpoint device junk
++ for backup_exclude_item in "${BACKUP_PROG_EXCLUDE[@]}"
</code></pre>
<p>I assume your var/lib/rear/recovery/mountpoint_device is empty.</p>
<p>So my next step towards the root cause is<br />
to find out why it is empty...</p>
<h4 id="jsmeix_commented_at_2024-04-29_1329"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082758914">2024-04-29 13:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1329" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
a possible way to enforce having '/' in the NETFS backup is</p>
<pre><code>BACKUP_ONLY_INCLUDE="yes"
BACKUP_PROG_INCLUDE=( / )
</code></pre>
<p>cf. the BACKUP_ONLY_INCLUDE description in default.conf</p>
<h4 id="jsmeix_commented_at_2024-04-29_1344"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082796321">2024-04-29 13:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1344" title="Permanent link">&para;</a></h4>
<p>Your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
contains:</p>
<pre><code>+ source /usr/share/rear/layout/save/default/340_generate_mountpoint_device.sh
++ excluded_mountpoints=()
++ read fs device mountpoint junk
+++ grep '^fs' /var/lib/rear/layout/disklayout.conf
++ read fs device mountpoint junk
+++ grep '^fs' /var/lib/rear/layout/disklayout.conf
+ source_return_code=0
</code></pre>
<p>The matching code in<br />
usr/share/rear/layout/save/default/340_generate_mountpoint_device.sh<br />
is</p>
<pre><code>excluded_mountpoints=()
while read fs device mountpoint junk ; do
    if IsInArray "fs:$mountpoint" "${EXCLUDE_BACKUP[@]}" ; then
        excluded_mountpoints+=( $mountpoint )
    fi
    for component in $(get_parent_components "fs:$mountpoint" | sort -u) ; do
        if IsInArray "$component" "${EXCLUDE_BACKUP[@]}" ; then
            excluded_mountpoints+=( $mountpoint )
        fi
    done
done &lt; &lt;(grep ^fs $LAYOUT_FILE)
...
while read fs device mountpoint junk ; do
    if IsInArray "$mountpoint" "${excluded_mountpoints[@]}" ; then
        continue
    fi
    echo "$mountpoint $device"
done &lt; &lt;(grep '^fs' $LAYOUT_FILE) &gt; $VAR_DIR/recovery/mountpoint_device
</code></pre>
<p>By the way:<br />
The second comment therein is plain wrong in ReaR 2.7.<br />
I fixed it in current master code via<br />
<a href="https://github.com/rear/rear/commit/341435c25cfb0072084fcd524519825dfe239e03">https://github.com/rear/rear/commit/341435c25cfb0072084fcd524519825dfe239e03</a><br />
see also<br />
<a href="https://github.com/rear/rear/issues/2906#issuecomment-1369919522">https://github.com/rear/rear/issues/2906#issuecomment-1369919522</a></p>
<p>So it seems 'grep ^fs $LAYOUT_FILE' i.e.</p>
<pre><code># grep ^fs var/lib/rear/layout/disklayout.conf
</code></pre>
<p>results nothing which normally means<br />
that there was no mounted filesystem<br />
while "rear mkrescue/mkbackup" was run,<br />
in particular that nothing was mounted at '/'<br />
which looks inexplicable to me because according to your<br />
<a href="https://github.com/rear/rear/files/14837097/lsblk.txt">https://github.com/rear/rear/files/14837097/lsblk.txt</a></p>
<pre><code>NAME                          ... TYPE  FSTYPE ... SIZE MOUNTPOINT
    |-/dev/mapper/system-root     lvm   xfs        60G /
    |-/dev/mapper/system-root     lvm   xfs        60G /
</code></pre>
<p>an XFS on /dev/mapper/system-root is mounted at '/'.</p>
<p>@kai-uwe-rommel<br />
please attach your var/lib/rear/layout/disklayout.conf file<br />
that matches your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
or redo what you did for<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
and attach a new "rear -D mkbackup" log file<br />
plus the new var/lib/rear/layout/disklayout.conf file.</p>
<h4 id="jsmeix_commented_at_2024-04-29_1440"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082929472">2024-04-29 14:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1440" title="Permanent link">&para;</a></h4>
<p>Your<br />
<a href="https://github.com/rear/rear/files/15097745/rear-hermes.log">https://github.com/rear/rear/files/15097745/rear-hermes.log</a><br />
contains (excerpt):</p>
<pre><code># cut -b-150 rear-hermes.log | egrep '+ source |echo .*fs '
...
+ source /usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh
++ echo '# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).'
++ echo '# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]'
++ echo -n 'fs /dev/mapper/system-root / xfs'
++ echo -n 'fs /dev/mapper/vg_HSM_backup-lv_HSM_backup /hana/shared/HSM/HDB00/backup xfs'
++ echo -n 'fs /dev/mapper/vg_HSM_data-lv_HSM_data /hana/data/HSM xfs'
++ echo -n 'fs /dev/mapper/vg_HSM_log-lv_HSM_log /hana/log/HSM xfs'
++ echo -n 'fs /dev/mapper/vg_HSM_shrd-lv_HSM_sap /usr/sap xfs'
++ echo -n 'fs /dev/mapper/vg_HSM_shrd-lv_HSM_shrd /hana/shared/HSM xfs'
</code></pre>
<p>so your disklayout.conf should contain a line</p>
<pre><code>fs /dev/mapper/system-root / xfs
</code></pre>
<p>But later basically all in disklayout.conf gets disabled:</p>
<pre><code># egrep ' source /usr/share/rear/layout/save/default/330_remove_exclusions.sh| Disabling component ' rear-hermes.log | egrep ' source |^2024-04-24 '

+ source /usr/share/rear/layout/save/default/330_remove_exclusions.sh
2024-04-24 18:38:26.240582346 Disabling component 'lvmgrp /dev/system' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.247981103 Disabling component 'lvmgrp /dev/vg_HSM_log' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.255566589 Disabling component 'lvmgrp /dev/vg_HSM_shrd' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.262875234 Disabling component 'lvmgrp /dev/vg_HSM_data' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.270048847 Disabling component 'lvmgrp /dev/vg_HSM_backup' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.321328596 Disabling component 'fs ... /' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.328537547 Disabling component 'fs ... /hana/shared/HSM/HDB00/backup' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.335848129 Disabling component 'fs ... /hana/data/HSM' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.343437911 Disabling component 'fs ... /hana/log/HSM' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.350743767 Disabling component 'fs ... /usr/sap' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.357935255 Disabling component 'fs ... /hana/shared/HSM' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.364964298 Disabling component 'swap /dev/mapper/system-swap' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.372457798 Disabling component 'multipath /dev/mapper/36005076801b901fc6800000000000276' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.381346007 Disabling component 'part /dev/mapper/36005076801b901fc6800000000000276' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.394557309 Disabling component 'multipath /dev/mapper/36005076801b901fc680000000000027a' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.401261285 Disabling component 'multipath /dev/mapper/36005076801b901fc680000000000027b' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.408074822 Disabling component 'multipath /dev/mapper/36005076801b901fc680000000000027c' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.415338362 Disabling component 'multipath /dev/mapper/36005076801b901fc680000000000027e' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.424136533 Disabling component 'lvmdev /dev/system' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.431613783 Disabling component 'lvmdev /dev/vg_HSM_log' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.438902571 Disabling component 'lvmdev /dev/vg_HSM_shrd' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.446098694 Disabling component 'lvmdev /dev/vg_HSM_data' in /var/lib/rear/layout/disklayout.conf
2024-04-24 18:38:26.453141357 Disabling component 'lvmdev /dev/vg_HSM_backup' in /var/lib/rear/layout/disklayout.conf
</code></pre>
<p>So my next step towards the root cause is<br />
to find out why all that gets disabled...</p>
<h4 id="jsmeix_commented_at_2024-04-29_1502"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2082981807">2024-04-29 15:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-29_1502" title="Permanent link">&para;</a></h4>
<p>It seems I got it:</p>
<pre><code>2024-04-24 18:38:25.226539584 Including layout/save/default/320_autoexclude.sh
2024-04-24 18:38:25.229744397 Entering debugscript mode via 'set -x'.
2024-04-24 18:38:25.238001570 Automatically excluding multipath device /dev/mapper/36005076801b901fc6800000000000276
2024-04-24 18:38:25.243734169 Marking component '/dev/mapper/36005076801b901fc6800000000000276' as done in /var/lib/rear/layout/disktodo.conf
...
</code></pre>
<p>Very many of those kind of messages.</p>
<p>I think this is because your '/' is on a multipath device</p>
<pre><code>NAME                                                    KNAME      PKNAME    TRAN TYPE  FSTYPE       LABEL                             SIZE MOUNTPOINT
...
|-/dev/sda2                                             /dev/sda2  /dev/sda       part  LVM2_member                                     82G
`-/dev/mapper/36005076801b901fc6800000000000276         /dev/dm-1  /dev/sda       mpath                                                100G
  |-/dev/mapper/36005076801b901fc6800000000000276-part1 /dev/dm-4  /dev/dm-1      part                                                   4M
  `-/dev/mapper/36005076801b901fc6800000000000276-part2 /dev/dm-5  /dev/dm-1      part  LVM2_member                                     82G
    |-/dev/mapper/system-root                           /dev/dm-6  /dev/dm-5      lvm   xfs                                             60G /
...
|-/dev/sde2                                             /dev/sde2  /dev/sde       part  LVM2_member                                     82G
`-/dev/mapper/36005076801b901fc6800000000000276         /dev/dm-1  /dev/sde       mpath                                                100G
  |-/dev/mapper/36005076801b901fc6800000000000276-part1 /dev/dm-4  /dev/dm-1      part                                                   4M
  `-/dev/mapper/36005076801b901fc6800000000000276-part2 /dev/dm-5  /dev/dm-1      part  LVM2_member                                     82G
    |-/dev/mapper/system-root                           /dev/dm-6  /dev/dm-5      lvm   xfs                                             60G /
</code></pre>
<p>but by default (i.e. in default.conf) we have</p>
<pre><code># Automatically exclude multipath disks and their dependent components
AUTOEXCLUDE_MULTIPATH=y
</code></pre>
<p>cf.<br />
usr/share/rear/conf/examples/RHEL7-PPC64LE-Multipath-PXE-GRUB.conf<br />
(excerpt):</p>
<pre><code># SAN and multipath and boot on SAN specific part on PPC64/PPC64LE:
# There is no direct link between multipath/boot_on_SAN and PXE (even on POWER).
# Multipath is used in this example because PowerVM LPARs usually need multipath.
# There is nothing special on PowerVM LPAR with single VIOS but that is not commonly used.
# In contrast PowerVM LPAR with DUAL VIOS (HA configuration) needs multipath
# for dual disk access (vscsi over 2 VIOS) or NPIV (Fiber Channel virtualization).
# And NPIV (which is quite popular) needs also BOOT_ON_SAN.
AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
</code></pre>
<p>so you need some specific settings in etc/rear/local.conf<br />
for your specific hardware.</p>
<h4 id="jsmeix_commented_at_2024-04-30_0743"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2084609577">2024-04-30 07:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-30_0743" title="Permanent link">&para;</a></h4>
<p>'BOOT_ON_SAN' in the comment in<br />
usr/share/rear/conf/examples/RHEL7-PPC64LE-Multipath-PXE-GRUB.conf<br />
is a typo that will get fixed via<br />
<a href="https://github.com/rear/rear/pull/3211">https://github.com/rear/rear/pull/3211</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-30_1330"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2085341879">2024-04-30 13:30</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-30_1330" title="Permanent link">&para;</a></h4>
<p>Yes, the /var/lib/rear/recovery/mountpoint_device is empty.<br />
<a href="https://github.com/rear/rear/files/15164675/disklayout.txt">disklayout.conf</a><br />
Yes, / is on a multipath device.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-30_1353"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2085403124">2024-04-30 13:53</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-30_1353" title="Permanent link">&para;</a></h4>
<p>I have now set</p>
<pre><code>AUTOEXCLUDE_MULTIPATH=n
ONLY_INCLUDE_VG=( system )
</code></pre>
<p>and NETFS works fine that way.</p>
<h4 id="jsmeix_commented_at_2024-04-30_1406"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2085430721">2024-04-30 14:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-30_1406" title="Permanent link">&para;</a></h4>
<p>I think you may also need</p>
<pre><code>BOOT_OVER_SAN=y
</code></pre>
<p>Did you try out that your ReaR recovery system<br />
can actually boot on your replacement hardware (or VM)<br />
and that the ReaR recovery system seems to work?<br />
I.e. log in as 'root' and call for example 'lsblk'.<br />
Does it list the expected block devices?</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-30_1413"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2085446607">2024-04-30 14:13</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-30_1413" title="Permanent link">&para;</a></h4>
<p>I have not used BOOT_OVER_SAN=y yet. But will add it.<br />
When I boot the rescue ISO, I see the disk configured for the LPAR.<br />
I have not yet attempted "rear recover" and won't have time to start
this today.<br />
But I already wondered if it would also restore the multipath config and
what I need to do to get it do that.<br />
The lsblk shows the (single) multipathed disk currently as two separate
disks.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-04-30_1454"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2085562002">2024-04-30 14:54</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-04-30_1454" title="Permanent link">&para;</a></h4>
<p>Something missing here? (BOOT_FROM_SAN=yes is set)<br />
Can this be caused by the "loaded_modules"?</p>
<pre><code>RESCUE hermes:~ # multipath
1730.984273 | DM multipath kernel driver not loaded
</code></pre>
<h4 id="jsmeix_commented_at_2024-05-03_1209"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2092890518">2024-05-03 12:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-03_1209" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/7b2354e8a91306adeaf9228d79d13b23b5426011">https://github.com/rear/rear/commit/7b2354e8a91306adeaf9228d79d13b23b5426011</a><br />
I describe in usr/share/rear/conf/default.conf<br />
our findings so far from this issue here<br />
how one could reduce the size of ReaR's initrd<br />
in case of BACKUP=TSM in particular on POWER architecture<br />
via COPY_AS_IS_TSM and COPY_AS_IS_EXCLUDE_TSM, see<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2079811746">https://github.com/rear/rear/issues/3189#issuecomment-2079811746</a></p>
<p>I also describe the about 123 MiB initrd size limit on POWER<br />
(128 MiB minus about 4 MiB for additional prep boot data), see<br />
<a href="https://github.com/rear/rear/pull/3212#issuecomment-2092481874">https://github.com/rear/rear/pull/3212#issuecomment-2092481874</a></p>
<p>I also tell about generic methods to reduce initrd size<br />
like MODULES=( 'loaded_modules' ), see<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2076939562">https://github.com/rear/rear/issues/3189#issuecomment-2076939562</a><br />
and REAR_INITRD_COMPRESSION="lzma", see<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2079794186">https://github.com/rear/rear/issues/3189#issuecomment-2079794186</a><br />
and I mention that on POWER by default<br />
FIRMWARE_FILES=( 'no' ) is used, see<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2076960341">https://github.com/rear/rear/issues/3189#issuecomment-2076960341</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-05-03_1222"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2092910301">2024-05-03 12:22</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-05-03_1222" title="Permanent link">&para;</a></h4>
<p>The size reduction of initrd for BACKUP=TSM is not platform specific for
POWER. It applies to the usual x64 platforms as well. It may not be
needed there to reduce initrd to avoid boot failures but it speeds
things up and reduces the storage footprint.</p>
<p>You may also want to put in a warning about systems using multipathing
that they may end up with empty NETFS backups and need to use suitable
explicit include statements.</p>
<h4 id="jsmeix_commented_at_2024-05-03_1241"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2092940210">2024-05-03 12:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-03_1241" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
regarding BOOT_OVER_SAN=y and multipath:</p>
<p>In your<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2085562002">https://github.com/rear/rear/issues/3189#issuecomment-2085562002</a><br />
you wrote <code>BOOT_FROM_SAN=yes is set</code>.<br />
There is no 'BOOT_FROM_SAN', there is only 'BOOT_OVER_SAN', see<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2084609577">https://github.com/rear/rear/issues/3189#issuecomment-2084609577</a><br />
and
<a href="https://github.com/rear/rear/pull/3211">https://github.com/rear/rear/pull/3211</a></p>
<p>'BOOT_OVER_SAN' is only used in<br />
usr/share/rear/prep/GNU/Linux/240_include_multipath_tools.sh<br />
which is run during "rear mkrescue/mkbackup" and in<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh<br />
which is run during "rear recover".</p>
<p>The former includes multipath tools into the recovery system<br />
that are needed there during "rear recover" when<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh<br />
is run which activates multipath if BOOT_OVER_SAN is true.</p>
<p>In particular with BOOT_OVER_SAN=y multipath gets not activated<br />
during recovery system startup via some system-setup script in<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/<br />
which appear under /etc/scripts/system-setup.d/<br />
in the running recovery system.<br />
So when one logs in as 'root' in the booted recovery system<br />
multipath is not yet activated with BOOT_OVER_SAN=y.</p>
<p>With BOOT_OVER_SAN=y multipath gets activated when<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh<br />
is run during "rear recover".</p>
<p>I cannot tell why multipath gets not activated during<br />
recovery system startup but later during "rear recover" via<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh<br />
It originated in<br />
<a href="https://github.com/rear/rear/commit/ff19120671a5571a4be354b05d4b45a843933ec8">https://github.com/rear/rear/commit/ff19120671a5571a4be354b05d4b45a843933ec8</a><br />
as usr/share/rear/layout/prepare/GNU/Linux/21_load_multipath.sh</p>
<p>I have zero personal experience with multipath<br />
so I need to somehow find my way through here and<br />
when I get again stuck now with multipath like above<br />
<a href="https://github.com/rear/rear/issues/3189#issuecomment-2042901448">https://github.com/rear/rear/issues/3189#issuecomment-2042901448</a><br />
another SUSE support case would be needed to get<br />
multipath issues on POWER architecture properly sorted out.</p>
<p>To find out whether or not "rear recover" actually works<br />
on your POWER system with or without 'BOOT_OVER_SAN=y'<br />
you need a fully separated and fully compatible<br />
replacement system where you could try out "rear recover",<br />
see in parrticular the sections<br />
"Fully compatible replacement hardware is needed"<br />
and<br />
"No disaster recovery without testing and continuous validation"<br />
in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2024-05-03_1302"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2092975444">2024-05-03 13:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-03_1302" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
regarding initrd size reduction for BACKUP=TSM<br />
on any platform via a reduced/minimal TSM client see my<br />
<a href="https://github.com/rear/rear/pull/3212#issuecomment-2092481874">https://github.com/rear/rear/pull/3212#issuecomment-2092481874</a><br />
(excerpt)</p>
<pre><code>Same basic reasoning (i.e. "it depends")
for including a reduced/minimal TSM client:
When the initrd size does not matter in some cases
then the full TSM client should normally be included
to have all TSM client functionality available
during ReaR recovery system runtime.
</code></pre>
<p>In the past we had way too many various kind of issues<br />
here at ReaR upstream because ReaR tried by default<br />
too much to keep its recovery system small.</p>
<p>When something is needed in this or that specific case<br />
in the ReaR recovery system but it is not there,<br />
then "rear recover" is usually a dead end<br />
and instead of a working disaster recovery method<br />
ReaR becomes a final disaster (in some specific cases).</p>
<p>My main example is my change to the new default<br />
MODULES=( 'all_modules' ) in ReaR 2.5, cf.<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a><br />
because we had way too many issues where crucial things<br />
did not work in the ReaR recovery system because some<br />
"special" additionally needed kernel module was missing<br />
(not much fun when e.g. a USB keyboard does not work)<br />
see my description in default.conf about MODULES<br />
and see the therein mentioned ReaR upstream issues.</p>
<p>There is a crucial point:<br />
By default things should work reasonably well.<br />
But there must be also "final power to the user"<br />
which means that the user can specify things<br />
to be different than the defaults as the user wants.</p>
<h4 id="jsmeix_commented_at_2024-05-03_1311"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2092992455">2024-05-03 13:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-03_1311" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
regarding "warning about ... empty NETFS backups":</p>
<p>Yes, I am already thinking about a generic check for<br />
an empty NETFS backup (regardless of multipath or whatever).</p>
<p>My point is that I assume at least '/' must be included<br />
in any backup because it is the basic functionality<br />
that "rear mkbackup" makes a backup of the files<br />
of the basic system so at least '/' must be<br />
backed up (with '--one-file-system').</p>
<p>So in case of a NETFS backup at least '/'<br />
should normally be in backup-include.txt<br />
and - as far as I can imagine - at least an<br />
empty backup-include.txt is always an error.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-05-03_1332"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2093032268">2024-05-03 13:32</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-05-03_1332" title="Permanent link">&para;</a></h4>
<p>Thanks for the multipath stuff explanation.<br />
Will test as time permits.</p>
<p>Regarding TSM client size reduction:<br />
what was previously in the comments was indeed<br />
a "stripped down" client e.g. which could have<br />
functionality missing.<br />
After looking at what makes it so fat<br />
I found that I would get most reduction<br />
by removing all the foreign language files.<br />
This way I got a slim TSM client in the rescue image<br />
without (!) reducing functionality.<br />
Since that was not yet sufficient for the POWER 123 MB limit,<br />
I decided to also remove *.jar files which are only needed<br />
for the Java based GUI (X11) client - but X11 is not available<br />
in rescue image anyway so this is no real restriction either.</p>
<h4 id="jsmeix_commented_at_2024-05-03_1506"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2093206986">2024-05-03 15:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-03_1506" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
thank you for your explanation why those *.jar files are not needed.<br />
Now it is much more clear to me that what you excluded<br />
did not result a TSM client with less functionality,<br />
at least not for the TSM version you have.</p>
<p>I will further enhance the comment in default.conf<br />
to better explain that crucial difference compared to<br />
the minimal COPY_AS_IS_TSM example.</p>
<p>What still worries me a bit is that</p>
<pre><code>/opt/tivoli/tsm/client/*/*/[A-Z][!N]_??
</code></pre>
<p>may accidentally match too many files<br />
(i.e. more than only language files)<br />
because of too unspecific <code>/*/*/</code> and <code>_??</code><br />
so it may accidentally result a crippled TSM client<br />
for some other/future TSM versions.<br />
Perhaps something more specific like</p>
<pre><code>COPY_AS_IS_EXCLUDE_TSM=( /opt/tivoli/tsm/client/ba/bin/*.jar
                         /opt/tivoli/tsm/client/ba/bin/*.log*
                         /opt/tivoli/tsm/client/ba/bin/[A-Z][!N]_[!U][A-Z]
                         /opt/tivoli/tsm/client/api/bin64/[A-Z][!N]_[!U][A-Z] )
</code></pre>
<p>could be better as an example to make it more clear<br />
what files are meant to be excluded.</p>
<p>Did you try out if the EN_US language files are really needed<br />
to normally use the TSM client (in English)?</p>
<p>I think that usually the strings in the source code<br />
are in English so I think that usually no translation<br />
into English is required (i.e. the user would then see<br />
the original strings "as is" from the source code).</p>
<p>As far as I know EN_US or EN_GB language files are<br />
usually onyl there to provide US or GB English style<br />
for arbitrary English strings in the source code<br />
or some style or spelling fixes for English strings<br />
in the source code (e.g. for English mistakes<br />
from non-native English source code developers).</p>
<p>I.e. could you (as time permits) please test if<br />
you can normally use the TSM client in English<br />
even without EN_US language files with</p>
<pre><code>COPY_AS_IS_EXCLUDE_TSM=( /opt/tivoli/tsm/client/ba/bin/*.jar
                         /opt/tivoli/tsm/client/ba/bin/*.log*
                         /opt/tivoli/tsm/client/ba/bin/[A-Z][A-Z]_[A-Z][A-Z]
                         /opt/tivoli/tsm/client/api/bin64/[A-Z][A-Z]_[A-Z][A-Z] )
</code></pre>
<h4 id="kai-uwe-rommel_commented_at_2024-05-03_1556"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2093288555">2024-05-03 15:56</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-05-03_1556" title="Permanent link">&para;</a></h4>
<p>The wildcard <code>[A-Z][!N]_??</code> only matches files (in this case,
directories) that look line <code>X?_??</code> but not <code>XN_??</code> (X = any upper case
letter). So it will not match EN_US and there are actually no other
such directories with N as the second. There is IMO almost no risk that
there will be other X?_?? files other than the typically named language
file subdirectories. Probably the wildcard can be refined to more
restrictively match what I intended but then it will become quite long
and "ugly" to read. Also, I was not sure, if more sophisticated regular
expressions are accepted and properly interpreted/matched here.</p>
<p>The <code>/*/*/</code> means it matches any such file/directory under
.../tsm/client/ba/bin/ and .../tsm/client/api/bin64/ directories. There
are no other directories under .../tsm/client than ba and api.</p>
<p>And yes, <em>some</em> language files are needed and EN_US is used per
default.</p>
<h4 id="kai-uwe-rommel_commented_at_2024-05-06_1328"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2096023723">2024-05-06 13:28</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-05-06_1328" title="Permanent link">&para;</a></h4>
<p>Did the complete recovery test in a new/separate LPAR right now.
Works.<br />
Multipathing is initiated properly and root partition and filesystem
created, too.<br />
TSM restore into this new / also worked.<br />
Could then modify IP address before reboot.<br />
Reboot of the new LPAR worked.<br />
Of course, then the usual stuff that needs to be done when booting with
all the other LVM disks and filesystems missing e.g. emergency mode,
changing /etc/fstab (could have done this before the first boot if I had
remembered it).</p>
<h4 id="jsmeix_commented_at_2024-05-13_1507"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2107914280">2024-05-13 15:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-13_1507" title="Permanent link">&para;</a></h4>
<p>@kai-uwe-rommel<br />
thank you for the feedback how far it worked<br />
in your case.</p>
<p>Can this issue be closed from your point of view?</p>
<p>FYI only an offhanded side note regarding your</p>
<pre><code>... the usual stuff ... with all the other LVM disks
and filesystems missing ... changing /etc/fstab
... before the first boot
</code></pre>
<p>You may have a look at<br />
<a href="https://github.com/rear/rear/issues/2812#issuecomment-1251096019">https://github.com/rear/rear/issues/2812#issuecomment-1251096019</a></p>
<p><a href="https://github.com/rear/rear/commit/e822ad69a8ce8dec6132741806008db9c6c3b429">https://github.com/rear/rear/commit/e822ad69a8ce8dec6132741806008db9c6c3b429</a><br />
shows an example how an /etc/rear/lun_wwid_mapping.conf<br />
may look like.</p>
<p>As far as I imagine<br />
with such an /etc/rear/lun_wwid_mapping.conf<br />
usr/share/rear/finalize/GNU/Linux/250_migrate_lun_wwid.sh<br />
should at the end of "rear recover"<br />
adapt only etc/elilo.conf and etc/fstab<br />
in the restored system (i.e. within /mnt/local).</p>
<p>I assume etc/elilo.conf is from older times<br />
when (only?) elilo was used as bootloader on POWER.</p>
<p>Currently grub.cfg is not adapted by<br />
usr/share/rear/finalize/GNU/Linux/250_migrate_lun_wwid.sh<br />
so for GRUB this needs to be enhanced.</p>
<p>I think what you may try out is:<br />
As root in the booted ReaR recovery system<br />
before calling "rear recover"<br />
manually create an /etc/rear/lun_wwid_mapping.conf file<br />
according to what 'lsblk' shows in the ReaR recovery system<br />
for the "new_lun_wwid" values, e.g. use something like</p>
<pre><code># lsblk -ipo NAME,KNAME,TYPE,SIZE,UUID,WWN
</code></pre>
<p>The "original_lun_wwid" values should be stored in<br />
your var/lib/rear/layout/disklayout.conf<br />
at least in the initial comment that shows the</p>
<pre><code>lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT,UUID,WWN
</code></pre>
<p>output since ReaR 2.7 via<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/save/GNU/Linux/100_create_layout_file.sh#L28">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/save/GNU/Linux/100_create_layout_file.sh#L28</a></p>
<p>But having only an /etc/rear/lun_wwid_mapping.conf<br />
(without also having an /etc/rear/disklayout.conf)<br />
my not work because of the code in<br />
usr/share/rear/layout/prepare/default/010_prepare_files.sh<br />
see the comments in that code<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/prepare/default/010_prepare_files.sh#L28">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/prepare/default/010_prepare_files.sh#L28</a></p>
<h4 id="kai-uwe-rommel_commented_at_2024-05-13_1530"><img src="https://avatars.githubusercontent.com/u/26381804?u=39eb4423becba185bbc3e6e9876fdbbac3518c2c&v=4" width="50"><a href="https://github.com/kai-uwe-rommel">kai-uwe-rommel</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2108013457">2024-05-13 15:30</a>:<a class="headerlink" href="#kai-uwe-rommel_commented_at_2024-05-13_1530" title="Permanent link">&para;</a></h4>
<p>Thanks for the explanation.<br />
The case can be closed now. All problems solved.</p>
<h4 id="jsmeix_commented_at_2024-05-15_1545"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3189#issuecomment-2112897378">2024-05-15 15:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-05-15_1545" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/3219">https://github.com/rear/rear/pull/3219</a><br />
and
<a href="https://github.com/rear/rear/pull/3221">https://github.com/rear/rear/pull/3221</a><br />
merged (the latter solves
<a href="https://github.com/rear/rear/issues/3217">https://github.com/rear/rear/issues/3217</a>)<br />
all subsequent issues from this one should be fixed<br />
so that this one should be done.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2024-04-02.3189.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
