<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2023 02 13.2924.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2023 02 13.2924.issue.closed";
        var mkdocs_page_input_path = "issues/2023-02-13.2924.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2023 02 13.2924.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2924_issue_closed_outputusb_real_usb_device_mounted_both_below_tmprear_and_vartmprear"><a href="https://github.com/rear/rear/issues/2924">#2924 Issue</a> <code>closed</code>: OUTPUT=USB: REAL_USB_DEVICE mounted both below /tmp/rear... and /var/tmp/rear...<a class="headerlink" href="#2924_issue_closed_outputusb_real_usb_device_mounted_both_below_tmprear_and_vartmprear" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>waiting for info</code>, <code>support / question</code>,
<code>no-issue-activity</code></p>
<h4 id="frilogg_opened_issue_at_2023-02-13_0923"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> opened issue at <a href="https://github.com/rear/rear/issues/2924">2023-02-13 09:23</a>:<a class="headerlink" href="#frilogg_opened_issue_at_2023-02-13_0923" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4.16 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    NAME="Red Hat Enterprise Linux Server"<br />
    VERSION="7.9 (Maipo)"<br />
    ID="rhel"<br />
    ID_LIKE="fedora"<br />
    VARIANT="Server"<br />
    VARIANT_ID="server"<br />
    VERSION_ID="7.9"<br />
    PRETTY_NAME="Red Hat Enterprise Linux Server 7.9 (Maipo)"<br />
    ANSI_COLOR="0;31"<br />
    CPE_NAME="cpe:/o:redhat:enterprise_linux:7.9:GA:server"<br />
    HOME_URL="<a href="https://www.redhat.com/">https://www.redhat.com/</a>"<br />
    BUG_REPORT_URL="<a href="https://bugzilla.redhat.com/">https://bugzilla.redhat.com/</a>"</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    OUTPUT=USB<br />
    BACKUP=NETFS<br />
    BACKUP_URL="usb:///dev/disk/by-label/REAR-000"<br />
    BACKUP_PROG_EXCLUDE=('/home/rear' '/var/log/audit')<br />
    USB_UEFI_PART_SIZE="1648"<br />
    HOSTNAME="sp7-ui"<br />
    USB_DEVICE_FILESYSTEM="ext4"<br />
    export TMPDIR="/home/rear"</p>
</li>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    PC Dell Precision 3450</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    uname -a<br />
<code>Linux solx8ht 3.10.0-1160.66.1.el7.x86_64 #1 SMP Wed Apr 27 20:34:34 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</code></p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    Grub2</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                       KNAME          PKNAME         TRAN TYPE FSTYPE      LABEL      SIZE MOUNTPOINT
/dev/sda                   /dev/sda                      usb  disk                       57.8G
|-/dev/sda1                /dev/sda1      /dev/sda            part vfat        REAR-EFI   1.6G
`-/dev/sda2                /dev/sda2      /dev/sda            part ext4        REAR-000  56.1G
/dev/nvme0n1               /dev/nvme0n1                       disk                      238.5G
|-/dev/nvme0n1p1           /dev/nvme0n1p1 /dev/nvme0n1        part vfat                   500M /boot/efi
|-/dev/nvme0n1p2           /dev/nvme0n1p2 /dev/nvme0n1        part ext4                     1G /boot
`-/dev/nvme0n1p3           /dev/nvme0n1p3 /dev/nvme0n1        part LVM2_member            237G
  |-/dev/mapper/rhel_-root /dev/dm-0      /dev/nvme0n1p3      lvm  ext4                    50G /
  |-/dev/mapper/rhel_-swap /dev/dm-1      /dev/nvme0n1p3      lvm  swap                   7.6G [SWAP]
  `-/dev/mapper/rhel_-home /dev/dm-2      /dev/nvme0n1p3      lvm  ext4                   150G /home
</code></pre>
<ul>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    We cant restore backup. After "enter" on relax and recover option it
    doesnt "fire up" loading files.</p>
</li>
<li>
<p>Workaround, if any:<br />
    Haven't found any</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
<p><a href="https://github.com/rear/rear/files/10720609/rear-solx8ht.log">rear-solx8ht.log</a></p>
</li>
</ul>
<h4 id="schlomo_commented_at_2023-02-13_1841"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1428466577">2023-02-13 18:41</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-13_1841" title="Permanent link">&para;</a></h4>
<p>Dear @frilogg, please install ReaR version 2.7, e.g. from
<a href="http://download.opensuse.org/repositories/Archiving:/Backup:/Rear/RHEL_7/">http://download.opensuse.org/repositories/Archiving:/Backup:/Rear/RHEL_7/</a>
and try again</p>
<p>In the rescue system you'll have to type <code>rear recover</code>, of course:<br />
<img alt="image" src="https://user-images.githubusercontent.com/101384/218546529-3036e2ee-3268-46e8-9611-5a7f44378a5b.png" /></p>
<h4 id="frilogg_commented_at_2023-02-13_2107"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1428684311">2023-02-13 21:07</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-13_2107" title="Permanent link">&para;</a></h4>
<p>Hi @schlomo , thank you for feedback, but .. had hoped to figure it out
with this version. I have used rear for many of my customers, and some
of the problem is that they "only" want to use the version that is with
the official redhat repo. I also noticed that with redhat 9.1 version
2.6 is default also.. So for this cause no good quick tips or you notice
anything from the logs provided ?</p>
<h4 id="schlomo_commented_at_2023-02-13_2210"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1428761213">2023-02-13 22:10</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-13_2210" title="Permanent link">&para;</a></h4>
<p>Well, line 11 of your log says:</p>
<p><code>/etc/rear/local.conf: line 17: export:</code>=/home/rear': not a valid
identifier`</p>
<p>(don't understand why you would export something in a ReaR config anyway
as everything is one large shell script)</p>
<p>Besides that you didn't provide anything about the actual problem which
is during recovery, right?</p>
<h4 id="frilogg_commented_at_2023-02-14_0638"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1429199422">2023-02-14 06:38</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-14_0638" title="Permanent link">&para;</a></h4>
<p>Hi and good morning @schlomo , this was corrected but I still had the
problem.</p>
<p>I followed your advice and installed Rear 2.7., so thats the version Im
on now.<br />
When trying to create a backup now it exit after few seconds. When I do
lsblk -p this is not mounted. Please advice.</p>
<pre><code>+ source /usr/share/rear/prep/USB/Linux-i386/350_check_usb_disk.sh
++ test /dev/disk/by-label/REAR-000
+++ readlink -f /dev/disk/by-label/REAR-000
++ REAL_USB_DEVICE=/dev/sda2
++ test -b /dev/sda2
++ res=($( grep -v $BUILD_DIR /proc/mounts | grep "^$REAL_USB_DEVICE" ))
+++ grep -v /var/tmp/rear.upjUYcgOpdZ2LjO /proc/mounts
+++ grep '^/dev/sda2'
++ Error 'USB or disk device '\''/dev/sda2'\'' is already mounted on '\''/tmp/rear.upjUYcgOpdZ2LjO/outputfs'\'''
++ test -s /var/log/rear/rear-solx8ht.log
++ PrintError 'ERROR: USB or disk device '\''/dev/sda2'\'' is already mounted on '\''/tmp/rear.upjUYcgOpdZ2LjO/outputfs'\'''
</code></pre>
<h4 id="frilogg_commented_at_2023-02-14_0644"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1429204653">2023-02-14 06:44</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-14_0644" title="Permanent link">&para;</a></h4>
<p>The reason we want to export and use another tmpdir or else it would not
be enough space on device. I ran now export TMPDIR=/home/rear - and now
the backup is created. In rear 2.4 we could have this string in the
local.conf but it seems that its not working anymore?!</p>
<h4 id="frilogg_commented_at_2023-02-14_0722"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1429250105">2023-02-14 07:22</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-14_0722" title="Permanent link">&para;</a></h4>
<p>I have now the same problem as
<a href="https://github.com/rear/rear/issues/2920">https://github.com/rear/rear/issues/2920</a></p>
<h4 id="schlomo_commented_at_2023-02-14_0738"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1429263261">2023-02-14 07:38</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_0738" title="Permanent link">&para;</a></h4>
<p>Sorry @frilogg, we need to somewhat change the mode of our conversation
here:</p>
<ol>
<li>please use correct markdown to make it simpler to read</li>
<li>please provide much more context, log files, screenshot etc. and not
    just a fragment.</li>
</ol>
<p>With the information you shared I don't even know what to look at.</p>
<p>If you do this for a customer then maybe a commercial support option
might be better suited for you where one of us will join you in a remote
screen sharing session to look at your situation.</p>
<p>About your <code>TMPDIR</code> question, in 2.7 we changed that to be more
standards compliant and the best place to find out about ReaR variabled
is always <code>default.conf</code>, where you can find everything about <code>TMPDIR</code>:</p>
<pre><code># TMPDIR
#
# Relax-and-Recover needs a (temporary) working area where it builds in particular
# the rescue/recovery system ISO image (and perhaps even stores the backup archive).
# The directory name of the working area is created in /usr/sbin/rear by calling
#   mktemp -d -t rear.XXXXXXXXXXXXXXX
# which usually results /tmp/rear.XXXXXXXXXXXXXXX or $TMPDIR/rear.XXXXXXXXXXXXXXX
# the latter when the canonical Linux/Unix environment variable TMPDIR
# is set in the environment where /usr/sbin/rear is called.
# To have a specific working area directory prefix for Relax-and-Recover call
#   export TMPDIR="/prefix/for/rear/working/directory"
# before calling 'rear' (/prefix/for/rear/working/directory must already exist).
# This is useful for example when there is not sufficient free space
# in /var/tmp or $TMPDIR for the ISO image or even the backup archive.
# TMPDIR cannot be set to a default value here unconditionally but only
# if it is not set before calling the program, otherwise /usr/sbin/rear
# would not work in compliance with the Linux/Unix standards regarding TMPDIR
# see https://github.com/rear/rear/issues/968
# The default is /var/tmp instead of the more usual /tmp (the system default),
# because /tmp is not intended for such large amounts of data that ReaR usually
# produces when creating the image (see file-hierarchy(7)). In particular,
# /tmp can be a tmpfs, and thus restricted by the available RAM/swap.
export TMPDIR="${TMPDIR-/var/tmp}"
####
</code></pre>
<p>As it is exported there you don't need to (and shouldn't) export it
again</p>
<h4 id="gdha_commented_at_2023-02-14_0907"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1429370263">2023-02-14 09:07</a>:<a class="headerlink" href="#gdha_commented_at_2023-02-14_0907" title="Permanent link">&para;</a></h4>
<p>@frilogg Concerning your customers who want to use the official rear
version delivered with their disribution - they have the right to submit
an incident at RH and RH support will pick it up and try to help them or
provide a fix (which will be merged in our master repo). RH and Suse are
activily committing enhancemants and bug fixes in our ReaR master repo.</p>
<h4 id="frilogg_commented_at_2023-02-16_1046"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1432885861">2023-02-16 10:46</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-16_1046" title="Permanent link">&para;</a></h4>
<p>Thank you for quick feedback, and sorry for late response from my
side.<br />
Here you can see how far I got, and also its the attached logs with Rear
2.7.</p>
<p><img alt="218050959-db94f21b-e786-47b7-b8c0-b710f81339a3" src="https://user-images.githubusercontent.com/15347421/219343636-95ed5ed1-9b5a-49be-8354-926f3c79571e.JPG" /></p>
<p><img alt="218050953-5843952c-a33b-4ea5-9a10-7fcc265a6635" src="https://user-images.githubusercontent.com/15347421/219344024-86b3ae8b-0b6c-4932-9b42-de9e2c452a9b.JPG" /></p>
<p><a href="https://github.com/rear/rear/files/10755054/rear27-solx8ht.log">rear27-solx8ht.log</a></p>
<h4 id="jsmeix_commented_at_2023-02-16_1115"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1432927261">2023-02-16 11:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1115" title="Permanent link">&para;</a></h4>
<p>Only as a side note FYI<br />
(I know it does not actually help):</p>
<p>Sigh!<br />
Just the usual user experience when booting via UEFI fails.<br />
In general, not limited to ReaR, it always behaves is way:<br />
Not any (error) message, neither from the UEFI firmware<br />
nor from the bootloader - so there is nothing helpful.<br />
I have no idea how to debug such UEFI booting issues.</p>
<h4 id="jsmeix_commented_at_2023-02-16_1210"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1432993033">2023-02-16 12:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1210" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
in your<br />
<a href="https://github.com/rear/rear/issues/2924#issuecomment-1432885861">https://github.com/rear/rear/issues/2924#issuecomment-1432885861</a><br />
the Grub menu text "Boot original system"<br />
does not appear in ReaR 2.7 code<br />
because that was changed via<br />
<a href="https://github.com/rear/rear/commit/25f86d4f9cb320db637e65550830cb19a7fd2b02">https://github.com/rear/rear/commit/25f86d4f9cb320db637e65550830cb19a7fd2b02</a><br />
and
<a href="https://github.com/rear/rear/pull/2662">https://github.com/rear/rear/pull/2662</a></p>
<p>Your<br />
<a href="https://github.com/rear/rear/files/10755054/rear27-solx8ht.log">https://github.com/rear/rear/files/10755054/rear27-solx8ht.log</a><br />
does not contain any</p>
<pre><code>+ source /usr/share/rear/output/USB/...
</code></pre>
<p>because it ends with</p>
<pre><code>+ source /usr/share/rear/prep/USB/Linux-i386/350_check_usb_disk.sh
</code></pre>
<p>where it still errors out with</p>
<pre><code>++ Error 'USB or disk device '\''/dev/sda2'\'' is already mounted on '\''/tmp/rear.upjUYcgOpdZ2LjO/outputfs'\'''
</code></pre>
<p>as in your<br />
<a href="https://github.com/rear/rear/issues/2924#issuecomment-1429199422">https://github.com/rear/rear/issues/2924#issuecomment-1429199422</a></p>
<h4 id="jsmeix_commented_at_2023-02-16_1217"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433001698">2023-02-16 12:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1217" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
your<br />
<a href="https://github.com/rear/rear/files/10755054/rear27-solx8ht.log">https://github.com/rear/rear/files/10755054/rear27-solx8ht.log</a><br />
contains (excerpts)</p>
<pre><code>mount: /dev/sda2 mounted on /var/tmp/rear.upjUYcgOpdZ2LjO/outputfs.
...
++ Error 'USB or disk device '\''/dev/sda2'\'' is already mounted on '\''/tmp/rear.upjUYcgOpdZ2LjO/outputfs'\'''
...
umount: /var/tmp/rear.upjUYcgOpdZ2LjO/outputfs (/dev/sda2) unmounted
</code></pre>
<p>so it seems some 'umount' is somehow somewhere missing<br />
before prep/USB/Linux-i386/350_check_usb_disk.sh<br />
is run or the test in that script is wrong...</p>
<h4 id="jsmeix_commented_at_2023-02-16_1230"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433015713">2023-02-16 12:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1230" title="Permanent link">&para;</a></h4>
<p>Now I see it:</p>
<pre><code>/dev/sda2 mounted on /var/tmp/rear.upjUYcgOpdZ2LjO/outputfs
</code></pre>
<p>versus</p>
<pre><code>/dev/sda2 already mounted on /tmp/rear.upjUYcgOpdZ2LjO/outputfs
</code></pre>
<p>i.e. <code>/var/tmp/</code> versus <code>/tmp/</code></p>
<h4 id="jsmeix_commented_at_2023-02-16_1239"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433027563">2023-02-16 12:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1239" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
in your<br />
usr/share/rear/prep/USB/Linux-i386/350_check_usb_disk.sh<br />
add at its beginning a line</p>
<pre><code>cat /proc/mounts
</code></pre>
<p>and run "rear -D mkbackup" again and<br />
attach its whole debug log file here.</p>
<h4 id="frilogg_commented_at_2023-02-16_1315"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433073632">2023-02-16 13:15</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-16_1315" title="Permanent link">&para;</a></h4>
<blockquote>
<p>The reason we want to export and use another tmpdir or else it would
not be enough space on device. I ran now export TMPDIR=/home/rear -
and now the backup is created. In rear 2.4 we could have this string
in the local.conf but it seems that its not working anymore?!</p>
</blockquote>
<p>@jsmeix this error was gone when I exported the TMPDIR, so the backup
ran. When I did not have this I could not make a complete backup at all.
And it is this backup that I am trying to restore. You still want me to
add this?</p>
<blockquote>
<p>cat /proc/mounts</p>
</blockquote>
<h4 id="jsmeix_commented_at_2023-02-16_1346"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433112809">2023-02-16 13:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-16_1346" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
but then your<br />
<a href="https://github.com/rear/rear/files/10755054/rear27-solx8ht.log">https://github.com/rear/rear/files/10755054/rear27-solx8ht.log</a><br />
does not match your screenshots in<br />
<a href="https://github.com/rear/rear/issues/2924#issuecomment-1432885861">https://github.com/rear/rear/issues/2924#issuecomment-1432885861</a></p>
<p>To get a clean state without possibly broken<br />
leftovers from what you did with ReaR 2.4<br />
I suggest to completely redo things<br />
with ReaR 2.7 from scratch i.e.:</p>
<p>First redo "rear -D format" for your USB disk<br />
and save its debug log file - perhaps we need it.<br />
Note that since ReaR 2.7 "rear format" behaves different,<br />
see our release notes about "rear format":<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/doc/rear-release-notes.txt#L297">https://github.com/rear/rear/blob/rear-2.7/doc/rear-release-notes.txt#L297</a></p>
<p>Then run "rear -D mkbackup" again and also<br />
save its debug log file - perhaps we need it.<br />
This will create the ReaR recovery system plus<br />
its bootloader things and the backup.tar.gz<br />
anew from scratch on your USB disk.</p>
<p>Then try to boot this new ReaR recovery system<br />
from your USB disk and report here whether or not<br />
that works for you with ReaR 2.7 - i.e. only<br />
whether or not the ReaR recovery system boots and<br />
if you can log in there as 'root' (no password needed).</p>
<p>Provided this works you can try to recreate your system<br />
by calling "rear -D recover" from inside the running<br />
ReaR recovery system.</p>
<p>When you run "rear recover" on some hardware or VM<br />
it will completely overwrite what there already is<br />
on the harddisk(s) or virtual disk(s) on that hardware or VM<br />
so never try out "rear recover" on your original system<br />
where you had run "rear mkbackup" before,<br />
see the initial sections in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="frilogg_commented_at_2023-02-16_1602"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1433323483">2023-02-16 16:02</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-16_1602" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix , I have now created the usb again with<br />
<code>rear format -D</code></p>
<p>But I still get the same error when running<br />
<code>rear -D mkbackup</code></p>
<blockquote>
<p>Relax-and-Recover 2.7 / 2022-07-13<br />
Running rear mkbackup (PID 23959 date 2023-02-16 16:48:13)<br />
Command line options: /sbin/rear -D mkbackup<br />
Using log file: /var/log/rear/rear-solx8ht.log<br />
Using build area: /var/tmp/rear.oVfd2oO0gXvooTT<br />
Running 'init' stage ======================<br />
Running workflow mkbackup on the normal/original system<br />
Running 'prep' stage ======================<br />
Using backup archive
'/var/tmp/rear.oVfd2oO0gXvooTT/outputfs/rear/sp7-ui/20230216.1648/backup.tar.gz'<br />
Found EFI system partition /dev/nvme0n1p1 on /boot/efi type vfat<br />
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)<br />
ERROR: USB or disk device '/dev/sda3' is already mounted on
'/tmp/rear.oVfd2oO0gXvooTT/outputfs'<br />
Some latest log messages since the last called script
350_check_usb_disk.sh:</p>
</blockquote>
<p><a href="https://github.com/rear/rear/files/10757885/rear-solx8ht.log">rear-solx8ht.log</a></p>
<h4 id="frilogg_commented_at_2023-02-18_0734"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1435512855">2023-02-18 07:34</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-18_0734" title="Permanent link">&para;</a></h4>
<p>Highly appreciate some more feedback @jsmeix or @schlomo as the backup
media itself is not creating with Rear 2.7.</p>
<h4 id="frilogg_commented_at_2023-02-23_1153"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1441630661">2023-02-23 11:53</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-23_1153" title="Permanent link">&para;</a></h4>
<p>Done some more research and with a help from a colleague we made
following changes to</p>
<blockquote>
<p>/usr/share/rear/prep/USB/Linux-i386/350_check_usb_disk.sh</p>
</blockquote>
<p><code># Check if the ReaR USB device is not accidentally mounted on other than $BUILD_DIR location: vBUILD_DIR=$BUILD_DIR BUILD_DIR=$(echo $BUILD_DIR | sed -r 's/\/var//g') if res=( $( grep -v $BUILD_DIR /proc/mounts | grep "^$REAL_USB_DEVICE" ) ) ; then     Error "USB or disk device '$REAL_USB_DEVICE' is already mounted on '${res[1]}'" fi BUILD_DIR=$vBUILD_DIR</code></p>
<p>This made the script go pass the error</p>
<blockquote>
<p>ERROR: USB or disk device '/dev/sda3' is already mounted on</p>
</blockquote>
<p>The backup starting to create but stops and "freeze" when trying to
finish.</p>
<pre><code>&gt; 2023-02-23 12:39:36.047271490 tar --warning=no-xdev --sparse --block-number --totals --verbose --no-wildcards-match-slash --one-file-system --ignore-failed-read --anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux --acls --gzip -X /home/rear/rear.whvq6zfr2uszZYN/tmp/backup-exclude.txt -C / -c -f - /home / /boot/efi /boot /var/log/rear/rear-solx8ht.log | dd of=/home/rear/rear.whvq6zfr2uszZYN/outputfs/rear/sp7-ui/20230223.1237/backup.tar.gz bs=1M
++ test 1
++ case "$( basename $BACKUP_PROG )" in
+++ basename tar
++ sleep 1
++ kill -0 30009
+++ awk '{s+=$1} END {print s}'
+++ stat -c %s /home/rear/rear.whvq6zfr2uszZYN/outputfs/rear/sp7-ui/20230223.1237/backup.tar.gz
++ size=16515072
++ ProgressInfo 'Archived 15 MiB [avg 8064 KiB/sec] '
++ echo -en '\e[2K\rArchived 15 MiB [avg 8064 KiB/sec] \e7'
++ sleep 1
</code></pre>
<p>Any suggestion to this error when its freezing?</p>
<p><a href="https://github.com/rear/rear/files/10813177/rear-solx8ht.log">rear-solx8ht.log</a></p>
<h4 id="jsmeix_commented_at_2023-02-23_1222"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1441672400">2023-02-23 12:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-23_1222" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
sorry - no idea - and currently no time for it (too many other
things).<br />
I will have to test things myself (but I use openSUSE Leap 15.4)<br />
to get a better understanding what actually is going on<br />
before I can make some reasonable comment here.</p>
<h4 id="frilogg_commented_at_2023-02-23_1414"><img src="https://avatars.githubusercontent.com/u/15347421?u=b1164936e1d6dd4ea31f7bd7ce06d3be0cbb4d3e&v=4" width="50"><a href="https://github.com/frilogg">frilogg</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1441871825">2023-02-23 14:14</a>:<a class="headerlink" href="#frilogg_commented_at_2023-02-23_1414" title="Permanent link">&para;</a></h4>
<p>@schlomo and @jsmeix</p>
<p>I have now got it to work but I had to do the following</p>
<ol>
<li>
<p>Make the changes to the script 350_check_usb_disk.sh , and
    hopefully this can be something you can use.</p>
</li>
<li>
<p>Install kernel-devel</p>
</li>
<li>
<p>Use another TMPDIR location as this got to small for /var/tmp - and
    created exclude for this folder.</p>
</li>
<li>
<p>Define use of theese seeings<br />
    BOOTLOADER="GRUB2-EFI"<br />
    USING_UEFI_BOOTLOADER=1</p>
</li>
<li>
<p>Then use secure boot at startup. No secure is not working. I have
    also tried checking bios settings if there are any settings that
    could have impact here but secure boot is actually off, and also
    settings regarding uefi paths is off.</p>
</li>
</ol>
<p>Its working for now, but if I get the time I will try doing more
research but the workaround in the 350 script worked.</p>
<h4 id="jsmeix_commented_at_2023-02-23_1438"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1441905200">2023-02-23 14:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-23_1438" title="Permanent link">&para;</a></h4>
<p>@frilogg<br />
thank you for your feedback that<br />
for now you could make it work for your case<br />
and what you did to make it work for your case.</p>
<p>I will have a look when time permits.</p>
<h4 id="github-actions_commented_at_2023-04-25_0221"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2924#issuecomment-1521061819">2023-04-25 02:21</a>:<a class="headerlink" href="#github-actions_commented_at_2023-04-25_0221" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-02-13.2924.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
