<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2896 Issue closed: Ubuntu 22.04: rear recover: "Failed to install GRUB2 on /dev/vda" (no BIOS Boot Partition) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2896 Issue closed: Ubuntu 22.04: rear recover: \"Failed to install GRUB2 on /dev/vda\" (no BIOS Boot Partition)";
        var mkdocs_page_input_path = "issues/2022-12-05.2896.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2896 Issue closed: Ubuntu 22.04: rear recover: "Failed to install GRUB2 on /dev/vda" (no BIOS Boot Partition)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2896_issue_closed_ubuntu_2204_rear_recover_failed_to_install_grub2_on_devvda_no_bios_boot_partition"><a href="https://github.com/rear/rear/issues/2896">#2896 Issue</a> <code>closed</code>: Ubuntu 22.04: rear recover: "Failed to install GRUB2 on /dev/vda" (no BIOS Boot Partition)<a class="headerlink" href="#2896_issue_closed_ubuntu_2204_rear_recover_failed_to_install_grub2_on_devvda_no_bios_boot_partition" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>no-issue-activity</code></p>
<h4 id="will-code-for-pizza_opened_issue_at_2022-12-05_1822"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> opened issue at <a href="https://github.com/rear/rear/issues/2896">2022-12-05 18:22</a>:<a class="headerlink" href="#will-code-for-pizza_opened_issue_at_2022-12-05_1822" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
<code>Relax-and-Recover 2.7-git.0.0.unknown / 2022-12-05</code></p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>PRETTY_NAME="Ubuntu 22.04.1 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.1 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>GRUB2_INSTALL_DEVICES="/dev/vda"

### write the rescue initramfs to USB and update the USB bootloader
OUTPUT=ISO

### create a backup using the internal NETFS method, using 'tar'
BACKUP=NETFS

### write both rescue image and backup to the device labeled REAR-000
BACKUP_URL=usb:///dev/disk/by-label/REAR-000

#USB_DEVICE_FILESYSTEM=ext4
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    KVM Guest</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
<code>inux rear-test 5.15.0-56-generic #62-Ubuntu SMP Tue Nov 22 19:54:14 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</code></p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    Grub2</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    QCOW2</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME        KNAME     PKNAME   TRAN   TYPE FSTYPE LABEL      SIZE MOUNTPOINT
/dev/sr0    /dev/sr0           sata   rom  udf    REAR-ISO 616.5M 
/dev/vda    /dev/vda                  disk                    25G 
|-/dev/vda1 /dev/vda1 /dev/vda        part vfat              487M /mnt/local/boot/efi
`-/dev/vda2 /dev/vda2 /dev/vda        part ext4             24.5G /mnt/local
/dev/vdb    /dev/vdb                  disk                    40G 
|-/dev/vdb1 /dev/vdb1 /dev/vdb        part                     8M 
|-/dev/vdb2 /dev/vdb2 /dev/vdb        part vfat   REAR-EFI     1G 
`-/dev/vdb3 /dev/vdb3 /dev/vdb        part ext3   REAR-000    39G
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<!-- -->

<pre><code>User confirmed to proceed with 'recover'
Start system layout restoration.
Disk '/dev/vda': creating 'gpt' partition table
Disk '/dev/vda': creating partition number 1 with name ''vda1''
Disk '/dev/vda': creating partition number 2 with name ''vda2''
Creating filesystem of type ext4 with mount point / on /dev/vda2.
Mounting filesystem /
Creating filesystem of type vfat with mount point /boot/efi on /dev/vda1.
Mounting filesystem /boot/efi
Disk layout created.
Restoring from '/var/tmp/rear.RkCSPwAlwlupS5M/outputfs/rear-test/backup.tar.gz' (restore log in /var/lib/rear/restore/recover.backup.tar.gz.1647.restore.log) ...
Restored 11239 MiB [avg. 56141 KiB/sec] OK
Restored 11239 MiB in 206 seconds [avg. 55868 KiB/sec]
Restoring finished (verify backup restore log messages in /var/lib/rear/restore/recover.backup.tar.gz.1647.restore.log)
Created SELinux /mnt/local/.autorelabel file : after reboot SELinux will relabel all files
Recreating directories (with permissions) from /var/lib/rear/recovery/directories_permissions_owner_group
Migrating disk-by-id mappings in certain restored files in /mnt/local to current disk-by-id mappings ...
Updated initramfs with new drivers for this system.
Installing GRUB2 boot loader...
Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)
Failed to install GRUB2 on /dev/vda
WARNING:
For this system
Ubuntu/22.04 on Linux-i386 (based on Debian/22.04/i386)
there is no code to install a boot loader on the recovered system
or the code that we have failed to install the boot loader correctly.
Please contribute appropriate code to the Relax-and-Recover project,
see http://relax-and-recover.org/development/
Take a look at the scripts in /usr/share/rear/finalize - for example
for PC architectures like x86 and x86_64 see the script
/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh
and for POWER architectures like ppc64le see the script
/usr/share/rear/finalize/Linux-ppc64le/660_install_grub2.sh
---------------------------------------------------
|  IF YOU DO NOT INSTALL A BOOT LOADER MANUALLY,  |
|  THEN YOUR SYSTEM WILL NOT BE ABLE TO BOOT.     |
---------------------------------------------------
You can use 'chroot /mnt/local bash --login'
to change into the recovered system and
manually install a boot loader therein.

Finished 'recover'. The target system is mounted at '/mnt/local'.
Exiting rear recover (PID 1647) and its descendant processes ...
Running exit tasks
</code></pre>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2022-12-06_1209"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1339225746">2022-12-06 12:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-06_1209" title="Permanent link">&para;</a></h4>
<p>@will-code-for-pizza<br />
without a "rear -D recover" debug log file<br />
we at ReaR upstream cannot guess why it<br />
"Failed to install GRUB2 on /dev/vda".</p>
<p>This error message comes from<br />
usr/share/rear/finalize/Linux-i386/660_install_grub2.sh<br />
for current ReaR upstream GitHub masetr code at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh#L105">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/Linux-i386/660_install_grub2.sh#L105</a></p>
<pre><code>if ! chroot $TARGET_FS_ROOT /bin/bash --login -c "$grub_name-install $grub2_install_device" ; then
    LogPrintError "Failed to install GRUB2 on $grub2_install_device"
</code></pre>
<p>so what failed was the command</p>
<pre><code>chroot $TARGET_FS_ROOT /bin/bash --login -c "$grub_name-install $grub2_install_device"
</code></pre>
<p>With "rear -D recover" there should be sufficient debug messages<br />
in the ReaR log file in particular some (error) messages of<br />
grub2-install or grub-install (what $grub_name-install evaluates to)<br />
that hopefully point to the root cause wha it fails.</p>
<p>This code worked well for me for my tests<br />
but I am not a Ubuntu user so when things are<br />
different on Ubuntu there is not much what I can do<br />
in practice (I won't find time to install Ubuntu<br />
and try out how things behave there).</p>
<h4 id="jsmeix_commented_at_2022-12-06_1214"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1339232625">2022-12-06 12:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-06_1214" title="Permanent link">&para;</a></h4>
<p>@will-code-for-pizza<br />
FYI:<br />
See the section<br />
"Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
that reads (excerpts)</p>
<pre><code>When "rear -d -D recover" fails,
you need to save the log file
out of the ReaR recovery system
(where "rear -d -D recover" was run
and where it had failed) before you
shut down the ReaR recovery system
...
See the "First steps with Relax-and-Recover"
section above how to access the ReaR recovery
system from remote via ssh so that you can
use 'scp' to get files out of the ReaR recovery
system.
</code></pre>
<p>The "First steps with Relax-and-Recover" section<br />
reads (excerpt)</p>
<pre><code>SSH_ROOT_PASSWORD="rear"

Never use your original root password here.
</code></pre>
<p>See also the SSH_ROOT_PASSWORD description in default.conf<br />
e.g. online for ReaR 2.7 at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1861">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1861</a></p>
<h4 id="will-code-for-pizza_commented_at_2022-12-08_0859"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342295425">2022-12-08 08:59</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-08_0859" title="Permanent link">&para;</a></h4>
<p>Thanks for this hint...</p>
<p>I think, this is the interesting part of the log:</p>
<pre><code>Found linux image: /boot/vmlinuz-5.15.0-43-generic
Found initrd image: /boot/initrd.img-5.15.0-43-generic
Found memtest86+ image: /boot/memtest86+.elf
Found memtest86+ image: /boot/memtest86+.bin
Warning: os-prober will not be executed to detect other bootable partitions.
Systems on them will not be added to the GRUB boot configuration.
Check GRUB_DISABLE_OS_PROBER documentation entry.
done
++ test /dev/vda
++ grub2_install_failed=no
++ for grub2_install_device in $GRUB2_INSTALL_DEVICES
++ test -s ''
++ LogPrint 'Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)'
++ Log 'Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)'
++ test -w /var/log/rear/rear-rear-test.log
++ echo '2022-12-08 09:35:27.961000022 Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)'
2022-12-08 09:35:27.961000022 Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)
++ Print 'Installing GRUB2 on /dev/vda (specified in GRUB2_INSTALL_DEVICES)'
++ chroot /mnt/local /bin/bash --login -c 'grub-install /dev/vda'
Installing for i386-pc platform.
grub-install: warning: this GPT partition label contains no BIOS Boot Partition; embedding won't be possible.
grub-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..
grub-install: error: will not proceed with blocklists.
++ LogPrintError 'Failed to install GRUB2 on /dev/vda'
++ Log 'Failed to install GRUB2 on /dev/vda'
++ test -w /var/log/rear/rear-rear-test.log
++ echo '2022-12-08 09:35:32.915349993 Failed to install GRUB2 on /dev/vda'
2022-12-08 09:35:32.915349993 Failed to install GRUB2 on /dev/vda
++ PrintError 'Failed to install GRUB2 on /dev/vda'
++ grub2_install_failed=yes
</code></pre>
<p>If I try a</p>
<pre><code>RESCUE rear-test:/var/log/rear # grub-install /dev/vda
Installing for i386-pc platform.
grub-install: warning: cannot open directory `/usr/share/locale': No such file or directory.
grub-install: error: failed to get canonical path of `none'.
</code></pre>
<p>it seems, that some grub related packages are missing.</p>
<p>So f.e. grub-efi-amd64-signed os-prober # Alternative: grub-efi-amd64</p>
<p>???</p>
<p>Cheers.</p>
<h4 id="will-code-for-pizza_commented_at_2022-12-08_0919"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342331352">2022-12-08 09:19</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-08_0919" title="Permanent link">&para;</a></h4>
<pre><code>RESCUE rear-test:~ # grub-install --root-directory=/mnt/local --efi-directory=/mnt/local/boot/efi  /dev/vda 
Installing for i386-pc platform.
grub-install: warning: cannot open directory `/usr/share/locale': No such file or directory.
grub-install: warning: this GPT partition label contains no BIOS Boot Partition; embedding won't be possible.
grub-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..
grub-install: error: will not proceed with blocklists.
</code></pre>
<h4 id="will-code-for-pizza_commented_at_2022-12-08_1138"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342584423">2022-12-08 11:38</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-08_1138" title="Permanent link">&para;</a></h4>
<pre><code>RESCUE rear-test:/usr/share/rear/finalize/Linux-i386 # mkdir /usr/share/locale
RESCUE rear-test:/usr/share/rear/finalize/Linux-i386 # grub-install --root-directory=/mnt/local --efi-directory=/mnt/local/boot/efi  /dev/vda 
Installing for i386-pc platform.
grub-install: warning: this GPT partition label contains no BIOS Boot Partition; embedding won't be possible.
grub-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..
grub-install: error: will not proceed with blocklists.
</code></pre>
<h4 id="jsmeix_commented_at_2022-12-08_1214"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342638639">2022-12-08 12:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-08_1214" title="Permanent link">&para;</a></h4>
<p>The issus is that ReaR calls in<br />
usr/share/rear/finalize/Linux-i386/660_install_grub2.sh</p>
<pre><code>chroot /mnt/local /bin/bash --login -c 'grub-install /dev/vda'
</code></pre>
<p>which fails in your case with</p>
<pre><code>grub-install: warning: this GPT partition label contains no BIOS Boot Partition; embedding won't be possible.
grub-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..
grub-install: error: will not proceed with blocklists.
</code></pre>
<p>So it seems Ubuntu 22.04 installs itself without a BIOS Boot Partition<br />
which is needed by <code>grub-install /dev/vda</code>.</p>
<p>I am neither a booting expert nor am I a Ubuntu user<br />
so I cannot tell how Ubuntu 22.04 bootloader setup is done<br />
so that it works on the original system.</p>
<p>What puzzles me is that GRUB2 talks about a BIOS Boot Partition<br />
while there is /boot/efi mounted on /dev/vda1 which indicates<br />
that UEFI is used with an EFI system partition (ESP) /dev/vda1<br />
and I think that BIOS and UEFI somewhat contradict each other<br />
but I am not a sufficient booting expert to make educated<br />
statements here - in particular not off the top of my head.</p>
<p>From my current point of view I think ReaR may need some<br />
Ubuntu specific enhancements so that the bootloader setup<br />
at the end of "rear recover" also works on Ubuntu 22.04.</p>
<h4 id="will-code-for-pizza_commented_at_2022-12-08_1255"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342691847">2022-12-08 12:55</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-08_1255" title="Permanent link">&para;</a></h4>
<p>@jsmeix , thanks for your support...</p>
<p>Probably, the "This GPT partition label contains no BIOS boot partition"
message suggests that the rescue media was booted in legacy BIOS style,
and as a result, it will wind up trying to install a BIOS version of
GRUB onto a GPT-partitioned disk.</p>
<p>It' s just a suggestion. My crystal ball is in the wash right now :-(</p>
<p>Cause I use a KVM VM for testing, I will search now for how to activate
EFI boot mechanism for ISO.<br />
Probably this would fix it.</p>
<p>Thanks a lot so far.</p>
<h4 id="jsmeix_commented_at_2022-12-08_1413"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1342799566">2022-12-08 14:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-08_1413" title="Permanent link">&para;</a></h4>
<p>@will-code-for-pizza<br />
as far as I know the ReaR recovery medium must use the same<br />
booting mechanism (either BIOS or UEFI) as the original system<br />
otherwise it is not possible to intstall the right booting mechanism<br />
(i.e. the same as on the original system) during "rear recover".</p>
<p>When you use UEFI on your original sytem<br />
but "rear mkrescue" creates a ReaR recovery medium<br />
with BIOS booting mechanism you may have to explicitly<br />
specify things like<br />
USING_UEFI_BOOTLOADER<br />
UEFI_BOOTLOADER<br />
and when you use UEFI with Secure Boot<br />
you may have to additionally specify<br />
SECURE_BOOT_BOOTLOADER</p>
<p>In general see usr/share/rear/conf/default.conf<br />
for various things that are described therein<br />
which are related to [U]EFI (and Secure Boot).</p>
<h4 id="devil0000_commented_at_2022-12-13_1543"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1348843313">2022-12-13 15:43</a>:<a class="headerlink" href="#devil0000_commented_at_2022-12-13_1543" title="Permanent link">&para;</a></h4>
<p>@jsmeix since my changes to format and grub install it should be
possible to create a recover media with one method of your choice or
both boot methods (bios/uefi). The uefi case however is buggy see #2883</p>
<p>@will-code-for-pizza what was your <code>rear format</code> command used? or does
iso mode not require that command?<br />
also you may need more grub packages depending on what you try to
achieve.</p>
<h4 id="jsmeix_commented_at_2022-12-14_1404"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1351415312">2022-12-14 14:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-14_1404" title="Permanent link">&para;</a></h4>
<p>Whoops!<br />
Now I see it: <code>OUTPUT=ISO</code> with <code>BACKUP_URL=usb:...</code><br />
@DEvil0000 thank you to mention <code>rear format</code> and "iso mode"!</p>
<p>I think</p>
<pre><code>OUTPUT=ISO
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
</code></pre>
<p>does not "just work", cf.<br />
<a href="https://github.com/rear/rear/issues/2210">https://github.com/rear/rear/issues/2210</a></p>
<p>What should work is</p>
<pre><code>OUTPUT=USB
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
</code></pre>
<p>cf.<br />
<a href="https://relax-and-recover.org/documentation/getting-started">https://relax-and-recover.org/documentation/getting-started</a><br />
and see what I had tested e.g. in<br />
<a href="https://github.com/rear/rear/pull/2829">https://github.com/rear/rear/pull/2829</a><br />
where I had tested <code>OUTPUT=USB</code> with BIOS and UEFI<br />
and<br />
<a href="https://github.com/rear/rear/pull/2662">https://github.com/rear/rear/pull/2662</a><br />
but there I had only tested <code>OUTPUT=USB</code> with BIOS.</p>
<p>Alternatively there is</p>
<pre><code>OUTPUT=RAWDISK
</code></pre>
<p>see its description in usr/share/rear/conf/default.conf<br />
and
<a href="https://github.com/rear/rear/issues/2698">https://github.com/rear/rear/issues/2698</a></p>
<h4 id="devil0000_commented_at_2022-12-15_1332"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1353072134">2022-12-15 13:32</a>:<a class="headerlink" href="#devil0000_commented_at_2022-12-15_1332" title="Permanent link">&para;</a></h4>
<p>I don't think I ever tested the combination of <code>OUTPUT=ISO</code> with
<code>BACKUP_URL=usb:...</code> but I think this should be valid.<br />
I would in such a case expect a ISO getting build and then written to a
device with <code>dd</code> using the device in <code>BACKUP_URL</code>. If this combination
is not valid we should document it/print a log line.</p>
<p>I am however not sure if this is the actual issue since it is very
similar to USB related issues I faced when testing UEFI see #2883</p>
<h4 id="jsmeix_commented_at_2022-12-15_1433"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1353188356">2022-12-15 14:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-15_1433" title="Permanent link">&para;</a></h4>
<p>Some general info:</p>
<p>Our various ReaR recovery system bootloader setup things<br />
are long grown rather complicated / convoluted pieces of code<br />
that behave different depending on "these or those" conditions.</p>
<p>As far as I can remember I never tested the combination<br />
of <code>OUTPUT=ISO</code> with <code>BACKUP_URL=usb:...</code> and I don't know<br />
whether or not that combination should work or had ever worked<br />
(if I knew it cannot work I would add a check and error out<br />
when a user specified this combination).</p>
<p>As far as I can remember I only tested<br />
mostly <code>OUTPUT=ISO</code> with <code>BACKUP_URL=nfs:...</code><br />
and less often <code>OUTPUT=USB</code> with <code>BACKUP_URL=usb:...</code><br />
the latter mostly with BIOS and only a bit with UEFI, cf.<br />
<a href="https://github.com/rear/rear/pull/2829#issuecomment-1165584336">https://github.com/rear/rear/pull/2829#issuecomment-1165584336</a></p>
<p>Furthermore I am not a Ubuntu user<br />
(and I won't find time to test things on Ubuntu) and<br />
we at ReaR upstream do not have an active maintainer who uses Ubuntu<br />
(and it seems Canonical is not sufficiently interested in ReaR)<br />
so ReaR support for Ubuntu can be only as good as voluntary<br />
contributors who use Ubuntu contribute - which is much appreciated!</p>
<h4 id="jsmeix_commented_at_2022-12-15_1439"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1353196084">2022-12-15 14:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-15_1439" title="Permanent link">&para;</a></h4>
<p>As far as I see from plain looking at what is written in<br />
<a href="https://github.com/rear/rear/issues/2883">https://github.com/rear/rear/issues/2883</a></p>
<pre><code>grub-install: error: cannot find EFI directory
</code></pre>
<p>the error message there at least looks to me<br />
as if the issue there is a different one.<br />
But I am not a sufficient booting expert<br />
(and even less an UEFI and/or Secure Boot expert)<br />
to make educated statements here.</p>
<h4 id="jsmeix_commented_at_2022-12-15_1441"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1353198769">2022-12-15 14:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-12-15_1441" title="Permanent link">&para;</a></h4>
<p>@will-code-for-pizza</p>
<p>could you try out if the patch from @DEvil0000 in<br />
<a href="https://github.com/rear/rear/issues/2883#issuecomment-1302006263">https://github.com/rear/rear/issues/2883#issuecomment-1302006263</a><br />
makes things works for you?</p>
<h4 id="will-code-for-pizza_commented_at_2022-12-26_1706"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1365288564">2022-12-26 17:06</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-26_1706" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@jsmeix , thanks for your support...</p>
<p>Probably, the "This GPT partition label contains no BIOS boot
partition" message suggests that the rescue media was booted in legacy
BIOS style, and as a result, it will wind up trying to install a BIOS
version of GRUB onto a GPT-partitioned disk.</p>
<p>It' s just a suggestion. My crystal ball is in the wash right now :-(</p>
<p>Cause I use a KVM VM for testing, I will search now for how to
activate EFI boot mechanism for ISO. Probably this would fix it.</p>
<p>Thanks a lot so far.</p>
</blockquote>
<p>Hi together, after beeing ill for 2 weeks, I found time to test and my
specific problem depends on the boot/EFI config of my virtual machine...
:-(</p>
<p>Sorry for bothering you because of an environmental issue.</p>
<h4 id="will-code-for-pizza_commented_at_2022-12-26_1707"><img src="https://avatars.githubusercontent.com/u/19435718?u=ed79ce4705081dc23542358b2bc50f403c729924&v=4" width="50"><a href="https://github.com/will-code-for-pizza">will-code-for-pizza</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1365288839">2022-12-26 17:07</a>:<a class="headerlink" href="#will-code-for-pizza_commented_at_2022-12-26_1707" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@will-code-for-pizza</p>
<p>could you try out if the patch from @DEvil0000 in <a href="https://github.com/rear/rear/issues/2883#issuecomment-1302006263">#2883
(comment)</a>
makes things works for you?</p>
</blockquote>
<p>I will try this on a physical machine these days.</p>
<h4 id="github-actions_commented_at_2023-03-04_0234"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2896#issuecomment-1454342850">2023-03-04 02:34</a>:<a class="headerlink" href="#github-actions_commented_at_2023-03-04_0234" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-12-05.2896.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
