<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1806 PR merged: Issue #1380 - ReaR recovery fails when the OS contains a Thin Pool/Volume - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1806 PR merged: Issue #1380 - ReaR recovery fails when the OS contains a Thin Pool/Volume";
        var mkdocs_page_input_path = "issues/2018-05-15.1806.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1806 PR merged: Issue #1380 - ReaR recovery fails when the OS contains a Thin Pool/Volume</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1806_pr_merged_issue_1380_-_rear_recovery_fails_when_the_os_contains_a_thin_poolvolume"><a href="https://github.com/rear/rear/pull/1806">#1806 PR</a> <code>merged</code>: Issue #1380 - ReaR recovery fails when the OS contains a Thin Pool/Volume<a class="headerlink" href="#1806_pr_merged_issue_1380_-_rear_recovery_fails_when_the_os_contains_a_thin_poolvolume" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="rmetrich_opened_issue_at_2018-05-15_1542"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> opened issue at <a href="https://github.com/rear/rear/pull/1806">2018-05-15 15:42</a>:<a class="headerlink" href="#rmetrich_opened_issue_at_2018-05-15_1542" title="Permanent link">&para;</a></h4>
<p>Using 'vgcfgrestore' to restore Thin LVs doesn't work, because there<br />
isn't the metadata in the configuration file.<br />
To be able to use Thin LVs, upon failure of 'vgcfgrestore' (or
migration),<br />
traditional 'vgcreate/lvcreate' are used instead.</p>
<p>This approach is sub-optimal because it requires to know all the<br />
possible options to 'lvcreate', which is hard/impossible to do.<br />
Nonetheless, this is better than nothing since the issue with
'lvcreate'<br />
options was already there in case of migration.</p>
<p>The code using 'lvcreate' only runs upon 'vgcfgrestore' failure, which<br />
typically happens only with Thin LVs (IMHO). Hence, on most setups,
the<br />
optimized code will still run, preventing any regression to happen.</p>
<p>Signed-off-by: Renaud M√©trich <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#109;&#101;&#116;&#114;&#105;&#99;&#104;&#64;&#114;&#101;&#100;&#104;&#97;&#116;&#46;&#99;&#111;&#109;">&#114;&#109;&#101;&#116;&#114;&#105;&#99;&#104;&#64;&#114;&#101;&#100;&#104;&#97;&#116;&#46;&#99;&#111;&#109;</a></p>
<p>PLEASE TEST MORE.</p>
<p>I tested as follows:</p>
<ul>
<li>regular system with 1 VG, no thin pool</li>
<li>system with 1 VG, and root filesystem on thin pool + some special
    LVs (mirror, raid1, raid5, etc).</li>
</ul>
<p>I plan to test tomorrow on a system with 1 VG, no thin pool but some
special LVs (mirror, raid, etc) to verify that <code>vgcfgrestore</code> also works
with special LVs.</p>
<h4 id="rmetrich_commented_at_2018-05-16_1050"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389477090">2018-05-16 10:50</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-16_1050" title="Permanent link">&para;</a></h4>
<p>The proposed code does the following:</p>
<ol>
<li>
<p>During backup</p>
</li>
<li>
<p>Collect additional LV properties</p>
<p>origin: originating LV (for cache and snapshots)<br />
lv_layout: type of LV (mirror, raid, thin, etc)<br />
pool_lv: thin pool hosting LV<br />
chunk_size: size of the chunk, for various volumes<br />
stripes: number of stripes, for Mirror volumes and Stripes volumes<br />
stripe_size: size of a stripe, for Raid volumes</p>
</li>
<li>
<p>Skip caches and snapshots (not supported)</p>
</li>
<li>
<p>During restore</p>
</li>
<li>
<p>If in Migration mode (e.g. different disks but same size), go
    through the vgcreate/lvcreate code (Legacy Method), printing
    Warnings because the initial layout may not be preserved (because we
    do not save all attributes needed for re-creating LVM volumes)</p>
</li>
<li>
<p>Otherwise, try "vgcfgrestore"</p>
</li>
<li>
<p>If it fails</p>
<ul>
<li>Try "vgcfgrestore --force"</li>
<li>If it fails, use vgcreate/lvcreate (Legacy Method)</li>
<li>Otherwise, remove Thin pools (which are broken due to --force
    flag)</li>
<li>Create Thin pools using Legacy Method (but do not create other
    LVs which have been succesfully restored)</li>
</ul>
</li>
</ol>
<h4 id="jsmeix_commented_at_2018-05-17_1124"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389833681">2018-05-17 11:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-17_1124" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I am currently too busy with other stuff so that I cannot have a look
here right now.<br />
Is this enhancement useful for ReaR 2.4 or can it be postponed to ReaR
2.5?</p>
<h4 id="rmetrich_commented_at_2018-05-17_1129"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389834770">2018-05-17 11:29</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-17_1129" title="Permanent link">&para;</a></h4>
<p>Thin pools are widely used along with docker.<br />
The code has been implemented to prevent any regression when not using
thin pools (the vgcfgrestore should just work). When in migration mode,
the code should enhance the recovery, but this requires some testing (I
tested with Thin pools, Linear volumes and Raid/Mirror volumes).</p>
<h4 id="gozora_commented_at_2018-05-17_1145"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389838444">2018-05-17 11:45</a>:<a class="headerlink" href="#gozora_commented_at_2018-05-17_1145" title="Permanent link">&para;</a></h4>
<p>Hello @rmetrich at first glance it looks good to me. I'm however not
that good in reading plain code :-/ ...<br />
But I can run couple of tests during this weekend if needed ...</p>
<p>V.</p>
<h4 id="gdha_commented_at_2018-05-17_1249"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389854766">2018-05-17 12:49</a>:<a class="headerlink" href="#gdha_commented_at_2018-05-17_1249" title="Permanent link">&para;</a></h4>
<p>@rmetrich End of next week I can do some automated tests - this weekend
is occupied (marriage of my daughter and other work duty unfortunately).
Beginning of next week I take a few days off to really relax (in Germany
and Luxembourg).</p>
<p>Additional note: <strong>ReaR 2.4</strong> is OK for me as my main customer is also
struggling with these kind of stuff (with docker containers). <em>And, I
believe RedHat had plans to replace there 2.0 version with the latest
2.4 if I'm not mistaken.</em></p>
<h4 id="rmetrich_commented_at_2018-05-17_1254"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389856030">2018-05-17 12:54</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-17_1254" title="Permanent link">&para;</a></h4>
<p>üëç Perfect!<br />
We have indeed plans to rebase to 2.4 asap (RHEL7.6), but it's not
committed.</p>
<h4 id="jsmeix_commented_at_2018-05-17_1307"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389859857">2018-05-17 13:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-17_1307" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
only a side note FYI in general<br />
regarding what you wrote in your initial comment</p>
<pre>
This approach is sub-optimal because it requires to know all the
possible options to 'lvcreate', which is hard/impossible to do.
</pre>

<p>You may have a look at my general opinion about such cases<br />
e.g. in<br />
<a href="https://github.com/rear/rear/pull/1513#issuecomment-332123766">https://github.com/rear/rear/pull/1513#issuecomment-332123766</a><br />
and<br />
<a href="https://github.com/rear/rear/pull/1204#issuecomment-282252947">https://github.com/rear/rear/pull/1204#issuecomment-282252947</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/1242#issuecomment-288349895">https://github.com/rear/rear/issues/1242#issuecomment-288349895</a><br />
and in the latter follow the links to the other issue comments.</p>
<p>But I know basically nothing at all about Thin Pool/Volume or even
docker<br />
so that I don't know if it could make any sense in this particular
case<br />
to implement config variables where the user could - if needed -
specify<br />
his particular settings for his particular Thin Pool/Volume setup.</p>
<h4 id="jsmeix_commented_at_2018-05-17_1315"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-389862065">2018-05-17 13:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-17_1315" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
another side note FYI in general regarding "when in migration mode":</p>
<p>When in migration mode it is perfectly fine to ask the user<br />
via the UserInput function for needed values and/or let him<br />
check and confirm something before it gets actually set up.</p>
<p>Only when not in migration mode "rear recover" should normally<br />
run unattended - but even if UserInput is also needed in this case<br />
the user could predefine UserInput values to get it run unattended,<br />
cf. the USER_INPUT_... variables in default.conf</p>
<h4 id="schabrolles_commented_at_2018-05-19_1652"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390417770">2018-05-19 16:52</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-19_1652" title="Permanent link">&para;</a></h4>
<p>@rmetrich,<br />
I tried your patch on a sles11sp4 (POWER arch). I got the following
error during <code>rear recover</code></p>
<pre><code>No code has been generated to recreate fs:/ (fs).
    To recreate it manually add code to /var/lib/rear/layout/diskrestore.sh or abort.
UserInput -I ADD_CODE_TO_RECREATE_MISSING_FSFS needed in /usr/share/rear/layout/prepare/default/600_show_unprocessed.sh line 33
Manually add code that recreates fs:/ (fs)
1) View /var/lib/rear/layout/diskrestore.sh
2) Edit /var/lib/rear/layout/diskrestore.sh
3) Go to Relax-and-Recover shell
4) Continue 'rear recover'
5) Abort 'rear recover'
(default '4' timeout 10 seconds)
</code></pre>
<p>FYI, the layout is LVM sles11 default:<br />
/boot in a partition<br />
/ in LVM</p>
<p>I don't have time to look at the reason why ... but just to be sure I've
tested several time. I also confirm that I don't get any problem with
the current master branch on this system.</p>
<p>I attache the log file of <code>rear -D recover</code> in debug mode<br />
<a href="https://github.com/rear/rear/files/2019653/rear-rear-sles11-144.log">rear-rear-sles11-144.log</a></p>
<p>I'm gonna test on other system (SLES12 / RHEL7 / RHEL6 and ubuntu)</p>
<h4 id="rmetrich_commented_at_2018-05-19_1830"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390423919">2018-05-19 18:30</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-19_1830" title="Permanent link">&para;</a></h4>
<p>I'll have a look on tuesday. Thanks for reporting.</p>
<p>Renaud.</p>
<p>Out of the office / Sent from my phone.</p>
<p>Le sam. 19 mai 2018 18:53, S√©bastien Chabrolles
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a><br />
a √©crit :</p>
<blockquote>
<p>@rmetrich
<a href="https://github.com/rmetrich">https://github.com/rmetrich</a>,<br />
I tried your patch on a sles11sp4 (POWER arch). I got the following
error<br />
during rear recover</p>
<p>No code has been generated to recreate fs:/ (fs).<br />
To recreate it manually add code to
/var/lib/rear/layout/diskrestore.sh or abort.<br />
UserInput -I ADD_CODE_TO_RECREATE_MISSING_FSFS needed in
/usr/share/rear/layout/prepare/default/600_show_unprocessed.sh line
33<br />
Manually add code that recreates fs:/ (fs)</p>
<ol>
<li>View /var/lib/rear/layout/diskrestore.sh</li>
<li>Edit /var/lib/rear/layout/diskrestore.sh</li>
<li>Go to Relax-and-Recover shell</li>
<li>Continue 'rear recover'</li>
<li>Abort 'rear recover'<br />
    (default '4' timeout 10 seconds)</li>
</ol>
<p>I don't have time to look at the reason why ... but just to be sure
I've<br />
tested several time. I also confirm that I don't get any problem with
the<br />
current master branch on this system.</p>
<p>I attache the log file of rear -D recover in debug mode<br />
rear-rear-sles11-144.log<br />
<a href="https://github.com/rear/rear/files/2019653/rear-rear-sles11-144.log">https://github.com/rear/rear/files/2019653/rear-rear-sles11-144.log</a></p>
<p>I'm gonna test on other system (SLES12 / RHEL7 / RHEL6 and ubuntu)</p>
<p>‚Äî<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/1806#issuecomment-390417770">https://github.com/rear/rear/pull/1806#issuecomment-390417770</a>,
or mute<br />
the thread<br />
<a href="https://github.com/notifications/unsubscribe-auth/ABHBc11N1T9p6KIBGovoWBzJfBUGTsFzks5t0E3ogaJpZM4T_zHF">https://github.com/notifications/unsubscribe-auth/ABHBc11N1T9p6KIBGovoWBzJfBUGTsFzks5t0E3ogaJpZM4T_zHF</a><br />
.</p>
</blockquote>
<h4 id="rmetrich_commented_at_2018-05-22_0806"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390900488">2018-05-22 08:06</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-22_0806" title="Permanent link">&para;</a></h4>
<p>@schabrolles From the Debug log, I do not see any <code>create_lvmvol()</code>
call, causing the issue.<br />
Can you provide the Debug log for the rescue creation, it's likely there
that the issue is.</p>
<h4 id="schabrolles_commented_at_2018-05-22_0825"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390905721">2018-05-22 08:25</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-22_0825" title="Permanent link">&para;</a></h4>
<p>@rmetrich,</p>
<p>What is strange is that <code>/boot</code> fs is present in disklayout file (I
checked in the rescue image before running <code>rear recover</code>)</p>
<pre><code># Disk /dev/vda
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vda 53687091200 msdos
# Partitions on /dev/vda
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vda 413696 1048576 primary boot,prep /dev/vda1
part /dev/vda 1077936128 213909504 primary none /dev/vda2
part /dev/vda 52395245568 1291845632 primary lvm /dev/vda3
# Format for LVM PVs
# lvmdev &lt;volume_group&gt; &lt;device&gt; [&lt;uuid&gt;] [&lt;size(bytes)&gt;]
lvmdev /dev/rootvg /dev/vda3 9cavrA-gSqy-ROyO-7GWa-PXVI-Ker3-cBtZld 102334464
# Format for LVM VGs
# lvmgrp &lt;volume_group&gt; &lt;extentsize&gt; [&lt;size(extents)&gt;] [&lt;size(bytes)&gt;]
lvmgrp /dev/rootvg 4096 12491 51163136
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/mapper/rootvg-lvroot / ext3 uuid=487f413a-b41a-4347-89cd-e4249207ab47 label= blocksize=4096 reserved_blocks=0% max_mounts=27 check_interval=180d bytes_per_inode=13207 options=rw,acl,user_xattr
fs /dev/vda2 /boot ext3 uuid=189efaae-c4e6-4df3-af91-5150b91001f1 label= blocksize=4096 reserved_blocks=0% max_mounts=36 check_interval=180d bytes_per_inode=16380 options=rw,acl,user_xattr
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/mapper/rootvg-lv_swap uuid=89296247-5f68-43c6-884f-862dc506ee26 label=
</code></pre>
<p>Here is the log during <code>rear -D mkrescue</code> :<br />
<a href="https://github.com/rear/rear/files/2025619/rear-rear-sles11-144.log">rear-rear-sles11-144.log</a></p>
<h4 id="rmetrich_commented_at_2018-05-22_0843"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390910944">2018-05-22 08:43</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-22_0843" title="Permanent link">&para;</a></h4>
<p>The issue is on /dev/mapper/rootvg-lvroot which has no <code>lvmvol</code>
description.<br />
This is due to my new code (me--) which seems to not work with your LVM
version (help is being printed):</p>
<pre><code> 2845 ++ lvm lvs --separator=: --noheadings --units b --nosuffix -o origin,lv_name,vg_name,lv_size,lv_layout,pool_lv,chunk_size,stripes,stripe_size
 2846   Logical Volume Fields
 2847   ---------------------
 2848     lv_all               - All fields in this section.
 2849     lv_uuid              - Unique identifier.
...
 2957   Unrecognised field: lv_layout
</code></pre>
<p>What is your LVM version?</p>
<h4 id="schabrolles_commented_at_2018-05-22_0919"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390922201">2018-05-22 09:19</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-22_0919" title="Permanent link">&para;</a></h4>
<p>@rmetrich</p>
<p>LVM version from sles11sp4</p>
<pre><code>lvm&gt; version
  LVM version:     2.02.98(2) (2012-10-15)
  Library version: 1.03.01 (2011-10-15)
  Driver version:  4.25.0
</code></pre>
<h4 id="rmetrich_commented_at_2018-05-22_0952"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390932438">2018-05-22 09:52</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-22_0952" title="Permanent link">&para;</a></h4>
<p>OK, can reproduce on RHEL6.4 which has similar version.</p>
<h4 id="rmetrich_commented_at_2018-05-22_1256"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-390979536">2018-05-22 12:56</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-22_1256" title="Permanent link">&para;</a></h4>
<p>@schabrolles That should make it now. I had to add quite a lot of code
for older LVM versions.</p>
<h4 id="schabrolles_commented_at_2018-05-22_1650"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-391062438">2018-05-22 16:50</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-22_1650" title="Permanent link">&para;</a></h4>
<p>@rmetrich this is working now ... I'm planning to test it tonight on all
the Linux distribution I got.<br />
(rhel6 rhel7 ubuntu sles11 sles12) and test migration tomorrow morning.</p>
<h4 id="rmetrich_commented_at_2018-05-23_1203"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-391321925">2018-05-23 12:03</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-23_1203" title="Permanent link">&para;</a></h4>
<p>Tested (RHEL7 + RHEL6) and pushed. Would you prefer squashed commits?</p>
<h4 id="jsmeix_commented_at_2018-05-23_1300"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-391337627">2018-05-23 13:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-23_1300" title="Permanent link">&para;</a></h4>
<p>I prefer the default behaviour with non-squashed commits<br />
(i.e. keep the individual commits in a pull request as they happened<br />
to keep the history of how something was implemented)<br />
because the final merge commit that merges a whole pull request<br />
into the ReaR upstream master code is such a squashed commit.</p>
<p>For example see in<br />
<a href="https://github.com/rear/rear/pull/1805">https://github.com/rear/rear/pull/1805</a><br />
the individual commits "inside" the pull request<br />
<a href="https://github.com/rear/rear/pull/1805/commits/65d0fc32e0814545e1fa28c44586e7400a5859e9">https://github.com/rear/rear/pull/1805/commits/65d0fc32e0814545e1fa28c44586e7400a5859e9</a><br />
<a href="https://github.com/rear/rear/pull/1805/commits/bc1fa9878dab19ed4c5a0392d98c873c1f7845a7">https://github.com/rear/rear/pull/1805/commits/bc1fa9878dab19ed4c5a0392d98c873c1f7845a7</a><br />
<a href="https://github.com/rear/rear/pull/1805/commits/0ebeeac6d71cf3dba4e7e0085e56e066cf5f9db2">https://github.com/rear/rear/pull/1805/commits/0ebeeac6d71cf3dba4e7e0085e56e066cf5f9db2</a><br />
versus the final merge commit<br />
<a href="https://github.com/rear/rear/commit/51d5f949fdd17a0fb205d865f9a4d5704a6650fe">https://github.com/rear/rear/commit/51d5f949fdd17a0fb205d865f9a4d5704a6650fe</a><br />
which result in the ReaR upstream master branch<br />
the following git log entries</p>
<pre>
|
* s.chabrolles@fr.ibm.com 51d5f949fdd17a0fb205d865f9a4d5704a6650fe Fri May 18 09:24:23 2018 +0200
|\ Merge pull request #1805 from schabrolles/get_only_partition_from_holders :
| | Verify if dm-X is a partition before adding to sysfs_paths
| |
| * s.chabrolles@fr.ibm.com 0ebeeac6d71cf3dba4e7e0085e56e066cf5f9db2 Tue May 15 07:23:51 2018 +0200
| | Update comment :
| |
| * s.chabrolles@fr.ibm.com bc1fa9878dab19ed4c5a0392d98c873c1f7845a7 Mon May 14 22:04:42 2018 +0200
| | add comments :
| |
| * s.chabrolles@fr.ibm.com 65d0fc32e0814545e1fa28c44586e7400a5859e9 Mon May 14 19:04:47 2018 +0200
|/ Verify if dm-X is a partition before adding to sysfs_paths :
|
</pre>

<h4 id="rmetrich_commented_at_2018-05-23_1318"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-391343174">2018-05-23 13:18</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-23_1318" title="Permanent link">&para;</a></h4>
<p>Alright, not touching anything then. I also prefer having the history.</p>
<h4 id="rmetrich_commented_at_2018-05-28_0904"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-392467242">2018-05-28 09:04</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-05-28_0904" title="Permanent link">&para;</a></h4>
<p>Thanks to all of you for accepting this.</p>
<h4 id="razorfish-sl_commented_at_2018-06-03_0451"><img src="https://avatars.githubusercontent.com/u/4497476?v=4" width="50"><a href="https://github.com/razorfish-sl">razorfish-sl</a> commented at <a href="https://github.com/rear/rear/pull/1806#issuecomment-394135358">2018-06-03 04:51</a>:<a class="headerlink" href="#razorfish-sl_commented_at_2018-06-03_0451" title="Permanent link">&para;</a></h4>
<p>I noticed that REAR was not backing up physical device thin pools,
today...<br />
Not lost anything, just noticed on recovery the old data was still in
the thinpool</p>
<p>However.....<br />
Just thinking of a case recently.(this week)</p>
<p>I had a "thinpool" that was mapped to a BLOCK FILE ,then remounted on
loop, and REAR obviously dealt with it correctly because it was a
physical file on /dev/sda ,in the directory tree.<br />
REAR is capable of this case since it sees a file in a directory, the
config for LVM is something separate.</p>
<p>So possibly we may need to be careful, since in this case LVM "sees" a
thin pool, but actually it is a "lie." it's actually a raw image mounted
as loop.</p>
<p>We may get into a situation where "REAR" backs it up correctly, as a
general file , BUT then backs it up AGAIN as an LVM thin pool, in this
situation how would it re-create the physical device<br />
or not get confused it is actually a file mounted as a "block device"?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-05-15.1806.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
