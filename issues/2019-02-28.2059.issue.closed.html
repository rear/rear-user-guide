<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2059 Issue closed: BUG: The disk layout recreation script failed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2059 Issue closed: BUG: The disk layout recreation script failed";
        var mkdocs_page_input_path = "issues/2019-02-28.2059.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2059 Issue closed: BUG: The disk layout recreation script failed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2059_issue_closed_bug_the_disk_layout_recreation_script_failed"><a href="https://github.com/rear/rear/issues/2059">#2059 Issue</a> <code>closed</code>: BUG: The disk layout recreation script failed<a class="headerlink" href="#2059_issue_closed_bug_the_disk_layout_recreation_script_failed" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>support / question</code>, <code>no-issue-activity</code></p>
<h4 id="dcz01_opened_issue_at_2019-02-28_1559"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> opened issue at <a href="https://github.com/rear/rear/issues/2059">2019-02-28 15:59</a>:<a class="headerlink" href="#dcz01_opened_issue_at_2019-02-28_1559" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):</li>
</ul>
<!-- -->

<pre><code>Relax-and-Recover 2.4 / 2018-06-21
</code></pre>
<ul>
<li>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):</li>
</ul>
<!-- -->

<pre><code>OS_VENDOR=RedHatEnterpriseServer
OS_VERSION=6.10
# The following information was added automatically by the mkrescue workflow:
ARCH='Linux-i386'
OS='GNU/Linux'
OS_VERSION='6.10'
OS_VENDOR='RedHatEnterpriseServer'
OS_VENDOR_VERSION='RedHatEnterpriseServer/6.10'
OS_VENDOR_ARCH='RedHatEnterpriseServer/i386'
# End of what was added automatically by the mkrescue workflow.
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=file:///root/rear
BACKUP=NETFS
#BACKUP=TSM
BACKUP_PROG=tar
BACKUP_PROG_CRYPT_ENABLED=1
BACKUP_PROG_CRYPT_KEY=""
BACKUP_PROG_CRYPT_OPTIONS="/usr/bin/openssl aes256 -salt -k"
BACKUP_PROG_DECRYPT_OPTIONS="/usr/bin/openssl aes256 -d -k"
#BACKUP_URL=nfs://&lt;IP-Adresse oder DNS-Name&gt;/&lt;Freigabepfad&gt;
BACKUP_URL=cifs://NotesRechte/BRP-Backup
BACKUP_OPTIONS="cred=/etc/rear/cifs,sec=ntlmsspi"
BACKUP_TYPE=incremental
FULLBACKUPDAY="Sat"
BACKUP_PROG_EXCLUDE=( '/tmp/*' '/dev/shm/*' $VAR_DIR/output/\* '/opt/tivoli/tsm/rear/*' '/mnt/*' '/media/*' '/var/lib/pgsql/*/data/base/*' '/var/lib/pgsql/*/data/global/*' '/var/lib/pgsql/*/data/pg*/*' )
SSH_ROOT_PASSWORD='$1$HGjk3XUV$lid3Nd3k01Kht1mpMscLw1'
NON_FATAL_BINARIES_WITH_MISSING_LIBRARY='/opt/tivoli/tsm/client/ba/bin/libvixMntapi.so.1.1.0'
</code></pre>
<ul>
<li>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
<code>Test virtual machine on VMware</code></li>
<li>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
<code>x86_64</code></li>
<li>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
<code>BIOS and GRUB</code></li>
<li>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
<code>Lokal Disk (one disk)</code></li>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
<code>Problem in the recovery environment with recreating the disk layout. I found and invalid parameter (--force) in the log file.</code></li>
<li>Workaround, if any:<br />
<code>none</code></li>
<li>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
<a href="https://github.com/rear/rear/files/2915792/rear-FBD01PSS.log">rear-FBD01PSS.log</a></li>
</ul>
<h4 id="dcz01_commented_at_2019-02-28_1603"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468329333">2019-02-28 16:03</a>:<a class="headerlink" href="#dcz01_commented_at_2019-02-28_1603" title="Permanent link">&para;</a></h4>
<p>I checked the same process with the <code>BACKUP=TSM</code> and there was no
problem.<br />
I've tested the case that an client of us could use an newer hardware
with an bigger hard drive or RAID system.</p>
<h4 id="jsmeix_commented_at_2019-02-28_1827"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468383124">2019-02-28 18:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-28_1827" title="Permanent link">&para;</a></h4>
<p>As far as I see on first glance in your<br />
<a href="https://github.com/rear/rear/files/2915792/rear-FBD01PSS.log">https://github.com/rear/rear/files/2915792/rear-FBD01PSS.log</a><br />
it is neither the <code>wipefs --force</code> nor any other command in</p>
<pre><code>cleanup_command='wipefs --all --force /dev/sda3 || wipefs --all /dev/sda3 || dd if=/dev/zero of=/dev/sda3 bs=512 count=1 || true'
</code></pre>
<p>that makes it fail because of the <code>|| true</code> at the end.</p>
<p>Where diskrestore.sh actually fails is at</p>
<pre><code>+++ mkfs -t ext4 -b 4096 -i 16346 -F /dev/sda3
mke2fs 1.41.12 (17-May-2010)
mkfs.ext4: No such device or address while trying to determine filesystem size
++ ((  1 == 0  ))
++ true
+++ UserInput -I LAYOUT_CODE_RUN -p 'The disk layout recreation script failed' -D 'Rerun disk recreation script (/var/lib/rear/layout/diskrestore.sh)' ...
</code></pre>
<p>That needs to be investigated why that fails.<br />
It seems something with your /dev/sda3 is not right...</p>
<h4 id="dcz01_commented_at_2019-03-01_0805"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468579147">2019-03-01 08:05</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-01_0805" title="Permanent link">&para;</a></h4>
<p>@jsmeix Yes, there is something with the /dev/sda3.<br />
The recreation script must expand the volume/partition a little bit,
because the new disk is bigger than before like i mentioned above.</p>
<h4 id="jsmeix_commented_at_2019-03-01_0914"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468597405">2019-03-01 09:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-01_0914" title="Permanent link">&para;</a></h4>
<p>It does increase the last partition /dev/sda3<br />
as it should according to what there is in your<br />
<a href="https://github.com/rear/rear/files/2915792/rear-FBD01PSS.log">https://github.com/rear/rear/files/2915792/rear-FBD01PSS.log</a></p>
<pre><code>Including layout/prepare/default/420_autoresize_last_partitions.sh
Examining /dev/sda to automatically resize its last active partition
Checking /dev/sda1 if it is the last partition on /dev/sda
Checking /dev/sda2 if it is the last partition on /dev/sda
Checking /dev/sda3 if it is the last partition on /dev/sda
Found 'primary' partition /dev/sda3 as last partition on /dev/sda
Determining if last partition /dev/sda3 is resizeable
Determining new size for last partition /dev/sda3
Determining if last partition /dev/sda3 actually needs to be increased or shrinked
New /dev/sda is 53687091200 bigger than old disk
Increasing last partition /dev/sda3 up to end of disk (new disk at least 10% bigger)
Changed last partition /dev/sda3 size from 156308078592 to 209995169792 bytes
</code></pre>
<p>which results in diskrestore.sh this parted call</p>
<pre><code>+++ parted -s /dev/sda mkpart ''\''primary'\''' 4753195008B 214748364799B
</code></pre>
<p>where <code>214748364799 - ( 4753195008 - 1 ) = 209995169792</code> is as it
should<br />
(4753195008 is the first byte of that partition and 214748364799 is the
last one<br />
so both belong "inside" the partition).</p>
<p>This are all parted calls while diskrestore.sh is run</p>
<pre><code>+++ parted -s /dev/sda mklabel msdos
...
+++ parted -s /dev/sda mkpart ''\''primary'\''' 1048576B 525336575B
...
+++ parted -s /dev/sda set 1 boot on
...
+++ parted -s /dev/sda mkpart ''\''primary'\''' 525336576B 4753195007B
...
+++ parted -s /dev/sda mkpart ''\''primary'\''' 4753195008B 214748364799B
...
+++ partprobe -s /dev/sda
/dev/sda: msdos partitions 1 2 3
</code></pre>
<p>and all run without an error so that afterwards there should be
/dev/sda<br />
with the partition device nodes /dev/sda1 /dev/sda2 /dev/sda3<br />
but somehow something is wrong with /dev/sda3 because then</p>
<pre><code>+++ Log 'Creating filesystem of type ext4 with mount point / on /dev/sda3.'
...
+++ wipefs --all /dev/sda3
wipefs: error: /dev/sda3: probing initialization failed
+++ dd if=/dev/zero of=/dev/sda3 bs=512 count=1
dd: opening `/dev/sda3': No such device or address
...
+++ mkfs -t ext4 -b 4096 -i 16346 -U fd2aaed0-d3c1-4bf4-99cb-e12f3da6a5c4 -F /dev/sda3
mke2fs 1.41.12 (17-May-2010)
mkfs.ext4: No such device or address while trying to determine filesystem size
+++ mkfs -t ext4 -b 4096 -i 16346 -F /dev/sda3
mke2fs 1.41.12 (17-May-2010)
mkfs.ext4: No such device or address while trying to determine filesystem size
</code></pre>
<p>so it seems in contrast to what partprobe had reported before</p>
<pre><code>+++ partprobe -s /dev/sda
/dev/sda: msdos partitions 1 2 3
</code></pre>
<p>there is no partition device node /dev/sda3 on your particular system.</p>
<p>From my current point of view this issue looks like just one more
instance<br />
of the various annoyances with asynchroneously created device nodes<br />
where one cannot know when a device node will actually appear<br />
and - even worse - when an existing device node stays there stable.</p>
<p>See<br />
<a href="https://github.com/rear/rear/issues/791">https://github.com/rear/rear/issues/791</a><br />
and follow the links therein.</p>
<p>Some blind shot in the dark what might help:</p>
<p>In general when device nodes that are expected to appear are late<br />
it helps to sit and wait until the system (hardware kernel udev
whatever...)<br />
has settled its various activity so that at the</p>
<pre><code>Confirm or edit the disk recreation script
1) Confirm disk recreation script and continue 'rear recover'
2) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
3) View disk recreation script (/var/lib/rear/layout/diskrestore.sh)
4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
5) Use Relax-and-Recover shell and return back to here
6) Abort 'rear recover'
</code></pre>
<p>user dialog you should chose</p>
<pre><code>2) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
</code></pre>
<p>and insert a simple <code>sleep 10</code> command before the commands<br />
that create the filesystems or even better add some<br />
"wait for the actually needed thing" code like</p>
<pre><code>for countdown in $( seq 60 -1 0 ) ; do
    test -b /dev/sda3 &amp;&amp; break
    LogPrint "waiting for /dev/sda3 ($countdown)"
    sleep 1
done
</code></pre>
<p>cf.<br />
<a href="https://github.com/rear/rear/issues/791#issue-138931029">https://github.com/rear/rear/issues/791#issue-138931029</a></p>
<h4 id="dcz01_commented_at_2019-03-01_0938"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468604412">2019-03-01 09:38</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-01_0938" title="Permanent link">&para;</a></h4>
<p>@jsmeix Ok, the same error occours with TSM...<br />
Here is the same error in log:<br />
<a href="https://github.com/rear/rear/files/2918770/rear-FBD01PSS.log">rear-FBD01PSS.log</a><br />
But with the <code>rear -D recover</code> executed a second time it worked...<br />
<a href="https://github.com/rear/rear/files/2918845/rear-FBD01PSS.log">rear-FBD01PSS.log</a></p>
<h4 id="jsmeix_commented_at_2019-03-01_1410"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468676817">2019-03-01 14:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-01_1410" title="Permanent link">&para;</a></h4>
<p>With probability one when</p>
<pre><code>with the 'rear -D recover' executed a second time it worked
</code></pre>
<p>the root cause are those kind of timing issues that I described in<br />
<a href="https://github.com/rear/rear/issues/2059#issuecomment-468597405">https://github.com/rear/rear/issues/2059#issuecomment-468597405</a></p>
<p>I.e. try to make the diskrestore.sh script wait a bit before it
creates<br />
the filesystems so that the needed device nodes will be there.</p>
<h4 id="dcz01_commented_at_2019-03-01_1525"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-468702100">2019-03-01 15:25</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-01_1525" title="Permanent link">&para;</a></h4>
<p>@jsmeix That would be great if it possible.<br />
Thanks very much :-)<br />
Have a nice weekend (A schens Wochenend wünsch i da).</p>
<h4 id="jsmeix_commented_at_2019-03-04_1115"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469215626">2019-03-04 11:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-04_1115" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
I think you misunderstood me - I meant that you change things in your
ReaR<br />
as you need it for your use case - at least as a workaround - because<br />
currently I don't know how to correctly wait for the real thing, cf.<br />
<a href="https://github.com/rear/rear/issues/791">https://github.com/rear/rear/issues/791</a></p>
<p>I think in your particular case where <code>wipefs --force</code> does not work<br />
you may change in your<br />
usr/share/rear/layout/prepare/GNU/Linux/130_include_filesystem_code.sh<br />
the value of the <code>cleanup_command</code> to something like</p>
<pre><code>cleanup_command="sleep 5 &amp;&amp; wipefs --all $device || dd if=/dev/zero of=$device bs=512 count=1 || true"
</code></pre>
<p>so that it does a dumb wait of 5 seconds to let (hopefully) /dev/sda3
appear<br />
before it tries to clean it up and afterwards makes a filesystem on it.</p>
<h4 id="dcz01_commented_at_2019-03-04_1136"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469221460">2019-03-04 11:36</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-04_1136" title="Permanent link">&para;</a></h4>
<p>@jsmeix Ah well ok, now i understand you. But for an future release it
would be great to insert this change for all ReaR users by default or?</p>
<h4 id="jsmeix_commented_at_2019-03-04_1158"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469227186">2019-03-04 11:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-04_1158" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
this totally depends on how enthusiastic your feedback is<br />
if it really works for you this way... ;-)</p>
<p>If it works with <code>sleep 5</code> please test if it also reliably works with
<code>sleep 1</code><br />
because I would much prefer to not sleep too much because<br />
on systems with many filesystems it would sleep hardcoded<br />
that amount of time for each one of the filesystems, cf.<br />
<a href="https://github.com/rear/rear/issues/791#issuecomment-224231100">https://github.com/rear/rear/issues/791#issuecomment-224231100</a></p>
<h4 id="dcz01_commented_at_2019-03-04_1450"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469279659">2019-03-04 14:50</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-04_1450" title="Permanent link">&para;</a></h4>
<p>@jsmeix When i edit your solution in that file
<code>/usr/share/rear/layout/prepare/GNU/Linux/130_include_filesystem_code.sh</code>
in the rescue system, i also get the same error with <code>sleep 5</code> or
<code>sleep 1</code>.<br />
Or am i editing the wrong file in rescue mode?</p>
<h4 id="jsmeix_commented_at_2019-03-05_0948"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469613633">2019-03-05 09:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-05_0948" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
provided it really sleeps it is disappointing that this does not help.<br />
I was sure it would help to wait and then /dev/sda3 would finally
appear.</p>
<p>Did you try to verify that sleeping won't help at all in your case<br />
by let it sleep very long, e.g. <code>sleep 60</code> or even <code>sleep 300</code>?</p>
<p>If waiting would not help at all here, this case could become<br />
just another frustrating example how unpredictable and hopeless<br />
things have become since device nodes appear and disappear<br />
asynchronously and dynamically so that in practice it behaves randomly.</p>
<p>Check your ReaR log file in debug mode (i.e. <code>rear -D recover</code>)<br />
to verify that it actually sleeps.</p>
<p>In the running recovery system use
<code>find / | grep include_filesystem_code</code><br />
to find where that script actually is in your particular recovery
system.</p>
<p>Normally it is in <code>/usr/share/rear/...</code> but when you run e.g. our
current ReaR<br />
GitHub master code from within a separated directory as described at<br />
<a href="https://github.com/rear/rear/issues/2019#issuecomment-469219216">https://github.com/rear/rear/issues/2019#issuecomment-469219216</a><br />
then the scripts are in the recovery system at a different place,<br />
e.g. on my test systems where I run the ReaR GitHub master code<br />
this way (and I always use <code>KEEP_BUILD_DIR="yes"</code> cf. default.conf)<br />
I have the scripts (on the original system where I run
<code>rear -D mkrescue</code>):</p>
<pre><code># find /tmp/rear.UK5Jx27aSLvwZ62/rootfs/ | grep include_filesystem_code
/tmp/rear.UK5Jx27aSLvwZ62/rootfs/root/rear.github.master/usr/share/rear/layout/prepare/GNU/Linux/130_include_filesystem_code.sh
</code></pre>
<p>i.e. I would get the scripts in the running recovery system under</p>
<pre><code>/root/rear.github.master/usr/share/rear/...
</code></pre>
<p>and in this case /usr/share/rear would be a symlink<br />
that points to /root/rear.github.master/usr/share/rear<br />
so that in the running recovery system the ReaR scripts<br />
can be always found under /usr/share/rear/...</p>
<p>I verified on my test system that in<br />
.../layout/prepare/GNU/Linux/130_include_filesystem_code.sh</p>
<pre><code>cleanup_command="sleep 15 &amp;&amp; wipefs ...
</code></pre>
<p>actually lets it sleep 15 seconds.</p>
<h4 id="dcz01_commented_at_2019-03-05_1134"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-469647340">2019-03-05 11:34</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-05_1134" title="Permanent link">&para;</a></h4>
<p>@jsmeix Acutally at my system this doesn't work... i don't know why.<br />
Here is the actual log with the tested 300 seconds (also tested with 5,
30 and 60) and a screenshot.<br />
<a href="https://github.com/rear/rear/files/2930725/rear-FBD01PSS.log">rear-FBD01PSS.log</a></p>
<p><img alt="1" src="https://user-images.githubusercontent.com/20817288/53802752-ebebc780-3f42-11e9-8ff1-6f7259da9b69.JPG" /></p>
<h4 id="jsmeix_commented_at_2019-03-06_1604"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-470165666">2019-03-06 16:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-06_1604" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
had no time today so only a short notice how you may proceed<br />
(which means how you could do some debugging legwork):</p>
<p>After you logged in into the recovery system<br />
do manually what the diskrestore.sh script would do<br />
to see how things behave in your case step by step.</p>
<p>Use a recent "rear -D recover" log file to see what<br />
the diskrestore.sh script would do or even better<br />
copy the diskrestore.sh script out of the recovery system,<br />
perferably also attach it here as reference, so that you can<br />
inspect directly what the diskrestore.sh script would do.</p>
<p>Before the first 'parted' command and after each<br />
subsequent command that you do run commands like</p>
<pre><code># parted -s /dev/sda unit MiB print

# ls -l /dev/sda*

# find /dev/disk/by-* -ls | grep '/sda'

# lsblk -i -p -o NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>to see at each step what there actually happens regarding your <code>sda</code><br />
and how that changes for each parted, wipefs, and mkfs call<br />
that you do on your particular system.</p>
<h4 id="dcz01_commented_at_2019-03-07_1131"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-470491730">2019-03-07 11:31</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-07_1131" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Here i got the diskrestore.sh from the rescue system for you.<br />
<a href="https://github.com/rear/rear/files/2941002/diskrestore.zip">diskrestore.zip</a></p>
<h4 id="jsmeix_commented_at_2019-03-07_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-470538716">2019-03-07 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-07_1408" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
according to your
<a href="https://github.com/rear/rear/files/2941002/diskrestore.zip">https://github.com/rear/rear/files/2941002/diskrestore.zip</a><br />
what I mean that you should run manually in a new booted recovery
system<br />
(without having done any "rear recover" attempt before)<br />
is something like</p>
<pre><code># parted -s /dev/sda unit MiB print
# ls -l /dev/sda*

# parted -s /dev/sda mklabel msdos
# parted -s /dev/sda unit MiB print
# ls -l /dev/sda*

# parted -s /dev/sda mkpart primary 1048576B 525336575B
# parted -s /dev/sda unit MiB print
# ls -l /dev/sda*

# parted -s /dev/sda set 1 boot on
# parted -s /dev/sda unit MiB print

# parted -s /dev/sda mkpart primary 525336576B 4753195007B
# parted -s /dev/sda unit MiB print
# ls -l /dev/sda*

# parted -s /dev/sda mkpart primary 4753195008B 214748364799B
# parted -s /dev/sda unit MiB print
# ls -l /dev/sda*

# mkfs -t ext4 -b 4096 -i 16346 -U fd2aaed0-d3c1-4bf4-99cb-e12f3da6a5c4 -F /dev/sda3
# tune2fs  -m 3 -c -1 -i 0d -o user_xattr,acl /dev/sda3
# lsblk -i -p -o NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT

# mkdir -p /mnt/local/
# mount -o rw /dev/sda3 /mnt/local/
# lsblk -i -p -o NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>and see how far you can get with that...</p>
<p>If the disk is not new, i.e. if there is already some old stuff on it,
see<br />
<a href="https://github.com/rear/rear/issues/799">https://github.com/rear/rear/issues/799</a><br />
how to use <code>wipefs</code> in the recovery system directly after login as
root<br />
to first and foremost clean up the used dik before anything else is
done<br />
with that disk (i.e. before one runs <code>parted</code> and things like that).</p>
<h4 id="dcz01_commented_at_2019-03-08_1013"><img src="https://avatars.githubusercontent.com/u/20817288?v=4" width="50"><a href="https://github.com/dcz01">dcz01</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-470876668">2019-03-08 10:13</a>:<a class="headerlink" href="#dcz01_commented_at_2019-03-08_1013" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I also got some information that a program wasn't found...</p>
<p><img alt="1" src="https://user-images.githubusercontent.com/20817288/54022585-1c29a500-4193-11e9-847a-cebcaf2dba19.JPG" /><br />
<img alt="2" src="https://user-images.githubusercontent.com/20817288/54022586-1c29a500-4193-11e9-8424-7e5d8d429a2a.JPG" /></p>
<h4 id="jsmeix_commented_at_2019-03-11_1442"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-471566987">2019-03-11 14:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-11_1442" title="Permanent link">&para;</a></h4>
<p>@dcz01<br />
so we have a "heisenbug" here,<br />
cf.
<a href="https://en.wikipedia.org/wiki/Heisenbug">https://en.wikipedia.org/wiki/Heisenbug</a><br />
because it seems all "just work" (there is not any error message)<br />
when you do the actual setup commands manually.</p>
<p>Currently I have no idea how to find out why things fail when<br />
those setup commands are called by the diskrestore.sh script.</p>
<p>Don't worry that you don't have <code>lsblk</code> in your recovery system.<br />
It is not needed to set up something.<br />
It would only show the results in a nice way.<br />
You can add it to your recovery system via</p>
<pre><code>PROGS=( "${PROGS[@]}" lsblk )
</code></pre>
<p>Since<br />
<a href="https://github.com/rear/rear/commit/b4fd97fd47d8c15ca1383dd911ec018780dce77b">https://github.com/rear/rear/commit/b4fd97fd47d8c15ca1383dd911ec018780dce77b</a><br />
(which had happened after the ReaR 2.4 release in June 2018))<br />
<code>lsblk</code> is included in the recovery system by default.</p>
<h4 id="jsmeix_commented_at_2019-03-11_1448"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-471569711">2019-03-11 14:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-11_1448" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
could you have a look here - perhaps you have an idea what goes wrong
here.</p>
<p>It is RHEL 6.10 where basically things fail when the partition and<br />
filesystem setup commands are called by the diskrestore.sh script<br />
but things work when the same commands are called manually<br />
in the recovery system.</p>
<p>Perhaps - only a blind guess - the additional <code>my_udevtrigger</code> and<br />
<code>my_udevsettle</code> calls (cf. usr/share/rear/lib/linux-functions.sh)<br />
in diskrestore.sh do more harm than good in this particular case?</p>
<h4 id="github-actions_commented_at_2020-06-28_0133"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2059#issuecomment-650665264">2020-06-28 01:33</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-28_0133" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-02-28.2059.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
