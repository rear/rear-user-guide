<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2988 PR merged: Implement non-interactive mode - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2988 PR merged: Implement non-interactive mode";
        var mkdocs_page_input_path = "issues/2023-05-14.2988.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2988 PR merged: Implement non-interactive mode</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2988_pr_merged_implement_non-interactive_mode"><a href="https://github.com/rear/rear/pull/2988">#2988 PR</a> <code>merged</code>: Implement non-interactive mode<a class="headerlink" href="#2988_pr_merged_implement_non-interactive_mode" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>sponsored</code></p>
<h4 id="schlomo_opened_issue_at_2023-05-14_1524"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/pull/2988">2023-05-14 15:24</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-05-14_1524" title="Permanent link">&para;</a></h4>
<p>supersedes #2979 and should solve everything discussed there. Code is
based on the work by @codefritzel and adapted by me.</p>
<p>My considerations and decisions:</p>
<ul>
<li>the non-interactive mode is marked <em>experimental</em> because it only
    changes the way how <code>UserInput</code> works and there might be some
    scenarios where it won't work as advertised. I don't want to put a
    lengthy explanation about the technical details in the help text,
    hence <em>experimental</em> to indicate the current status.</li>
<li>Without <code>--non-interactive</code> nothing should have changed (but I fixed
    a few places that seemed like they could cause problems)</li>
<li>With <code>--non-interactive</code> the <code>UserInput</code> timeouts are hard coded to
    3 seconds (short, but not too short) and every <code>UserInput -I FOO</code>
    call can happen only once. If it happens again then it will <code>Error</code>
    out.</li>
<li>I treat an automated response by <code>USER_INPUT_FOO</code> the same as using
    the default response given via <code>-D</code></li>
<li>I'd like to keep it this simple till further testing reveals
    scenarios where multiple calls to the same <code>UserInput -I FOO</code> would
    be successful, and then I'll adjust the code accordingly (no
    premature optimisation).</li>
</ul>
<p>Finally, I'd like to merge this rather soon so please look for reasons
why this is a really bad idea and leave further improvements to future
iterations.</p>
<p>@rear/contributors please have a look.</p>
<p>PS: The <code>UserInput</code> function is really hard to understand and to test
(via <code>rear shell</code>) because it does <em>so much</em>, if somebody wants to
contribute a unit test then this would be my starting point.</p>
<h4 id="jsmeix_commented_at_2023-05-15_0627"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1547258968">2023-05-15 06:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-15_0627" title="Permanent link">&para;</a></h4>
<p>I am wondering if there a reason why it is called 'non-interactive'<br />
and not 'unattended' which is a term that we already use in ReaR?</p>
<p>Perhaps it is good to use 'non-interactive'<br />
for the usr/sbin/rear command line option<br />
to distinguish it from the already existing<br />
recovery system kernel command line option<br />
'auto_recover/automatic' and 'unattended'<br />
because each one implements a differnt thing so the three<br />
'non-interactive' 'auto_recover/automatic' and 'unattended'<br />
look same but actually they are only similar<br />
and belong to different parts of the same goal?</p>
<p>@schlomo<br />
PS: The UserInput function was really hard to implement<br />
to get it into a state that provides what was needed<br />
at that time when the UserInput was implemented.<br />
Feel free to overhaul it and replace it with something better.<br />
I already overhauled much old code without useful comments<br />
that I could not understand with reasonable effort so<br />
meanwhile I got rather tired to endlessly clean up old code.</p>
<h4 id="pcahyna_commented_at_2023-05-16_1119"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1549471637">2023-05-16 11:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-16_1119" title="Permanent link">&para;</a></h4>
<blockquote>
<pre><code>* I'd like to keep it this simple till further testing reveals scenarios where multiple calls to the same `UserInput -I FOO` would be successful, and then I'll adjust the code accordingly (no premature optimisation).
</code></pre>
</blockquote>
<p>This could in principle happen with loops that are not infinite loops
but iterate over some restricted set of items. I suspected that the
layout code might have instances of this, as it may be necessary to
enter input multiple times at the same code spot for multiple disks or
other storage objects. But I have found this code that maps multiple
disks interactively:</p>
<p><a href="https://github.com/rear/rear/blob/3333cf8050cb347a8390192391a149bc0def3b77/usr/share/rear/layout/prepare/default/300_map_disks.sh#LL286C3-L292C2">https://github.com/rear/rear/blob/3333cf8050cb347a8390192391a149bc0def3b77/usr/share/rear/layout/prepare/default/300_map_disks.sh#LL286C3-L292C2</a></p>
<p>which already takes care of it. So, I believe this is either taken care
of and if not, code that does not do it could be adapted in a similar
way (generating unique identifiers for every iteration).</p>
<h4 id="jsmeix_commented_at_2023-05-16_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1549529195">2023-05-16 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-16_1201" title="Permanent link">&para;</a></h4>
<p>The following is only for the non-interactive mode:</p>
<p>The crucial thing is to abort only if there was no active user input<br />
which means to abort only if the 'read' timeout happened.<br />
The UserInput function returns 1 only if 'read' timed out<br />
(provided there is no syntax error or some lower level error).</p>
<p>Because the current user_input_ID gets only added<br />
to USER_INPUT_SEEN_WITH_TIMEOUT when return_code=1 is set<br />
the current code seems to implement that<br />
(as far as I see from plain looking at the code).</p>
<h4 id="jsmeix_commented_at_2023-05-16_1227"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1549567178">2023-05-16 12:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-16_1227" title="Permanent link">&para;</a></h4>
<p>Regardless of the needed condition in<br />
<a href="https://github.com/rear/rear/pull/2988#issuecomment-1549529195">https://github.com/rear/rear/pull/2988#issuecomment-1549529195</a><br />
I think this condition is not sufficient to make things work<br />
in general in non-interactive mode.</p>
<p>I think (as far as I see from plain looking at the code)<br />
the current implementation aborts at a second UserInput<br />
with a user_input_ID that had timed out before.</p>
<p>But in non-interactive mode it is the usual case<br />
that UserInput times out and the default input is used<br />
when the user has not specified a predefined input.</p>
<p>As far as I remember in most cases the default input<br />
is to let ReaR continue so that the normal behaviour is<br />
that ReaR continues when the user does nothing<br />
regardless of normal/interactive or non-interactive mode.</p>
<p>I implemented the various UserInput calls this way<br />
as far as possible to get intentionally a default behaviour<br />
of "automated proceeding" - unless the user must make a decision.</p>
<p>So in normal mode the following code would<br />
automatically proceed after each timeout</p>
<pre><code>...
UserInput -I WAIT_UNTIL_TIMEOUT -p 'Press [Enter] to continue'
...
UserInput -I WAIT_UNTIL_TIMEOUT -p 'Press [Enter] to continue'
...
</code></pre>
<p>In contrast in non-interactive mode it would abort at<br />
the second 'UserInput -I WAIT_UNTIL_TIMEOUT' call.</p>
<p>I think (as far as I understand it) the current implementation<br />
enforces that a user_input_ID must never be used a second time.</p>
<p>I think this is what @pcahyna meant with<br />
"iterate over some restricted set of items"<br />
in his<br />
<a href="https://github.com/rear/rear/pull/2988#issuecomment-1549471637">https://github.com/rear/rear/pull/2988#issuecomment-1549471637</a></p>
<h4 id="pcahyna_commented_at_2023-05-17_0856"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1551012259">2023-05-17 08:56</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-17_0856" title="Permanent link">&para;</a></h4>
<p>@jsmeix what I meant by "iterate over some restricted set of items" was
code like this:</p>
<pre><code>for d in "${disks[@]}"; do
  UserInput -I CONFIRM_DISK -p "confirm the use of disk ${d}"
  ...
done
</code></pre>
<p>This can be fixed by generating a unique ID for each disk that is to be
confirmed. My point was that the code that iterates this way when
mapping disks is already using this idiom and is thus safe.<br />
What is still problematic is code like you have shown:</p>
<pre><code>UserInput -I WAIT_UNTIL_TIMEOUT -p 'Press [Enter] to continue'
DoStuff
UserInput -I WAIT_UNTIL_TIMEOUT -p 'Press [Enter] to continue'
DoOtherStuff
</code></pre>
<p>This, too, can be fixed by changing the IDs to be unique, like</p>
<pre><code>UserInput -I CONFIRM_STUFF -p 'Press [Enter] to continue'
DoStuff
UserInput -I CONFIRM_OTHER_STUFF -p 'Press [Enter] to continue'
DoOtherStuff
</code></pre>
<p>I don't know whether there actually is code like this (that reuses the
same input ID in several places).</p>
<h4 id="schlomo_commented_at_2023-05-17_0904"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1551024112">2023-05-17 09:04</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-17_0904" title="Permanent link">&para;</a></h4>
<p>@pcahyna @jsmeix your concerns are valid and I planned to go through our
codebase to look at such cases with the goal of defusing potential
problems, as you suggested.</p>
<h4 id="schlomo_commented_at_2023-05-29_1211"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1567061655">2023-05-29 12:11</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-29_1211" title="Permanent link">&para;</a></h4>
<p>I'm going over all uses of <code>UserInput</code> to fix them up. Except for the
ones mentioned below, all the User Input calls have a default or won't
run into a perpetual loop.</p>
<p>The following cases are not clear to me and I left them be as they are
now:</p>
<ul>
<li>
<p><a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/global-functions.sh#L553-L555">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/global-functions.sh#L553-L555</a><br />
    This could theoretically be called multiple times, but I'm not sure
    if this can be called multiple times for ISO</p>
</li>
<li>
<p><a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/opal-functions.sh#L333-L337">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/opal-functions.sh#L333-L337</a><br />
<a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/opal-functions.sh#L372-L375">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/lib/opal-functions.sh#L372-L375</a><br />
    Those are used for OPAL and set the timeout to <code>0</code>, so I assume that
    nobody needs this non-interactive right now.</p>
</li>
<li>
<p><a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/restore/NBKDC/default/400_restore_backup.sh#L101-L107">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/restore/NBKDC/default/400_restore_backup.sh#L101-L107</a><br />
    Manual wait for restore to happen, timeout set to <code>0</code> so that we
    can't support non-interactive here either</p>
</li>
<li>
<p><a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/verify/CDM/default/410_use_replica_cdm_cluster_cert.sh#L15">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/verify/CDM/default/410_use_replica_cdm_cluster_cert.sh#L15</a><br />
<a href="https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/verify/CDM/default/410_use_replica_cdm_cluster_cert.sh#L56">https://github.com/rear/rear/blob/2aaa1967710314c7bc12ccacac67dcf76b10b95a/usr/share/rear/verify/CDM/default/410_use_replica_cdm_cluster_cert.sh#L56</a><br />
    Manual wait with timeout <code>0</code>, I guess that we don't support
    non-interactive for this</p>
</li>
</ul>
<h4 id="schlomo_commented_at_2023-05-29_1619"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1567322832">2023-05-29 16:19</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-29_1619" title="Permanent link">&para;</a></h4>
<p>@rear/contributors please have a look, I'd like to merge this also
during this week</p>
<h4 id="jsmeix_commented_at_2023-05-30_1053"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1568220345">2023-05-30 10:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-30_1053" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/2988#issuecomment-1567061655">https://github.com/rear/rear/pull/2988#issuecomment-1567061655</a><br />
therein the UserInput for the '(iso)' case<br />
in the mount_url() function in lib/global-functions.sh</p>
<p>When a UserInput is needed here things are already in a<br />
rather exceptional (a.k.a. erroneous) state:<br />
A device node where the ISO is attached to is needed<br />
but ReaR could not determine such a device node<br />
so ReaR must ask the user.</p>
<p>In non-interactive mode ReaR may directly abort here<br />
but I think it is better to let ReaR continue<br />
with the default value (i.e. try with '/dev/cdrom')<br />
and when this is not right things will fail later with</p>
<pre><code>ERROR: Mount command '...' failed.
</code></pre>
<p>I.e. things should behave sufficiently OK as is.</p>
<h4 id="schlomo_commented_at_2023-05-30_1058"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1568226240">2023-05-30 10:58</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-30_1058" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Regarding <a href="https://github.com/rear/rear/pull/2988#issuecomment-1567061655">#2988
(comment)</a>
therein the UserInput for the '(iso)' case in the mount_url()
function in lib/global-functions.sh</p>
<p>When a UserInput is needed here things are already in a rather
exceptional (a.k.a. erroneous) state: A device node where the ISO is
is needed but ReaR could not determine such a device node so ReaR must
ask the user.</p>
<p>In non-interactive mode ReaR may directly abort here but I think it is
better to let ReaR continue with the default value (i.e. try with
'/dev/cdrom') and when this is not right things will fail later.</p>
<p>I.e. things should behave sufficiently OK as is.</p>
</blockquote>
<p>When I was reading that code I asked myself: How could we ever truly
test this???</p>
<h4 id="jsmeix_commented_at_2023-05-30_1102"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1568231445">2023-05-30 11:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-30_1102" title="Permanent link">&para;</a></h4>
<p>Usually while I am implementing such kind of code<br />
I set up some artificial stuff to simulate<br />
how things behave in the erroneous cases<br />
but of course I cannot test an actual<br />
erroneous case on real hardware<br />
with reasonable effort.</p>
<h4 id="jsmeix_commented_at_2023-05-30_1108"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1568239083">2023-05-30 11:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-30_1108" title="Permanent link">&para;</a></h4>
<p>In the end for code like</p>
<pre><code>if ! NORMAL_CASE ; then
   Log "problematic case"
   try something
fi
do something || Error "..."
</code></pre>
<p>it does not matter if "try something" works perfectly well.</p>
<h4 id="jsmeix_commented_at_2023-05-30_1326"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1568434201">2023-05-30 13:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-30_1326" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I would like to better understand the reasoning behind why you<br />
"treat an automated response by USER_INPUT_FOO the same<br />
as using the default response given via -D"</p>
<p>I assume the reason is to avoid an endless loop<br />
when the user has specified a USER_INPUT_FOO value<br />
in his etc/rear/local.conf file that leads to a loop?</p>
<p>For example something like</p>
<pre><code>USER_INPUT_LAYOUT_CODE_RUN=0
</code></pre>
<p>which matches in layout/recreate/default/200_run_layout_code.sh</p>
<pre><code>choices[0]="Rerun disk recreation script ($LAYOUT_CODE)"
</code></pre>
<p>If my assumption is right I wonder if it is OK<br />
to let ReaR behave automatically different than<br />
what the user had explicitly specified because<br />
I think it contradicts how I understand what<br />
"final power to the user" should mean.</p>
<p>I.e. in my example above when the user had specified<br />
something that makes ReaR loop then ReaR must obey.<br />
ReaR must not attempt to do automated "corrections"<br />
of what the user had specified regardless if<br />
what the user had specified makes sense<br />
from our point of view.</p>
<p>But I am not against to<br />
"treat an automated response by USER_INPUT_FOO the same<br />
as using the default response given via -D"<br />
in non-interactive mode because it means ReaR would error out<br />
when the same user_input_ID gets an automated response<br />
(i.e. the same automated response) a second time<br />
which indicates that things do not move forward and<br />
when things do not move forward in non-interactive mode<br />
it is an erroneous state so it is OK to error out then.</p>
<p>I only like to get a sound understanding whether or not<br />
this behaviour is actually right or perhaps wrong.</p>
<h4 id="schlomo_commented_at_2023-05-31_2142"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1571002063">2023-05-31 21:42</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-31_2142" title="Permanent link">&para;</a></h4>
<p>@jsmeix I added your two suggestions. About your question in
<a href="https://github.com/rear/rear/pull/2988#issuecomment-1568434201">https://github.com/rear/rear/pull/2988#issuecomment-1568434201</a>
I think that my logic here is very simple: If ReaR starts to run in
circles during non-interactive mode, meaning that the same question is
asked again (same <code>UserInput -I XXX</code>), then we assume that additional
iterations of the same question will be answered with the same answer -
either the default value or something provided by the user - and
therefore will not lead to a different result. Therefore it is better to
abort with a clear error message so that other code, e.g. that was
running <code>rear recover</code> via SSH, can know about it and handle it.</p>
<p>For that logic it indeed doesn't matter <em>why</em> the answer to a question
is the same, it only matters that <em>it is</em> the same and we assume that it
is the same answer even though it would be possible to inject code into
ReaR that would go and modify the <code>USER_INPUT_XXX</code> variable between
calls to <code>UserInput</code>.</p>
<p>I think we should merge this and see how it behaves in production and
improve it where needed. I'm very confident that regular use of ReaR
will work "as expected".</p>
<h4 id="jsmeix_commented_at_2023-06-01_0626"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2988#issuecomment-1571431517">2023-06-01 06:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-01_0626" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
thank you for your explanatory description in your<br />
<a href="https://github.com/rear/rear/pull/2988#issuecomment-1571002063">https://github.com/rear/rear/pull/2988#issuecomment-1571002063</a></p>
<p>I fully agree with you.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-05-14.2988.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
