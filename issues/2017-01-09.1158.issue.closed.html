<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1158 Issue closed: USB_RETAIN_BACKUP_NR not effective when using extra data partition on USB device (OUTPUT=USB) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1158 Issue closed: USB_RETAIN_BACKUP_NR not effective when using extra data partition on USB device (OUTPUT=USB)";
        var mkdocs_page_input_path = "issues/2017-01-09.1158.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1158 Issue closed: USB_RETAIN_BACKUP_NR not effective when using extra data partition on USB device (OUTPUT=USB)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1158_issue_closed_usb_retain_backup_nr_not_effective_when_using_extra_data_partition_on_usb_device_outputusb"><a href="https://github.com/rear/rear/issues/1158">#1158 Issue</a> <code>closed</code>: USB_RETAIN_BACKUP_NR not effective when using extra data partition on USB device (OUTPUT=USB)<a class="headerlink" href="#1158_issue_closed_usb_retain_backup_nr_not_effective_when_using_extra_data_partition_on_usb_device_outputusb" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>needs sponsorship</code>, <code>no-issue-activity</code></p>
<h4 id="dwerner1_opened_issue_at_2017-01-09_1918"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> opened issue at <a href="https://github.com/rear/rear/issues/1158">2017-01-09 19:18</a>:<a class="headerlink" href="#dwerner1_opened_issue_at_2017-01-09_1918" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version <code>Relax-and-Recover 2.00 / Git</code></li>
<li>OS version <code>Debian GNU/Linux testing (stretch)</code></li>
<li><code>/etc/rear/site.conf</code> is empty, <code>/etc/rear/local.conf</code>:</li>
</ul>
<!-- -->

<pre><code>BACKUP=NETFS
OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
BACKUP_URL=usb:///dev/disk/by-label/REAR-DATA
</code></pre>
<ul>
<li>I'm using legacy BIOS and a gpt partition table!</li>
</ul>
<p>I'm using an extra data partition on an external USB device, here is the
output of <code>parted /dev/sdb print</code></p>
<pre><code>Disk /dev/sdb: 32.0GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name     Flags
 1      17.4kB  1600MB  1600MB  ext3         primary  legacy_boot
 2      1601MB  32.0GB  30.4GB  xfs          primary
</code></pre>
<p>I have set <code>USB_RETAIN_BACKUP_NR=2</code> but the rescue environment folders
sum up in the <code>REAR-DATA</code> partition</p>
<pre><code>drwx------ 7 root root 111 Jan  9 19:56 .
drwx------ 3 root root  24 Jan  9 11:45 ..
drwxr-x--- 2 root root  45 Jan  9 11:48 20170109.1143
drwxr-x--- 2 root root  45 Jan  9 19:40 20170109.1937
drwxr-x--- 2 root root  45 Jan  9 19:44 20170109.1941
drwxr-x--- 2 root root  45 Jan  9 19:50 20170109.1947
drwxr-x--- 2 root root  45 Jan  9 19:58 20170109.1955
</code></pre>
<p>In the <code>REAR-000</code> partition, everything looks good</p>
<pre><code>drwx------ 4 root root 4096 Jan  9 19:55 .
drwx------ 3 root root 4096 Jan  9 11:43 ..
drwx------ 2 root root 4096 Jan  9 19:47 20170109.1947
drwx------ 2 root root 4096 Jan  9 19:55 20170109.1955
</code></pre>
<h4 id="gozora_commented_at_2017-01-10_0817"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271512850">2017-01-10 08:17</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_0817" title="Permanent link">&para;</a></h4>
<p>Hi, @dwerner1</p>
<p>Reason for this would be simple, looks like ReaR does not have cleanup
of other that REAR-000 partition implemented.<br />
Relevant code can be found in
/usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh near line
130 so you can experiment with it.<br />
I can have a look once I'm home later today ...</p>
<p>V.</p>
<h4 id="dwerner1_commented_at_2017-01-10_0823"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271513902">2017-01-10 08:23</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0823" title="Permanent link">&para;</a></h4>
<p>Hi @gozora</p>
<p>Thanks! I'll have a look at that</p>
<h4 id="jsmeix_commented_at_2017-01-10_0844"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271517756">2017-01-10 08:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_0844" title="Permanent link">&para;</a></h4>
<p>I am very much against to implement more and more<br />
advanced backup management features into ReaR.</p>
<p>Reasons:</p>
<p>ReaR is not meant to be a backup management software<br />
cf. "Relax-and-Recover versus backup and restore" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Having more and more advanced backup features in ReaR<br />
makes it more and more labor-intensive to maintain ReaR<br />
because each feature needs continuous attention, testing,<br />
and work to keep it up to date.</p>
<p>In contrast ReaR is meant to be relatively easily extensible<br />
by additional selfmade scripts when a particular user needs<br />
special additional functionality.</p>
<p>In this case it is about backup management features when<br />
using a extra data partition on USB device.</p>
<p>Because plain removing of old backup directories should<br />
work independent of creating the new current backup<br />
I think it should work to add a script named either<br />
usr/share/rear/output/USB/Linux-i386/295_remove_outdated_dirs.sh<br />
or<br />
usr/share/rear/output/USB/Linux-i386/305_remove_outdated_dirs.sh<br />
that would run - as needed - either directly before or directly after<br />
usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh</p>
<h4 id="jsmeix_commented_at_2017-01-10_0847"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271518391">2017-01-10 08:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_0847" title="Permanent link">&para;</a></h4>
<p>By the way:<br />
On first glance I think the USB_RETAIN_BACKUP_NR<br />
implementation in a 'create_extlinux' named script at least<br />
looks unexpected - I would expect a separated script for<br />
the separated task to remove outdated backup directories?</p>
<h4 id="dwerner1_commented_at_2017-01-10_0847"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271518487">2017-01-10 08:47</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0847" title="Permanent link">&para;</a></h4>
<p>I do understand what you mean, I have actually already a script at hand
for handling older rescue environments</p>
<h4 id="gozora_commented_at_2017-01-10_0853"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271519626">2017-01-10 08:53</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_0853" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix,</p>
<blockquote>
<p>I am very much against to implement more and more<br />
advanced backup management features into ReaR.</p>
</blockquote>
<p>and</p>
<blockquote>
<p>I think it should work to add a script named either<br />
usr/share/rear/output/USB/Linux-i386/295_remove_outdated_dirs.sh<br />
or<br />
usr/share/rear/output/USB/Linux-i386/305_remove_outdated_dirs.sh<br />
that would run - as needed - either directly before or directly
after<br />
usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh</p>
</blockquote>
<p>I'm confused, isn't adding new scripts into ReaR same as adding new
features to existing ones?<br />
What does "advanced backup management features" include?</p>
<h4 id="jsmeix_commented_at_2017-01-10_0855"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271520021">2017-01-10 08:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_0855" title="Permanent link">&para;</a></h4>
<p>@dwerner1<br />
only out of curiosity:</p>
<p>Why do you use GPT plus an extra data partition<br />
on a only 32GB small USB device?</p>
<p>As far as I know (and according to what I wrote in default.conf)<br />
traditional MBR should work up to 2TB<br />
and simple ext3 should work up to 4TB<br />
so that for a 32GB USB device the "rear format" default<br />
of MBR and a single ext3 'REAR-000' labeled partition<br />
should "just work".</p>
<h4 id="gozora_commented_at_2017-01-10_0857"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271520518">2017-01-10 08:57</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_0857" title="Permanent link">&para;</a></h4>
<p>@jsmeix I'm just guessing, but maybe @dwerner1 is preparing for
something bigger ...<br />
Remember
<a href="https://github.com/rear/rear/issues/1105">https://github.com/rear/rear/issues/1105</a>
?</p>
<h4 id="dwerner1_commented_at_2017-01-10_0858"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271520690">2017-01-10 08:58</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0858" title="Permanent link">&para;</a></h4>
<p>@gozora ;-) yes indeed!</p>
<p>The stick is my testing environment - the productive system is an
external USB DAS device 16TB of size (RAID1) I plan to have a <code>REAR-000</code>
ext3 partition of ~ 1 TB, and a 15TB xfs <code>REAR-DATA</code> partition</p>
<h4 id="jsmeix_commented_at_2017-01-10_0909"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271523038">2017-01-10 09:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_0909" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I meant new scripts that are added by a particular user<br />
only on his particular systems but not included in the<br />
general ReaR upstream code.</p>
<p>From my point of view "backup management features"<br />
include basically all what exceeds plain making a backup<br />
during "rear mkbackup" and plain restore during "rear recover"<br />
cf. "Relax-and-Recover versus backup and restore" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Strictly speaking I would wish things like<br />
NETFS_KEEP_OLD_BACKUP_COPY<br />
and USB_RETAIN_BACKUP_NR would have<br />
never been accepted in the ReaR upstream code.</p>
<p>But as those features are there we now have to deal<br />
with perfectly valid user requests when those features<br />
do not work well in this or that circumstances.</p>
<p>I.e. the request of @dwerner1 to make USB_RETAIN_BACKUP_NR<br />
also working with a separated data partition (more generally to make<br />
it working based on the BACKUP_URL value) is perfectly valid<br />
from a ReaR user's point of view.</p>
<p>But I fear this could lead to an endless sequence of requests<br />
to enhance ReaR to manage the backups which could<br />
pervert ReaR into unmaintainable bloatware.</p>
<h4 id="dwerner1_commented_at_2017-01-10_0910"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271523216">2017-01-10 09:10</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0910" title="Permanent link">&para;</a></h4>
<p>My kind of use of rear in this case might be a little spurious or not
common, I'm not 100% sure anymore if I'm going the right way. The
location of the server, this rear implementation is meant for, is a very
remote area in northern europe. There are just a few people who have
access to the machine, but almost no knowledge of Linux server
administration. They shall be able to recover the server from scratch to
a state, where the machine can be accessed remotely again. ReaR in my
eyes is just perfect for that scenario. Does anyone of you think
different?</p>
<h4 id="gozora_commented_at_2017-01-10_0926"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271526620">2017-01-10 09:26</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_0926" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>I meant new scripts that are added by a particular user<br />
only on his particular systems but not included in the<br />
general ReaR upstream code.</p>
</blockquote>
<p>This explains a lot, thanks. (especially "only on his particular
systems"). From my experience I think that adding script to ReaR is a
bit clumsy. You need to know what stage is launched and when. Maybe I've
missed it, but don't we have something like ReaR <strong>pre</strong> and <strong>post</strong>
backup scripts?</p>
<blockquote>
<p>I.e. the request of @dwerner1 to make USB_RETAIN_BACKUP_NR<br />
also working with a separated data partition (more generally to make<br />
it working based on the BACKUP_URL value) is perfectly valid<br />
from a ReaR user's point of view.</p>
</blockquote>
<p>Fully agree here.</p>
<p>@dwerner1 Yes, you've chosen road nobody was walking before you, so it
will not be that smooth. But to my opinion your choice uncovered at
least one general bug so it was worth it. Apart from that I have a
feeling that you are not far from making all this work.</p>
<h4 id="dwerner1_commented_at_2017-01-10_0931"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271527729">2017-01-10 09:31</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0931" title="Permanent link">&para;</a></h4>
<p>It was a little bumpy ride the recent three weeks with rear ;-) But with
your and @jsmeix support it was even fun! I'm now pretty satisfied with
the current setup and current git version</p>
<h4 id="jsmeix_commented_at_2017-01-10_0941"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271529791">2017-01-10 09:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_0941" title="Permanent link">&para;</a></h4>
<p>@dwerner1<br />
don't worry - compared to my first attempts with ReaR<br />
it seems your's have been actually quite smooth.</p>
<p>And your input helped already improve ReaR.<br />
Many thanks for that!</p>
<p>If you have selfmade scripts that make USB_RETAIN_BACKUP_NR<br />
work for you with a separated data partition I would very much<br />
appreciate it if you could provide them to us (e.g. attach them<br />
to this issue) so that we could have a look what works for you.</p>
<h4 id="dwerner1_commented_at_2017-01-10_0944"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271530465">2017-01-10 09:44</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_0944" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Oh yes, I plan to publish my script! It's just still a bit rough and
untidy at the moment. When I install that finally, I'll definetely
publish this here together with my experiences during the implementation</p>
<h4 id="jsmeix_commented_at_2017-01-10_1006"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271535455">2017-01-10 10:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1006" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I fully agree that "adding script to ReaR is a bit clumsy".</p>
<p>I think the main problem with adding selfmade scripts is<br />
that ReaR works very much based on the idea of workflows<br />
which are longer sequences of things that are done where each<br />
step may depend in various ways on all its predecessor steps.</p>
<p>This can make it complicated to add a script "in between"<br />
because one has to know exactly what the actual<br />
state of the workflow is at a particular position<br />
to find the right position in a workflow where a particular<br />
additional functionality (i.e. a new script) can be added.</p>
<p>Cf. my currently unsuccessful attempt to spilt the current<br />
huge "recover" workflow into well separated generic parts, see<br />
<a href="https://github.com/rear/rear/pull/1091#issuecomment-263819775">https://github.com/rear/rear/pull/1091#issuecomment-263819775</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/987">https://github.com/rear/rear/issues/987</a></p>
<p>Therefore I have in my mind the idea of "tasks"<br />
where each task is a well separated generic part<br />
that is useful on its own and that can run on its own.</p>
<p>For example the "recover" workflow consists basically<br />
of those well separated generic tasks:</p>
<ol>
<li>setup the disk layout (i.e. prepare storage)</li>
<li>store the payload (e.g. restore a backup)</li>
<li>install the bootloader</li>
</ol>
<p>Currently ReaR has so called "stages",<br />
see the SourceStage function in lib/framework-functions.sh<br />
but those "stages" are not what I mean with "task"<br />
because a stage is not useful on its own<br />
and it cannot run on its own.</p>
<p>Basically a task is bigger than a stage abut usually<br />
a task is smaller than a workflow (except minimal<br />
workflows like format, mkbackuponly, restoreonly).</p>
<h4 id="jsmeix_commented_at_2017-01-10_1009"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271536024">2017-01-10 10:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1009" title="Permanent link">&para;</a></h4>
<p>During "rear recover" we have<br />
PRE_RECOVERY_SCRIPT and POST_RECOVERY_SCRIPT<br />
and during "rear mkbackup" we have<br />
PRE_BACKUP_SCRIPT and POST_BACKUP_SCRIPT,<br />
see "custom scripts" in default.conf.</p>
<h4 id="gdha_commented_at_2017-01-10_1339"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271577495">2017-01-10 13:39</a>:<a class="headerlink" href="#gdha_commented_at_2017-01-10_1339" title="Permanent link">&para;</a></h4>
<p>@dwerner1 Why not using a dedicated NAS/NFS server to archive the
backup/archives of your Linux systems in the far remote data center? I
always prefer this above USB (USB is ok for stand-alone systems IMHO).</p>
<h4 id="dwerner1_commented_at_2017-01-10_1357"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271581429">2017-01-10 13:57</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1357" title="Permanent link">&para;</a></h4>
<p>@gdha</p>
<p>That's a justified argument! It's a server hosting five vibrant virtual
machines and it has a large data throughput. Each <code>rear -v mkbackup</code>
will most likely create images of currently ~ 2 to 3TB of size. The DAS
is connected via USB 3.1 Type C and provides an enormous higher
connection speed compared to NAS/NFS. It's also a demand by the company
I work as a freelancer for, that the disaster recovery images reside in
close geographical neighbourhood to the server. The server mainly
collects, analyzes and temporarily stores data from wind turbines and
measuring devices in a far remote renewable energy test field. The
internet connection to this place is far from stable and reliable, the
machine has to be recoverable locally without any need of network
connection!</p>
<h4 id="dwerner1_commented_at_2017-01-10_1416"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271585816">2017-01-10 14:16</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1416" title="Permanent link">&para;</a></h4>
<p>To make my occupational background a bit more transparent - I'm a civil
engineer, located in Cologne, Germany. I frequently work for companies
in the green energy sector. I've been working as a JAVA developer for
fifteen years and I also have a deep passion for Linux servers since
1996. (I started with Caldera Linux ;-) ) That's a rough overview, I'm
fifty years old by the way... So, I'm definitely not the typical Linux
Admin, but quite addicted to it.</p>
<h4 id="gozora_commented_at_2017-01-10_1422"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271587352">2017-01-10 14:22</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_1422" title="Permanent link">&para;</a></h4>
<p>@dwerner1 really interesting case.</p>
<ol>
<li>Do you plan to store backup of all servers on one single DAS?</li>
<li>Are servers that will be backed up same or at least similar HW?</li>
<li>2 to 3 TB that is quite lot of data, why so much? Are some databases
    included?</li>
</ol>
<h4 id="dwerner1_commented_at_2017-01-10_1429"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271589156">2017-01-10 14:29</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1429" title="Permanent link">&para;</a></h4>
<p>@gozora</p>
<blockquote>
<ol>
<li>Do you plan to store backup of all servers on one single DAS?</li>
</ol>
</blockquote>
<p>It's by now only one host, another might be added in the future. For the
time being the main interest is, to be able to restore the VM's quickly</p>
<blockquote>
<ol>
<li>Are server that will be backed up same or at least similar HW?</li>
</ol>
</blockquote>
<p>Yes, exactly the same hardware structure</p>
<blockquote>
<ol>
<li>2 to 3 TB that is quite lot of data, why so much ? Are some
    databases included?</li>
</ol>
</blockquote>
<p>Yes, quite a few DB's. I'm not the admin of the VM's, I guess there are
~ 15 databases running, most of them Oracle</p>
<h4 id="gozora_commented_at_2017-01-10_1439"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271591865">2017-01-10 14:39</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_1439" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Yes, quite a few DB's. I'm not the admin of the VM's, I guess there
are ~ 15 databases running, most of them Oracle</p>
</blockquote>
<p>I'm not DB expert, but with the small experience I have, you should not
do "live" backup of running database. Maybe you should consider
splitting backup tasks like:</p>
<ol>
<li>ReaR to make backup/restore of bare OS</li>
<li>Run database backup separately with dedicated tools</li>
</ol>
<h4 id="jsmeix_commented_at_2017-01-10_1444"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271592973">2017-01-10 14:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1444" title="Permanent link">&para;</a></h4>
<p>Regarding huge ReaR backups see my opinion at<br />
<a href="https://github.com/rear/rear/issues/1006#issuecomment-248862040">https://github.com/rear/rear/issues/1006#issuecomment-248862040</a></p>
<p>In general regarding huge backups have a look at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a><br />
how one could get backup and restore much faster<br />
on sufficiently powerful systems.</p>
<p>Since ReaR 2.0 I would in any case split the backup<br />
of the basic system from any other "optional" backups<br />
(like databases) to be more on the safe side in case of a<br />
real disaster recovery so that you could get the basic system<br />
recovered fast and then do the other "optional" backup restores<br />
in a more relaxed way.</p>
<p>Even if you do all backups with ReaR I would keep<br />
separated backups separated so that I am more<br />
flexible with a possible recovery/restore.</p>
<p>Imagine only a database gets corrupted.<br />
You won't need to do a whole system recovery.<br />
Only a plain restore of that database should be sufficient.<br />
Then it should be more fail safe and faster when<br />
the backup of that database is separated.</p>
<h4 id="jsmeix_commented_at_2017-01-10_1451"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271594904">2017-01-10 14:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1451" title="Permanent link">&para;</a></h4>
<p>I think using 'usb' to have backups and ISO on a local disk<br />
without any need for networking is a valid request.</p>
<p>Currently using multiple backups for ReaR is not supported<br />
on local disks but the more I learn about the use case of<br />
@dwerner1 the more I think about whether or not<br />
ReaR should support it in the future?</p>
<h4 id="dwerner1_commented_at_2017-01-10_1451"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271595105">2017-01-10 14:51</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1451" title="Permanent link">&para;</a></h4>
<p>@gozora, @jsmeix</p>
<p>I understand what you mean! There are DB backup processes running inside
the VM's. The background of my approach is rather based on the fact that
- in case of disaster - and ( not rare ) no connection to the outside
world at the remote location - the people up there, who have not much
linux experience - shall be able to recover, not only the OS, but also
all VM's and actually the complete environment they had been using just
before the 'imaginable' crash.</p>
<h4 id="dwerner1_commented_at_2017-01-10_1455"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271596081">2017-01-10 14:55</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1455" title="Permanent link">&para;</a></h4>
<p>A little 'data loss' is not as problematic, as the machine 'not being'
recoverable locally and possibly standing still for days!</p>
<h4 id="jsmeix_commented_at_2017-01-10_1504"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271598382">2017-01-10 15:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1504" title="Permanent link">&para;</a></h4>
<p>@dwerner1<br />
only FYI in particular regarding "the people up there, who have<br />
not much linux experience - shall be able to recover",<br />
see<br />
"Let's face it: Deployment via the recovery installer is a must"<br />
at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="dwerner1_commented_at_2017-01-10_1514"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271601097">2017-01-10 15:14</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1514" title="Permanent link">&para;</a></h4>
<blockquote>
<p>"Let's face it: Deployment via the recovery installer is a must"<br />
at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
</blockquote>
<p>Yes I understand! They will be trained for that! 'The people up there'
are mostly engineers and technicians with a profound idea and interest
for Linux &amp; OpenSource - and some of them, even have collected
experience in good old UNIX days. Since they switch every three months,
it's a bit of training work and establishing scenario HOWTO's for that
.. for me!</p>
<p>Sometimes I feel like I need to find a solution for Robinson Crusoe's
island ... but he had no network access at all ;-) only Friday</p>
<h4 id="jsmeix_commented_at_2017-01-10_1525"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271604297">2017-01-10 15:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1525" title="Permanent link">&para;</a></h4>
<p>Some hard facts regarding my<br />
<a href="https://github.com/rear/rear/issues/1158#issuecomment-271594904">https://github.com/rear/rear/issues/1158#issuecomment-271594904</a></p>
<p>Currently using multiple backups for ReaR is<br />
not supported for things like</p>
<pre>
OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
</pre>

<p>with etc/rear/basic_system.conf and<br />
etc/rear/home_backup.conf as in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a><br />
because after<br />
usr/sbin/rear -C basic_system -d -D mkbackup<br />
and a subsequent<br />
usr/sbin/rear -C home_backup -d -D mkbackuponly<br />
one gets on the REAR-000 medium</p>
<pre>
rear/e205/20170110.1618
rear/e205/20170110.1618/backup-home_backup.log
rear/e205/20170110.1618/backup-home_backup.tar.gz
rear/e205/20170110.1614
rear/e205/20170110.1614/backup-basic_system.log
rear/e205/20170110.1614/kernel
rear/e205/20170110.1614/syslinux.cfg
rear/e205/20170110.1614/initrd.cgz
rear/e205/20170110.1614/rear-e205-mkbackup-basic_system-4931.log
rear/e205/20170110.1614/backup-basic_system.tar.gz
</pre>

<p>which is essentially the same issue as in<br />
<a href="https://github.com/rear/rear/issues/1145">https://github.com/rear/rear/issues/1145</a><br />
cf.<br />
<a href="https://github.com/rear/rear/issues/1141#issuecomment-269963775">https://github.com/rear/rear/issues/1141#issuecomment-269963775</a></p>
<h4 id="jsmeix_commented_at_2017-01-10_1532"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271606509">2017-01-10 15:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-10_1532" title="Permanent link">&para;</a></h4>
<p>Regarding support for multiple backups<br />
also for BACKUP_URL=usb I created right now<br />
<a href="https://github.com/rear/rear/issues/1160">https://github.com/rear/rear/issues/1160</a></p>
<h4 id="dwerner1_commented_at_2017-01-10_1543"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271609651">2017-01-10 15:43</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1543" title="Permanent link">&para;</a></h4>
<p>Puuh! I didn't expect to kick something off like this issue .. But I
really appreciate you support, review and ideas @jsmeix , @gozora ,
@gdha !</p>
<h4 id="gdha_commented_at_2017-01-10_1601"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271615166">2017-01-10 16:01</a>:<a class="headerlink" href="#gdha_commented_at_2017-01-10_1601" title="Permanent link">&para;</a></h4>
<p>@dwerner1 Are you coming to FOSDEM? Cologne is not that far from
Brussels - we have a devroom where everybody of the current ReaR team
will be available...</p>
<h4 id="dwerner1_commented_at_2017-01-10_1610"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271618148">2017-01-10 16:10</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1610" title="Permanent link">&para;</a></h4>
<p>@gdha</p>
<p>Since I now know that you all are gonna be there - I seriously have
started planning to come!</p>
<h4 id="gozora_commented_at_2017-01-10_1623"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271622013">2017-01-10 16:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_1623" title="Permanent link">&para;</a></h4>
<p>Questions questions questions :-).<br />
I have another one:</p>
<blockquote>
<p>I understand what you mean! There are DB backup processes running
inside the VM's.</p>
</blockquote>
<p>Where is this DB backup currently stored?</p>
<p>And maybe a hint;<br />
Sometimes when I don't have luxury of my backup server being available,
I'm using "round" backup scenario where I do backups as follows:</p>
<ul>
<li>server1 -&gt; server2</li>
<li>server2 -&gt; server3</li>
<li>server3 -&gt; server1</li>
</ul>
<p>Didn't you consider something like this (maybe a bit more bulletproof)?</p>
<p>V.</p>
<h4 id="dwerner1_commented_at_2017-01-10_1646"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271628543">2017-01-10 16:46</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1646" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Where is this DB backup currently stored?</p>
</blockquote>
<p>Currently these backups are 'backuped' via Samba up to the host and
various external USB devices. I'm not responsible for these backup
procedures. This host has grown in two years and not been initially
setup by me. My add to this machine was a KVM/Qemu based environment for
running 2 Ubuntu based VM's and 3 Windows server VM's (Running
engineering specific stuff, measurement procedures, SQL .. and so on) It
was my main task to shift former physical Windows servers into KVM based
VM's. The two Ubuntu machines just entered the boat recently.</p>
<blockquote>
<p>And maybe a hint;<br />
Sometimes when I don't have luxury of my backup server being
available, I'm using "round" backup scenario where I do backups as
follows:<br />
server1 -&gt; server2<br />
server2 -&gt; server3<br />
server3 -&gt; server1<br />
Didn't you consider something like this (maybe a bit more
bulletproof)?</p>
</blockquote>
<p>Too be honest - when I had built the machine from scratch - I had at
least taken in mind what you mention here ;-)</p>
<h4 id="gozora_commented_at_2017-01-10_1707"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271634766">2017-01-10 17:07</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_1707" title="Permanent link">&para;</a></h4>
<p>I'm starting to get a better picture here...<br />
There are two possible ways how you can continue from here:</p>
<p>You plan to either:</p>
<ol>
<li>Launch ReaR on VM HOST and backup all available data including VM
    guest virtual disks. Then in case of disaster, recover HOST and
    (hope that VM guest disks are consistent) and start guests.</li>
</ol>
<p>or</p>
<ol>
<li>Launch ReaR in each VM GUEST separately + launch ReaR on VM HOST
    (backup OS relevant data). In case of disaster, restore VM HOST
    first and then restore VM guests.</li>
</ol>
<p>Which one is closer?</p>
<p>V.</p>
<h4 id="dwerner1_commented_at_2017-01-10_1723"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271639155">2017-01-10 17:23</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-10_1723" title="Permanent link">&para;</a></h4>
<p>@gozora</p>
<p>That's a valuable mind input! I have been closer to point 1 before. But
since today I'm getting closer to point 2 .<br />
Point 2 is 'a bit' more work for me ... I have to think about that way
for a while before I can invest in that</p>
<blockquote>
<p>Launch ReaR in each VM GUEST separately + launch ReaR on VM HOST
(backup OS relevant data). In case of disaster, restore VM HOST first
and then restore VM guests.</p>
</blockquote>
<p>Am I right? This is exclusively for the Ubuntu VM's, isn't it? I haven't
missed the publishing of ReaR for Microsoft Windows? ;-)</p>
<h4 id="gozora_commented_at_2017-01-10_1740"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271643752">2017-01-10 17:40</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-10_1740" title="Permanent link">&para;</a></h4>
<p>@dwerner1</p>
<p>Well, yes at least to my experience you should not make backup of things
that are running (complex DBs, VM, etc ...). You might be lucky and
everything goes fine, but I really doubt that ;-). My recent experience
when running backup/restore of OS where just a small mysql DB running
was "Failed to start MySQL" message.</p>
<p>For that ReaR for MS windows topic, currently I'm working on new backup
method called BLOCKCLONE which should be able to do backups regardless
on filesystem used. NTFS backup using <code>ntfsclone</code> will be part of it.
You can check
<a href="https://github.com/rear/rear/issues/1078">https://github.com/rear/rear/issues/1078</a>
if you want to read more about it.<br />
For your case however (having windows in KVM VM) all you need to do is
to shutdown Windows and backup its VM disks I guess.</p>
<p>Hopefully after @jsmeix
<a href="https://github.com/rear/rear/issues/1158#issuecomment-271517756">https://github.com/rear/rear/issues/1158#issuecomment-271517756</a>
it will be accepted by upstream ;-)</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-01-11_0946"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271823712">2017-01-11 09:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-11_0946" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I do look forward to your new BLOCKCLONE backup method!</p>
<p>New backup methods match perfectly well how ReaR is meant<br />
to be used, cf. my planned extraordinary ZYPPER backup method<br />
<a href="https://github.com/rear/rear/issues/1085">https://github.com/rear/rear/issues/1085</a></p>
<p>New backup methods are no backup management features.</p>
<p>In contrast if you would implement special advanced<br />
backup management features for the BLOCKCLONE<br />
backup method, then I may not like it.</p>
<p>But all that totally depends on whether or not features<br />
are needed to make a backup method work normally<br />
or if a feature is not actually needed to be inside ReaR<br />
because the admin can do the same on his own also<br />
outside of ReaR like cleaning up of outdated backups.</p>
<h4 id="jsmeix_commented_at_2017-01-11_0947"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271824087">2017-01-11 09:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-11_0947" title="Permanent link">&para;</a></h4>
<p>@dwerner1<br />
I look forward to seeing you at FOSDEM 2017, cf<br />
<a href="https://fosdem.org/2017/schedule/track/backup_and_disaster_recovery/">https://fosdem.org/2017/schedule/track/backup_and_disaster_recovery/</a></p>
<h4 id="dwerner1_commented_at_2017-01-11_0948"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271824261">2017-01-11 09:48</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-11_0948" title="Permanent link">&para;</a></h4>
<p>@gozora</p>
<p>I fully agree with you about the most likely inconsistent DB's after a
potential machine recovery. The people who run these DB based
applications, say that they can handle that with their own backups. So
I'm quite happy not to have to deal with this issue ;-)</p>
<h4 id="dwerner1_commented_at_2017-01-11_0949"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271824476">2017-01-11 09:49</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-11_0949" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I have decided to come at least for Saturday 4th ! Looking forward to
see the ReaR team there!</p>
<h4 id="gozora_commented_at_2017-01-11_1000"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271826895">2017-01-11 10:00</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-11_1000" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>In contrast if you would implement special advanced<br />
backup management features for the BLOCKCLONE<br />
backup method, then I may not like it.</p>
</blockquote>
<p>I'd really appreciate if you could have a short took on
<a href="https://github.com/gozora/rear/tree/block_clone">https://github.com/gozora/rear/tree/block_clone</a>
and tell me what do you think about it.<br />
I'm afraid that there might be some "backup management features" which
are not very well solved. Especially the partitioning code :-( (which is
not mandatory to use).<br />
It is working piece of code currently but I have that gut feeling that
it can be done better...</p>
<p>Thanks</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-01-11_1120"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271844006">2017-01-11 11:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-11_1120" title="Permanent link">&para;</a></h4>
<p>To keep separated issues separated I made a new issue<br />
"New kind of "backup" method: BACKUP=BLOCKCLONE"<br />
<a href="https://github.com/rear/rear/issues/1162">https://github.com/rear/rear/issues/1162</a></p>
<h4 id="gozora_commented_at_2017-01-11_1122"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271844340">2017-01-11 11:22</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-11_1122" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix !</p>
<h4 id="jsmeix_commented_at_2017-01-11_1150"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271849496">2017-01-11 11:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-11_1150" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
of course not only mandatory stuff for a backup method<br />
is acceptable in ReaR. Above I meant that all what is<br />
"needed to make a backup method work normally"<br />
should be perfectly well inside ReaR.</p>
<p>I only like to keep all that zillions of optional "nice to have"<br />
advanced thingies out of ReaR that can be as well done<br />
by the admin on his own outside of ReaR.</p>
<h4 id="gozora_commented_at_2017-01-11_1204"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-271851927">2017-01-11 12:04</a>:<a class="headerlink" href="#gozora_commented_at_2017-01-11_1204" title="Permanent link">&para;</a></h4>
<p>@jsmeix understood ;-)</p>
<h4 id="jsmeix_commented_at_2017-01-12_1116"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-272138247">2017-01-12 11:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-12_1116" title="Permanent link">&para;</a></h4>
<p>@dwerner1 regarding your<br />
<a href="https://github.com/rear/rear/issues/1158#issuecomment-271824261">https://github.com/rear/rear/issues/1158#issuecomment-271824261</a><br />
"The people who run these DB based applications, say that<br />
they can handle that with their own backups":</p>
<p>I wonder why DB data needs to be in the ReaR backups at all?</p>
<p>When "rear mkbackup" is run while the DB is active, then<br />
(with probability one
<a href="https://en.wikipedia.org/wiki/Almost_surely">https://en.wikipedia.org/wiki/Almost_surely</a>)<br />
the DB data in the ReaR backup will be inconsistent<br />
so that a restore of that DB data does not make sense<br />
because after restore of that DB data the DB won't work<br />
so that one of the DB's "own backups" would have to<br />
be additionally restored to make the DB work again<br />
in a consistent way (with some loss of data).</p>
<p>Therefore I think you can exclude DB data from the ReaR backup<br />
(cf. BACKUP_PROG_EXCLUDE and BACKUP_ONLY_EXCLUDE<br />
versus BACKUP_PROG_INCLUDE and BACKUP_ONLY_INCLUDE).</p>
<p>To get one of the DB's "own backups" restored automatically<br />
during "rear recover" one could use POST_RECOVERY_SCRIPT.</p>
<p>What I think what should happen during "rear recover"<br />
is the recovery of the plain operating system<br />
plus all application software (i.e. the DB software)<br />
but without DB data and then via POST_RECOVERY_SCRIPT<br />
the DB data would be restored from one of the DB's "own backups"<br />
so that after reboot the recreated system would start<br />
with the DB working again in a consistent way but<br />
with some loss of DB data (since the DB's "own backup").</p>
<h4 id="dwerner1_commented_at_2017-01-12_1406"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-272171110">2017-01-12 14:06</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-01-12_1406" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Yes, I understood! I have started excluding the DB files from the rescue
environment. Putting them back into the recovered system with
POST_RECOVERY_SCRIPT is a very useful hint, many thanks!</p>
<h4 id="jsmeix_commented_at_2017-01-12_1445"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-272181011">2017-01-12 14:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-12_1445" title="Permanent link">&para;</a></h4>
<p>@dwerner1<br />
an even further idea:</p>
<p>Perhaps you can talk with "the people who run these DB based<br />
applications" that they could care about the restore of the DB data<br />
from one of the DB's "own backups"?</p>
<p>What I mean is that "rear recover" results the plain<br />
operating system plus all application software<br />
(i.e. the DB software) but without DB data.</p>
<p>Then after reboot the recovered system runs on its own<br />
in its own native mode - instead of whatever<br />
possibly limited mode of the ReaR recovery system.</p>
<p>When the recovered system runs again in its own native mode<br />
the DB cannot start because there is not yet any DB data.</p>
<p>In this case it is perhaps possible that the DB related software<br />
(e.g. whatever DB startup script) can detect that there is<br />
no DB data and then it does a restore of the DB data<br />
from one of the DB's "own backups" so that finally<br />
it can successfully start the DB.</p>
<p>What I have in mind is that for example in the ReaR<br />
recovery system there are basically no services running<br />
so that when the DB data restore would need some<br />
services (you wrote about things like Samba)<br />
it may not be easily possible to restore the DB data<br />
from within the ReaR recovery system.</p>
<p>In contrast I assume that when the recovered system<br />
runs in its own native mode all needed stuff to restore<br />
the DB data is up and running so that DB data restore<br />
from within the normal running system would "just work".</p>
<p>In other words:<br />
I recommend to let ReaR do only what ReaR is designed for:<br />
A really fast recreation of the basic operating system.<br />
But keep any sophisticated additional work out of ReaR<br />
and let that be done by individual other tools where<br />
each one is designed for each particular special task.</p>
<h4 id="jsmeix_commented_at_2017-01-18_0835"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-273414562">2017-01-18 08:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-18_0835" title="Permanent link">&para;</a></h4>
<p>@dwerner1</p>
<p>FYI:<br />
I think I have some general good news regarding backup on USB<br />
(but nothing changed regarding this particular issue):<br />
See
<a href="https://github.com/rear/rear/issues/1166">https://github.com/rear/rear/issues/1166</a><br />
and
<a href="https://github.com/rear/rear/issues/1164">https://github.com/rear/rear/issues/1164</a></p>
<p>I would recommend that you update to the current ReaR GitHub master<br />
and test if the enhanced backup on USB behaviour makes it work<br />
better for your particular use case.</p>
<p>Regarding this particular issue<br />
(enhance USB_RETAIN_BACKUP_NR functionality):<br />
I will not do that because I am in general against functionality<br />
in ReaR that deletes files because I think the user's files<br />
(in particular his backups) are sacrosanct so that ReaR<br />
should not do anything with existing backups. I think it is<br />
the user's own personal task to deal with his backups.</p>
<h4 id="gdha_commented_at_2017-08-16_0935"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-322718018">2017-08-16 09:35</a>:<a class="headerlink" href="#gdha_commented_at_2017-08-16_0935" title="Permanent link">&para;</a></h4>
<p>@dwerner1 Can this issue be closed as there are more then enough answers
in it already...<br />
The last remark of @jsmeix about <em>enhance USB_RETAIN_BACKUP_NR
functionality</em> is quite clear I would say.</p>
<h4 id="dwerner1_commented_at_2017-08-16_1109"><img src="https://avatars.githubusercontent.com/u/6715683?v=4" width="50"><a href="https://github.com/dwerner1">dwerner1</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-322738077">2017-08-16 11:09</a>:<a class="headerlink" href="#dwerner1_commented_at_2017-08-16_1109" title="Permanent link">&para;</a></h4>
<p>@gdha</p>
<p>If you could give me a couple of days, I would publish a little script
here I'm using since January now. It initiates rear with <code>OUTPUT=USB</code> it
handles a number of backup files, deletes oldest and so .... nothing
gigantic but possibly useful for someone</p>
<h4 id="github-actions_commented_at_2020-07-02_0133"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/1158#issuecomment-652727925">2020-07-02 01:33</a>:<a class="headerlink" href="#github-actions_commented_at_2020-07-02_0133" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-01-09.1158.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
