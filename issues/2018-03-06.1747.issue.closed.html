<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1747 Issue closed: rear restore to smaller disk aborts silently - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1747 Issue closed: rear restore to smaller disk aborts silently";
        var mkdocs_page_input_path = "issues/2018-03-06.1747.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1747 Issue closed: rear restore to smaller disk aborts silently</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1747_issue_closed_rear_restore_to_smaller_disk_aborts_silently"><a href="https://github.com/rear/rear/issues/1747">#1747 Issue</a> <code>closed</code>: rear restore to smaller disk aborts silently<a class="headerlink" href="#1747_issue_closed_rear_restore_to_smaller_disk_aborts_silently" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="lukey3332_opened_issue_at_2018-03-06_1859"><img src="https://avatars.githubusercontent.com/u/17516425?v=4" width="50"><a href="https://github.com/Lukey3332">Lukey3332</a> opened issue at <a href="https://github.com/rear/rear/issues/1747">2018-03-06 18:59</a>:<a class="headerlink" href="#lukey3332_opened_issue_at_2018-03-06_1859" title="Permanent link">&para;</a></h4>
<p>Hello Everyone,<br />
I have an small Problem related to the latest Changes in the Disk Layout
Code.</p>
<ul>
<li>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 2.3 / Git</li>
<li>Brief description of the issue:<br />
    If I restore to an smaller Disk, rear recover aborts after the
    disk-layout Promt without any Error message:</li>
</ul>
<!-- -->

<pre><code>Relax-and-Recover 2.3 / Git
Using log file: /var/log/rear/rear-luklap.log
Running workflow recover within the ReaR rescue/recovery system
Will do driver migration (recreating initramfs/initrd)
Comparing disks
Device sda has size 250059350016 but 256060514304 is expected (needs manual configuration)
Switching to manual disk layout configuration
Original disk /dev/sda does not exist (with same size) in the target system
Using /dev/sda (the only appropriate) for recreating /dev/sda
Current disk mapping table (source -&gt; target):
    /dev/sda /dev/sda
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default '1' timeout 300 seconds)
1
User confirmed disk mapping
Exiting rear recover (PID 993) and its descendant processes
</code></pre>
<ul>
<li>Work-around, if any:<br />
    Adding the following to the Config file makes the restore work</li>
</ul>
<!-- -->

<pre><code>AUTORESIZE_PARTITIONS=true
</code></pre>
<p>I think the user should be warned or asked in this case instead of
silently aborting.</p>
<h4 id="jsmeix_commented_at_2018-03-07_0753"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371053688">2018-03-07 07:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-07_0753" title="Permanent link">&para;</a></h4>
<p>@Lukey3332<br />
I need debug logging information to be able to work on it,<br />
i.e. the ReaR log file in the recovery system after "rear -D recover",<br />
see "Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2018-03-07_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371055121">2018-03-07 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-07_0759" title="Permanent link">&para;</a></h4>
<p>I guess this "sudden death" is a bash error exit in<br />
usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh<br />
because of</p>
<pre>
set -e -u -o pipefail
</pre>

<p>therein.</p>
<p>@Lukey3332<br />
try out if it works when you comment the <code>set -e -u -o pipefail</code> line
in<br />
usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh</p>
<p>I noticed such a "sudden death" once while implementing<br />
usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh<br />
regardless that the intended behaviour should be an error message<br />
according to my code in<br />
usr/share/rear/lib/_input-output-functions.sh</p>
<pre>
# Verbose exit in case of errors which is in particular needed when 'set -e' is active because
# otherwise a 'set -e' error exit would happen silently which could look as if all was o.k.
# cf. https://github.com/rear/rear/issues/700#issuecomment-327755633
# The separated EXIT_FAIL_MESSAGE variable is used to denote a failure exit.
# One cannot use EXIT_CODE for that because there are cases where a non-zero exit code
# is the intended outcome (e.g. in the 'checklayout' workflow, cf. usr/sbin/rear):
QuietAddExitTask "(( EXIT_FAIL_MESSAGE )) && echo '${MESSAGE_PREFIX}$PROGRAM $WORKFLOW failed, check $RUNTIME_LOGFILE for details' 1>&8"
</pre>

<p>which had worked at the time when I had implemented that<br />
but somehow it seems this does no longer work.</p>
<h4 id="jsmeix_commented_at_2018-03-07_1028"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371094318">2018-03-07 10:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-07_1028" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/1748">https://github.com/rear/rear/pull/1748</a><br />
fixes only that no longer any error message was shown<br />
when ReaR did a "sudden death" bash error exit<br />
when "set -e -u -o pipefail" was set in a script.</p>
<h4 id="jsmeix_commented_at_2018-03-07_1029"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371094772">2018-03-07 10:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-07_1029" title="Permanent link">&para;</a></h4>
<p>@Lukey3332<br />
I still need your "rear -D recover" debug logging information to be able
to find out<br />
what the actual root cause was why ReaR did a "sudden death" bash error
exit<br />
from
usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh<br />
in your particular case - for a possible reasoning behind have a look
at<br />
<a href="https://github.com/rear/rear/issues/700#issuecomment-297954640">https://github.com/rear/rear/issues/700#issuecomment-297954640</a></p>
<h4 id="lukey3332_commented_at_2018-03-07_1858"><img src="https://avatars.githubusercontent.com/u/17516425?v=4" width="50"><a href="https://github.com/Lukey3332">Lukey3332</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371246000">2018-03-07 18:58</a>:<a class="headerlink" href="#lukey3332_commented_at_2018-03-07_1858" title="Permanent link">&para;</a></h4>
<pre><code>2018-03-06 18:47:52.174328379 Confirm or edit the disk mapping
2018-03-06 18:47:52.176800411 1) Confirm disk mapping and continue 'rear recover'
2018-03-06 18:47:52.179231377 2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
2018-03-06 18:47:52.181650918 3) Use Relax-and-Recover shell and return back to here
2018-03-06 18:47:52.184030975 4) Abort 'rear recover'
2018-03-06 18:47:52.186380358 (default '1' timeout 300 seconds)
2018-03-06 18:48:03.889806392 UserInput: 'read' got as user input '1'
2018-03-06 18:48:03.896916288 User confirmed disk mapping
2018-03-06 18:48:03.907456999 Including layout/prepare/default/310_remove_exclusions.sh
2018-03-06 18:48:03.918008309 Including layout/prepare/default/320_apply_mappings.sh
2018-03-06 18:48:03.942803692 Including layout/prepare/default/400_autoresize_disks.sh
/usr/share/rear/layout/prepare/default/400_autoresize_disks.sh: line 10: backup_file: command not found
2018-03-06 18:48:03.960985855 Total resize of -6001164288B
2018-03-06 18:48:03.963323201 Searching for resizeable partitions on disk /dev/sda (250059350016B)
2018-03-06 18:48:03.973949625 Will not resize partition /dev/sda1.
2018-03-06 18:48:03.982307494 Will resize partition /dev/sda2.
2018-03-06 18:48:03.993812196 Resized partition /dev/sda2 from 255804309504B to 249804546048B.
2018-03-06 18:48:04.001879035 Including layout/prepare/default/420_autoresize_last_partitions.sh
250059350016
255852544
2018-03-06 18:48:04.032209019 Exiting rear recover (PID 993) and its descendant processes
/usr/share/rear/lib/_input-output-functions.sh: line 100: pstree: command not found
2018-03-06 18:48:05.037861561 
/usr/share/rear/lib/_input-output-functions.sh: line 104: COLUMNS: unbound variable
</code></pre>
<p>This is from my last try, I will post an Log with Debug-Mode later.</p>
<h4 id="lukey3332_commented_at_2018-03-07_1952"><img src="https://avatars.githubusercontent.com/u/17516425?v=4" width="50"><a href="https://github.com/Lukey3332">Lukey3332</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371263076">2018-03-07 19:52</a>:<a class="headerlink" href="#lukey3332_commented_at_2018-03-07_1952" title="Permanent link">&para;</a></h4>
<p>I can't upload files here :/<br />
<a href="https://paste.ubuntu.com/p/PXxBrsBvgG/">https://paste.ubuntu.com/p/PXxBrsBvgG/</a></p>
<h4 id="lukey3332_commented_at_2018-03-07_2003"><img src="https://avatars.githubusercontent.com/u/17516425?v=4" width="50"><a href="https://github.com/Lukey3332">Lukey3332</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371266564">2018-03-07 20:03</a>:<a class="headerlink" href="#lukey3332_commented_at_2018-03-07_2003" title="Permanent link">&para;</a></h4>
<p>Ok, with <code>set -e -u -o pipefail</code> Commented out it Errors out with:</p>
<pre><code>User confirmed disk mapping
Last partition /dev/sda2 must be shrinked by 1236992 bytes to still fit on disk
ERROR: Last partition /dev/sda2 cannot be shrinked (new disk more than 2% smaller)
Aborting due to an error, check /var/log/rear/rear-luklap.log for details
Exiting rear recover (PID 3720) and its descendant processes
Running exit tasks
</code></pre>
<p>I'm using LVM on an luks-Encrypted Partition (sda2) btw.</p>
<h4 id="jsmeix_commented_at_2018-03-08_0849"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371420851">2018-03-08 08:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-08_0849" title="Permanent link">&para;</a></h4>
<p>The</p>
<pre>
/usr/share/rear/lib/_input-output-functions.sh: line 104: COLUMNS: unbound variable
</pre>

<p>issue is
<a href="https://github.com/rear/rear/pull/1748">https://github.com/rear/rear/pull/1748</a>
and fixed thereby.</p>
<p>The</p>
<pre>
ERROR: Last partition /dev/sda2 cannot be shrinked (new disk more than 2% smaller)
</pre>

<p>works as intended, see in default.conf the section about<br />
<code>Resizing partitions in MIGRATION_MODE during "rear recover"</code><br />
therein in particular the AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE<br />
config variable that reads in particular:</p>
<pre>
# When the new disk is smaller than AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE percent it errors out.
...
AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE=2
</pre>

<p>In your case the new sda has a size of 250059350016 bytes<br />
but the old sda was 256060514304 bytes<br />
and 2% of 256060514304 bytes is 5121210286 bytes<br />
but 256060514304 - 250059350016 = 6001164288<br />
which is bigger than 5121210286 so that it errors out.</p>
<p>If you want automated shrinking in your case you could set<br />
AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE=3<br />
but read in default.conf the whole section about<br />
<code>Resizing partitions in MIGRATION_MODE during "rear recover"</code><br />
in particular because you use higher-level strorage objects<br />
on top of the plain partitions but automated shrinking<br />
by ReaR only shrinks plain partitions but not any higher-level<br />
strorage objects like LVM stuff on top of the plain partitions:</p>
<pre>
# When AUTORESIZE_PARTITIONS is true, all active partitions on all active disks
# get resized by the 430_autoresize_all_partitions.sh script
# (except boot and swap partitions via some special hardcoded rules in that script)
# if the disk size had changed (i.e. only in migration mode).
# This does not resize volumes on top of the affected partitions.
...
# When the first value in AUTORESIZE_PARTITIONS is neither true nor false
# only the last active partition on each active disk gets resized
# by the 420_autoresize_last_partitions.sh script.
...
# In particular this does not resize volumes on top of the affected partitions.
# To migrate volumes on disk where the disk size had changed the user must in advance
# manually adapt his disklayout.conf file before he runs "rear recover".
</pre>

<p>When you use <code>AUTORESIZE_PARTITIONS=true</code><br />
you will be affected by
<a href="https://github.com/rear/rear/issues/1731">https://github.com/rear/rear/issues/1731</a><br />
and the related issue
<a href="https://github.com/rear/rear/issues/102">https://github.com/rear/rear/issues/102</a></p>
<h4 id="jsmeix_commented_at_2018-03-08_0905"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371424948">2018-03-08 09:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-08_0905" title="Permanent link">&para;</a></h4>
<p>Your
<a href="https://paste.ubuntu.com/p/PXxBrsBvgG/">https://paste.ubuntu.com/p/PXxBrsBvgG/</a>
contains (excerpts):</p>
<pre>
2018-03-07 19:39:38.704224394 Examining /dev/sda to automatically resize its last active partition
...
2018-03-07 19:39:38.724577861 Checking /dev/sda1 if it is the last partition on /dev/sda
...
2018-03-07 19:39:38.732599450 Checking /dev/sda2 if it is the last partition on /dev/sda
...
2018-03-07 19:39:38.742238645 Found 'primary' partition /dev/sda2 as last partition on /dev/sda
...
2018-03-07 19:39:38.747556350 Determining if last partition /dev/sda2 is resizeable
...
++ last_part_is_resizeable=
++ IsInArray /dev/sda2
++ local needle=/dev/sda2
++ test -z /dev/sda2
++ shift
++ test /dev/sda2 == ''
++ shift
++ return 1
++ last_part_filesystem_entry=($( grep "^fs $last_part_dev " "$LAYOUT_FILE" ))
+++ grep '^fs /dev/sda2 ' /var/lib/rear/layout/disklayout.conf
+ DoExitTasks
</pre>

<p>so it seems you have a last partition /dev/sda2<br />
but there is no <code>fs /dev/sda2</code> entry for it in your disklayout.conf<br />
which causes this code in 420_autoresize_last_partitions.sh</p>
<pre>
        # Example filesystem 'fs' entry in disklayout.conf (excerpt):
        #  # Format: fs <device> <mountpoint> <fstype> ...
        #  fs /dev/sda3 /boot/efi vfat ...
        last_part_filesystem_entry=( $( grep "^fs $last_part_dev " "$LAYOUT_FILE" ) )
</pre>

<p>to fail (the <code>grep</code> therein results non-zero exit code).</p>
<h4 id="jsmeix_commented_at_2018-03-08_1003"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371440411">2018-03-08 10:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-08_1003" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/32eafc491f793e5b8a510ff8f4219ff9be2a7edf">https://github.com/rear/rear/commit/32eafc491f793e5b8a510ff8f4219ff9be2a7edf</a><br />
I removed "set -e -u -o pipefail" from
420_autoresize_last_partitions.sh<br />
because currently there are too many places in its code that work
right<br />
but are not implemented to work even with "set -e -u -o pipefail"<br />
cf.
<a href="https://github.com/rear/rear/issues/700#issuecomment-297944196">https://github.com/rear/rear/issues/700#issuecomment-297944196</a><br />
and the subsequent comments therein.</p>
<p>I assume with that commit this issue here should be fixed.</p>
<p>For me 420_autoresize_last_partitions.sh without "set -e -u -o
pipefail"<br />
works with a last partition that does not have a matching <code>fs</code> entry<br />
in disklayout.conf.</p>
<p>@Lukey3332<br />
many thanks for testing our newest GitHub master code and for your issue
report.<br />
It helped me a lot to make 420_autoresize_last_partitions.sh working
as intended.</p>
<h4 id="jsmeix_commented_at_2018-03-08_1040"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371450147">2018-03-08 10:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-08_1040" title="Permanent link">&para;</a></h4>
<p>@Lukey3332<br />
regardless that I already closed this issue please provide feedback<br />
whether or not the latest GitHub master code also works for you<br />
with appropriate settings for your particular case like<br />
<code>AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE=3</code></p>
<h4 id="lukey3332_commented_at_2018-03-09_1026"><img src="https://avatars.githubusercontent.com/u/17516425?v=4" width="50"><a href="https://github.com/Lukey3332">Lukey3332</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371774358">2018-03-09 10:26</a>:<a class="headerlink" href="#lukey3332_commented_at_2018-03-09_1026" title="Permanent link">&para;</a></h4>
<p>Yep, works as Expected now. Thanks for your Support!</p>
<h4 id="jsmeix_commented_at_2018-03-09_1141"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1747#issuecomment-371790400">2018-03-09 11:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-09_1141" title="Permanent link">&para;</a></h4>
<p>You are welcome.<br />
Thanks for your prompt feedback!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-03-06.1747.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
