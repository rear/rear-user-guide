<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#870 Issue closed: Recover problems with rpc.statd - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#870 Issue closed: Recover problems with rpc.statd";
        var mkdocs_page_input_path = "issues/2016-06-09.870.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#870 Issue closed: Recover problems with rpc.statd</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="870_issue_closed_recover_problems_with_rpcstatd"><a href="https://github.com/rear/rear/issues/870">#870 Issue</a> <code>closed</code>: Recover problems with rpc.statd<a class="headerlink" href="#870_issue_closed_recover_problems_with_rpcstatd" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="gcchelp_opened_issue_at_2016-06-09_0947"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> opened issue at <a href="https://github.com/rear/rear/issues/870">2016-06-09 09:47</a>:<a class="headerlink" href="#gcchelp_opened_issue_at_2016-06-09_0947" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>rear version (/usr/sbin/rear -V): Relax-and-Recover 1.18 / Git</p>
</li>
<li>
<p>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    OS_VENDOR=SUSE_LINUX<br />
    OS_VERSION=13.1</p>
<p>ARCH='Linux-i386'<br />
OS='GNU/Linux'<br />
OS_VERSION='13.1'<br />
OS_VENDOR='SUSE_LINUX'<br />
OS_VENDOR_VERSION='SUSE_LINUX/13.1'<br />
OS_VENDOR_ARCH='SUSE_LINUX/i386'</p>
</li>
<li>
<p>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):<br />
    OUTPUT=USB<br />
    USB_DEVICE=/dev/disk/by-label/REAR-000<br />
    BACKUP=NETFS<br />
    BACKUP_URL=nfs://nfsserver/backups/rear<br />
    EXCLUDE_MOUNTPOINTS=( /home /scratch )<br />
    AUTOEXCLUDE_PATH=( /media /mnt )<br />
    AUTOEXCLUDE_AUTOFS=..<br />
    AUTOEXCLUDE_DISKS=y<br />
    SSH_ROOT_PASSWORD=XXX</p>
</li>
<li>
<p>Brief description of the issue<br />
    Experimenting with REAR on openSUSE 13.1, 64-bit.<br />
    Restore fails with<br />
    ERROR: Could not start rpc.statd !</p>
</li>
</ul>
<p>In fact, it even can't be started manually:<br />
rpc.statd -F<br />
rpc.statd: failed to run /usr/sbin/sm-notify</p>
<p>BTW: Adding<br />
BACKUP_OPTIONS="nfsvers=3,nolock"<br />
to site.conf does change nothing. (And further: prevents the creation of
the live rescue system on the USB device, because the backup options are
used there as well.)</p>
<ul>
<li>Work-around, if any</li>
</ul>
<p>ln -s /bin/true /bin/rpc.statd</p>
<h4 id="jsmeix_commented_at_2016-06-09_1031"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-224858016">2016-06-09 10:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-09_1031" title="Permanent link">&para;</a></h4>
<p>I assign it to me because it is about SUSE<br />
regardless that I am not at all a NFS expert.</p>
<p>Regarding "failed to run /usr/sbin/sm-notify":</p>
<p>@GCChelp<br />
please check if /usr/sbin/sm-notify exists in the<br />
rear recovery system.</p>
<p>You can add missing things for rpc.statd to the rear<br />
recovery system via things like</p>
<pre>
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" prog1 prog2 )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /path1/file1 /path2/file2 )
</pre>

<p>in /etc/rear/local conf - cf.<br />
usr/share/rear/conf/examples/SLE12-SP1-btrfs-example.conf</p>
<p>This way it should be possible to make rpc.statd<br />
working in the rear recovery system.</p>
<p>Regarding "BACKUP_OPTIONS ... prevents the creation of the live rescue
system on the USB device":</p>
<p>I submitted a speparated issue<br />
<a href="https://github.com/rear/rear/issues/872">https://github.com/rear/rear/issues/872</a></p>
<h4 id="gcchelp_commented_at_2016-06-09_1205"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-224875427">2016-06-09 12:05</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-09_1205" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thanks for the quick response!</p>
<p>Yes, sm-notify is missing in the recovery system. I manually fumbled it
into the initrd with cpio, but your advice using the configuration
setting is much more straight forward.</p>
<p>I will try the REQUIRED_PROGS variable and let you know.</p>
<h4 id="jsmeix_commented_at_2016-06-09_1407"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-224905381">2016-06-09 14:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-09_1407" title="Permanent link">&para;</a></h4>
<p>@GCChelp<br />
see
<a href="https://github.com/rear/rear/issues/872#issuecomment-224904226">https://github.com/rear/rear/issues/872#issuecomment-224904226</a></p>
<p>I like that you test if it also works for you when you<br />
set a non-empty dummy OUTPUT_OPTIONS<br />
in your case something like</p>
<pre>
OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
BACKUP=NETFS
BACKUP_URL=nfs://nfsserver/backups/rear
BACKUP_OPTIONS="nfsvers=3,nolock"
OUTPUT_OPTIONS="nodiratime"
</pre>

<p>To see only how things are mounted run</p>
<pre>
rear -d -D mkbackup
</pre>

<p>and afterwards grep for 'mount_url' in the rear log file.</p>
<h4 id="gcchelp_commented_at_2016-06-10_0805"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225118687">2016-06-10 08:05</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_0805" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Manually adding sm-notify with the REQUIRED_PROGS variable worked. At
least it worked so far that sm-notify is now contained in the rescue
system file system.</p>
<p>Nevertheless, recover still fails with</p>
<blockquote>
<p>ERROR: Could not start rpc.statd !</p>
</blockquote>
<p>Debug output of a manual start of rpc.statd :</p>
<blockquote>
<p>rpc.statd -F -d<br />
rpc.statd: Version 1.2.8 starting<br />
rpc.statd: Flags: No-Daemon Log-STDERR TI-RPC<br />
sm-notify: Version 1.2.8 starting<br />
sm-notify: Already notifying clients; Exiting!<br />
rpc.statd: Failed to open directory sm: No such file or directory<br />
rpc.statd: Local NSM state number: 3<br />
rpc.statd: Failed to open /proc/sys/fs/nfs/nsm_local_state: No such
file or directory<br />
rpc.statd: Failed to unregister program 100024, version 1<br />
rpc.statd: Running as root. chown /var/lib/nfs to choose different
user<br />
rpc.statd: Failed to register (statd, 1, udp)<br />
rpc.statd: Failed to register (statd, 1, tcp)<br />
rpc.statd: Failed to register (statd, 1, udp6)<br />
rpc.statd: Failed to register (statd, 1, tcp6)<br />
rpc.statd: failed to create RPC listeners, exiting</p>
</blockquote>
<p>Adding<br />
<code>BACKUP_OPTIONS="nfsvers=3,nolock"</code><br />
to site.conf changes nothing.</p>
<p>Regarding your dummy OUTPUT_OPTIONS suggestion, I will try this too and
post the results.</p>
<h4 id="gcchelp_commented_at_2016-06-10_0922"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225134937">2016-06-10 09:22</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_0922" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I did the OUTPUT_OPTIONS experiment and it looks good to me:</p>
<blockquote>
<h1 id="grep_mount_url_varlogrearrear-testupdlog">grep mount_url /var/log/rear/rear-testupd.log<a class="headerlink" href="#grep_mount_url_varlogrearrear-testupdlog" title="Permanent link">&para;</a></h1>
<p>++ mount_url nfs://rhea/backups/rear
/tmp/rear.IOZzd2lGEK6Wai9/outputfs nfsvers=3,nolock<br />
++ umount_url nfs://rhea/backups/rear
/tmp/rear.IOZzd2lGEK6Wai9/outputfs<br />
++ mount_url usb:///dev/disk/by-label/REAR-000
/tmp/rear.IOZzd2lGEK6Wai9/outputfs nodiratime<br />
++ umount_url usb:///dev/disk/by-label/REAR-000
/tmp/rear.IOZzd2lGEK6Wai9/outputfs<br />
++ mount_url nfs://rhea/backups/rear
/tmp/rear.IOZzd2lGEK6Wai9/outputfs nfsvers=3,nolock<br />
++ umount_url nfs://rhea/backups/rear
/tmp/rear.IOZzd2lGEK6Wai9/outputfs</p>
</blockquote>
<p>Hope this helps!</p>
<h4 id="jsmeix_commented_at_2016-06-10_0925"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225135566">2016-06-10 09:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-10_0925" title="Permanent link">&para;</a></h4>
<p>It could become a lengthy step by step process<br />
with some trial an error until you have all you need<br />
in the recovery system so that rpc.statd can run there.</p>
<p>The "No such file or directory" messages indicate that<br />
you need to add more programs and/or files to<br />
REQUIRED_PROGS and/or COPY_AS_IS<br />
to get all needed pieces for rpc.statd into the<br />
recovery system.</p>
<p>Additionally and/or alternatively you might have to adapt<br />
the rpc.statd setup (i.e. its configuration files and/or the<br />
command line options how it is started) to get it running<br />
within the limited possibilities of the recovery system.</p>
<p>Bottom line:<br />
Currently the default rear recovery system<br />
does not well support running rpc.statd therein<br />
(sometimes it works sometimes not)<br />
cf.
<a href="https://github.com/rear/rear/issues/532">https://github.com/rear/rear/issues/532</a></p>
<p>FYI:<br />
In general regarding advanced NFS features see<br />
<a href="https://github.com/rear/rear/issues/754">https://github.com/rear/rear/issues/754</a></p>
<h4 id="jsmeix_commented_at_2016-06-10_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225136228">2016-06-10 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-10_0927" title="Permanent link">&para;</a></h4>
<p>@GCChelp<br />
does
<a href="https://github.com/rear/rear/issues/870#issuecomment-225134937">https://github.com/rear/rear/issues/870#issuecomment-225134937</a>
mean that with</p>
<pre>
BACKUP_OPTIONS="nfsvers=3,nolock"
OUTPUT_OPTIONS="nodiratime"
</pre>

<p>both "rear mkbackup" and then "rear recover" work for you?</p>
<h4 id="gcchelp_commented_at_2016-06-10_0937"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225138899">2016-06-10 09:37</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_0937" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>It could become a lengthy step by step process with some trial an
error until you have all you need in the recovery system so that
rpc.statd can run there.</p>
</blockquote>
<p>I thought, that openSUSE already was supported by REAR...</p>
<blockquote>
<p>does #870 (comment) mean that with</p>
<p>BACKUP_OPTIONS="nfsvers=3,nolock"<br />
OUTPUT_OPTIONS="nodiratime"</p>
<p>both "rear mkbackup" and then "rear recover" work for you?</p>
</blockquote>
<p>Unchanged: mkbackup works and recover fails with</p>
<blockquote>
<p>ERROR: Could not start rpc.statd !</p>
</blockquote>
<h4 id="jsmeix_commented_at_2016-06-10_1015"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225146271">2016-06-10 10:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-10_1015" title="Permanent link">&para;</a></h4>
<p>On my SUSE test systems I never had an NFS issue when I use</p>
<pre>
BACKUP_OPTIONS="nfsvers=3,nolock"
</pre>

<p>The only NFS issue that I had was
<a href="https://github.com/rear/rear/issues/532">https://github.com/rear/rear/issues/532</a></p>
<p>In general regarding "Support" see<br />
<a href="http://relax-and-recover.org/support/">http://relax-and-recover.org/support/</a></p>
<p>In general regarding "Disaster Recovery" see<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
therein see in particular the section<br />
"Disaster recovery with Relax-and-Recover (rear)"</p>
<h4 id="gcchelp_commented_at_2016-06-10_1131"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225159151">2016-06-10 11:31</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_1131" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I just noticed that on my workstations with openSUSE 13.1 rpc.statd is
running with the --no-notify option:</p>
<blockquote>
<h1 id="ps_-elf_grep_rpcstatd_grep_-v_grep">ps -elf | grep rpc.statd | grep -v grep<a class="headerlink" href="#ps_-elf_grep_rpcstatd_grep_-v_grep" title="Permanent link">&para;</a></h1>
<p>5 S statd 1733 1 0 80 0 - 9020 core_s 11:45 ? 00:00:00
/usr/sbin/rpc.statd --no-notify</p>
</blockquote>
<p>Unfortunately, this option is not derived from a configuration file, but
is hardcoded in the startup script...</p>
<p>Could this be useful in ReaR rescue system as well? How could this be
done?</p>
<h4 id="gcchelp_commented_at_2016-06-10_1136"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225159913">2016-06-10 11:36</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_1136" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>In general regarding "Support" see<br />
<a href="http://relax-and-recover.org/support/">http://relax-and-recover.org/support/</a></p>
</blockquote>
<p>This was not the kind of 'support' I meant. In fact, this page led me to
this GitHub repo and I signed up just for Rear.<br />
I was rather referring to e.g.
<a href="http://relax-and-recover.org/download/">http://relax-and-recover.org/download/</a>
, where an official stable release is offered for openSUSE 13.1, amongst
others...</p>
<blockquote>
<p>In general regarding "Disaster Recovery" see<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
therein see in particular the section<br />
"Disaster recovery with Relax-and-Recover (rear)"</p>
</blockquote>
<p>Wow interesting and comprehensive article. Thanks for the link!
Nevertheless, I will need some more time to go through this extensive
stuff.</p>
<h4 id="gcchelp_commented_at_2016-06-10_1347"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225186278">2016-06-10 13:47</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_1347" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>It could become a lengthy step by step process<br />
with some trial an error until you have all you need<br />
in the recovery system so that rpc.statd can run there.</p>
</blockquote>
<p>I already made some of those steps...<br />
By explicitly adding some more entries I came a bit further:<br />
<code>COPY_AS_IS=( "${COPY_AS_IS[@]}" /var/lib/nfs/sm /var/lib/nfs/sm.bak /var/lib/nfs/state )</code></p>
<p>Now, rpc.statd still complains</p>
<blockquote>
<p>rpc.statd: Failed to open /proc/sys/fs/nfs/nsm_local_state: No such
file or directory</p>
</blockquote>
<p>The man page of sm-notify states that /var/lib/nfs/state is the NSM
state number and /proc/sys/fs/nfs/nsm_local_state is the kernel's copy
of the NSM state number.<br />
But there even isn't a /proc/sys/fs/nfs/ directory in the rescue system.
As this is a virtual file system, it does not work to copy it over with
COPY_AS_IS ...</p>
<p>Any ideas how we could get this into the rescue kernel?</p>
<h4 id="gcchelp_commented_at_2016-06-10_1410"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225192127">2016-06-10 14:10</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-10_1410" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Any ideas how we could get this into the rescue kernel?</p>
</blockquote>
<p>Seems to come with the lockd kernel module. It even is available in the
rescue system and I can load it with modprobe . After loading it,
/proc/sys/fs/nfs/nsm_local_state is present!</p>
<p>How can I configure ReaR such that the lockd kernel module gets loaded
automatically?</p>
<h4 id="gdha_commented_at_2016-06-10_1427"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225196861">2016-06-10 14:27</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-10_1427" title="Permanent link">&para;</a></h4>
<p>I think we need a proper NFS prep script to cover the dependencies (with
NFSv4 there are more daemons and alike we need in the rescue image).<br />
@GCChelp <code>LOAD_MODULES=( ${LOAD_MODULES[@]} lockd )</code> would do the trick</p>
<h4 id="gcchelp_commented_at_2016-06-13_0957"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225538361">2016-06-13 09:57</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-13_0957" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
Unfortunately not.<br />
Neither<br />
<code>LOAD_MODULES=( ${LOAD_MODULES[@]} lockd )</code><br />
nor<br />
<code>LOAD_MODULES=( "${LOAD_MODULES[@]}" lockd )</code><br />
worked. The module doesn't get loaded automatically.<br />
Whereas I can manually do this with <code>modprobe lockd</code> without any
problem.</p>
<p>Is there anything I can check to find out what's (going) wrong?</p>
<h4 id="jsmeix_commented_at_2016-06-14_0730"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225801343">2016-06-14 07:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-14_0730" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
nowhere in the rear sources I find "LOAD_MODULES".<br />
I think this is a typo in
<a href="https://github.com/rear/rear/issues/870#issuecomment-225196861">https://github.com/rear/rear/issues/870#issuecomment-225196861</a></p>
<p>@GCChelp<br />
in general see usr/share/rear/conf/default.conf<br />
what variables you can set in /etc/rear/local.conf<br />
in particular</p>
<pre>
# autoload these modules in the given order
MODULES_LOAD=()
</pre>

<p>so that</p>
<pre>
MODULES_LOAD=( "${MODULES_LOAD[@]}" lockd )
</pre>

<p>is the right syntax.</p>
<h4 id="jsmeix_commented_at_2016-06-14_0739"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225803079">2016-06-14 07:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-14_0739" title="Permanent link">&para;</a></h4>
<p>@GCChelp<br />
regarding how to run "/usr/sbin/rpc.statd --no-notify" in your<br />
<a href="https://github.com/rear/rear/issues/870#issuecomment-225159151">https://github.com/rear/rear/issues/870#issuecomment-225159151</a></p>
<p>In usr/share/rear/conf/default.conf there is</p>
<pre>
################ ---- custom scripts
#
# NOTE: The scripts can be defined as an array
# to better handly spaces in parameters.
# The scripts are called like this:
# eval "${PRE_RECOVERY_SCRIPT[@]}"
# Call this after Rela-and-Recover did everything
# in the recover workflow.
# Use $TARGET_FS_ROOT (by default '/mnt/local')
# to refer to the recovered system.
POST_RECOVERY_SCRIPT=
# call this before Relax-and-Recover starts
# to do anything in the recover workflow.
# You have the rescue system but nothing else
PRE_RECOVERY_SCRIPT=
</pre>

<p>I did not test it myself - perhaps you can use it<br />
to run "/usr/sbin/rpc.statd --no-notify" ?</p>
<h4 id="gcchelp_commented_at_2016-06-14_0946"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225832264">2016-06-14 09:46</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-14_0946" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thanks for the clarification!<br />
Unfortunately, the MODULES_LOAD variant doesn't work either. :-(</p>
<p>The lockd module is present and can be loaded manually. But it does not
get loaded automatically.</p>
<p>I created the rescue media with debugging output, but didn't find a
problem in the log. Nor did I find anything related in dmesg output
after booting the rescue media.</p>
<p>Any hints where I can find enlightenment or what specifically I should
search for?</p>
<h4 id="jsmeix_commented_at_2016-06-14_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225841052">2016-06-14 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-14_1024" title="Permanent link">&para;</a></h4>
<p>@GCChelp<br />
I like to get a summary of your current state:</p>
<p>Please post your complete /etc/rear/local.conf file.</p>
<p>Additionally post what exact comands you have to run<br />
manually in the recovery system so that afterwards<br />
"rear recover" works successfully for you.</p>
<p>Finally I like to know what kind of system your NFS server is.<br />
Only a blind guess: Perhaps there is something special<br />
with your NFS server that leads to those isssues?</p>
<p>Then I can try to reproduce it (but do not expect too much<br />
from me here because I don't know much about NFS).</p>
<h4 id="gcchelp_commented_at_2016-06-14_1107"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225849729">2016-06-14 11:07</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-14_1107" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>Please post your complete /etc/rear/local.conf file.</p>
</blockquote>
<pre><code># grep -v ^# /etc/rear/site.conf

OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
BACKUP=NETFS
BACKUP_URL=nfs://nfsserver/backups/rear
BACKUP_OPTIONS="nfsvers=3,nolock"
OUTPUT_OPTIONS="nodiratime"
EXCLUDE_MOUNTPOINTS=( /home /a /b /c )
AUTOEXCLUDE_PATH=( /media /mnt )
AUTOEXCLUDE_AUTOFS=..
AUTOEXCLUDE_DISKS=y
SSH_ROOT_PASSWORD=XXX
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" sm-notify )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /var/lib/nfs/sm /var/lib/nfs/sm.bak /var/lib/nfs/state /proc/sys/fs/nfs/nsm_local_state )
MODULES_LOAD=( "${MODULES_LOAD[@]}" lockd )
</code></pre>
<blockquote>
<p>Additionally post what exact comands you have to run<br />
manually in the recovery system so that afterwards<br />
"rear recover" works successfully for you.</p>
</blockquote>
<p>I never claimed that "rear recover" was working... It still fails with<br />
<code>ERROR: Could not start rpc.statd !</code></p>
<p>:-(</p>
<blockquote>
<p>Finally I like to know what kind of system your NFS server is.<br />
Only a blind guess: Perhaps there is something special<br />
with your NFS server that leads to those isssues?</p>
</blockquote>
<p>It's a Hitachi HNAS 4080 high performance storage system. We mount the
NFS file systems via plain NFS3 protocol and it's working like a charm
together with dozens of openSUSE workstations and SLES servers (plus
machines with SGI/Irix).</p>
<p>This is what one of the NFS mounts look like in the running system:</p>
<pre><code># mount | grep :/home

nfsserver:/home on /home type nfs (rw,nosuid,nodev,relatime,vers=3,rsize=32768,wsize=32768,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=155.250.43.213,mountvers=3,mountport=4048,mountproto=tcp,local_lock=none,addr=155.250.43.213)
</code></pre>
<p>We use TCP for NFS. I tried to mount a filesystem with "proto=udp"
instead: works fine as well.</p>
<h4 id="jsmeix_commented_at_2016-06-14_1313"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225876504">2016-06-14 13:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-14_1313" title="Permanent link">&para;</a></h4>
<p>I did not yet try to reproduce it with your setup.</p>
<p>For me the current GitHub rear master<br />
works on an openSUSE 13.1 system<br />
(x86_64 virtual KVM/QEMU machine)</p>
<p>I have this /etc/rear/local.conf</p>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs
NETFS_KEEP_OLD_BACKUP_COPY=yes
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
</pre>

<p>cf.<br />
usr/share/rear/conf/examples/SLE11-ext3-example.conf</p>
<p>In the rear recovery system during "rear recover"<br />
the NFS share is mounted as<br />
("mount" output line shown wrapped here):</p>
<pre>
10.160.4.244:/nfs on /tmp/rear.SWrvJXtLXSSvr6n/outputfs
type nfs (ro,relatime,vers=3,rsize=1048576,wsize=1048576,
namlen=255,hard,nolock,proto=tcp,timeo=600,retrans=2,
sec=sys,mountaddr=10.160.4.244,mountvers=3,
mountport=20048,mountproto=udp,local_lock=all,
addr=10.160.4.244)
</pre>

<p>In my "rear -d -D recover" log file the NFS mount comand is</p>
<pre>
+++ mount -v -t nfs -o nfsvers=3,nolock 10.160.4.244:/nfs /tmp/rear.SWrvJXtLXSSvr6n/outputfs
mount.nfs: trying 10.160.4.244 prog 100003 vers 3 prot TCP port 2049
mount.nfs: trying 10.160.4.244 prog 100005 vers 3 prot UDP port 20048
mount.nfs: timeout set for Tue Jun 14 12:44:07 2016
mount.nfs: trying text-based options 'nfsvers=3,nolock,addr=10.160.4.244'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: prog 100005, trying vers=3, prot=17
++ StopIfError ...
</pre>

<p>Interestingly for me rpcbind and rpc.statd are running<br />
in the rear recovery system:</p>
<pre>
RESCUE e137:~ # ps auxw | grep rpc
root       632  0.0  0.0  34796   960 ?        Ss   12:42   0:00 rpcbind
root       637  0.0  0.1  17232  1308 ?        Ss   12:42   0:00 rpc.statd
root       669  0.0  0.0      0     0 ?        S&lt;   12:42   0:00 [rpciod]
RESCUE e137:~ # journalctl | grep rpc
Jun 14 12:42:07 e137 rpc.statd[637]: Version 1.2.8 starting
Jun 14 12:42:07 e137 rpc.statd[637]: Failed to open directory sm: No such file or directory
Jun 14 12:42:07 e137 rpc.statd[637]: Failed to read /var/lib/nfs/state: No such file or directory
Jun 14 12:42:07 e137 rpc.statd[637]: Initializing NSM state
Jun 14 12:42:07 e137 rpc.statd[637]: Running as root.  chown /var/lib/nfs to choose different user
</pre>

<p>Regarding 'rpc' my "rear -d -D recover" log file contains<br />
(excerpts):</p>
<pre>
++ PROGS=(${PROGS[@]:-} rpc.statd rpcbind ... rpcinfo ...
...
++ MODULES=(${MODULES[@]:-} ... sunrpc ...
...
++ COPY_AS_IS=(${COPY_AS_IS[@]:-} ... /etc/rpc ...
...
++ CLONE_USERS=("${CLONE_USERS[@]:-}" ... rpc ...
...
++ has_binary rpcbind
++ type rpcbind
++ rpcinfo -p localhost
++ rpcbind
++ StopIfError 'Could not start port mapper [rpcbind] !'
++ rpcinfo -p localhost
++ has_binary rpc.statd
++ type rpc.statd
++ rpcinfo -p localhost
++ rpc.statd
++ StopIfError 'Could not start rpc.statd !'
</pre>

<p>My NFS server is an openSUSE Leap 42.1 system<br />
(which is also the virtualization host for<br />
that openSUSE 13.1 virtual machine)<br />
with this /etc/exports</p>
<pre>
/nfs    *(rw,no_root_squash,sync,no_subtree_check)
</pre>

<p>For my general testing setup<br />
see "First steps with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I think this particular isue here is something special<br />
otherwise there should be other user reports like this.</p>
<p>I feel there is very little what I can really do here<br />
because I think a NFS expert and/or a RPC expert<br />
is needed to further analyze it.</p>
<p>What I can do is basically only blind guesswork.</p>
<h4 id="jsmeix_commented_at_2016-06-14_1320"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-225878435">2016-06-14 13:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-14_1320" title="Permanent link">&para;</a></h4>
<p>Regarding 'sm-notify' in the initial comment:<br />
I do not have it in my recovery system<br />
and 'sm-notify' is not mentioned in my<br />
"rear -d -D recover" log file.<br />
I.e. for me it works without 'sm-notify'.</p>
<h4 id="gcchelp_commented_at_2016-06-22_1339"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-227746330">2016-06-22 13:39</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-22_1339" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>Interestingly for me rpcbind and rpc.statd are running<br />
in the rear recovery system:</p>
<p>RESCUE e137:~ # ps auxw | grep rpc<br />
root 632 0.0 0.0 34796 960 ? Ss 12:42 0:00 rpcbind<br />
root 637 0.0 0.1 17232 1308 ? Ss 12:42 0:00 rpc.statd<br />
root 669 0.0 0.0 0 0 ? S&lt; 12:42 0:00 [rpciod]</p>
<p>RESCUE e137:~ # journalctl | grep rpc<br />
Jun 14 12:42:07 e137 rpc.statd[637]: Version 1.2.8 starting<br />
Jun 14 12:42:07 e137 rpc.statd[637]: Failed to open directory sm: No
such file or directory<br />
Jun 14 12:42:07 e137 rpc.statd[637]: Failed to read
/var/lib/nfs/state: No such file or directory<br />
Jun 14 12:42:07 e137 rpc.statd[637]: Initializing NSM state<br />
Jun 14 12:42:07 e137 rpc.statd[637]: Running as root. chown
/var/lib/nfs to choose different use</p>
</blockquote>
<p>In my recovery system, rpcstat.d is not running:</p>
<blockquote>
<h1 id="ps_auxw_grep_rpc">ps auxw | grep rpc<a class="headerlink" href="#ps_auxw_grep_rpc" title="Permanent link">&para;</a></h1>
<p>root 619 0.0 0.0 0 0 ? S&lt; Jun21 0:00 [rpciod]<br />
root 896 0.0 0.0 48636 1056 ? Ss Jun21 0:00 rpcbind<br />
root 1172 0.0 0.0 9008 684 pts/1 S+ 13:20 0:00 grep rpc</p>
<h1 id="journalctl_grep_rpc">journalctl | grep rpc<a class="headerlink" href="#journalctl_grep_rpc" title="Permanent link">&para;</a></h1>
<p>Jun 21 10:46:08 testupd rpc.statd[901]: Version 1.2.8 starting<br />
Jun 21 10:46:08 testupd rpc.statd[901]: Running as root. chown
/var/lib/nfs to choose different user<br />
Jun 21 10:46:08 testupd rpc.statd[901]: failed to create RPC
listeners, exiting<br />
Jun 21 10:46:08 testupd systemd[1]: Received SIGCHLD from PID 901
(rpc.statd).<br />
Jun 21 10:46:08 testupd systemd[1]: Child 901 (rpc.statd) died
(code=exited, status=1/FAILURE)<br />
Jun 21 10:46:08 testupd rear[908]: ERROR: Could not start rpc.statd
!</p>
</blockquote>
<p>But nevertheless, I can manually mount the NFS file system, if I do it
without locking:<br />
<code># mount -o nolock nfsserver:/backups /mnt</code></p>
<p>And it looks very much like your mount output from above, only IP
addresses and [rw]size differ!</p>
<h4 id="jsmeix_commented_at_2016-06-22_1415"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-227757627">2016-06-22 14:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-22_1415" title="Permanent link">&para;</a></h4>
<p>@GCChelp</p>
<p>in your initial comment
<a href="https://github.com/rear/rear/issues/870#issue-159368065">https://github.com/rear/rear/issues/870#issue-159368065</a>
you wrote</p>
<pre>
    Work-around, if any
  ln -s /bin/true /bin/rpc.statd
</pre>

<p>but in your later comment
<a href="https://github.com/rear/rear/issues/870#issuecomment-225849729">https://github.com/rear/rear/issues/870#issuecomment-225849729</a>
you wrote</p>
<pre>
>   Additionally post what exact comands you have to run
>   manually in the recovery system so that afterwards
>   "rear recover" works successfully for you.
I never claimed that "rear recover" was working... It still fails with
ERROR: Could not start rpc.statd !
</pre>

<p>and now you wrote</p>
<pre>
I can manually mount the NFS file system
</pre>

<p>I am confused.</p>
<p>When you can manually mount the NFS file system<br />
withut a running rpc.stad then it matches your<br />
initial comment that "ln -s /bin/true /bin/rpc.statd"<br />
should help to get "rear recover" working.</p>
<p>Or in other words:</p>
<p>When you can manually mount the NFS file system<br />
withut a running rpc.stad then it should help<br />
to simply disable the currently hardcoded<br />
error exit if it "Could not start rpc.statd !".</p>
<p>The "Could not start rpc.statd !" is only in<br />
usr/share/rear/verify/NETFS/default/05_start_required_daemons.sh</p>
<pre>
        rpc.statd
        StopIfError "Could not start rpc.statd !"
</pre>

<p>and if you change that to something like</p>
<pre>
        rpc.statd
        LogPrintIfError "Could not start rpc.statd !"
</pre>

<p>it would only log the error message to the rear log file<br />
and additionally print the error message on the terminal<br />
but<br />
it would no longer abort at that error.</p>
<p>Does then "rear recover" work for you?</p>
<h4 id="jsmeix_commented_at_2016-06-23_1434"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-228069556">2016-06-23 14:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-23_1434" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/891">https://github.com/rear/rear/pull/891</a><br />
it is no longer fatal when RPC status rpc.statd is unavailable<br />
so that it does no longer error out with<br />
"Could not start rpc.statd !"</p>
<p>Instead it now only shows a message like<br />
"RPC status rpc.statd unavailable<br />
(you may have to mount NFS without locking 'nolock')."</p>
<p>@GCChelp<br />
please test it it works better for you with<br />
the current rear GitHub master code.</p>
<h4 id="gcchelp_commented_at_2016-06-24_1307"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-228340432">2016-06-24 13:07</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-24_1307" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Trying to catch up some loose ends here...</p>
<p>For completeness sake: I repeated my experiments with an NFS server
based on openSUSE 13.1.<br />
Same results. Non of the problems seem to be related to the special NFS
server.</p>
<blockquote>
<p>I am confused.</p>
</blockquote>
<p>Sorry to confuse you. ;-)<br />
I meant it did not yet work for me the automated way. And not to
success.<br />
My manual workarounds only led me one step further.</p>
<p>But even with them I don't get a working system with "rear recover": It
runs and finishes. But when I try to boot the recovered system, it fails
because GRUB 2 is not configured correctly. That doesn't really surprise
me, because we are still using GRUB 1 (legacy)... But I suspect, this
would be substance for another (new) issue?</p>
<blockquote>
<p>The "Could not start rpc.statd !" is only in<br />
usr/share/rear/verify/NETFS/default/05_start_required_daemons.sh</p>
<pre><code>   rpc.statd
  StopIfError "Could not start rpc.statd !"
</code></pre>
<p>and if you change that to something like</p>
<pre><code>   rpc.statd
  LogPrintIfError "Could not start rpc.statd !"
</code></pre>
<p>it would only log the error message to the rear log file<br />
and additionally print the error message on the terminal<br />
but it would no longer abort at that error.</p>
<p>Does then "rear recover" work for you?</p>
</blockquote>
<p>Yes, with this workaround "rear recover" runs successful!<br />
(Finally leading to an unbootable machine, see above...)</p>
<p>And with this workaround I even no longer need any definition of
REQUIRED_PROGS, COPY_AS_IS and MODULES_LOAD in my configuration!</p>
<blockquote>
<p>When you can manually mount the NFS file system<br />
withut a running rpc.stad [...]</p>
</blockquote>
<p>When I can manually mount the NFS file system with "-o nolock", why
can't rear do this when I define<br />
<code>BACKUP_OPTIONS="nfsvers=3,nolock"</code><br />
in site.conf?</p>
<h4 id="jsmeix_commented_at_2016-06-27_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-228696025">2016-06-27 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-27_0927" title="Permanent link">&para;</a></h4>
<p>@GCChelp</p>
<p>Regarding GRUB 2 versus GRUB legacy:<br />
Please submit a new separated issue.<br />
Again post your /etc/rear/local.conf file in the new issue.<br />
Do "rear -d -D recover" and afterwards when you are<br />
still within in the recovery system get the rear log file<br />
out of the recovery system, see<br />
"Debugging issues with Relax-and-Recover (rear)" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
Then inspect the rear log file for messages which could be<br />
of interest reagrding the incorrect bootloader setup and<br />
post those log messages in your new separated issue.</p>
<p>Regarding</p>
<pre>
    rpc.statd
    LogPrintIfError "Could not start rpc.statd !"
with this workaround "rear recover" runs successful
</pre>

<p>This means that
<a href="https://github.com/rear/rear/pull/891">https://github.com/rear/rear/pull/891</a><br />
avoids this particular issue here.<br />
Accordingly I close this issue here as "fixed"<br />
(actually it is "avoided").</p>
<p>Regarding</p>
<pre>
When I can manually mount the NFS file system with "-o nolock",
why can't rear do this when I define
BACKUP_OPTIONS="nfsvers=3,nolock"
</pre>

<p>"rear recover" did not reach the point where it would mount<br />
the NFS file system because it aborted when "rpc.statd"<br />
failed to run.<br />
Since
<a href="https://github.com/rear/rear/pull/891">https://github.com/rear/rear/pull/891</a>
it is no longer<br />
fatal when "rpc.statd" fails to run so that "rear recover"<br />
can proceed to mount the NFS file system and then<br />
it does it with the BACKUP_OPTIONS (at least for me)<br />
see my
<a href="https://github.com/rear/rear/issues/870#issuecomment-225876504">https://github.com/rear/rear/issues/870#issuecomment-225876504</a></p>
<pre>
BACKUP_OPTIONS="nfsvers=3,nolock"
...
In my "rear -d -D recover" log file the NFS mount comand is
+++ mount -v -t nfs -o nfsvers=3,nolock 10.160.4.244:/nfs /tmp/rear.SWrvJXtLXSSvr6n/outputfs
</pre>

<h4 id="gcchelp_commented_at_2016-06-27_1218"><img src="https://avatars.githubusercontent.com/u/19816134?v=4" width="50"><a href="https://github.com/GCChelp">GCChelp</a> commented at <a href="https://github.com/rear/rear/issues/870#issuecomment-228729586">2016-06-27 12:18</a>:<a class="headerlink" href="#gcchelp_commented_at_2016-06-27_1218" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>Regarding GRUB 2 versus GRUB legacy:<br />
Please submit a new separated issue.</p>
</blockquote>
<p>Will do this.</p>
<blockquote>
<p>BACKUP_OPTIONS="nfsvers=3,nolock"<br />
...<br />
In my "rear -d -D recover" log file the NFS mount comand is</p>
<p>+++ mount -v -t nfs -o nfsvers=3,nolock 10.160.4.244:/nfs
/tmp/rear.SWrvJXtLXSSvr6n/outputfs</p>
</blockquote>
<p>Confirmed</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-06-09.870.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
