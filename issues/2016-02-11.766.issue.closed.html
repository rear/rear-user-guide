<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#766 Issue closed: Rear fails to run on modern Fedora kernels - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#766 Issue closed: Rear fails to run on modern Fedora kernels";
        var mkdocs_page_input_path = "issues/2016-02-11.766.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#766 Issue closed: Rear fails to run on modern Fedora kernels</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="766_issue_closed_rear_fails_to_run_on_modern_fedora_kernels"><a href="https://github.com/rear/rear/issues/766">#766 Issue</a> <code>closed</code>: Rear fails to run on modern Fedora kernels<a class="headerlink" href="#766_issue_closed_rear_fails_to_run_on_modern_fedora_kernels" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="astafyev_opened_issue_at_2016-02-11_1308"><img src="https://avatars.githubusercontent.com/u/5246794?v=4" width="50"><a href="https://github.com/astafyev">astafyev</a> opened issue at <a href="https://github.com/rear/rear/issues/766">2016-02-11 13:08</a>:<a class="headerlink" href="#astafyev_opened_issue_at_2016-02-11_1308" title="Permanent link">&para;</a></h4>
<p>40-start-udev-or-load-modules.sh script assumes that kernel modules have
.ko extension. Recent Fedora kernels have .ko.xz extensions so no
storage modules are not being loaded at all.<br />
Moreover this script loads usb_storage modules before others and
usually there is a slight delay between this module load and attempt to
mount /dev/disk/by-label/REAR-000 where backup is located. The more
storage modules are loaded the more delay is. But in case no or few
modules are loaded the delay is small and udev doesn't have enough time
to make corresponding symlink and rear fails with error while trying to
mount backup USB media.</p>
<h4 id="gdha_commented_at_2016-02-11_1609"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-182936951">2016-02-11 16:09</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-11_1609" title="Permanent link">&para;</a></h4>
<p>@astafyev thank you for the report - we will check it</p>
<h4 id="gdha_commented_at_2016-02-12_1328"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-183328015">2016-02-12 13:28</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-12_1328" title="Permanent link">&para;</a></h4>
<p>The configuration of my test:</p>
<pre><code># cat /etc/rear/site.conf 
BACKUP=NETFS
OUTPUT=USB
BACKUP_URL="usb:///dev/disk/by-label/REAR-000"
BACKUP_PROG_COMPRESS_OPTIONS="--bzip2"
BACKUP_PROG_COMPRESS_SUFFIX=".bz2"
</code></pre>
<p>I did a complete /backup/recover/ test with fedora23 and USB and it
worked out of the box for me.<br />
I did found 2 issues, but these are not related to this.<br />
OTOH, you have a point too. Will spend some time to investigate a bit
deeper.</p>
<h4 id="jsmeix_commented_at_2016-02-12_1439"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-183355276">2016-02-12 14:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-12_1439" title="Permanent link">&para;</a></h4>
<p>Since udev generates device nodes it is a generic issue<br />
that basically before any initial access of a device node<br />
one would have to do something like</p>
<pre>
udevadm settle --timeout=20
</pre>

<p>or use the rear function "my_udevsettle".</p>
<p>@astafyev<br />
can you get a rear log file (preferably where rear was called with '-d'
and '-D' debugging options) where it fails for you so that it is more
clear in what exact line in which rear script the initial access of
the<br />
device node happens because there a "udevadm settle" is probably missing
and needs to be inserted.</p>
<p>@gdha<br />
perhaps adding a general "udevadm settle" step in all rear<br />
workflows after all kernel modules have been loaded<br />
could be a single and simple generic solution<br />
(instead of adding "udevadm settle" at various places<br />
before each initial access of a device node).</p>
<p>FYI:<br />
The current scripts where "modprobe <something>" is called:</p>
<pre>
usr/share/rear/layout/prepare/GNU/Linux/15_include_drbd_code.sh
  modprobe drbd
usr/share/rear/layout/prepare/GNU/Linux/17_include_hpraid_code.sh
  modprobe cciss
usr/share/rear/layout/prepare/GNU/Linux/21_load_multipath.sh
  modprobe dm-multipath
usr/share/rear/layout/prepare/default/20_recreate_hpraid.sh
  modprobe cciss
usr/share/rear/lib/network-functions.sh
  modprobe bonding
usr/share/rear/lib/udev-workflow.sh
  modprobe pcspkr
usr/share/rear/prep/default/32_include_uefi_env.sh
  modprobe efivars
usr/share/rear/rescue/GNU/Linux/31_network_devices.sh
  modprobe bonding
  modprobe 8021q
usr/share/rear/skel/default/etc/scripts/system-setup.d/41-load-special-modules.sh
  modprobe xenblk
usr/share/rear/skel/default/etc/scripts/system-setup.d/40-start-udev-or-load-modules.sh
  many modprobe calls for many modules
</pre>

<p>If modprobe calls result that udev creates new device nodes,<br />
a "udevadm settle" should happen either after the modprobe call or at
least before the new device node is accessed for the first time.</p>
<p>@astafyev<br />
perhaps it might help for your particular "rear fails with error while
trying to mount backup USB media" issue when you add a line</p>
<pre>
udevadm settle --timeout=20
</pre>

<p>as very last line in<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/40-start-udev-or-load-modules.sh
but I don't think that helps because "on modern Fedora" systemd/udev
should do it and then there are already some "my_udevsettle" calls in
usr/share/rear/skel/default/etc/scripts/system-setup.d/40-start-udev-or-load-modules.sh</p>
<h4 id="astafyev_commented_at_2016-02-12_1851"><img src="https://avatars.githubusercontent.com/u/5246794?v=4" width="50"><a href="https://github.com/astafyev">astafyev</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-183448405">2016-02-12 18:51</a>:<a class="headerlink" href="#astafyev_commented_at_2016-02-12_1851" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
/usr/share/rear/skel/default/etc/scripts/system-setup.d/40-start-udev-or-load-modules.sh
script has condition with two branches to use udev or manually load
modules.<br />
I suppose that in your case you are routed to first branch that's why
you do not see any issues.<br />
I see "Loading storage modules..." during restore so in my case the
process goes definitely via second branch i.e. load modules manually:<br />
`</p>
<pre><code>if test -s /etc/modules ; then
    while read module options ; do
        case "$module" in
            (\#*|"") ;;
            (*) modprobe -v $module $options;;
        esac
    done &lt;/etc/modules
fi

echo "Loading storage modules..."
for module in $(find /lib/modules/$(uname -r)/kernel/drivers/{scsi,block,ide,message,ata} -type f 2&gt;/dev/null) ; do
    case "$(basename $module .ko)" in
        (nbd) echo "Module nbd excluded from being autoloaded.";;
        (*) modprobe -q $(basename $module .ko);;
    esac
done
</code></pre>
<p>`</p>
<p>First part loads modules from /etc/modules and in my case it is
usb_storage module and process of USB drive initialization starts here.
Second part loads storage modules with</p>
<p><code>modprobe -q $(basename $module .ko)</code><br />
command. Since all modules have .ko.xz extension nothing is being
loaded.</p>
<p>@jsmeix<br />
You see that in "manual modules loading" branch there is no
"my_udevsettle" or anything else that would wait for usb_storage
initialization.</p>
<h4 id="gdha_commented_at_2016-02-13_1252"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-183660822">2016-02-13 12:52</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-13_1252" title="Permanent link">&para;</a></h4>
<p>@astafyev I've fixed script
<code>/usr/share/rear/skel/default/etc/scripts/system-setup.d/40-start-udev-or-load-modules.sh</code>
and the following was the effect:</p>
<pre><code>Module                  Size  Used by
sata_qstor             16384  0
sata_promise           20480  0
sata_nv                28672  0
sata_mv                32768  0
sata_inic162x          20480  0
pdc_adma               16384  0
pata_via               16384  0
pata_triflex           16384  0
pata_sl82c105          16384  0
pata_sil680            16384  0
pata_serverworks       16384  0
sata_sis               16384  0
pata_sis               20480  1 sata_sis
pata_sch               16384  0
pata_rdc               16384  0
pata_piccolo           16384  0
pata_pdc202xx_old      16384  0
sata_sil24             20480  0
pata_pdc2027x          16384  0
pata_pcmcia            20480  0
pata_optidma           16384  0
pata_opti              16384  0
pata_oldpiix           16384  0
pata_ns87415           16384  0
pata_ns87410           16384  0
pata_ninja32           16384  0
pata_netcell           16384  0
pata_mpiix             16384  0
pata_marvell           16384  0
pata_jmicron           16384  0
pata_it821x            20480  0
pata_it8213            16384  0
pata_hpt3x3            16384  0
pata_hpt3x2n           16384  0
pata_hpt37x            20480  0
pata_hpt366            16384  0
pata_efar              16384  0
pata_cypress           16384  0
pata_cmd64x            16384  0
pata_cmd640            16384  0
pata_atp867x           16384  0
pata_atiixp            16384  0
pata_artop             16384  0
pata_amd               20480  0
pata_ali               16384  0
sata_vsc               16384  0
sata_uli               16384  0
sata_sil               16384  0
sata_via               20480  0
ahci_platform          16384  0
libahci_platform       16384  1 ahci_platform
sata_sx4               20480  0
acard_ahci             16384  0
sata_svw               16384  0
mptspi                 24576  0
mptsas                 61440  0
mptscsih               40960  2 mptsas,mptspi
mptlan                 20480  0
mptbase                98304  4 mptlan,mptsas,mptspi,mptscsih
zram                   28672  0
virtio_blk             20480  0
umem                   20480  0
sx8                    24576  0
skd                    77824  0
rbd                    69632  0
libceph               237568  1 rbd
pktcdvd                36864  0
osdblk                 16384  0
nvme                   57344  0
null_blk               16384  0
mtip32xx               49152  0
loop                   28672  0
floppy                 69632  0
drbd                  339968  0
lru_cache              16384  1 drbd
libcrc32c              16384  2 drbd,libceph
cciss                 114688  0
brd                    16384  0
aoe                    57344  0
DAC960                 81920  0
pmcraid                53248  0
megaraid               40960  0
iscsi_tcp              20480  0
wd719x                 20480  0
eeprom_93cx6           16384  1 wd719x
vmw_pvscsi             24576  0
ufshcd_pci             16384  0
ufshcd                 49152  1 ufshcd_pci
sym53c8xx              81920  0
stex                   24576  0
st                     57344  0
snic                   90112  0
ses                    20480  0
enclosure              16384  1 ses
scsi_transport_srp     20480  0
qla1280                28672  0
qla4xxx               266240  0
tcm_qla2xxx            32768  0
target_core_mod       331776  1 tcm_qla2xxx
qla2xxx               606208  1 tcm_qla2xxx
pm80xx                163840  0
osst                   57344  0
mvumi                  32768  0
mvsas                  53248  0
mpt3sas               192512  0
mpt2sas               188416  0
raid_class             16384  2 mpt2sas,mpt3sas
megaraid_sas          106496  0
megaraid_mbox          36864  0
megaraid_mm            20480  1 megaraid_mbox
lpfc                  638976  0
isci                  135168  0
libsas                 69632  3 isci,mvsas,pm80xx
ipr                   122880  0
initio                 28672  0
hptiop                 24576  0
hpsa                   86016  0
gdth                   90112  0
fnic                  106496  0
dmx3191d               20480  0
scsi_dh_rdac           16384  0
scsi_dh_hp_sw          16384  0
scsi_dh_emc            16384  0
scsi_dh_alua           20480  0
dc395x                 40960  0
cxgb4i                 40960  0
cxgb4                 217088  1 cxgb4i
cxgb3i                 36864  0
cxgb3                 151552  1 cxgb3i
mdio                   16384  1 cxgb3
libcxgbi               61440  2 cxgb3i,cxgb4i
libiscsi_tcp           20480  4 cxgb3i,cxgb4i,iscsi_tcp,libcxgbi
csiostor              131072  0
ch                     20480  0
bnx2i                  53248  0
fcoe                   28672  0
bnx2fc                 86016  0
cnic                   61440  2 bnx2i,bnx2fc
uio                    20480  1 cnic
libfcoe                61440  3 fcoe,fnic,bnx2fc
libfc                 110592  4 fcoe,fnic,libfcoe,bnx2fc
bfa                   552960  0
scsi_transport_fc      57344  9 bfa,csiostor,fcoe,fnic,lpfc,qla2xxx,libfc,tcm_qla2xxx,bnx2fc
be2iscsi              106496  0
iscsi_boot_sysfs       16384  2 qla4xxx,be2iscsi
libiscsi               53248  8 qla4xxx,libiscsi_tcp,bnx2i,cxgb3i,cxgb4i,be2iscsi,iscsi_tcp,libcxgbi
scsi_transport_iscsi    94208  6 qla4xxx,bnx2i,be2iscsi,iscsi_tcp,libcxgbi,libiscsi
atp870u                36864  0
arcmsr                 45056  0
am53c974               16384  0
esp_scsi               32768  1 am53c974
aic7xxx               122880  0
aic79xx               135168  0
advansys               61440  0
aacraid                94208  0
a100u2w                20480  0
BusLogic               90112  0
3w_xxxx                36864  0
3w_sas                 28672  0
3w_9xxx                45056  0
scsi_transport_spi     32768  6 esp_scsi,mptspi,sym53c8xx,aic79xx,aic7xxx,dmx3191d
scsi_transport_sas     40960  7 isci,mvsas,mpt2sas,mpt3sas,libsas,mptsas,pm80xx
osd                    16384  1 osdblk
libosd                 28672  2 osd,osdblk
8139cp                 28672  0
mii                    16384  1 8139cp
uas                    24576  0
snd_hda_codec_generic    73728  1
usb_storage            65536  1 uas
qxl                    69632  1
drm_kms_helper        118784  1 qxl
snd_hda_intel          36864  0
snd_hda_codec         126976  2 snd_hda_codec_generic,snd_hda_intel
ttm                    90112  1 qxl
virtio_balloon         16384  0
virtio_net             28672  0
snd_hwdep              16384  1 snd_hda_codec
virtio_console         28672  0
virtio_scsi            20480  0
snd_hda_core           61440  3 snd_hda_codec_generic,snd_hda_codec,snd_hda_intel
drm                   335872  4 qxl,ttm,drm_kms_helper
ppdev                  20480  0
snd_pcm               114688  3 snd_hda_codec,snd_hda_intel,snd_hda_core
joydev                 20480  0
snd_timer              32768  1 snd_pcm
snd                    77824  6 snd_hwdep,snd_timer,snd_pcm,snd_hda_codec_generic,snd_hda_codec,snd_hda_intel
ata_generic            16384  0
serio_raw              16384  0
virtio_pci             24576  0
pata_acpi              16384  0
soundcore              16384  1 snd
virtio_ring            16384  6 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console,virtio_scsi
virtio                 16384  6 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console,virtio_scsi
i2c_piix4              24576  0
parport_pc             28672  0
pvpanic                16384  0
parport                49152  2 ppdev,parport_pc
acpi_cpufreq           20480  0
</code></pre>
<p>It loaded all kernel modules. That is not desired. Fedora23 loaded all
modules it needed when I used the old script (with .ko).<br />
The problem is most likely a timing issue you encountered. Perhaps a
call to <code>my_udevsettle</code> is enough?</p>
<h4 id="astafyev_commented_at_2016-02-13_1841"><img src="https://avatars.githubusercontent.com/u/5246794?v=4" width="50"><a href="https://github.com/astafyev">astafyev</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-183719883">2016-02-13 18:41</a>:<a class="headerlink" href="#astafyev_commented_at_2016-02-13_1841" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
If loading of all modules are not desired we should remove second branch
with corresponding code. Otherwise if we want to keep case when udev is
not available we should also support ko.xz modules as well.<br />
I found that <code>/sys/kernel/uevent_helper</code> does not exist and that is why
<code>if [ $systemd_version -gt 190 ] || [ -s /etc/udev/rules.d/00-rear.rules ] &amp;&amp; [ -w /sys/kernel/uevent_helper ]; then</code>
condition fails and goes with second route. Is this file existence
mandatory?</p>
<h4 id="gdha_commented_at_2016-02-15_1103"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-184167597">2016-02-15 11:03</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-15_1103" title="Permanent link">&para;</a></h4>
<p>udev seems to have:</p>
<ul>
<li>Tue Jul 20 2010 Harald Hoyer <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#97;&#114;&#97;&#108;&#100;&#64;&#114;&#101;&#100;&#104;&#97;&#116;&#46;&#99;&#111;&#109;">&#104;&#97;&#114;&#97;&#108;&#100;&#64;&#114;&#101;&#100;&#104;&#97;&#116;&#46;&#99;&#111;&#109;</a> 160-7 - turn off
    hotplug in /sys/kernel/uevent_helper or /proc/sys/kernel/hotplug</li>
</ul>
<p>That explains probably why <code>/sys/kernel/uevent_helper</code> does not exist
anymore on Fedora 23. Systemd is taking over all these tasks. And
systemd-udev is starting via the systemd services availbale within rear
(see
<code>/usr/share/rear/skel/default/usr/lib/systemd/system/systemd-udevd.service</code>).</p>
<p>We should improve 40-start-udev-or-load-modules.sh to skip if
systemd-udevd.service is present</p>
<h4 id="gdha_commented_at_2016-02-15_1550"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-184266710">2016-02-15 15:50</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-15_1550" title="Permanent link">&para;</a></h4>
<p>@astafyev tomorrow you would be able to test the updated script.
Feedback is welcome</p>
<h4 id="gdha_commented_at_2016-02-22_1547"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-187238634">2016-02-22 15:47</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-22_1547" title="Permanent link">&para;</a></h4>
<p>@astafyev any feedback? Would like to complete 1.18</p>
<h4 id="astafyev_commented_at_2016-02-23_1310"><img src="https://avatars.githubusercontent.com/u/5246794?v=4" width="50"><a href="https://github.com/astafyev">astafyev</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-187691578">2016-02-23 13:10</a>:<a class="headerlink" href="#astafyev_commented_at_2016-02-23_1310" title="Permanent link">&para;</a></h4>
<p>Sorry for delay, was busy last days. With fixed script flow goes with
udev branch as expected. However I still get error message when mounting
mount /dev/disk/by-label/REAR-000. It seems that udev settle doesn't
work. man says that settle waits until queue is empty but queue can be
empty (as USB drive is found) while helpers that create device links may
still be working. I increased sleep delay from 1 to 5 and it started
working. It may be interim solution but there may be configurations when
5 seconds is not enough so we need more elegant solution.</p>
<h4 id="jsmeix_commented_at_2016-03-07_1008"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/766#issuecomment-193189798">2016-03-07 10:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-03-07_1008" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
in general regarding "sleep" in
<a href="https://github.com/rear/rear/commit/c04427c62e68d427d8e31e1f88abc68c4ff5e9f5">https://github.com/rear/rear/commit/c04427c62e68d427d8e31e1f88abc68c4ff5e9f5</a>
and in general regarding how to wait for things that are created by
udev, I submitted right now
<a href="https://github.com/rear/rear/issues/791">https://github.com/rear/rear/issues/791</a>
so that (hopefully) I can implement it properly for a future rear
version. For now the current workaround via "sleep some more" should be
o.k.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-02-11.766.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
