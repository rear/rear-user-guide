<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2927 Issue closed: SUSE 15.4 layout recreation fails due to missing chattr binary - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2927 Issue closed: SUSE 15.4 layout recreation fails due to missing chattr binary";
        var mkdocs_page_input_path = "issues/2023-02-14.2927.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2927 Issue closed: SUSE 15.4 layout recreation fails due to missing chattr binary</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2927_issue_closed_suse_154_layout_recreation_fails_due_to_missing_chattr_binary"><a href="https://github.com/rear/rear/issues/2927">#2927 Issue</a> <code>closed</code>: SUSE 15.4 layout recreation fails due to missing chattr binary<a class="headerlink" href="#2927_issue_closed_suse_154_layout_recreation_fails_due_to_missing_chattr_binary" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="schlomo_opened_issue_at_2023-02-14_0704"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/2927">2023-02-14 07:04</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-02-14_0704" title="Permanent link">&para;</a></h4>
<p>ReaR 2.7 on Leap 15.4 x86_64</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101384/218660284-befd43e7-f6b1-4b38-b1b9-b75a5590f9d5.png" /></p>
<p>I first thoght that this is another example for #2922, and that at
least on SUSE we should add <code>chattr</code> to <code>REQUIRED_PROGS</code> IMHO, in
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/SUSE_LINUX.conf">https://github.com/rear/rear/blob/master/usr/share/rear/conf/SUSE_LINUX.conf</a>
to be specific.</p>
<p>OTOH, this might be a different problem. I checked for <code>chattr</code> in the
layout save code:</p>
<pre><code>$ grep -r chattr usr/share/rear/layout/
usr/share/rear/layout/prepare/GNU/Linux/136_include_btrfs_subvolumes_SLES_code.sh:            echo "chattr +C $target_system_mountpoint/$subvolume_path"
usr/share/rear/layout/prepare/GNU/Linux/135_include_btrfs_subvolumes_generic_code.sh:            echo "chattr +C '$target_subvolume_path'"
usr/share/rear/layout/save/default/550_barrel_devicegraph.sh:#  lsattr chattr
usr/share/rear/layout/save/default/550_barrel_devicegraph.sh:         lsattr chattr
usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh:                # The 'no copy on write' attribute is shown as 'C' in the lsattr output (see "man chattr"):
usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh:                        PROGS+=( chattr lsattr )
</code></pre>
<p>And it seems like in <code>136_include_btrfs_subvolumes_SLES_code.sh</code> there
is code to add <code>chattr</code> calls but in <code>230_filesystem_layout.sh</code> there is
code to actually add <code>chattr</code> to <code>PROGS</code>. I guess that those two things
should be better coupled, so that it cannot happen that <code>chattr</code> is used
but not added to the rescue system. Or add it by default.</p>
<p>@jsmeix what would be the right solution here?</p>
<h4 id="jsmeix_commented_at_2023-02-14_1114"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1429553787">2023-02-14 11:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1114" title="Permanent link">&para;</a></h4>
<p>There is no such thing as a "right solution"<br />
when dealing with the SUSE default btrfs structure ;-)</p>
<p>I will have a look...</p>
<p>On first glance I think in<br />
layout/save/GNU/Linux/230_filesystem_layout.sh</p>
<pre><code>PROGS+=( chattr lsattr )
</code></pre>
<p>should be</p>
<pre><code>REQUIRED_PROGS+=( chattr )
PROGS+=( lsattr )
</code></pre>
<p>Can it be the case that you use SLE with its<br />
default btrfs structure but your etc/rear/local.conf<br />
is not based on a matching SLE template like<br />
usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf#L48">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/examples/SLE12-SP2-btrfs-example.conf#L48</a><br />
If yes, you will run into various problems.<br />
See also the SUSE documentation at<br />
<a href="https://documentation.suse.com/sle-ha/15-SP4/html/SLE-HA-all/cha-ha-rear.html">https://documentation.suse.com/sle-ha/15-SP4/html/SLE-HA-all/cha-ha-rear.html</a><br />
therein in the section<br />
"Limitations with Btrfs"</p>
<pre><code>Your SLE system needs matching ReaR configuration

For example, the setups in SLE12 GA, SLE12 SP1,
and SLE12 SP2 have several incompatible Btrfs default structures.
As such, it is crucial to use a matching ReaR configuration file.
See the example files
/usr/share/rear/conf/examples/SLE12*-btrfs-example.conf.
</code></pre>
<p>FYI:<br />
Since several years recreating the SUSE default btrfs structure<br />
had worked without issues and I also got no customer reports.<br />
But I know that code is more complex than I can fully understand<br />
so there are certainly gaps in the code in this or that cases.</p>
<h4 id="jsmeix_commented_at_2023-02-14_1125"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1429572776">2023-02-14 11:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1125" title="Permanent link">&para;</a></h4>
<p>I assume it is fixed via<br />
<a href="https://github.com/rear/rear/commit/64e9228e9178e717534526ba8ccd9a51af0cb4a8">https://github.com/rear/rear/commit/64e9228e9178e717534526ba8ccd9a51af0cb4a8</a></p>
<p>I don't want to overhaul the whole code that<br />
deals with the SUSE specific btrfs structure.<br />
More precisely:<br />
I cannot overhaul it with reasonable effort.<br />
I fear if I change it at one place it falls apart at another place.</p>
<h4 id="schlomo_commented_at_2023-02-14_1216"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1429656014">2023-02-14 12:16</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_1216" title="Permanent link">&para;</a></h4>
<p>I don't think that this solves the problem because <code>chattr</code> was
available on the source system but it was not included in the rescue
image. Therefore this code path was <em>not</em> used at all during <code>mkrescue</code>.</p>
<p>Also, let's keep it open till I can validate.</p>
<h4 id="jsmeix_commented_at_2023-02-14_1342"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1429768228">2023-02-14 13:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1342" title="Permanent link">&para;</a></h4>
<p>Show me how it failes in your specific case.<br />
I cannot reproduce it.<br />
For me it works.</p>
<h4 id="schlomo_commented_at_2023-02-14_1455"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1429876302">2023-02-14 14:55</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_1455" title="Permanent link">&para;</a></h4>
<p>The fix didn't solve the problem, <code>chattr</code> is still missing.</p>
<p><a href="https://github.com/rear/rear/files/10733394/rear-rear-sle15sp4.log">rear-rear-sle15sp4.log</a></p>
<pre><code>Running exit tasks
To remove the build area you may use (with caution): rm -Rf --one-file-system /var/tmp/rear.JeuiqOKrMeXMTPD
rear-sle15sp4:/src/rear # type -p chattr 
/usr/bin/chattr
rear-sle15sp4:/src/rear # grep chattr /var/log/rear/rear-rear-sle15sp4.log
rear-sle15sp4:/src/rear # find /var/tmp/rear.JeuiqOKrMeXMTPD -name chattr
rear-sle15sp4:/src/rear # cat /etc/fstab 
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /                       btrfs  defaults                      0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /var                    btrfs  subvol=/@/var                 0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /usr/local              btrfs  subvol=/@/usr/local           0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /tmp                    btrfs  subvol=/@/tmp                 0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /srv                    btrfs  subvol=/@/srv                 0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /root                   btrfs  subvol=/@/root                0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /opt                    btrfs  subvol=/@/opt                 0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /home                   btrfs  subvol=/@/home                0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /boot/grub2/x86_64-efi  btrfs  subvol=/@/boot/grub2/x86_64-efi  0  0
UUID=5f0f1233-512d-4f15-8686-606257e81b64  /boot/grub2/i386-pc     btrfs  subvol=/@/boot/grub2/i386-pc  0  0
rear-sle15sp4:/src/rear # lsb_release -a
LSB Version:    n/a
Distributor ID: openSUSE
Description:    openSUSE Leap 15.4
Release:        15.4
Codename:       n/a
</code></pre>
<p>In the <code>disklayout.conf</code> I find this:</p>
<pre><code># Mounted btrfs subvolumes that have the 'no copy on write' attribute set.
# Format: btrfsnocopyonwrite &lt;btrfs_subvolume_path&gt;
btrfsnocopyonwrite @/var
</code></pre>
<p>Adding <code>PROGS+=( ... )</code> like that probably doesn't work because it is in
a <em>subshell</em> that ends on line 539 so that this assignment has no effect
on ReaR.</p>
<p>I'd suggest being more generic here:</p>
<ol>
<li>If BTRFS is in use, then add <code>chattr</code> and <code>lsattr</code> to
    <code>REQUIRED_PROGS</code></li>
<li>If SUSE_LINUX, then add <code>chattr</code> and <code>lsattr</code> to <code>REQUIRED_PROGS</code></li>
</ol>
<p>BTW, we actually check for <code>REQUIRED_PRODS</code> in the <code>init</code> stage which
happens very early. Adding stuff to that array after the init stage only
ensures that it is also in the rescue system, but doesn't check in the
source system.</p>
<p>If you want to get hands-on then I can provide SSH access for you to
look at this.</p>
<h4 id="schlomo_commented_at_2023-02-16_1639"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1433378084">2023-02-16 16:39</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-16_1639" title="Permanent link">&para;</a></h4>
<p>@jsmeix ?</p>
<h4 id="jsmeix_commented_at_2023-02-17_0909"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1434346685">2023-02-17 09:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-17_0909" title="Permanent link">&para;</a></h4>
<p>Be patient...<br />
(fist things first and one thing at a time).</p>
<p>The "workaround" (i.e. the currently documented solution) is<br />
to use a local.conf that is based on a matching SLE template.</p>
<h4 id="schlomo_commented_at_2023-02-17_0942"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1434386789">2023-02-17 09:42</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-17_0942" title="Permanent link">&para;</a></h4>
<p>Good point with the examples, especially as we also refer to them in the
default <code>local.conf</code>.</p>
<p>However, they are only about SLE12 and not SLE15 and I'd hope that we
can cover "known" issues like including <code>chattr</code> and other progs already
via our code to make it simpler for users.</p>
<p>The other aspect is that we can't change global variables in a subshell
so that your fix won't work like that:<br />
<a href="https://github.com/rear/rear/blob/46d4dd3fe03595cc7b969db66d6ab1a881fcb6eb/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L505-L540">https://github.com/rear/rear/blob/46d4dd3fe03595cc7b969db66d6ab1a881fcb6eb/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L505-L540</a></p>
<p>The entire - very long - block of code runs in a subshell writing the
stdout to <code>$DISKLAYOUT_FILE</code>- hence variable assignments are lost at the
end of this subshell.</p>
<h4 id="jsmeix_commented_at_2023-02-22_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1440035627">2023-02-22 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-22_1340" title="Permanent link">&para;</a></h4>
<p>Argh!</p>
<p>@schlomo<br />
thank you for finding the root cause!</p>
<p>Long code parts within uncommon environments (e.g. a subshell)<br />
call for trouble when someone "just adds usual code" in between<br />
without looking at the global stuff.</p>
<p>I think that subshell usage is legacy code because<br />
a subshell is not needed to have a redirection<br />
for a longer piece of code, cf.<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/save/GNU/Linux/190_opaldisk_layout.sh#L24">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/layout/save/GNU/Linux/190_opaldisk_layout.sh#L24</a></p>
<h4 id="jsmeix_commented_at_2023-02-22_1346"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1440044143">2023-02-22 13:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-22_1346" title="Permanent link">&para;</a></h4>
<p>We use <code>) &gt;&gt; $DISKLAYOUT_FILE</code> there:</p>
<pre><code>usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh:
) &gt;&gt; $DISKLAYOUT_FILE

usr/share/rear/layout/save/GNU/Linux/240_swaps_layout.sh:
) &gt;&gt; $DISKLAYOUT_FILE

usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh:
) &gt;&gt; $DISKLAYOUT_FILE
</code></pre>
<p>I think I can replace in all those cases</p>
<pre><code>(
    longer
    block
    of
    code
) &gt;&gt; $DISKLAYOUT_FILE
</code></pre>
<p>by</p>
<pre><code>{
    longer
    block
    of
    code
} &gt;&gt; $DISKLAYOUT_FILE
</code></pre>
<p>which would - by the way - also fix this issue.</p>
<p>But I will have to have a bit closer look<br />
if perhaps an actual subshell is really needed<br />
in some of those cases.</p>
<h4 id="jsmeix_commented_at_2023-02-27_1325"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1446322275">2023-02-27 13:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-27_1325" title="Permanent link">&para;</a></h4>
<p>Even more Argh!</p>
<p>ShellCheck found it:</p>
<pre><code>In usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh line 505:
                        REQUIRED_PROGS+=( chattr )
                        ^------------^ SC2030 (info): Modification of REQUIRED_PROGS is local (to subshell caused by (..) group).
</code></pre>
<p>See in<br />
<a href="https://github.com/rear/rear/pull/2847#issuecomment-1446253316">https://github.com/rear/rear/pull/2847#issuecomment-1446253316</a><br />
the list of most often reported ShellCheck codes<br />
where this one is the very last one<br />
but it is just an 'info' - so "don't worry".<br />
Sigh!</p>
<p>But at least it proves my<br />
<a href="https://github.com/rear/rear/issues/1040#issuecomment-1034890880">https://github.com/rear/rear/issues/1040#issuecomment-1034890880</a></p>
<pre><code>the SCnnnn that appear rarely may more likely indicate real errors
</code></pre>
<p>which is confirmed by @pcahyna in his subsequent comment and my<br />
<a href="https://github.com/rear/rear/issues/1040#issuecomment-1060704029">https://github.com/rear/rear/issues/1040#issuecomment-1060704029</a></p>
<h4 id="jsmeix_commented_at_2023-02-27_1336"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1446337243">2023-02-27 13:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-27_1336" title="Permanent link">&para;</a></h4>
<p>For the (not so) fun of it:</p>
<p>ShellCheck also found</p>
<pre><code>In usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh line 546:
grep -q '^fs ' $DISKLAYOUT_FILE &amp;&amp; REQUIRED_PROGS+=( mkfs )
                                   ^------------^ SC2031 (info): REQUIRED_PROGS was modified in a subshell. That change might be lost.
</code></pre>
<p>which is the last but one in the list in<br />
<a href="https://github.com/rear/rear/pull/2847#issuecomment-1446253316">https://github.com/rear/rear/pull/2847#issuecomment-1446253316</a></p>
<p>As far as I see this one is plain wrong by ShellCheck<br />
because line 546 is already outside of the subshell<br />
so this one seems to be a parsing bug in ShellCheck<br />
(it seems to fail to recognize the end of the subshell).</p>
<p>I fail to understand what<br />
<a href="https://github.com/koalaman/shellcheck/wiki/SC2031">https://github.com/koalaman/shellcheck/wiki/SC2031</a><br />
likes to tell.</p>
<p>I understand what SC2030 means<br />
but I do not understand what SC2031 means.<br />
Whether or not ARRAY had been modified in a subshell<br />
has no influence on <code>ARRAY+=( foo )</code> outside of a subshell<br />
because the latter will append 'foo' to the ARRAY.</p>
<p>Regardless what SC2031 means,<br />
<a href="https://github.com/rear/rear/pull/2947">https://github.com/rear/rear/pull/2947</a><br />
will fix both SC2030 and SC2031.</p>
<h4 id="thomasmerz_commented_at_2023-03-01_0856"><img src="https://avatars.githubusercontent.com/u/18568381?u=520aed8f7e665d9d1caee6358db291489a99ef03&v=4" width="50"><a href="https://github.com/thomasmerz">thomasmerz</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1449608993">2023-03-01 08:56</a>:<a class="headerlink" href="#thomasmerz_commented_at_2023-03-01_0856" title="Permanent link">&para;</a></h4>
<blockquote>
<p>ShellCheck found it:</p>
</blockquote>
<p>This prooves how important some code-checking would and will be ❤️</p>
<h4 id="jsmeix_commented_at_2023-03-01_0915"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1449653071">2023-03-01 09:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-01_0915" title="Permanent link">&para;</a></h4>
<p>@thomasmerz<br />
for me this proves how carefully and thorougly<br />
we must implement our automated ShellCheck<br />
to get the right balance between usefulness<br />
and annoyance for us and our contributors.</p>
<p>E.g. in this case here:<br />
ShellCheck reported the bug only as 'info'<br />
but we cannot enable 'info' in general<br />
because most what ShellCheck reports as 'info'<br />
is an annoyance for us and our contributors.</p>
<p>Unfortunately '-S error --include=...' does not work<br />
to report errors plus explicitly specified non-error codes</p>
<pre><code># shellcheck -s bash -S error --include=SC2030 usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh
[no output]
</code></pre>
<h4 id="jsmeix_commented_at_2023-03-01_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2927#issuecomment-1449737191">2023-03-01 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-01_0954" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/pull/2947">https://github.com/rear/rear/pull/2947</a><br />
merged this issue should be fixed.</p>
<p>@schlomo<br />
thanks again for finding the root cause!<br />
Likely I would have searched elsewhere for some longer time.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-02-14.2927.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
