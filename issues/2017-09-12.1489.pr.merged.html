<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1489 PR merged: Tweak how ssh user is copied in usr/share/rear/rescue/default/500_ssh.sh - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1489 PR merged: Tweak how ssh user is copied in usr/share/rear/rescue/default/500_ssh.sh";
        var mkdocs_page_input_path = "issues/2017-09-12.1489.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1489 PR merged: Tweak how ssh user is copied in usr/share/rear/rescue/default/500_ssh.sh</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1489_pr_merged_tweak_how_ssh_user_is_copied_in_usrsharerearrescuedefault500_sshsh"><a href="https://github.com/rear/rear/pull/1489">#1489 PR</a> <code>merged</code>: Tweak how ssh user is copied in usr/share/rear/rescue/default/500_ssh.sh<a class="headerlink" href="#1489_pr_merged_tweak_how_ssh_user_is_copied_in_usrsharerearrescuedefault500_sshsh" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="n3wwn_opened_issue_at_2017-09-12_1905"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> opened issue at <a href="https://github.com/rear/rear/pull/1489">2017-09-12 19:05</a>:<a class="headerlink" href="#n3wwn_opened_issue_at_2017-09-12_1905" title="Permanent link">&para;</a></h4>
<p>This PR was originally included in my YUM PR, but I at the request of
@jsmeix , I pulled it out and am submitting it separately.</p>
<p>In my testing, I would see multiple passwd entries created if the string
'ssh' occurred in more than just the sshd daemon user's entry. While
this didn't actually break anything, these tweaks should make it
cleaner.</p>
<h4 id="jsmeix_commented_at_2017-09-14_0918"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1489#issuecomment-329424147">2017-09-14 09:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-14_0918" title="Permanent link">&para;</a></h4>
<p>@schlomo in<br />
<a href="https://github.com/rear/rear/pull/1489#pullrequestreview-62333816">https://github.com/rear/rear/pull/1489#pullrequestreview-62333816</a><br />
you wrote that in rescue/default/500_ssh.sh</p>
<pre>
... we check for $1$ in the ssh password
which is probably not working any more.
Probably better to check for $?$ or so
to catch all encryption formats.
</pre>

<p>I am afraid I do not understand what that means.<br />
In particular I do not understand what '$1$' or '$?$' stands for.<br />
Apparently this seems to be really basic knowledge<br />
that everybody "just knows" - except me :-(<br />
and no comment explains what that code is about :-((<br />
My blind guess is that '$1$' is perhaps meant to detect<br />
if $SSH_ROOT_PASSWORD is already encrypted but<br />
e.g. my SLES11 /etc/shadow password entries look like</p>
<pre>
...:$2y$...
...:$2a$...
</pre>

<p>so that neither '$1$' nor '$?$' seem to match - but I could be<br />
totally wrong because I do not understand what goes on here.</p>
<h4 id="n3wwn_commented_at_2017-09-14_1502"><img src="https://avatars.githubusercontent.com/u/19431804?v=4" width="50"><a href="https://github.com/N3WWN">N3WWN</a> commented at <a href="https://github.com/rear/rear/pull/1489#issuecomment-329510764">2017-09-14 15:02</a>:<a class="headerlink" href="#n3wwn_commented_at_2017-09-14_1502" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Looks like your SLES11 has at least one more encryption method (or
variant) than my CentOS7 box üòÅ</p>
<p>From crypt(3):</p>
<pre><code>   The glibc2 version of this function supports additional encryption algorithms.

   If salt is a character string starting with the characters "$id$" followed by a string terminated by "$":

          $id$salt$encrypted

   then instead of using the DES machine, id identifies the encryption method used and this then determines how the rest of the password string is interpreted.  The following values of id are supported:

          ID  | Method
          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          1   | MD5
          2a  | Blowfish (not in mainline glibc; added in some
              | Linux distributions)
          5   | SHA-256 (since glibc 2.7)
          6   | SHA-512 (since glibc 2.7)

   So $5$salt$encrypted is an SHA-256 encoded password and $6$salt$encrypted is an SHA-512 encoded one.

   "salt" stands for the up to 16 characters following "$id$" in the salt.  The encrypted part of the password string is the actual computed password.  The size of this string is fixed:

   MD5     | 22 characters
   SHA-256 | 43 characters
   SHA-512 | 86 characters

   The characters in "salt" and "encrypted" are drawn from the set [a‚ÄìzA‚ÄìZ0‚Äì9./].  In the MD5 and SHA implementations the entire key is significant (instead of only the first 8 bytes in DES).
</code></pre>
<p>If we have extglob enabled (i.e. <code>shopt -s extglob</code>), I can match DES,
MD5, Blowfish and SHA with the following:</p>
<pre><code># Set the SSH root password; if pw is hashed just copy it otherwise use openssl (for backward compatibility)
if [[ "$SSH_ROOT_PASSWORD" ]] ; then
    case "$SSH_ROOT_PASSWORD" in
    \$[0-9]?([a-z])\$*) echo "ALREADY ENC:  root:$SSH_ROOT_PASSWORD:::::::" ;;
    *     ) echo "NOT ENC:  root:$(echo $SSH_ROOT_PASSWORD | openssl passwd -1 -stdin):::::::" ;;
    esac
fi
</code></pre>
<p>I don't see any format restrictions, but going off the of what we know
(single digit or single digit+single char), I tested the following
successfully:</p>
<ol>
<li>SSH_ROOT_PASSWORD='unencryptedpasswd' # pass -&gt; detected as
    unencrypted</li>
<li>SSH_ROOT_PASSWORD='$1$encryptedpasswd' # pass -&gt; detected as
    encrypted</li>
<li>SSH_ROOT_PASSWORD='$6$encryptedpasswd' # pass -&gt; detected as
    encrypted</li>
<li>SSH_ROOT_PASSWORD='$2a$encryptedpasswd' # pass -&gt; detected as
    encrypted</li>
<li>SSH_ROOT_PASSWORD='$2az$encryptedpasswd' # pass -&gt; detected as
    unencrypted because of the extra char in the crypt ID</li>
</ol>
<p>This may not adhere to the coding standards of the project as I just
whipped up this test, but it may serve as a good start. We could add a
comment directing folks to check out the crypt(3) man page, too.</p>
<h4 id="jsmeix_commented_at_2017-09-15_1035"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1489#issuecomment-329745987">2017-09-15 10:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-15_1035" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
many thanks for your explanation in<br />
<a href="https://github.com/rear/rear/pull/1489#issuecomment-329510764">https://github.com/rear/rear/pull/1489#issuecomment-329510764</a></p>
<p>If you like could you do another pull request to enhance it<br />
so that it also works for more encryption methods?</p>
<h4 id="jsmeix_commented_at_2017-09-15_1039"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1489#issuecomment-329746847">2017-09-15 10:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-15_1039" title="Permanent link">&para;</a></h4>
<p>@N3WWN<br />
regarding "If we have extglob enabled" see</p>
<pre>
$ find usr/sbin/rear usr/share/rear/ | xargs grep 'extglob'
usr/sbin/rear:# The extglob shell option enables several extended pattern matching operators.
usr/sbin/rear:shopt -s nullglob extglob
</pre>

<p>i.e. ReaR has extglob enabled<br />
and nullglob which requires to be careful,<br />
e.g. see my commenta bout 'nullglob' in<br />
prep/NETFS/default/070_set_backup_archive.sh</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-09-12.1489.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
