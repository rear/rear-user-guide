<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2344 Issue closed: OUTPUT=USB on PPC64le PowerVM not bootable (with RHEL 7.7) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2344 Issue closed: OUTPUT=USB on PPC64le PowerVM not bootable (with RHEL 7.7)";
        var mkdocs_page_input_path = "issues/2020-03-18.2344.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2344 Issue closed: OUTPUT=USB on PPC64le PowerVM not bootable (with RHEL 7.7)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2344_issue_closed_outputusb_on_ppc64le_powervm_not_bootable_with_rhel_77"><a href="https://github.com/rear/rear/issues/2344">#2344 Issue</a> <code>closed</code>: OUTPUT=USB on PPC64le PowerVM not bootable (with RHEL 7.7)<a class="headerlink" href="#2344_issue_closed_outputusb_on_ppc64le_powervm_not_bootable_with_rhel_77" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>no-issue-activity</code></p>
<h4 id="mmetts_opened_issue_at_2020-03-18_1937"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> opened issue at <a href="https://github.com/rear/rear/issues/2344">2020-03-18 19:37</a>:<a class="headerlink" href="#mmetts_opened_issue_at_2020-03-18_1937" title="Permanent link">&para;</a></h4>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.5-git.3693.da115e6.master / 2020-03-18</li>
<li>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    RHEL 7.7</li>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>[root@crcossr2 crcossr2]# cat /etc/rear/local.conf
OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/mnt' '/gpfs' '/media' '/projects' '/var/tmp' '/var/crash')
</code></pre>
<ul>
<li>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PowerVM</li>
<li>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    PPC64le</li>
<li>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    BIOS ( I think )</li>
<li>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    Local disk is source. Target is a USB stick.</li>
<li>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</li>
</ul>
<!-- -->

<pre><code>[root@crcossr2 crcossr2]# lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                        KNAME      PKNAME    TRAN TYPE  FSTYPE              SIZE MOUNTPOINT
/dev/sda                    /dev/sda                  disk                    264.3G
|-/dev/sda1                 /dev/sda1  /dev/sda       part  linux_raid_member     4M
| `-/dev/md127              /dev/md127 /dev/sda1      raid1                       4M
|-/dev/sda2                 /dev/sda2  /dev/sda       part  xfs                   1G
`-/dev/sda3                 /dev/sda3  /dev/sda       part  LVM2_member       263.3G
  |-/dev/mapper/rhel-swap   /dev/dm-3  /dev/sda3      lvm   swap                  4G
  |-/dev/mapper/rhel-home   /dev/dm-4  /dev/sda3      lvm   xfs               209.3G
  `-/dev/mapper/rhel-root   /dev/dm-5  /dev/sda3      lvm   xfs                  50G
/dev/sdb                    /dev/sdb                  disk                    264.3G
|-/dev/sdb1                 /dev/sdb1  /dev/sdb       part                        4M
|-/dev/sdb2                 /dev/sdb2  /dev/sdb       part  xfs                   1G /boot
`-/dev/sdb3                 /dev/sdb3  /dev/sdb       part  LVM2_member       263.3G
  |-/dev/mapper/rhel00-root /dev/dm-0  /dev/sdb3      lvm   xfs                  50G /
  |-/dev/mapper/rhel00-swap /dev/dm-1  /dev/sdb3      lvm   swap                  4G [SWAP]
  `-/dev/mapper/rhel00-home /dev/dm-2  /dev/sdb3      lvm   xfs               209.3G /home
/dev/sdc                    /dev/sdc             usb  disk                      239G
`-/dev/sdc1                 /dev/sdc1  /dev/sdc       part  ext3                239G /mnt/extusb
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    I made a rescue + back up on a USB stick and then moved the stick to
    another machine to discover that the stick was not bootable.</li>
<li>Workaround, if any:<br />
    My objective is to create a clone of one of our systems so that I
    can reorganize the underlying hardware. The first step I've taken is
    to attempt to create a self-contained bootable copy of the system
    using REAR and then restore that into a newly configured LPAR on a
    different box but even though it says it's creating something
    bootable it isn't. What am I doing wrong?</li>
<li>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</li>
</ul>
<!-- -->

<pre><code>[root@crcossr2 /]# !987
TMPDIR=/mnt/rear/tmp rear -d mkbackup
Relax-and-Recover 2.5-git.3693.da115e6.master / 2020-03-18
Running rear mkbackup (PID 30537)
Using log file: /var/log/rear/rear-crcossr2.log
Using backup archive '/mnt/rear/tmp/rear.ubSlLS32FHSikLD/outputfs/rear/crcossr2/20200318.0948/backup.tar.gz'
Using autodetected kernel '/boot/vmlinuz-3.10.0-957.10.1.el7.ppc64le' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /var/lib/rear/layout/disklayout.conf
Using guessed bootloader 'PPC' (found PPC PreP boot partition 'ID=0x41' on /dev/sdb)
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
Creating recovery system root filesystem skeleton layout
Handling network interface 'bond0'
bond0 is a bond
bond0 has lower interface enP2p1s0
enP2p1s0 is a physical device
bond0 has lower interface enp1s0
enp1s0 is a physical device
Handled network interface 'bond0'
Copying logfile /var/log/rear/rear-crcossr2.log into initramfs as '/tmp/rear-crcossr2-partial-2020-03-18T09:48:32-0600.log'
Copying files and directories
Copying binaries and libraries
Copying all kernel modules in /lib/modules/3.10.0-957.10.1.el7.ppc64le (MODULES contains 'all_modules')
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/mtab' target '/proc/43017/mounts' on /proc/ /sys/ /dev/ or /run/
Symlink '/usr/lib/modules/3.10.0-957.10.1.el7.ppc64le/build' -&gt; '/usr/src/kernels/3.10.0-957.10.1.el7.ppc64le' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/src/kernels/3.10.0-957.10.1.el7.ppc64le' via the 'COPY_AS_IS' configuration variable.
Symlink '/usr/lib/modules/3.10.0-957.10.1.el7.ppc64le/source' -&gt; '/usr/src/kernels/3.10.0-957.10.1.el7.ppc64le' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/src/kernels/3.10.0-957.10.1.el7.ppc64le' via the 'COPY_AS_IS' configuration variable.
Broken symlink '/usr/lib/modules/3.10.0-957.10.1.el7.ppc64le/weak-updates/tracedev.ko' in recovery system because 'readlink' cannot determine its link target
Testing that the recovery system in /mnt/rear/tmp/rear.ubSlLS32FHSikLD/rootfs contains a usable system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (94964554 bytes) in 17 seconds
Making backup (using backup method NETFS)
Creating tar archive '/mnt/rear/tmp/rear.ubSlLS32FHSikLD/outputfs/rear/crcossr2/20200318.0948/backup.tar.gz'
Archived 12829 MiB [avg 7559 KiB/sec] OK
WARNING: tar ended with return code 1 and below output:
  ---snip---
  tar: /var/ct/b5564e44-47f4-486f-a875-0a1e1c8a129d/soc/mc/RMIBM.MgmtDomainRM.0: socket ignored
  tar: /var/ct/b5564e44-47f4-486f-a875-0a1e1c8a129d/soc/mc/RMIBM.HostRM.0: socket ignored
  tar: /opt/IBM/zimon/data/1/data_000014.dat: file changed as we read it
  ----------
This means that files have been modified during the archiving
process. As a result the backup may not be completely consistent
or may not be a perfect copy of the system. Relax-and-Recover
will continue, however it is highly advisable to verify the
backup in order to be sure to safely recover this system.

Archived 12829 MiB in 1739 seconds [avg 7554 KiB/sec]
Exiting rear mkbackup (PID 30537) and its descendant processes ...
Running exit tasks
You should also rm -Rf /mnt/rear/tmp/rear.ubSlLS32FHSikLD
</code></pre>
<h4 id="pcahyna_commented_at_2020-03-18_1952"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600827734">2020-03-18 19:52</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-18_1952" title="Permanent link">&para;</a></h4>
<p>@rmetrich is that supposed to work?</p>
<h4 id="rmetrich_commented_at_2020-03-18_1955"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600829213">2020-03-18 19:55</a>:<a class="headerlink" href="#rmetrich_commented_at_2020-03-18_1955" title="Permanent link">&para;</a></h4>
<p>I think the issue is with</p>
<pre><code>tar: /opt/IBM/zimon/data/1/data_000014.dat: file changed as we read it
</code></pre>
<h4 id="mmetts_commented_at_2020-03-18_1956"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600829601">2020-03-18 19:56</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_1956" title="Permanent link">&para;</a></h4>
<p>I thought so. I'm trying to make something that I can boot and then
restore on different hardware w/o any network needed. It was my belief
that what I put in /etc/rear/local.conf would give me a bootable USB but
it definitely isn't. Even a bootable ISO that's not expecting NFS would
be okay. I just need to be able to restore the system using something
self-contained - i.e. - no network. Also, the hardware arrangement will
be slightly different so it would good to be able to specify which disk
the restore is going to.</p>
<h4 id="mmetts_commented_at_2020-03-18_1957"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600830089">2020-03-18 19:57</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_1957" title="Permanent link">&para;</a></h4>
<p>How so @rmetrich ? that's just an incidental thing. Are you saying that
that warning caused it to not create the bootable media? This is a live
production system I'm working with. Is there a way to get it to ignore
that and proceed?</p>
<h4 id="mmetts_commented_at_2020-03-18_2017"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600838126">2020-03-18 20:17</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_2017" title="Permanent link">&para;</a></h4>
<p>For example, shouldn't there be a PreP partition here:</p>
<pre><code>[root@crcossr2 extusb]# parted /dev/sdc u s p
Model: Samsung Flash Drive (scsi)
Disk /dev/sdc: 501253132s
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End         Size        Type     File system  Flags
 1      16384s  501252095s  501235712s  primary  ext3         boot

[root@crcossr2 extusb]#
</code></pre>
<h4 id="rmetrich_commented_at_2020-03-18_2054"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600853417">2020-03-18 20:54</a>:<a class="headerlink" href="#rmetrich_commented_at_2020-03-18_2054" title="Permanent link">&para;</a></h4>
<p>@schabrolles may help here, since he knows PPC64 well and also has
access to hardware, something I don't.</p>
<h4 id="mmetts_commented_at_2020-03-18_2213"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600885084">2020-03-18 22:13</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_2213" title="Permanent link">&para;</a></h4>
<p>thanks, @rmetrich hi @schabrolles I have a RHEL 7.6 PPCle server with a
botched root volume group. the guys who built it were supposed to create
a RAID1 disk in hardware or create an LVM RAID1 root vg. they did
neither. so this is a production machine running on one drive with the
other drive just sitting there. I've been urged not to attempt to turn
the root vg into a LVM RAID1 vg as (I'm told) that's just not the Linux
way and it's not reliable. the consequence is that I would like to take
a backup of this server, wipe the drives, create a RAID1 volume in
hardware and then restore the system. the stage I'm at is I'm just
trying take a backup and then do a test restore into a test LPAR I have
prepared on another Power8 box. we already tried NFS but that approach
assumes you're restoring the real machine and I'd have to take the real
machine off the network - and I don't want to do that just for a test
restore. the root vg is too big to fit into a single 4 GB ISO so now
I've tried the USB approach which suggests that it will create a
bootable USB with the backup onboard but it won't boot and moreover the
structure of the partitions on the device don't look (to me) like a PPC
arrangement. please see above. would love to get your thoughts. I'm
trying my best to test this fully on a test LPAR before actually
committing to wiping the system. thanks.</p>
<h4 id="pcahyna_commented_at_2020-03-18_2343"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600911808">2020-03-18 23:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-18_2343" title="Permanent link">&para;</a></h4>
<p>@mmetts if ReaR supported more than 4 GB ISO would it be an option for
you to use it instead of USB?</p>
<h4 id="mmetts_commented_at_2020-03-18_2348"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600913039">2020-03-18 23:48</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_2348" title="Permanent link">&para;</a></h4>
<p>yes. I'm actually trying that now with xorriso ... which as I understand
it supports &gt; 4 GB ISOs. this thing is about 13 GB so I'm not really
sure what that'll mean but giving it a try. If SMS will boot from it and
restore the system then cool. otherwise, the USB things seems like it's
broken. the logs comments that sure make it sound like it's creating a
bootable USB but it not a PPCle bootable in the end. maybe some steps
are missing in USB mode because I does indeed create a PPCle bootable
ISO. we've tried that with the NFS approach but we're prepared to let
the test LPAR take over the network identity of the real system so we
stopped there.</p>
<h4 id="pcahyna_commented_at_2020-03-18_2350"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600913525">2020-03-18 23:50</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-18_2350" title="Permanent link">&para;</a></h4>
<p>@mmetts we added xorriso to RHEL 7.7 exactly for that.
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1462189">https://bugzilla.redhat.com/show_bug.cgi?id=1462189</a>
. But it does not work on ppc64le:
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1726043">https://bugzilla.redhat.com/show_bug.cgi?id=1726043</a>
. I suppose fixing this would be possible.</p>
<h4 id="mmetts_commented_at_2020-03-18_2352"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600914119">2020-03-18 23:52</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-18_2352" title="Permanent link">&para;</a></h4>
<p>how? I really need this to work. btw, I'm running RHEL 7.6 PPCle and
RearR 1.25 at the moment.</p>
<h4 id="pcahyna_commented_at_2020-03-18_2357"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600915181">2020-03-18 23:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-18_2357" title="Permanent link">&para;</a></h4>
<p>I mentioned that in
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1726043#c2">https://bugzilla.redhat.com/show_bug.cgi?id=1726043#c2</a>
... mkisofs invocation on ppc64le is different and I think it is missing
some option.</p>
<h4 id="pcahyna_commented_at_2020-03-19_0003"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600916882">2020-03-19 00:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_0003" title="Permanent link">&para;</a></h4>
<p>the relevant file is
/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh</p>
<h4 id="mmetts_commented_at_2020-03-19_0004"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600917209">2020-03-19 00:04</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_0004" title="Permanent link">&para;</a></h4>
<p>ok. so I just need to add '-iso-level 3' to the invocation of mkisofs in
that file?</p>
<h4 id="pcahyna_commented_at_2020-03-19_0006"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600917688">2020-03-19 00:06</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_0006" title="Permanent link">&para;</a></h4>
<p>I suppose so, but I haven't tested it. Also, you need to have xorriso
installed, IIRC ReaR uses it automatically, it prefers it over
mkisofs/genisoimage.</p>
<h4 id="mmetts_commented_at_2020-03-19_0006"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600917811">2020-03-19 00:06</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_0006" title="Permanent link">&para;</a></h4>
<p>yes. have installed.</p>
<h4 id="mmetts_commented_at_2020-03-19_0011"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600919067">2020-03-19 00:11</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_0011" title="Permanent link">&para;</a></h4>
<p>okay. I have made this change and I'm giving it a try. I should know
something in about 25 minutes or so.</p>
<h4 id="pcahyna_commented_at_2020-03-19_0014"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600919773">2020-03-19 00:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_0014" title="Permanent link">&para;</a></h4>
<p>that bug manifested already when creating an image, but if that
succeeds, try booting it and recovering as well in case there are other
unrelated problems.</p>
<h4 id="mmetts_commented_at_2020-03-19_0017"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600920728">2020-03-19 00:17</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_0017" title="Permanent link">&para;</a></h4>
<p>absolutely. my plan is to test this completely on before using it for my
original purpose described above. Thanks for your help thus far.</p>
<h4 id="pcahyna_commented_at_2020-03-19_0029"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-600924407">2020-03-19 00:29</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_0029" title="Permanent link">&para;</a></h4>
<p>@mmetts yw, I won't help you more today, I am going to sleep</p>
<h4 id="schabrolles_commented_at_2020-03-19_0758"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601039367">2020-03-19 07:58</a>:<a class="headerlink" href="#schabrolles_commented_at_2020-03-19_0758" title="Permanent link">&para;</a></h4>
<p>@mmetts It will be difficult for me to help you as we are forced to work
from home due to covid-19, so I can't have physical access to systems.
On top of that I'm working on client engagement which use almost all my
time...</p>
<p>Anyway, correct me if I'm wrong:</p>
<ul>
<li>you want to be able to test the backup of you system on a new
    created LPAR.</li>
<li>you would like to have USB or BIG ISO to test it because you have to
    disconnect the new LPAR from the network to avoid IP conflict during
    recovery (that's why you avoid NFS)</li>
</ul>
<p>In the different test I made, NFS is the best choice... but I understand
your concerns here... did you try the rear <strong>IP migration</strong> process
described in the faq
(<a href="http://relax-and-recover.org/documentation/faq">http://relax-and-recover.org/documentation/faq</a>).
This should allow to recover a system with a different IP address and
then may be helpful in your case (if I well understood your problem)</p>
<p>I personally never try it recently. @jsmeix do you know if this is still
working with the current rear version ?</p>
<h4 id="jsmeix_commented_at_2020-03-19_1140"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601132633">2020-03-19 11:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-19_1140" title="Permanent link">&para;</a></h4>
<p>@mmetts<br />
I did not yet read the details here so for now only some general infos:</p>
<p>Because I notice here things like "restore on different hardware"<br />
and "changing IP address" you may have a look at<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-595149640">https://github.com/rear/rear/issues/2310#issuecomment-595149640</a></p>
<p>In general regarding using a (USB) disk for ReaR see<br />
<a href="https://github.com/rear/rear/issues/1854">https://github.com/rear/rear/issues/1854</a></p>
<p>I know nothing about booting on POWER architecture<br />
in particular I don't know if POWER systems can boot<br />
"as usual" from USB, cf. the section<br />
"Non PC compatible architectures" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>@schabrolles<br />
I am afraid I do not understand the "IP Migration" section.<br />
But it does not mean anything when I do not understand networking
stuff<br />
because I am not at all a networking expert.</p>
<p>In general regarding "changing IP address" and ReaR<br />
there are two different things:<br />
Specifying the IP address of the ReaR recovery system<br />
versus<br />
changing the IP address of the recreated target system<br />
compared to what it was on the original system.</p>
<p>By default the IP address of the ReaR recovery system<br />
is the same as the IP address of the original system.</p>
<p>This leads to conflicts when the ReaR recovery system<br />
is booted (e.g. for a test) while the original system is still running.</p>
<p>Therefore I use always DHCP for my ReaR recovery systems<br />
via <code>USE_DHCLIENT=yes</code> cf. the dhcp related entries in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2583">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2583</a></p>
<p>Alternatively one can specify the IP address of the ReaR recovery
system<br />
via kernel command line parameters as described in the section<br />
"RESCUE IMAGE KERNEL COMMAND LINE OPTIONS" in "man rear"<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a></p>
<p>Regarding changing the IP address of the recreated target system<br />
compared to what it was on the original system we have currently<br />
<a href="https://github.com/rear/rear/issues/2310">https://github.com/rear/rear/issues/2310</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/2312">https://github.com/rear/rear/issues/2312</a></p>
<p>Finally:<br />
I am currently also forced to work from home and here I have only<br />
a rather limited computer where I cannot run virtual machines<br />
in a reasonably useful way for ReaR so that currently I cannot<br />
reproduce anything with ReaR from home.</p>
<h4 id="jsmeix_commented_at_2020-03-19_1157"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601138672">2020-03-19 11:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-19_1157" title="Permanent link">&para;</a></h4>
<p>@mmetts<br />
an offhanded general thought about "BIG ISO" and things like that:</p>
<p>I wonder why your things get so big.</p>
<p>I guess because you have all your data in one same backup<br />
and you have that backup in the ISO or on the USB medium.</p>
<p>If yes, why do you need to have all your data in one same backup<br />
when all what ReaR should actually do (and what it is meant to do)<br />
is to recreate the basic operating system (in your case RHEL 7.7)<br />
but not application data like huge databases and things like that, cf.<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Basics">https://en.opensuse.org/SDB:Disaster_Recovery#Basics</a><br />
and see also<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/11-multiple-backups.adoc</a></p>
<p>At least for your initial tests I recommend to keep things small,<br />
cf. the sections<br />
"Relax-and-Recover versus backup and restore"<br />
and<br />
"First steps with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>First try to get your basic operating system recreated.<br />
Then you can as a second step think about how to<br />
move the "big data" into the new recreated system.</p>
<h4 id="pcahyna_commented_at_2020-03-19_1231"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601152137">2020-03-19 12:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_1231" title="Permanent link">&para;</a></h4>
<p>@jsmeix @mmetts good remark! IMO the warnings from tar about</p>
<pre><code>  tar: /var/ct/b5564e44-47f4-486f-a875-0a1e1c8a129d/soc/mc/RMIBM.MgmtDomainRM.0: socket ignored
  tar: /var/ct/b5564e44-47f4-486f-a875-0a1e1c8a129d/soc/mc/RMIBM.HostRM.0: socket ignored
  tar: /opt/IBM/zimon/data/1/data_000014.dat: file changed as we read it
</code></pre>
<p>indicate that there are files being included in the backup that are not
part of the base OS. Especially the last one means that the backup of
<code>/opt/IBM/zimon/data/1/data_000014.dat</code> will probably be not usable and
you need some other way to migrate those data. This means that you could
exclude those files from the backup completely and save some space.</p>
<h4 id="jsmeix_commented_at_2020-03-19_1253"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601161232">2020-03-19 12:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-19_1253" title="Permanent link">&para;</a></h4>
<p>@mmetts<br />
in general regarding "to specify which disk the restore is going to"
see<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<p>What "rear recover" does by default is to recreate the disk layout<br />
so that on the replacement hardware <code>lsblk</code> should show<br />
basically the same as it was on the original system - except<br />
possibly changed kernel device names in particular for higher<br />
level storage objects where their kernel block device nodes<br />
are not stable, e.g. kernel block device nodes for LVM LVs, cf.<br />
<a href="https://github.com/rear/rear/pull/2291#issuecomment-567933705">https://github.com/rear/rear/pull/2291#issuecomment-567933705</a></p>
<p>When you need to change the disk layout on the recreated system<br />
compared to what it was on the original system you must manually<br />
adapt your var/lib/rear/layout/disklayout.conf file which could be a<br />
rather laborious process when you need to do major changes.</p>
<p>See in particular the MIGRATION_MODE section in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L351">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L351</a><br />
and the subsequent section about<br />
"Resizing partitions in MIGRATION_MODE during 'rear recover'"<br />
which contains in particular this small little sentence<br />
"This does not resize volumes on top of the affected partitions"<br />
which means that LVM things are not automatically resized.</p>
<p>So things are probably much easier when your replacement hardware<br />
has same number of disks ideally with each one exact same size<br />
or at most a bit bigger disk sizes,<br />
see default.conf (cf. above) how the autoresize things behave.</p>
<h4 id="mmetts_commented_at_2020-03-19_1515"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601236423">2020-03-19 15:15</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_1515" title="Permanent link">&para;</a></h4>
<p>I have successfully restored a "big ISO" into a test LPAR with no
network connection and limited resources. the ISO is about 10 GB. in the
next phase of testing, I will expand the resources dedicated to the test
LPAR (memory and CPU) to a reasonable level, add 2 NICs, temporarily
shutdown the source production LPAR (it's part of a redundant pair) and
see if what I've created is sound/functional enough to act in it's
place. it at least boots consistently. thanks to all of you for you help
thus far. I'll keep going and report back.</p>
<h4 id="pcahyna_commented_at_2020-03-19_1701"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601299522">2020-03-19 17:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-19_1701" title="Permanent link">&para;</a></h4>
<p>@mmetts wow great, thanks for the report, can you please send a patch so
we can see the exact change you made?</p>
<h4 id="mmetts_commented_at_2020-03-19_1927"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601375041">2020-03-19 19:27</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-19_1927" title="Permanent link">&para;</a></h4>
<p>I'm not sure how to write a patch. I changed line 20 of this file
/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh from
this:</p>
<pre><code>$ISO_MKISOFS_BIN $v 
$ISO_MKISOFS_OPTS -o "$ISO_DIR/$ISO_PREFIX.iso" \
    -U $chrp_boot_option -R -J -volid "$ISO_VOLID" -v -graft-points \
    "${ISO_FILES[@]}" &gt;&amp;2
</code></pre>
<p>to this:</p>
<pre><code>$ISO_MKISOFS_BIN $v 
$ISO_MKISOFS_OPTS -o "$ISO_DIR/$ISO_PREFIX.iso" -iso-level 3\
    -U $chrp_boot_option -R -J -volid "$ISO_VOLID" -v -graft-points \
    "${ISO_FILES[@]}" &gt;&amp;2
</code></pre>
<p>I am running RHEL 7.6 PPCle. I clone the current version of ReaR,
created an RPM and installed it. I then installed xorriso from EPEL.
This is what my /etc/rear/local.conf looks like:</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=null
BACKUP=NETFS
BACKUP_URL="iso:///backup"
ISO_DIR="/mnt/rear"
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/mnt' '/gpfs' '/media' '/projects' '/var/tmp' '/var/crash')
#NETFS_KEEP_OLD_BACKUP_COPY=
</code></pre>
<p>This was my invocation:</p>
<pre><code># TMPDIR=/mnt/rear/tmp rear -d mkbackup
</code></pre>
<p>I messed with TMPDIR because the LPAR does not have enough free space in
the root file system to hold the tar file.</p>
<p>And that's pretty much it.</p>
<h4 id="pcahyna_commented_at_2020-03-20_1012"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601622856">2020-03-20 10:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-20_1012" title="Permanent link">&para;</a></h4>
<p>@mmetts thanks!</p>
<h4 id="jsmeix_commented_at_2020-03-20_1134"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601655379">2020-03-20 11:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-20_1134" title="Permanent link">&para;</a></h4>
<p>@mmetts<br />
as far as I see all what you changed in<br />
usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh<br />
was to add the option <code>-iso-level 3</code> directly in the script.<br />
But the code<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh#L20">https://github.com/rear/rear/blob/master/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh#L20</a><br />
contains the <code>ISO_MKISOFS_OPTS</code> config variable<br />
so that it should have also worked when you specifiy its value<br />
as you need it in your particular case in your loval.conf like</p>
<pre><code>ISO_MKISOFS_OPTS="-iso-level 3"
</code></pre>
<p>see the <code>OUTPUT=ISO</code> section in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L616">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L616</a><br />
therein in particular the ISO_MKISOFS_BIN and ISO_MKISOFS_OPTS<br />
variables.</p>
<p>A general side note regarding xorriso cf.<br />
<a href="https://github.com/rear/rear/issues/1360">https://github.com/rear/rear/issues/1360</a></p>
<p>Another issue I found that might be related is<br />
<a href="https://github.com/rear/rear/issues/2243">https://github.com/rear/rear/issues/2243</a><br />
therein I noticed in particular<br />
<a href="https://github.com/rear/rear/issues/2243#issuecomment-537354570">https://github.com/rear/rear/issues/2243#issuecomment-537354570</a></p>
<p>And regarding USB and ISO at least on x86 architecture we have<br />
<a href="https://github.com/rear/rear/issues/2210">https://github.com/rear/rear/issues/2210</a></p>
<p>Regarding<br />
"I clone the current version of ReaR, created an RPM and installed it"<br />
see also the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
I think this way it is simpler at least during testing phase.</p>
<h4 id="pcahyna_commented_at_2020-03-20_2317"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601949828">2020-03-20 23:17</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-20_2317" title="Permanent link">&para;</a></h4>
<blockquote>
<p>as far as I see all what you changed in<br />
usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh<br />
was to add the option <code>-iso-level 3</code> directly in the script.<br />
But the code<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh#L20">https://github.com/rear/rear/blob/master/usr/share/rear/output/ISO/Linux-ppc64le/820_create_iso_image.sh#L20</a><br />
contains the <code>ISO_MKISOFS_OPTS</code> config variable<br />
so that it should have also worked when you specifiy its value<br />
as you need it in your particular case in your loval.conf like</p>
<pre><code>ISO_MKISOFS_OPTS="-iso-level 3"
</code></pre>
<p>see the <code>OUTPUT=ISO</code> section in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L616">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L616</a><br />
therein in particular the ISO_MKISOFS_BIN and ISO_MKISOFS_OPTS<br />
variables.</p>
</blockquote>
<p>@jsmeix thanks, I would consider this only a workaround. The i386
counterpart has the option:
<a href="https://github.com/rear/rear/blob/9795b703a29be04bd575d411e758fc4d8b417b43/usr/share/rear/output/ISO/Linux-i386/820_create_iso_image.sh#L33">https://github.com/rear/rear/blob/9795b703a29be04bd575d411e758fc4d8b417b43/usr/share/rear/output/ISO/Linux-i386/820_create_iso_image.sh#L33</a></p>
<p>so the ppc64le script should have it as well, for symmetry.</p>
<p>Thanks for the reference to other issues, #2243 is helpful, I was not
sure whether one can simply dd the image to a disk on PowerPC and boot
from it.</p>
<h4 id="mmetts_commented_at_2020-03-20_2353"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-601957729">2020-03-20 23:53</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-20_2353" title="Permanent link">&para;</a></h4>
<p>I have successfully, taken an ISO image of another PPC64le machine (the
~identical twin of the one I started this effort talking about) but this
time I just specified</p>
<pre><code>ISO_MKISOFS_OPTS="-iso-level 3"
</code></pre>
<p>in /etc/rear/local.conf ... and ISO creation worked just fine. so no
need for my earlier hack. BTW, at the risk of bringing up a different
topic, when I did my test restore of this machine, I encountered a
script failure due to the fact that it found physical volumes with
identical UUIDs. this was the case because the volume being presented to
the LPAR is on SAN and so the ReaR script is puking because it doesn't
understand a multi-path device. essentially, it fails to create the RHEL
volume group because when an attempt is made to add PVs to it, it throws
an error saying there are duplicates. I got around this by hacking the
script putting these 3 lines at the top:</p>
<pre><code>echo 1 &gt; /sys/block/sdb/device/delete
echo 1 &gt; /sys/block/sdc/device/delete
echo 1 &gt; /sys/block/sdd/device/delete
</code></pre>
<p>... and then it worked (I was installing on /dev/sda). I realize this
might seem whacky but I think it would be handy if the ReaR restore
functions could tolerate a multi-path device on the target machine even
if they weren't in use on the source. otherwise, you end up with this
conundrum which is really a non-problem. i.e. - there aren't multiple
disks with the same UUID ... rather it's the same disk seen through 4
paths. anyway, I'm a very happy ReaR customer so please don't take these
as complaints. ReaR is on the verge of allowing us to correct a totally
egregious error committed by an erstwhile vendor of ours. cheers!</p>
<h4 id="schabrolles_commented_at_2020-03-21_0803"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602011593">2020-03-21 08:03</a>:<a class="headerlink" href="#schabrolles_commented_at_2020-03-21_0803" title="Permanent link">&para;</a></h4>
<p>@mmetts</p>
<p>You should add the following into your local.conf</p>
<pre><code>AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
</code></pre>
<p>There is some configuration example here:
<a href="https://www.slideshare.net/sebastienchabrolles/relax-and-recover-on-power-updated-052017">https://www.slideshare.net/sebastienchabrolles/relax-and-recover-on-power-updated-052017</a></p>
<h4 id="pcahyna_commented_at_2020-03-21_1110"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602028439">2020-03-21 11:10</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-21_1110" title="Permanent link">&para;</a></h4>
<blockquote>
<p>and ISO creation worked just fine. so no need for my earlier hack.</p>
</blockquote>
<p>I still intend to add it to the script, so that it works for everyone
without having to specify it in the configuration. Unless there is a
potential problem with it - @schabrolles @rmetrich is there a risk that
OpenFirmware would not understand DVDs created with this option?</p>
<h4 id="schabrolles_commented_at_2020-03-21_1140"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602032249">2020-03-21 11:40</a>:<a class="headerlink" href="#schabrolles_commented_at_2020-03-21_1140" title="Permanent link">&para;</a></h4>
<p>@pcahyna, Honestly, I don't know ... but I would say if it works fo
@mmetts, then I think it is OK and means that OpenFirmware is able to
handle it ... As it is a ISO image used as VirtualDVD there is no need
to limit it to 4GB because we don't have to burn it on real physical
media ...</p>
<h4 id="pcahyna_commented_at_2020-03-21_1209"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602035325">2020-03-21 12:09</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-21_1209" title="Permanent link">&para;</a></h4>
<p>@schabrolles well anyway the limit applies to the size of files in the
filesystem, not to the filesystem itself, IIUC. (The big file in this
case is backup.tar.gz)</p>
<h4 id="mmetts_commented_at_2020-03-21_1609"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602065967">2020-03-21 16:09</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-21_1609" title="Permanent link">&para;</a></h4>
<p>thanks @schabrolles ! I'll likely give those options a try. there has
been a super helpful discussion. I really appreciate everyones comments.</p>
<h4 id="pcahyna_commented_at_2020-03-21_2058"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602103855">2020-03-21 20:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-21_2058" title="Permanent link">&para;</a></h4>
<p>@mmetts this is POWER7 ? Or POWER8 ?</p>
<h4 id="mmetts_commented_at_2020-03-21_2204"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602111187">2020-03-21 22:04</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-21_2204" title="Permanent link">&para;</a></h4>
<p>Power8. Source systems are dedicated LPARs (i.e. - no VIOs) on a pair of
IBM S822s. the target test LPAR is on an IBM 824. the source systems
each have a pair of in-frame SAS drives with one dangling doing nothing
in ... hence the reason for this exercise ... we're going to wipe them
one at a time creating a hardware-based RAID1 device and then restore.
The test LPAR has one 300 GB LUN on one of our storage devices since we
didn't have any in-frame disk space on the S824 to provision for
testing.</p>
<h4 id="jsmeix_commented_at_2020-03-23_1023"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602507147">2020-03-23 10:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-23_1023" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your<br />
<a href="https://github.com/rear/rear/issues/2344#issuecomment-601949828">https://github.com/rear/rear/issues/2344#issuecomment-601949828</a><br />
I did<br />
<a href="https://github.com/rear/rear/pull/2346">https://github.com/rear/rear/pull/2346</a></p>
<h4 id="jsmeix_commented_at_2020-03-23_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602518127">2020-03-23 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-23_1047" title="Permanent link">&para;</a></h4>
<p>A general comment regarding<br />
<a href="https://github.com/rear/rear/issues/2344#issuecomment-602032249">https://github.com/rear/rear/issues/2344#issuecomment-602032249</a></p>
<p>I guess nowadays ISO images are in most cases no longer<br />
burnt on physical medium but used as a virtual medium<br />
so the default ReaR options should be for the<br />
usual "ISO used as virtual medium" use case<br />
BUT<br />
in general I do not like hardcoded options in the scripts<br />
except standard options that always work reliably<br />
because editing scripts is not the preferred way<br />
how users should set up their ReaR things<br />
SO<br />
in general default options should be in default.conf<br />
where the user is expected to recognize them<br />
and where he could more easily adjust them if needed<br />
(compared to editing scripts).</p>
<p>The question for <code>-iso-level 3</code> is whether or not that is<br />
a standard option that always works reliably.</p>
<p>The next question is what "always works reliably"<br />
should mean regarding the particular <code>-iso-level 3</code> option:</p>
<p>I think it does not belong to ReaR to guarantee<br />
that its ISO image can be burnt on a physical medium.</p>
<p>I think it is the user's task to check whether or not<br />
ReaR's ISO image can be burnt on his particular physical medium<br />
because ReaR cannot know what the user's particular physical medium<br />
will be e.g. a traditional CD or a DVD or something more modern.</p>
<p>I think in particular it is the user's task to check whether or not<br />
ReaR's ISO image is too big to be burnt on his particular physical
medium.</p>
<h4 id="pcahyna_commented_at_2020-03-23_1059"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602523277">2020-03-23 10:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-23_1059" title="Permanent link">&para;</a></h4>
<p>Is <code>-iso-level 3</code> in any way related to the ability to burn the image on
a medium? The option overcomes the limit which is there for single
files, not for the whole image IIUC, and maximum DVD size is usually
4.70 GB, so there are situations where one would benefit from the option
even when using a physical DVD. So I believe that the question whether
ReaR should guarantee that the ISO image can be burnt on a DVD is mostly
unrelated to the topic of <code>-iso-level 3</code>.</p>
<p>Moreover, from this conversation it appears that an ISO on ppc64 can be
used for hard disks and USB media, not only optical media. Which
supports the view that "it does not belong to ReaR to guarantee that its
ISO image can be burnt on a physical medium".</p>
<p>To enforce that the image fits onto a medium, <code>ISO_MAX_SIZE</code> seems
better suited.</p>
<h4 id="jsmeix_commented_at_2020-03-23_1202"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602550299">2020-03-23 12:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-23_1202" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I played around with <code>ISO_MAX_SIZE</code> and found its implementation<br />
seems to be somewhat "quick and ditry hack style", see the code for it
in<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L56">https://github.com/rear/rear/blob/master/usr/share/rear/backup/NETFS/default/500_make_backup.sh#L56</a><br />
which means that for ISO_MAX_SIZE &lt;= 200 things behave really
unexpected<br />
but also for ISO_MAX_SIZE &gt; 200 things do not work exactly as
expected.</p>
<p>I did "rear mkbackup" with <code>ISO_MAX_SIZE=100</code> and got a 232M first ISO.</p>
<p>The reason is that actually ISO_MAX_SIZE does not implement<br />
the maximum size of the ISO.<br />
Instead it implements the size of the chunks when a backup.tar.gz is
split<br />
cf.
<a href="https://github.com/rear/rear/pull/287">https://github.com/rear/rear/pull/287</a><br />
and
<a href="https://github.com/rear/rear/pull/292">https://github.com/rear/rear/pull/292</a></p>
<p>The first ISO contains additionally the recovery system kernel and
initrd<br />
plus the ISO bootloader stuff so it gets bigger than ISO_MAX_SIZE.</p>
<p>When I do "rear mkrescue" the ISO is 131M.<br />
This matches what I get for "rear mkbackup" with <code>ISO_MAX_SIZE=100</code><br />
because 131M recovery system + 100M backup chunk results 232M.</p>
<p>In general related to that is<br />
<a href="https://github.com/rear/rear/issues/2265">https://github.com/rear/rear/issues/2265</a></p>
<h4 id="mmetts_commented_at_2020-03-23_1418"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602624831">2020-03-23 14:18</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-23_1418" title="Permanent link">&para;</a></h4>
<p>I just want to reiterate that this got started when I tried to create a
bootable USB device for PPC64le but could not <em>and</em> not having or
wanting NFS as an option needed for a "big ISO" to work for me since I
was running out of handy options. I think there still might be something
to resolve WRT creating of bootable USB devices of any size for PPC64le.
Thanks.</p>
<h4 id="jsmeix_commented_at_2020-03-23_1448"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602643488">2020-03-23 14:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-23_1448" title="Permanent link">&para;</a></h4>
<p>As a first step regarding<br />
<a href="https://github.com/rear/rear/issues/2344#issuecomment-602550299">https://github.com/rear/rear/issues/2344#issuecomment-602550299</a><br />
I explained in more detail in default.conf how ISO_MAX_SIZE actually
works<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L644">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L644</a></p>
<h4 id="pcahyna_commented_at_2020-03-23_1641"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602718386">2020-03-23 16:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-23_1641" title="Permanent link">&para;</a></h4>
<p>@jsmeix sorry, I did not realize the limitations of ISO_MAX_SIZE.</p>
<p>@mmetts</p>
<blockquote>
<p>I just want to reiterate that this got started when I tried to create
a bootable USB device for PPC64le but could not</p>
</blockquote>
<p>yes, I realize we are hijacking an issue which was intended for
something else.</p>
<h4 id="mmetts_commented_at_2020-03-23_1646"><img src="https://avatars.githubusercontent.com/u/13579981?v=4" width="50"><a href="https://github.com/mmetts">mmetts</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602721504">2020-03-23 16:46</a>:<a class="headerlink" href="#mmetts_commented_at_2020-03-23_1646" title="Permanent link">&para;</a></h4>
<p>no worries, I'm as much to blame for changing the subject as anyone
since I just wanted to get my work done but it seems that the issue
itself remains.</p>
<h4 id="jsmeix_commented_at_2020-03-23_1918"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-602804259">2020-03-23 19:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-23_1918" title="Permanent link">&para;</a></h4>
<p>One more of the "hijacking this issue" things resulted in my<br />
<a href="https://github.com/rear/rear/pull/2347">https://github.com/rear/rear/pull/2347</a></p>
<p>@mmetts<br />
don't worry about us "hijacking your issue".<br />
I appreciate it that by the way your issue made us aware<br />
of some other minor things that do not work good enough<br />
so that we could "just improve them by the way".</p>
<h4 id="jsmeix_commented_at_2020-03-27_1350"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-605011428">2020-03-27 13:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-27_1350" title="Permanent link">&para;</a></h4>
<p>@mmetts<br />
regarding your<br />
"there still might be something to resolve WRT creating<br />
of bootable USB devices of any size for PPC64le" in<br />
<a href="https://github.com/rear/rear/issues/2344#issuecomment-602624831">https://github.com/rear/rear/issues/2344#issuecomment-602624831</a><br />
and<br />
"it seems that the issue itself remains" in<br />
<a href="https://github.com/rear/rear/issues/2344#issuecomment-602721504">https://github.com/rear/rear/issues/2344#issuecomment-602721504</a></p>
<p>I did<br />
<a href="https://github.com/rear/rear/issues/2348">https://github.com/rear/rear/issues/2348</a></p>
<p>Please have a look there if I described the issue correctly.<br />
I am not a PPC user so I may misunderstand things.</p>
<h4 id="github-actions_commented_at_2020-06-26_0139"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2344#issuecomment-649900599">2020-06-26 01:39</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-26_0139" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-03-18.2344.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
