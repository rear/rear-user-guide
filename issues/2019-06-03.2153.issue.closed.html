<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2153 Issue closed: Missing 'grubenv' after ReaR 2.5 recovery causes boot failure in RHEL 7 - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2153 Issue closed: Missing \u0027grubenv\u0027 after ReaR 2.5 recovery causes boot failure in RHEL 7";
        var mkdocs_page_input_path = "issues/2019-06-03.2153.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2153 Issue closed: Missing 'grubenv' after ReaR 2.5 recovery causes boot failure in RHEL 7</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2153_issue_closed_missing_grubenv_after_rear_25_recovery_causes_boot_failure_in_rhel_7"><a href="https://github.com/rear/rear/issues/2153">#2153 Issue</a> <code>closed</code>: Missing 'grubenv' after ReaR 2.5 recovery causes boot failure in RHEL 7<a class="headerlink" href="#2153_issue_closed_missing_grubenv_after_rear_25_recovery_causes_boot_failure_in_rhel_7" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>special hardware or VM</code></p>
<h4 id="prolly-brent_opened_issue_at_2019-06-03_1542"><img src="https://avatars.githubusercontent.com/u/51331636?v=4" width="50"><a href="https://github.com/prolly-brent">prolly-brent</a> opened issue at <a href="https://github.com/rear/rear/issues/2153">2019-06-03 15:42</a>:<a class="headerlink" href="#prolly-brent_opened_issue_at_2019-06-03_1542" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.5 / 2019-05-10</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    OS_VENDOR=RedHatEnterpriseServer<br />
    OS_VERSION=7.6</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>USER_INPUT_TIMEOUT=10
OUTPUT=ISO
OUTPUT_URL=cifs://thrnas01/TSSGeneral/Midrange/Linux/REAR/
OUTPUT_OPTIONS="credentials=/etc/rear/cifs,gid=816800513,file_mode=0660,dir_mode=0770"
BACKUP=NETFS
BACKUP_URL=cifs://thrnas01/TSSGeneral/Midrange/Linux/REAR/
BACKUP_OPTIONS="credentials=/etc/rear/cifs,gid=816800513,file_mode=0660,dir_mode=0770"
NETWORKING_PREPARATION_COMMANDS=( 'ip addr add 10.198.13.225/23 dev eno1' 'ip link set dev eno1 up' 'ip route add default via 10.198.12.1' 'return' )
ISO_PREFIX="rear-lnxtst2-2019-06-03"
BACKUP_PROG_ARCHIVE="rear-lnxtst2-2019-06-03-backup"
LOGFILE="$LOG_DIR/rear-lnxtst2-2019-06-03.log"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    BareMetal - HPE ProLiant DL380 Gen9</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI, GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    After successful rear recovery, can't boot the recovered image
    because the system can't locate the kernel. After further
    inspection, the following symbolic link (which is in the original
    image), is missing from the recovered image:</p>
</li>
</ul>
<!-- -->

<pre><code>/boot/grub2/grubenv -&gt; ../efi/EFI/redhat/grubenv
</code></pre>
<ul>
<li>
<p>Workaround, if any:<br />
    After successful recovery, go to the recovered image (before final
    boot) and create the symbolic link manually.</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
<a href="https://github.com/rear/rear/files/3248383/rear-lnxtst2.log.gz">rear-lnxtst2.log.gz</a></p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2019-06-04_0713"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498550978">2019-06-04 07:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-04_0713" title="Permanent link">&para;</a></h4>
<p>@prolly-brent<br />
had it worked before with ReaR 2.4?</p>
<p>If yes, I think it is related to my changes in<br />
<a href="https://github.com/rear/rear/pull/1843">https://github.com/rear/rear/pull/1843</a><br />
therein in particular this commit<br />
<a href="https://github.com/rear/rear/pull/1843/commits/32098b9add5eec20b28df8e7da26b785316961b8">https://github.com/rear/rear/pull/1843/commits/32098b9add5eec20b28df8e7da26b785316961b8</a><br />
where its commit message reads (excerpt):</p>
<pre><code>... move restored /boot/grub2/grubenv away by default
</code></pre>
<p>that is done via a change of BACKUP_RESTORE_MOVE_AWAY_FILES<br />
in usr/share/rear/conf/default.conf, see the comment in default.conf<br />
for the reason behind why the restored /boot/grub2/grubenv<br />
is moved away by default.</p>
<p>See also in<br />
<a href="http://relax-and-recover.org/documentation/release-notes-2-5">http://relax-and-recover.org/documentation/release-notes-2-5</a><br />
the entry</p>
<pre><code>Fixed, simplified, and enhanced GRUB2 installation on x86 and ppc64le architecture (issues #1828, #1845, #1847, #1437)
</code></pre>
<p>that lists some related GitHub issues.</p>
<p>To keep the restored /boot/grub2/grubenv<br />
set in your /etc/rear/local.conf file</p>
<pre><code>BACKUP_RESTORE_MOVE_AWAY_FILES=()
</code></pre>
<p>I got the information about the usage/meaning of the <code>grubenv</code> file<br />
from our (i.e. SUSE's) GRUB2 maintainer and if that description is
right<br />
a missing <code>/boot/grub2/grubenv -&gt; ../efi/EFI/redhat/grubenv</code> symlink<br />
or a missing <code>grubenv</code> file cannot cause a boot failure.</p>
<p>Simply put I think GRUB2 should always be able to boot a system<br />
without any information from a previous boot.</p>
<p>Accordingly I assume the root cause of your boot failure is not<br />
missing information from a previous boot but something else.</p>
<p>But I am not at all a bootloader or GRUB2 expert so I could be wrong<br />
and in some cases the <code>grubenv</code> file might be even mandatory<br />
for GRUB2 to be able to boot a system.</p>
<h4 id="jsmeix_commented_at_2019-06-04_0719"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498552753">2019-06-04 07:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-04_0719" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
I guess for you a RHEL7 system recovery with ReaR 2.5 booted o.k.?</p>
<h4 id="jsmeix_commented_at_2019-06-04_0725"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498554627">2019-06-04 07:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-04_0725" title="Permanent link">&para;</a></h4>
<p>@prolly-brent<br />
your <code>rear-lnxtst2.log.gz</code> is only about <code>rear -D mkbackup</code><br />
but what actually failed for you is <code>rear -D recover</code>.</p>
<p>Have a look at the section<br />
"Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
how to get a <code>rear -D recover</code> log file.</p>
<h4 id="prolly-brent_commented_at_2019-06-04_1354"><img src="https://avatars.githubusercontent.com/u/51331636?v=4" width="50"><a href="https://github.com/prolly-brent">prolly-brent</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498681818">2019-06-04 13:54</a>:<a class="headerlink" href="#prolly-brent_commented_at_2019-06-04_1354" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/3252693/rear-lnxtst2-2019-06-04.log.gz">rear-lnxtst2-2019-06-04.log.gz</a><br />
<a href="https://github.com/rear/rear/files/3252694/rear-lnxtst2.log.gz">rear-lnxtst2.log.gz</a></p>
<p>I updated the HP Proliant BIOS firmware to the latest level and ran the
recover again and was able to boot (or better said "able to locate the
kernel") after a rear recovery (even without the symlink in place).<br />
Per your request I attached the recover debug logs. I am a bit concerned
that this program is removing files that were put in place by the RHEL
installation and possible downstream negative effects of that. I will
look into using BACKUP_RESTORE_MOVE_AWAY_FILES to prevent this.
Thanks for the suggestions and assistance - much appreciated.</p>
<h4 id="jsmeix_commented_at_2019-06-04_1409"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498688227">2019-06-04 14:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-04_1409" title="Permanent link">&para;</a></h4>
<p>@prolly-brent<br />
<code>this program</code> (i.e. ReaR) even dares to modify files like /etc/fstab<br />
and lots of others e.g. to update UUIDs and things like that<br />
and - even more - <code>this program</code> recreates initrd and bootloader files<br />
from scratch anew and all that after the backup was restored - but
that<br />
is needed to get a consistent new recreated system without
old/outdated<br />
remainders from the original system that do no longer make sense<br />
or may even break the new recreated system.<br />
For details see the <code>finalize</code> scripts in ReaR.<br />
Cf. "Disaster recovery means installation (reinstalling from scratch)"
at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2019-06-05_0732"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2153#issuecomment-498971719">2019-06-05 07:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-05_0732" title="Permanent link">&para;</a></h4>
<p>According to<br />
<a href="https://github.com/rear/rear/issues/2153#issuecomment-498681818">https://github.com/rear/rear/issues/2153#issuecomment-498681818</a><br />
this issue does no longer happen after a firmware update.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-06-03.2153.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
