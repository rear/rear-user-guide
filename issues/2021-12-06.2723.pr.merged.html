<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2723 PR merged: fixed pxe file cp and permissions for sshfs target - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2723 PR merged: fixed pxe file cp and permissions for sshfs target";
        var mkdocs_page_input_path = "issues/2021-12-06.2723.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2723 PR merged: fixed pxe file cp and permissions for sshfs target</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2723_pr_merged_fixed_pxe_file_cp_and_permissions_for_sshfs_target"><a href="https://github.com/rear/rear/pull/2723">#2723 PR</a> <code>merged</code>: fixed pxe file cp and permissions for sshfs target<a class="headerlink" href="#2723_pr_merged_fixed_pxe_file_cp_and_permissions_for_sshfs_target" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="devil0000_opened_issue_at_2021-12-06_1352"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> opened issue at <a href="https://github.com/rear/rear/pull/2723">2021-12-06 13:52</a>:<a class="headerlink" href="#devil0000_opened_issue_at_2021-12-06_1352" title="Permanent link">&para;</a></h4>
<ul>
<li>Type: <strong>Bug Fix</strong></li>
<li>Impact: <strong>Normal</strong></li>
<li>How was this pull request tested?</li>
</ul>
<!-- -->

<pre><code>OUTPUT=PXE
OUTPUT_PREFIX_PXE=$HOSTNAME
PXE_TFTP_PREFIX=$HOSTNAME.
PXE_TFTP_URL=sshfs://wingcon@172.200.200.1/tmp/test
PXE_CONFIG_URL=sshfs://wingcon@172.200.200.1/tmp/test/
PXE_RECOVER_MODE="manual"
PXE_CREATE_LINKS="IP"

BACKUP=BORG
USB_DEVICE=/dev/disk/by-label/REAR-000
USB_DEVICE_FILESYSTEM_LABEL=REAR-000
USB_DEVICE_PARTED_LABEL=gpt
USB_DEVICE_FILESYSTEM=ext4
USB_UEFI_PART_SIZE="512"
CLONE_USERS=(root)
CLONE_GROUPS=(root)
CLONE_ALL_USERS_GROUPS="false"
BORGBACKUP_REPO="/borg"
BORGBACKUP_UMASK="0002"
BORGBACKUP_ENC_TYPE="repokey"
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
export TMPDIR="/wsp_var/tmp/"
USE_RESOLV_CONF="no"
USE_DHCLIENT=no
USE_STATIC_NETWORKING=1
USE_SERIAL_CONSOLE=y
COPY_KERNEL_PARAMETERS=( 'net.ifnames' 'biosdevname', 'console' )
REAR_INITRD_COMPRESSION="fast"
USING_UEFI_BOOTLOADER=1
USB_BOOTLOADER=grub
GRUB2_DEFAULT_BOOT="1"
MODULES=( 'no_modules' )
FIRMWARE_FILES=( 'no' )
EXCLUDE_RUNTIME_LOGFILE="yes"
</code></pre>
<ul>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
<li>
<p>prevent cp error "failed to preserve ownership" for sshfs</p>
</li>
<li>
<p>prevent issue with write permissions trying to override image on
    later runs</p>
</li>
</ul>
<p>Please note that atm PXE config is always written in syslinux style and
never for grub.</p>
<h4 id="jsmeix_commented_at_2021-12-07_1147"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-987851488">2021-12-07 11:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-12-07_1147" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
if someone of you is a PXE user or has good PXE knowledge<br />
could you please also have a look here if it looks OK to you?</p>
<h4 id="jsmeix_commented_at_2021-12-07_1148"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-987852440">2021-12-07 11:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-12-07_1148" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
thank you for your continuous fixes and improvements in various areas of
ReaR!<br />
It is much appreciated.</p>
<h4 id="jsmeix_commented_at_2021-12-09_0950"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-989684069">2021-12-09 09:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-12-09_0950" title="Permanent link">&para;</a></h4>
<p>I will merge it as is today afternoon.</p>
<h4 id="flunkyball_commented_at_2021-12-27_1359"><img src="https://avatars.githubusercontent.com/u/36796685?v=4" width="50"><a href="https://github.com/Flunkyball">Flunkyball</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1001581998">2021-12-27 13:59</a>:<a class="headerlink" href="#flunkyball_commented_at_2021-12-27_1359" title="Permanent link">&para;</a></h4>
<p>I just gave the fix a try however there is one issue occurring now:</p>
<p>The symlinks created on the sshfs share for either the IP or MAC of the
rear client are now pointing to "/rear-client" instead of "rear-client".
Hence the configuration is not found anymore.</p>
<h4 id="jsmeix_commented_at_2022-01-03_1348"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1004104196">2022-01-03 13:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-03_1348" title="Permanent link">&para;</a></h4>
<p>@Flunkyball<br />
I am not a PXE user so I cannot actually see or reproduce how it fails
now.</p>
<p>Could you provide a more detailed description how which symlinks and
files<br />
have been where before and where and how they are now as comparison?<br />
In particular how symlinks and files are on the original system and what
the<br />
<code>cp</code> commands result for them, cf. my findings about <code>cp -L</code> and
symlinks in<br />
<a href="https://github.com/rear/rear/issues/2677#issuecomment-997859219">https://github.com/rear/rear/issues/2677#issuecomment-997859219</a></p>
<p>Ideally could you show us what code changes based on the current master
code<br />
make it work again for you - i.e. not just reverting the changes of this
pull request<br />
but that the intent behind this pull request is still provided and also
that the symlinks<br />
are correct again.</p>
<h4 id="flunkyball_commented_at_2022-01-05_0919"><img src="https://avatars.githubusercontent.com/u/36796685?v=4" width="50"><a href="https://github.com/Flunkyball">Flunkyball</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1005511856">2022-01-05 09:19</a>:<a class="headerlink" href="#flunkyball_commented_at_2022-01-05_0919" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Sure, I just ran it again to show you the detailed output.</p>
<p>Used config:</p>
<pre><code>OUTPUT=PXE
OUTPUT_PREFIX_PXE=$HOSTNAME

PXE_TFTP_IP=XXX.XXX.XXX.XXX
PXE_TFTP_PREFIX=$HOSTNAME.
PXE_RECOVER_MODE="manual"
PXE_CREATE_LINKS=MAC
PXE_REMOVE_OLD_LINKS=y


######### VARIANT 1: NFS FOR COPYING FILES 
#PXE_TFTP_URL="nfs://$PXE_TFTP_IP/srv/pxe/tftp"
#PXE_CONFIG_URL="nfs://$PXE_TFTP_IP/srv/pxe/tftp/pxelinux.cfg"

######### VARIANT 2: SSHFS FOR COPYING FILES
PXE_TFTP_URL=sshfs://USERNAME@$PXE_TFTP_IP/tftp
PXE_CONFIG_URL=sshfs://USERNAME@$PXE_TFTP_IP/tftp/pxelinux.cfg


BACKUP=BAREOS
BAREOS_CLIENT=SOME-CIENT-fd
BAREOS_RESTORE_JOB=RestoreFiles-Full
BAREOS_FILESET=FS-Linux
</code></pre>
<p>Here is the comparison between variant 1 using NFS to copy the rear
information working as expected vs. variant 2 using sshfs resulting in a
wrong symlink:</p>
<p>VARIANT 1 (NFS):</p>
<pre><code>user@pxe:/srv/tftp/pxelinux.cfg# ls -l | grep "HOSTNAME"
lrwxrwxrwx 1 root root              14 Jan  4 21:01 01-01-01-01-01-01-4a -&gt; rear-HOSTNAME
lrwxrwxrwx 1 root root              14 Jan  4 21:01 01-01-01-01-01-01-8c -&gt; rear-HOSTNAME
lrwxrwxrwx 1 root root              14 Jan  4 21:01 01-01-01-01-01-01-4c -&gt; rear-HOSTNAME
-r--r--r-- 1 pxe  Domain Computers 898 Jan  4 21:01 rear-HOSTNAME
</code></pre>
<p>VARIANT 2 (SSHFS):</p>
<pre><code>user@pxe:/srv/tftp/pxelinux.cfg# ls -l | grep "HOSTNAME"
lrwxrwxrwx 1 pxe  Domain Computers  15 Jan  5 10:05 01-01-01-01-01-01-4a -&gt; /rear-HOSTNAME
lrwxrwxrwx 1 pxe  Domain Computers  15 Jan  5 10:05 01-01-01-01-01-01-8c -&gt; /rear-HOSTNAME
lrwxrwxrwx 1 pxe  Domain Computers  15 Jan  5 10:05 01-01-01-01-01-01-4c -&gt; /rear-HOSTNAME
-r--r--r-- 1 pxe  Domain Computers 898 Jan  4 21:01 rear-HOSTNAME
</code></pre>
<p>As you can see using SSHFS as transfermethod produces a wrong symlink
not corretly pointing to the "rear-HOSTNAME" folder within the same
directory. Hence The pxe startup is not successful because the rear
files are not found anymore.</p>
<h4 id="jsmeix_commented_at_2022-01-05_1324"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1005682793">2022-01-05 13:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-05_1324" title="Permanent link">&para;</a></h4>
<p>@Flunkyball<br />
I cannot reproduce it on my openSUSE Leap 15.3 homeoffice laptop<br />
where I use the '/nfs' directory locally as exported NFS share.</p>
<p>With etc/rear/local.conf for NFS</p>
<pre><code>OUTPUT=PXE
OUTPUT_PREFIX_PXE=$HOSTNAME
PXE_TFTP_IP=127.0.0.1
PXE_TFTP_PREFIX=$HOSTNAME.
PXE_RECOVER_MODE="manual"
PXE_CREATE_LINKS=MAC
PXE_REMOVE_OLD_LINKS=y
PXE_TFTP_URL="nfs://$PXE_TFTP_IP/nfs/pxe/tftp"
PXE_CONFIG_URL="nfs://$PXE_TFTP_IP/nfs/pxe/tftp/pxelinux.cfg"
#PXE_TFTP_URL="sshfs://rear@$PXE_TFTP_IP/nfs/pxe/tftp"
#PXE_CONFIG_URL="sshfs://rear@$PXE_TFTP_IP/nfs/pxe/tftp/pxelinux.cfg"
</code></pre>
<p>I get</p>
<pre><code>  4980737      4 drwxrwxrwx   3 root     root         4096 Jan  5 14:10 .
  4980738      4 drwxrwxrwx   4 root     root         4096 Jan  5 14:12 ./tftp
  4980739      4 drwxrwxrwx   2 root     root         4096 Jan  5 14:12 ./tftp/pxelinux.cfg
  4980744      4 -r--r--r--   1 nobody   nobody        933 Jan  5 14:12 ./tftp/pxelinux.cfg/rear-linux-h9wr
  4980747      0 lrwxrwxrwx   1 nobody   nobody         15 Jan  5 14:12 ./tftp/pxelinux.cfg/01-52-54-00-eb-ce-15 -&gt; rear-linux-h9wr
  4980745      0 lrwxrwxrwx   1 nobody   nobody         15 Jan  5 14:12 ./tftp/pxelinux.cfg/01-c8-cb-b8-41-16-f6 -&gt; rear-linux-h9wr
  4980746      0 lrwxrwxrwx   1 nobody   nobody         15 Jan  5 14:12 ./tftp/pxelinux.cfg/01-b6-70-fc-a3-41-08 -&gt; rear-linux-h9wr
  4980740      4 drwxr-xr-x   2 nobody   nobody       4096 Jan  5 14:12 ./tftp/linux-h9wr
  4980741   8852 -rw-r--r--   1 nobody   nobody    9062624 Jan  5 14:12 ./tftp/linux-h9wr/linux-h9wr.kernel
  4980743      4 -rw-r--r--   1 nobody   nobody        267 Jan  5 14:12 ./tftp/linux-h9wr/linux-h9wr.message
  4980742  67708 -rw-r--r--   1 nobody   nobody   69331494 Jan  5 14:12 ./tftp/linux-h9wr/linux-h9wr.initrd.cgz
</code></pre>
<p>With etc/rear/local.conf for sshfs</p>
<pre><code>OUTPUT=PXE
OUTPUT_PREFIX_PXE=$HOSTNAME
PXE_TFTP_IP=127.0.0.1
PXE_TFTP_PREFIX=$HOSTNAME.
PXE_RECOVER_MODE="manual"
PXE_CREATE_LINKS=MAC
PXE_REMOVE_OLD_LINKS=y
#PXE_TFTP_URL="nfs://$PXE_TFTP_IP/nfs/pxe/tftp"
#PXE_CONFIG_URL="nfs://$PXE_TFTP_IP/nfs/pxe/tftp/pxelinux.cfg"
PXE_TFTP_URL="sshfs://rear@$PXE_TFTP_IP/nfs/pxe/tftp"
PXE_CONFIG_URL="sshfs://rear@$PXE_TFTP_IP/nfs/pxe/tftp/pxelinux.cfg"
</code></pre>
<p>I get</p>
<pre><code># find . -ls
  5373953      4 drwxrwxrwx   3 root     root         4096 Jan  5 14:02 .
  5373954      4 drwxrwxrwx   4 root     root         4096 Jan  5 14:08 ./tftp
  5373955      4 drwxrwxrwx   2 root     root         4096 Jan  5 14:08 ./tftp/pxelinux.cfg
  5373960      4 -r--r--r--   1 rear     users         933 Jan  5 14:08 ./tftp/pxelinux.cfg/rear-linux-h9wr
  5373963      0 lrwxrwxrwx   1 rear     users          15 Jan  5 14:08 ./tftp/pxelinux.cfg/01-52-54-00-eb-ce-15 -&gt; rear-linux-h9wr
  5373961      0 lrwxrwxrwx   1 rear     users          15 Jan  5 14:08 ./tftp/pxelinux.cfg/01-c8-cb-b8-41-16-f6 -&gt; rear-linux-h9wr
  5373962      0 lrwxrwxrwx   1 rear     users          15 Jan  5 14:08 ./tftp/pxelinux.cfg/01-b6-70-fc-a3-41-08 -&gt; rear-linux-h9wr
  5373956      4 drwxr-xr-x   2 rear     users        4096 Jan  5 14:08 ./tftp/linux-h9wr
  5373957   8852 -rw-r--r--   1 rear     users     9062624 Jan  5 14:08 ./tftp/linux-h9wr/linux-h9wr.kernel
  5373959      4 -rw-r--r--   1 rear     users         267 Jan  5 14:08 ./tftp/linux-h9wr/linux-h9wr.message
  5373958  67708 -rw-r--r--   1 rear     users    69331809 Jan  5 14:08 ./tftp/linux-h9wr/linux-h9wr.initrd.cgz
</code></pre>
<h4 id="jsmeix_commented_at_2022-01-05_1328"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1005685362">2022-01-05 13:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-05_1328" title="Permanent link">&para;</a></h4>
<p>Furthermore the changes in this pull request here are only in<br />
usr/share/rear/output/PXE/default/800_copy_to_tftp.sh<br />
while the symlinks are created in<br />
usr/share/rear/output/PXE/default/810_create_pxelinux_cfg.sh</p>
<h4 id="flunkyball_commented_at_2022-01-05_1622"><img src="https://avatars.githubusercontent.com/u/36796685?v=4" width="50"><a href="https://github.com/Flunkyball">Flunkyball</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1005873386">2022-01-05 16:22</a>:<a class="headerlink" href="#flunkyball_commented_at_2022-01-05_1622" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Interesting that you cannot reproduce it. I tried it on a second client.
The first was Arch Linux the second is a Debian client with exactly the
same result regarding the symlinks.<br />
On both clients I did a complete fresh git clone and launched rear
mkrescue from there.</p>
<p>I checked
"usr/share/rear/output/PXE/default/810_create_pxelinux_cfg.sh" and
had the ln -sf command logged for each entry with the following result:</p>
<pre><code>2022-01-05 17:01:29.963735941 Including output/PXE/default/800_copy_to_tftp.sh
2022-01-05 17:01:29.977561505 Mounting with 'sshfs pxe@pxe-ssh:/tftp /var/tmp/rear.EbKZvIBgoIzaN8M/tftpbootfs -o rw,noatime'
2022-01-05 17:02:14.040837389 Copied kernel+initrd 453M to sshfs://pxe@pxe-ssh/tftp/HOSTNAME
2022-01-05 17:02:14.066075187 Including output/PXE/default/810_create_pxelinux_cfg.sh
2022-01-05 17:02:14.091668069 Mounting with 'sshfs pxe@pxe-ssh:/tftp/pxelinux.cfg /var/tmp/rear.EbKZvIBgoIzaN8M/tftpbootfs -o rw,noatime'
    2022-01-05 17:02:14.921060403  ln -sf rear-HOSTNAME 01-01-01-01-01-01-4a
    2022-01-05 17:02:14.947981748  ln -sf rear-HOSTNAME 01-01-01-01-01-01-4c
    2022-01-05 17:02:14.973756517  ln -sf rear-HOSTNAME 01-01-01-01-01-01-8c
2022-01-05 17:02:14.983073672 Created pxelinux config 'rear-HOSTNAME' and symlinks for MAC adresses in sshfs://pxe@pxe-ssh/tftp/pxelinux.cfg
</code></pre>
<p>As you can see the parameters which are used by the script for the
symlink are absolutely correct.</p>
<p>Running the same again with NFS as mount method produces the same log
regarding the "ln -sf" command. However the resulting symlink on the
share is correct.</p>
<p>If I manually mount the sshfs share with "sshfs pxe@pxe-ssh:/tftp
/mnt/test"<br />
and create the symlink with "ln -sf rear-HOSTNAME 01-01-01-01-01-01-4a"
I end up again with a target including "/"</p>
<p>Hence it seems to be an issue with sshfs mount. However not on the side
if rear I guess ;-)</p>
<h4 id="flunkyball_commented_at_2022-01-06_1352"><img src="https://avatars.githubusercontent.com/u/36796685?v=4" width="50"><a href="https://github.com/Flunkyball">Flunkyball</a> commented at <a href="https://github.com/rear/rear/pull/2723#issuecomment-1006607730">2022-01-06 13:52</a>:<a class="headerlink" href="#flunkyball_commented_at_2022-01-06_1352" title="Permanent link">&para;</a></h4>
<p>I can confirm now that everything regarding rear and especially the fix
discussed here is working.</p>
<p>The problem I was experiencing is do to the fact that debian stretch
uses an unbelievable old version of proftpd (1.3.5 from 2017) in its
repository. This version in particular had issues with symlinks
generated wrong when mounted via sshfs.</p>
<p>Compiling the latest release 1.3.7c from 2021 myself it is working now
without any issues.</p>
<p>@jsmeix<br />
Thx for your support and the help to trace the issue !</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-12-06.2723.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
