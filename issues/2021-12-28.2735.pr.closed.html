<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2735 PR closed: Evaluation enhancement of PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP scripts - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2735 PR closed: Evaluation enhancement of PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP scripts";
        var mkdocs_page_input_path = "issues/2021-12-28.2735.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2735 PR closed: Evaluation enhancement of PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP scripts</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2735_pr_closed_evaluation_enhancement_of_pre_recoverypost_recoverypre_backuppost_backup_scripts"><a href="https://github.com/rear/rear/pull/2735">#2735 PR</a> <code>closed</code>: Evaluation enhancement of PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP scripts<a class="headerlink" href="#2735_pr_closed_evaluation_enhancement_of_pre_recoverypost_recoverypre_backuppost_backup_scripts" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>won't fix / can't fix / obsolete</code></p>
<h4 id="rmetrich_opened_issue_at_2021-12-28_0921"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> opened issue at <a href="https://github.com/rear/rear/pull/2735">2021-12-28 09:21</a>:<a class="headerlink" href="#rmetrich_opened_issue_at_2021-12-28_0921" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL): N/A</p>
</li>
<li>
<p>How was this pull request tested? Manually</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>The current evaluation of the scripts is through <code>eval ${SCRIPT[@]}</code>
which has many drawbacks, in particular when using array variables, each
line must be semi-colon terminated or else the rest will be skipped,
e.g.</p>
<pre><code>PRE_RECOVERY_SCRIPT=( 'multipathd' )
PRE_RECOVERY_SCRIPT+=( 'sleep 10' )
</code></pre>
<p>resulted in executing <code>multipathd sleep 10</code> instead of expected
<code>multipathd</code> then <code>sleep 10</code>.</p>
<p>This enhancement evaluates the scripts item by item, which is more
bulletproof and still supports having the script specified as a string
variable.</p>
<h4 id="pcahyna_commented_at_2022-01-07_2224"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1007786628">2022-01-07 22:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-07_2224" title="Permanent link">&para;</a></h4>
<p>Hi @rmetrich, your change looks logical, but is contrary to the
documented intent. The comment in <code>default.conf</code> (and comments there
really serve as user documentation, because only very basic variables
are documented in the user docs and most of variables are documented
only in <code>default.conf</code>) says:
<code>NOTE: The scripts can be defined as an array to better handly spaces in parameters.</code>
So the intent of having them as arrays is not to support multiple
independent scripts to be evaluated separately, but to have only one
script that is better structured (command and arguments), like (perverse
example) <code>(echo 'rm -rf /')</code> that is intended to print <code>rm -rf /</code> but
after your change prints nothing and executes <code>rm -rf /</code>. That's
probably why the variables are called <code>PRE</code>/<code>POST_</code>XXX<code>_SCRIPT</code> and not
<code>_SCRIPTS</code> (note the singular). After your change, they would be better
called <code>PRE</code>/<code>POST_</code>XXX<code>_SCRIPTS</code>.<br />
Note that I do not endorse the original intent. To me it seems
misguided: if one wants to provide commands as shell arrays in order to
protect arguments from shell processing like whitespace splitting, fine,
but then one should not feed them to <code>eval</code>. The problem is, as the man
page of the Almquist shell succinctly states, "<code>eval string ...</code>
Concatenate all the arguments with spaces. Then re-parse and execute the
command.", specifically, the "re-parse" part. If one tries to provide a
list of arguments with embedded spaces to <code>eval</code> as a shell array, like
<code>CMD=(ls 'a filename with spaces'); eval "${CMD[@]}"</code>, then the
<code>"${CMD[@]}"</code> expansion will work properly, but <code>eval</code> will then
re-split the resulting arguments on whitespace, turning them into
<code>"ls" "a" "filename" "with" "spaces"</code> instead of the intended
<code>"ls" "a filename with spaces"</code>. Sure, one can quote the string inside,
like <code>CMD=(ls '"a filename with spaces"')</code>, but then one does not need
the bash array at all, because <code>CMD='ls "a filename with spaces"'</code> is
exactly equivalent and certainly simpler.</p>
<p>One has IMO basically two options how to use bash arrays to specify
commands:</p>
<ol>
<li>use them to provide multiple inline scripts, each of the scripts
    will be evaluated separately and can use various shell
    metacharacters, like quotes. If one wants to provide arguments with
    spaces to some commands in the scripts, one has to use quotes inside
    the scripts, like in any other shell command (and another level of
    quotes around the whole script).</li>
<li>use them to provide a command with arguments. The arguments can
    contain whitespace and do not need to contain quotes (they will need
    quoting only when constructing the array). But then one can not use
    <code>eval</code>, thus one is prevented from using various special shell
    constructs.</li>
</ol>
<p>This PR changes the interpretation of the variables to 1. while the
original intent seems to have been 2. (but due to the use of <code>eval</code> it
does not work as probably intended).</p>
<p>What about introducing new variables called <code>PRE</code>/<code>POST_</code>xxx<code>_SCRIPTS</code>
and letting the old variables as they are (and remove them in the next
major version)?</p>
<h4 id="pcahyna_commented_at_2022-01-07_2232"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1007791189">2022-01-07 22:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-07_2232" title="Permanent link">&para;</a></h4>
<p>Of course, the scripts that one provide in the arrays are not really
independent because they run in the same shell, not in a subshell. So
they could be considered only multiple commands of one script (one can
pass variables from one to a subsequent one, for example). Still, I
think that calling the variables <code>_SCRIPTS</code> instead of <code>_SCRIPT</code>
expresses better the intent and the difference from the former behavior.
Or maybe <code>_COMMADS</code> would be even better?</p>
<h4 id="rmetrich_commented_at_2022-01-08_0800"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1007905028">2022-01-08 08:00</a>:<a class="headerlink" href="#rmetrich_commented_at_2022-01-08_0800" title="Permanent link">&para;</a></h4>
<p>Right, I completely missed this. Having new variables seems indeed
better.</p>
<h4 id="jsmeix_commented_at_2022-01-10_0819"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1008631221">2022-01-10 08:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-10_0819" title="Permanent link">&para;</a></h4>
<p>Regarding ..._COMMANDS:<br />
We have currently in default.conf<br />
NETWORKING_PREPARATION_COMMANDS<br />
ZYPPER_NETWORK_SETUP_COMMANDS<br />
YUM_NETWORK_SETUP_COMMANDS</p>
<p>The variable name ..._SCRIPT could be misleading because it looks<br />
as if it means the filename of a script and not the commands of a
script.<br />
A variable name ..._SCRIPTS is misleading because it certainly<br />
means filenames of scripts and not commands of a single script.</p>
<h4 id="pcahyna_commented_at_2022-01-10_1038"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1008741211">2022-01-10 10:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-10_1038" title="Permanent link">&para;</a></h4>
<p>thanks @jsmeix for looking for prior art, *<code>_COMMANDS</code> seems to be the
best choice indeed.</p>
<h4 id="pcahyna_commented_at_2022-01-10_1119"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1008777003">2022-01-10 11:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-10_1119" title="Permanent link">&para;</a></h4>
<p>@rmetrich by the way I am curious about the original motivation: doesn't
ReaR start multipathd automatically when it detects multipath devices? I
recall testing ReaR with multipath and it seemed to work.</p>
<h4 id="jsmeix_commented_at_2022-01-10_1141"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1008793731">2022-01-10 11:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-10_1141" title="Permanent link">&para;</a></h4>
<p>multipathd is started during "rear recover" via<br />
usr/share/rear/layout/prepare/GNU/Linux/210_load_multipath.sh</p>
<h4 id="rmetrich_commented_at_2022-01-10_1156"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1008803480">2022-01-10 11:56</a>:<a class="headerlink" href="#rmetrich_commented_at_2022-01-10_1156" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@rmetrich by the way I am curious about the original motivation:
doesn't ReaR start multipathd automatically when it detects multipath
devices? I recall testing ReaR with multipath and it seemed to work.</p>
</blockquote>
<p>Yes it does. This is just an example where I had to implement this on
Red Hat's 2.4 rear which was not always starting multipathd.<br />
I'm changing this seems it may be confusing in the end and the admin may
believe multipathd needs to be started manually.</p>
<h4 id="jsmeix_commented_at_2022-01-12_1253"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011015365">2022-01-12 12:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1253" title="Permanent link">&para;</a></h4>
<p>Above I made some comments that start with</p>
<pre><code>jsmeix started a review        Pending    View Changes
</code></pre>
<p>where I don't get a GitHub mail for those comments<br />
and when I click on 'View Changes' there I get<br />
<code>We went looking everywhere, but couldn’t find those commits</code></p>
<p>So it seems something is somehow messed up there<br />
but one can at least see my comments here<br />
(strictly speaking at least I can see my comments here)<br />
so please have a look at my above comments<br />
that are currently marked with <code>Pending</code>.</p>
<p>If you don't see <code>Pending</code> comments from me above<br />
I would re-post them here.</p>
<h4 id="pcahyna_commented_at_2022-01-12_1312"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011030968">2022-01-12 13:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-12_1312" title="Permanent link">&para;</a></h4>
<p>@jsmeix I think that "Pending" means that only you can see them until
you submit them. I don't see any comments from you except
<a href="https://github.com/rear/rear/pull/2735#discussion_r781056780">https://github.com/rear/rear/pull/2735#discussion_r781056780</a>
<a href="https://github.com/rear/rear/pull/2735#issuecomment-1008793731">https://github.com/rear/rear/pull/2735#issuecomment-1008793731</a>
and
<a href="https://github.com/rear/rear/pull/2735#issuecomment-1008631221">https://github.com/rear/rear/pull/2735#issuecomment-1008631221</a></p>
<h4 id="jsmeix_commented_at_2022-01-12_1350"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011065564">2022-01-12 13:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1350" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for the description what you see.<br />
I find nothing at my 'Pending' comments where I could submit them.<br />
The only active button is 'View Changes' but that results only<br />
<code>We went looking everywhere, but couldn’t find those commits</code></p>
<p>I will re-post a summary here.</p>
<h4 id="jsmeix_commented_at_2022-01-12_1351"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011066861">2022-01-12 13:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1351" title="Permanent link">&para;</a></h4>
<p>Regarding POST_BACKUP_SCRIPT as exit task I had written:</p>
<p>I guess the intent behind is that with a simple</p>
<p>PRE_BACKUP_SCRIPT=( 'database stop' )<br />
POST_BACKUP_SCRIPT=( 'database start' )</p>
<p>after a "rear mkbackup" error during backup<br />
database start is run as exit task.</p>
<p>I wonder if it is the by users usually expected behaviour<br />
when they had a "rear mkbackup" error during backup.<br />
Why automatically restarting the database when the backup had failed?<br />
Perhaps an up-to-date backup is intended before restarting the database?</p>
<p>Also the implementation runs all commands in POST_BACKUP_SCRIPT<br />
as exit task after a "rear mkbackup" error during backup<br />
and I think it is likely not right to "just run" all those commands.</p>
<p>From my current point of view I would not implement that<br />
oversophisticated looking automated exit task stuff<br />
also for the new ..._COMMANDS arrays<br />
to keep things more safe and simple.</p>
<h4 id="jsmeix_commented_at_2022-01-12_1355"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011070624">2022-01-12 13:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1355" title="Permanent link">&para;</a></h4>
<p>Regarding the code in backup/default/010_pre_backup_script.sh</p>
<pre><code>for command in "${POST_BACKUP_COMMANDS[@]}"; do
    AddExitTask "$command"
done
</code></pre>
<p>I had written:</p>
<p>I still do not like it when all POST_BACKUP_COMMANDS<br />
get hardcoded added as exit tasks.</p>
<p>...</p>
<p>Because I like to provide "final power to the user"<br />
I think it must be possible for the user to specify<br />
which one of his POST_BACKUP_COMMANDS<br />
he also wants to run in case of error exit during backup.</p>
<p>My immediate idea is that<br />
when one element in POST_BACKUP_COMMANDS<br />
has the special value <code>add_next_as_exit_task</code><br />
the next element in POST_BACKUP_COMMANDS<br />
gets added as exit task.</p>
<p>So I would like to propose (totally untested) code like</p>
<pre><code>add_as_exit_task="no"
for command in "${POST_BACKUP_COMMANDS[@]}" ; do
    if test "$command" = "add_next_as_exit_task" ; then
        add_as_exit_task="yes"
        continue
    fi
    is_true $add_as_exit_task || continue
    AddExitTask "$command"
    add_as_exit_task="no"
done
</code></pre>
<p>and matching code in backup/default/990_post_backup_script.sh<br />
like</p>
<pre><code>exists_as_exit_task="no"
for command in "${POST_BACKUP_COMMANDS[@]}"; do
    if test "$command" = "add_next_as_exit_task" ; then
        exists_as_exit_task="yes"
        continue
    fi
    if is_true $exists_as_exit_task ; then
        RemoveExitTask "$command"
        exists_as_exit_task="no"
    fi
    Log "Running POST_BACKUP_COMMANDS: '$command'"
    eval "$command"
done
</code></pre>
<h4 id="rmetrich_commented_at_2022-01-12_1355"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011070652">2022-01-12 13:55</a>:<a class="headerlink" href="#rmetrich_commented_at_2022-01-12_1355" title="Permanent link">&para;</a></h4>
<p>Hi Johannes,<br />
I think it makes sense to execute POST_BACKUP_SCRIPT even on backup
failure, this in order to put the system is a stable state again.<br />
This one would indeed use this for databases to avoid having corruptions
in the database if not shut down while creating the backup.</p>
<h4 id="rmetrich_commented_at_2022-01-12_1357"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011071847">2022-01-12 13:57</a>:<a class="headerlink" href="#rmetrich_commented_at_2022-01-12_1357" title="Permanent link">&para;</a></h4>
<p>And I don't see why there would be a matching POST_BACKUP_COMMAND for
a given PRE_BACKUP_COMMAND.<br />
So I think it's up to the user to provide some error-safe commands.</p>
<h4 id="jsmeix_commented_at_2022-01-12_1357"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011072134">2022-01-12 13:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1357" title="Permanent link">&para;</a></h4>
<p>Because we must keep things working backward compatible<br />
adding POST_BACKUP_SCRIPT as exit task must be kept.</p>
<p>I question if also all commands in POST_BACKUP_COMMANDS<br />
should be hardcoded added as exit tasks.</p>
<h4 id="rmetrich_commented_at_2022-01-12_1402"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011076947">2022-01-12 14:02</a>:<a class="headerlink" href="#rmetrich_commented_at_2022-01-12_1402" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Because we must keep things working backward compatible adding
POST_BACKUP_SCRIPT as exit task must be kept.</p>
</blockquote>
<p>It is. It was just moved to line 13-15 because where it was originally
wasn't making sense, specially if there was no POST_BACKUP_SCRIPT.</p>
<h4 id="jsmeix_commented_at_2022-01-12_1405"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011079400">2022-01-12 14:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1405" title="Permanent link">&para;</a></h4>
<p>I think almost all usual users assume their commands<br />
that are intented to run after backup was made<br />
run under the implicit precondition<br />
that the backup has been actually (sucessfully) made.</p>
<p>So I would not expect usual users to provide commands<br />
that are safe to be run after it failed to make the backup.</p>
<p>And what should users specify who do not want their commands<br />
(or some of their commands) to be run after it failed to make the
backup?</p>
<h4 id="jsmeix_commented_at_2022-01-12_1435"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011108488">2022-01-12 14:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-12_1435" title="Permanent link">&para;</a></h4>
<p>As far as I see the whole automated adding more than one single
command<br />
as exit task works plain wrong because</p>
<pre><code>AddExitTask "COMMAND1"
AddExitTask "COMMAND2"
</code></pre>
<p>will run COMMAND2 before COMMAND1 because AddExitTask prepends,<br />
see the function AddExitTask() in lib/_input-output-functions.sh<br />
so</p>
<pre><code>AddExitTask "database start"
AddExitTask "use database"
</code></pre>
<p>will let 'use database' just fail because it is run before 'database
start'.</p>
<p>As a test I added at the beginning of
init/default/030_update_recovery_system.sh</p>
<pre><code>AddExitTask "echo 'first' &gt;&gt;/tmp/rear_exit_tasks"
AddExitTask "echo 'second' &gt;&gt;/tmp/rear_exit_tasks"
AddExitTask "echo 'third' &gt;&gt;/tmp/rear_exit_tasks"
Error "see /tmp/rear_exit_tasks"
</code></pre>
<p>and with that</p>
<pre><code># usr/sbin/rear -D mkrescue
Relax-and-Recover 2.6 / Git
Running rear mkrescue (PID 5256 date 2022-01-12 15:40:16)
Command line options: usr/sbin/rear -D mkrescue
Using log file: /root/rear.github.master/var/log/rear/rear-linux-h9wr.log
Using build area: /var/tmp/rear.I9m9oHrMaFTY1zg
Running 'init' stage ======================
ERROR: see /tmp/rear_exit_tasks
Some latest log messages since the last called script 030_update_recovery_system.sh:
  2022-01-12 15:40:18.754599328 Entering debugscript mode via 'set -x'.
  2022-01-12 15:40:18.761106430 Added 'echo 'first' &gt;&gt;/tmp/rear_exit_tasks' as an exit task
  2022-01-12 15:40:18.764607684 Added 'echo 'second' &gt;&gt;/tmp/rear_exit_tasks' as an exit task
  2022-01-12 15:40:18.768153511 Added 'echo 'third' &gt;&gt;/tmp/rear_exit_tasks' as an exit task
Aborting due to an error, check /root/rear.github.master/var/log/rear/rear-linux-h9wr.log for details
Exiting rear mkrescue (PID 5256) and its descendant processes ...
Running exit tasks
To remove the build area you may use (with caution): rm -Rf --one-file-system /var/tmp/rear.I9m9oHrMaFTY1zg
Terminated

# cat /tmp/rear_exit_tasks
third
second
first
</code></pre>
<h4 id="pcahyna_commented_at_2022-01-12_1448"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1011120846">2022-01-12 14:48</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-01-12_1448" title="Permanent link">&para;</a></h4>
<blockquote>
<p>will run COMMAND2 before COMMAND1 because AddExitTask prepends</p>
</blockquote>
<p>Indeed. Note that the original form
<code>AddExitTask "${POST_BACKUP_SCRIPT[@]}"</code> worked well, because if you
give multiple tasks to one <code>AddExitTask</code> command, it will add them in
sequence, rather than in reverse.</p>
<h4 id="jsmeix_commented_at_2022-01-19_1039"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1016304516">2022-01-19 10:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-01-19_1039" title="Permanent link">&para;</a></h4>
<p>@rmetrich @pcahyna<br />
I would like to progress here.</p>
<p>My proposal:</p>
<p>Either<br />
do not call AddExitTask for any POST_BACKUP_COMMANDS<br />
which means we cannot deprecate POST_BACKUP_SCRIPT</p>
<p>Or<br />
have some more sophisticated code where the user can specify<br />
what in POST_BACKUP_COMMANDS should be added as exit tasks<br />
cf.
<a href="https://github.com/rear/rear/pull/2735#issuecomment-1011070624">https://github.com/rear/rear/pull/2735#issuecomment-1011070624</a><br />
plus explanatory documentation in default.conf that</p>
<pre><code>POST_BACKUP_COMMANDS=( "add_next_as_exit_task" "database start"
                       "add_next_as_exit_task" "use database" )
</code></pre>
<p>won't work and</p>
<pre><code>POST_BACKUP_COMMANDS=( "add_next_as_exit_task" "database start ; use database" )
</code></pre>
<p>must be used instead which should work because</p>
<pre><code># cmds=( "echo first ; echo second" )

# ( set -x ; for cmd in "${cmds[@]}" ; do eval "$cmd" ; done )
+ for cmd in "${cmds[@]}"
+ eval 'echo first ; echo second'
++ echo first
first
++ echo second
second
</code></pre>
<p>but what "man bash" reads seems to contradict</p>
<pre><code>control operator
  A token that performs a control function.
  It is one of the following symbols:
  || &amp; &amp;&amp; ; ;; ;&amp; ;;&amp; ( ) | |&amp; &lt;newline&gt;
...
Simple Commands
  A simple command is a sequence of optional variable assignments
  followed by blank-separated words and redirections,
  and terminated by a control operator.
...
eval [arg ...]
  The args are read and concatenated together into a single command.
  This command is then read and executed by the shell
</code></pre>
<p>so I wonder what <code>eval 'echo first ; echo second'</code> actually does<br />
because the one argument <code>echo first ; echo second</code><br />
is not a single (simpe) command.<br />
The confusion happens because "man bash" uses the<br />
plain word "command" with unclear meaning - i.e. whether<br />
a "simple command" or a "compound command" is meant.</p>
<h4 id="jsmeix_commented_at_2022-02-02_0733"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1027659367">2022-02-02 07:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-02-02_0733" title="Permanent link">&para;</a></h4>
<p>@rmetrich @pcahyna<br />
could you find some time to progress here - at least a bit?</p>
<h4 id="pcahyna_commented_at_2022-02-02_0822"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1027689889">2022-02-02 08:22</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-02-02_0822" title="Permanent link">&para;</a></h4>
<p>@jsmeix I will, but not immediately. I need to focus on the layout code
now, I find it more important.</p>
<h4 id="jsmeix_commented_at_2022-02-02_0906"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1027723347">2022-02-02 09:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-02-02_0906" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your prompt reply!<br />
Of course no rush and as your time permits.<br />
Clearly issues in the layout code are more important.</p>
<h4 id="github-actions_commented_at_2022-04-04_0254"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1087056070">2022-04-04 02:54</a>:<a class="headerlink" href="#github-actions_commented_at_2022-04-04_0254" title="Permanent link">&para;</a></h4>
<p>Stale pull request message</p>
<h4 id="pcahyna_commented_at_2022-04-06_1532"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1090408627">2022-04-06 15:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-06_1532" title="Permanent link">&para;</a></h4>
<p>I added it to the 2.7 milestone, so that users can migrate from the old
variables ASAP.</p>
<h4 id="pcahyna_commented_at_2022-04-06_1545"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1090422991">2022-04-06 15:45</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-06_1545" title="Permanent link">&para;</a></h4>
<p>Hi @rmetrich , I have noticed an asymmetry in these variables.
<code>PRE_BACKUP_COMMANDS</code> does not seem to execute at the beginning of the
ReaR run, but before the backup of data gets created (the rescue image
with the disk layout has been created already): "Call this before
Relax-and-Recover starts to do anything in the mkbackup/mkbackuponly
workflow." But <code>PRE_RECOVERY_COMMANDS</code> runs at the very beginning of the
ReaR run: "You have the rescue system but nothing else". Would it make
sense to introduce <code>PRE_RESTORE_COMMANDS</code> that would be symmetrical with
<code>PRE_BACKUP_COMMANDS</code> and run just before the backup is restored? (It
could be used for custom commands that need to make the backup archive
accessible. For example, mount a disk with the archive, if one uses a
<code>file://</code> URL.)</p>
<h4 id="pcahyna_commented_at_2022-05-02_1624"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115091025">2022-05-02 16:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-02_1624" title="Permanent link">&para;</a></h4>
<blockquote>
<p>My immediate idea is that<br />
when one element in POST_BACKUP_COMMANDS<br />
has the special value <code>add_next_as_exit_task</code><br />
the next element in POST_BACKUP_COMMANDS<br />
gets added as exit task.</p>
</blockquote>
<p>@jsmeix returning to this old topic, sorry for the delay. I must say, I
don't like this idea, or generally the idea of using such special values
in lists (I know that there is <code>all_modules</code>, but I would prefer to
avoid more such cases). If there is really a need for running some
commands only when the backup has been successful, I see two cleaner
options:</p>
<ol>
<li>introduce another variable, like <code>POST_SUCCESSFUL_BACKUP_COMMANDS</code></li>
<li>in the command, let the user test the <code>EXIT_CODE</code> variable, like
    this: <code>"(( EXIT_CODE )) || command"</code></li>
</ol>
<p>Users can do the latter already.<br />
I am not sure if there is much demand for this, though. @rmetrich
provided an example where you want to execute the commands regardless of
the backup status (one may want to halt some service temporarily during
the backup, but one does not want to leave it halted, even if the backup
fails). I can imagine other use cases: one might want to enable the
access to the storage where the backup is to be located in
<code>PRE_BACKUP_COMMANDS</code> and disable it in <code>POST_BACKUP_COMMANDS</code>, or one
might want to take some kind of snapshot before the backup and back up
the snapshot. In all those cases, it is needed to run the appropriate
cleanup command among <code>POST_BACKUP_COMMANDS</code> regardless of the success
of the backup job (you don't want the snapshot to linger and take space,
nor the backup storage being left mounted and thus vulnerable to
accidental damage). Have there been any complaints about the current
behavior, or do you have a concrete use case in mind that requires this
change? If such cases are sufficiently rare, one might leave them to be
covered by explicit testing of <code>EXIT_CODE</code> in the command by those who
need them.</p>
<h4 id="pcahyna_commented_at_2022-05-02_1703"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115126919">2022-05-02 17:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-02_1703" title="Permanent link">&para;</a></h4>
<p>@jsmeix @rmetrich I am taking a day off tomorrow, so I can continue the
discussion on Wednesday.</p>
<h4 id="jsmeix_commented_at_2022-05-03_0711"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115801760">2022-05-03 07:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_0711" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
enjoy your vacation!</p>
<h4 id="jsmeix_commented_at_2022-05-03_0802"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115833664">2022-05-03 08:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_0802" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I do not understand how it should work what you wrote:<br />
"let the user test the EXIT_CODE variable ... Users can do the latter
already"</p>
<p>I think the EXIT_CODE variable is not set when those<br />
PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP<br />
scripts are run - at least as far as I see according to what</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'EXIT_CODE'
</code></pre>
<p>shows me.</p>
<p>Do you perhaps mean "let the user test the EXIT_CODE variable"<br />
as an enhancement that the EXIT_CODE variable should be set<br />
when those scripts (or commands) are run?</p>
<p>Furthermore - as far as I see - in current master code<br />
it seems those scripts (or commands) are "just run"<br />
without any kind of error handling which is against<br />
"Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>In general I have no personal experience with<br />
PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP<br />
because I do not use them.<br />
I have no user or customer reports related to them.</p>
<p>I guess in most cases users do not use them but instead they call<br />
the right perparation commands outside of ReaR before they call <code>rear</code><br />
and the right cleanup commands outside of ReaR after <code>rear</code> finished<br />
in particular for PRE_BACKUP/POST_BACKUP scripts<br />
because those are called during "rear mkbackup"<br />
via backup/default/010_pre_backup_script.sh<br />
and backup/default/990_post_backup_script.sh<br />
which only happens for ReaR internal backup methods<br />
so all users with third-party backup methods<br />
cannot use PRE_BACKUP/POST_BACKUP<br />
but must use something outside of ReaR.</p>
<p>In contrast PRE_RECOVERY/POST_RECOVERY<br />
could be more useful in general because those<br />
can be helpful for automated recovery in general<br />
regardless what backup method is used<br />
and the initial issue description here<br />
<a href="https://github.com/rear/rear/pull/2735#issue-1089733641">https://github.com/rear/rear/pull/2735#issue-1089733641</a><br />
is about PRE_RECOVERY_SCRIPT</p>
<p>The exit tasks complication happens<br />
only for PRE_BACKUP/POST_BACKUP<br />
but not for PRE_RECOVERY/POST_RECOVERY.</p>
<p>I suggest to leave PRE_BACKUP/POST_BACKUP as is<br />
and only enhance PRE_RECOVERY/POST_RECOVERY by<br />
PRE_RECOVERY_COMMANDS and POST_RECOVERY_COMMANDS<br />
via this pull request here.</p>
<p>This way we could move one step forward<br />
in an area that is actually used by at least one user.</p>
<p>Because all users with third-party backup methods<br />
cannot use PRE_BACKUP/POST_BACKUP<br />
but must use something outside of ReaR<br />
and because I do not know about a user request<br />
to have such functionality for third-party backup methods<br />
(regardless that it would be impossible to implement<br />
such functionality for third-party backup methods in ReaR)<br />
I assume users won't have problems with calling (outside of ReaR)<br />
the right perparation commands before they call "rear
mkbackup[only]"<br />
and the right cleanup commands after "rear mkbackup[only]" finished<br />
so PRE_BACKUP/POST_BACKUP is no needed functionality in ReaR<br />
and we can leave it "rest in peace".</p>
<h4 id="jsmeix_commented_at_2022-05-03_0822"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115848371">2022-05-03 08:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_0822" title="Permanent link">&para;</a></h4>
<p>FYI:<br />
PRE_BACKUP/POST_BACKUP originated via<br />
<a href="https://github.com/rear/rear/commit/397728d7ed6ccb22338bcb6af03949c8ccf58a91">https://github.com/rear/rear/commit/397728d7ed6ccb22338bcb6af03949c8ccf58a91</a><br />
from<br />
<a href="https://github.com/rear/rear/pull/977">https://github.com/rear/rear/pull/977</a><br />
where I already had issues with them added as exit tasks<br />
<a href="https://github.com/rear/rear/pull/977#issuecomment-242041391">https://github.com/rear/rear/pull/977#issuecomment-242041391</a><br />
and now - of course - that strikes back :-(</p>
<h4 id="jsmeix_commented_at_2022-05-03_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1115921655">2022-05-03 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_0954" title="Permanent link">&para;</a></h4>
<p>In general I also do not like the idea of using special values in
lists<br />
when the special values can appear intermixed with normal values<br />
as it would happen in this case here.<br />
It was just "my immediate idea" and I had no better one.</p>
<p>On the other hand I also do not like several config variables<br />
to specify one same thing because usually that leads to complications<br />
with interdependencies of those variables (i.e. "herding cats")<br />
that usually results both complicated code and complicated<br />
to understand by the user how to specify things correctly.</p>
<p>What I do like is special values for config variables<br />
when the special values do not appear intermixed with normal values<br />
as we use it often for config variables with "ternary semantics" like</p>
<ul>
<li>either unset or empty,</li>
<li>or boolean 'true' or 'false',</li>
<li>or "something else"</li>
</ul>
<p>(the "either ... or" makes things simple and straightforward)<br />
e.g. as in KEEP_BUILD_DIR or AUTORESIZE_PARTITIONS<br />
or FIRMWARE_FILES and so on.</p>
<p>The <code>MODULES=( 'all_modules' )</code> is an unfortunate exception<br />
because of its long history of issues how it evolved over time.<br />
I think I vaguely remember that I did not like using<br />
<code>MODULES=('yes')</code> instead of <code>MODULES=('all_modules')</code><br />
and <code>MODULES=('no')</code> instead of <code>MODULES=('no_modules')</code><br />
because I feared a module named 'yes' or 'no' might appear<br />
(Unix tradition to use very short names and play with words)<br />
while I assumed there will never be a module 'all_modules' or
'no_modules'<br />
and the latter special values tell more explicitly what they mean.</p>
<h4 id="pcahyna_commented_at_2022-05-04_0904"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1117082324">2022-05-04 09:04</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-04_0904" title="Permanent link">&para;</a></h4>
<p>hi @jsmeix, quick note - I also don't object against "magic" values for
scalar variables that are otherwise mainly boolean, i.e. ternary (or
quaternary, or even Hexenvariables). My objection was against mixing
special and regular values in lists indeed.</p>
<h4 id="jsmeix_commented_at_2022-05-23_1332"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1134686196">2022-05-23 13:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-23_1332" title="Permanent link">&para;</a></h4>
<p>As a proposal how to proceed here<br />
for the ReaR 2.7 release I did now<br />
<a href="https://github.com/rear/rear/pull/2811">https://github.com/rear/rear/pull/2811</a><br />
where I implemented what I suggested here in<br />
<a href="https://github.com/rear/rear/pull/2735#issuecomment-1115833664">https://github.com/rear/rear/pull/2735#issuecomment-1115833664</a><br />
therein this part (excerpt):</p>
<pre><code>In general I have no personal experience with
PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP
because I do not use them.
I have no user or customer reports related to them.

I guess in most cases users do not use them
but instead they call the right perparation commands
outside of ReaR before they call rear
and the right cleanup commands
outside of ReaR after rear finished
in particular for PRE_BACKUP/POST_BACKUP scripts
because those are called during "rear mkbackup"
via backup/default/010_pre_backup_script.sh
and backup/default/990_post_backup_script.sh
which only happens for ReaR internal backup methods
so all users with third-party backup methods
cannot use PRE_BACKUP/POST_BACKUP
but must use something outside of ReaR.

In contrast PRE_RECOVERY/POST_RECOVERY
could be more useful in general because those
can be helpful for automated recovery in general
regardless what backup method is used
and the initial issue description here
https://github.com/rear/rear/pull/2735#issue-1089733641
is about PRE_RECOVERY_SCRIPT

The exit tasks complication happens
only for PRE_BACKUP/POST_BACKUP
but not for PRE_RECOVERY/POST_RECOVERY.

I suggest to leave PRE_BACKUP/POST_BACKUP as is
and only enhance PRE_RECOVERY/POST_RECOVERY by
PRE_RECOVERY_COMMANDS and POST_RECOVERY_COMMANDS
via this pull request here.

This way we could move one step forward
in an area that is actually used by at least one user.

Because all users with third-party backup methods
cannot use PRE_BACKUP/POST_BACKUP
but must use something outside of ReaR
and because I do not know about a user request
to have such functionality for third-party backup methods
(regardless that it would be impossible to implement
such functionality for third-party backup methods in ReaR)
I assume users won't have problems with calling
(outside of ReaR) the right perparation commands
before they call "rear mkbackup[only]"
and the right cleanup commands
after "rear mkbackup[only]" finished
so PRE_BACKUP/POST_BACKUP is no needed functionality in ReaR
and we can leave it "rest in peace".
</code></pre>
<h4 id="jsmeix_commented_at_2022-06-02_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1144880147">2022-06-02 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-02_1340" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2811">https://github.com/rear/rear/pull/2811</a>
merged<br />
this pull request got partially obsoleted by it.</p>
<p>The PRE_RECOVERY_COMMANDS and POST_RECOVERY_COMMANDS part<br />
of this pull request got obsoleted by<br />
<a href="https://github.com/rear/rear/pull/2811">https://github.com/rear/rear/pull/2811</a></p>
<p>The PRE_BACKUP_COMMANDS and POST_BACKUP_COMMANDS part<br />
of this pull request is not implemented because<br />
there are some issues how to implement it cleanly<br />
(see the comments above).</p>
<p>Because there is no real activity here about<br />
PRE_BACKUP_COMMANDS and POST_BACKUP_COMMANDS<br />
I close this pull request at least for now.<br />
Of course it can be reopened when needed.</p>
<h4 id="pcahyna_commented_at_2022-06-02_1536"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145006984">2022-06-02 15:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-02_1536" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>I think the EXIT_CODE variable is not set when those<br />
PRE_RECOVERY/POST_RECOVERY/PRE_BACKUP/POST_BACKUP<br />
scripts are run</p>
</blockquote>
<p>You are right, I am not very familiar with the error and exit handling
code - I find it quite complicated. (<code>EXIT_FAIL_MESSAGE</code> does not do the
trick either.)</p>
<p>I have just realized what is the most ugly part of the current
<code>POST_BACKUP_SCRIPT</code> handling: it is not that it is executed as an exit
task in case of an error exit (that seems fairly OK to me), but the fact
that it is added to exit tasks only if <code>PRE_BACKUP_SCRIPT</code> is set, and
if it is unset <code>POST_BACKUP_SCRIPT</code> will not be executed in case of an
error exit:</p>
<pre><code>if test "$PRE_BACKUP_SCRIPT" ; then
    Log "Running PRE_BACKUP_SCRIPT '${PRE_BACKUP_SCRIPT[@]}'"
    AddExitTask "${POST_BACKUP_SCRIPT[@]}"
</code></pre>
<p>I have not realized this before and this complicated logic and
interdependency between the two variables is something I would prefer
not to replicate in any newly introduced variable indeed.</p>
<h4 id="jsmeix_commented_at_2022-06-03_0822"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145720205">2022-06-03 08:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-03_0822" title="Permanent link">&para;</a></h4>
<p>So there is an error in the default.conf description:</p>
<pre><code>In case of any error during backup, if POST tasks were defined,
ReaR will run those POST tasks within ExitTasks Array.
</code></pre>
<p>I will correct the default.conf description to match what<br />
the current implementation of PRE/POST Backup scripts does<br />
(I won't touch the current implementation now).</p>
<h4 id="didacog_commented_at_2022-06-03_0845"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145740765">2022-06-03 08:45</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-03_0845" title="Permanent link">&para;</a></h4>
<p>Hi, just seen this issue, what is the problem with PRE/POST backup
scripts? I've implemented this few years ago. So if any help is needed
to understand why was implemented just tell me.</p>
<h4 id="jsmeix_commented_at_2022-06-03_0909"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145761354">2022-06-03 09:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-03_0909" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/fcc5005ee73e73d22360b3a6e4cca6af9d4b03ba">https://github.com/rear/rear/commit/fcc5005ee73e73d22360b3a6e4cca6af9d4b03ba</a><br />
the PRE_BACKUP_SCRIPT and POST_BACKUP_SCRIPT description in
default.conf<br />
matches what the current implementation does.</p>
<h4 id="jsmeix_commented_at_2022-06-03_0924"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145774251">2022-06-03 09:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-03_0924" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
from my current point of view nothing<br />
is wrong with the code which implements<br />
PRE_BACKUP_SCRIPT and POST_BACKUP_SCRIPT</p>
<p>The documentation in default.conf was not sufficiently precise<br />
which I (hopefully) fixed right now.</p>
<p>What leads to issues is when new config variables<br />
PRE_BACKUP_COMMANDS and POST_BACKUP_COMMANDS<br />
should be implemented according to how<br />
PRE_RECOVERY_COMMANDS and POST_RECOVERY_COMMANDS<br />
are now implemented.<br />
See the above comments what those issues would be.<br />
In current code there are no issues.</p>
<h4 id="didacog_commented_at_2022-06-03_0936"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145784185">2022-06-03 09:36</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-03_0936" title="Permanent link">&para;</a></h4>
<p>Ok @jsmeix , just wanted to help if needed to clarify why was
implemented, as I've seen some doubts in the comments.<br />
The explanation now is way better and more specific than before.</p>
<p>Regards,<br />
Didac</p>
<h4 id="pcahyna_commented_at_2022-06-03_1035"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145829652">2022-06-03 10:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-03_1035" title="Permanent link">&para;</a></h4>
<p>@didacog we had a discussion on the current semantics of
<code>PRE_BACKUP_SCRIPT</code> and <code>POST_BACKUP_SCRIPT</code> and whether it should be
translated to new <code>PRE_BACKUP_COMMANDS</code> and <code>POST_BACKUP_COMMANDS</code>. (The
motivation for this translation is described in the original description
of the PR.) Briefly, the issues with the current sematics are related to
the exit handling. It is a question whether to run <code>POST_BACKUP</code>
commands even when the workflow has failed (i.e. add them to exit
tasks), when it is not done for other <code>POST_</code> commands (why should
<code>POST_BACKUP</code> be exceptional?) Also, adding <code>POST_BACKUP_SCRIPT</code> to exit
tasks only when there is a <code>PRE_BACKUP_SCRIPT</code> seems overcomplicated and
not obvious. And there is a general question of whether there is any
real need for <code>PRE/POST_BACKUP</code> stuff, since one can simply run the
commands befopre and after the rear run, instead of putting them into
the configuration file (and one has to do it for external backup methods
that are not supported by <code>rear mkbackup</code> anyway).<br />
I would be interested what was the motivation behind these semantics
decisions (why there is a need for <code>PRE/POST_BACKUP</code> stuff and if it
would be a problem if <code>POST_BACKUP</code> is executed only after a successful
run).<br />
(Of course, the intent is not to change the actual semantics of
<code>PRE/POST_BACKUP_SCRIPT</code>, but to use the possible introduction of
<code>PRE/POST_BACKUP_COMMANDS</code> to improve the semantics, if desired. Since
we have not agreed yet what counts as an improvement, we have not added
<code>PRE/POST_BACKUP_COMMANDS</code> yet.)</p>
<h4 id="didacog_commented_at_2022-06-03_1329"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1145966791">2022-06-03 13:29</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-03_1329" title="Permanent link">&para;</a></h4>
<p>@pcahyna the motivation for this implementation was a need for a
customer to get a full DR of the system with their small sized databases
(mysql, pgsql) with the data in /var/lib/... in a consistent way, being
small DBs is safe and fast to get them with the backup in the system, so
is fast full DR when recovered with no extra steps.</p>
<p>Can be changed do PRE_BACKUP_COMMANDS and POST_BACKUP_COMMANDS names
if desired, and where implemented as a pair of variables PRE+POST to
stop services before backup starts (PRE) and start services again after
backup finishes OK or fails, so there is the reason for the exit tasks
of the POST_BACKUP_SCRIPT.</p>
<p>The other reason to not run before and after rear execution is that in
case of mkbackup (mkrescue + mkbackuponly) there is more downtime for
the services stopped during mkrescue with no reason, as they need to be
stopped due to data consistency only during the backup phase.</p>
<p>Hopefully this clarified you your doubts about the decisions that made
us implement this way.</p>
<p>Regards,<br />
Didac</p>
<h4 id="pcahyna_commented_at_2022-06-03_1455"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1146046466">2022-06-03 14:55</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-03_1455" title="Permanent link">&para;</a></h4>
<p>@didacog thank you for your explanation. Do you recall why the decision
to add <code>POST_BACKUP_SCRIPT</code> to exit tasks only when there is a
<code>PRE_BACKUP_SCRIPT</code> defined? The reasoning might be that only if some
command is used before <code>mkbackup</code> to bring the system in a quiet state,
another command is needed to bring it back to the normal state even in
case of errors, otherwise not. But I think that this logic is
overcomplicated and against POLA.</p>
<h4 id="didacog_commented_at_2022-06-07_0918"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148414090">2022-06-07 09:18</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-07_0918" title="Permanent link">&para;</a></h4>
<p>@pcahyna no problem at all to add it at the very beginning of
<code>010_pre_backup_script.sh</code> script instead of inside the IF statement.</p>
<p>Regards,<br />
Didac</p>
<h4 id="jsmeix_commented_at_2022-06-07_0933"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148430695">2022-06-07 09:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-07_0933" title="Permanent link">&para;</a></h4>
<p>No - there is not "no problem at all" here.<br />
It would be an incompatible change when<br />
POST_BACKUP_SCRIPT gets added to EXIT_TASKS in any case<br />
because then things would behave different<br />
in case of an error during backup when a user<br />
has no PRE_BACKUP_SCRIPT but only a POST_BACKUP_SCRIPT.<br />
Then with current code in case of an error during backup<br />
POST_BACKUP_SCRIPT is not run.</p>
<h4 id="didacog_commented_at_2022-06-07_0946"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148445065">2022-06-07 09:46</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-07_0946" title="Permanent link">&para;</a></h4>
<p>@jsmeix, yes will behave different, yes, but is not going to cause any
issue, is just going to allow the <code>POST_BACKUP_SCRIPT</code> to execute anyway
in case of failed backup, even if no <code>PRE_BACKUP_SCRIPT</code>, but is not a
big problem, just a small "change/enhancement" depending of the point of
view. But i was just saying that if you want to change this to allow
only POST to be run anyway in case of error, I do not see problems as
when PRE is going to be present, things would behave the same as now,
IMHO.</p>
<p>Kind regards,<br />
Didac</p>
<h4 id="jsmeix_commented_at_2022-06-07_0948"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148447436">2022-06-07 09:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-07_0948" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/6fcbba895c280c68e8ccf54290348ea845ecf201">https://github.com/rear/rear/commit/6fcbba895c280c68e8ccf54290348ea845ecf201</a><br />
I described in default.conf more clearly<br />
when POST_BACKUP_SCRIPT is normally run or run as exit task<br />
versus when it is not run<br />
with current code.</p>
<h4 id="didacog_commented_at_2022-06-07_0953"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148451549">2022-06-07 09:53</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-07_0953" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Via
<a href="https://github.com/rear/rear/commit/6fcbba895c280c68e8ccf54290348ea845ecf201">6fcbba8</a>
I described in default.conf more clearly when POST_BACKUP_SCRIPT is
normally run or run as exit task versus when it is not run with
current code.</p>
</blockquote>
<p>Yes, I've seen that, is far better explained than before. Just wanted to
clarify to @pcahyna that if wanted to change the behavior of this adding
POST to EXIT_TASKS even if no PRE is present, I would have no
complaints, as it behaves the same when both PRE/POST are present.</p>
<h4 id="pcahyna_commented_at_2022-06-07_1001"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148459369">2022-06-07 10:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-07_1001" title="Permanent link">&para;</a></h4>
<p>@didacog what @jsmeix proposed was, I believe, one of the two:</p>
<ul>
<li>do not translate <code>PRE/POST_BACKUP_SCRIPT</code> to the proposed better
    <code>_COMMANDS</code> syntax at all, and gradually deprecate it (it can be
    replaced by running a command before and after the backup is made
    manually)</li>
<li>translate <code>PRE/POST_BACKUP_SCRIPT</code> to the proposed <code>_COMMANDS</code>
    syntax, but do not add <code>POST_BACKUP_COMMANDS</code> to exit tasks at all,
    because running it even in case of errors is unexpected
    (<code>PRE/POST_RECOVERY</code> stuff does not behave this way).</li>
</ul>
<p>Hopefully I am summarizing the discussion correctly.<br />
If I understand correctly, you have a use for <code>PRE/POST_BACKUP</code> stuff
and you need <code>POST_BACKUP</code> to be run even in case of errors, so those
options do not sound very good to you?</p>
<h4 id="jsmeix_commented_at_2022-06-07_1056"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148511033">2022-06-07 10:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-07_1056" title="Permanent link">&para;</a></h4>
<p>I assume my wording in my above<br />
<a href="https://github.com/rear/rear/pull/2735#issuecomment-1134686196">https://github.com/rear/rear/pull/2735#issuecomment-1134686196</a></p>
<pre><code>... PRE_BACKUP/POST_BACKUP is no needed functionality in ReaR
and we can leave it "rest in peace".
</code></pre>
<p>was misleading because I did not intend to drop it<br />
because I also wrote there</p>
<pre><code>I suggest to leave PRE_BACKUP/POST_BACKUP as is
and only enhance PRE_RECOVERY/POST_RECOVERY by
PRE_RECOVERY_COMMANDS and POST_RECOVERY_COMMANDS
</code></pre>
<p>I meant <code>leave it "rest in peace"</code> literally<br />
i.e. as <code>leave PRE_BACKUP/POST_BACKUP as is</code><br />
and not as "bury it".</p>
<p>With<br />
"PRE_BACKUP/POST_BACKUP is no needed functionality in ReaR"<br />
I meant we do not need to care much about it and enhance it<br />
so we can just leave PRE_BACKUP/POST_BACKUP as is.</p>
<h4 id="didacog_commented_at_2022-06-07_1231"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148603200">2022-06-07 12:31</a>:<a class="headerlink" href="#didacog_commented_at_2022-06-07_1231" title="Permanent link">&para;</a></h4>
<p>Ok, @jsmeix so it is ok to me to keep it as is, or modify it a little as
I explained before, but I'm not agree to deprecate this feature at all.</p>
<h4 id="jsmeix_commented_at_2022-06-07_1246"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2735#issuecomment-1148620157">2022-06-07 12:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-07_1246" title="Permanent link">&para;</a></h4>
<p>I prefer to leave PRE_BACKUP_SCRIPT/POST_BACKUP_SCRIPT as is.</p>
<p>Regarding<br />
adding POST_BACKUP_SCRIPT to EXIT_TASKS<br />
only when PRE_BACKUP_SCRIPT is set:</p>
<p>If a user wants to have POST_BACKUP_SCRIPT added to EXIT_TASKS<br />
but he does not have a PRE_BACKUP_SCRIPT, he can set a dummy</p>
<pre><code>PRE_BACKUP_SCRIPT=( "true" )
</code></pre>
<p>If a user does not want to have POST_BACKUP_SCRIPT added to
EXIT_TASKS<br />
he can prepend a dummy empty first element to his PRE_BACKUP_SCRIPT</p>
<pre><code>PRE_BACKUP_SCRIPT=( '' "COMMANDS" )
</code></pre>
<p>because backup/default/010_pre_backup_script.sh<br />
tests the first element in the PRE_BACKUP_SCRIPT array</p>
<pre><code>... test "$PRE_BACKUP_SCRIPT" ...
</code></pre>
<p>and an empty first element in PRE_BACKUP_SCRIPT<br />
should not cause issues with</p>
<pre><code>eval "${PRE_BACKUP_SCRIPT[@]}"
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-12-28.2735.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
