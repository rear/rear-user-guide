<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2594 Issue closed: rsync connectivity check failed in auto recovery mode in centOS7 with latest rear 2.6 version - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2594 Issue closed: rsync connectivity check failed in auto recovery mode in centOS7 with latest rear 2.6 version";
        var mkdocs_page_input_path = "issues/2021-03-30.2594.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2594 Issue closed: rsync connectivity check failed in auto recovery mode in centOS7 with latest rear 2.6 version</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2594_issue_closed_rsync_connectivity_check_failed_in_auto_recovery_mode_in_centos7_with_latest_rear_26_version"><a href="https://github.com/rear/rear/issues/2594">#2594 Issue</a> <code>closed</code>: rsync connectivity check failed in auto recovery mode in centOS7 with latest rear 2.6 version<a class="headerlink" href="#2594_issue_closed_rsync_connectivity_check_failed_in_auto_recovery_mode_in_centos7_with_latest_rear_26_version" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="cvijayvinoth_opened_issue_at_2021-03-30_1731"><img src="https://avatars.githubusercontent.com/u/426209?v=4" width="50"><a href="https://github.com/cvijayvinoth">cvijayvinoth</a> opened issue at <a href="https://github.com/rear/rear/issues/2594">2021-03-30 17:31</a>:<a class="headerlink" href="#cvijayvinoth_opened_issue_at_2021-03-30_1731" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.6 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
BACKUP=RSYNC
RSYNC_PREFIX="test2_${HOSTNAME}"
BACKUP_PROG="/var/www/html/imageBackup/rsync"
OUTPUT_URL=rsync://test2@XXXXXXXX::rsync_backup
BACKUP_URL=rsync://test2@XXXXXXXX::rsync_backup
ISO_DIR="/var/www/html/imageBackup/iso/$HOSTNAME"
MESSAGE_PREFIX="$$: "
BACKUP_RSYNC_OPTIONS+=(-z --progress --password-file=/etc/rear/rsync_pass)
BACKUP_PROG_EXCLUDE+=( "$(&lt;/etc/rear/path.txt)/imageBackup/iso/*" "$(&lt;/etc/rear/path.txt)/imageBackup/Log/*" "/etc/rear/rsync_pass" )
PROGRESS_MODE="plain"
AUTOEXCLUDE_PATH=( /tmp )
PROGRESS_WAIT_SECONDS="1"
export TMPDIR="/var/www/html/imageBackup/iso/"
PXE_RECOVER_MODE=automatic
ISO_FILES=("/var/www/html/imageBackup/rsync")
ISO_PREFIX="${HOSTNAME}"
ISO_DEFAULT="automatic"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PC</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86 compatible</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    BIOS and GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
</ul>
<!-- -->
<pre><code>NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda               8:0    0 111.8G  0 disk 
├─sda1            8:1    0     1G  0 part /boot
└─sda2            8:2    0 110.8G  0 part 
  ├─centos-root 253:0    0  82.8G  0 lvm  /
  ├─centos-swap 253:1    0     8G  0 lvm  [SWAP]
  └─centos-home 253:2    0    20G  0 lvm  /home
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>It is not working on my rear 2.5 codebase.<br />
So i have installed and tested with rear latest version 2.6 too.</p>
<p>When I run auto recover, on 100_check_rsync.sh<br />
the rsync check protocol connectivity is getting failed and it throw's
error like</p>
<pre><code>Test: rsync --sparse --archive --hard-links --numeric-ids --stats -z --progress --password-file=/etc/rear/rsync_pass rsync://test2@XXXXXX:1873/
446: 2021-03-30 09:46:44.770914837 ERROR: Rsync daemon not running on XXXXXX
</code></pre>
<p>( post this if i run rear -v recover manually it works fine )</p>
<p>If I run auto recover with <strong>debug</strong> mode, on 100_check_rsync.sh<br />
the rsync check protocol connectivity is working fine.<br />
With manual recover option too it works fine.<br />
May I know what might be the issue?<br />
Here I have attached both debug mode and normal auto recovery logs
attached for your reference.</p>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<p><a href="https://github.com/rear/rear/files/6230992/rear-localhost_debug.log">rear-localhost_debug.log</a><br />
<a href="https://github.com/rear/rear/files/6230994/rear-localhost.log">rear-localhost.log</a></p>
<h4 id="jsmeix_commented_at_2021-03-31_0931"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-810922738">2021-03-31 09:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-03-31_0931" title="Permanent link">&para;</a></h4>
<p>Only an offhanded blind guess:</p>
<p>Perhaps a race happens in auto recovery mode where the rsync
connectivity check<br />
is run earlier than the rsync daemon needs to get started up completely?</p>
<p>Some daemons need some startup time to do some initialization work<br />
until the daemon becomes ready to accept actual client connections.</p>
<p>So perhaps adding some sleep time like <code>sleep 10</code> at the beginning of<br />
usr/share/rear/prep/RSYNC/default/100_check_rsync.sh<br />
might help?</p>
<h4 id="cvijayvinoth_commented_at_2021-03-31_0948"><img src="https://avatars.githubusercontent.com/u/426209?v=4" width="50"><a href="https://github.com/cvijayvinoth">cvijayvinoth</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-810933281">2021-03-31 09:48</a>:<a class="headerlink" href="#cvijayvinoth_commented_at_2021-03-31_0948" title="Permanent link">&para;</a></h4>
<p>@jsmeix : Thanks for your reply. Let me check once and update .</p>
<h4 id="cvijayvinoth_commented_at_2021-04-01_0606"><img src="https://avatars.githubusercontent.com/u/426209?v=4" width="50"><a href="https://github.com/cvijayvinoth">cvijayvinoth</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-811668643">2021-04-01 06:06</a>:<a class="headerlink" href="#cvijayvinoth_commented_at_2021-04-01_0606" title="Permanent link">&para;</a></h4>
<p>Yes. Post applying the sleep, it started to work.</p>
<h4 id="gdha_commented_at_2021-04-06_1449"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-814183156">2021-04-06 14:49</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-06_1449" title="Permanent link">&para;</a></h4>
<p>@cvijayvinoth Try to decrease the 'sleep 10' to 'sleep 5' to verify if
that would be sufficient as waiting on the remote rsync daemon. Too much
sleep delays the recovery time in its whole and we do not want users to
press control-C because they think it is hanging for some reason. Thanks
for checking this out for us. We appreciate it ;-)</p>
<h4 id="cvijayvinoth_commented_at_2021-04-09_1435"><img src="https://avatars.githubusercontent.com/u/426209?v=4" width="50"><a href="https://github.com/cvijayvinoth">cvijayvinoth</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-816727979">2021-04-09 14:35</a>:<a class="headerlink" href="#cvijayvinoth_commented_at_2021-04-09_1435" title="Permanent link">&para;</a></h4>
<p>Sure @gdha : Thanks for your reply and support.</p>
<h4 id="cvijayvinoth_commented_at_2021-04-15_1417"><img src="https://avatars.githubusercontent.com/u/426209?v=4" width="50"><a href="https://github.com/cvijayvinoth">cvijayvinoth</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-820457526">2021-04-15 14:17</a>:<a class="headerlink" href="#cvijayvinoth_commented_at_2021-04-15_1417" title="Permanent link">&para;</a></h4>
<p>@gdha : Its working fine with sleep 5. Thanks a lot...</p>
<h4 id="gdha_commented_at_2021-04-15_1419"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-820459058">2021-04-15 14:19</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-15_1419" title="Permanent link">&para;</a></h4>
<p>@cvijayvinoth Thanks for the check on your side and in the meantime a PR
is waiting to update this in our master branch.</p>
<h4 id="jsmeix_commented_at_2021-04-16_0834"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-821016140">2021-04-16 08:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-16_0834" title="Permanent link">&para;</a></h4>
<p>Only FYI:</p>
<p>I do no longer understand my "offhanded blind guess" in<br />
<a href="https://github.com/rear/rear/issues/2594#issuecomment-810922738">https://github.com/rear/rear/issues/2594#issuecomment-810922738</a></p>
<p>Reason (as fas as I imagine how things are):</p>
<p>When "rear recover" errors out in 100_check_rsync.sh with</p>
<pre><code>"Rsync daemon not running on $RSYNC_HOST"
</code></pre>
<p>it is about the rsync daemon on the remote RSYNC_HOST<br />
(or do I misunderstand something here?)<br />
and I do not understand how a <code>sleep 5</code> on the machine where "rear
recover" is running<br />
could have any "positive effect" on the rsync daemon on the remote
RSYNC_HOST.</p>
<p>A <code>sleep 5</code> on the machine where "rear recover" is running must be
related<br />
to something on the machine where "rear recover" is running<br />
that needs some time.<br />
Currently I don't know what that "something" could be.<br />
My next "offhanded blind guess" what that "something" could be<br />
is "something network related" on the machine where "rear recover" is
running.</p>
<p>So perhaps in general with things like <code>PXE_RECOVER_MODE=automatic</code><br />
or any other automated run of "rear recover" we should perhaps have<br />
a general <code>sleep 5</code> delay before "rear recover" is launched
automatically<br />
to be more on the safe side that all network related stuff is ready to
be used<br />
on the machine where "rear recover" is running?</p>
<h4 id="jsmeix_commented_at_2021-05-03_1018"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2594#issuecomment-831166002">2021-05-03 10:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-03_1018" title="Permanent link">&para;</a></h4>
<p>Seems to be fixed via
<a href="https://github.com/rear/rear/pull/2599">https://github.com/rear/rear/pull/2599</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-03-30.2594.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
