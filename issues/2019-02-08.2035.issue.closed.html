<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2035 Issue closed: 'rear recover' hangs while running mkinitrd (bind mount of /run missing in TARGET_FS_ROOT) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2035 Issue closed: \u0027rear recover\u0027 hangs while running mkinitrd (bind mount of /run missing in TARGET_FS_ROOT)";
        var mkdocs_page_input_path = "issues/2019-02-08.2035.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2035 Issue closed: 'rear recover' hangs while running mkinitrd (bind mount of /run missing in TARGET_FS_ROOT)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2035_issue_closed_rear_recover_hangs_while_running_mkinitrd_bind_mount_of_run_missing_in_target_fs_root"><a href="https://github.com/rear/rear/issues/2035">#2035 Issue</a> <code>closed</code>: 'rear recover' hangs while running mkinitrd (bind mount of /run missing in TARGET_FS_ROOT)<a class="headerlink" href="#2035_issue_closed_rear_recover_hangs_while_running_mkinitrd_bind_mount_of_run_missing_in_target_fs_root" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="procurve86_opened_issue_at_2019-02-08_1531"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> opened issue at <a href="https://github.com/rear/rear/issues/2035">2019-02-08 15:31</a>:<a class="headerlink" href="#procurve86_opened_issue_at_2019-02-08_1531" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    Red Hat Enterprise Linux Server release 7.6 (Maipo)</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>MODULES=( 'all_modules' )
FIRMWARE_FILES=( 'yes' )
OUTPUT=ISO
BACKUP=NETFS
NETFS_KEEP_OLD_BACKUP_COPY=no
EXCLUDE_RECREATE=( '/dev/sdc' )
BACKUP_PROG_EXCLUDE=( '/u02/*' )
NETFS_URL=nfs://10.1.30.20/u02/rear_backups
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    HPE DL380 Gen10</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI</p>
</li>
<li>
<p>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local SSD's</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    When executing rear recover (on the same machine where the backup
    was created) everything works as expected until its says "Running
    mkinitrd...".<br />
    At this point it gets stuck. After 30 minutes I've aborted with
    CTRL+C.</p>
</li>
</ul>
<p>Below the a part of the log while where it gets stuck:</p>
<pre><code>+++ cat /tmp/rear.sX7R9psO2ZewG3R/tmp/storage_drivers
++ NEW_INITRD_MODULES=($(tr " " "\n" &lt;&lt;&lt; "${NEW_INITRD_MODULES[*]}" | sort | uniq -u))
+++ tr ' ' '\n'
+++ sort
+++ uniq -u
++ Log 'New INITRD_MODULES='\'' scsi_transport_sas' sd_mod ses sg smartpqi sr_mod 'uas'\'''
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:10:38.119409143 '
++ test 7 -gt 0
++ echo '2019-02-08 15:10:38.119409143 New INITRD_MODULES='\'' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'\'''
2019-02-08 15:10:38.119409143 New INITRD_MODULES=' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'
++ INITRD_MODULES=' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'
+++ printf '%s\n' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas
+++ awk '{printf "--with=%s ", $1}'
++ WITH_INITRD_MODULES='--with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas '
++ mount -t proc none /mnt/local/proc
++ mount -t sysfs none /mnt/local/sys
++ unalias ls
+++ egrep -v '(kdump|rescue|plymouth)'
+++ ls /mnt/local/boot/initramfs-0-rescue-d7ce629be5bf4c0a95967a86593f7968.img /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64kdump.img /mnt/local/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img /mnt/local/boot/initramfs-4.1.12-124.25.1.el7uek.x86_64.img /mnt/local/boot/initramfs-4.1.12-124.25.1.el7uek.x86_64kdump.img /mnt/local/boot/initramfs-4.1.12-94.3.9.el7uek.x86_64.img /mnt/local/boot/initramfs-4.1.12-94.3.9.el7uek.x86_64kdump.img /mnt/local/boot/initrd-plymouth.img
++ for INITRD_IMG in '$( ls $TARGET_FS_ROOT/boot/initramfs-*.img $TARGET_FS_ROOT/boot/initrd-*.img | egrep -v '\''(kdump|rescue|plymouth)'\'' )'
+++ cut -f2- -d-
+++ sed 's/\.img//'
++++ echo /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
+++ basename /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
++ kernel_version=3.10.0-693.el7.x86_64
+++ echo /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
+++ egrep -o '/boot/.*'
++ INITRD=/boot/initramfs-3.10.0-693.el7.x86_64.img
++ LogPrint 'Running mkinitrd...'
++ Log 'Running mkinitrd...'
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:10:38.133292052 '
++ test 1 -gt 0
++ echo '2019-02-08 15:10:38.133292052 Running mkinitrd...'
2019-02-08 15:10:38.133292052 Running mkinitrd...
++ Print 'Running mkinitrd...'
++ test 1
++ echo -e 'Running mkinitrd...'
+++ chroot /mnt/local /bin/bash -c 'PATH=/sbin:/usr/sbin:/usr/bin:/bin type -P mkinitrd'
++ local mkinitrd_binary=/usr/bin/mkinitrd
++ test /usr/bin/mkinitrd
++ chroot /mnt/local /usr/bin/mkinitrd -v -f --with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64
Executing: /sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64
++ LogPrint 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
</code></pre>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<h4 id="gozora_commented_at_2019-02-08_1911"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-461912538">2019-02-08 19:11</a>:<a class="headerlink" href="#gozora_commented_at_2019-02-08_1911" title="Permanent link">&para;</a></h4>
<p>Did yo try to check the log file mentioned?<br />
Can you try running
<code>chroot /mnt/local /usr/bin/mkinitrd -v -f --with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64</code>
manually when <code>rear recover</code> finished?</p>
<p>V.</p>
<h4 id="procurve86_commented_at_2019-02-11_0702"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462233731">2019-02-11 07:02</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-11_0702" title="Permanent link">&para;</a></h4>
<p>Hi gozora</p>
<p>thanks for your support.<br />
Rear recover hangs while "Running mkinitrd..." and never gets finished.</p>
<p>I've stopped the process using CRTL+C.<br />
Then I've manually executed the command you mentioned and it was
successful. It took 37 seconds to complete.</p>
<p>I've add some debug echos.</p>
<p>It seems that it hangs in 550_rebuild_initramfs.sh at following code
line:</p>
<p>if chroot $TARGET_FS_ROOT $mkinitrd_binary -v -f
${WITH_INITRD_MODULES[@]} $INITRD $kernel_version &gt;&2; then</p>
<p>Regards</p>
<h4 id="gozora_commented_at_2019-02-11_0849"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462253501">2019-02-11 08:49</a>:<a class="headerlink" href="#gozora_commented_at_2019-02-11_0849" title="Permanent link">&para;</a></h4>
<p>@procurve86<br />
It would be helpful if you could post here output from
<code>rear -d -D recover</code> from the hanged session.</p>
<p>V.</p>
<h4 id="procurve86_commented_at_2019-02-11_0856"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462254983">2019-02-11 08:56</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-11_0856" title="Permanent link">&para;</a></h4>
<p>Below the debug output:</p>
<pre><code>2019-02-08 15:10:38.107691837 Entering debugscripts mode via 'set -x'.
+ source /usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
++ is_false yes
++ case "$1" in
++ return 1
++ is_true yes
++ case "$1" in
++ return 0
++ have_udev
++ test -d /etc/udev/rules.d
++ has_binary udevadm udevtrigger udevsettle udevinfo udevstart
++ for bin in '$@'
++ type udevadm
++ return 0
++ return 0
++ '[' -f /var/lib/rear/recovery/initrd_modules ']'
++ OLD_INITRD_MODULES=($(cat $VAR_DIR/recovery/initrd_modules))
+++ cat /var/lib/rear/recovery/initrd_modules
++ Log 'Original OLD_INITRD_MODULES='\'''\'''
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:10:38.114451579 '
++ test 1 -gt 0
++ echo '2019-02-08 15:10:38.114451579 Original OLD_INITRD_MODULES='\'''\'''
2019-02-08 15:10:38.114451579 Original OLD_INITRD_MODULES=''
++ NEW_INITRD_MODULES=(${OLD_INITRD_MODULES[@]} ${OLD_INITRD_MODULES[@]} $( cat $TMP_DIR/storage_drivers ))
+++ cat /tmp/rear.sX7R9psO2ZewG3R/tmp/storage_drivers
++ NEW_INITRD_MODULES=($(tr " " "\n" &lt;&lt;&lt; "${NEW_INITRD_MODULES[*]}" | sort | uniq -u))
+++ tr ' ' '\n'
+++ sort
+++ uniq -u
++ Log 'New INITRD_MODULES='\'' scsi_transport_sas' sd_mod ses sg smartpqi sr_mod 'uas'\'''
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:10:38.119409143 '
++ test 7 -gt 0
++ echo '2019-02-08 15:10:38.119409143 New INITRD_MODULES='\'' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'\'''
2019-02-08 15:10:38.119409143 New INITRD_MODULES=' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'
++ INITRD_MODULES=' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas'
+++ printf '%s\n' scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas
+++ awk '{printf "--with=%s ", $1}'
++ WITH_INITRD_MODULES='--with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas '
++ mount -t proc none /mnt/local/proc
++ mount -t sysfs none /mnt/local/sys
++ unalias ls
+++ egrep -v '(kdump|rescue|plymouth)'
+++ ls /mnt/local/boot/initramfs-0-rescue-d7ce629be5bf4c0a95967a86593f7968.img /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64kdump.img /mnt/local/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img /mnt/local/boot/initramfs-4.1.12-124.25.1.el7uek.x86_64.img /mnt/local/boot/initramfs-4.1.12-124.25.1.el7uek.x86_64kdump.img /mnt/local/boot/initramfs-4.1.12-94.3.9.el7uek.x86_64.img /mnt/local/boot/initramfs-4.1.12-94.3.9.el7uek.x86_64kdump.img /mnt/local/boot/initrd-plymouth.img
++ for INITRD_IMG in '$( ls $TARGET_FS_ROOT/boot/initramfs-*.img $TARGET_FS_ROOT/boot/initrd-*.img | egrep -v '\''(kdump|rescue|plymouth)'\'' )'
+++ cut -f2- -d-
+++ sed 's/\.img//'
++++ echo /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
+++ basename /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
++ kernel_version=3.10.0-693.el7.x86_64
+++ echo /mnt/local/boot/initramfs-3.10.0-693.el7.x86_64.img
+++ egrep -o '/boot/.*'
++ INITRD=/boot/initramfs-3.10.0-693.el7.x86_64.img
++ LogPrint 'Running mkinitrd...'
++ Log 'Running mkinitrd...'
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:10:38.133292052 '
++ test 1 -gt 0
++ echo '2019-02-08 15:10:38.133292052 Running mkinitrd...'
2019-02-08 15:10:38.133292052 Running mkinitrd...
++ Print 'Running mkinitrd...'
++ test 1
++ echo -e 'Running mkinitrd...'
+++ chroot /mnt/local /bin/bash -c 'PATH=/sbin:/usr/sbin:/usr/bin:/bin type -P mkinitrd'
++ local mkinitrd_binary=/usr/bin/mkinitrd
++ test /usr/bin/mkinitrd
++ chroot /mnt/local /usr/bin/mkinitrd -v -f --with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64
Executing: /sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64
++ LogPrint 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
++ Log 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:12:01.099743557 '
++ test 1 -gt 0
++ echo '2019-02-08 15:12:01.099743557 WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
2019-02-08 15:12:01.099743557 WARNING:
Failed to create initrd for kernel version '3.10.0-693.el7.x86_64'.
Check '/var/log/rear/rear-bosarip1.log' to see the error messages in detail
and decide yourself, whether the system will boot or not.

++ Print 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
++ test 1
++ echo -e 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-693.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
++ for INITRD_IMG in '$( ls $TARGET_FS_ROOT/boot/initramfs-*.img $TARGET_FS_ROOT/boot/initrd-*.img | egrep -v '\''(kdump|rescue|plymouth)'\'' )'
+++ cut -f2- -d-
+++ sed 's/\.img//'
++++ echo /mnt/local/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img
+++ basename /mnt/local/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img
++ kernel_version=3.10.0-957.5.1.el7.x86_64
+++ egrep -o '/boot/.*'
+++ echo /mnt/local/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img
++ INITRD=/boot/initramfs-3.10.0-957.5.1.el7.x86_64.img
++ LogPrint 'Running mkinitrd...'
++ Log 'Running mkinitrd...'
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:12:01.159119863 '
++ test 1 -gt 0
++ echo '2019-02-08 15:12:01.159119863 Running mkinitrd...'
2019-02-08 15:12:01.159119863 Running mkinitrd...
++ Print 'Running mkinitrd...'
++ test 1
++ echo -e 'Running mkinitrd...'
+++ chroot /mnt/local /bin/bash -c 'PATH=/sbin:/usr/sbin:/usr/bin:/bin type -P mkinitrd'
++ local mkinitrd_binary=/usr/bin/mkinitrd
++ test /usr/bin/mkinitrd
++ chroot /mnt/local /usr/bin/mkinitrd -v -f --with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64
Executing: /sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64
++ LogPrint 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-957.5.1.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
++ Log 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-957.5.1.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
+++ date '+%Y-%m-%d %H:%M:%S.%N '
++ local 'timestamp=2019-02-08 15:12:19.979411963 '
++ test 1 -gt 0
++ echo '2019-02-08 15:12:19.979411963 WARNING:
Failed to create initrd for kernel version '\''3.10.0-957.5.1.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
2019-02-08 15:12:19.979411963 WARNING:
Failed to create initrd for kernel version '3.10.0-957.5.1.el7.x86_64'.
Check '/var/log/rear/rear-bosarip1.log' to see the error messages in detail
and decide yourself, whether the system will boot or not.

++ Print 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-957.5.1.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
'
++ test 1
++ echo -e 'WARNING:
Failed to create initrd for kernel version '\''3.10.0-957.5.1.el7.x86_64'\''.
Check '\''/var/log/rear/rear-bosarip1.log'\'' to see the error messages in detail
and decide yourself, whether the system will boot or not.
</code></pre>
<h4 id="gozora_commented_at_2019-02-11_0958"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462271135">2019-02-11 09:58</a>:<a class="headerlink" href="#gozora_commented_at_2019-02-11_0958" title="Permanent link">&para;</a></h4>
<p>@procurve86</p>
<p>I don't see anything obviously wrong in provided logs. But somehow I
doubt that this is problem with ReaR. Maybe you can try to re-run
recovery without</p>
<pre><code>MODULES=( 'all_modules' ) 
FIRMWARE_FILES=( 'yes' )
</code></pre>
<p>When I have a bit of time, I'll try to download RHEL and reproduce your
problem with provided configuration.</p>
<p>I'll keep you posted.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2019-02-11_1001"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462272096">2019-02-11 10:01</a>:<a class="headerlink" href="#gozora_commented_at_2019-02-11_1001" title="Permanent link">&para;</a></h4>
<p>@rmetrich I've dared to assign you here just because this is RHEL, maybe
it might be useful for you if similar problem arises in future ...</p>
<p>V.</p>
<h4 id="rmetrich_commented_at_2019-02-11_1008"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-462273975">2019-02-11 10:08</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-02-11_1008" title="Permanent link">&para;</a></h4>
<p>Hi @procurve86 , are you a Red Hat customer? If so we should work on
this internally then report the status here.<br />
Also, what happens when you enter the chroot after recovery and execute
the following command:</p>
<pre><code>/sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64
</code></pre>
<h4 id="procurve86_commented_at_2019-02-14_0837"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463540037">2019-02-14 08:37</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-14_0837" title="Permanent link">&para;</a></h4>
<p>@gozora</p>
<p>It still gets stuck when I remove</p>
<pre><code>MODULES=( 'all_modules' ) 
FIRMWARE_FILES=( 'yes' )
</code></pre>
<h4 id="jsmeix_commented_at_2019-02-14_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463564530">2019-02-14 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-14_0954" title="Permanent link">&para;</a></h4>
<p>@procurve86<br />
to get the contents of the recovery system noticeable smaller<br />
you need to explicitly specify that e.g. via</p>
<pre><code>MODULES=( 'loaded_modules' ) 
FIRMWARE_FILES=( 'no' )
</code></pre>
<p>see the description of each one of the config variables in<br />
usr/share/rear/conf/default.conf also available online at<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/default.conf">https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/default.conf</a></p>
<p>For some comparison how much space the recovery system ISO image<br />
may need (it is compressed therein) see "Space requirements" at<br />
<a href="https://github.com/rear/rear/issues/2041#issue-409740875">https://github.com/rear/rear/issues/2041#issue-409740875</a></p>
<p>To inspect the contents of the recovery system use <code>KEEP_BUILD_DIR</code><br />
(see its description in default.conf) so that you could also<br />
<code>chroot</code> into TMPDIR/rear.XXXXXXXXXXXXXXX/rootfs/<br />
to try out things inside the recovery system.</p>
<h4 id="procurve86_commented_at_2019-02-14_0954"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463564720">2019-02-14 09:54</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-14_0954" title="Permanent link">&para;</a></h4>
<p>Hi @rmetrich</p>
<p>We're using Oracle Linux but we also do have a Red Hat Subscription.</p>
<p>When I run</p>
<p><code>/sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64</code></p>
<p>It sais -bash: /sbin/dracut: No such file or directory</p>
<h4 id="rmetrich_commented_at_2019-02-14_1006"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463568779">2019-02-14 10:06</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-02-14_1006" title="Permanent link">&para;</a></h4>
<p>@procurve86 it's <code>/usr/bin/dracut</code><br />
When entering the chroot, make sure to mount the procfs first:</p>
<pre><code>export TARGET_FS_ROOT=/mnt/local
mount -t proc none $TARGET_FS_ROOT/proc 
mount -t sysfs sys $TARGET_FS_ROOT/sys
mount -o bind /dev $TARGET_FS_ROOT/dev
</code></pre>
<h4 id="procurve86_commented_at_2019-02-14_1019"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463573035">2019-02-14 10:19</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-14_1019" title="Permanent link">&para;</a></h4>
<p>@rmetrich</p>
<p>thank you.<br />
What i did:</p>
<pre><code>export TARGET_FS_ROOT=/mnt/local
mount -t proc none $TARGET_FS_ROOT/proc 
mount -t sysfs sys $TARGET_FS_ROOT/sys
mount -o bind /dev $TARGET_FS_ROOT/dev
chroot $TARGET_FS_ROOT
/sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64
</code></pre>
<p>And now I do have the same problem as when I run rear recover.<br />
Its hanging!</p>
<p>After a few minutes i did get some output regarding missing modules:</p>
<p><code>dracut module 'busybox' will not be installed, because command 'busybox' could not be found! dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!</code></p>
<p>Nevertheless the command is still hanging...</p>
<h4 id="procurve86_commented_at_2019-02-14_1049"><img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"><a href="https://github.com/procurve86">procurve86</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463582250">2019-02-14 10:49</a>:<a class="headerlink" href="#procurve86_commented_at_2019-02-14_1049" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Thanks for your hint - I'm going to test it this afternoon</p>
<h4 id="rmetrich_commented_at_2019-02-14_1054"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2035#issuecomment-463583704">2019-02-14 10:54</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-02-14_1054" title="Permanent link">&para;</a></h4>
<p>@procurve86 Please run with following arguments and provide
<code>/mnt/local/tmp/dracut.out</code>:</p>
<pre><code>/usr/bin/dracut --debug -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64 &gt;/tmp/dracut.out 2&gt;&amp;1


#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-14 12:21](https://github.com/rear/rear/issues/2035#issuecomment-463607461):

@rmetrich 
Please find dracut.out attached to this post.
After 1.5h I've aborted the hanging command...

[dracut.out.txt](https://github.com/rear/rear/files/2864923/dracut.out.txt)

#### &lt;img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&amp;v=4" width="50"&gt;[rmetrich](https://github.com/rmetrich) commented at [2019-02-14 12:36](https://github.com/rear/rear/issues/2035#issuecomment-463611762):

Looks like `lvm vgs --noheadings -o pv_name VolGroup_System` is hanging.
Can you strace the command?

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-14 14:46](https://github.com/rear/rear/issues/2035#issuecomment-463653471):

@jsmeix

When I disable FIRMWARE_FILES, the driver for the 25G Network Adapter is missing.

@rmetrich

When I run:

`/usr/sbin/lvm vgs --noheadings -o pv_name VolGroup_System`

It takes a long time but gets finished

with the following output:

```WARNING: Failed to connect to lvmetad. Falling back to device scanning.
  WARNING: Device /dev/sda not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_u01 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda1 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_swap not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda2 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_var not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda3 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_usr not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_tmp not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_root not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sdb not initialized in udev database even after waiting 10000000 microseconds.
  /dev/sdc: open failed: No medium found
  WARNING: Device /dev/VolGroup_System/LogVol_u01 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda1 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_swap not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda2 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_var not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sda3 not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_usr not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_tmp not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/VolGroup_System/LogVol_root not initialized in udev database even after waiting 10000000 microseconds.
  WARNING: Device /dev/sdb not initialized in udev database even after waiting 10000000 microseconds.
  /dev/sda3```

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-14 18:58](https://github.com/rear/rear/issues/2035#issuecomment-463748941):

@procurve86

can you do following bind mount on top of  @rmetrich:

&gt; ```
&gt; export TARGET_FS_ROOT=/mnt/local
&gt; mount -t proc none $TARGET_FS_ROOT/proc 
&gt; mount -t sysfs sys $TARGET_FS_ROOT/sys
&gt; mount -o bind /dev $TARGET_FS_ROOT/dev
&gt; ```

```
mount --bind /run $TARGET_FS_ROOT/run
```
and run again:

```
chroot $TARGET_FS_ROOT
/sbin/dracut -v -f --add-drivers " scsi_transport_sas sd_mod ses sg smartpqi sr_mod uas" /boot/initramfs-3.10.0-957.5.1.el7.x86_64.img 3.10.0-957.5.1.el7.x86_64
```

and let us know if `dracut` runs faster this time?

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-15 06:20](https://github.com/rear/rear/issues/2035#issuecomment-463922300):

@gozora

`mount --bind /run $TARGET_FS_ROOT/run`

does the trick!  👍

How can we force this in the recovery process?

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-15 07:53](https://github.com/rear/rear/issues/2035#issuecomment-463942102):

@procurve86 
see your https://github.com/rear/rear/issues/2035#issuecomment-462254983
```
+ source /usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
...
++ mount -t proc none /mnt/local/proc
++ mount -t sysfs none /mnt/local/sys
...
++ chroot /mnt/local /usr/bin/mkinitrd -v -f --with=scsi_transport_sas --with=sd_mod --with=ses --with=sg --with=smartpqi --with=sr_mod --with=uas /boot/initramfs-3.10.0-693.el7.x86_64.img 3.10.0-693.el7.x86_64
```
I.e. enhance your /usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
to mount whatever additionally needed things you need in your particular case.

Then redo "rear mkrescue/mkbackup" to get your enhanced
finalize/Fedora/i386/550_rebuild_initramfs.sh script into the
ReaR recovery system so that it works during "rear recover".

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-15 07:54](https://github.com/rear/rear/issues/2035#issuecomment-463942391):

@procurve86

You can try following patch:

```
diff --git a/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh b/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
index 40ccce92..4f3bf146 100644
--- a/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
+++ b/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
@@ -66,6 +66,11 @@ WITH_INITRD_MODULES=$( printf '%s\n' ${INITRD_MODULES[@]} | awk '{printf "--with
 mount -t proc none $TARGET_FS_ROOT/proc
 mount -t sysfs none $TARGET_FS_ROOT/sys

+if mountpoint -q /run &amp;&amp; ! mountpoint -q $TARGET_FS_ROOT/run; then
+  mkdir -p $TARGET_FS_ROOT/run
+  mount --bind /run $TARGET_FS_ROOT/run
+fi
+
 # Recreate any initrd or initramfs image under $TARGET_FS_ROOT/boot/ with new drivers
 # Images ignored:
 # kdump images as they are build by kdump
```

It tells ReaR to mount _/run_ into $TARGET_FS_ROOT/run if something is mounted on _/run_ and _$TARGET_FS_ROOT/run_ is not yet mounted, I did not test it though, so good luck ;-)

To test it should be enough to boot your ReaR recovery system and add previously listed 5 lines into _/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh_

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-15 07:56](https://github.com/rear/rear/issues/2035#issuecomment-463942941):

@jsmeix this time you was quicker 🥇 !

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-15 08:07](https://github.com/rear/rear/issues/2035#issuecomment-463945426):

@gozora 
yes this time by luck, but what a poor win of me ;-)
Of course you had the real win because you found the actual solution :-)

I wonder how you had the idea that bind mount of /run is missing here.
I would assume that running a program within `chroot $TARGET_FS_ROOT`
should not need anything from the `/run` directory of the "parent" system.

@gozora @rmetrich 
could you perhaps explain what `chroot /mnt/local /usr/bin/mkinitrd`
needs from the `/run` directory of the "parent" system?

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-15 08:17](https://github.com/rear/rear/issues/2035#issuecomment-463947934):

Perhaps in this case here something is not right
with the `run` directory in $TARGET_FS_ROOT?

For comparison:
On my SLES12-like openSUSE Leap 15.0 system "rear mkrescue" results
var/lib/rear/recovery/directories_permissions_owner_group
that contains for `run` those entries
```
/run 755 root root
/var/lock -&gt; /run/lock
/var/run -&gt; /run
```
cf. usr/share/rear/prep/default/400_save_directories.sh
and usr/share/rear/restore/default/900_create_missing_directories.sh
and DIRECTORY_ENTRIES_TO_RECOVER

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-15 08:24](https://github.com/rear/rear/issues/2035#issuecomment-463949782):

@jsmeix

&gt; I wonder how you had the idea that bind mount of /run is missing here.
&gt; I would assume that running a program within `chroot $TARGET_FS_ROOT`
&gt; should not need anything from the `/run` directory of the "parent" system.

I was just running `strace` on `lvs` commands and checking what files are accessed.

Just a blind guess, but since RedHat is always using cutting edge LVM versions, can it be that we are dealing here with some new LVM feature ?

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-15 08:30](https://github.com/rear/rear/issues/2035#issuecomment-463951425):

@jsmeix

&gt; Perhaps in this case here something is not right
&gt; with the `run` directory in $TARGET_FS_ROOT?
&gt; ...

I guess that this code just creates _$TARGET_FS_ROOT/run_, but it is empty.

`strace` showed me that LVM tried to access files (most probably created by systemd-udevd) in _/run/udev/data/_ ...

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-15 08:37](https://github.com/rear/rear/issues/2035#issuecomment-463953344):

@rmetrich 
Just FYI, if you are interested in reproducing this problem (on RHEL 7.6) on running system (not sure if it is reproducible on other distros):
1. remove /run/udev (`rm /run/udev`)
2. restart lvmetad
3. run `lvs`

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-15 08:39](https://github.com/rear/rear/issues/2035#issuecomment-463953847):

Yes, usr/share/rear/restore/default/900_create_missing_directories.sh
only creates empty directories inside $TARGET_FS_ROOT as specified in
var/lib/rear/recovery/directories_permissions_owner_group
e.g. also for `sys` and `dev`
```
# egrep 'sys|dev' var/lib/rear/recovery/directories_permissions_owner_group
/dev 755 root root
/sys 555 root root
```

#### &lt;img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&amp;v=4" width="50"&gt;[rmetrich](https://github.com/rmetrich) commented at [2019-02-15 08:53](https://github.com/rear/rear/issues/2035#issuecomment-463957796):

@gozora Thanks, will do

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-18 14:29](https://github.com/rear/rear/issues/2035#issuecomment-464751059):

@gozora

Thanks you for your patch.
Unfortunately its not working, because the command mountpoint is not available on the recovery system.

What am I doing wrong?

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-18 14:49](https://github.com/rear/rear/issues/2035#issuecomment-464758609):

Crap! This is what you get without testing ...

Just for testing purposes, try this one (just remove the condition with `mountpoint`):

```
diff --git a/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh b/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
index 40ccce92..4f3bf146 100644
--- a/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
+++ b/usr/share/rear/finalize/Fedora/i386/550_rebuild_initramfs.sh
@@ -66,6 +66,11 @@ WITH_INITRD_MODULES=$( printf '%s\n' ${INITRD_MODULES[@]} | awk '{printf "--with
 mount -t proc none $TARGET_FS_ROOT/proc
 mount -t sysfs none $TARGET_FS_ROOT/sys

+  mkdir -p $TARGET_FS_ROOT/run
+  mount --bind /run $TARGET_FS_ROOT/run
+
 # Recreate any initrd or initramfs image under $TARGET_FS_ROOT/boot/ with new drivers
 # Images ignored:
 # kdump images as they are build by kdump
```

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-18 14:59](https://github.com/rear/rear/issues/2035#issuecomment-464763082):

@gozora

Without conditions it's working :)
So for the moment we need to adjust the script on all 7.6 servers? 
Or is it possible to get a rpm with the fix included?

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-18 15:24](https://github.com/rear/rear/issues/2035#issuecomment-464773208):

What nice coincidence - I was hit by the same right now while
implementing https://github.com/rear/rear/issues/2045
```
mountpoint no such file or directory
```

@procurve86 
have in your etc/rear/local.conf
```
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" mountpoint )
```
to enforce it into the recovery system, see 'default.conf'.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-18 15:50](https://github.com/rear/rear/issues/2035#issuecomment-464784658):

@procurve86

&gt; So for the moment we need to adjust the script on all 7.6 servers?
&gt; Or is it possible to get a rpm with the fix included?

There is a good chance that this will be fixed  in ReaR 2.5.
So if you wait until than, you don't need to patch anything ...

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-18 15:52](https://github.com/rear/rear/issues/2035#issuecomment-464785452):

Looks like PR https://github.com/rear/rear/pull/2047 that should fix this is born ..

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-19 09:26](https://github.com/rear/rear/issues/2035#issuecomment-465054671):

@gozora @rmetrich @jsmeix

Thanks a lot for your support - you're awesome!

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-19 14:47](https://github.com/rear/rear/issues/2035#issuecomment-465158105):

@procurve86 
of course we are! ;-))

You could do me a big favour and test if
https://github.com/rear/rear/pull/2047
makes things work for you on RHEL 7.6, cf.
https://github.com/rear/rear/pull/2047#issuecomment-465136524

How to do such a test:

Basically "git clone" my current code from https://github.com/rear/rear/pull/2047
into a separated directory and then configure and run ReaR
from within that directory, cf.
https://github.com/rear/rear/pull/2047#issuecomment-465123176
e.g. something like:
```
# git clone https://github.com/jsmeix/rear.git

# mv rear rear.jsmeix

# cd rear.jsmeix

# git branch -a

# git checkout remotes/origin/bind_mount_proc_sys_dev_run_at_one_place_issue2045

# vi etc/rear/local.conf

# usr/sbin/rear -D mkbackup
```
Note the relative paths "etc/rear/" and "usr/sbin/".

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-20 14:37](https://github.com/rear/rear/issues/2035#issuecomment-465602717):

@jsmeix

sure :)
I've tested #2047 on RHEL 7.6

Strange, it seems that mkinitrd has worked but I get the following message:
![rear_warning](https://user-images.githubusercontent.com/20219180/53099158-7a188480-3525-11e9-84c1-7b82310ed9b2.png)

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-20 16:06](https://github.com/rear/rear/issues/2035#issuecomment-465642305):

@procurve86 looks like a bug ;-), I've submitted https://github.com/rear/rear/pull/2051 to fix this ...

Thanks for reporting!

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-20 16:54](https://github.com/rear/rear/issues/2035#issuecomment-465663479):

@procurve86 
thank you so much for testing it.
It helps us so much to find such hidden issues as
https://github.com/rear/rear/issues/2035#issuecomment-465602717

Could you attach the "rear -D recover" log file of that failed attempt in
https://github.com/rear/rear/issues/2035#issuecomment-465602717
so that we can see the exact details why it fails in your case.

Cf. "Debugging issues with Relax-and-Recover" in
https://en.opensuse.org/SDB:Disaster_Recovery

When you change your
usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh
(it was  usr/share/rear/finalize/Linux-i386/630_run_efibootmgr.sh before)
as @gozora did in
https://github.com/rear/rear/pull/2051/files#diff-50b1e7333a3c6fa5c0d8a2409ca686f3
and re-do "rear mkrescue" and then again a "rear recover"
does then "rear recover" work in your case?

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-20 18:31](https://github.com/rear/rear/issues/2035#issuecomment-465699764):

@jsmeix, @procurve86 
Here is what is happening in current ReaR master code:
```
+ source /usr/share/rear/finalize/Linux-i386/630_run_efibootmgr.sh
++ is_true 1
++ case "$1" in
++ return 0
++ is_true no
++ case "$1" in
++ return 1
++ test -f /boot/efi/EFI/redhat/grubx64.efi  &lt;=== problematic test
++ return 0
+ source_return_code=0
+ test 0 -eq 0
+ test 1
```

_630_run_efibootmgr.sh_ then later creates UEFI boot entry and sets `NOBOOTLOADER=''`, but since we've returned prematurely, boot entry will not be created and keeps `NOBOOTLOADER=1`, which will later result to warning message mentioned in https://github.com/rear/rear/issues/2035#issuecomment-465602717.

With #2051 same condition looks like this:
```
+ source /usr/share/rear/finalize/Linux-i386/630_run_efibootmgr.sh
++ is_true 1
++ case "$1" in
++ return 0
++ is_true no
++ case "$1" in
++ return 1
++ test -f /mnt/local//boot/efi/EFI/redhat/grubx64.efi &lt;=== now checking in /mnt/local/
+++ df -P /mnt/local//boot/efi/EFI/redhat/grubx64.efi
+++ tail -1
+++ awk '{print $6}'
++ esp_mountpoint=/mnt/local/boot/efi
++ test /mnt/local/boot/efi
++ test -d /mnt/local/boot/efi
+++ mount
+++ grep /mnt/local/boot/efi
...
```

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&amp;v=4" width="50"&gt;[gozora](https://github.com/gozora) commented at [2019-02-20 18:35](https://github.com/rear/rear/issues/2035#issuecomment-465701188):

In general it makes no sense to work with $UEFI_BOOTLOADER variable **when restoring**, unless we are inside of `chroot`.

V.

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-21 08:20](https://github.com/rear/rear/issues/2035#issuecomment-465905111):

@jsmeix

Please find the recover debug log below:
[rear-recover.log.txt](https://github.com/rear/rear/files/2888288/rear-recover.log.txt)

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-21 08:48](https://github.com/rear/rear/issues/2035#issuecomment-465913236):

@jsmeix @gozora

I've  adjusted /usr/share/rear/finalize/Linux-i386/670_run_efibootmgr.sh
As gozora did.

I was able to relax and the system was recovered :)

many thanks for your help!

best regards

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-21 09:44](https://github.com/rear/rear/issues/2035#issuecomment-465932144):

@procurve86 
thank you very much for your testing and
your verification that @gozora 's fix helps and is sufficient.

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-02-21 09:50](https://github.com/rear/rear/issues/2035#issuecomment-465933957):

@jsmeix

my pleasure! I'm really impressed what effort you all put in this project and your kind support 👍

viele grüsse aus der schweiz

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-21 12:44](https://github.com/rear/rear/issues/2035#issuecomment-465986497):

With https://github.com/rear/rear/pull/2047 merged
this issue should be fixed.
This issue can be reopened if this particular issue is not yet fixed.
But new separated issues should be reported separatedly
(like regressions because of the changes in https://github.com/rear/rear/pull/2047).

#### &lt;img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&amp;v=4" width="50"&gt;[jsmeix](https://github.com/jsmeix) commented at [2019-02-21 12:48](https://github.com/rear/rear/issues/2035#issuecomment-465987439):

@procurve86 
FYI how to try out our current ReaR GitHub master code
where https://github.com/rear/rear/pull/2047 is merged:

Basically "git clone" our current ReaR upstream GitHub master code
into a separated directory and then configure and run ReaR
from within that directory like:
```
# git clone https://github.com/rear/rear.git

# mv rear rear.github.master

# cd rear.github.master

# vi etc/rear/local.conf

# usr/sbin/rear -D mkbackup
```
Note the relative paths "etc/rear/" and "usr/sbin/".

#### &lt;img src="https://avatars.githubusercontent.com/u/48693522?v=4" width="50"&gt;[jcarter3d](https://github.com/jcarter3d) commented at [2019-03-18 19:25](https://github.com/rear/rear/issues/2035#issuecomment-474065443):

I'm hitting this while trying to "rear recover" RHEL 7.6 images (on 10 machines).
Is there a work-around I can run after "rear recover" hangs on the "Running mkinitrd..." screen?

The previously mentioned work-arounds seem to be for those who which to build a new image. I'm just hoping to recover the images I already have for now.

#### &lt;img src="https://avatars.githubusercontent.com/u/20219180?v=4" width="50"&gt;[procurve86](https://github.com/procurve86) commented at [2019-03-19 07:01](https://github.com/rear/rear/issues/2035#issuecomment-474221716):

@jcarter3d

execute the following commands before running "rear recover":

`export TARGET_FS_ROOT=/mnt/local`
`mount --bind /run $TARGET_FS_ROOT/run`


-------------------------------------------------------------------------------



[Export of Github issue for [rear/rear](https://github.com/rear/rear).]
</code></pre>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-02-08.2035.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
