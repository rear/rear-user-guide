<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2596 Issue closed: Unused RHEL Physical Volume aborts mkrescue - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2596 Issue closed: Unused RHEL Physical Volume aborts mkrescue";
        var mkdocs_page_input_path = "issues/2021-04-06.2596.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2596 Issue closed: Unused RHEL Physical Volume aborts mkrescue</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2596_issue_closed_unused_rhel_physical_volume_aborts_mkrescue"><a href="https://github.com/rear/rear/issues/2596">#2596 Issue</a> <code>closed</code>: Unused RHEL Physical Volume aborts mkrescue<a class="headerlink" href="#2596_issue_closed_unused_rhel_physical_volume_aborts_mkrescue" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="rmccrack_opened_issue_at_2021-04-06_1754"><img src="https://avatars.githubusercontent.com/u/82052312?v=4" width="50"><a href="https://github.com/rmccrack">rmccrack</a> opened issue at <a href="https://github.com/rear/rear/issues/2596">2021-04-06 17:54</a>:<a class="headerlink" href="#rmccrack_opened_issue_at_2021-04-06_1754" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): Relax-and-Recover 2.6 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    OS_VENDOR=<strong>RedHatEnterpriseServer</strong><br />
    OS_VERSION=<strong>6.10</strong></p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    Site.conf:</p>
</li>
</ul>
<!-- -->

<pre><code>BACKUP=CDM
OUTPUT=ISO
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/lib64/python2.7/site-packages/:/usr/lib64/bind9-export/"
</code></pre>
<p>local.conf:</p>
<pre><code>AUTOEXCLUDE_DISKS=( "/dev/sdc" "/dev/sdc1" )
EXCLUDE_COMPONENTS=( "${EXCLUDE_COMPONENTS[@]}" "pv:/dev/sdc1" )
export TMPDIR=/dev/shm
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    Some multipath, some not - the behavior is the same regardless.</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    I have a number of systems (both physical and virtual) that have one
    or more disks known to LVM as physical volumes, but that have not
    been allocated to a volume group or logical volume. The minute the
    220_lvm_layout.sh script encounters these, it aborts the mkrescue
    process with
    <code>ERROR: LVM 'lvmdev' entry in /var/lib/rear/layout/disklayout.conf where volume_group or device is empty or more than one word.</code>
    In the case of this example, /dev/sdc1 is the problem disk.</p>
</li>
</ul>
<p>I think these are being used as raw disk by applications, hence the odd
configuration, and need a way to either exclude these from the ReaR
backup or allow the backup to continue in spite of them.</p>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<p>To paste verbatim text like command output or file content,<br />
include it between a leading and a closing line of three backticks like</p>
<pre><code># pvs
  PV         VG   Fmt  Attr PSize   PFree
  /dev/sda2  vg00 lvm2 a--u  19.87g  11.37g
  /dev/sdb1  vg01 lvm2 a--u  20.00g 768.00m
  /dev/sdc1       lvm2 ---- 109.00g 109.00g
  /dev/sdd1  vg01 lvm2 a--u 220.99g  33.55g

# pvdisplay
 "/dev/sdc1" is a new physical volume of "109.00 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sdc1
  VG Name
  PV Size               109.00 GiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP

Entries in the disklayout.conf file:
# lvmdev &lt;volume_group&gt; &lt;device&gt; [&lt;uuid&gt;] [&lt;size(bytes)&gt;]
lvmdev /dev/vg01 /dev/sdb1 joZClk-U4yz-dRmL-ERff-HKMR-y8GR-Exbg6y 41940992
lvmdev /dev/vg01 /dev/sdd1 yd2ZlP-Cpys-HStw-1zeK-LAdY-z0yI-mM0Nf9 463459122
lvmdev /dev/vg00 /dev/sda2 n0y20c-I6ke-ScDY-tEVs-oYyD-pI9S-pevNwx 41678848
lvmdev /dev/ /dev/sdc1 q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP 228588822
</code></pre>
<h4 id="gdha_commented_at_2021-04-07_0738"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-814681560">2021-04-07 07:38</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-07_0738" title="Permanent link">&para;</a></h4>
<p>@rmccrack Could you also show us the output of <code>lvs</code>? And, if possible,
the debug log-file of <code>rear -vdD savelayout</code>?</p>
<h4 id="rmccrack_commented_at_2021-04-07_1858"><img src="https://avatars.githubusercontent.com/u/82052312?v=4" width="50"><a href="https://github.com/rmccrack">rmccrack</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-815150088">2021-04-07 18:58</a>:<a class="headerlink" href="#rmccrack_commented_at_2021-04-07_1858" title="Permanent link">&para;</a></h4>
<p>Per request, lvs output below, log file attached.</p>
<h1 id="lvs">lvs<a class="headerlink" href="#lvs" title="Permanent link">&para;</a></h1>
<p>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert<br />
lv_root vg00 -wi-ao---- 1.00g<br />
lv_swap vg00 -wi-ao---- 2.00g<br />
lv_tmp vg00 -wi-ao---- 512.00m<br />
lv_usr vg00 -wi-ao---- 2.00g<br />
lv_var vg00 -wi-ao---- 3.00g<br />
lv_db2_data1 vg01 -wi-ao---- 10.00g<br />
lv_db2_data2 vg01 -wi-ao---- 10.00g<br />
lv_db2_data3 vg01 -wi-ao---- 10.00g<br />
lv_db2_data4 vg01 -wi-ao---- 10.00g<br />
lv_db2_dbdir vg01 -wi-ao---- 6.00g<br />
lv_db2_dbtmp vg01 -wi-ao---- 15.00g<br />
lv_db2_dump vg01 -wi-ao---- 6.00g<br />
lv_db2_indx1 vg01 -wi-ao---- 10.00g<br />
lv_db2_indx2 vg01 -wi-ao---- 10.00g<br />
lv_db2_indx3 vg01 -wi-ao---- 10.00g<br />
lv_db2_indx4 vg01 -wi-ao---- 10.00g<br />
lv_db2_inst vg01 -wi-ao---- 10.00g<br />
lv_db2_lob1 vg01 -wi-ao---- 10.00g<br />
lv_db2_lob2 vg01 -wi-ao---- 10.00g<br />
lv_db2_log vg01 -wi-ao---- 15.00g<br />
lv_db2_rep vg01 -wi-ao---- 5.00g<br />
lv_db2_src vg01 -wi-ao---- 6.00g<br />
lv_db2_tmp vg01 -wi-ao---- 6.00g<br />
lv_db2_tools vg01 -wi-ao---- 20.00g<br />
lv_db_db2 vg01 -wi-ao---- 2.00g<br />
lv_hd vg01 -wi-ao---- 128.00m<br />
lv_hd_aa vg01 -wi-ao---- 128.00m<br />
lv_hd_db vg01 -wi-ao---- 256.00m<br />
lv_hd_oy vg01 -wi-ao---- 128.00m<br />
lv_hd_sa vg01 -wi-ao---- 1.00g<br />
lv_hd_sc vg01 -wi-ao---- 128.00m<br />
lv_hd_su vg01 -wi-ao---- 128.00m<br />
lv_home vg01 -wi-ao---- 128.00m<br />
lv_isv vg01 -wi-ao---- 1.50g<br />
lv_isv_ILMT vg01 -wi-ao---- 508.00m<br />
lv_isv_ems vg01 -wi-ao---- 384.00m<br />
lv_microsoft vg01 -wi-ao---- 128.00m<br />
lv_opt vg01 -wi-ao---- 768.00m<br />
lv_opt_puppet vg01 -wi-ao---- 768.00m<br />
lv_opt_tivoli vg01 -wi-ao---- 1.69g<br />
lv_oy_var vg01 -wi-ao---- 256.00m<br />
lv_sccm vg01 -wi-ao---- 512.00m<br />
lv_splunk_uf vg01 -wi-ao---- 256.00m<br />
lv_su_staging vg01 -wi-ao---- 1.00g<br />
lv_tanium vg01 -wi-ao---- 6.00g</p>
<h4 id="gdha_commented_at_2021-04-08_0927"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-815606358">2021-04-08 09:27</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-08_0927" title="Permanent link">&para;</a></h4>
<p>@rmccrack Couldn't find the log file...</p>
<h4 id="rmccrack_commented_at_2021-04-08_1326"><img src="https://avatars.githubusercontent.com/u/82052312?v=4" width="50"><a href="https://github.com/rmccrack">rmccrack</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-815823393">2021-04-08 13:26</a>:<a class="headerlink" href="#rmccrack_commented_at_2021-04-08_1326" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/6278952/debug_log.txt.gz">debug_log.txt.gz</a></p>
<h4 id="gdha_commented_at_2021-04-08_1456"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-815892522">2021-04-08 14:56</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-08_1456" title="Permanent link">&para;</a></h4>
<p>The issue is in
<code>/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh</code> the vgrp
variable is empty (we probably have to skip these entries):</p>
<pre><code>+++ echo /dev/sdc1::228588822:-1:0:0:-1:0:0:0:0:q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP
+++ cut -d : -f 1
++ pdev=/dev/sdc1
++ test dev/sdc1 = /dev/sdc1
++ is_false yes
++ case "$1" in
++ return 1
+++ echo /dev/sdc1::228588822:-1:0:0:-1:0:0:0:0:q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP
+++ cut -d : -f 2
++ vgrp=
+++ echo /dev/sdc1::228588822:-1:0:0:-1:0:0:0:0:q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP
+++ cut -d : -f 3
++ size=228588822
+++ echo /dev/sdc1::228588822:-1:0:0:-1:0:0:0:0:q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP
+++ cut -d : -f 12
++ uuid=q6dPsv-gGZu-SSug-Oyjd-3WSN-c3IM-60TWnP
</code></pre>
<h4 id="rmccrack_commented_at_2021-04-19_1940"><img src="https://avatars.githubusercontent.com/u/82052312?v=4" width="50"><a href="https://github.com/rmccrack">rmccrack</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-822734482">2021-04-19 19:40</a>:<a class="headerlink" href="#rmccrack_commented_at_2021-04-19_1940" title="Permanent link">&para;</a></h4>
<p>Is there still information you require from me? Asking because of the
"waiting for info" tag.</p>
<h4 id="gdha_commented_at_2021-04-20_0753"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-823061869">2021-04-20 07:53</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-20_0753" title="Permanent link">&para;</a></h4>
<p>@rmccrack No - don't worry still need to test this out myself when I
find some time for it</p>
<h4 id="gdha_commented_at_2021-04-21_0858"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-823900806">2021-04-21 08:58</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-21_0858" title="Permanent link">&para;</a></h4>
<p>Tested it out with 3 disks (sda being root/boot devices and sdb and sdc
being empty).<br />
As long as the 2 empty disks are not in use (not partitioned nor LVM'ed)
all is fine with savelayout.<br />
Once the 2 disks (sdb and sdc) are partitioned and LVMed - pvcreate) we
get the following error message by rear:</p>
<pre><code># /home/gdha/projects/rear/usr/sbin/rear -v savelayout
Relax-and-Recover 2.6 / Git
Running rear savelayout (PID 2500 date 2021-04-21 08:49:38)
Using log file: /home/gdha/projects/rear/var/log/rear/rear-ubuntu20.log
Running workflow savelayout on the normal/original system
Creating disk layout
Overwriting existing disk layout file /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
ERROR: LVM 'lvmdev' entry in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf where volume_group or device is empty or more than one word
Some latest log messages since the last called script 220_lvm_layout.sh:
  2021-04-21 08:49:40.256765507 Including layout/save/GNU/Linux/220_lvm_layout.sh
  2021-04-21 08:49:40.265442543 Begin saving LVM layout ...
Error exit of rear savelayout (PID 2500) and its descendant processes
Exiting subshell 1 (where the actual error happened)
Aborting due to an error, check /home/gdha/projects/rear/var/log/rear/rear-ubuntu20.log for details
Exiting rear savelayout (PID 2500) and its descendant processes ...
Running exit tasks
Terminated
</code></pre>
<p>However, the disklayout.conf file is still written as:</p>
<pre><code># grep -v \# disklayout.conf
disk /dev/sda 10737418240 gpt
part /dev/sda 536870912 1048576 sda1 boot,esp /dev/sda1
part /dev/sda 1073741824 537919488 sda2 none /dev/sda2
part /dev/sda 9124708352 1611661312 sda3 none /dev/sda3
disk /dev/sdb 135069696 gpt
part /dev/sdb 135035392 17408 primary none /dev/sdb1
disk /dev/sdc 224121856 gpt
part /dev/sdc 224087552 17408 primary none /dev/sdc1
lvmdev /dev/ubuntu-vg /dev/sda3 LtE3U0-P4QW-0sqd-zN07-0PcG-hn9z-zodth8 17821696
lvmdev /dev/ /dev/sdb1 u4rIXd-eKXI-DYB1-Zscz-oAsv-ekZO-5F3EXe 263741
</code></pre>
<p>That is not OK IMHO as we can skip these devices if it was the intend to
have PVs created, but not used - ReaR should not bail out cause of this
(avoiding false sense of coverage if the error was not seen)</p>
<h4 id="jsmeix_commented_at_2021-04-21_1155"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824002149">2021-04-21 11:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1155" title="Permanent link">&para;</a></h4>
<p>My - as usual long and elaborated - comment<br />
in layout/save/GNU/Linux/220_lvm_layout.sh<br />
at that error exit explains the reason behind</p>
<pre><code># After the 'lvmdev' line was written to disklayout.conf so that the user can inspect it
# check that the required positional parameters in the 'lvmdev' line are non-empty
# because an empty positional parameter would result an invalid 'lvmdev' line
# which would cause invalid parameters are 'read' as input during "rear recover"
# cf. "Verifying ... 'lvm...' entries" in layout/save/default/950_verify_disklayout_file.sh
# The variables are not quoted because plain 'test' without argument results non-zero exit code
# and 'test foo bar' fails with "bash: test: foo: unary operator expected"
# so that this also checks that the variables do not contain blanks or more than one word
# because blanks (actually $IFS characters) are used as field separators in disklayout.conf
# which means the positional parameter values must be exactly one non-empty word.
# Two separated simple 'test $vgrp &amp;&amp; test $pdev' commands are used here because
# 'test $vgrp -a $pdev' does not work when $vgrp is empty or only blanks
# because '-a' has two different meanings: "EXPR1 -a EXPR2" and "-a FILE" (see "help test")
# so that when $vgrp is empty 'test $vgrp -a $pdev' tests if file $pdev exists
# which is usually true because $pdev is usually a partition device node (e.g. /dev/sda1)
# so that when $vgrp is empty 'test $vgrp -a $pdev' would falsely succeed:
test $vgrp &amp;&amp; test $pdev || Error "LVM 'lvmdev' entry in $DISKLAYOUT_FILE where volume_group or device is empty or more than one word"
</code></pre>
<p>and the</p>
<pre><code>lvmdev /dev/ /dev/sdb1 ...
</code></pre>
<p>line does look wrong, see "Disk layout file syntax" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<pre><code>lvmdev /dev/&lt;volume_group&gt; &lt;device&gt; [&lt;uuid&gt;] [&lt;size(bytes)&gt;]
</code></pre>
<p>so the <code>&lt;volume_group&gt;</code> is really missing.</p>
<p>@gdha<br />
you could try out how far "rear recover" would work<br />
when you disable that error exit during "rear mkrescue".<br />
I guess "rear recover" would fail in a rather user unfriendly way<br />
with an incomplete <code>lvmdev /dev/ /dev/sdb1 ...</code> entry<br />
so I think currently that error exit during "rear mkrescue" is right<br />
cf. "Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>It is a different issue if we could enhance the LVM code<br />
to be more robust against partially set up LVM things<br />
or more generally if we could enhance the disk layout code<br />
to also support any kind of "partially" set up storage things like</p>
<ul>
<li>disks without partitions i.e. raw disk support</li>
<li>disks with partitions but no filesystems ("raw partition" support?)</li>
<li>disks with partitions and filesystems which are not mounted</li>
<li>other higher level storage objects where nothing is mounted (e.g.
    "raw LUKS volumes")</li>
</ul>
<p>It is another different issue how to backup data on<br />
raw or unmounted storage objects, e.g. by backup with <code>dd</code>, cf.<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/12-BLOCKCLONE.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/12-BLOCKCLONE.adoc</a></p>
<h4 id="jsmeix_commented_at_2021-04-21_1159"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824004714">2021-04-21 11:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1159" title="Permanent link">&para;</a></h4>
<p>@rmccrack<br />
in your case the <code>lvmdev /dev/ /dev/sdc1</code> line looks wrong<br />
so that "rear recover" would fail if disklayout.conf is used with such a
line.</p>
<h4 id="jsmeix_commented_at_2021-04-21_1202"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824006044">2021-04-21 12:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1202" title="Permanent link">&para;</a></h4>
<p>As far as I see the issue is not a bug in the current code.<br />
I even think the current code works perfectly right here because<br />
it avoids that later when it is too late "rear recover" cannot work.</p>
<p>As far as I see the issue is and enhancement request<br />
to let ReaR support certain kind of "raw" storage objects.</p>
<h4 id="gdha_commented_at_2021-04-21_1205"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824008112">2021-04-21 12:05</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-21_1205" title="Permanent link">&para;</a></h4>
<p>@jsmeix I do not have to perform a recover to know it will fail as the
VG is badly defined - only a PV was created, but not used. That is my
point here - there is nothing wrong in creating a PV that is not yet
used (sometimes it takes a couple of days in big firms with different
teams to complete the creation of a VG). ReaR should not fail over it -
not even showing an error as it is not an error as such. We should skip
these devices and that I tested already with success.</p>
<pre><code>       # With the above example vgrp=system
        vgrp=$( echo $line | cut -d ":" -f "2" )

        # When vgrp is empty then the PV is not part of any VG - skip this device? #2596
        [[ -z "$vgrp" ]] &amp;&amp; continue
</code></pre>
<h4 id="jsmeix_commented_at_2021-04-21_1230"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824022268">2021-04-21 12:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1230" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
thank you for the explanation.</p>
<p>From the code in 220_lvm_layout.sh I think you mean to skip a PV.<br />
I am not a LVM expert but in general I don't like to "just skip"
things.<br />
Perhaps it is OK to skip a PV that is not part of a VG.<br />
But then there is no info in disklayout.conf about that PV.<br />
So on the original system there was a PV (<code>pvdisplay</code> has shown it)<br />
that is not part of a VG but "rear recover" would not recreate it<br />
as a PV that is not part of a VG but "just skip" it.<br />
So "rear recover" would "just silently" not recreate<br />
the original system as much as possible as it was before.</p>
<p>When it "takes a couple of days ... to complete the creation of a VG"<br />
I wonder why then "rear mkrescue" is run while system setup is in the
works?<br />
If "rear mkrescue" is run while system setup is in the works and it
errors out<br />
because the current system setup is incomplete or inconsistent<br />
then it is good that "rear mkrescue" errors out so the admin knows<br />
that something is wrong.</p>
<p>In general I do not like when "rear mkrescue"<br />
just silently skips things that ReaR does not support see<br />
<a href="https://github.com/rear/rear/pull/2597#issuecomment-822491263">https://github.com/rear/rear/pull/2597#issuecomment-822491263</a><br />
(excerpt):</p>
<pre><code>A bad consequence is that when ReaR does not support something
it gets silently ignored during "rear mkrescue" and then the user has to
learn the hard way later (when it is too late) when "rear recover" fails
with unfriedly messages that something is not supported by ReaR, cf.
https://github.com/rear/rear/issues/2560
</code></pre>
<p>The current code is at least somewhat consistent.<br />
It errors out when it detects things it cannot cope with.</p>
<p>Just silently skip things that ReaR does not support is what<br />
I fixed at many places (still too many places are left to be fixed)<br />
because that is the bad old usability experience of ReaR:</p>
<ul>
<li>"rear mkrescue" basically always "just works" on a first attempt</li>
<li>"rear recover" basically always "just fails" on a first attempt</li>
</ul>
<p>I think we either implement proper support for PVs that are not part of
a VG<br />
or we implement proper support to let the user explicity specify what to
skip<br />
cf. the related issue
<a href="https://github.com/rear/rear/pull/2597">https://github.com/rear/rear/pull/2597</a><br />
which is about disks but the basic ideas behind are same.</p>
<h4 id="jsmeix_commented_at_2021-04-21_1243"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824030022">2021-04-21 12:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1243" title="Permanent link">&para;</a></h4>
<p>@rmccrack<br />
try out if "just skipping" PVs that are not part of a VG as in<br />
<a href="https://github.com/rear/rear/issues/2596#issuecomment-824008112">https://github.com/rear/rear/issues/2596#issuecomment-824008112</a><br />
makes both "rear mkrescue" and "rear recover"<br />
(try out "rear recover" only on separated test hardware)<br />
work sufficient for your particular use case<br />
(you won't get the skipped PVs recreated as PVs).</p>
<h4 id="gdha_commented_at_2021-04-21_1247"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824032628">2021-04-21 12:47</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-21_1247" title="Permanent link">&para;</a></h4>
<p>@jsmeix @rmccrack Yeah - ReaR is not perfect, however, end-users are
even worse ;-) They don't look at the logs and are unaware of errors -
just as a reminder ReaR runs most of the time via cron or another kind
of scheduler. The logs are these analyzed for errors (99% are not
checked at all).<br />
Disks which are present, but not used are shown in the disklayout in
comment, perhaps we can do the same for PVs? I tend to say an empty PV
should not be recreated in a DR environment as it does not bring any
added value to the restored system.<br />
If they didn't need it before then in a DR situation it is even less
important to have it.</p>
<h4 id="jsmeix_commented_at_2021-04-21_1249"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824033640">2021-04-21 12:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1249" title="Permanent link">&para;</a></h4>
<p>In default.conf we have <code>EXCLUDE_VG</code><br />
but neither <code>EXCLUDE_PV</code> nor <code>EXCLUDE_LV</code><br />
and layout/save/GNU/Linux/220_lvm_layout.sh<br />
contains nothing at all about <code>EXCLUDE_</code> only<br />
layout/save/default/310_include_exclude.sh and<br />
layout/save/default/335_remove_excluded_multipath_vgs.sh<br />
contain <code>EXCLUDE_VG</code> and I think the reason is how exclusion is
implemented, cf.<br />
<a href="https://github.com/rear/rear/pull/2597#issuecomment-822491263">https://github.com/rear/rear/pull/2597#issuecomment-822491263</a><br />
(excerpt)</p>
<pre><code>My vague basic understanding is that during "rear mkrescue"
first all storage objects ReaR knows about are included in disklayout.conf
(except some automated hardcoded ignored ones ...)
and then some "not needed" entries in disklayout.conf get disabled
by various subsequent exclude scripts
</code></pre>
<h4 id="gdha_commented_at_2021-04-21_1257"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824038297">2021-04-21 12:57</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-21_1257" title="Permanent link">&para;</a></h4>
<p>@jsmeix Perhaps this would be sufficient? It is shown and nothing
breaks:</p>
<pre><code># PV /dev/sdb1 is not part of any knowm VG (yet) - skipping device:
# lvmdev /dev/ /dev/sdb1 u4rIXd-eKXI-DYB1-Zscz-oAsv-ekZO-5F3EXe 263741
# PV /dev/sdc1 is not part of any knowm VG (yet) - skipping device:
# lvmdev /dev/ /dev/sdc1 A3oUft-RXK0-ATkg-jcv2-hl1j-naAX-JvowMu 437671
</code></pre>
<h4 id="jsmeix_commented_at_2021-04-21_1302"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824042045">2021-04-21 13:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1302" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
yes, all storage objects that ReaR knows about<br />
should be shown in disklayout.conf</p>
<ul>
<li>either as "active" entries</li>
<li>or commented out (as documentation for the user)</li>
</ul>
<p>Since the <code>lsblk</code> output is shown as header comment in disklayout.conf<br />
we might even completely skip storage object entries in
disklayout.conf<br />
when the user had explicitly specified to have them skipped e.g.<br />
via EXCLUDE_VG and new EXCLUDE_PV and EXCLUDE_LV<br />
because this could make our code much simpler like</p>
<pre><code>    lvm pvdisplay -c | while read line ; do

        # With the above example pdev=/dev/sda1
        # (the "echo $line" makes the leading blanks disappear)
        pdev=$( echo $line | cut -d ":" -f "1" )

        # Skip PVs where their device node is explicitly specified to be skipped:
        IsInArray $pdev ${EXCLUDE_PV[@]} &amp;&amp; continue
</code></pre>
<p>instead of complicated code that must work fail-safe even for
problematic cases<br />
to still write half-broken entries to disklayout.conf that get later
commented out.</p>
<h4 id="jsmeix_commented_at_2021-04-21_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-824044119">2021-04-21 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-21_1304" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
do you already have code that makes entries in disklayout.conf<br />
as shown in your<br />
<a href="https://github.com/rear/rear/issues/2596#issuecomment-824038297">https://github.com/rear/rear/issues/2596#issuecomment-824038297</a><br />
?</p>
<p>If yes, please do a pull request.</p>
<h4 id="jsmeix_commented_at_2021-05-04_1110"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-831861721">2021-05-04 11:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1110" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2603">https://github.com/rear/rear/pull/2603</a>
merged<br />
this issue should be sufficiently solved<br />
(as far as possible with reasonable effort).</p>
<h4 id="gdha_commented_at_2021-05-04_1204"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-831889638">2021-05-04 12:04</a>:<a class="headerlink" href="#gdha_commented_at_2021-05-04_1204" title="Permanent link">&para;</a></h4>
<p>@jsmeix Confirmation of success:</p>
<pre><code># usr/sbin/rear -v savelayout
Relax-and-Recover 2.6 / Git
Running rear savelayout (PID 1262 date 2021-05-04 11:49:13)
Using log file: /home/gdha/projects/rear/var/log/rear/rear-ubuntu20.log
Running workflow savelayout on the normal/original system
Creating disk layout
Overwriting existing disk layout file /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'disk /dev/sdb' in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'part /dev/sdb' in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'disk /dev/sdc' in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'part /dev/sdc' in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf
Using guessed bootloader 'EFI' (found in first bytes on /dev/sda)
Verifying that the entries in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf are correct
Created disk layout (check the results in /home/gdha/projects/rear/var/lib/rear/layout/disklayout.conf)
Exiting rear savelayout (PID 1262) and its descendant processes ...
Running exit tasks
</code></pre>
<h4 id="jsmeix_commented_at_2021-05-04_1226"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2596#issuecomment-831902361">2021-05-04 12:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1226" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
thank you so much for your confirmation that things work well for you!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-04-06.2596.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
