<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2021 04 15.2601.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2021 04 15.2601.issue.closed";
        var mkdocs_page_input_path = "issues/2021-04-15.2601.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2021 04 15.2601.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2601_issue_closed_kernel_cmdlinenetdeveno1_ignored_unattended_recovery_stopped_at_original_network_interface_eno1_is_not_available"><a href="https://github.com/rear/rear/issues/2601">#2601 Issue</a> <code>closed</code>: KERNEL_CMDLINE="netdev=eno1" ignored. Unattended recovery stopped at: original network interface eno1 [...] is not available<a class="headerlink" href="#2601_issue_closed_kernel_cmdlinenetdeveno1_ignored_unattended_recovery_stopped_at_original_network_interface_eno1_is_not_available" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="3id0_opened_issue_at_2021-04-15_1249"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> opened issue at <a href="https://github.com/rear/rear/issues/2601">2021-04-15 12:49</a>:<a class="headerlink" href="#3id0_opened_issue_at_2021-04-15_1249" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):</li>
</ul>
<p>Relax-and-Recover 2.4 / Git</p>
<ul>
<li>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</li>
</ul>
<!-- -->

<pre><code>OS_VENDOR=Debian
OS_VERSION=10
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
GRUB_RESCUE=n
EXCLUDE_BACKUP+=( fs:/media fs:/mnt fs:/dev fs:/proc fs:/sys fs:/tmp fs:/run )

ISO_RECOVER_MODE="unattended"
PXE_RECOVER_MODE="unattended"
USER_INPUT_LAYOUT_MIGRATION_CONFIRM_MAPPINGS=1
USER_INPUT_DISK_LAYOUT_PROCEED_RECOVERY='yes'
USER_INPUT_BORGBACKUP_ARCHIVE_TO_RECOVER=1

KERNEL_CMDLINE="netdev=eno1"
#KERNEL_CMDLINE="net.ifnames=0 netdev=eth0"

POST_RECOVERY_SCRIPT="reboot"

RESULT_FILES=()
RESULT_MAILTO=( '[redacted]' )
RESULT_MAILFROM=root
RESULT_MAILSUBJECT="ReaR recovery results"
RESULT_SENDMAIL="$( type -p sendmail || echo /usr/lib/sendmail )"
RESULT_SENDMAIL_OPTIONS=( -oi -t )

BACKUP=BORG
BORGBACKUP_HOST="192.168.10.10"
BORGBACKUP_USERNAME="backupborg"
BORGBACKUP_REPO="/~/symlink-borg-repos/${HOSTNAME}"
BORGBACKUP_REMOTE_PATH="/usr/local/bin/borg"
BORGBACKUP_PRUNE_KEEP_HOURLY=5
BORGBACKUP_PRUNE_KEEP_WEEKLY=2
BORGBACKUP_COMPRESSION="zlib,9"
BORGBACKUP_ENC_TYPE="repokey-blake2"
export BORG_PASSPHRASE="[redacted]"
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
export BORG_RSH="ssh -i /root/.ssh/id_rsa_[redacted]"
SSH_FILES=( '/root/.ssh/id_rsa_[redacted]' '/root/.ssh/known_hosts' )
SSH_UNPROTECTED_PRIVATE_KEYS='yes'
</code></pre>
<ul>
<li>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):</li>
</ul>
<p>PC</p>
<ul>
<li>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</li>
</ul>
<p>x86_64</p>
<ul>
<li>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</li>
</ul>
<p>BIOS and GRUB</p>
<ul>
<li>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</li>
</ul>
<p>local disk</p>
<ul>
<li>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</li>
</ul>
<!-- -->

<pre><code>NAME                                   KNAME     PKNAME    TRAN TYPE FSTYPE        SIZE MOUNTPOINT
/dev/sda                               /dev/sda            ata  disk             931.5G
|-/dev/sda1                            /dev/sda1 /dev/sda       part ext2          487M /boot
|-/dev/sda2                            /dev/sda2 /dev/sda       part                 1K
`-/dev/sda5                            /dev/sda5 /dev/sda       part LVM2_member   931G
  |-/dev/mapper/linuxhost17--vg-root   /dev/dm-0 /dev/sda5      lvm  ext4        930.1G /
  `-/dev/mapper/linuxhost17--vg-swap_1 /dev/dm-1 /dev/sda5      lvm  swap          976M [SWAP]
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>Hello, I'm trying to setup a fully automated/unattended
recovery/migration to a another bare metal server (thus, with different
mac addresses) from ReaR USB. But before "rear recover" can start, the
process stops and asks the following:</p>
<pre><code>The original network interface eno1 &lt;old-mac-address&gt; is not available
1) eno1 &lt;new-mac-address-1&gt; igb
2) eno2 &lt;new-mac-address-2&gt; igb
3) Skip replacing eno1 &lt;old-mac-address&gt;
Choose replacement for eno1 &lt;old-mac-address&gt;
</code></pre>
<p>I would like the first answer to always be chosen and never needing user
interaction.<br />
I have tried configurations with this line:<br />
<code>KERNEL_CMDLINE="netdev=eno1"</code><br />
and this line:<br />
<code>KERNEL_CMDLINE="net.ifnames=0 netdev=eth0"</code><br />
but, even though in the second case, the net.ifnames is correctly taken
into account since the prompt displays eth0 instead of eno1, I am still
prompted to manually select a network interface.<br />
How to automatically choose the first available network interface?</p>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>None</p>
<h4 id="gdha_commented_at_2021-04-15_1411"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-820452681">2021-04-15 14:11</a>:<a class="headerlink" href="#gdha_commented_at_2021-04-15_1411" title="Permanent link">&para;</a></h4>
<p>@3id0 Try adding <code>USER_INPUT_TIMEOUT=3</code> to the local.conf file.</p>
<h4 id="3id0_commented_at_2021-04-15_1417"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-820457179">2021-04-15 14:17</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-15_1417" title="Permanent link">&para;</a></h4>
<p>Thank you for your quick response. I do not have access to the servers
right now but I will try that and keep you updated.</p>
<h4 id="jsmeix_commented_at_2021-04-16_0723"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-820974049">2021-04-16 07:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-16_0723" title="Permanent link">&para;</a></h4>
<p>I think <code>USER_INPUT_TIMEOUT</code> won't help because the code<br />
that asks for the right network interface is in<br />
skel/default/etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/skel/default/etc/scripts/system-setup.d/55-migrate-network-devices.sh">https://github.com/rear/rear/blob/master/usr/share/rear/skel/default/etc/scripts/system-setup.d/55-migrate-network-devices.sh</a></p>
<pre><code>echo "The original network interface $old_dev $old_mac is not available"
PS3="Choose replacement for $old_dev $old_mac "
skip_choice="Skip replacing $old_dev $old_mac"
select choice in "${NEW_DEVICES[@]}" "$skip_choice" ; do
</code></pre>
<p>and <code>select</code> does not have a timeout or so.</p>
<p>@3id0<br />
attach your "rear -D mkrescue/mkbackup" debug log file cf.<br />
<a href="https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md">https://github.com/rear/rear/blob/master/.github/ISSUE_TEMPLATE.md</a><br />
so we could see what goes on on your system.</p>
<h4 id="3id0_commented_at_2021-04-23_1843"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-825849962">2021-04-23 18:43</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-23_1843" title="Permanent link">&para;</a></h4>
<p>Here you go.<br />
I hope I'm not publishing anything important in this log -_-'</p>
<p><a href="https://github.com/rear/rear/files/6367471/rear-linuxhost17.log">rear.log</a></p>
<p>By the way, is there a best pratice for doing a fully
automated/unattended restore with borg via ssh without leaving an
unprotected private key everywhere? (current host, rescue image, next
host...)<br />
I've used the <a href="https://borgbackup.readthedocs.io/en/stable/usage/serve.html#examples">restrict directive for
ssh</a>
but still it feels weird leaving this key everywhere without password.</p>
<p>EDIT: Oh yes, and adding the USER_INPUT_TIMEOUT=3 did not prevent the
interface prompt to interrupt the unatteded recovery.</p>
<h4 id="jsmeix_commented_at_2021-04-26_1425"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-826878218">2021-04-26 14:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-26_1425" title="Permanent link">&para;</a></h4>
<p>When I run "rear -D mkrescue" with this etc/rear/local.conf (excerpts)</p>
<pre><code>OUTPUT=ISO
KERNEL_CMDLINE+=" qqqqkey=qqqqvalue"
</code></pre>
<p>I get in var/log/rear/rear-linux-h9wr.log (excerpts)</p>
<pre><code>+ source /root/rear.github.master/usr/share/rear/output/ISO/Linux-i386/300_create_isolinux.sh
++ echo 'append initrd=initrd.cgz root=/dev/ram0 vga=normal rw  selinux=0 qqqqkey=qqqqvalue'
++ echo 'append initrd=initrd.cgz root=/dev/ram0 vga=normal rw  selinux=0 qqqqkey=qqqqvalue auto_recover '
</code></pre>
<p>@3id0<br />
in contrast in your case I don't see how your KERNEL_CMDLINE is ever<br />
added to the bootloader of the bootable medium via <code>OUTPUT=USB</code> because
your<br />
<a href="https://github.com/rear/rear/files/6367471/rear-linuxhost17.log">https://github.com/rear/rear/files/6367471/rear-linuxhost17.log</a><br />
only contains (excerpts)</p>
<pre><code>+ source /usr/share/rear/rescue/GNU/Linux/400_use_serial_console.sh
...
... Modified kernel commandline to: 'netdev=eno1 console=ttyS0,9600 console=ttyS1,9600 console=tty0'
...
</code></pre>
<p>In current ReaR code KERNEL_CMDLINE is only used in the following <code>USB</code>
scripts:</p>
<pre><code>usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh
usr/share/rear/output/USB/Linux-i386/100_create_efiboot.sh
</code></pre>
<p>where usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh is
actually run<br />
and usr/share/rear/output/USB/Linux-i386/100_create_efiboot.sh is
basically skipped<br />
because USB should not do UEFI boot but only traditional BIOS boot.</p>
<p>In usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh<br />
KERNEL_CMDLINE is in those lines</p>
<pre><code>    append initrd=/$USB_PREFIX/$REAR_INITRD_FILENAME root=/dev/ram0 vga=normal rw $KERNEL_CMDLINE
    append initrd=/$USB_PREFIX/$REAR_INITRD_FILENAME root=/dev/ram0 vga=normal rw $KERNEL_CMDLINE auto_recover
</code></pre>
<p>but currently I don't understand what actually happens while<br />
usr/share/rear/output/USB/Linux-i386/300_create_extlinux.sh<br />
is running from what I see in<br />
<a href="https://github.com/rear/rear/files/6367471/rear-linuxhost17.log">https://github.com/rear/rear/files/6367471/rear-linuxhost17.log</a></p>
<p>That obfuscated ReaR USB code always drives me nuts...</p>
<h4 id="3id0_commented_at_2021-04-26_1724"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-827014244">2021-04-26 17:24</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-26_1724" title="Permanent link">&para;</a></h4>
<p>Is there anything I can do to get you a better log of the "syslinux.cfg"
step?<br />
Though if I remember correctly, on the ReaR USB boot menu, I once tried
editing the boot options and I could see netdev=eno1 in there along with
the other options.</p>
<h4 id="jsmeix_commented_at_2021-04-28_1238"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-828420787">2021-04-28 12:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-28_1238" title="Permanent link">&para;</a></h4>
<p>I tested KERNEL_CMDLINE+="..." with OUTPUT=USB<br />
on a USB disk that is connected as /dev/sdb<br />
to my homeoffice laptop with hostname linux-h9wr<br />
with the following settings in etc/rear/local.conf</p>
<pre><code>OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
USB_DEVICE=/dev/disk/by-label/REAR-000
USB_SUFFIX="ReaRtestBackup2"
KERNEL_CMDLINE+=" QQQQQQ=qqqqqq"
</code></pre>
<p>I am used to use USB_SUFFIX because I prefer to have things stored on
USB<br />
in the same way as via NFS, see the comment about USB_SUFFIX in
default.conf<br />
but that should not make a real difference regarding kernel command line
options.</p>
<p>I got the kernel command line option added to the bootloader config on
the USB:</p>
<pre><code># mount /dev/sdb1 /mnt

# find /mnt -type f -name 'syslinux.cfg' | xargs grep QQQQQQ
/mnt/rear/linux-h9wr/ReaRtestBackup2/syslinux.cfg:
    append initrd=/rear/linux-h9wr/ReaRtestBackup2/initrd.cgz root=/dev/ram0 vga=normal rw  selinux=0 QQQQQQ=qqqqqq
/mnt/rear/linux-h9wr/ReaRtestBackup2/syslinux.cfg:
    append initrd=/rear/linux-h9wr/ReaRtestBackup2/initrd.cgz root=/dev/ram0 vga=normal rw  selinux=0 QQQQQQ=qqqqqq auto_recover
</code></pre>
<p>The rear/linux-h9wr/ReaRtestBackup2/syslinux.cfg<br />
contents get included by the rear/syslinux.cfg file via</p>
<pre><code># less /mnt/rear/syslinux.cfg
...
    include /rear/linux-h9wr/ReaRtestBackup2/syslinux.cfg
...
</code></pre>
<p>so that the additional kernel command line option should be passed to
the kernel<br />
when booting the ReaR recovery system from that USB disk but I did not
test it<br />
because I won't boot my homeoffice laptop now from USB (I need it to
work on it).</p>
<p>@3id0<br />
to verify whether or not your additional kernel command line option<br />
was actually passed to the kernel of your ReaR recovery system<br />
boot your ReaR recovery system, log in as root, and check the output<br />
of <code>cat /proc/cmdline</code> and the output of <code>dmesg</code> if that kernel
command<br />
line option is shown.</p>
<h4 id="3id0_commented_at_2021-04-29_1416"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-829275841">2021-04-29 14:16</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-29_1416" title="Permanent link">&para;</a></h4>
<pre><code># cat /proc/cmdline
BOOT_IMAGE=/rear/linuxhost17/20210429.1535/kernel initrd=/rear/linuxhost17/20210429.1535/initrd.cgz root=/dev/ram0 vga=normal rw netdev=eno1 console=ttyS0,9600
</code></pre>
<p>So yes, netdev option is indeed passed to the kernel of the recovery
system.<br />
(Copied from a picture, please forgive the typos if any.)<br />
What's next?</p>
<h4 id="jsmeix_commented_at_2021-04-29_1524"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-829332979">2021-04-29 15:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-29_1524" title="Permanent link">&para;</a></h4>
<p>@3id0<br />
So your additional kernel command line option does not result<br />
what you expect it to result so the root cause seems to be now<br />
that something while starting up the ReaR recovery system<br />
even with that kernel command line option does not result<br />
the ReaR recovery system networking setup as you want it to be.</p>
<p>In general reegarding ReaR recovery system networking setup we have<br />
the special <code>ip= nm= netdev= gw=</code> kernel command line options, see the
section<br />
"RESCUE IMAGE KERNEL COMMAND LINE OPTIONS" in <code>man rear</code><br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a><br />
and we also have NETWORKING_PREPARATION_COMMANDS<br />
see its description in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf</a></p>
<p>Perhaps those could help you to get the ReaR recovery system<br />
networking setup as you want it to be in your particular case?</p>
<p>But I fear those won't help because I fear the recovery system setup
script<br />
etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
which shows the <code>The original network interface ... is not available</code>
input prompt<br />
runs before the other setup scripts that do the actual networking setup.</p>
<h4 id="3id0_commented_at_2021-04-29_1626"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-829384986">2021-04-29 16:26</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-29_1626" title="Permanent link">&para;</a></h4>
<p>I don't remember where I found out about KERNEL_CMDLINE but I'm pretty
sure there were no mention of the "unattended" option...<br />
I just tried <code>KERNEL_CMDLINE="netdev=eno1 unattended"</code> after checking
your links and it works ! (no prompt about the network interface)<br />
Thanks a lot @jsmeix !</p>
<h4 id="jsmeix_commented_at_2021-04-30_1159"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830044260">2021-04-30 11:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1159" title="Permanent link">&para;</a></h4>
<p>@3id0<br />
thank you for your feedback what helped in your case!</p>
<p>The `KERNEL_CMDLINE="... unattended" points to<br />
this code in system-setup.d/55-migrate-network-devices.sh</p>
<pre><code>if unattended_recovery ; then
    # we gonna cheat a bit and say we have map made (but we did not and just hope that the interfaces
    # will be in the same order on the recover vm as on the client vm)
    # For some background info see https://github.com/gdha/rear-automated-testing/issues/36
    test $MANUAL_MAC_MAPPING || MANUAL_MAC_MAPPING=unattended
fi
</code></pre>
<p>and - voila! - the right ReaR upstream issue was finally found<br />
<a href="https://github.com/gdha/rear-automated-testing/issues/36">https://github.com/gdha/rear-automated-testing/issues/36</a><br />
that shows more background information and details behind.</p>
<h4 id="3id0_commented_at_2021-04-30_1231"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830061516">2021-04-30 12:31</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-30_1231" title="Permanent link">&para;</a></h4>
<p>It's too bad the line "the original network interface [...] is not
available" in <a href="https://github.com/gdha/rear-automated-testing/issues/36">issue
#36</a> was in
another repo <em>and</em> in a picture (not in text) because I searched for
this specific string both in the issues of the rear repo and in
DuckDuckGo before posting. If I had found out about issue #36 this
would have saved all of us a lot of time ^^' well I did learn a lot
about the internals of ReaR along the way so it's not time completely
wasted for me at least. And I guess the next person who searches this
string in a search engine should find this issue.</p>
<p>A suggestion:<br />
I looked around and I'm pretty sure I read about KERNEL_CMDLINE in
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L91">default.conf</a>
And, as you can see, in this file there is no mention of <code>unattended</code> or
<code>netdev</code> options, these are only mentionned in the
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc#rescue-image-kernel-command-line-options">manpage</a>.<br />
So, I would suggest copying the RESCUE IMAGE KERNEL COMMAND LINE OPTIONS
part from the manpage to default.conf for better documentation (or at
least mentioning this section of the manpage in default.conf).</p>
<h4 id="jsmeix_commented_at_2021-04-30_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830077062">2021-04-30 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1258" title="Permanent link">&para;</a></h4>
<p>Improved description of the ReaR specific special KERNEL_CMDLINE
settings in default.conf via<br />
<a href="https://github.com/rear/rear/commit/7b1354d6f3be145620e371a43da4affa29df5924">https://github.com/rear/rear/commit/7b1354d6f3be145620e371a43da4affa29df5924</a></p>
<h4 id="3id0_commented_at_2021-04-30_1302"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830079421">2021-04-30 13:02</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-30_1302" title="Permanent link">&para;</a></h4>
<p>Thank you!</p>
<h4 id="jsmeix_commented_at_2021-04-30_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830080434">2021-04-30 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1304" title="Permanent link">&para;</a></h4>
<p>@3id0<br />
you are welcome!</p>
<p>FYI<br />
what I basically always do to get an idea how things are in ReaR<br />
when I have only some ReaR string as entry point is</p>
<pre><code># cd usr/share/rear/

# find . -type f | xargs grep '&lt;some_ReaR_string&gt;'
</code></pre>
<p>and then I inspect the found code parts.</p>
<h4 id="3id0_commented_at_2021-04-30_1307"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830082570">2021-04-30 13:07</a>:<a class="headerlink" href="#3id0_commented_at_2021-04-30_1307" title="Permanent link">&para;</a></h4>
<p>I feel a bit stupid for never thinking of that but that's a very good
suggestion. Will do next time, thank you.</p>
<h4 id="jsmeix_commented_at_2021-04-30_1328"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-830094783">2021-04-30 13:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-04-30_1328" title="Permanent link">&para;</a></h4>
<p>Don't worry,<br />
I feel somewhat stuipd all the time when I deal with weird ReaR issues
;-)</p>
<p>I wish you a relaxed and recovering weekend!</p>
<h4 id="jsmeix_commented_at_2021-05-03_1113"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-831193587">2021-05-03 11:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-03_1113" title="Permanent link">&para;</a></h4>
<p>I wonder if we may also need similar (or perhaps even same) code in<br />
etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
for the <code>automatic_recovery</code> case<br />
(i.e. when kernel command line contains <code>automatic</code> or <code>auto_recover</code>)<br />
as we already have there for the <code>unattended_recovery</code> case<br />
(i.e. when kernel command line contains <code>unattended</code>)<br />
?</p>
<h4 id="3id0_commented_at_2021-06-02_1656"><img src="https://avatars.githubusercontent.com/u/11525496?v=4" width="50"><a href="https://github.com/3id0">3id0</a> commented at <a href="https://github.com/rear/rear/issues/2601#issuecomment-853214896">2021-06-02 16:56</a>:<a class="headerlink" href="#3id0_commented_at_2021-06-02_1656" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I wonder if we may also need similar (or perhaps even same) code in<br />
etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
for the <code>automatic_recovery</code> case<br />
(i.e. when kernel command line contains <code>automatic</code> or
<code>auto_recover</code>)<br />
as we already have there for the <code>unattended_recovery</code> case<br />
(i.e. when kernel command line contains <code>unattended</code>)<br />
?</p>
</blockquote>
<p>I suppose this question is not for me. But if it is: I have no idea 🤷</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-04-15.2601.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
