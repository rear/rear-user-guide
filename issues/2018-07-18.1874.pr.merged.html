<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1874 PR merged: Add code to recognize persistent LAN interface and manipulate KERNEL_CMDLINE - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1874 PR merged: Add code to recognize persistent LAN interface and manipulate KERNEL_CMDLINE";
        var mkdocs_page_input_path = "issues/2018-07-18.1874.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1874 PR merged: Add code to recognize persistent LAN interface and manipulate KERNEL_CMDLINE</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1874_pr_merged_add_code_to_recognize_persistent_lan_interface_and_manipulate_kernel_cmdline"><a href="https://github.com/rear/rear/pull/1874">#1874 PR</a> <code>merged</code>: Add code to recognize persistent LAN interface and manipulate KERNEL_CMDLINE<a class="headerlink" href="#1874_pr_merged_add_code_to_recognize_persistent_lan_interface_and_manipulate_kernel_cmdline" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="gdha_opened_issue_at_2018-07-18_1624"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/pull/1874">2018-07-18 16:24</a>:<a class="headerlink" href="#gdha_opened_issue_at_2018-07-18_1624" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):
    <a href="https://github.com/gdha/rear-automated-testing/issues/61">https://github.com/gdha/rear-automated-testing/issues/61</a>
    and #1400</p>
</li>
<li>
<p>How was this pull request tested? via ReaR-Automated-Testing
    platform</p>
</li>
<li>
<p>Brief description of the changes in this pull request: new code was
    added to recognize persistent naming of LAN interfaces. If required
    it will manipulate the KERNEL_CMDLINE</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2018-07-19_0850"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406203767">2018-07-19 08:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-19_0850" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I have no experience with the particular <code>net.ifnames=0</code> kernel command
line parameter<br />
but that particular case does not matter for what I do not like in
general with your<br />
current implementation as far as I understand it from plain looking at
the code.</p>
<p>As far as I understand it from plain looking at the code<br />
with your current implementation things would work as follows:</p>
<p>(1.)<br />
In default.conf</p>
<pre>
COPY_KERNEL_PARAMETERS=( 'net.ifnames' 'biosdevname' )
</pre>

<p>results that in rescue/GNU/Linux/290_kernel_cmdline.sh<br />
a <code>net.ifnames=0</code> kernel command line parameter setting<br />
will be added to the KERNEL_CMDLINE that will be used<br />
when booting the recovery system kernel.<br />
Up to that point there are no changes as things worked in the past.</p>
<p>(2.)<br />
Now via your current implementation there is your new<br />
subsequent script rescue/GNU/Linux/700_persistent_interface.sh<br />
that again removes the <code>net.ifnames=0</code> kernel command line parameter<br />
if persistent network interface naming is used on the original system<br />
from the KERNEL_CMDLINE that will be used<br />
when booting the recovery system kernel.</p>
<p>This means the user has no way to specify that the recovery system
kernel<br />
must boot with the <code>net.ifnames=0</code> kernel command line parameter set<br />
if persistent network interface naming is used on his original system.</p>
<p>This contradicts in general my favourite "final power to the user"
principle and<br />
it contradicts in particular what default.conf tells about
KERNEL_CMDLINE</p>
<pre>
# You can add arbitrary kernel command line parameters
# when booting the rescue/recovery system
# as you need it
</pre>

<p>I.e. when the user has in his etc/rear/local.conf</p>
<pre>
KERNEL_CMDLINE="net.ifnames=0"
</pre>

<p>then ReaR must obey the user's commandment and boot the recovery system
kernel<br />
with the <code>net.ifnames=0</code> kernel command line parameter set.</p>
<p>To solve the issue I suggest to not implement it in a new<br />
separated subsequent script but to add code to the existsing<br />
rescue/GNU/Linux/290_kernel_cmdline.sh<br />
that does by default (i.e. unless <code>net.ifnames</code> is specified in
KERNEL_CMDLINE)<br />
not add <code>net.ifnames=0</code> to KERNEL_CMDLINE<br />
if persistent network interface naming is used on the original system.</p>
<p>Simply put I suggest:<br />
By default<br />
if persistent network interface naming is used on the original system<br />
skip adding <code>net.ifnames=0</code> to KERNEL_CMDLINE<br />
in rescue/GNU/Linux/290_kernel_cmdline.sh</p>
<h4 id="jsmeix_commented_at_2018-07-19_0904"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406207921">2018-07-19 09:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-19_0904" title="Permanent link">&para;</a></h4>
<p>Only an untested proposal to show what I mean:</p>
<p>I think the code in rescue/GNU/Linux/290_kernel_cmdline.sh<br />
can be enhanced to support what is needed here<br />
and simplified (no longer the circuitous kernel_option_superseeded)<br />
to something like (excerpt - only the second for loop):</p>
<pre>
# Verify if the kernel option we want to add to KERNEL_CMDLINE are not already set/force by the user in the rear configuration.
# If yes, the parameter set in the configuration file have the priority and superseed the current kernel option.
for new_kernel_option in "${new_kernel_options_to_add[@]}" ; do
    new_kernel_option_keyword="${new_kernel_option%%=*}"

    for rear_kernel_option in $KERNEL_CMDLINE; do
        # Check if a kernel option key without value parameter (everything before =) is not already present in rear KERNEL_CMDLINE array.
        if test "$new_kernel_option_keyword = "${rear_kernel_option%%=*}" ; then
            Log "Current kernel option [$new_kernel_option] supperseeded by [$rear_kernel_option] in your rear configuration: (KERNEL_CMDLINE)"
            # Continue with the next new_kernel_option (i.e. continue the outer 'for' loop):
            continue 2
        fi
    done

    if test "net.ifnames" = "$new_kernel_option_keyword" ; then
        # If we are using persistent naming do not add net.ifnames to KERNEL_CMDLINE
        # see https://github.com/rear/rear/pull/1874
        # and continue with the next new_kernel_option:
        is_persistent_ethernet_name $( ip r | awk '$2 == "dev" && $8 == "src" { print $3 }' | sort -u | head -1 ) && continue
    fi

    LogPrint "Adding $new_kernel_option to KERNEL_CMDLINE"
    KERNEL_CMDLINE="$KERNEL_CMDLINE $new_kernel_option"
done
</pre>

<h4 id="jsmeix_commented_at_2018-07-19_0910"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406209467">2018-07-19 09:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-19_0910" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I added you as reviewer here<br />
because rescue/GNU/Linux/290_kernel_cmdline.sh<br />
is originally your script, cf.
<a href="https://github.com/rear/rear/pull/1495">https://github.com/rear/rear/pull/1495</a></p>
<h4 id="gdha_commented_at_2018-07-19_0920"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406212271">2018-07-19 09:20</a>:<a class="headerlink" href="#gdha_commented_at_2018-07-19_0920" title="Permanent link">&para;</a></h4>
<p>@jsmeix Thank you for the review! As you see by reviewing each others
code it can only get better. Thanks for the suggestion as it is indeed
easier and cleaner. Will take a day or two before I can change it due to
being off-site.</p>
<h4 id="jsmeix_commented_at_2018-07-19_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406235418">2018-07-19 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-19_1047" title="Permanent link">&para;</a></h4>
<p>I have a nitpicking question:</p>
<p>What do you think is best how to split<br />
the kernel option keyword from the kernel option value:</p>
<pre>
# new_kernel_option="foo=bar=baz"

# echo "keyword='${new_kernel_option%=*}'"
keyword='foo=bar'

# echo "keyword='${new_kernel_option%%=*}'"
keyword='foo'
</pre>

<p>I guess <code>${new_kernel_option%%=*}</code> would be better because<br />
I assume a '=' character never happens in a kernel option keyword<br />
but a '=' character might happen in a kernel option value<br />
because one cannot know what arbitrary values could be.<br />
For example think about values that could contain arbitrary characters<br />
like <code>some_password=arbitrary=characters</code></p>
<h4 id="gdha_commented_at_2018-07-20_0930"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406544572">2018-07-20 09:30</a>:<a class="headerlink" href="#gdha_commented_at_2018-07-20_0930" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schabrolles I reworked the code in 290_kernel_cmdline.sh
script to deal with persistent naming (I also included jsmeix suggestion
of above). It works fine as I tested it via rear-automated-testing.</p>
<h4 id="jsmeix_commented_at_2018-07-20_1003"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406553805">2018-07-20 10:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-20_1003" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I approve it because you tested it and it works well for you<br />
and you have perfectly well documented what the code<br />
is meant to do.</p>
<p>But - from plain looking at the code - it still seems<br />
as if the added part at the end of<br />
usr/share/rear/rescue/GNU/Linux/290_kernel_cmdline.sh<br />
makes it impossible for the user to enforce via<br />
<code>KERNEL_CMDLINE="$KERNEL_CMDLINE net.ifnames=0"</code><br />
that the recovery system kernel gets booted with the <code>net.ifnames=0</code><br />
kernel option set.</p>
<p>Regardless if that works or not I think when the user has explicity<br />
specified it (all in local.conf is what the user has explicity
specified<br />
in contrast to what we have in default.conf) ReaR must obey.</p>
<p>Simply put:<br />
I think ReaR is for root and runs as root and then the user<br />
can do destructive things if he is careless, e.g. when there is<br />
<code>rm -rf --no-preserve-root /</code> in local.conf the user gets that.</p>
<p>Or I misunderstand what the added part at the end of<br />
usr/share/rear/rescue/GNU/Linux/290_kernel_cmdline.sh<br />
actually does?</p>
<h4 id="schabrolles_commented_at_2018-07-20_1004"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406554096">2018-07-20 10:04</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-07-20_1004" title="Permanent link">&para;</a></h4>
<p>@gdha, I don't currently don't have time to deeply look into the code;
but had a quick look on it. If I understand well, the purpose of this PR
is to remove <code>KERNEL_CMDLINE</code> parameters from local.conf that could be
set by "mistake" like <code>net.ifname=0</code> when biosdevname are currently in
use on the real system. Am I right ?</p>
<h4 id="jsmeix_commented_at_2018-07-20_1015"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406557093">2018-07-20 10:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-07-20_1015" title="Permanent link">&para;</a></h4>
<p>I think it could happen in a migration mode use case<br />
(i.e. when <code>rear recover</code> is run on different replacement hardware<br />
or when <code>rear recover</code> is run in a different new environment)<br />
that a <code>KERNEL_CMDLINE</code> setting in local.conf is wrong<br />
for the replacement hardware or in the new environment.</p>
<p>But in this case the user can edit the kernel command line<br />
in the recovery system boot menue so that a<br />
wrong <code>KERNEL_CMDLINE</code> setting in local.conf<br />
is not a dead end for the user.</p>
<h4 id="gdha_commented_at_2018-07-23_0932"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1874#issuecomment-406997626">2018-07-23 09:32</a>:<a class="headerlink" href="#gdha_commented_at_2018-07-23_0932" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schabrolles Indeed users can add it anyhow without fully
understanding the meaning of it or the side-effects (=no interfaces
found in recovery mode). This protects them from such mistakes and in
case they really need it they can still add it manually or on the
command level at boot up time.<br />
Furthermore, it makes my ReaR Automated Testing environment much easier
(less config sets required)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-07-18.1874.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
