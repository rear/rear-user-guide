<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2016 01 18.757.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2016 01 18.757.issue.closed";
        var mkdocs_page_input_path = "issues/2016-01-18.757.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2016 01 18.757.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="757_issue_closed_os_doesnt_boot_after_recover"><a href="https://github.com/rear/rear/issues/757">#757 Issue</a> <code>closed</code>: OS doesn't boot after recover<a class="headerlink" href="#757_issue_closed_os_doesnt_boot_after_recover" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="yunsr_opened_issue_at_2016-01-18_0938"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> opened issue at <a href="https://github.com/rear/rear/issues/757">2016-01-18 09:38</a>:<a class="headerlink" href="#yunsr_opened_issue_at_2016-01-18_0938" title="Permanent link">&para;</a></h4>
<p>I could successfully created backup (mkbackup) of OS (SUSE 11 SP3 with
rear-1.17.2-1) and sent to NFS share.</p>
<p>My site.conf:</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://#######/reear"
BACKUP_OPTIONS="nolock"
NETFS_KEEP_OLD_BACKUP_COPY=yes
ONLY_INCLUDE_VG=( vg0 )
AUTOEXCLUDE_MULTIPATH=n
</code></pre>
<p>I'm try to recover my system and recover ended successfully.</p>
<pre><code>....fi;
    done &lt; "${TMP_DIR}/backup.splitted"; kill -9 $(cat "${TMP_DIR}/cat_pid"); rm "${TMP_DIR}/cat_pid"; rm "${TMP_DIR}/backup.splitted"; rm "${TMP_DIR}/backup.md5";
fi )
/usr/share/rear/lib/_input-output-functions.sh: line 65: kill: (8294) - No such process
2016-01-15 14:49:19 Finished in 868 seconds
2016-01-15 14:49:19 Removing build area /tmp/rear.tqtCIeb4j8Oukef
rmdir: removing directory, `/tmp/rear.tqtCIeb4j8Oukef'
2016-01-15 14:49:19 End of program reached*

But in recover log I get the following errors:

*......2016-01-15 14:49:14 Installing GRUB boot loader


    GNU GRUB  version 0.97  (640K lower / 3072K upper memory)

 [ Minimal BASH-like line editing is supported.  For the first word, TAB
   lists possible command completions.  Anywhere else TAB lists the possible
   completions of a device/filename. ]
grub&gt; device (hd0) /dev/mapper/mpatha
grub&gt; root (hd0,-1)

**Error 11: Unrecognized device string
grub&gt; setup --stage2=/boot/grub/stage2 --prefix=/grub (hd0)**

Error 12: Invalid device requested
grub&gt; quit
2016-01-15 14:49:14 Including finalize/Linux-i386/22_install_elilo.sh
2016-01-15 14:49:14 Including finalize/Linux-i386/22_install_grub2.sh
2016-01-15 14:49:14 Including finalize/Linux-i386/23_run_efibootmgr.sh
2016-01-15 14:49:14 Including finalize/GNU/Linux/30_create_mac_mapping.sh*
</code></pre>
<p>And in next step OS didn't boot from recovered system disk! (server
boots in 'Red Screen' with illegal opcode)<br />
If you can guide me the right direction, it would be much appreciated.</p>
<p>Thanks</p>
<h4 id="gozora_commented_at_2016-01-18_0943"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172479464">2016-01-18 09:43</a>:<a class="headerlink" href="#gozora_commented_at_2016-01-18_0943" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
Seeing "Red screen" term, I guess you are using some kind of HP(e)
hw....</p>
<p>Try to boot system using Standard SLES11 ISO to <strong>Rescue mode</strong>, and
trigger:</p>
<p><code>/usr/sbin/grub-install.unsupported &lt;path_to_your_bood_disk&gt;</code></p>
<h4 id="yunsr_commented_at_2016-01-18_1011"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172486957">2016-01-18 10:11</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-18_1011" title="Permanent link">&para;</a></h4>
<p>Ok, but why Rear improperly setup bootloader?</p>
<h4 id="gozora_commented_at_2016-01-18_1015"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172487919">2016-01-18 10:15</a>:<a class="headerlink" href="#gozora_commented_at_2016-01-18_1015" title="Permanent link">&para;</a></h4>
<p>Not sure if this is fault of ReaR ...<br />
I've faced something similar in the past (but only with particular
Generation of HW), unfortunately I didn't had time for deeper
investigation.</p>
<h4 id="gdha_commented_at_2016-01-18_1018"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172488535">2016-01-18 10:18</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-18_1018" title="Permanent link">&para;</a></h4>
<p>The grub tries to setup a multipath device:</p>
<pre><code>grub&gt; device (hd0) /dev/mapper/mpatha
</code></pre>
<p>Is this correct?</p>
<h4 id="yunsr_commented_at_2016-01-18_1021"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172489190">2016-01-18 10:21</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-18_1021" title="Permanent link">&para;</a></h4>
<p>yes it's correct</p>
<h4 id="gdha_commented_at_2016-01-18_1203"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172510719">2016-01-18 12:03</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-18_1203" title="Permanent link">&para;</a></h4>
<p>I think grub does not understand <strong>/dev/mapper/mpatha</strong> - perhaps it
should be <em>/dev/disk/by-id/scsi-...</em><br />
That could explain the error by grub</p>
<h4 id="pavoldomin_commented_at_2016-01-18_1245"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172518735">2016-01-18 12:45</a>:<a class="headerlink" href="#pavoldomin_commented_at_2016-01-18_1245" title="Permanent link">&para;</a></h4>
<p>It's also worth testing with the recent snapshot version, as there were
some improvements since the August version.</p>
<h4 id="yunsr_commented_at_2016-01-18_1450"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172549384">2016-01-18 14:50</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-18_1450" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think grub does not understand /dev/mapper/mpatha - perhaps it
should be /dev/disk/by-id/scsi-...<br />
That could explain the error by grub</p>
</blockquote>
<p>it's seems to be true about grub. So we must to boot using Standard
SLES11 ISO and reinstall bootloader after OS recover? there are no other
options in rear to solve this issue?</p>
<h4 id="gdha_commented_at_2016-01-19_0803"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172769907">2016-01-19 08:03</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-19_0803" title="Permanent link">&para;</a></h4>
<p>@yunsr <strong>SAN boot disks</strong> are not yet 100% fully integrated into rear. I
cannot do it blindly without doing hands-on. If no-one do it for us then
the community (customers) can buy time do implement this for them
(remotely or on-site).</p>
<h4 id="gdha_commented_at_2016-01-19_0804"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172770134">2016-01-19 08:04</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-19_0804" title="Permanent link">&para;</a></h4>
<p>@yunsr PS I have changed the title accordingly, if that was ok for you?</p>
<h4 id="yunsr_commented_at_2016-01-19_0831"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172774949">2016-01-19 08:31</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-19_0831" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I have changed the title accordingly, if that was ok for you?</p>
</blockquote>
<p>It's not true. We havn't Boot from SAN in our case. Boot partition
reside on local disk but it was named as mpath device.</p>
<h4 id="gdha_commented_at_2016-01-19_1018"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-172805260">2016-01-19 10:18</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-19_1018" title="Permanent link">&para;</a></h4>
<p>@yunsr Check your <code>cat /proc/cmdline</code> output. To avoid internal disks
being recognized as mpath devices add <code>multipath=off</code> to the
initrd/kernel parameters</p>
<h4 id="yunsr_commented_at_2016-01-20_1135"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-173178660">2016-01-20 11:35</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-20_1135" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think grub does not understand /dev/mapper/mpatha - perhaps it
should be /dev/disk/by-id/scsi-...<br />
That could explain the error by grub</p>
</blockquote>
<p>Could you tell pls why after recovery OS ReaR:</p>
<ol>
<li>in /mnt/local/boot/grub original device.map and menu.lst move to
    device.map.rearbak, menu.lst.rearbak. It's not correct configs</li>
<li>also rear changed /mnt/local/etc/sysconfig/kernel<br />
    How i can disable it ?</li>
</ol>
<p>As solution was written script which was added to rear config with
POST_RECOVERY_SCRIPT option.<br />
This script recover original menu.lst,device.map,/etc/sysconfig/kernel
and run grub-install<br />
After that everything is okay, OS booted successfully</p>
<h4 id="gdha_commented_at_2016-01-20_1301"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-173196809">2016-01-20 13:01</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-20_1301" title="Permanent link">&para;</a></h4>
<p>The target disk device must be a different one then the original one.
That is the reason why disk migration happens and therefore a different
UUID is in use. Did you executed a <code>diff</code> and those 2 files?</p>
<h4 id="yunsr_commented_at_2016-01-20_1446"><img src="https://avatars.githubusercontent.com/u/10756657?v=4" width="50"><a href="https://github.com/yunsr">yunsr</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-173225296">2016-01-20 14:46</a>:<a class="headerlink" href="#yunsr_commented_at_2016-01-20_1446" title="Permanent link">&para;</a></h4>
<blockquote>
<p>The target disk device must be a different one then the original one.
That is the reason why disk &gt;migration happens and therefore a
different UUID is in use.</p>
</blockquote>
<p>I agree with you (or when restoring to a new disk will be new UUID).<br />
Take another attempt and after recover used Rear generated device.map
and menu.lst. Only run grub-install. System booted without any problems.</p>
<h4 id="gdha_commented_at_2016-01-25_0921"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-174445650">2016-01-25 09:21</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-25_0921" title="Permanent link">&para;</a></h4>
<p>@ypid Are your questions being answered? If yes, please close this
issue. If not, tell us what is not yet clear.</p>
<h4 id="ypid_commented_at_2016-01-25_0922"><img src="https://avatars.githubusercontent.com/u/1301158?u=3d1f390877ed3e1403e23df4fe95475dd2f578eb&v=4" width="50"><a href="https://github.com/ypid">ypid</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-174445920">2016-01-25 09:22</a>:<a class="headerlink" href="#ypid_commented_at_2016-01-25_0922" title="Permanent link">&para;</a></h4>
<p>@gdha I did not open the issue 😉</p>
<h4 id="gdha_commented_at_2016-01-25_1003"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/757#issuecomment-174457909">2016-01-25 10:03</a>:<a class="headerlink" href="#gdha_commented_at_2016-01-25_1003" title="Permanent link">&para;</a></h4>
<p>@yunsr Are your questions being answered? If yes, please close this
issue.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-01-18.757.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
