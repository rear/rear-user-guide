<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3263 Issue open: OUTPUT=PORTABLE on SLES15/SP5 in rear recover dracut fails to build initramfs - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3263 Issue open: OUTPUT=PORTABLE on SLES15/SP5 in rear recover dracut fails to build initramfs";
        var mkdocs_page_input_path = "issues/2024-07-02.3263.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3263 Issue open: OUTPUT=PORTABLE on SLES15/SP5 in rear recover dracut fails to build initramfs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3263_issue_open_outputportable_on_sles15sp5_in_rear_recover_dracut_fails_to_build_initramfs"><a href="https://github.com/rear/rear/issues/3263">#3263 Issue</a> <code>open</code>: OUTPUT=PORTABLE on SLES15/SP5 in <code>rear recover</code> dracut fails to build initramfs<a class="headerlink" href="#3263_issue_open_outputportable_on_sles15sp5_in_rear_recover_dracut_fails_to_build_initramfs" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="saschalucas_opened_issue_at_2024-07-02_1141"><img src="https://avatars.githubusercontent.com/u/8359898?v=4" width="50"><a href="https://github.com/saschalucas">saschalucas</a> opened issue at <a href="https://github.com/rear/rear/issues/3263">2024-07-02 11:41</a>:<a class="headerlink" href="#saschalucas_opened_issue_at_2024-07-02_1141" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):
    <code>2.7-git.5431.6389691b.master / 2024-05-03</code></p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME="SLES"
VERSION="15-SP5"
VERSION_ID="15.5"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=PORTABLE
OUTPUT_URL=file:///var/lib/rear/output
POST_RECOVERY_COMMANDS+=( "tar -xf /root/server1005-commvault-certs.tar.gz -C /mnt/local/opt/commvault/Base64/" )

BACKUP=EXTERNAL
EXTERNAL_RESTORE=/root/commvault-restore.sh

FIRMWARE_FILES=( 'no' )
MODULES=( 'no_modules' )

DISKS_TO_BE_WIPED='/dev/vd[a-z] /dev/sd[a-z]'
USER_INPUT_TIMEOUT=30
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR): <code>VM (esx)</code></p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): <code>x86_64</code></p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): <code>BIOS/grub</code></p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): <code>local disk</code></p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                        KNAME     PKNAME    TRAN TYPE FSTYPE      LABEL  SIZE MOUNTPOINT
/dev/sda                    /dev/sda                 disk                     20G 
|-/dev/sda1                 /dev/sda1 /dev/sda       part                      8M 
`-/dev/sda2                 /dev/sda2 /dev/sda       part LVM2_member         20G 
  |-/dev/mapper/system-swap /dev/dm-0 /dev/sda2      lvm  swap                 4G [SWAP]
  `-/dev/mapper/system-root /dev/dm-1 /dev/sda2      lvm  ext4                19G /
/dev/sdb                    /dev/sdb                 disk LVM2_member         10G 
|-/dev/mapper/system-swap   /dev/dm-0 /dev/sdb       lvm  swap                 4G [SWAP]
`-/dev/mapper/system-data   /dev/dm-2 /dev/sdb       lvm  ext4                 7G /data
/dev/sr0                    /dev/sr0            ata  rom                    1024M
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    On SLES15/SP5 <code>rear recover</code> fails to build initramfs. On screen and
    log this content is shown:</li>
</ul>
<!-- -->

<pre><code>2024-07-02 13:11:01.185390577 Including finalize/SUSE_LINUX/i386/550_rebuild_initramfs.sh
2024-07-02 13:11:06.369117289 Recreating initrd with /usr/bin/dracut...
2024-07-02 13:11:06.632109467 Warning:
                              Failed to recreate initrd with /usr/bin/dracut.
                              Check '/rear/var/log/rear/rear-server1005-rescue.log' why /usr/bin/dracut failed
                              and decide if the recreated system will boot
                              with the initrd 'as is' from the backup restore.

2024-07-02 13:11:06.639258185 Including finalize/Linux-i386/610_EFISTUB_run_efibootmgr.sh
</code></pre>
<ul>
<li>
<p>Workaround, if any: <code>-</code></p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
<a href="https://github.com/user-attachments/files/16067384/rear-mkrescue-server1005.log">rear-mkrescue-server1005.log</a><br />
<a href="https://github.com/user-attachments/files/16067386/rear-recover-server1005.log">rear-recover-server1005.log</a><br />
    logfiles of mkrescue and recover attached, however without -D.</p>
</li>
</ul>
<h4 id="gdha_commented_at_2024-07-02_1412"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3263#issuecomment-2203335929">2024-07-02 14:12</a>:<a class="headerlink" href="#gdha_commented_at_2024-07-02_1412" title="Permanent link">&para;</a></h4>
<p>@saschalucas Did you check
'/rear/var/log/rear/rear-server1005-rescue.log' why /usr/bin/dracut
failed?</p>
<h4 id="saschalucas_commented_at_2024-07-02_1854"><img src="https://avatars.githubusercontent.com/u/8359898?v=4" width="50"><a href="https://github.com/saschalucas">saschalucas</a> commented at <a href="https://github.com/rear/rear/issues/3263#issuecomment-2204076940">2024-07-02 18:54</a>:<a class="headerlink" href="#saschalucas_commented_at_2024-07-02_1854" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@saschalucas Did you check
'/rear/var/log/rear/rear-server1005-rescue.log' why /usr/bin/dracut
failed?</p>
</blockquote>
<p>yes. <code>/rear/var/log/rear/rear-server1005-rescue.log</code> is attached as
<code>rear-recover-server1005.log</code>. Sorry for the renaming ... but I found
<code>rescue</code> didn't match the rear workflow. In the log itself there is
nothing else like on screen and like mentioned above in the issue:</p>
<pre><code>2024-07-02 13:11:01.185390577 Including finalize/SUSE_LINUX/i386/550_rebuild_initramfs.sh
2024-07-02 13:11:06.369117289 Recreating initrd with /usr/bin/dracut...
2024-07-02 13:11:06.632109467 Warning:
                              Failed to recreate initrd with /usr/bin/dracut.
                              Check '/rear/var/log/rear/rear-server1005-rescue.log' why /usr/bin/dracut failed
                              and decide if the recreated system will boot
                              with the initrd 'as is' from the backup restore.

2024-07-02 13:11:06.639258185 Including finalize/Linux-i386/610_EFISTUB_run_efibootmgr.sh
</code></pre>
<p>So the log contains no further hint what went wrong.</p>
<h4 id="jsmeix_commented_at_2024-07-03_0708"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3263#issuecomment-2205250211">2024-07-03 07:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-07-03_0708" title="Permanent link">&para;</a></h4>
<p>@saschalucas<br />
you need at least debug mode '-d'<br />
preferably full debugscript mode '-D'<br />
to be able to see what went wrong.</p>
<p>In general:<br />
Caution with possible secrets in a debug log file:<br />
When 'rear' is run via '-D' in debugscript mode<br />
it logs executed commands via the bash command 'set -x'<br />
that print commands and their arguments as they are executed.<br />
So in particular when arguments contain secret values<br />
(e.g. something like a password or whatever else)<br />
such secret values may appear in the log file.<br />
Also secrets may be stored in some other files<br />
like /var/lib/rear/layout/disklayout.conf<br />
or /var/lib/rear/layout/diskrestore.sh<br />
cf. <code>[password=&lt;password&gt;]</code> in the section<br />
"Disk layout file syntax" in<br />
doc/user-guide/06-layout-configuration.adoc<br />
online at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/rear-2.7/doc/user-guide/06-layout-configuration.adoc</a><br />
So before you attach your debug log file or other files here<br />
(GitHub is a public accessible place), inspect your files<br />
and verify that they do not accidentally cointain secrets.</p>
<h4 id="jsmeix_commented_at_2024-07-03_0718"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3263#issuecomment-2205266579">2024-07-03 07:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-07-03_0718" title="Permanent link">&para;</a></h4>
<p>@saschalucas<br />
because you use <code>OUTPUT=PORTABLE</code>:<br />
What rescue system do you use?<br />
I ask because</p>
<pre><code>In portable mode ReaR assumes that all required software
is available in the rescue system. There are no further
checks for missing software. If you miss some software,
the recovery process will fail.
</code></pre>
<p>cf.<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/17-Portable-Mode.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/17-Portable-Mode.adoc</a></p>
<h4 id="saschalucas_commented_at_2024-07-03_1659"><img src="https://avatars.githubusercontent.com/u/8359898?v=4" width="50"><a href="https://github.com/saschalucas">saschalucas</a> commented at <a href="https://github.com/rear/rear/issues/3263#issuecomment-2206800315">2024-07-03 16:59</a>:<a class="headerlink" href="#saschalucas_commented_at_2024-07-03_1659" title="Permanent link">&para;</a></h4>
<p><code>-D</code> reveals the problem:</p>
<pre><code>++ LogPrint 'Recreating initrd with /usr/bin/dracut...'
2024-07-03 18:29:35.377244440 Recreating initrd with /usr/bin/dracut...
++ chroot /mnt/local /bin/bash -c 'PATH=/sbin:/usr/sbin:/usr/bin:/bin /usr/bin/dracut --force'

dracut: Cannot find module directory /lib/modules/6.6.14-1-lts/
dracut: and --no-kernel was not specified
++ LogPrintError 'Warning:
Failed to recreate initrd with /usr/bin/dracut.
Check '\''/rear/var/log/rear/rear-server1005-rescue.log'\'' why /usr/bin/dracut failed
and decide if the recreated system will boot
with the initrd '\''as is'\'' from the backup restore.
'
2024-07-03 18:29:35.760132926 Warning:
                              Failed to recreate initrd with /usr/bin/dracut.
                              Check '/rear/var/log/rear/rear-server1005-rescue.log' why /usr/bin/dracut failed
                              and decide if the recreated system will boot
                              with the initrd 'as is' from the backup restore.
</code></pre>
<p>The SLES version of <code>finalize/SUSE_LINUX/i386/550_rebuild_initramfs.sh</code>
fails here, because it is looking for a kernel from the rescue system
<code>systemrescue-11.0</code>. So I'm bitten by a side effect of the portable mode
here.</p>
<p>For curiosity on Oracle Linux 8 <code>dracut</code> seems to be called in an other
way. Under the same rescue system <code>systemrescue-11.0</code> the recreation of
initramfs seems to work:</p>
<pre><code>2024-06-26 08:21:28.990404381 Including finalize/Fedora/550_rebuild_initramfs.sh
2024-06-26 08:21:28.994816038 Original OLD_INITRD_MODULES=(  )
2024-06-26 08:21:29.006200942 New INITRD_MODULES=' '
2024-06-26 08:21:29.029542327 Running dracut...
2024-06-26 08:21:44.491985680 Updated initrd with new drivers for kernel 4.18.0-513.18.1.0.1.el8_9.x86_64.
2024-06-26 08:21:44.500304291 Running dracut...
2024-06-26 08:21:59.546876691 Updated initrd with new drivers for kernel 4.18.0-513.9.1.el8_9.x86_64.
2024-06-26 08:21:59.556064290 Running dracut...
2024-06-26 08:22:15.147509223 Updated initrd with new drivers for kernel 5.15.0-201.135.6.el8uek.x86_64.
2024-06-26 08:22:15.156579498 Running dracut...
2024-06-26 08:22:30.757426667 Updated initrd with new drivers for kernel 5.15.0-205.149.5.1.el8uek.x86_64.



-------------------------------------------------------------------------------



[Export of Github issue for [rear/rear](https://github.com/rear/rear).]
</code></pre>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2024-07-02.3263.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
