<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2926 Issue closed: ERROR 420_autoresize_last_partitions.sh: line 73: 10: command not found - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2926 Issue closed: ERROR 420_autoresize_last_partitions.sh: line 73: 10: command not found";
        var mkdocs_page_input_path = "issues/2023-02-13.2926.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2926 Issue closed: ERROR 420_autoresize_last_partitions.sh: line 73: 10: command not found</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2926_issue_closed_error_420_autoresize_last_partitionssh_line_73_10_command_not_found"><a href="https://github.com/rear/rear/issues/2926">#2926 Issue</a> <code>closed</code>: ERROR 420_autoresize_last_partitions.sh: line 73: 10: command not found<a class="headerlink" href="#2926_issue_closed_error_420_autoresize_last_partitionssh_line_73_10_command_not_found" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="schlomo_opened_issue_at_2023-02-13_1935"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/2926">2023-02-13 19:35</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-02-13_1935" title="Permanent link">&para;</a></h4>
<p>Context: Recovery of 8GB disk on 7.5GB disk, triggering automatic
shrinking.</p>
<p>end of recovery output:</p>
<pre><code>Comparing disks
Cannot check write protection by ID for /dev/sda (no ID found)
Device sda has size 8053063680 bytes but 8589934592 bytes is expected (needs manual configuration)
Switching to manual disk layout configuration (GiB sizes rounded down to integer)
/dev/sda had size 8589934592 (8 GiB) but is now 8053063680 (7 GiB)
Original disk /dev/sda does not exist (with same size) in the target system
Cannot check write protection by ID for /dev/sda (no ID found)
Using /dev/sda (the only available of the disks) for recreating /dev/sda
Current disk mapping table (source =&gt; target):
  /dev/sda =&gt; /dev/sda

Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Confirm identical disk mapping and proceed without manual configuration
3) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
4) Use Relax-and-Recover shell and return back to here
5) Abort 'rear recover'
(default '1' timeout 300 seconds)
1
User confirmed disk mapping
Trying to automatically resize last partition when disk size changed
Last partition /dev/sda2 must be shrinked by 537902592 bytes to still fit on device
ERROR: Last partition /dev/sda2 cannot be shrinked (new device more than 2% smaller, see AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE)
Some latest log messages since the last called script 420_autoresize_last_partitions.sh:
  2023-02-13 19:21:15.705015961 Trying to automatically resize last partition when disk size changed
  2023-02-13 19:21:15.764584572 Last partition /dev/sda2 must be shrinked by 537902592 bytes to still fit on device
Some messages from /var/tmp/rear.BSY0Nr07uqIcQF5/tmp/rear.recover.stdout_stderr since the last called script 420_autoresize_last_partitions.sh:
  /usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh: line 73: 10: command not found
  8589934592
  8053063680
  512
  9437184
  legacy_boot
  3623878656
  0
Use debug mode '-d' for some debug messages or debugscript mode '-D' for full debug messages with 'set -x' output
Aborting due to an error, check /var/log/rear/rear-rear-sle15sp4.log for details
Exiting rear recover (PID 3777) and its descendant processes ...
Running exit tasks
Terminated
</code></pre>
<p>Looking at the root cause I find in
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh#L73">https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh#L73</a>
the following:</p>
<pre><code># Avoid 'set -e -u' exit e.g. because of "AUTORESIZE_PARTITIONS[@]: unbound variable"
# note that assigning an empty array like AUTORESIZE_PARTITIONS=() does not help
# against array elements like AUTORESIZE_PARTITIONS[0] are unbound variables:
${AUTORESIZE_PARTITIONS:=}
${AUTORESIZE_EXCLUDE_PARTITIONS:=}
# Set fallbacks (same as default.conf) if mandatory numbers are not set (the user may set them empty):
${AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE:=2}
${AUTOINCREASE_DISK_SIZE_THRESHOLD_PERCENTAGE:=10}

# Skip if not in migration mode:
is_true "$MIGRATION_MODE" || return 0
</code></pre>
<p>that explains also the error message of <code>line 73: 10: command not found</code>
which refers to <code>${AUTOINCREASE_DISK_SIZE_THRESHOLD_PERCENTAGE:=10}</code> as
that resolves to just a line with <code>10</code> in it.</p>
<p>The change happened in DEc 2021 by @jsmeix in
<a href="https://github.com/rear/rear/commit/fd3a3bbf6b0ea7a57286b737159f310cd94414e8">https://github.com/rear/rear/commit/fd3a3bbf6b0ea7a57286b737159f310cd94414e8</a>
and I'm wondering about these lines and they are supposed to do.</p>
<p>Maybe a simple <code>:</code> is missing in front of the lines, like this:</p>
<pre><code># Avoid 'set -e -u' exit e.g. because of "AUTORESIZE_PARTITIONS[@]: unbound variable"
# note that assigning an empty array like AUTORESIZE_PARTITIONS=() does not help
# against array elements like AUTORESIZE_PARTITIONS[0] are unbound variables:
: ${AUTORESIZE_PARTITIONS:=}
: ${AUTORESIZE_EXCLUDE_PARTITIONS:=}
# Set fallbacks (same as default.conf) if mandatory numbers are not set (the user may set them empty):
: ${AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE:=2}
: ${AUTOINCREASE_DISK_SIZE_THRESHOLD_PERCENTAGE:=10}

# Skip if not in migration mode:
is_true "$MIGRATION_MODE" || return 0
</code></pre>
<h4 id="jsmeix_commented_at_2023-02-14_0930"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2926#issuecomment-1429407654">2023-02-14 09:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_0930" title="Permanent link">&para;</a></h4>
<p>Because that variables are set in default.conf<br />
those assingments normally do nothing - except<br />
evaluating to a nonsense command.</p>
<p>Sigh!<br />
I should have tried that more carefully on command line<br />
or have had a look how plain ':=' is done at other code places.</p>
<pre><code># AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE=""

# ${AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE:=2}
bash: 2: command not found

#  echo "'$AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE'"
'2'
</code></pre>
<p>But the intended assignment works nevertheless.<br />
I think it works because when bash evaluates the command line<br />
it first sets the variable to the value and<br />
then it runs the resulting command which fails<br />
but the variable has the new value nevertheless.</p>
<h4 id="schlomo_commented_at_2023-02-14_0933"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2926#issuecomment-1429412678">2023-02-14 09:33</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_0933" title="Permanent link">&para;</a></h4>
<p>Yes, that is why I suggested to use <code>: var=val</code> as a "no-operation"
command instead of <code>echo</code>. That way you'd see it in a debug log but not
in a normal log.</p>
<h4 id="schlomo_commented_at_2023-02-14_0935"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2926#issuecomment-1429415288">2023-02-14 09:35</a>:<a class="headerlink" href="#schlomo_commented_at_2023-02-14_0935" title="Permanent link">&para;</a></h4>
<p>BTW, IMHO we should avoid having commands in our scripts that are
expected to fail as we otherwise will never gain the ability to enable
hard error control via <code>set -eu</code> or such. It is also super confusing to
find random strange output in the logs that is actually normal without
an indication that it is not a problem.</p>
<h4 id="jsmeix_commented_at_2023-02-14_0937"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2926#issuecomment-1429418635">2023-02-14 09:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_0937" title="Permanent link">&para;</a></h4>
<p>Of course I did not want to make a command that fails.<br />
I try hard to not let things fail, cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
But I am a human - not a bot.</p>
<h4 id="jsmeix_commented_at_2023-02-14_0939"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2926#issuecomment-1429420082">2023-02-14 09:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_0939" title="Permanent link">&para;</a></h4>
<p>Fixed by<br />
<a href="https://github.com/rear/rear/commit/b20796b8c93f88a90cadca73d0fb84fe0d1e9ac5">https://github.com/rear/rear/commit/b20796b8c93f88a90cadca73d0fb84fe0d1e9ac5</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-02-13.2926.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
