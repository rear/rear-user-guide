<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3014 Issue closed: RFC: enabling automatic backup and restore test - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3014 Issue closed: RFC: enabling automatic backup and restore test";
        var mkdocs_page_input_path = "issues/2023-06-19.3014.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3014 Issue closed: RFC: enabling automatic backup and restore test</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3014_issue_closed_rfc_enabling_automatic_backup_and_restore_test"><a href="https://github.com/rear/rear/issues/3014">#3014 Issue</a> <code>closed</code>: RFC: enabling automatic backup and restore test<a class="headerlink" href="#3014_issue_closed_rfc_enabling_automatic_backup_and_restore_test" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>ReaR Project</code></p>
<h4 id="pcahyna_opened_issue_at_2023-06-19_1500"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/issues/3014">2023-06-19 15:00</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2023-06-19_1500" title="Permanent link">&para;</a></h4>
<p>@lzaoral and @antonvoznia have created a fully automated test that
performs a backup, boots in to the rescue environment, recovers the
system, and reboots into the recovered system. The test can be triggered
on all pull requests, using Packit (the service that currently merely
rebuilds RPMs).</p>
<p>The test scripts are currently in @antonvoznia's repository:
<a href="https://github.com/antonvoznia/rear-testing">https://github.com/antonvoznia/rear-testing</a>
. I would like to enable the tests on the main ReaR repository and run
them on all PRs. The test structure is such that the scripts are assumed
to be in a separate repository and in the main repository itself there
is merely a some configuration (test plan) that describes which tests to
run. If we are to keep the structure, we should import the scripts into
a repository under our organization (if we run them by default, they
should be under our control and not in some private repo).</p>
<p>We then need to choose a name for the test repository. <code>rear-testing</code> or
<code>rear-tests</code> or whatever seems to me a bit too generic - one may have
different kinds of tests (there is already a <code>tests</code> subdirectory with
different tests, although they are not much used AFAICT). The
distinctive feature of the new tests is that they are described using
the TMT (Test Management Tool,
<a href="https://github.com/teemtee/tmt">https://github.com/teemtee/tmt</a> )
metadata. For this reason, I would like to call the new repository
<code>rear-tmt-tests</code> or similar. If tests written using a different
framework appear, they would go into a different repo to keep things
organized.</p>
<p>Thoughts?</p>
<p>If there are no objections, I would like to import and enable the new
test quite soon - in a week or so.</p>
<p>If anyone is interested in technical details of this test, it is
described in @antonvoznia 's diploma thesis -
<a href="https://dspace.cvut.cz/handle/10467/107238">https://dspace.cvut.cz/handle/10467/107238</a>
, which has already resulted in our ShellCheck configuration ( #2976 ).</p>
<h4 id="jsmeix_commented_at_2023-06-20_1113"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1598582266">2023-06-20 11:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-20_1113" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
Thank You!<br />
An automatic backup and restore test is very much needed.<br />
I have no objections to import and enable the new test soon.</p>
<p>As far as I read in<br />
<a href="https://dspace.cvut.cz/bitstream/handle/10467/107238/F3-DP-2023-Voznia-Anton-dip_thesis-2.pdf">https://dspace.cvut.cz/bitstream/handle/10467/107238/F3-DP-2023-Voznia-Anton-dip_thesis-2.pdf</a><br />
"Chapter 4 ReaR testing in infrastructure"<br />
the code (in particular all those 'rl...' functions) in<br />
<a href="https://github.com/antonvoznia/rear-testing">https://github.com/antonvoznia/rear-testing</a><br />
seem to be from<br />
<a href="https://github.com/beakerlib">https://github.com/beakerlib</a><br />
but - at least at first glance - I don't find documentation there<br />
so currently for me this is mostly a "black box"<br />
where I cannot review anything.</p>
<p>I have a question:<br />
At least at first glance I could not find how the original system<br />
and the replacement system are configured?<br />
I mean in particular<br />
how to specify the storage layout on the original system<br />
and the disks with their sizes on the replacement system<br />
so that we could test recovery of various storage layouts<br />
on various more or less identical replacement systems.</p>
<h4 id="pcahyna_commented_at_2023-06-20_1125"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1598596238">2023-06-20 11:25</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-20_1125" title="Permanent link">&para;</a></h4>
<blockquote>
<p>As far as I read in
<a href="https://dspace.cvut.cz/bitstream/handle/10467/107238/F3-DP-2023-Voznia-Anton-dip_thesis-2.pdf">https://dspace.cvut.cz/bitstream/handle/10467/107238/F3-DP-2023-Voznia-Anton-dip_thesis-2.pdf</a>
"Chapter 4 ReaR testing in infrastructure" the code (in particular all
those 'rl...' functions) in
<a href="https://github.com/antonvoznia/rear-testing">https://github.com/antonvoznia/rear-testing</a>
seem to be from
<a href="https://github.com/beakerlib">https://github.com/beakerlib</a> but - at
least on first glance - I don't find documentation there so currently
for me this is mostly a "black box" where I cannot review anything.</p>
</blockquote>
<p>Yes, Beakerlib is the test framework used by the test script.
Documentation is here:
<a href="https://github.com/beakerlib/beakerlib/wiki/man">https://github.com/beakerlib/beakerlib/wiki/man</a></p>
<blockquote>
<p>I have a question: At least on first glance I could not find how the
original system and the replacement system are configured? I mean in
particular how to specify the storage layout on the original system
and the disks with their sizes on the replacement system so that we
could test recovery of various storage layouts on various more or less
identical replacement systems.</p>
</blockquote>
<p>This would be part of the hardware requirements, i.e. one would request
a machine with e.g. multiple disks using the test metadata. One then
could also add some storage preparation steps before the test itself,
e.g. to create another Volume Group and filesystems on the additional
disks. Unfortunately, support for additional hardware in the public
infrastructure used to run the tests (Testing Farm) is little or
nonexistent, but I am confident it will improve. So far, the
configuration is very basic - only one disk, I think it even lacks LVM.</p>
<p>Providing a different replacement system to test stuff like migration
mode is an intriguing idea. So far I have not attempted anything like
that, because the original machine is used also as the machine to be
recovered. Doing this would basically require reserving two machines,
with access to some shared storage for the backup.</p>
<h4 id="jsmeix_commented_at_2023-06-20_1133"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1598606148">2023-06-20 11:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-20_1133" title="Permanent link">&para;</a></h4>
<p>It is perfectly right to start with what is currently available<br />
(i.e. a simple system with recovery on the original machine)<br />
and later try to enhance things step by step<br />
as far as possible with reasonable effort.</p>
<p>Ah!<br />
Nowadays documentation may no longer be in 'doc' but in 'wiki' :-)</p>
<p>Strange:<br />
I cannot find a link to<br />
<a href="https://github.com/beakerlib/beakerlib/wiki/man">https://github.com/beakerlib/beakerlib/wiki/man</a><br />
anywhere on<br />
<a href="https://github.com/beakerlib/beakerlib">https://github.com/beakerlib/beakerlib</a><br />
Am I blind?</p>
<h4 id="pcahyna_commented_at_2023-06-20_1155"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1598634265">2023-06-20 11:55</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-20_1155" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Strange:<br />
I cannot find a link to<br />
<a href="https://github.com/beakerlib/beakerlib/wiki/man">https://github.com/beakerlib/beakerlib/wiki/man</a><br />
anywhere on<br />
<a href="https://github.com/beakerlib/beakerlib">https://github.com/beakerlib/beakerlib</a><br />
Am I blind?</p>
</blockquote>
<p>Strange indeed. Since I have Beakerlib installed, I just type
<code>man beakerlib</code> when I need to read the manual page - it has also the
link to the online version. I suspect this is the case for most
beakerlib users and that's why they have not cared so much about
accessibility of the online docs.<br />
@sopos would there be a place for a link to the docs somewhere where it
would be easy to discover, please?</p>
<h4 id="sopos_commented_at_2023-06-21_0824"><img src="https://avatars.githubusercontent.com/u/16821184?u=c13fb797b7d48add5097ceac376fb3b068376e3c&v=4" width="50"><a href="https://github.com/sopos">sopos</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1600407763">2023-06-21 08:24</a>:<a class="headerlink" href="#sopos_commented_at_2023-06-21_0824" title="Permanent link">&para;</a></h4>
<p>Right, there's no link from the README.md, there's a "tab" Wiki on the
top, however. Moreover, we are in process of moving it to the
<em>readthedocs</em> so I plan to make some updates including links, anyway.</p>
<h4 id="pcahyna_commented_at_2023-06-22_1416"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1602723398">2023-06-22 14:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-22_1416" title="Permanent link">&para;</a></h4>
<p>By the way:<br />
there is already a repository for integration tests,
<a href="https://github.com/rear/rear-integration-tests">https://github.com/rear/rear-integration-tests</a>.
its description reads: "The purpose of this project is to create Ansible
playbooks to perform automated backup and restore tests for different
Linux distributions." The purpose seems similar to what we are doing,
but the approach is very different - these tests use a VM that they
create, spawn and control from outside. It is all written as an Ansible
playbook:
<a href="https://github.com/rear/rear-integration-tests/blob/master/os/centos7.yml">https://github.com/rear/rear-integration-tests/blob/master/os/centos7.yml</a>
. This approach is more flexible, but is not suitable for automated
testing in CI, because the machines that we get from available CI
infrastructures do not support virtualization ( although this may
change,
<a href="https://github.com/actions/runner-images/issues/183">https://github.com/actions/runner-images/issues/183</a>
), so one can not spawn and control a test VM this way.<br />
The repository also has tests written in Beakerlib by my colleagues
(similarly to the proposed backup and restore test) in the "tests"
directory
<a href="https://github.com/rear/rear-integration-tests/tree/master/tests">https://github.com/rear/rear-integration-tests/tree/master/tests</a>,
<a href="https://github.com/rear/rear-integration-tests/pull/2">https://github.com/rear/rear-integration-tests/pull/2</a>
. The tests do not seem to have anything to do with the original scope
of the repository (they are pure backup tests, not full backup and
recovery) and are not integrated with the Ansible playbooks in any way.</p>
<p>Given that there is already a repository that contains Beakerlib tests,
maybe I should import the new test there, rather than creating a new
repository? In the future this would allow us to enable the other
Beakerlib tests under
<a href="https://github.com/rear/rear-integration-tests/tree/master/tests">https://github.com/rear/rear-integration-tests/tree/master/tests</a>
quite easily if we find them valuable.</p>
<h4 id="github-actions_commented_at_2023-08-22_0201"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1687301546">2023-08-22 02:01</a>:<a class="headerlink" href="#github-actions_commented_at_2023-08-22_0201" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="pcahyna_commented_at_2023-09-01_1204"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1702640610">2023-09-01 12:04</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-09-01_1204" title="Permanent link">&para;</a></h4>
<p>Tests themselves are in
<a href="https://github.com/rear/rear-integration-tests/pull/3">https://github.com/rear/rear-integration-tests/pull/3</a>
. @gdha can you please have a look? I don't have commit access to that
repository.</p>
<h4 id="pcahyna_commented_at_2023-10-05_0634"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3014#issuecomment-1748174128">2023-10-05 06:34</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-10-05_0634" title="Permanent link">&para;</a></h4>
<p>Thank you @gdha for your assistance, finally done 🎉</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-06-19.3014.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
