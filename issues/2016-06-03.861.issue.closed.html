<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#861 Issue closed: mac address not changed on recover - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#861 Issue closed: mac address not changed on recover";
        var mkdocs_page_input_path = "issues/2016-06-03.861.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#861 Issue closed: mac address not changed on recover</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="861_issue_closed_mac_address_not_changed_on_recover"><a href="https://github.com/rear/rear/issues/861">#861 Issue</a> <code>closed</code>: mac address not changed on recover<a class="headerlink" href="#861_issue_closed_mac_address_not_changed_on_recover" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>waiting for info</code>, <code>discuss / RFC</code>, <code>support / question</code>,
<code>fixed / solved / done</code></p>
<h4 id="wsaibot_opened_issue_at_2016-06-03_2022"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> opened issue at <a href="https://github.com/rear/rear/issues/861">2016-06-03 20:22</a>:<a class="headerlink" href="#wsaibot_opened_issue_at_2016-06-03_2022" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): 1.17.2</li>
<li>OS version RHEL 7.2</li>
<li>I did a backup from a virtual machine. I recovered the backup in a
    different machine (with other mac-address from eth0).
    finalize/GNU/Linux/30_create_mac_mapping.sh seem not to be
    working, because on the rear-ISO no /etc/rear/mappings directory is
    present.</li>
</ul>
<p>Should be the the last echo line really $CONFIG_DIR/mappings?</p>
<p>---- code 30_create_mac_mapping.sh ----</p>
<pre><code>for file in "${PATCH_FILES[@]}"; do
    grep -q HWADDR $file || continue
    dev=$(echo $file | cut -d- -f3)
    old_mac=$(grep HWADDR $file | cut -d= -f2)
    new_mac=$(cat /sys/class/net/$dev/address)
    [[ -z "$new_mac" ]] &amp;&amp; continue
    [[ "$(echo $old_mac | sed -e 'y/abcdef/ABCDEF/')" = "$(echo $new_mac | sed -e 'y/abcdef/ABCDEF/')" ]] &amp;&amp; continue
    echo "$old_mac $new_mac $dev" &gt;&gt; $CONFIG_DIR/mappings/mac
done
</code></pre>
<ul>
<li>Work-around, if any: create <code>/etc/rear/mappings</code> after booting with
    CD before starting "rear recover"</li>
</ul>
<h4 id="gdha_commented_at_2016-06-07_1244"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-224268951">2016-06-07 12:44</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-07_1244" title="Permanent link">&para;</a></h4>
<p>@Wsaibot To answer your first question - during the boot of the rescue
image script <code>/etc/scripts/system-setup.d/55-migrate-network-devices.sh</code>
should be called which creates the <code>/etc/rear/mappings/</code> directory if a
mac mapping should be done.<br />
For the second question: Also check the rear.log file (on the recovery
side) if there is any notion of SED_SCRIPT?<br />
The writing in script <code>30_create_mac_mapping.sh</code> to
<code>$CONFIG_DIR/mappings/mac</code> is correct as script
<code>42_migrate_network_configuration_files.sh</code> is kicked of a bit later
which uses the mac file as input.</p>
<h4 id="wsaibot_commented_at_2016-06-07_1541"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-224321689">2016-06-07 15:41</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-06-07_1541" title="Permanent link">&para;</a></h4>
<p>@gdha Thanks for the explanation. Maybe I found my problem:</p>
<ul>
<li>The script <code>55-migrate-network-devices.sh</code> test for RULE_FILES that
    aren't present on RHEL. mac-addresses are only in
    /etc/sysconfig/network-scripts/ifcfg-ethx. Does this mean, that the
    script exits after this line <code>test "$RULE_FILES" || return 0</code> ?.
    This would explain, that after boot from revocery-ISO, no
    /etc/rear/mappings are present and not created in the boot-process.
    And the script <code>30_create_mac_mapping.sh</code> can't create the file
    /etc/rear/mappings/mac because /etc/rear/mappings are missing.</li>
</ul>
<p>Thanks!</p>
<h4 id="gdha_commented_at_2016-06-07_1728"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-224353638">2016-06-07 17:28</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-07_1728" title="Permanent link">&para;</a></h4>
<p>Well , script <code>./finalize/GNU/Linux/30_create_mac_mapping.sh</code> would
replace mac addresses if <code>/etc/rear/mappings/mac</code> would exist of course.
The <code>55-migrate-network-devices.sh</code> script only deals with udev rules
and therefore, <code>/etc/sysconfig/network-scripts/ifcfg-ethx</code> and alike are
out of scope (at least in that script). But, perhaps, you are right, the
next time I'll pay close attention (myself) to this behaviour. If
needed, I'll create a new script to deal with it.<br />
@jsmeix What do you think of it? Experienced this already?</p>
<h4 id="wsaibot_commented_at_2016-06-07_2055"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-224411414">2016-06-07 20:55</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-06-07_2055" title="Permanent link">&para;</a></h4>
<p>@gdha : Thanks for your answer. Maybe I misunderstood the script. In my
case - restoring a system on a different hardware with different mac -
the script <code>30_create_map_mapping.sh</code> recognizes different macs, but
can't write the mapping-output, because the
directory<code>/etc/rear/mappings</code> don't exists. Isn't that script written
for this automatic conversion of mac-addresses? When I create this
directory (/etc/rear/mappings) manually before starting "rear recover",
the script <code>30_create_map_mapping.sh</code> can write the file
<code>/etc/rear/mappings/mac</code> and mac-addresses will be changed in the
<code>/etc/sysconfig/network-scripts/ifcfg-ethx</code> correctly (in the following
scripts) and everything would be fine. So my intention is creating the
<code>/etc/rear/mappings</code> directory before 30_create..-script is running.</p>
<h4 id="jsmeix_commented_at_2016-06-08_0724"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-224510233">2016-06-08 07:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-08_0724" title="Permanent link">&para;</a></h4>
<p>I did not experience any such issue.<br />
For my tests I always use DHCP<br />
and in /etc/rear/local.conf I use</p>
<pre>
USE_DHCLIENT="yes"
</pre>

<h4 id="gdha_commented_at_2016-07-07_1637"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-231135443">2016-07-07 16:37</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-07_1637" title="Permanent link">&para;</a></h4>
<p>@Wsaibot If you would be so kind to verify our fix works for you with
the latest snapshot?</p>
<h4 id="wsaibot_commented_at_2016-07-18_1608"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/861#issuecomment-233375824">2016-07-18 16:08</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-07-18_1608" title="Permanent link">&para;</a></h4>
<p>@gdha Thanks for this patch :-)</p>
<p>It works for me.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-06-03.861.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
