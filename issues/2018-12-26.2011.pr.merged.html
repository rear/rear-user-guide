<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2018 12 26.2011.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2018 12 26.2011.pr.merged";
        var mkdocs_page_input_path = "issues/2018-12-26.2011.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2018 12 26.2011.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2011_pr_merged_allow_non-interactive_rsync_authentication"><a href="https://github.com/rear/rear/pull/2011">#2011 PR</a> <code>merged</code>: Allow non-interactive rsync authentication<a class="headerlink" href="#2011_pr_merged_allow_non-interactive_rsync_authentication" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="ivarmu_opened_issue_at_2018-12-26_1704"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> opened issue at <a href="https://github.com/rear/rear/pull/2011">2018-12-26 17:04</a>:<a class="headerlink" href="#ivarmu_opened_issue_at_2018-12-26_1704" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL): No issue existing</p>
</li>
<li>
<p>How was this pull request tested?: at my installation:</p>
</li>
</ul>
<p>`<br />
Source system: Fedora release 28<br />
ReaR Version: rear-2.4-1.fc28.x86_64</p>
<p>Remote system: QNAP TS-253A (Version QTS 4.3.4 (20180830))<br />
`</p>
<ul>
<li>Brief description of the changes in this pull request:</li>
</ul>
<p>I've added the correct variables to allow non-interactive authentication
using rsync protocol. Now, one can use RSYNC_OPTIONS to authenticate
using the "--password-file=/full/path/to/file" rsync's option.</p>
<p>I already fixed the missing username when rsync protocol at checking
stage.</p>
<h4 id="gdha_commented_at_2018-12-28_1148"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-450347310">2018-12-28 11:48</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-28_1148" title="Permanent link">&para;</a></h4>
<p>@ivarmu Why did you not use the <code>BACKUP_RSYNC_OPTIONS</code> variable to add
your additional option <code>--password-file=/full/path/to/file</code>? You could
accomplish this in the <code>local.conf</code> file:<br />
For example:</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" --password-file=/full/path/to/file )
</code></pre>
<p>If the above works then this PR is not required anymore.</p>
<h4 id="ivarmu_commented_at_2018-12-28_1333"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-450359947">2018-12-28 13:33</a>:<a class="headerlink" href="#ivarmu_commented_at_2018-12-28_1333" title="Permanent link">&para;</a></h4>
<p>If I remember correctly, the first steps involve a simple ssh/rsync<br />
conection to check connectivity, and as per this step, I think<br />
BACKUP_RSYNC_OPTIONS is not the most convenient variable to be used.</p>
<p>What do you think?</p>
<p>Thanks!<br />
Ivan</p>
<p>El vie., 28 dic. 2018 12:48, gdha <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> escribió:</p>
<blockquote>
<p>@ivarmu <a href="https://github.com/ivarmu">https://github.com/ivarmu</a> Another
remark - why did you not use<br />
the BACKUP_RSYNC_OPTIONS variable to add your additional option<br />
--password-file=/full/path/to/file? You could accomplish this in the<br />
local.conf file:<br />
For example:</p>
<p>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}"
--password-file=/full/path/to/file )</p>
<p>If the above works then this PR is not required anymore.</p>
<p>—<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/2011#issuecomment-450347310">https://github.com/rear/rear/pull/2011#issuecomment-450347310</a>,
or mute<br />
the thread<br />
<a href="https://github.com/notifications/unsubscribe-auth/AZlFm4ENOKSKiOFMYfryX8Rhjzb7z843ks5u9gUKgaJpZM4Zh6-X">https://github.com/notifications/unsubscribe-auth/AZlFm4ENOKSKiOFMYfryX8Rhjzb7z843ks5u9gUKgaJpZM4Zh6-X</a><br />
.</p>
</blockquote>
<h4 id="gdha_commented_at_2019-01-09_0732"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452599116">2019-01-09 07:32</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-09_0732" title="Permanent link">&para;</a></h4>
<p>@ivarmu I believe if we can enhance script
<code>usr/share/rear/prep/RSYNC/default/100_check_rsync.sh</code> a bit so it
recognizes (and extract what it needs, like the <code>--password-file</code>
option) the variable <code>BACKUP_RSYNC_OPTIONS</code> we can reduces this PR to
the bare minimum. Please give it a try.<br />
Thanks.</p>
<h4 id="jsmeix_commented_at_2019-01-09_0950"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452636133">2019-01-09 09:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_0950" title="Permanent link">&para;</a></h4>
<p>I am not a <code>rsync</code> user ( I use only <code>tar</code>)<br />
so that I cannot review the details here.</p>
<p>In general:</p>
<p>When we already have a config variable for a particular<br />
kind of functionality (BACKUP_RSYNC_OPTIONS in this case)<br />
we should try to avoid adding more config variables for the same<br />
functionality (i.e. adding RSYNC_OPTIONS in this case)<br />
unless several separated config variables for the same functionality<br />
are needed to configure several separated parts of that functionality.</p>
<p>But then the config variables must have meaningful separated names<br />
to make it clear to the user how the usage of the config variables
differs<br />
(e.g. see the <code>USER_INPUT_*</code> config variable names).</p>
<p>In this case it means if two config variables are needed here<br />
their current names BACKUP_RSYNC_OPTIONS and RSYNC_OPTIONS<br />
look confusing to me because I cannot see how their usage differs, cf.<br />
<code>Variables and functions must have names that explain what they do, even if it makes them longer</code>
in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>To me it looks as if RSYNC_OPTIONS specifies generic options<br />
that are used for all <code>rsync</code> calls in ReaR while<br />
BACKUP_RSYNC_OPTIONS specifies additional options that are<br />
only used for making the backup with <code>rsync</code> and for restoring it.</p>
<p>But the current changes here do not apply RSYNC_OPTIONS<br />
to all <code>rsync</code> calls in ReaR so that this config variable must be<br />
named more specifically according to what its actual usage is,<br />
e.g. RSYNC_CONNECTION_CHECK_OPTIONS according to<br />
<a href="https://github.com/rear/rear/pull/2011#issuecomment-450359947">https://github.com/rear/rear/pull/2011#issuecomment-450359947</a><br />
if that is really the actual usage of that config variable.</p>
<p>By the way:</p>
<p>I wonder how making the backup with <code>rsync</code> and restoring it<br />
works without the <code>--password-file=/full/path/to/file</code> option<br />
when that option is needed for the rsync connection check<br />
(but I am no rsync user).</p>
<p>A side note FWIW:</p>
<p>What even more confuses me is that we have in default.conf (excerpts):</p>
<pre>
BACKUP_OPTIONS=
...
# NOTE: The BACKUP_* variables relate to ALL builtin backup methods !
# (NETFS, ISO, TAPE ...)
BACKUP_PROG=tar
...
BACKUP_PROG_OPTIONS=( "--anchored" )
...
BACKUP_PROG_COMPRESS_OPTIONS=( --gzip )
...
BACKUP_RSYNC_OPTIONS=(--sparse --archive --hard-links --numeric-ids --stats)
</pre>

<p>It seems we got from the past some mess with our <code>BACKUP_*</code><br />
config variable names that should be cleaned up first of all.<br />
But we cannot change config variable names because<br />
that would cause regressions for our users.</p>
<h4 id="ivarmu_commented_at_2019-01-09_1125"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452663729">2019-01-09 11:25</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1125" title="Permanent link">&para;</a></h4>
<p>Hi all,</p>
<p>as per I can see, RSYNC_OPTIONS is already defined somewhere at rear
code and translated to BACKUP_RSYNC_OPTIONS at
<a href="https://github.com/rear/rear/blob/0baabfb1e3d93d15476f0d9977fae65c86c53349/usr/share/rear/prep/default/020_translate_url.sh#L20">/usr/share/rear/prep/default/020_translate_url.sh</a></p>
<pre><code>grep -n RSYNC_OPTIONS /usr/share/rear/prep/default/020_translate_url.sh
25:if [[ "$RSYNC_OPTIONS" ]] ; then
26:    BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS
</code></pre>
<p>Anyway, we are only talking about a variable name and it's related
documentation, so I'm changing the PR to use BACKUP_RSYNC_OPTIONS
instead RSYNC_OPTIONS, although I think we should make that two
concepts differentiated, as commented by @jsmeix .</p>
<p>I'm introducing another change to the rsync checkings, concretely I've
changed the behaviour of --fake-root on rsync protocol versions &lt; 29,
as it may not return an error it the option is not used at all.</p>
<h4 id="jsmeix_commented_at_2019-01-09_1326"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452695713">2019-01-09 13:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1326" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
a side note:<br />
In ReaR we have the <code>IsInArray ( needle hayblade1 hayblade2 ... )</code>
function<br />
(its name is misleading because it does not expand an array variable,<br />
see the implementation in usr/share/rear/lib/array-functions.sh)<br />
so that you could instead of</p>
<pre><code>if [ ${BACKUP_RSYNC_OPTIONS[@]/--fake-super/} != ${BACKUP_RSUNC_OPTIONS[@]} ]; then
</code></pre>
<p>use</p>
<pre><code>if IsInArray "--fake-super" "${BACKUP_RSYNC_OPTIONS[@]}" ; then
</code></pre>
<h4 id="jsmeix_commented_at_2019-01-09_1341"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452700028">2019-01-09 13:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1341" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
FYI regarding RSYNC_OPTIONS =&gt; BACKUP_RSYNC_OPTIONS see<br />
<a href="https://github.com/rear/rear/commit/20b214db4d8142814ec9c38536f93d40ef46645d">https://github.com/rear/rear/commit/20b214db4d8142814ec9c38536f93d40ef46645d</a><br />
i.e. RSYNC_OPTIONS is outdated and should no longer be used<br />
because nowadays it is BACKUP_RSYNC_OPTIONS and<br />
the related code in usr/share/rear/prep/default/020_translate_url.sh<br />
is only there to provide some backward compatibility.</p>
<h4 id="ivarmu_commented_at_2019-01-09_1345"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452701352">2019-01-09 13:45</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1345" title="Permanent link">&para;</a></h4>
<p>Nice @jsmeix. I've changed all the needed files (I'm pushing a new
commit) and use only the BACKUP_RSYNC_OPTIONS. I'm already loging the
obsolescence of RSYNC_OPTIONS at 020_translate_url.sh file.</p>
<h4 id="jsmeix_commented_at_2019-01-09_1354"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452704043">2019-01-09 13:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1354" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
instead of only a log message</p>
<pre><code>Log "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>I would also tell the user on his terminal about it via</p>
<pre><code>LogUserOutput "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>or as you like via LogPrintError (that won't exit as the <code>Error</code>
function does)</p>
<pre><code>LogPrintError "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>see the LogUserOutput and LogPrintError and their<br />
base functions like UserOutput and PrintError in<br />
usr/share/rear/lib/_input-output-functions.sh</p>
<h4 id="jsmeix_commented_at_2019-01-09_1403"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452706857">2019-01-09 14:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1403" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
perhaps nitpicking in practice but at least out of curiosity:<br />
In usr/share/rear/prep/default/020_translate_url.sh I wonder about</p>
<pre><code>BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS
</code></pre>
<p>shouldn't that better be something like</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" $RSYNC_OPTIONS )
</code></pre>
<p>so that the BACKUP_RSYNC_OPTIONS from default.conf are kept?<br />
I don't know what the meaning/usage of RSYNC_OPTIONS was.<br />
Could it have been also an array?</p>
<h4 id="jsmeix_commented_at_2019-01-09_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452708349">2019-01-09 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1408" title="Permanent link">&para;</a></h4>
<p>In<br />
<a href="https://github.com/rear/rear/commit/20b214db4d8142814ec9c38536f93d40ef46645d">https://github.com/rear/rear/commit/20b214db4d8142814ec9c38536f93d40ef46645d</a><br />
I found in the changes for usr/share/rear/conf/default.conf</p>
<pre><code>RSYNC_OPTIONS=(--sparse --archive --hard-links --verbose --numeric-ids --stats)
</code></pre>
<p>so RSYNC_OPTIONS was an array so that in<br />
usr/share/rear/prep/default/020_translate_url.sh<br />
it must be either</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${RSYNC_OPTIONS[@]}" )
</code></pre>
<p>or</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" "${RSYNC_OPTIONS[@]}" )
</code></pre>
<h4 id="ivarmu_commented_at_2019-01-09_1418"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452711897">2019-01-09 14:18</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1418" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@ivarmu<br />
instead of only a log message</p>
<pre><code>Log "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>I would also tell the user on his terminal about it via</p>
<pre><code>LogUserOutput "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>or as you like via LogPrintError (that won't exit as the <code>Error</code>
function does)</p>
<pre><code>LogPrintError "Using RSYNC_OPTIONS is deprecated ...
</code></pre>
<p>see the LogUserOutput and similar functions like LogPrintError in<br />
usr/share/rear/lib/_input-output-functions.sh</p>
</blockquote>
<p>I preffer LogUserOutput option. I'm updating code.</p>
<h4 id="ivarmu_commented_at_2019-01-09_1422"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452713153">2019-01-09 14:22</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1422" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@gdha<br />
perhaps nitpicking in practice but at least out of curiosity:<br />
In usr/share/rear/prep/default/020_translate_url.sh I wonder about</p>
<pre><code>BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS
</code></pre>
<p>shouldn't that better be something like</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" $RSYNC_OPTIONS )
</code></pre>
<p>so that the BACKUP_RSYNC_OPTIONS from default.conf are kept?<br />
I don't know what the meaning/usage of RSYNC_OPTIONS was.<br />
Could it have been also an array?</p>
</blockquote>
<p>I don't know what the meaning/usage of RSYNC_OPTIONS was, too, as it
existed previously and that is my first PR on ReaR code. I agree with
you, but think maybe there's a reason to stay like that... isn't that
supposed to let "site.conf" (for example) to override the defaults? That
could be an explanation. Doesn't matter if it could be an array or not,
as bash interpretes both as well.</p>
<h4 id="ivarmu_commented_at_2019-01-09_1427"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452714649">2019-01-09 14:27</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1427" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In<br />
<a href="https://github.com/rear/rear/commit/20b214db4d8142814ec9c38536f93d40ef46645d">20b214d</a><br />
I found in the changes for usr/share/rear/conf/default.conf</p>
<pre><code>RSYNC_OPTIONS=(--sparse --archive --hard-links --verbose --numeric-ids --stats)
</code></pre>
<p>so RSYNC_OPTIONS was an array so that in<br />
usr/share/rear/prep/default/020_translate_url.sh<br />
it must be either</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${RSYNC_OPTIONS[@]}" )
</code></pre>
<p>or</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" "${RSYNC_OPTIONS[@]}" )
</code></pre>
</blockquote>
<p>Regarding my last comment, a correct option would be:</p>
<pre><code>BACKUP_RSYNC_OPTIONS=( ${RSYNC_OPTIONS[@]} )
</code></pre>
<p>but it does'nt matter if one do:</p>
<pre><code>RSYNC_OPTIONS="--password_file=/tmp/file"
BACKUP_RSYNC_OPTIONS=${RSYNC_OPTIONS}
rsync ${BACKUP_RSYNC_OPTIONS[@]} bla bla bla
</code></pre>
<p>That would work as well.</p>
<h4 id="jsmeix_commented_at_2019-01-09_1434"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452716975">2019-01-09 14:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1434" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
it does matter if a variable is an array or not, e.g. see:</p>
<pre><code># BACKUP_RSYNC_OPTIONS=( this that 'something else' )

# RSYNC_OPTIONS=( 'foo bar' baz )

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'this'
'that'
'something else'

# for e in "${RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'foo bar'
'baz'

# BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'foo bar'
'that'
'something else'

# BACKUP_RSYNC_OPTIONS=( this that 'something else' )

# BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" "${RSYNC_OPTIONS[@]}" )

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'this'
'that'
'something else'
'foo bar'
'baz'
</code></pre>
<p>In general using ${VAR[*]} is problematic and using ${VAR[@]}
without<br />
double-quotes is also problematic, see 'Arrays' in "man bash" and<br />
see the initial comment in usr/share/rear/conf/default.conf and<br />
see
<a href="https://github.com/rear/rear/issues/1068">https://github.com/rear/rear/issues/1068</a>
for some examples.</p>
<h4 id="gdha_commented_at_2019-01-09_1444"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452720684">2019-01-09 14:44</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-09_1444" title="Permanent link">&para;</a></h4>
<p>@jsmeix
<a href="https://github.com/rear/rear/pull/2011#issuecomment-452706857">https://github.com/rear/rear/pull/2011#issuecomment-452706857</a>
I think <code>RSYNC_OPTIONS</code> variable was probably not an array in the
beginning (that is my guess). And, to be honest I did not know it was
still there (now I understand why @ivarmu used that variable in the
first place).<br />
I would propose to remove the variable completely from ReaR itself as it
is OLD and obsolete.</p>
<h4 id="ivarmu_commented_at_2019-01-09_1449"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452722435">2019-01-09 14:49</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1449" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@ivarmu<br />
it does matter if a variable is an array or not, e.g. see:</p>
<pre><code># BACKUP_RSYNC_OPTIONS=( this that 'something else' )

# RSYNC_OPTIONS=( 'foo bar' baz )

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'this'
'that'
'something else'

# for e in "${RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'foo bar'
'baz'

# BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'foo bar'
'that'
'something else'

# BACKUP_RSYNC_OPTIONS=( this that 'something else' )

# BACKUP_RSYNC_OPTIONS=( "${BACKUP_RSYNC_OPTIONS[@]}" "${RSYNC_OPTIONS[@]}" )

# for e in "${BACKUP_RSYNC_OPTIONS[@]}" ; do echo "'$e'" ; done
'this'
'that'
'something else'
'foo bar'
'baz'
</code></pre>
</blockquote>
<p>Yes, I Know that, but I can't find any code at ReaR looping through the
BACKUP_RSYNC_OPTIONS as would be expected for an array to be managed
(you can "grep -R BACKUP_RSYNC_OPTIONS" and see no for/while/do is
involved).</p>
<p>Anyway... RSYNC_OPTIONS is obsoleted... so I'm happy with the current
assignation, as had been working since today... I can change it to the
following if you prefer...</p>
<p><code>BACKUP_RSYNC_OPTIONS=( ${RSYNC_OPTIONS[@]} )</code></p>
<h4 id="jsmeix_commented_at_2019-01-09_1451"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452723383">2019-01-09 14:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-09_1451" title="Permanent link">&para;</a></h4>
<p>Perfectly fine with me to remove RSYNC_OPTIONS support.</p>
<p>The only place where it appears is in
prep/default/020_translate_url.sh</p>
<p>But I would not like to let users who may still use RSYNC_OPTIONS<br />
from ancient times in their local.conf learn the hard way by obscure
failures<br />
that RSYNC_OPTIONS is no longer supported.</p>
<p>Therefore I suggest to replace in prep/default/020_translate_url.sh</p>
<pre><code>if [[ "$RSYNC_OPTIONS" ]] ; then
    BACKUP_RSYNC_OPTIONS=$RSYNC_OPTIONS
fi
</code></pre>
<p>with</p>
<pre><code>test "$RSYNC_OPTIONS" &amp;&amp; Error "RSYNC_OPTIONS is no longer supported. Use BACKUP_RSYNC_OPTIONS instead."
</code></pre>
<h4 id="ivarmu_commented_at_2019-01-09_1455"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-452724788">2019-01-09 14:55</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-09_1455" title="Permanent link">&para;</a></h4>
<p>Perfect for me too, pushing another commit 👍</p>
<h4 id="jsmeix_commented_at_2019-01-10_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-453048101">2019-01-10 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-10_1032" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
is it o.k. for you when we merge it<br />
or do you need more time to test it?</p>
<p>@gdha<br />
would you merge it (because it is assigned to you)<br />
or should I merge it?</p>
<h4 id="schlomo_commented_at_2019-01-10_1252"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-453085678">2019-01-10 12:52</a>:<a class="headerlink" href="#schlomo_commented_at_2019-01-10_1252" title="Permanent link">&para;</a></h4>
<p>FWIW, I find prefixing the variable with <code>BACKUP_</code> to be important, so
that <code>rear dump</code> will show it.</p>
<p>I find it important that <code>rear dump</code> provides all relevant information.</p>
<h4 id="jsmeix_commented_at_2019-01-11_1203"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-453496410">2019-01-11 12:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-11_1203" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
thank you for your contribution to ReaR<br />
and for your patience with us!</p>
<p>Apparently you touched older code so that<br />
things became more complicated than expected<br />
but it was also a starting point for further improvements<br />
like
<a href="https://github.com/rear/rear/pull/2014">https://github.com/rear/rear/pull/2014</a></p>
<h4 id="ivarmu_commented_at_2019-01-11_1609"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-453568013">2019-01-11 16:09</a>:<a class="headerlink" href="#ivarmu_commented_at_2019-01-11_1609" title="Permanent link">&para;</a></h4>
<p>I've given you more diversion! 😊</p>
<h4 id="pcahyna_commented_at_2021-06-16_1010"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2011#issuecomment-862231644">2021-06-16 10:10</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-06-16_1010" title="Permanent link">&para;</a></h4>
<p>A a result of this PR there are now some places where
<code>${BACKUP_RSYNC_OPTIONS[@]}</code> is in the rsync command line in case of
<code>RSYNC_PROTO=rsync</code> but not for <code>RSYNC_PROTO=ssh</code>. Is that intentional?</p>
<p>Also, I am surprised that <code>${BACKUP_RSYNC_OPTIONS[@]}</code> was not needed
here:<br />
<a href="https://github.com/rear/rear/blob/4768fe217c440ed74c1fc8f69109d53cb522bfc3/usr/share/rear/verify/RSYNC/default/550_check_remote_backup_archive.sh#L11">https://github.com/rear/rear/blob/4768fe217c440ed74c1fc8f69109d53cb522bfc3/usr/share/rear/verify/RSYNC/default/550_check_remote_backup_archive.sh#L11</a><br />
have you tested restoring with rsync and non-interactive authentication?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-12-26.2011.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
