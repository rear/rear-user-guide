<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#198 Issue closed: Recovery fails on partitions creation: Kernel failed to re-read partition table - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#198 Issue closed: Recovery fails on partitions creation: Kernel failed to re-read partition table";
        var mkdocs_page_input_path = "issues/2013-02-06.198.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#198 Issue closed: Recovery fails on partitions creation: Kernel failed to re-read partition table</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="198_issue_closed_recovery_fails_on_partitions_creation_kernel_failed_to_re-read_partition_table"><a href="https://github.com/rear/rear/issues/198">#198 Issue</a> <code>closed</code>: Recovery fails on partitions creation: Kernel failed to re-read partition table<a class="headerlink" href="#198_issue_closed_recovery_fails_on_partitions_creation_kernel_failed_to_re-read_partition_table" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>waiting for info</code></p>
<h4 id="altring_opened_issue_at_2013-02-06_1217"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> opened issue at <a href="https://github.com/rear/rear/issues/198">2013-02-06 12:17</a>:<a class="headerlink" href="#altring_opened_issue_at_2013-02-06_1217" title="Permanent link">&para;</a></h4>
<p>ReaR 1.14 from github<br />
OS to restore CentOS 6.3 x32<br />
Scenario:<br />
There is a CentOS 6.3 system on Linux Soft RAID1 created on system's
setup.<br />
disklayout.conf:</p>
<pre><code>disk /dev/sda 320071851520 msdos
part /dev/sda 209715200 1048576 primary boot,raid /dev/sda1
part /dev/sda 13424850778 210763776 primary raid /dev/sda2
part /dev/sda 486472214181 8800698368 primary raid /dev/sda3
disk /dev/sdb 320072933376 msdos
part /dev/sdb 13424806769 1048576 primary raid /dev/sdb1
part /dev/sdb 209715200 8590983168primary boot,raid /dev/sdb2
part /dev/sdb 486472258190 8800698368 primary raid /dev/sdb3

raid /dev/md2 level=raid1 raid-devices=2 uuid=xxxxxxxxxxx devices=/dev/sda3,/dev/sdb3
raid /dev/md1 level=raid1 raid-devices=2 uuid=xxxxxxxxxxx devices=/dev/sda2,/dev/sdb1
raid /dev/md0 level=raid1 raid-devices=2 uuid=xxxxxxxxxxx devices=/dev/sda1,/dev/sdb2

fs /dev/md2 / ext4 uuid=xxxxxxxxxxx label= blocksize=4096 ... options=rw
fs /dev/md0 /boot ext4 uuid=xxxxxxxxxxx label= blocksize=1024 ... options=rw
swap /dev/md1 uuid=xxxxxxxxxxx label=
</code></pre>
<p>Recovery process usually fails on partitions creation stage on /dev/sdb
with the message:</p>
<pre><code>Warning: WARNING: the kernel failed to re-read the partition table on /dev/sdb (Device or resource busy). 
As a result, it may not reflect all of your changes until after reboot.
</code></pre>
<p>Partitions recreation on /dev/sda seems to be ok.</p>
<p>Relax-and-recover.log:</p>
<pre><code>+++ echo -e 'Creating partitions for disk /dev/sdb (msdos)'
+++ parted -s /dev/sdb mklabel msdos
+++ parted -s /dev/sdb mkpart primary 32768B 13424839536B
Warning: The resulting partition is not properly alighned for best performance.
+++ parted -s /dev/sdb set 1 raid on
+++ parted -s /dev/sdb mkpart primary 13424840704B 13634555903B
Warning: The resulting partition is not properly alighned for best performance.
+++ parted -s /dev/sdb set 1 boot on
Warning: WARNING: the kernel failed to re-read the partition table on /dev/sdb (Device or resource busy).  As a result, it may not reflect all of your changes until after reboot.
An error occurred during layout recreation.
</code></pre>
<p><code># partprobe /dev/sdb</code> gives the same error.</p>
<p>I've tried more than 10 times with another HDDs and workstations - error
also can happen at the start of recreation after<br />
<code>+++ parted -s /dev/sdb mklabel msdos</code><br />
line or after<br />
<code>... set raid ... on</code><br />
line.<br />
I couldn't see any dependence.<br />
Couple of times partitions' recreation was successful and ReaR restored
data from backup.tar gz but grub installation hangs with this in
logfile:</p>
<pre><code>Including finalize/Linux-i386/21_install_grub.sh
Installing GRUB bootloader
Probing devices to guess BIOS drives. This may take long time,
</code></pre>
<p>There is no sense to wait "long time" when you need system up and
running write now.<br />
Anyway waiting 4 hours gives no result.<br />
I think this is a bug too.</p>
<h4 id="altring_commented_at_2013-02-07_0857"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13227008">2013-02-07 08:57</a>:<a class="headerlink" href="#altring_commented_at_2013-02-07_0857" title="Permanent link">&para;</a></h4>
<p>If I mount /dev/md0 to /mnt/md0 I can see contents of my /boot
partition: kernel, initramfs, "grub" folder with all contents and other
stuff.<br />
Attempts to boot from any of HDDs gived no luck.<br />
When I try:</p>
<blockquote>
<p>grub-install /dev/md0<br />
I get:<br />
/dev/md0 does not have any corresponding BIOS drive.</p>
</blockquote>
<h4 id="gdha_commented_at_2013-02-07_1228"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13233755">2013-02-07 12:28</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-07_1228" title="Permanent link">&para;</a></h4>
<p>I found the following page claiming <em>GRUB cannot construct a software
RAID</em><br />
<a href="https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-grub-installing.html">https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-grub-installing.html</a></p>
<p>The RH knowledge article goes in more details
<a href="https://access.redhat.com/knowledge/articles/7094">https://access.redhat.com/knowledge/articles/7094</a>
but you need a valid subscription to read it.</p>
<h4 id="altring_commented_at_2013-02-07_1312"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13235100">2013-02-07 13:12</a>:<a class="headerlink" href="#altring_commented_at_2013-02-07_1312" title="Permanent link">&para;</a></h4>
<p>Thank you.<br />
Now I'm trying to restore system with bootloader on the separate
partition, not in RAID.<br />
And rear constantly fails on:</p>
<blockquote>
<p>parted -s /dev/sda mklabel msdos</p>
</blockquote>
<p>if disk already contains RAID partitions.<br />
Workaround: remove RAID partitions before running rear.<br />
I think rear should check for existing partitions on target disks and if
so - remove them.<br />
...<br />
Rear hangs on</p>
<blockquote>
<p>Including finalize/Linux-i386/21_install_grub.sh<br />
Installing GRUB bootloader<br />
Probing devices to guess BIOS drives. This may take long time,</p>
</blockquote>
<h4 id="altring_commented_at_2013-02-11_1042"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13375147">2013-02-11 10:42</a>:<a class="headerlink" href="#altring_commented_at_2013-02-11_1042" title="Permanent link">&para;</a></h4>
<p>I 've managed to solve grub problem:<br />
Grub Legacy doesn't understand RAID metadata &gt; 0.90 and Rear creates
RAID partitions with default metadata value=1.2. Thus grub failed to
install.<br />
Rear should check grub version and deal with raid metadata accordingly.</p>
<h4 id="altring_commented_at_2013-02-11_1253"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13378766">2013-02-11 12:53</a>:<a class="headerlink" href="#altring_commented_at_2013-02-11_1253" title="Permanent link">&para;</a></h4>
<p>What about "re-read partitions table" bug? Will it be solved?</p>
<h4 id="gdha_commented_at_2013-02-11_1426"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13382014">2013-02-11 14:26</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-11_1426" title="Permanent link">&para;</a></h4>
<p>Found an interesting article
<a href="http://dione.no-ip.org/AlexisWiki/DebianSqueezeRaid1AndGrub2">http://dione.no-ip.org/AlexisWiki/DebianSqueezeRaid1AndGrub2</a></p>
<p>@altring Could you shine some light on the details before and after
conc. grub version, and other executables you might have changed? To be
honest - I couldn't follow all the way...sorry</p>
<h4 id="altring_commented_at_2013-02-11_1441"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13382618">2013-02-11 14:41</a>:<a class="headerlink" href="#altring_commented_at_2013-02-11_1441" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
"I 've managed to solve grub problem:"<br />
I've added metadata=0.90 in disklayout.conf in corresponding string
(RAID partition with /boot).<br />
Before:<br />
raid /dev/md0 level=raid1 raid-devices=2 uuid=xxxxxxxxxxx
devices=/dev/sda1,/dev/sdb2<br />
After:<br />
raid /dev/md0 level=raid1 metadata=0.90 raid-devices=2 uuid=xxxxxxxxxxx
devices=/dev/sda1,/dev/sdb2</p>
<h4 id="gdha_commented_at_2013-02-11_1507"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13383859">2013-02-11 15:07</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-11_1507" title="Permanent link">&para;</a></h4>
<p>@altring Ok, now I'm following again. How can we detect the metadata
version? Please show me. If we want to enhance the code we must know
this. thx.</p>
<h4 id="altring_commented_at_2013-02-12_0905"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13423564">2013-02-12 09:05</a>:<a class="headerlink" href="#altring_commented_at_2013-02-12_0905" title="Permanent link">&para;</a></h4>
<p>Sorry if I break logic line.<br />
Metadata version can be seen with</p>
<blockquote>
<p>mdadm --examine --scan</p>
</blockquote>
<p>This will give you something like:</p>
<blockquote>
<p>ARRAY /dev/md/1 metadata=1.2 UUID=xxxxxxxxxxxxxxxxxxxxx
name=localhost.localdomain:1</p>
</blockquote>
<p>Please ask for information or additional tests - I'll help with
pleasure!</p>
<h4 id="pavoldomin_commented_at_2013-02-12_0923"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13424094">2013-02-12 09:23</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-02-12_0923" title="Permanent link">&para;</a></h4>
<p>Just wondering, can grub actually boot md with the metadata version 1.2?</p>
<p>From: altring [mailto:<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>]<br />
Sent: Tuesday, February 12, 2013 10:06 AM<br />
To: rear/rear<br />
Subject: Re: [rear] Recovery fails on partitions creation: Kernel
failed to re-read partition table (#198)</p>
<p>Sorry if I break logic line.<br />
Metadata version can be seen with</p>
<p>mdadm --examine --scan</p>
<p>This will give you something like:</p>
<p>ARRAY /dev/md/1 metadata=1.2 UUID=xxxxxxxxxxxxxxxxxxxxx
name=localhost.localdomain:1</p>
<p>Please ask for information or additional tests - I'll help with
pleasure!</p>
<p>—<br />
Reply to this email directly or view it on
GitHubhttps://github.com/rear/rear/issues/198#issuecomment-13423564.</p>
<h4 id="altring_commented_at_2013-02-12_0942"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13424768">2013-02-12 09:42</a>:<a class="headerlink" href="#altring_commented_at_2013-02-12_0942" title="Permanent link">&para;</a></h4>
<p>@pavoldomin<br />
grub legacy (&lt;=0.97) can deal with metadata 0.90<br />
grub2 (&gt;1.98) up to metadata 1.20.</p>
<h4 id="gdha_commented_at_2013-02-12_1307"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13431632">2013-02-12 13:07</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-12_1307" title="Permanent link">&para;</a></h4>
<p>@jhoekx is this something we should add or enhance the current
savelayout code to achieve this?</p>
<h4 id="jhoekx_commented_at_2013-02-12_1312"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13431776">2013-02-12 13:12</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-12_1312" title="Permanent link">&para;</a></h4>
<p>I think we should be able to detect the current metadata version and use
that during restores.</p>
<h4 id="jhoekx_commented_at_2013-02-12_1314"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13431845">2013-02-12 13:14</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-12_1314" title="Permanent link">&para;</a></h4>
<p>The other error about the partition table not being re-read is likely
because the md device is open. Can you test if <code>/proc/mdstat</code> exists
before the restore starts?</p>
<h4 id="jhoekx_commented_at_2013-02-12_1317"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13431947">2013-02-12 13:17</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-12_1317" title="Permanent link">&para;</a></h4>
<p>Is the metadata version visible in <code>mdadm --misc --detail $device</code> or
<code>mdadm --detail --scan --config=partitions</code>?</p>
<p>If yes, then we can add it quickly. I don't have a VM with md raid
anymore to test...</p>
<h4 id="jcmendes_commented_at_2013-02-15_2205"><img src="https://avatars.githubusercontent.com/u/3606380?v=4" width="50"><a href="https://github.com/JCMendes">JCMendes</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13630645">2013-02-15 22:05</a>:<a class="headerlink" href="#jcmendes_commented_at_2013-02-15_2205" title="Permanent link">&para;</a></h4>
<p>System: CentOS release 6.3 (Final)<br />
Kernel: 2.6.32-279.22.1.el6.x86_64<br />
parted-2.1-18.el6.x86_64<br />
rear-1.14-1.el6.noarch</p>
<p>Recovery Problem: After command: <code># rear recover</code></p>
<p>Intermittently the system stops and not back the recovery</p>
<p>The Logs on item 1 shows in the last line:</p>
<pre><code>*** partprobe –s /dev/sda
Warning: WARNING: the kernel failed to re-read the partition table on /dev/sda (Device or resource busy). As a result, it may not reflect all of your changes until after reboot.
</code></pre>
<p>Workaround: I have edited the restore script and deleted the line
<code>partprobe –s /dev/sda</code>, after that, I can go on "item 5" without
errors.</p>
<p>I think the best solution will be “rear” has the software product
“util-linux-ng” that provides “partx” instead partprobe that has some
BUGs.</p>
<p>I hope had helped.</p>
<h4 id="gdha_commented_at_2013-02-18_2029"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13741430">2013-02-18 20:29</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-18_2029" title="Permanent link">&para;</a></h4>
<p>@JCMendes according
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=614357">https://bugzilla.redhat.com/show_bug.cgi?id=614357</a>
parted version 2.3 fixes your problem with <code>partprobe</code></p>
<h4 id="gdha_commented_at_2013-02-18_2031"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13741529">2013-02-18 20:31</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-18_2031" title="Permanent link">&para;</a></h4>
<p>@altring would it be possible to answer on Jeroen's (jhoekx) questions?</p>
<h4 id="altring_commented_at_2013-02-20_1153"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13828135">2013-02-20 11:53</a>:<a class="headerlink" href="#altring_commented_at_2013-02-20_1153" title="Permanent link">&para;</a></h4>
<p>"The other error about the partition table not being re-read is likely
because the md device is open. Can you test if /proc/mdstat exists
before the restore starts?"<br />
Yes. It exists.</p>
<blockquote>
<p>RESCUE localhost:~ # ls -l /proc | grep mdstat<br />
--r--r--r-- 1 root root 0 Dec 31 19:24 mdstat</p>
</blockquote>
<p>"Is the metadata version visible in mdadm --misc --detail $device or
mdadm --detail --scan --config=partitions?"<br />
In rescue system or after booting from rescue media or after restore
completes? Where should I check?</p>
<h4 id="jhoekx_commented_at_2013-02-20_1203"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13828437">2013-02-20 12:03</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-20_1203" title="Permanent link">&para;</a></h4>
<p>What I was actually hoping for was that you posted the output :-) Could
you do that please?</p>
<h4 id="altring_commented_at_2013-02-21_1453"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13892727">2013-02-21 14:53</a>:<a class="headerlink" href="#altring_commented_at_2013-02-21_1453" title="Permanent link">&para;</a></h4>
<p>Please respond.</p>
<h4 id="jhoekx_commented_at_2013-02-21_1458"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13893005">2013-02-21 14:58</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-21_1458" title="Permanent link">&para;</a></h4>
<p>Can you do <code>cat /proc/mdstat</code> in the rescue system?</p>
<p>For the metadata version I would need the ouput in the real system.</p>
<h4 id="altring_commented_at_2013-02-22_0813"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13932910">2013-02-22 08:13</a>:<a class="headerlink" href="#altring_commented_at_2013-02-22_0813" title="Permanent link">&para;</a></h4>
<p>In real system:</p>
<blockquote>
<p>mdadm --detail --scan --config=partitions<br />
ARRAY /dev/md3 metadata=1.1 name=localhost.localdomain:3
UUID=03709fd5:5575633a:3cddfea3:7b706370<br />
ARRAY /dev/md1 metadata=1.1 name=localhost.localdomain:1
UUID=863dd69d:50129c5c:0e556583:9b769087<br />
ARRAY /dev/md2 metadata=1.1 name=localhost.localdomain:2
UUID=34b4ec11:fd95c035:4ece3f32:b42a1442<br />
ARRAY /dev/md0 metadata=1.0 name=localhost.localdomain:0
UUID=518fe3d0:56b11ba3:cd9be72d:0de5b337</p>
<p>mdadm --misc --detail /dev/md*</p>
</blockquote>
<p>/dev/md0:<br />
Version : 1.0<br />
Creation Time : Mon Jan 1 02:09:40 2007<br />
Raid Level : raid1<br />
Array Size : 511988 (500.07 MiB 524.28 MB)<br />
Used Dev Size : 511988 (500.07 MiB 524.28 MB)<br />
Raid Devices : 2<br />
Total Devices : 2<br />
Persistence : Superblock is persistent</p>
<pre><code>Update Time : Mon Jan  1 02:09:00 2007
      State : clean
</code></pre>
<p>Active Devices : 2<br />
Working Devices : 2<br />
Failed Devices : 0<br />
Spare Devices : 0</p>
<pre><code>       Name : localhost.localdomain:0
       UUID : 518fe3d0:56b11ba3:cd9be72d:0de5b337
     Events : 19

Number   Major   Minor   RaidDevice State
   0       8        1        0      active sync   /dev/sda1
   1       8       17        1      active sync   /dev/sdb1
</code></pre>
<p>/dev/md1:<br />
Version : 1.1<br />
Creation Time : Mon Jan 1 02:09:41 2007<br />
Raid Level : raid1<br />
Array Size : 4193272 (4.00 GiB 4.29 GB)<br />
Used Dev Size : 4193272 (4.00 GiB 4.29 GB)<br />
Raid Devices : 2<br />
Total Devices : 2<br />
Persistence : Superblock is persistent</p>
<pre><code>Update Time : Mon Jan  1 02:09:00 2007
      State : clean
</code></pre>
<p>Active Devices : 2<br />
Working Devices : 2<br />
Failed Devices : 0<br />
Spare Devices : 0</p>
<pre><code>       Name : localhost.localdomain:1
       UUID : 863dd69d:50129c5c:0e556583:9b769087
     Events : 20

Number   Major   Minor   RaidDevice State
   0       8        3        0      active sync   /dev/sda3
   1       8       19        1      active sync   /dev/sdb3
</code></pre>
<p>/dev/md2:<br />
Version : 1.1<br />
Creation Time : Mon Jan 1 02:09:42 2007<br />
Raid Level : raid1<br />
Array Size : 51198908 (48.83 GiB 52.43 GB)<br />
Used Dev Size : 51198908 (48.83 GiB 52.43 GB)<br />
Raid Devices : 2<br />
Total Devices : 2<br />
Persistence : Superblock is persistent</p>
<p>Intent Bitmap : Internal</p>
<pre><code>Update Time : Mon Jan  1 02:09:28 2007
      State : active
</code></pre>
<p>Active Devices : 2<br />
Working Devices : 2<br />
Failed Devices : 0<br />
Spare Devices : 0</p>
<pre><code>       Name : localhost.localdomain:2
       UUID : 34b4ec11:fd95c035:4ece3f32:b42a1442
     Events : 141

Number   Major   Minor   RaidDevice State
   0       8        2        0      active sync   /dev/sda2
   1       8       18        1      active sync   /dev/sdb2
</code></pre>
<p>/dev/md3:<br />
Version : 1.1<br />
Creation Time : Mon Jan 1 02:09:54 2007<br />
Raid Level : raid1<br />
Array Size : 256660348 (244.77 GiB 262.82 GB)<br />
Used Dev Size : 256660348 (244.77 GiB 262.82 GB)<br />
Raid Devices : 2<br />
Total Devices : 2<br />
Persistence : Superblock is persistent</p>
<p>Intent Bitmap : Internal</p>
<pre><code>Update Time : Mon Jan  1 02:09:26 2007
      State : active, resyncing
</code></pre>
<p>Active Devices : 2<br />
Working Devices : 2<br />
Failed Devices : 0<br />
Spare Devices : 0</p>
<p>Resync Status : 36% complete</p>
<pre><code>       Name : localhost.localdomain:3
       UUID : 03709fd5:5575633a:3cddfea3:7b706370
     Events : 237

Number   Major   Minor   RaidDevice State
   0       8        5        0      active sync   /dev/sda5
   1       8       21        1      active sync   /dev/sdb5
</code></pre>
<p>Metadata version can be seen in both cases.</p>
<h4 id="altring_commented_at_2013-02-22_0824"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13933202">2013-02-22 08:24</a>:<a class="headerlink" href="#altring_commented_at_2013-02-22_0824" title="Permanent link">&para;</a></h4>
<p>Here is "cat /proc/mdstat" output in RESCUE system:</p>
<blockquote>
<p>RESCUE localhost # cat /proc/mdstat<br />
Personalities : [raid1]<br />
md0 : active raid1 sda1[0] sdb1[1]<br />
511988 blocks super 1.0 [2/2] [UU]</p>
<p>md2 : active raid1 sdb2[1] sda2[0]<br />
51198908 blocks super 1.1 [2/2] [UU]<br />
bitmap: 1/1 pages [4KB], 65536KB chunk</p>
<p>md3 : active raid1 sda5[0] sdb5[1]<br />
256660348 blocks super 1.1 [2/2] [UU]<br />
[==============&gt;......] resync = 74.7% (191949440/256660348)
finish=33.6min speed=32054K/sec<br />
bitmap: 2/2 pages [8KB], 65536KB chunk</p>
<p>md1 : active raid1 sda3[0] sdb3[1]<br />
4193272 blocks super 1.1 [2/2] [UU]</p>
</blockquote>
<p>It looks like Rescue system mounts existing RAID partitons on HDD.</p>
<h4 id="jhoekx_commented_at_2013-02-22_0835"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13933468">2013-02-22 08:35</a>:<a class="headerlink" href="#jhoekx_commented_at_2013-02-22_0835" title="Permanent link">&para;</a></h4>
<p>Ok, thanks. I can add metadata support now.</p>
<p>The MD activatition is the reason why partitioning fails. I guess
there's a udev rule that automatically enables the MD devices. We'll
have to look into how to avoid that...</p>
<h4 id="altring_commented_at_2013-02-22_0843"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-13933722">2013-02-22 08:43</a>:<a class="headerlink" href="#altring_commented_at_2013-02-22_0843" title="Permanent link">&para;</a></h4>
<p>Thank you. Let me know please - I'll test it.</p>
<h4 id="gdha_commented_at_2013-09-03_1105"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-23704276">2013-09-03 11:05</a>:<a class="headerlink" href="#gdha_commented_at_2013-09-03_1105" title="Permanent link">&para;</a></h4>
<p>Are there any updates for this issue? If not, I think it is safe to
close this one.</p>
<h4 id="altring_commented_at_2013-09-03_1222"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-23708416">2013-09-03 12:22</a>:<a class="headerlink" href="#altring_commented_at_2013-09-03_1222" title="Permanent link">&para;</a></h4>
<p>No updates so far.<br />
Should be ok now...</p>
<h4 id="jcmendes_commented_at_2013-09-03_1247"><img src="https://avatars.githubusercontent.com/u/3606380?v=4" width="50"><a href="https://github.com/JCMendes">JCMendes</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-23709647">2013-09-03 12:47</a>:<a class="headerlink" href="#jcmendes_commented_at_2013-09-03_1247" title="Permanent link">&para;</a></h4>
<p>It´s working well now.</p>
<p>Regards,</p>
<p>J. Carlos Mendes</p>
<p>From: altring [mailto:<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>]<br />
Sent: terça-feira, 3 de setembro de 2013 09:23<br />
To: rear/rear<br />
Cc: Mendes, Jose Carlos<br />
Subject: Re: [rear] Recovery fails on partitions creation: Kernel
failed to re-read partition table (#198)</p>
<p>No updates so far.<br />
Should be ok now...</p>
<p>—<br />
Reply to this email directly or view it on
GitHubhttps://github.com/rear/rear/issues/198#issuecomment-23708416.</p>
<h4 id="gdha_commented_at_2013-09-06_1507"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-23946356">2013-09-06 15:07</a>:<a class="headerlink" href="#gdha_commented_at_2013-09-06_1507" title="Permanent link">&para;</a></h4>
<p>closing the issue with customer's agreement</p>
<h4 id="altring_commented_at_2013-09-08_0649"><img src="https://avatars.githubusercontent.com/u/3490663?v=4" width="50"><a href="https://github.com/altring">altring</a> commented at <a href="https://github.com/rear/rear/issues/198#issuecomment-24016139">2013-09-08 06:49</a>:<a class="headerlink" href="#altring_commented_at_2013-09-08_0649" title="Permanent link">&para;</a></h4>
<p>Thank you guys!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2013-02-06.198.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
