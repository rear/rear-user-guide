<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2839 PR merged: Pass -y to lvcreate instead of piping the output of yes - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2839 PR merged: Pass -y to lvcreate instead of piping the output of yes";
        var mkdocs_page_input_path = "issues/2022-07-14.2839.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2839 PR merged: Pass -y to lvcreate instead of piping the output of yes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2839_pr_merged_pass_-y_to_lvcreate_instead_of_piping_the_output_of_yes"><a href="https://github.com/rear/rear/pull/2839">#2839 PR</a> <code>merged</code>: Pass -y to lvcreate instead of piping the output of yes<a class="headerlink" href="#2839_pr_merged_pass_-y_to_lvcreate_instead_of_piping_the_output_of_yes" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2022-07-14_1404"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2839">2022-07-14 14:04</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2022-07-14_1404" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Cleanup</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL): #2834 #2827</p>
</li>
<li>
<p>How was this pull request tested?<br />
    In the same way as #2834</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    Revert "Use fail-safe 'yes' pipe for "lvm lvcreate"" - PR #2827 and
    pass <code>-y</code> to <code>lvcreate</code> to stop asking for input instead.</p>
</li>
</ul>
<p>The <code>-y</code> option is much simpler and less error-prone than a 'yes' pipe
(no error termination because of SIGPIPE, for instance). But we lose
support for SLES11, where <code>lvcreate</code> does not know the <code>-y</code> option.</p>
<p><code>yes</code> remains among <code>REQUIRED_PROGS</code>, it can be useful in the rescue
system. (It could be theoretically moved to PROGS, because it is not
required anymore. This could be done separately if really desired, but
for now we prefer to keep it in REQUIRED_PROGS, sooner or later
something will start requiring it.) See the discussion in
<a href="https://github.com/rear/rear/pull/2834">https://github.com/rear/rear/pull/2834</a>
.</p>
<h4 id="pcahyna_commented_at_2022-07-15_0833"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1185311544">2022-07-15 08:33</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-07-15_0833" title="Permanent link">&para;</a></h4>
<blockquote>
<p>And if <code>lvm lvcreate -y ...</code> fails (e.g. because old lvm does not
support '-y') the user gets failure messages so things do not go wrong
silently.</p>
</blockquote>
<p>I am afraid they won't see the error from the <code>lvm</code> command itself,
because the output of commands is nowadays hidden, isn't it? I guess
that the diskrestore.sh script may get some special handling...</p>
<h4 id="jsmeix_commented_at_2022-07-15_1027"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1185407190">2022-07-15 10:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-15_1027" title="Permanent link">&para;</a></h4>
<p>Exactly because users won't see errors from commands itself<br />
such LogPrintError messages are crucial to not let it<br />
appear to the user as if ReaR is failing silently.</p>
<p>When things fail with</p>
<pre><code>Failed to create LVM volume 'VG/LV' with lvcreate -y ...
Also failed to create LVM volume 'VG/LV' with lvcreate -y ..."
</code></pre>
<p>on the user's terminal where he launched "rear recover"<br />
it should be sufficiently obvious for the user<br />
where he could look for the reason<br />
AND<br />
it is sufficiently clear for us how to help him<br />
(provided the user managed to show us his<br />
terminal output or his "rear recover" log file).</p>
<h4 id="jsmeix_commented_at_2022-07-15_1029"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1185410327">2022-07-15 10:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-15_1029" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I could test how it actually looks when it fails with SLES11.</p>
<h4 id="jsmeix_commented_at_2022-07-18_0910"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1186954665">2022-07-18 09:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-07-18_0910" title="Permanent link">&para;</a></h4>
<p>How it actually looks when it fails with SLES11:</p>
<p>In debugscript mode:</p>
<pre><code>RESCUE linux-a5v5:~ # rear -D recover
...
Creating LVM PV /dev/mapper/cr_sda2
Creating LVM VG 'system' (some properties may not be preserved)
Creating LVM volume 'system/swap' (some properties may not be preserved)
Failed to create LVM volume 'system/swap' with lvcreate -y --stripes 1 -L 2147483648b -n swap system
Also failed to create LVM volume 'system/swap' with lvcreate -y --stripes 1 -l 100%FREE -n swap system
UserInput -I LAYOUT_CODE_RUN needed in /usr/share/rear/layout/recreate/default/200_run_layout_code.sh line 127
The disk layout recreation script failed
1) Rerun disk recreation script (/var/lib/rear/layout/diskrestore.sh)
2) View 'rear recover' log file (/var/log/rear/rear-linux-a5v5.log)
3) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
5) Use Relax-and-Recover shell and return back to here
6) Abort 'rear recover'
(default '1' timeout 300 seconds)
6
UserInput: Valid choice number result 'Abort 'rear recover''
ERROR: User chose to abort 'rear recover' in /usr/share/rear/layout/recreate/default/200_run_layout_code.sh
Some latest log messages since the last called script 200_run_layout_code.sh:
  2022-07-18 10:26:59.338931642 4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
  2022-07-18 10:26:59.343121961 5) Use Relax-and-Recover shell and return back to here
  2022-07-18 10:26:59.347923890 6) Abort 'rear recover'
  2022-07-18 10:26:59.352592251 (default '1' timeout 300 seconds)
  2022-07-18 10:27:10.985732018 UserInput: 'read' got as user input '6'
  2022-07-18 10:27:10.992055276 UserInput: Valid choice number result 'Abort 'rear recover''
  2022-07-18 10:27:10.998231743 Error detected during restore.
  2022-07-18 10:27:11.002984520 Restoring saved original /var/lib/rear/layout/disklayout.conf
Aborting due to an error, check /var/log/rear/rear-linux-a5v5.log for details
Exiting rear recover (PID 3939) and its descendant processes ...
Running exit tasks
To remove the build area you may use (with caution): rm -Rf --one-file-system /var/tmp/rear.Gyh45xwJGfeklyf
Terminated
</code></pre>
<p>In normal mode:</p>
<pre><code>RESCUE linux-a5v5:~ # rear recover
...
Creating LVM PV /dev/mapper/cr_sda2
Creating LVM VG 'system' (some properties may not be preserved)
Creating LVM volume 'system/swap' (some properties may not be preserved)
Failed to create LVM volume 'system/swap' with lvcreate -y --stripes 1 -L 2147483648b -n swap system
Also failed to create LVM volume 'system/swap' with lvcreate -y --stripes 1 -l 100%FREE -n swap system
The disk layout recreation script failed
1) Rerun disk recreation script (/var/lib/rear/layout/diskrestore.sh)
2) View 'rear recover' log file (/var/log/rear/rear-linux-a5v5.log)
3) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
5) Use Relax-and-Recover shell and return back to here
6) Abort 'rear recover'
(default '1' timeout 300 seconds)
6
ERROR: User chose to abort 'rear recover' in /usr/share/rear/layout/recreate/default/200_run_layout_code.sh
Some latest log messages since the last called script 200_run_layout_code.sh:
  2022-07-18 11:07:50.063893474 3) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
  2022-07-18 11:07:50.068134175 4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
  2022-07-18 11:07:50.072471816 5) Use Relax-and-Recover shell and return back to here
  2022-07-18 11:07:50.077718631 6) Abort 'rear recover'
  2022-07-18 11:07:50.081801160 (default '1' timeout 300 seconds)
  2022-07-18 11:07:54.519945228 UserInput: 'read' got as user input '6'
  2022-07-18 11:07:54.525937650 Error detected during restore.
  2022-07-18 11:07:54.528824083 Restoring saved original /var/lib/rear/layout/disklayout.conf
Some messages from /var/tmp/rear.mqmYeCYdi9FiXRV/tmp/rear.recover.stdout_stderr since the last called script 200_run_layout_code.sh:
  vgremove: unrecognized option '--yes'
    Error during parsing of command line.
    Volume group "system" successfully created
    0 logical volume(s) in volume group "system" now active
  lvcreate: invalid option -- 'y'
    Error during parsing of command line.
  lvcreate: invalid option -- 'y'
    Error during parsing of command line.
Use debug mode '-d' for some debug messages or debugscript mode '-D' for full debug messages with 'set -x' output
Aborting due to an error, check /var/log/rear/rear-linux-a5v5.log for details
Exiting rear recover (PID 926) and its descendant processes ...
Running exit tasks
Terminated
</code></pre>
<p>In non-debug mode users even could see errors from commands itself<br />
directly on the termial when those errors are in the last messages<br />
in the .../rear.WORKFLOW.stdout_stderr file.</p>
<h4 id="pcahyna_commented_at_2022-07-27_0943"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1196504830">2022-07-27 09:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-07-27_0943" title="Permanent link">&para;</a></h4>
<p>@jsmeix both your comments are addressed in the last commit. I am going
to merge the PR soon if no further comments.</p>
<h4 id="pcahyna_commented_at_2022-07-28_1009"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2839#issuecomment-1197941472">2022-07-28 10:09</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-07-28_1009" title="Permanent link">&para;</a></h4>
<p>@jsmeix , thanks for testing how it behaves on SLES11. Merging. By the
way, it is not needed to update the supported system list in release
notes, because support for SLES11 was officially dropped already in 2.7
(as noted in
<a href="https://github.com/rear/rear/issues/2820#issuecomment-1153750220">https://github.com/rear/rear/issues/2820#issuecomment-1153750220</a>
)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-07-14.2839.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
