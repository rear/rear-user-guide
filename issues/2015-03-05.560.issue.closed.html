<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#560 Issue closed: Setting SSH_ROOT_PASSWORD exposes the root password - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#560 Issue closed: Setting SSH_ROOT_PASSWORD exposes the root password";
        var mkdocs_page_input_path = "issues/2015-03-05.560.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#560 Issue closed: Setting SSH_ROOT_PASSWORD exposes the root password</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="560_issue_closed_setting_ssh_root_password_exposes_the_root_password"><a href="https://github.com/rear/rear/issues/560">#560 Issue</a> <code>closed</code>: Setting SSH_ROOT_PASSWORD exposes the root password<a class="headerlink" href="#560_issue_closed_setting_ssh_root_password_exposes_the_root_password" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="schlomo_opened_issue_at_2015-03-05_2128"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/560">2015-03-05 21:28</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2015-03-05_2128" title="Permanent link">&para;</a></h4>
<p>I just realized that if a user uses the SSH_ROOT_PASSWORD feature he
actually breaks the security concept of ReaR. The concept is that the
rescue media should not contain any secrets that can be used to exploit
the server during recovery.</p>
<p>The motivation for this approach is that in real life it is really hard
to truly protect the rescue media from beeing copied. If the media does
not contain dangerous secrets then it does not need to be protected
against copying.</p>
<p>With SSH keys there is no danger as possession of the <code>authorized_keys</code>
file does not grant access to the server.</p>
<p>However, when the SSH_ROOT_PASSWORD is set then the rescue media
actually contains this password twice: Once encrypted in <code>/etc/shadow</code>
and once <strong>not encrypted</strong> in the ReaR configuration!</p>
<p>Therefore using this option is a very dangerous thing. Especially since
normally the ReaR configuration is <strong>world readable</strong> on the source
system so that an attacker in the same network without root access could
read the ReaR configuration, somehow trick the admin into recovering the
server and then use the recovery time to access the server with the
known root password and inject malware at root level into the recovered
system. After it comes back the attacker will have root privileges on
it.</p>
<p>I don't remember who wanted to have this feature, I only saw that
@sanderu added some fixes in #362, #360 and #359.</p>
<p>Let's use this issue to discuss the impact of this feature and how we
will deal with it. I can imagine for example that we print a stern
warning about the security issue. Or that the user must supply the
password already encrypted and not plain text. Or that we introduce a
new variable ALLOW_INSECURE_FEATURES that must be set to actually
enable this (and maybe other similarly insecure) feature.</p>
<p>Please let me know your opinion.</p>
<h4 id="sanderu_commented_at_2015-03-06_0633"><img src="https://avatars.githubusercontent.com/u/4814297?v=4" width="50"><a href="https://github.com/sanderu">sanderu</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-77513684">2015-03-06 06:33</a>:<a class="headerlink" href="#sanderu_commented_at_2015-03-06_0633" title="Permanent link">&para;</a></h4>
<p>@schlomo, I see your point.</p>
<p>However, several questions comes to mind:<br />
If you have an attacker in the same network, isn't it pretty much "game
over"?? If they have been able to gain access to a server, then they
could also spend time escalating privileges instead of having to trick
the admin into recover a server as this much more likely expose the
attackers?</p>
<p>The SSH_ROOT_PASSWORD itself is only set if you want to allow an SSH
connection to do the recovery - and it should of course NEVER EVER be
the same as the OS root password! Goes without saying! But a stern
warning to the user could be given to avoid any mishaps here.</p>
<p>Having the ALLOW_INSECURE_FEATURES would be acceptable as this would
just be one more variable to set and is the least "intrusive" change.</p>
<p>BTW: is there any reason for having the ReaR config file world
readable??</p>
<h4 id="gdha_commented_at_2015-03-06_0641"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-77514346">2015-03-06 06:41</a>:<a class="headerlink" href="#gdha_commented_at_2015-03-06_0641" title="Permanent link">&para;</a></h4>
<p>By default the config files are:</p>
<pre><code>$ ls -l /etc/rear/
total 8
-rw-------. 1 root root 534 Dec 26  2013 local.conf
-rw-------. 1 root root  46 Feb 17 20:57 os.conf
</code></pre>
<p>@schlomo @sanderu Perhaps it is enough if we describe in the
<code>default.conf</code> that setting <code>SSH_ROOT_PASSWORD</code> is insecure. Why another
variable - there are more then enough already?</p>
<h4 id="sanderu_commented_at_2015-03-06_0748"><img src="https://avatars.githubusercontent.com/u/4814297?v=4" width="50"><a href="https://github.com/sanderu">sanderu</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-77519516">2015-03-06 07:48</a>:<a class="headerlink" href="#sanderu_commented_at_2015-03-06_0748" title="Permanent link">&para;</a></h4>
<p>@gdha Agreed. The most elegant simple solution.</p>
<h4 id="schlomo_commented_at_2015-03-06_0751"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-77519854">2015-03-06 07:51</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-06_0751" title="Permanent link">&para;</a></h4>
<p>@sanderu With SELinux and App Armor "hacking" a running OS could be
indeed difficult or impossible. The disaster recovery process offers a
convenient side channel attack where security is traditionally lower.</p>
<p>What about having the user to supply the password already encrypted?
IMHO that would solve all the problems and is actually also practiced
with many other tools where you must provide a static password.</p>
<h4 id="andreas-tarp_commented_at_2015-03-13_1455"><img src="https://avatars.githubusercontent.com/u/8861999?v=4" width="50"><a href="https://github.com/andreas-tarp">andreas-tarp</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-79013584">2015-03-13 14:55</a>:<a class="headerlink" href="#andreas-tarp_commented_at_2015-03-13_1455" title="Permanent link">&para;</a></h4>
<p>@schlomo In my point of view supplying the password already encrypted
would be the perfect solution. It does not add much complexity for a
rear user when configuring rear, but improves security.<br />
Maybe a short hint in default.conf file how to encrypt an password in
the correct way would help some people in the beginning.</p>
<h4 id="schlomo_commented_at_2015-03-13_1524"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-79042475">2015-03-13 15:24</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-13_1524" title="Permanent link">&para;</a></h4>
<p>@gdha what do you think? For 1.17.1?</p>
<h4 id="gdha_commented_at_2015-04-08_1447"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-90937896">2015-04-08 14:47</a>:<a class="headerlink" href="#gdha_commented_at_2015-04-08_1447" title="Permanent link">&para;</a></h4>
<p>cleaned up script <code>build/default/50_patch_sshd_config.sh</code> (has not much
to do with this issue content, but is worth to mention it)</p>
<h4 id="gdha_commented_at_2015-05-31_1540"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-107207824">2015-05-31 15:40</a>:<a class="headerlink" href="#gdha_commented_at_2015-05-31_1540" title="Permanent link">&para;</a></h4>
<p>@schlomo do you want some additional security measurements or are the
added fixes enough to satisfy your concerns?</p>
<h4 id="schlomo_commented_at_2015-05-31_1547"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-107211212">2015-05-31 15:47</a>:<a class="headerlink" href="#schlomo_commented_at_2015-05-31_1547" title="Permanent link">&para;</a></h4>
<p>@gdha great solution, thanks a lot! Safe by default and even backward
compatible.</p>
<h4 id="tbsky_commented_at_2015-07-24_1323"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124519080">2015-07-24 13:23</a>:<a class="headerlink" href="#tbsky_commented_at_2015-07-24_1323" title="Permanent link">&para;</a></h4>
<p>Hi:<br />
I need to use "SSH_ROOT_PASSWORD" today, and I found the current
situation of 1.17.1 is not working under rhel 6.6/7.1. reason below:</p>
<ol>
<li>the generated md5 password string is begin with '$1$', so the script
    should use single quote to handle it, or the special character '$'
    will cause problem. but the script use double quote to handle it.</li>
<li>even I modify the script to handle the string correctly, the result
    password won't work under rhel 6.6/7.1. I don't know why. it seems
    rhel need "/etc/pam.d/*" to use md5/sha password. under rhel
    6.6/7.1 the standard "crypt" password hash works, but md5/sha
    password hash failed.</li>
<li>so I think maybe we can add a variable "SSH_ROOT_PASSWORD_HASH"
    so user can use correct password hash for their own distribution? or
    other better ways?</li>
</ol>
<h4 id="gdha_commented_at_2015-07-24_1402"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124532711">2015-07-24 14:02</a>:<a class="headerlink" href="#gdha_commented_at_2015-07-24_1402" title="Permanent link">&para;</a></h4>
<p>@tbsky could you elaborate a bit more in detail what you did to fix it?
And what do you think is missing with <code>/etc/pam.d/*</code>?</p>
<h4 id="tbsky_commented_at_2015-07-24_1420"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124539065">2015-07-24 14:20</a>:<a class="headerlink" href="#tbsky_commented_at_2015-07-24_1420" title="Permanent link">&para;</a></h4>
<p>hi gdha:<br />
sure. the original script fix is easy. just fix the line at 50_ssh.sh</p>
<pre><code>-        "$1$*") echo "root:$SSH_ROOT_PASSWORD:::::::" &gt; $ROOTFS_DIR/etc/shadow ;;
+        '$1$'* ) echo "root:$SSH_ROOT_PASSWORD:::::::" &gt; $ROOTFS_DIR/etc/shadow ;;
</code></pre>
<p>but I am not sure how to deal the rhel situation? should we fix the
configuration so rhel can use md5 password hash? or just let it use the
crypto hash? I am not sure if we can find a way so every distribution
can use md5 hash correctly. so I think maybe let user add their own
working hash to rear system.</p>
<h4 id="tbsky_commented_at_2015-07-24_1656"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124578636">2015-07-24 16:56</a>:<a class="headerlink" href="#tbsky_commented_at_2015-07-24_1656" title="Permanent link">&para;</a></h4>
<p>hi gdha:<br />
after try &amp; error, I finally found the missing part:
"/lib64/libfreeblpriv3.so". both rhel 6.6 and 7.1 md5 password hash will
fail if the rear system didn't have that library.</p>
<p>I use ldd to check every file, and nobody need that library. hope
someone can explain how the things are working so I can learn about it.</p>
<p>so how do you want to fix the problem? use md5 hash and fix the linux
environment or something else..?</p>
<h4 id="gdha_commented_at_2015-07-24_1856"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124630044">2015-07-24 18:56</a>:<a class="headerlink" href="#gdha_commented_at_2015-07-24_1856" title="Permanent link">&para;</a></h4>
<p>@tbsky we can add the lib to the list to copy to the ramdisk</p>
<h4 id="tbsky_commented_at_2015-07-25_0425"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-124796126">2015-07-25 04:25</a>:<a class="headerlink" href="#tbsky_commented_at_2015-07-25_0425" title="Permanent link">&para;</a></h4>
<p>hi gdha:</p>
<p>I think it's ok to add that library to the list. just curious how is it
working. could you also fix the script and document together? the
document also has single/double quote problem:</p>
<p>the line at 50_ssh.sh</p>
<pre><code>-        "$1$*") echo "root:$SSH_ROOT_PASSWORD:::::::" &gt; $ROOTFS_DIR/etc/shadow ;;
+        '$1$'* ) echo "root:$SSH_ROOT_PASSWORD:::::::" &gt; $ROOTFS_DIR/etc/shadow ;;
</code></pre>
<p>the line at default.conf:</p>
<pre><code>-# and copy paste the output of openssl to variable SSH_ROOT_PASSWORD="..."
+# and copy paste the output of openssl to variable SSH_ROOT_PASSWORD='...'
</code></pre>
<p>thanks a lot for your kindly help!!</p>
<h4 id="gdha_commented_at_2015-07-27_0900"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-125135142">2015-07-27 09:00</a>:<a class="headerlink" href="#gdha_commented_at_2015-07-27_0900" title="Permanent link">&para;</a></h4>
<p>@tbsky could you verify the fix? Feedback is welcome (as always:)</p>
<h4 id="tbsky_commented_at_2015-07-27_0912"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-125137483">2015-07-27 09:12</a>:<a class="headerlink" href="#tbsky_commented_at_2015-07-27_0912" title="Permanent link">&para;</a></h4>
<p>hi gdha:<br />
I have not really test it but I think it wil work for me. however rhel6
also has 32bit versions.so add the "/lib64/libfreeblpriv3.so" will not
work for it. I don't know if there are better ways to handle library in
rear system?</p>
<h4 id="gdha_commented_at_2015-08-06_1301"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/560#issuecomment-128355090">2015-08-06 13:01</a>:<a class="headerlink" href="#gdha_commented_at_2015-08-06_1301" title="Permanent link">&para;</a></h4>
<p>@tbsky thank you - I also added the 32-bit version a minute ago</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-03-05.560.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
