<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2017 05 17.1368.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2017 05 17.1368.issue.closed";
        var mkdocs_page_input_path = "issues/2017-05-17.1368.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2017 05 17.1368.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1368_issue_closed_suse_12_on_power_iso_setting_seems_to_be_ignored"><a href="https://github.com/rear/rear/issues/1368">#1368 Issue</a> <code>closed</code>: Suse 12 on power. ISO setting seems to be ignored<a class="headerlink" href="#1368_issue_closed_suse_12_on_power_iso_setting_seems_to_be_ignored" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="nicovd737_opened_issue_at_2017-05-17_1537"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> opened issue at <a href="https://github.com/rear/rear/issues/1368">2017-05-17 15:37</a>:<a class="headerlink" href="#nicovd737_opened_issue_at_2017-05-17_1537" title="Permanent link">&para;</a></h4>
<p>Hello Community :-)</p>
<p>Sorry if i ask dummy question, but i'm a rear beginner.<br />
I have installed RPM provided by rear website for Suse (no-arch one).<br />
It's working but not creating any ISO file.</p>
<p>Please find my config:</p>
<pre>
# rear -V
Relax-and-Recover 1.17.1 / Git
# cat os.conf
OS_VENDOR=SUSE_LINUX
OS_VERSION=12
</pre>

<p>The Suse is on IBM Power server.</p>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL=file:///nfs/mksysb
AUTOEXCLUDE_MULTIPATH=y
BOOT_OVER_SAN=y
BACKUP_PROG_INCLUDE=( '/' )
BACKUP_PROG_EXCLUDE=( '/nfs' )
</pre>

<p>Result of rear -v mkbackup command:</p>
<pre>
# rear -v mkbackup
Relax-and-Recover 1.17.1 / Git
Using log file: /var/log/rear/rear-dtcgemasd07.log
Creating disk layout
Excluding component fs:/nfs/mksysb
Creating root filesystem layout
TIP: To login as root via ssh you need to set up /root/.ssh/authorized_keys or SSH_ROOT_PASSWORD in your configuration file
Copying files and directories
Copying binaries and libraries
Copying kernel modules
Creating initramfs
Copying resulting files to file location
Encrypting disabled
Creating tar archive '/nfs/mksysb/dtcgemasd07/backup.tar.gz'
Archived 1262 MiB [avg 8451 KiB/sec]OK
Archived 1262 MiB in 154 seconds [avg 8396 KiB/sec]
</pre>

<p>But no ISO image created.</p>
<p>I have tried to install release 2.00 with make install but it fails
immediatly with a BUG with Grub2.</p>
<p>Any help will be very appreciated for this tool who seems to be very
helpfull for us.</p>
<p>Many thanks<br />
Nico</p>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>rear version (/usr/sbin/rear -V):</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a):</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
<li>Are you using legacy BIOS or UEFI boot?</li>
<li>Brief description of the issue:</li>
<li>Work-around, if any:</li>
</ul>
<h4 id="gozora_commented_at_2017-05-17_1605"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302138603">2017-05-17 16:05</a>:<a class="headerlink" href="#gozora_commented_at_2017-05-17_1605" title="Permanent link">&para;</a></h4>
<p>Hi @nicovd737,</p>
<p>Your ISO is most probably located in <em>/var/lib/rear/output</em>, but that is
not the main problem ...<br />
I'm guessing that your <em>/nfs</em> is NFS share, if so, let ReaR handle
mounting/unmounting of network share by using config similar to this
one:</p>
<pre><code>BACKUP_URL=nfs://&lt;NFS_server&gt;/mnt/rear
OUTPUT_URL=nfs://&lt;NFS_server&gt;/mnt/rear/iso
</code></pre>
<p>With your current config you will most probably face some missing
binaries during recover phase.</p>
<p>For more information read
<a href="https://github.com/rear/rear/tree/master/doc/user-guide">docu</a>
especially
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/04-scenarios.adoc">04-scenarios.adoc</a>.</p>
<p>V.</p>
<h4 id="nicovd737_commented_at_2017-05-17_1623"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302144127">2017-05-17 16:23</a>:<a class="headerlink" href="#nicovd737_commented_at_2017-05-17_1623" title="Permanent link">&para;</a></h4>
<p>Hi @gozora</p>
<p>Thanks for your reply. If try the OUTPUT_URL settings but it's the same
issue. Seems to totally forget to create the ISO file :-)</p>
<pre>
# rear -v mkbackup
Relax-and-Recover 1.17.1 / Git
Using log file: /var/log/rear/rear-dtcgemasd07.log
Creating disk layout
Creating root filesystem layout
TIP: To login as root via ssh you need to set up /root/.ssh/authorized_keys or SSH_ROOT_PASSWORD in your configuration file
Copying files and directories
Copying binaries and libraries
Copying kernel modules
Creating initramfs
Copying resulting files to nfs location
Encrypting disabled
Creating tar archive '/tmp/rear.dOLa2SeknUaI7iM/outputfs/dtcgemasd07/backup.tar.gz'
Archived 1195 MiB [avg 8218 KiB/sec]OK
Archived 1195 MiB in 150 seconds [avg 8164 KiB/sec]
</pre>

<p>I will try to use tar files provided by GitHub instead of using this RPM
(release is quite old).<br />
Thanks again for your quick reply.<br />
Nico</p>
<h4 id="gozora_commented_at_2017-05-17_1627"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302144996">2017-05-17 16:27</a>:<a class="headerlink" href="#gozora_commented_at_2017-05-17_1627" title="Permanent link">&para;</a></h4>
<p>@nicovd737 no problem ;-)</p>
<p>If you don't manage to find solution by your self, please provide ReaR
log file from <code>rear mkrescue</code> session located in <em>/var/log/rear/</em></p>
<p>V.</p>
<h4 id="nicovd737_commented_at_2017-05-17_1846"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302192397">2017-05-17 18:46</a>:<a class="headerlink" href="#nicovd737_commented_at_2017-05-17_1846" title="Permanent link">&para;</a></h4>
<p>Do you want the full log ? It's quite huge ;-)</p>
<h4 id="gozora_commented_at_2017-05-17_1847"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302192771">2017-05-17 18:47</a>:<a class="headerlink" href="#gozora_commented_at_2017-05-17_1847" title="Permanent link">&para;</a></h4>
<p>Yes,</p>
<p>Attach files by dragging &amp; dropping, Choose Files selecting them, or
pasting from the clipboard. ..</p>
<h4 id="nicovd737_commented_at_2017-05-17_1849"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302193144">2017-05-17 18:49</a>:<a class="headerlink" href="#nicovd737_commented_at_2017-05-17_1849" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/1008809/rear-dtcgemasd07.txt">rear-dtcgemasd07.txt</a></p>
<h4 id="gozora_commented_at_2017-05-17_1917"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302201047">2017-05-17 19:17</a>:<a class="headerlink" href="#gozora_commented_at_2017-05-17_1917" title="Permanent link">&para;</a></h4>
<p>On my systems (all of them x86_64) ISO image is created by
<em>output/ISO/Linux-i386/820_create_iso_image.sh</em>.<br />
This part of ReaR is not executed on your Power HW.<br />
To be honest I have never hands on experience with such HW :-( hence
have no idea how boot works there.</p>
<p>You can have a look on issue
<a href="https://github.com/rear/rear/issues/663">https://github.com/rear/rear/issues/663</a>,
similar to yours, which includes patch
<a href="https://github.com/rear/rear/pull/672">https://github.com/rear/rear/pull/672</a>
introduced in ReaR 1.18 (however I can't evaluate if it will help or
not). I guess you can try to download ReaR 2.0 and check if it solves
your problem ...</p>
<p>V.</p>
<h4 id="gdha_commented_at_2017-05-18_0737"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302325782">2017-05-18 07:37</a>:<a class="headerlink" href="#gdha_commented_at_2017-05-18_0737" title="Permanent link">&para;</a></h4>
<p>@nicovd737 the best support for PowerPC you will find in the latest
snapshot - see
<a href="http://download.opensuse.org/repositories/Archiving:/Backup:/Rear:/Snapshot/SLE_12/">http://download.opensuse.org/repositories/Archiving:/Backup:/Rear:/Snapshot/SLE_12/</a></p>
<h4 id="nicovd737_commented_at_2017-05-18_0751"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302328892">2017-05-18 07:51</a>:<a class="headerlink" href="#nicovd737_commented_at_2017-05-18_0751" title="Permanent link">&para;</a></h4>
<p>Issue solved ! Many thanks @gdha :-)</p>
<h4 id="jsmeix_commented_at_2017-05-18_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302330619">2017-05-18 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_0759" title="Permanent link">&para;</a></h4>
<p>Simply put:<br />
ReaR 1.17.1 is too old to be used on IBM Power.</p>
<p>Recently there have been many adaptions and enhancements<br />
from @schabrolles regarding ReaR on Power (ppc64/ppc64le)<br />
and there have been further adaptions and enhancements<br />
also from @schabrolles regarding ReaR with MULTIPATH<br />
and I think also regarding ReaR with SAN.</p>
<p>@nicovd737<br />
because you use ReaR on Power with MULTIPATH and SAN<br />
I think you basically must use the latest ReaR code.</p>
<p>FYI:</p>
<p>Regarding your BACKUP_URL=file:///nfs/mksysb<br />
As far as I know this does not work.<br />
I always use</p>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://10.160.4.244/nfs
</pre>

<p>where 10.160.4.244 is the IP of my NFS server<br />
so that ReaR mounts the NFS share.<br />
Let ReaR mount the NFS share is in particular useful<br />
during "rear recover" so that you do not need to manually<br />
mount your NFS share from within the ReaR recovery system<br />
before you can run "rear recover".</p>
<p>In general have a look at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
therein in particular all the sections from the start up to<br />
"Disaster recovery with Relax-and-Recover (ReaR)"<br />
plus all the later sections until the end starting at<br />
"Virtual machines".</p>
<h4 id="jsmeix_commented_at_2017-05-18_0805"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302331884">2017-05-18 08:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_0805" title="Permanent link">&para;</a></h4>
<p>@nicovd737<br />
thanks for your prompt feedback<br />
<a href="https://github.com/rear/rear/issues/1368#issuecomment-302328892">https://github.com/rear/rear/issues/1368#issuecomment-302328892</a><br />
that is works with the current ReaR code.<br />
Such feedback helps us a lot to know that it really works in practice!</p>
<p>@schabrolles<br />
once more many thanks for your various adaptions and enhancements<br />
regarding Power architecture and MULTIPATH and SAN.<br />
It helps so much when experts in that areas contribute!</p>
<h4 id="jsmeix_commented_at_2017-05-18_0815"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302333908">2017-05-18 08:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_0815" title="Permanent link">&para;</a></h4>
<p>@nicovd737<br />
one more FYI:<br />
In latest ReaR there are some example configs in<br />
usr/share/rear/conf/examples/ in particular there is<br />
a RHEL7-PPC64LE-Mulitpath-PXE-GRUB.conf<br />
from @schabrolles which is probably also helpful<br />
on SLES12 - of course you cannot just copy it, the<br />
example configs are meant as hints what config variables<br />
are of interest regarding a particular setup.<br />
For example when you use the default SLES12 btrfs structure<br />
you should additionally have a look at<br />
SLE12-SP1-btrfs-example.conf or SLE12-SP2-btrfs-example.conf<br />
(depending on whether you have SP1 or SP2 which are<br />
incompatible in their default btrfs structures) and<br />
if you use e.g. SAP-HANA or UEFI you should<br />
check some more example configs...</p>
<h4 id="nicovd737_commented_at_2017-05-18_1028"><img src="https://avatars.githubusercontent.com/u/28760546?u=f966a5dad0b7213ce8b2fd849a849f165ede4914&v=4" width="50"><a href="https://github.com/nicovd737">nicovd737</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302365366">2017-05-18 10:28</a>:<a class="headerlink" href="#nicovd737_commented_at_2017-05-18_1028" title="Permanent link">&para;</a></h4>
<p>Thanks a lot for your help. Very appreciated.</p>
<h4 id="schabrolles_commented_at_2017-05-18_1037"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302367407">2017-05-18 10:37</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-05-18_1037" title="Permanent link">&para;</a></h4>
<p>@nicovd737 Here is an example of a local.conf for SLES12 on POWER I use.</p>
<pre><code>AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y

### write the rescue initramfs to USB and update the USB bootloader 
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://10.7.19.177/rear"

## SLES12 SPECIFIC options for BTRFS
BACKUP_OPTIONS="nfsvers=3,nolock" 
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )

btrfs_subvolume_without_snap=$(findmnt -n -r -t btrfs | cut -d ' ' -f 1 | grep -v '^/$' | egrep -v 'snapshots|crash' | sed -e "s/$/\/*'/" -e "s/^/'/" | tr '\n' ' ')
BACKUP_PROG_INCLUDE=( $btrfs_subvolume_without_snap )

POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
Tu trouveras également plus d’infos et d’exemples dans /usr/share/rear/conf/examples
</code></pre>
<h4 id="gdha_commented_at_2017-05-18_1101"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302372463">2017-05-18 11:01</a>:<a class="headerlink" href="#gdha_commented_at_2017-05-18_1101" title="Permanent link">&para;</a></h4>
<p>@schabrolles it seems to me that an extra prep script would benefit rear
users, especially for <code>snapper</code></p>
<h4 id="jsmeix_commented_at_2017-05-18_1216"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302386973">2017-05-18 12:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_1216" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I guess such extra prep script stuff is more meant for me<br />
because the usage of snapper together with btrfs on SLE12<br />
is a very SUSE specific thing.</p>
<p>Because SUSE's default btrfs setup in SLE12 is so complicated<br />
(or at least it looks so complicated to me) I have currently<br />
no good idea how to automate that stuff so that<br />
it works reliably with reasonable effort.</p>
<p>Therefore at least for now I must leave it to the (poor) user<br />
to manually "do the right settings" in local.conf to avoid<br />
that users get a wrong and misleading expectation<br />
that "ReaR just works with SLE12 and btrfs".</p>
<p>Or in other and more general words:<br />
Unless I can make an automatism working reliably<br />
I won't implement an automatism.</p>
<p>My hope is that for the upcoming SLE15 ( 12 + 1 = 15 ;-)<br />
the SUSE default btrfs setup stabilizes and then<br />
I may try another attempt to make its usage easier in ReaR.</p>
<p>But when the SUSE default btrfs setup still changes<br />
in incompatible ways I cannot do much because I will not<br />
implement overcomplicated and oversophisticated code<br />
that tries to "do things automatically right" for all those<br />
different and incompatible SUSE default btrfs setups.</p>
<p>@schabrolles<br />
thanks for your example!<br />
By the way when reading it I wonder if the comment at</p>
<pre>
### write the rescue initramfs to USB and update the USB bootloader 
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://10.7.19.177/rear" 
</pre>

<p>is a meanwhile false leftover from a former version?<br />
I also wonder what special stuff your final command</p>
<pre>
Tu trouveras ...
</pre>

<p>actually does on your SLES12 on POWER system ;-)<br />
cf.
<a href="https://github.com/rear/rear/issues/700">https://github.com/rear/rear/issues/700</a></p>
<h4 id="schabrolles_commented_at_2017-05-18_1300"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302396440">2017-05-18 13:00</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-05-18_1300" title="Permanent link">&para;</a></h4>
<p>@jsmeix : :D .... copy / past from email ....<br />
I will may be propose the same example with POWER + PXE for SUSE 12 with
clean comment</p>
<p>Regarding the specifique setup for SLE12 with btrfs, I agree with @gdha.
It should be part of a script somewhere to be automated...<br />
Why not started with a script specific to SLE12, that just set the
variables :</p>
<pre><code>REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )

btrfs_subvolume_without_snap=$(findmnt -n -r -t btrfs | cut -d ' ' -f 1 | grep -v '^/$' | egrep -v 'snapshots|crash' | sed -e "s/$/\/*'/" -e "s/^/'/" | tr '\n' ' ')
BACKUP_PROG_INCLUDE=("${BACKUP_PROG_INCLUDE[@]}" $btrfs_subvolume_without_snap )

POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
</code></pre>
<h4 id="jsmeix_commented_at_2017-05-18_1354"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302410707">2017-05-18 13:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_1354" title="Permanent link">&para;</a></h4>
<p>There cannot be a "script specific to SLE12"<br />
because for SLE12 there are several different<br />
incompatible btrfs default setups:</p>
<p>SLE12-SP2 btrfs default setup is incompatible compared to<br />
SLE12-SP1 btrfs default setup which is incompatible compared to<br />
SLE12-GA (a.k.a. SLE12-SP0) btrfs default setup.</p>
<p>Therefore there are three different example configs:<br />
For SLE12-SP2: conf/examples/SLE12-SP2-btrfs-example.conf<br />
for SLE12-SP1: conf/examples/SLE12-SP1-btrfs-example.conf<br />
for SLE12-GA/SP0: conf/examples/SLE12-btrfs-example.conf</p>
<p>Also there cannot be three scripts each one specific<br />
to SLE12-SP2, SLE12-SP1, and SLE12-GA/SP0<br />
(or in one script with three different cases therein).</p>
<p>Reason:</p>
<p>When a user has initially installed SLE12-GA/SP0 from scratch<br />
(then initially he needs a SLE12-GA/SP0 specific ReaR setup)<br />
and updated to SLE12-SP1 and to SLE12-SP2,<br />
then - as far as I know - the usual update<br />
only replaces RPMs with newer versions<br />
but it leaves the btrfs structure unchanged<br />
so that the user still needs a SLE12-GA/SP0 specific ReaR setup<br />
(only what is in his backup is now newer files)<br />
but - as far as I know - the updated system shows itself<br />
as a SLE12-SP2 system.</p>
<p>When a user has initially installed SLE12-SP1 from scratch<br />
(then initially he needs a SLE12-SP1 specific ReaR setup)<br />
and updated to SLE12-SP2,<br />
then - as far as I know - the usual update<br />
only replaces RPMs with newer versions<br />
but it leaves the btrfs structure unchanged<br />
so that the user still needs a SLE12-SP1 specific ReaR setup<br />
(only what is in his backup is now newer files)<br />
but - as far as I know - the updated system shows itself<br />
as a SLE12-SP2 system.</p>
<p>When a user has initially installed SLE12-SP2 from scratch<br />
(then initially he needs a SLE12-SP2 specific ReaR setup)<br />
and the system shows itself as a SLE12-SP2 system.</p>
<p>This means we cannot rely on what version strings<br />
the system tells about itself.</p>
<p>We must inspect "the real thing",<br />
i.e. the really existing btrfs stuff.</p>
<p>When we inspect the really existing btrfs stuff<br />
it means the btrfs stuff in ReaR works generically.</p>
<p>And this is what I have currently implemented:<br />
The btrfs stuff in ReaR works generically.</p>
<p>It works independent of what a particular system<br />
tells in whatever strings as what it likes to be<br />
recognized by users who look at that strings.</p>
<p>The current btrfs stuff in ReaR works only on real hard facts<br />
(at least I tried to implement it in this way).</p>
<p>This is what I can maintain - at least to some extent - see below.</p>
<p>This way the current generically working btrfs stuff in ReaR<br />
also works on Red Hat and on whatever other systems<br />
without having specific scripts for each one.</p>
<p>But the current generically working btrfs stuff in ReaR<br />
has some limitations.</p>
<p>It does not and cannot "just work" for any possible<br />
btrfs structure one can set up manually.</p>
<p>In particular it fails - as far as I can imagine - for<br />
interwoven btrfs subvolumes, see<br />
<a href="https://github.com/rear/rear/issues/497#issuecomment-71650367">https://github.com/rear/rear/issues/497#issuecomment-71650367</a><br />
and the subsequent comment<br />
<a href="https://github.com/rear/rear/issues/497#issuecomment-71652667">https://github.com/rear/rear/issues/497#issuecomment-71652667</a></p>
<p>And I think somehow I messed up something<br />
while I implemented support for the incompatible<br />
SLE12-SP1 btrfs stuff (compared to SLE12-GA/SP0)<br />
(since SLE12-SP1 snapper is 'in between')<br />
cf.
<a href="https://github.com/rear/rear/issues/556">https://github.com/rear/rear/issues/556</a><br />
so that there is currently this bug<br />
<a href="https://github.com/rear/rear/issues/1036">https://github.com/rear/rear/issues/1036</a></p>
<p>I do appreciate any fixes, adaptions, and enhancements<br />
that make the generically working btrfs support in ReaR<br />
work better and more reliably in general.</p>
<p>In contrast I think Linux distribution specific scripts or<br />
even special Linux distribution version specific scripts<br />
will not really help because in the end any user on any<br />
recent Linux system can manually create any btrfs structure<br />
so that in the end only generically working btrfs scripts<br />
could properly implement btrfs support in ReaR.</p>
<h4 id="schlomo_commented_at_2017-05-18_1409"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302414872">2017-05-18 14:09</a>:<a class="headerlink" href="#schlomo_commented_at_2017-05-18_1409" title="Permanent link">&para;</a></h4>
<p>@jsmeix if SLES12 is incompatible between service packs then it seems to
me that we should start to treat "12SP1" as the "version" for ReaR
andnot just "12". That way we can have different scripts for that.</p>
<p>Maybe this is also a very good moment to go back to actually have
different OS_VERSION and OS_MASTER_VERSION for SLES where we for
example use OS_MASTER_VENDOR=SUSE and OS_MASTER_VERSION=12 for the
stuff that is generic enough for all SLE12 and openSUSE12 while we use
OS_VENDOR=SLE and OS_VERSION=12SP1 for SLE12-SP1 specifically.
openSUSE specials can then go to OS_VENDOR=openSUSE or something like
that.</p>
<h4 id="jsmeix_commented_at_2017-05-18_1413"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302416089">2017-05-18 14:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_1413" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
didn't you read my reasoning why<br />
Linux distribution version specific scripts<br />
cannot work in general?</p>
<p>A SLES12-SP2 user can maunally setup a btrfs structure<br />
that matches the one in SLES12GA/SP0 or in SLES12-SP1<br />
or in Red Hat or in Ubuntu or anything else whatever he likes.</p>
<p>Linux distribution version specific scripts will "just fail".</p>
<h4 id="schlomo_commented_at_2017-05-18_1414"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302416504">2017-05-18 14:14</a>:<a class="headerlink" href="#schlomo_commented_at_2017-05-18_1414" title="Permanent link">&para;</a></h4>
<p>Erwischt :-(</p>
<h4 id="jsmeix_commented_at_2017-05-18_1415"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302416665">2017-05-18 14:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_1415" title="Permanent link">&para;</a></h4>
<p>OK :-)</p>
<h4 id="jsmeix_commented_at_2017-05-18_1444"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-302425761">2017-05-18 14:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-18_1444" title="Permanent link">&para;</a></h4>
<p>To avoid misunderstanding:</p>
<p>I think what could of course be done is to automate things like</p>
<pre>
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
</pre>

<p>because I assume it is possible to autodetect sufficiently reliably<br />
whether or not that stuff is needed during "rear recover" and<br />
if that stuff is copied into the recovery system regardless<br />
that it is not actually needed there it should cause no failure<br />
(just the recovery system is bigger than actually needed).</p>
<h4 id="jsmeix_commented_at_2017-07-10_1451"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1368#issuecomment-314130236">2017-07-10 14:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-07-10_1451" title="Permanent link">&para;</a></h4>
<p>An addendum regarding whether or not<br />
a SLE12-SP1 system that was upgraded to SLE12-SP2<br />
shows itself as a SLE12-SP2 system or still as SLE12-SP1:</p>
<p>When upgrading with plain "zypper dup" the /etc/os-release file<br />
is left unchanged so that afterwards it still shows itself as SLE12-SP1.</p>
<p>One needs to do a so called "service pack migration", see<br />
the "Service Pack Migration" section in the SUSE documentation<br />
in particular therein see "Migrating with Zypper" at<br />
<a href="https://www.suse.com/documentation/sles-12/book_sle_deployment/data/sec_update_migr_zypper_onlinemigr.html">https://www.suse.com/documentation/sles-12/book_sle_deployment/data/sec_update_migr_zypper_onlinemigr.html</a></p>
<p>This is another reason why scripts won't work reliably<br />
if they only check version strings to behave different<br />
(the better way is to check "the real thing" directly).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-05-17.1368.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
