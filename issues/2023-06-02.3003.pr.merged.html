<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3003 PR merged: Improvements of the Makefile distribution targets - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3003 PR merged: Improvements of the Makefile distribution targets";
        var mkdocs_page_input_path = "issues/2023-06-02.3003.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#3003 PR merged: Improvements of the Makefile distribution targets</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3003_pr_merged_improvements_of_the_makefile_distribution_targets"><a href="https://github.com/rear/rear/pull/3003">#3003 PR</a> <code>merged</code>: Improvements of the Makefile distribution targets<a class="headerlink" href="#3003_pr_merged_improvements_of_the_makefile_distribution_targets" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2023-06-02_1535"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/3003">2023-06-02 15:35</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2023-06-02_1535" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL):</p>
</li>
<li>
<p>How was this pull request tested?<br />
<code>make srpm</code> and <code>make rpm</code></p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    Several improvements to the Makefile targets that generate
    distribution packages:</p>
<ul>
<li>The dist tarball (<code>dist/$(name)-$(distversion).tar.gz</code>) has been
    considered always up to date by make, and thus not remade when
    any of the files changed. This has caused "make srpm" (and other
    targets depending on the dist tarball - "make rpm", "make deb"
    etc.) to build packages without newer changes to the sources.<br />
    Fix by marking <code>dist/$(name)-$(distversion).tar.gz</code> as a phony
    target that will be always rebuilt.</li>
<li>The source RPM has been specified as a glob pattern:
    <code>dist/$(name)-$(version)-*.src.rpm</code>. This breaks when there are
    multiple source RPMs under dist/ - leftovers from previous
    builds. It forces us to use clean or package-clean always before
    using "make rpm", which is not ideal.<br />
    Fix by determining the actual full package name (with the dist
    tag) by parsing the spec file and using that.</li>
<li>Do not <code>%define</code> rpmrelease in the spec file, define it on the
    command line in Makefile instead. Allows us to eliminate one
    <code>sed</code> transform of the spec file to set rpmrelease to the
    desired value.</li>
</ul>
</li>
</ul>
<h4 id="pcahyna_commented_at_2023-06-02_1536"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1573938460">2023-06-02 15:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-02_1536" title="Permanent link">&para;</a></h4>
<p>@schlomo, I think you touched the Makefile and especially the package
generation recently, can you please have a look?</p>
<h4 id="pcahyna_commented_at_2023-06-02_1657"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1574042367">2023-06-02 16:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-02_1657" title="Permanent link">&para;</a></h4>
<p>Sorry, I did now know that it was intentional. Can you please point me
to the commit where you made the change? I don't see anything related in
the commit messages.</p>
<h4 id="schlomo_commented_at_2023-06-02_1717"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1574065295">2023-06-02 17:17</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-02_1717" title="Permanent link">&para;</a></h4>
<p>I'm not yet as good with my commit messages... It was when I returned
the makefile for the package build GH action</p>
<h4 id="pcahyna_commented_at_2023-06-02_1842"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1574162394">2023-06-02 18:42</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-02_1842" title="Permanent link">&para;</a></h4>
<p>@schlomo I think it is a bit unusual - the autotools - generated
Makefiles also always rebuild the dist tarball. But I am trying. Please
test the latest commit.</p>
<h4 id="pcahyna_commented_at_2023-06-05_0850"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1576389869">2023-06-05 08:50</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-05_0850" title="Permanent link">&para;</a></h4>
<p>@schlomo can you please test whether the latest commit resolves your
concern?</p>
<h4 id="pcahyna_commented_at_2023-06-05_1221"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1576685594">2023-06-05 12:21</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-05_1221" title="Permanent link">&para;</a></h4>
<p>@schlomo why are you merging 'master' into this branch, is there some
particular new feature there that you want to test together with my
change?</p>
<h4 id="schlomo_commented_at_2023-06-05_1233"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1576699859">2023-06-05 12:33</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-05_1233" title="Permanent link">&para;</a></h4>
<p>@pcahyna can you have a look at
<a href="https://github.com/pcahyna/rear/actions/runs/5176475050">https://github.com/pcahyna/rear/actions/runs/5176475050</a>
please? It doesn't work with your change, while
<a href="https://github.com/rear/rear/actions/runs/5176703833">https://github.com/rear/rear/actions/runs/5176703833</a>
worked (current <code>master</code> without your change).</p>
<p>In general, for any change to the <code>Makefile</code> I kindly ask to keep this
GH Action working and to check that the <code>tar.gz</code> is the same (identical)
for every OS.</p>
<blockquote>
<p>@schlomo why are you merging 'master' into this branch, is there some
particular new feature there that you want to test together with my
change?</p>
</blockquote>
<p>Yes, I removed Fedora Rawhide from the list of distros as that was
broken and prevented the Build Packages GH Action from working and your
change needs to be tested against that.</p>
<h4 id="pcahyna_commented_at_2023-06-05_1715"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1577177693">2023-06-05 17:15</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-05_1715" title="Permanent link">&para;</a></h4>
<p>@schlomo sure, looking. Could you please add this GitHub action to the
CI somehow? Right now I see<br />
"All checks have passed<br />
20 successful checks"<br />
and the only indication that something is wrong is a tiny red ❌ next to
the commit ID.</p>
<h4 id="pcahyna_commented_at_2023-06-05_2039"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1577442911">2023-06-05 20:39</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-05_2039" title="Permanent link">&para;</a></h4>
<blockquote>
<p>to check that the tar.gz is the same (identical) for every OS</p>
</blockquote>
<p>do you mean that all the OSes should have the same .tar.gz ? How to
check that?</p>
<h4 id="pcahyna_commented_at_2023-06-05_2117"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1577489868">2023-06-05 21:17</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-05_2117" title="Permanent link">&para;</a></h4>
<p>Anyway @schlomo please have a look at the last commit again, the GH
action now passes.</p>
<h4 id="schlomo_commented_at_2023-06-06_0649"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578020374">2023-06-06 06:49</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_0649" title="Permanent link">&para;</a></h4>
<p>@pcahyna much better, only CentOS 6 is still acting up (as usual):<br />
<img alt="image" src="https://github.com/rear/rear/assets/101384/7de96c75-03a3-4f26-9bb2-af23470d5c94" /></p>
<p>The binary RPM was not generated, here is the log for it:</p>
<pre><code>********** centos:6                                 **********
rm -f dist/*.rpm dist/*.deb dist/*.pkg.*
== Building SRPM package rear-2.7-git.5181.1a842d2b.makesrpmimprovements ==
if test "/tmp/tmp.qQUdmt3OmH.spec"; then tar -xzOf dist/rear-2.7-git.5181.1a842d2b.makesrpmimprovements.tar.gz rear-2.7-git.5181.1a842d2b.makesrpmimprovements/packaging/rpm/rear.spec &gt; "/tmp/tmp.qQUdmt3OmH.spec"; fi
rm -rf /var/tmp/build-rear-2.7
mkdir -p /var/tmp/build-rear-2.7
cp dist/rear-2.7-git.5181.1a842d2b.makesrpmimprovements.tar.gz /var/tmp/build-rear-2.7/
rpmbuild -ts --clean --nodeps \
        --define="_sourcedir /rear/dist" \
        --define="_srcrpmdir /rear/dist" \
        --define="_topdir /var/tmp/build-rear-2.7/rpmbuild" --define="rpmrelease .git.5181.1a842d2b.makesrpmimprovements" --define="debug_package %{nil}" \
        /var/tmp/build-rear-2.7/rear-2.7-git.5181.1a842d2b.makesrpmimprovements.tar.gz
Wrote: /rear/dist/rear-2.7-1.git.5181.1a842d2b.makesrpmimprovements.el6.src.rpm
Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.MNJrfr
+ umask 022
+ cd /var/tmp/build-rear-2.7/rpmbuild/BUILD
+ rm -rf rear-2.7-git.5181.1a842d2b.makesrpmimprovements
+ exit 0
/bin/bash: rpmspec: command not found
/bin/bash: rpmspec: command not found
== Building RPM package  ==
rpmbuild --rebuild --clean \
        --define="_rpmdir /rear/dist" \
        --define "_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm" \
        --define="_topdir /var/tmp/build-rear-2.7/rpmbuild" --define="rpmrelease .git.5181.1a842d2b.makesrpmimprovements" --define="debug_package %{nil}" \
        dist/.src.rpm
error: cannot open dist/.src.rpm: No such file or directory
make: *** [rpm] Error 1
tar: Removing leading `/' from member names
/var/tmp/build-rear-2.7/
/var/tmp/build-rear-2.7/rear-2.7-git.5181.1a842d2b.makesrpmimprovements.tar.gz
/var/tmp/build-rear-2.7/rpmbuild/
/var/tmp/build-rear-2.7/rpmbuild/SPECS/
/var/tmp/build-rear-2.7/rpmbuild/BUILD/
/var/tmp/build-rear-2.7/rpmbuild/RPMS/
/var/tmp/build-rear-2.7/rpmbuild/BUILDROOT/
********** Copying dist to dist-all/centos-6
</code></pre>
<p>Can you please try to fix this?</p>
<p>The reason it is not part of the CI checks is 1) it runs very long and
2) I want to see it stabilize more before adding it.</p>
<p>I thought to maybe run it nightly instead of after every commit, I'll
also add support to publish the resulting binaries via GH.</p>
<h4 id="schlomo_commented_at_2023-06-06_0650"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578021008">2023-06-06 06:50</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_0650" title="Permanent link">&para;</a></h4>
<p>Oh, and you can use the wrapped up build area for CentOS 6 to look into
it, maybe it helps debugging</p>
<h4 id="pcahyna_commented_at_2023-06-06_0932"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578291320">2023-06-06 09:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_0932" title="Permanent link">&para;</a></h4>
<p>The required <code>rpmspec</code> tool does not exist on EL 6 yet.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1001"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578335408">2023-06-06 10:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1001" title="Permanent link">&para;</a></h4>
<blockquote>
<p>only CentOS 6 is still acting up</p>
</blockquote>
<p>Then why do I see a green check mark ✔️ in
<a href="https://github.com/pcahyna/rear/commit/1a842d2b73e985ac8c76480c006647f5b6078247">https://github.com/pcahyna/rear/commit/1a842d2b73e985ac8c76480c006647f5b6078247</a>
? Something is wrong with error reporting in your GitHub action (there
is that error hidden deep in the logs indeed, but it does not affect the
visible result).<br />
By the way, I don't see the result of the GitHub action at
<a href="https://github.com/rear/rear/pull/3003/commits/1a842d2b73e985ac8c76480c006647f5b6078247">https://github.com/rear/rear/pull/3003/commits/1a842d2b73e985ac8c76480c006647f5b6078247</a>
and above.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1012"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578353071">2023-06-06 10:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1012" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Can you please try to fix this?</p>
</blockquote>
<p>I believe it should be fixed now.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1013"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578355820">2023-06-06 10:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1013" title="Permanent link">&para;</a></h4>
<blockquote>
<p>The reason it is not part of the CI checks is 1) it runs very long</p>
</blockquote>
<p>I saw it running for half a hour, which is not that long.</p>
<blockquote>
<p>and 2) I want to see it stabilize more before adding it.</p>
</blockquote>
<p>Agreed.</p>
<h4 id="schlomo_commented_at_2023-06-06_1112"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578504026">2023-06-06 11:12</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_1112" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9349534521#step:7:31">https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9349534521#step:7:31</a>
(sorry for again pointing to the logs) has <strong>changed</strong> in the dist
archive name, this indicates that there was a change in the source tree
that is not committed to git.</p>
<p>The <a href="https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9349534521#step:7:1">ls
-lR</a>
step is good for a quick check: There should be no tar.gz archives on
the top level and in every subdirectory there should be the same tar.gz
(at least of the same size). See
<a href="https://github.com/rear/rear/actions/runs/5186427841/jobs/9347522192#step:7:38">https://github.com/rear/rear/actions/runs/5186427841/jobs/9347522192#step:7:38</a>
for a "good" example.</p>
<p>Maybe I should add more sanity checks to it, to automatically validate
the stuff I just said?</p>
<h4 id="pcahyna_commented_at_2023-06-06_1128"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578540669">2023-06-06 11:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1128" title="Permanent link">&para;</a></h4>
<blockquote>
<p>has <strong>changed</strong> in the dist archive name, this indicates that there
was a change in the source tree that is not committed to git.</p>
</blockquote>
<p>Do you know what the change is? The previous commit did not have this
problem and I don't see what in the last commit could have broken it.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1135"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578556882">2023-06-06 11:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1135" title="Permanent link">&para;</a></h4>
<p>I see this difference:</p>
<pre><code>== Prepare manual ==
make -C doc man
make[1]: Entering directory '/home/runner/work/rear/rear/doc'
make[1]: Nothing to be done for 'man'.
make[1]: Leaving directory '/home/runner/work/rear/rear/doc'
</code></pre>
<p>in
<a href="https://github.com/pcahyna/rear/actions/runs/5181590712/jobs/9337304522#step:5:30">https://github.com/pcahyna/rear/actions/runs/5181590712/jobs/9337304522#step:5:30</a><br />
vs</p>
<pre><code>== Prepare manual ==
make -C doc man
make[1]: Entering directory '/home/runner/work/rear/rear/doc'
asciidoctor -b manpage -d manpage rear.8.adoc
make[1]: Leaving directory '/home/runner/work/rear/rear/doc'
</code></pre>
<p>in
<a href="https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9349534521#step:5:30">https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9349534521#step:5:30</a></p>
<p>so, the modified file might be just the manual page.</p>
<h4 id="schlomo_commented_at_2023-06-06_1139"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578566366">2023-06-06 11:39</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_1139" title="Permanent link">&para;</a></h4>
<p>Yes, I'd love to change the way how we generate the man page so that it
doesn't happen accidentally when we don't need it.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1140"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578570749">2023-06-06 11:40</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1140" title="Permanent link">&para;</a></h4>
<p>I suspect this is just random, depending on the relative order of
timestamp on <code>rear.8</code> vs. <code>rear.8.adoc</code> created during checkout.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1141"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578573131">2023-06-06 11:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1141" title="Permanent link">&para;</a></h4>
<p>rerunning to confirm.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1143"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578578956">2023-06-06 11:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1143" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Maybe I should add more sanity checks to it, to automatically validate
the stuff I just said?</p>
</blockquote>
<p>Sure, although I would not consider it a priority if you are willing to
help me debugging this PR manually, I suspect we won't touch the
Makefile for some time after we finish this.</p>
<h4 id="schlomo_commented_at_2023-06-06_1153"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578605909">2023-06-06 11:53</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_1153" title="Permanent link">&para;</a></h4>
<p>Happy to help here of course. I think that before making the build
packages workflow part of the CI I should upgrade it to better check for
errors and explain them so that other have a fair chance of quickly
fixing it.</p>
<h4 id="pcahyna_commented_at_2023-06-06_1302"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578728334">2023-06-06 13:02</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1302" title="Permanent link">&para;</a></h4>
<p>@schlomo the rerun
<a href="https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9351273206">https://github.com/pcahyna/rear/actions/runs/5187314401/jobs/9351273206</a>
seems OK (please check again), so the problem is not reproducible indeed
and I believe it has not been caused by my changes.</p>
<h4 id="schlomo_commented_at_2023-06-06_1423"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1578864660">2023-06-06 14:23</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_1423" title="Permanent link">&para;</a></h4>
<p>Thanks a lot for this improvement, I especially like how you create the
dependency via the <code>DIST_FILES</code></p>
<h4 id="pcahyna_commented_at_2023-06-06_1631"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1579094854">2023-06-06 16:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1631" title="Permanent link">&para;</a></h4>
<p>I home the dependency won't break anything, it does not seem very
standard.</p>
<blockquote>
<p>Yes, I removed Fedora Rawhide from the list of distros as that was
broken and prevented the Build Packages GH Action from working and
your change needs to be tested against that.</p>
</blockquote>
<p>What's the problem with Fedora Rawhide by the way?</p>
<h4 id="schlomo_commented_at_2023-06-06_1633"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1579097051">2023-06-06 16:33</a>:<a class="headerlink" href="#schlomo_commented_at_2023-06-06_1633" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/fedora-cloud/docker-brew-fedora/issues/109">https://github.com/fedora-cloud/docker-brew-fedora/issues/109</a></p>
<h4 id="pcahyna_commented_at_2023-06-06_1637"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/3003#issuecomment-1579103045">2023-06-06 16:37</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-06_1637" title="Permanent link">&para;</a></h4>
<p><a href="https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/thread/RIIOCKWR2MBYARJNKVZXT3YLXBYGRJAF/">https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/thread/RIIOCKWR2MBYARJNKVZXT3YLXBYGRJAF/</a><br />
<a href="https://pagure.io/fedora-infrastructure/issue/11358">https://pagure.io/fedora-infrastructure/issue/11358</a></p>
<p>it seems you can use images from another registry.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-06-02.3003.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
