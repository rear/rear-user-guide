<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2001 PR merged: fedora29 grub2-efi-x64-modules does not contain linuxefi module - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2001 PR merged: fedora29 grub2-efi-x64-modules does not contain linuxefi module";
        var mkdocs_page_input_path = "issues/2018-12-10.2001.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2001 PR merged: fedora29 grub2-efi-x64-modules does not contain linuxefi module</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2001_pr_merged_fedora29_grub2-efi-x64-modules_does_not_contain_linuxefi_module"><a href="https://github.com/rear/rear/pull/2001">#2001 PR</a> <code>merged</code>: fedora29 grub2-efi-x64-modules does not contain linuxefi module<a class="headerlink" href="#2001_pr_merged_fedora29_grub2-efi-x64-modules_does_not_contain_linuxefi_module" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="gdha_opened_issue_at_2018-12-10_1703"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/pull/2001">2018-12-10 17:03</a>:<a class="headerlink" href="#gdha_opened_issue_at_2018-12-10_1703" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL): #1996</p>
</li>
<li>
<p>How was this pull request tested? not tested yet</p>
</li>
<li>
<p>Brief description of the changes in this pull request: See
    <a href="https://github.com/rear/rear/issues/1996#issuecomment-445201012">https://github.com/rear/rear/issues/1996#issuecomment-445201012</a></p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2018-12-11_0810"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446109329">2018-12-11 08:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-11_0810" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I wonder if the currently unconditioned test for /etc/fedora-release<br />
to skip the linuxefi GRUB module is sufficiently backward compatible<br />
so that things still work with Fedora before 29?</p>
<h4 id="rmetrich_commented_at_2018-12-11_1014"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446146889">2018-12-11 10:14</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-12-11_1014" title="Permanent link">&para;</a></h4>
<p>@jsmeix that's what I'm testing now</p>
<h4 id="rmetrich_commented_at_2018-12-11_1057"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446160852">2018-12-11 10:57</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-12-11_1057" title="Permanent link">&para;</a></h4>
<p>@gdha @jsmeix I don't know exactly what this Grub <code>linuxefi</code> module is
but it still works without it on Fedora 27.</p>
<h4 id="jsmeix_commented_at_2018-12-11_1302"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446194309">2018-12-11 13:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-11_1302" title="Permanent link">&para;</a></h4>
<p>By Googling for "Grub linuxefi module" I found only<br />
<a href="https://lists.gnu.org/archive/html/grub-devel/2014-01/msg00120.html">https://lists.gnu.org/archive/html/grub-devel/2014-01/msg00120.html</a><br />
as the best explanation what that Grub linuxefi module is.</p>
<p>By Googling for "GRUB_USE_LINUXEFI" (cf. /etc/default/grub) I also
found<br />
<a href="https://lists.gnu.org/archive/html/help-grub/2016-08/msg00014.html">https://lists.gnu.org/archive/html/help-grub/2016-08/msg00014.html</a><br />
which reads (excerpt)</p>
<pre><code>linuxefi.mod ... I need that for the EFI based boot
</code></pre>
<p>so that you may have to test on UEFI systems if things still<br />
work with older Fedora even without the Grub linuxefi module.</p>
<p>If someone here may know more about it I could only think of<br />
@gozora</p>
<h4 id="gozora_commented_at_2018-12-11_1606"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446258448">2018-12-11 16:06</a>:<a class="headerlink" href="#gozora_commented_at_2018-12-11_1606" title="Permanent link">&para;</a></h4>
<p>@rmetrich</p>
<blockquote>
<p>I don't know exactly what this Grub linuxefi module is but it still
works without it on Fedora 27.</p>
</blockquote>
<p>It might very well be, that it is working because
<code>linuxefi and initrdefi options</code> might be built in directly into Grub or
might be part of other module, even more interesting is that
<code>linuxefi and initrdefi options</code> might be substituted by
<code>linux and initrd options</code></p>
<p>In general I would say that if you can boot ReaR rescue system, you did
not broke anything.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2018-12-11_1647"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446274060">2018-12-11 16:47</a>:<a class="headerlink" href="#gozora_commented_at_2018-12-11_1647" title="Permanent link">&para;</a></h4>
<p>In my
<a href="https://github.com/rear/rear/pull/2001#issuecomment-446258448">https://github.com/rear/rear/pull/2001#issuecomment-446258448</a>,
I was partially right ...<br />
I've installed Fedora29 and used UEFI boot, my default entry in
<em>grub.cfg</em> looked something like this:</p>
<pre><code>...
linux   /vmlinuz-4.19.7-300.fc29.x86_64 root=/dev/mapper/fedora-root ro resume=/dev/mapper/fedora-swap rd.lvm.lv=fedora/root rd.lvm.lv=fedora/swap rhgb quiet LANG=en_US.UTF-8
initrdefi /initramfs-4.19.7-300.fc29.x86_64.img
...
</code></pre>
<p>However, I've noticed entry for rescue which showed something like this:</p>
<pre><code>...
linux   /vmlinuz-0-rescue-1acdfce117504294b63a270c24b2afc8 root=/dev/mapper/fedora-root ro resume=/dev/mapper/fedora-swap rd.lvm.lv=fedora/root rd.lvm.lv=fedora/swap rhgb quiet
initrd  /initramfs-0-rescue-1acdfce117504294b63a270c24b2afc8.img
...
</code></pre>
<p>When I've tried to change <em>initrdefi</em> to <em>initrd</em> for my default entry,
everything booted just fine.</p>
<p>Apart from all this, <em>initrdefi</em> looks to be part <strong>linux.mod</strong> on
Fedora29</p>
<pre><code>[root@fedora29 x86_64-efi]# grep initrdefi *
command.lst:initrdefi: linux
Binary file linux.mod matches

[root@fedora29 x86_64-efi]# grep linuxefi *
Binary file chain.mod matches
command.lst:linuxefi: linux
Binary file linux.mod matches
</code></pre>
<p>So for Fedora 29 it is save to omit linuxefi.mod as it functionality was
moved to linux.mod.</p>
<p>I'll now download Fedora 28 (unfortunately my test Fedora 28 is booting
Legacy BIOS) to check Grub behavior there ...</p>
<p>Will keep you posted.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2018-12-11_1812"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446303990">2018-12-11 18:12</a>:<a class="headerlink" href="#gozora_commented_at_2018-12-11_1812" title="Permanent link">&para;</a></h4>
<p>Every day you learn something new is a good day!<br />
I just found out that on Fedora 28 you can safely omit <em>linuxefi.mod</em>
since it looks to be somehow replaceable by <em>chain.mod</em>. This IMHO makes
this PR backward compatible.</p>
<p>I've successfully created UEFI bootloader (<em>test1.efi</em>) and booted with
following options:<br />
<strong>Fedora 28</strong></p>
<pre><code>grub2-mkimage -O x86_64-efi -o /boot/efi/EFI/tst/test1.efi -p "/EFI/BOOT" part_gpt part_msdos fat ext2 normal boot configfile linux chain multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs
</code></pre>
<p><strong>Fedora 29</strong></p>
<pre><code>grub2-mkimage -O x86_64-efi -o /boot/efi/EFI/tst/test1.efi -p "/EFI/BOOT" part_gpt part_msdos fat ext2 normal boot configfile linux chain jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs
</code></pre>
<p>Notice also that on <strong>Fedora 29</strong> I had to drop <em>multiboot.mod</em> as it
does not exist on my installation.</p>
<p>@gdha, @rmetrich<br />
Are you missing <em>/usr/lib/grub/x86_64-efi/multiboot.mod</em> as well on
your Fedora 29 ?</p>
<p>V.</p>
<h4 id="rmetrich_commented_at_2018-12-12_0824"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446502109">2018-12-12 08:24</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-12-12_0824" title="Permanent link">&para;</a></h4>
<p>I would propose to keep the actual list of modules and modify that as a
for loop and include available ones. All we need to find out is the
directory computation (/usr/lib/grub/$(uname -r)-efi) on Fedora,
different on SuSE ...)</p>
<h4 id="gdha_commented_at_2018-12-12_0945"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446525850">2018-12-12 09:45</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-12_0945" title="Permanent link">&para;</a></h4>
<p>@gozora @rmetrich I have no UEFI system anymore, so I cannot fully test
it out. However, I like the idea mentioned by
<a href="https://github.com/rear/rear/pull/2001#issuecomment-446502109">https://github.com/rear/rear/pull/2001#issuecomment-446502109</a></p>
<h4 id="jsmeix_commented_at_2018-12-12_0950"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446527185">2018-12-12 09:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-12_0950" title="Permanent link">&para;</a></h4>
<p>@rmetrich @gozora<br />
could you post where GRUB modules are located<br />
on your various systems that you currently can access<br />
like I did in<br />
<a href="https://github.com/rear/rear/issues/1996#issuecomment-446246942">https://github.com/rear/rear/issues/1996#issuecomment-446246942</a></p>
<p>@gozora<br />
regarding the GRUB modules directory e.g.
/usr/lib/grub2/x86_64-efi/linuxefi.mod<br />
versus /boot/grub2/x86_64-efi/linuxefi.mod see my question in<br />
<a href="https://github.com/rear/rear/issues/1996#issuecomment-446246942">https://github.com/rear/rear/issues/1996#issuecomment-446246942</a></p>
<p>If the GRUB modules that are actually used by GRUB when booting<br />
are in general somewhere under the /boot/ directory it is probably<br />
much simpler to search for them only in /boot/ by something like</p>
<pre><code>grub_modules=""
for grub_module in part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs ; do
    test "$( find /boot -type f -name "$grub_module.mod" )" &amp;&amp; grub_modules="$grub_modules $grub_module"
done
...
$gmkimage $v -O x86_64-efi -c $TMP_DIR/mnt/EFI/BOOT/embedded_grub.cfg -o $TMP_DIR/mnt/EFI/BOOT/BOOTX64.efi -p "/EFI/BOOT" "$grub_modules"
</code></pre>
<h4 id="rmetrich_commented_at_2018-12-12_1004"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446531360">2018-12-12 10:04</a>:<a class="headerlink" href="#rmetrich_commented_at_2018-12-12_1004" title="Permanent link">&para;</a></h4>
<p>Fedora and RHEL (7, 8) have them in <code>/usr/lib/grub/$(uname -p)-efi/</code></p>
<h4 id="jsmeix_commented_at_2018-12-12_1019"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446536035">2018-12-12 10:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-12_1019" title="Permanent link">&para;</a></h4>
<p>When on Fedora and RHEL (7, 8)<br />
there are no GRUB modules below /boot/<br />
but only below /usr/lib/grub*/ then something like</p>
<pre><code>    test "$( find /boot /usr/lib/grub* -type f -name "$grub_module.mod" 2&gt;/dev/null )" &amp;&amp; ...
</code></pre>
<p>should find them both on SUSE and Red Hat systems.</p>
<h4 id="jsmeix_commented_at_2018-12-12_1036"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446541072">2018-12-12 10:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-12_1036" title="Permanent link">&para;</a></h4>
<p>FYI regarding "what this Grub linuxefi module is":</p>
<p>Sleeping over things always helps :-)</p>
<p>I remember now that I had asked our GRUB maintainer<br />
about <code>linuxefi</code> some time ago and here excerpts<br />
from my mail and his reply:</p>
<pre><code>Date: Wed, 8 Jun 2016 19:02:31 +0800
Subject: Re: Is linuxefi in grub2 a SUSE specific thing?

&gt; I am wondering if 'linuxefi' (and 'initrdefi')
&gt; in our grub2 RPM is a SUSE specific thing?

NO. It's a UEFI Secure Boot specfic thing.

&gt; I am wondering if loading the kernel
&gt; and initrd in grub.cfg via
&gt; ---------------------------------------------------------
&gt; menuentry ...
&gt;     linuxefi /boot/vmlinuz...
&gt;     initrdefi /boot/initrd...
&gt; ---------------------------------------------------------
&gt; is a SUSE specific way how to configure GRUB2
&gt; to boot on (U)EFI systems?

We have to support UEFI Secure Boot
so we have to use linuxefi as it implemented
the need verification mechanism via
shim-lock protocol to loaded the grub2 image ..

Moreover it leverages the kernel UEFI handover
protcol to boot the kernel via its own efistub and
beneficial from kernel bug fixing for firmware issues. ..

&gt; According to your grub2 RPM changelog entry
&gt; ---------------------------------------------------------------
&gt; * Mon Nov 26 2012 mchang@suse.com
&gt; - ship a Secure Boot UEFI compatible bootloader (fate#314485)
&gt; - added secureboot patches which introduces new linuxefi module
&gt;   that is able to perform verifying signed images via exported
&gt;   protocol from shim.
&gt;   ...
&gt;   - grub2-secureboot-add-linuxefi.patch
&gt; ---------------------------------------------------------------
&gt; it seems linuxefi in grub2 is a SUSE specific thing
&gt; that is not in upstream GRUB2.

It's not upstreamed for various reasons .. Although
down-stream distros like SUSE and RedHat already
used that for a while, upstream is still have problem
accepting it ..

&gt; Background information:
&gt; 
&gt; The reason why I am interested in 'linuxefi' and 'initrdefi'
&gt; is that the Relax-and-Recover (rear) recovery system also
&gt; needs to boot on (U)EFI systems and to do that the
&gt; bootloader of the rear recovery system needs to
&gt; be configured appropriately.
&gt; When grub2 in SUSE needs specific configuration that
&gt; is different compared to upstream GRUB2, then I must
&gt; adapt rear to create its recovery system different
&gt; on SUSE systems.

Please consider it a standard to boot
in UEFI Secure Boot for now, until someone
could convince upstream to include it,
there no other grub command could be used
for now in UEFI Secure Boot as Microsoft only
recongize linuxefi as a they audit the code
to issue their certifcates for shim loader ...
</code></pre>
<p>Hmmm... somehow this looks very similar to<br />
<a href="https://github.com/rear/rear/issues/866#issuecomment-224569648">https://github.com/rear/rear/issues/866#issuecomment-224569648</a><br />
;-))</p>
<h4 id="gdha_commented_at_2018-12-12_1037"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446541365">2018-12-12 10:37</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-12_1037" title="Permanent link">&para;</a></h4>
<p>@jsmeix on my fedora29 (bios with efi tools present) I get:</p>
<pre><code># grub_modules=""
# for grub_module in part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs ; do
    test "$( find /boot -type f -name "$grub_module.mod" )" &amp;&amp; grub_modules="$grub_modules $grub_module"
done
# echo $grub_modules
part_gpt part_msdos fat ext2 normal chain boot configfile linux multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio reboot search test echo btrfs
</code></pre>
<h4 id="gozora_commented_at_2018-12-12_1636"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446653900">2018-12-12 16:36</a>:<a class="headerlink" href="#gozora_commented_at_2018-12-12_1636" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>When on Fedora and RHEL (7, 8)<br />
there are no GRUB modules below /boot/<br />
but only below /usr/lib/grub*/ then something like</p>
<pre><code>test "$( find /boot /usr/lib/grub* -type f -name "$grub_module.mod" 2&gt;/dev/null )" &amp;&amp; ...
</code></pre>
<p>should find them both on SUSE and Red Hat systems.</p>
</blockquote>
<p>There is yet another complication. On Fedora 29, it looks like
<em>multiboot</em> module is available for Legacy boot but not for UEFI boot:</p>
<pre><code>[root@fedora29 grub]# pwd
/usr/lib/grub
[root@fedora29 grub]# ll
total 32
drwxr-xr-x.  4 root root    39 Dec 11 17:31 .
dr-xr-xr-x. 33 root root  4096 Dec 11 17:16 ..
drwxr-xr-x.  2 root root 12288 Dec 11 17:15 i386-pc
drwxr-xr-x.  2 root root  8192 Dec 11 17:31 x86_64-efi
[root@fedora29 grub]# find . -name "multiboot*"
./i386-pc/multiboot.mod
./i386-pc/multiboot2.mod
</code></pre>
<p>Should user have (for whatever reason) installed Legacy boot modules
next to UEFI modules, output would give false positive for presence of
(at least) <em>multiboot</em> module:</p>
<pre><code># for grub_module in part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs ; do
&gt;     test "$( find /boot /usr/lib/grub* -type f -name "$grub_module.mod" 2&gt;/dev/null )" &amp;&amp; grub_modules="$grub_modules $grub_module"
&gt; done
# echo $grub_modules
part_gpt part_msdos fat ext2 normal chain boot configfile linux multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs
</code></pre>
<p>Notice <em>multiboot</em> module presence, despite it is not available in
x86_64-efi.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2018-12-12_1651"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446659273">2018-12-12 16:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-12_1651" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/2001#issuecomment-446541365">https://github.com/rear/rear/pull/2001#issuecomment-446541365</a><br />
from @gdha indicates that on "fedora29" GRUB modules exist in /boot/<br />
so that we would not need to search also elsewhere (like in
/usr/lib/grub*)<br />
but it contradicts what @rmetrich wrote in<br />
<a href="https://github.com/rear/rear/pull/2001#issuecomment-446531360">https://github.com/rear/rear/pull/2001#issuecomment-446531360</a><br />
which idicates GRUB modules do not exist in /boot/ on "Fedora and RHEL
(7, 8)".</p>
<p>And there is still my question from<br />
<a href="https://github.com/rear/rear/issues/1996#issuecomment-446246942">https://github.com/rear/rear/issues/1996#issuecomment-446246942</a><br />
where I wonder if the GRUB modules that are actually used when booting<br />
must be under /boot/ and not elsewhere (like in /usr/lib/grub*).<br />
But I don't know how GRUB finds its modules when booting.<br />
I would like to search in ReaR for GRUB modules at the same place(s)<br />
where GRUB will look for its modules when booting.</p>
<h4 id="jsmeix_commented_at_2018-12-12_1701"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2001#issuecomment-446663126">2018-12-12 17:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-12_1701" title="Permanent link">&para;</a></h4>
<p>Because we are here in the function build_bootx86_efi<br />
we know we are in the UEFI case here so that we could<br />
restrict where to search for GRUB modules<br />
e.g. as a quick and dirty hack additionally check<br />
that what was found contains 'efi' (ignore case) like</p>
<pre><code>grub_modules=""
for grub_module in part_gpt qqq part_msdos QQQ fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo qqq btrfs ; do
    test "$( find /boot -type f -name "$grub_module.mod" 2&gt;/dev/null | grep -i efi )" &amp;&amp; grub_modules="$grub_modules $grub_module"
done
</code></pre>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-12-10.2001.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
