<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2424 Issue closed: Missing disk entry in disklayout.conf leads to gpt disks beeing initialized as msdos - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2424 Issue closed: Missing disk entry in disklayout.conf leads to gpt disks beeing initialized as msdos";
        var mkdocs_page_input_path = "issues/2020-06-10.2424.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2424 Issue closed: Missing disk entry in disklayout.conf leads to gpt disks beeing initialized as msdos</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2424_issue_closed_missing_disk_entry_in_disklayoutconf_leads_to_gpt_disks_beeing_initialized_as_msdos"><a href="https://github.com/rear/rear/issues/2424">#2424 Issue</a> <code>closed</code>: Missing disk entry in disklayout.conf leads to gpt disks beeing initialized as msdos<a class="headerlink" href="#2424_issue_closed_missing_disk_entry_in_disklayoutconf_leads_to_gpt_disks_beeing_initialized_as_msdos" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="abbbi_opened_issue_at_2020-06-10_1714"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> opened issue at <a href="https://github.com/rear/rear/issues/2424">2020-06-10 17:14</a>:<a class="headerlink" href="#abbbi_opened_issue_at_2020-06-10_1714" title="Permanent link">&para;</a></h4>
<p>Rear 2.5 running on SLES12 SP4</p>
<p>Today i have come accross following Situation, which i would like to
discuss, as the recovery<br />
worked with workarounds, im quite interested wether if this is a bug or
a mis-configuration.</p>
<ol>
<li>SLES12 SP4, operating system uses Multipath SAN attached disks
    (without LVM)</li>
<li>Some LVM volumes exist, but only one volume group and the local
    discs should be<br />
    recovered.</li>
</ol>
<p>The following configuration was used:</p>
<pre><code>AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
ONLY_INCLUDE_VG=( 'included_vg') 
REAR_INITRD_COMPRESSION="lzma"
</code></pre>
<p>The OS disks consist of one disk (/dev/mapper/OS) with two partitions.
One partition is<br />
the Root volume (btrfs), the other one is the EFI partition.</p>
<p>During mklayout it is to be seen, that this disk's volume should be part
of the recovery:</p>
<pre><code>2020-06-09 19:00:48.558006452 Saving filesystem layout (using the findmnt command).
2020-06-09 19:00:48.578050243 Processing filesystem 'vfat' on '/dev/mapper/OS-part1' mounted at '/boot/efi'
2020-06-09 19:00:48.639323912 Processing filesystem 'btrfs' on '/dev/mapper/OS-part2' mounted at '/'
</code></pre>
<p>The resulting disklayout.conf howerver, includes only "part" statement
for that disk, not any "disk" statement, just another multipath one,
which does not include any information about initialization type to be
used:</p>
<pre><code>multipath /dev/mapper/OS 107374182400 /dev/sda,/dev/sdam,/dev/sdbf,/dev/sdt
part /dev/mapper/OS 251658240 16777216 primary boot /dev/mapper/OS-part1
part /dev/mapper/OS 107105730048 268435456 primary none /dev/mapper/OS-part2
</code></pre>
<p>That leads to a situation, where the disk layout restore, does
initialize the disk allways<br />
with msdos as default partition table! As there is no disk entry in the
disklayout.conf, the<br />
code in in 100_include_partition_code.sh allways uses msdos in case
of primary partitions:</p>
<pre><code>    while read part disk size pstart name junk ; do
        names=( "${names[@]}" $name )
        case $name in
            (primary|extended|logical)
                if [[ -z "$label" ]] ; then
                    Log "Disk label for $device detected as msdos."
                    label="msdos"
                fi
                ;;
        esac
    done &lt; &lt;( grep "^part $device " "$LAYOUT_FILE" )
</code></pre>
<p>Now, this becomes a problem if GPT is really required and for example
secureboot is used. The recovered system does simply not boot as grub is
unable to access the EFI directory due the OS disk beeing MBR instead of
GPT.</p>
<p>Now my question is: how come that there is a missing disk entry in
disklayout.conf (due to multipath?) or is the existing code during
recovery at fault here?</p>
<p>The workaround was to add the following line at the top of the
disklayout.conf:</p>
<p><code>disk /dev/mapper/OS 107374182400 gpt</code></p>
<p>before running "rear recover", which worked flawlessly then.</p>
<h4 id="jsmeix_commented_at_2020-06-15_0802"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2424#issuecomment-643970336">2020-06-15 08:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-15_0802" title="Permanent link">&para;</a></h4>
<p>As far as I see from the description this issue here is a duplicate of<br />
<a href="https://github.com/rear/rear/issues/2234">https://github.com/rear/rear/issues/2234</a><br />
that is fixed in current ReaR GitHub master code via<br />
<a href="https://github.com/rear/rear/pull/2235">https://github.com/rear/rear/pull/2235</a></p>
<p>Additionally there was<br />
<a href="https://github.com/rear/rear/issues/2236">https://github.com/rear/rear/issues/2236</a><br />
that is fixed in current ReaR GitHub master code via<br />
<a href="https://github.com/rear/rear/pull/2237">https://github.com/rear/rear/pull/2237</a></p>
<p>@abbbi<br />
please verify that things also work for you<br />
with current ReaR GitHub master code<br />
as described in the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>We need your verification rather soon because<br />
we will release the next ReaR 2.6 soon, cf.<br />
<a href="https://github.com/rear/rear/issues/2368">https://github.com/rear/rear/issues/2368</a><br />
and I would like to be sure that the above fixes<br />
(which worked for us at SUSE and for our customer)<br />
also work in your particular case.</p>
<h4 id="abbbi_commented_at_2020-06-15_0850"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2424#issuecomment-643994835">2020-06-15 08:50</a>:<a class="headerlink" href="#abbbi_commented_at_2020-06-15_0850" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Thanks for your quick reply! I will try to test things this week, if i
get access to the systems i spotted this issue and will report back!</p>
<h4 id="abbbi_commented_at_2020-06-15_1757"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2424#issuecomment-644281968">2020-06-15 17:57</a>:<a class="headerlink" href="#abbbi_commented_at_2020-06-15_1757" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I may not be able to test on the real system as it requires downtime to
be scheduled, i however patched version 2.5 with both of the commits you
mentioned and tested with an Qemu vm, simulating multipath by attaching
multiple disks with the same UUID, and it worked flawlessly!<br />
So i think this issue is fixed with the commits you mentioned.</p>
<p>The patch also addresses following issue which i was not able to
reproduce using 2.5 and the patcheset:</p>
<p><a href="https://github.com/rear/rear/issues/2319">https://github.com/rear/rear/issues/2319</a></p>
<h4 id="jsmeix_commented_at_2020-06-16_0749"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2424#issuecomment-644596214">2020-06-16 07:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-16_0749" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
thank you so much for your inventive extempore test<br />
and your prompt feedback!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-06-10.2424.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
