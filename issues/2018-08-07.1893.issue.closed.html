<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2018 08 07.1893.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2018 08 07.1893.issue.closed";
        var mkdocs_page_input_path = "issues/2018-08-07.1893.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2018 08 07.1893.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1893_issue_closed_recovery_system_setup_script_67-check-by-label-cdromsh_functionality_needs_to_be_overhauled"><a href="https://github.com/rear/rear/issues/1893">#1893 Issue</a> <code>closed</code>: recovery system setup script 67-check-by-label-cdrom.sh functionality needs to be overhauled<a class="headerlink" href="#1893_issue_closed_recovery_system_setup_script_67-check-by-label-cdromsh_functionality_needs_to_be_overhauled" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2018-08-07_1130"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/1893">2018-08-07 11:30</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2018-08-07_1130" title="Permanent link">&para;</a></h4>
<p>The current<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/67-check-by-label-cdrom.sh<br />
works mostly by chance and not sufficiently fail save.</p>
<p>It blindly links /dev/cdrom or /dev/sr0 to
/dev/disk/by-label/RELAXRECOVER<br />
regardless what /dev/cdrom or /dev/sr0 actually is,<br />
perhaps the RELAXRECOVER labeled ISO image is attached to /dev/sr1?</p>
<p>And there is no proper error handling.<br />
If things fail it just proceeds.<br />
At least some meaningful error message should be shown to the user<br />
so that he is aware when no RELAXRECOVER labeled thingy exists.</p>
<p>For an example see<br />
<a href="https://github.com/rear/rear/issues/1891#issuecomment-411017183">https://github.com/rear/rear/issues/1891#issuecomment-411017183</a></p>
<p>Since
<a href="https://github.com/rear/rear/pull/1885">https://github.com/rear/rear/pull/1885</a>
is merged<br />
together with blockdev also lsblk gets included in the recovery system<br />
(if it exists on the original system) so that now lsblk can be used by
default to<br />
determine disk values and the block device structure in the recovery
system.</p>
<p>This can be used to enhance 67-check-by-label-cdrom.sh to find out<br />
what kernel device nodes match RELAXRECOVER labeled thingies<br />
or CDROM devices in general.</p>
<p>For example in my recovery system<br />
on a KVM machine with two virtual IDE CDROM drives as in<br />
<a href="https://github.com/rear/rear/pull/1885#issuecomment-410697398">https://github.com/rear/rear/pull/1885#issuecomment-410697398</a><br />
I get</p>
<pre>
RESCUE f144:~ # lsblk -i -d -o KNAME,TYPE,FSTYPE,LABEL
KNAME TYPE FSTYPE  LABEL
sda   disk         
sdb   disk         
sr0   rom  iso9660 RELAXRECOVER
sr1   rom          
</pre>

<p>so that from this info /dev/sr0 is the right kernel device node that
should be linked<br />
to /dev/disk/by-label/RELAXRECOVER if such a link does not yet exist.</p>
<h4 id="schabrolles_commented_at_2018-08-07_1209"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-411034001">2018-08-07 12:09</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-08-07_1209" title="Permanent link">&para;</a></h4>
<p>@jsmeix, we can also use <code>blkid -L &lt;label&gt;</code> for that purpose. It returns
the device associated with this label. Here is an example on one of my
system:</p>
<pre><code># blkid -L RELAXRECOVER
/dev/sr0
</code></pre>
<h4 id="jsmeix_commented_at_2018-08-07_1230"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-411039190">2018-08-07 12:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-07_1230" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
thanks for the more straightforward way to get it!</p>
<p>Unfortunately I had read the blkid man page that reads on my SLES12
system<br />
with <code>blkid from util-linux 2.29.2  (libblkid 2.29.2, 22-Feb-2017)</code>:</p>
<pre>
It is recommended to use lsblk(8) command to get
information about block devices rather than blkid.
lsblk(8) provides more information, better control
on output formatting and it does not require root
permissions to get actual information.
</pre>

<p>;-)</p>
<h4 id="jsmeix_commented_at_2018-08-09_0912"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-411692041">2018-08-09 09:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-09_0912" title="Permanent link">&para;</a></h4>
<p>As always sleeping over it helped:</p>
<p>Meanwhile I think the following:</p>
<p><a href="https://github.com/rear/rear/issues/1891">https://github.com/rear/rear/issues/1891</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/326">https://github.com/rear/rear/issues/326</a><br />
are exactly the same issue because in both cases the root cause is
that<br />
the /dev/disk/by-label/ directory is empty (or does not exist).</p>
<p>The only place where /dev/disk/by-label/$ISO_VOLID is actually needed<br />
is by the mount_url function in
usr/share/rear/lib/global-functions.sh<br />
when the URL scheme is 'iso' so that the only place where things can go
wrong<br />
is when the mount_url function is called with URL scheme 'iso'.</p>
<p>Accordingly it is not needed to try to ensure in a recovery system setup
script<br />
that a symlink /dev/disk/by-label/$ISO_VOLID exists that points to a
block device<br />
where a $ISO_VOLID labeled thingy is attached to (that thingy is the
ReaR ISO).</p>
<p>The actually right place where to deal with this issue is the mount_url
function<br />
when it is called with URL scheme 'iso'.</p>
<p>One advantage is that I do no longer need to test in the system setup
script<br />
the conditions when such a symlink is actually needed to avoid<br />
to show probably confusing 'false alarm' messages to the user.</p>
<p>Another advantage to deal with the issue where it actually causes an
error is<br />
that when the mount_url function is called we are inside the running
'rear recover'<br />
where we have the full set of ReaR variables available plus the
UserInput function<br />
and the rear shell so that when the needed symlink is not there<br />
we can do a user dialog where the user can choose the right block
device<br />
or where the user can run the rear shell within the running 'rear
recover'<br />
to set up the needed symlink as he likes.</p>
<p>Accordingly I will move the basic code of the recovery system setup<br />
script 67-check-by-label-cdrom.sh into the mount_url function 'iso'
case<br />
plus additional enhancements there with a user dialog if things are not
o.k.<br />
and remove the recovery system setup script 67-check-by-label-cdrom.sh</p>
<p>This way I can also avoid the current awkward ways how to show<br />
messages to the user from a running system setup script:<br />
I would have to add sleep delays so that the user can actually read
the<br />
messages before they go away when all system setup scripts had finished.</p>
<p>Furthermore messages from a system setup script won't help much<br />
because the user can do nothing at this point because the<br />
system setup scripts cannot be easily interrupted:<br />
User dialogs in system setup scripts are awkward compared to<br />
user dialogs while a 'rear $WORKFLOW' runs because in the latter case<br />
we have the UserInput function that cannot be sourced by system setup
scripts<br />
because the current lib/_input-output-functions.sh does also some<br />
very basic 'rear $WORKFLOW' setup like ExitTask setup and<br />
STDIN STDOUT STDERR redirection which is a known mess<br />
that would need to be cleaned up (like many other things in ReaR)<br />
but I find no time for things like
<a href="https://github.com/rear/rear/issues/1251">https://github.com/rear/rear/issues/1251</a></p>
<h4 id="jsmeix_commented_at_2018-08-09_1406"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-411769978">2018-08-09 14:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-09_1406" title="Permanent link">&para;</a></h4>
<p>With my commit<br />
<a href="https://github.com/jsmeix/rear/commit/0c47fab08bff67994d1ff9335122fe71cf118745">https://github.com/jsmeix/rear/commit/0c47fab08bff67994d1ff9335122fe71cf118745</a><br />
I implemented
<a href="https://github.com/rear/rear/issues/1893#issuecomment-411692041">https://github.com/rear/rear/issues/1893#issuecomment-411692041</a><br />
and as far as I tested it things behave now much better for me than ever
before, see<br />
<a href="https://github.com/rear/rear/pull/1894#issuecomment-411766357">https://github.com/rear/rear/pull/1894#issuecomment-411766357</a></p>
<h4 id="jsmeix_commented_at_2018-08-09_1409"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-411771035">2018-08-09 14:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-09_1409" title="Permanent link">&para;</a></h4>
<p>I will sleep once more over it<br />
and if nothing "appears" over night<br />
I would like to merge it tomorrow<br />
so that also @dewagner1 and @suseusr168 could test it.</p>
<h4 id="jsmeix_commented_at_2018-08-10_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1893#issuecomment-412047821">2018-08-10 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-10_1047" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1894">https://github.com/rear/rear/pull/1894</a>
merged<br />
this issue should be fixed.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-08-07.1893.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
