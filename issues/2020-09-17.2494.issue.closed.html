<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2494 Issue closed: Discussion: What Is The Right Way Of Error Checking in ReaR? - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2494 Issue closed: Discussion: What Is The Right Way Of Error Checking in ReaR?";
        var mkdocs_page_input_path = "issues/2020-09-17.2494.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2494 Issue closed: Discussion: What Is The Right Way Of Error Checking in ReaR?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2494_issue_closed_discussion_what_is_the_right_way_of_error_checking_in_rear"><a href="https://github.com/rear/rear/issues/2494">#2494 Issue</a> <code>closed</code>: Discussion: What Is The Right Way Of Error Checking in ReaR?<a class="headerlink" href="#2494_issue_closed_discussion_what_is_the_right_way_of_error_checking_in_rear" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>discuss / RFC</code>, <code>no-issue-activity</code></p>
<h4 id="olivero2_opened_issue_at_2020-09-17_1229"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> opened issue at <a href="https://github.com/rear/rear/issues/2494">2020-09-17 12:29</a>:<a class="headerlink" href="#olivero2_opened_issue_at_2020-09-17_1229" title="Permanent link">&para;</a></h4>
<p>It all started with some seemingly innocent argument checking in <a href="https://github.com/rear/rear/issues/2475#issuecomment-671361418">an
issue comment's
code</a>:</p>
<pre><code>function opal_device_partprobe() {
    local device="${1:?}"

    [...]
}
</code></pre>
<p>Which prompted <a href="https://github.com/rear/rear/issues/2475#issuecomment-671376837">the
observation</a></p>
<blockquote>
<p>this leads to an unfriendly exit without any error message when VAR is
null or unset.</p>
</blockquote>
<h4 id="example_1_parameter_checks">Example 1: Parameter Checks<a class="headerlink" href="#example_1_parameter_checks" title="Permanent link">&para;</a></h4>
<p>Store this code as <code>usr/share/rear/prep/default/000_test.sh</code>:</p>
<pre><code>function opal_device_partprobe() {
    local device="${1:?}"

    partprobe "$device"
}

opal_device_partprobe  # missing parameter
</code></pre>
<p>Running <code>sudo usr/sbin/rear mkrescue</code> prints:</p>
<pre><code>rear mkrescue failed, check [...].log for details
</code></pre>
<p>The relevant log excerpt is (timestamps omitted):</p>
<pre><code>Including prep/default/000_test.sh
[...]/usr/share/rear/prep/default/000_test.sh: line 2: 1: parameter null or not set
Exiting rear mkrescue (PID 241592) and its descendant processes ...
</code></pre>
<h4 id="example_2_extensive_checks">Example 2: Extensive Checks<a class="headerlink" href="#example_2_extensive_checks" title="Permanent link">&para;</a></h4>
<pre><code>function opal_device_partprobe() {
    local device="$1"
    test -b "$device" -o -c "$device" || BugError "opal_device_partprobe called for '$device' that is neither a block nor a character device"

    partprobe "$device"
}

opal_device_partprobe  # missing parameter
</code></pre>
<p>Running <code>sudo usr/sbin/rear mkrescue</code> prints:</p>
<pre><code>ERROR:
====================
BUG in [...]/usr/share/rear/prep/default/000_test.sh line 3:
'opal_device_partprobe called for '' that is neither a block nor a character device'
--------------------
Please report this issue at https://github.com/rear/rear/issues
and include the relevant parts from [...].log
preferably with full debug information via 'rear -D mkrescue'
====================
Some latest log messages since the last called script 000_test.sh:
  2020-09-17 13:21:23.386054312 Including prep/default/000_test.sh
Aborting due to an error, check [...].log for details
Terminated
</code></pre>
<p>The relevant log excerpt is (timestamps omitted):</p>
<pre><code>Including prep/default/000_test.sh
ERROR:
====================
BUG in [...]/usr/share/rear/prep/default/000_test.sh line 3:
'opal_device_partprobe called for '' that is neither a block nor a character device'
--------------------
Please report this issue at https://github.com/rear/rear/issues
and include the relevant parts from [...].log
preferably with full debug information via 'rear -D mkrescue'
====================
===== Stack trace =====
Trace 0: usr/sbin/rear:555 main
Trace 1: [...]/usr/share/rear/lib/mkrescue-workflow.sh:12 WORKFLOW_mkrescue
Trace 2: [...]/usr/share/rear/lib/framework-functions.sh:124 SourceStage
Trace 3: [...]/usr/share/rear/lib/framework-functions.sh:56 Source
Trace 4: [...]/usr/share/rear/prep/default/000_test.sh:8 source
Trace 5: [...]/usr/share/rear/prep/default/000_test.sh:3 opal_device_partprobe
Trace 6: [...]/usr/share/rear/lib/_input-output-functions.sh:701 BugError
=== End stack trace ===
Exiting rear mkrescue (PID 242203) and its descendant processes ...
</code></pre>
<h3 id="arguments">Arguments<a class="headerlink" href="#arguments" title="Permanent link">&para;</a></h3>
<p>(I hope this is representative of the original discussion.)</p>
<h4 id="in_favor_of_some_checks">In Favor Of Some Checks<a class="headerlink" href="#in_favor_of_some_checks" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Not checking at all (like most code in ReaR) would let ReaR either
continue with undesirable results or trigger a follow-up error later
on which is probably harder to diagnose.</p>
</blockquote>
<h4 id="against_extensive_checks">Against Extensive Checks<a class="headerlink" href="#against_extensive_checks" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Putting in explicit error-checking code everywhere (like
<code>[[ -z "$foo" ]] || BugError "foo: parameter null or not set" ]]</code>)
distracts from the primary functionality and makes the code harder to
read.</p>
</blockquote>
<h4 id="in_favor_of_extensive_checks">In Favor Of Extensive Checks<a class="headerlink" href="#in_favor_of_extensive_checks" title="Permanent link">&para;</a></h4>
<blockquote>
<p>The problem for the user is that he does not get the error message on
his terminal.<br />
Let him search the actual error message from the log is not user
friendly.<br />
He needs at least some message about what went wrong on his
terminal.<br />
Then he can search the log for more details related to that message.</p>
<p>[Parameter checks only] would not catch if opal_device_partprobe
/etc/fstab was called.</p>
</blockquote>
<h3 id="to_be_discussed">To Be Discussed<a class="headerlink" href="#to_be_discussed" title="Permanent link">&para;</a></h3>
<p>In principle, we can always insert more checks in ReaR code and rely
less on checks elsewhere. It is apparent that such checks can make the
user's life easier:</p>
<ul>
<li>In the above case, <code>partprobe</code> does almost no error checking on its
    own: It does not complain when called without arguments or with a
    regular file argument.</li>
</ul>
<p>On the other hand, more checking means more code. Checks themselves can
contain bugs. More code must be read when contributing to ReaR.
Comparing the code within the function body (ignoring leading spaces):</p>
<ul>
<li>Example 1: 43 characters</li>
<li>Example 2: 177 characters (4.1 times as much)</li>
</ul>
<p>So what might be the right amount of error checking in ReaR? Can we even
figure out useful guidelines?</p>
<h4 id="jsmeix_commented_at_2020-09-17_1314"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2494#issuecomment-694224299">2020-09-17 13:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-09-17_1314" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for your explanatory description of the issue<br />
which helps so much to discuss such things in a constructive way!</p>
<p>I dared to change the subject from</p>
<pre><code>What Is The Right Amount Of Error Checking in ReaR?
</code></pre>
<p>to</p>
<pre><code>What Is The Right Way Of Error Checking in ReaR?
</code></pre>
<p>because I think it is not only about the <code>Amount</code><br />
but more generally about what the best <code>Way</code> is.</p>
<h4 id="jsmeix_commented_at_2020-09-17_1333"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2494#issuecomment-694237487">2020-09-17 13:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-09-17_1333" title="Permanent link">&para;</a></h4>
<p>See my reasoning in<br />
<a href="https://github.com/rear/rear/issues/2475#issuecomment-671871423">https://github.com/rear/rear/issues/2475#issuecomment-671871423</a><br />
why I am in favor of <strong>explicit</strong> checks.</p>
<p>I am not in favor of extensive (i.e. a high amount of) checks.</p>
<p>Therefore I think the example like</p>
<pre><code>[[ -z "$device" ]] || BugError "device: parameter null or not set"
</code></pre>
<p>is - although better than <code>local device="${1:?}"</code> - not what I mean with
an explicit check.</p>
<p>In contrast I think</p>
<pre><code>test -b "$device" -o -c "$device" || BugError "opal_device_partprobe called for '$device' that is neither a block nor a character device"
</code></pre>
<p>is an explicit check.<br />
In particular it makes it obvious for a code reader what
<code>opal_device_partprobe</code> is about<br />
because the error message provides explicit information in particular
for a code reader.</p>
<p>In the end I am in favor of explicit checks because of what I described
in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="jsmeix_commented_at_2020-09-17_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2494#issuecomment-694239025">2020-09-17 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-09-17_1335" title="Permanent link">&para;</a></h4>
<p>So now I stay silent at least until next Monday<br />
to give the other @rear/contributors some time<br />
to share their thougths here.</p>
<h4 id="gdha_commented_at_2020-09-18_0646"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2494#issuecomment-694689210">2020-09-18 06:46</a>:<a class="headerlink" href="#gdha_commented_at_2020-09-18_0646" title="Permanent link">&para;</a></h4>
<p>I'm in favor for explicit check for disk devices and creation of
partition and file systems. Other kind of errors can also always be
found back in the log file, which should be a wise thing to do check
each time - will try to explicit mention this in the <a href="https://relax-and-recover.org/rear-user-guide/">ReaR User
Guide</a> (in progress)</p>
<h4 id="github-actions_commented_at_2020-11-18_0137"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2494#issuecomment-729319900">2020-11-18 01:37</a>:<a class="headerlink" href="#github-actions_commented_at_2020-11-18_0137" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-09-17.2494.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
