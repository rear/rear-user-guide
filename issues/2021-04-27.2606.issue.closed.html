<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2021 04 27.2606.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2021 04 27.2606.issue.closed";
        var mkdocs_page_input_path = "issues/2021-04-27.2606.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2021 04 27.2606.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2606_issue_closed_remote_unlock_sed_via_pba"><a href="https://github.com/rear/rear/issues/2606">#2606 Issue</a> <code>closed</code>: Remote unlock SED via PBA<a class="headerlink" href="#2606_issue_closed_remote_unlock_sed_via_pba" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="jip-hop_opened_issue_at_2021-04-27_1930"><img src="https://avatars.githubusercontent.com/u/2871973?v=4" width="50"><a href="https://github.com/Jip-Hop">Jip-Hop</a> opened issue at <a href="https://github.com/rear/rear/issues/2606">2021-04-27 19:30</a>:<a class="headerlink" href="#jip-hop_opened_issue_at_2021-04-27_1930" title="Permanent link">&para;</a></h4>
<p>In addition tot the current unlock feature, I'd like to be able to
unlock the SED over the network via the PBA in case I don't have a
keyboard (and monitor) attached to my home server. This would also allow
me to unlock the SED and boot the server if I'm not at home if I use a
VPN.</p>
<p>For this reason I'm trying to re-enable networking in the PBA. I've set
these to yes:</p>
<p><a href="https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/prep/OPALPBA/Linux-i386/001_configure_workflow.sh#L28-L31">https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/prep/OPALPBA/Linux-i386/001_configure_workflow.sh#L28-L31</a></p>
<p>And commented this line:<br />
<a href="https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L20">https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L20</a></p>
<p>When I boot from the PBA I drop to an emergency shell but I'm unable to
ping anything. If I check ifconfig then there's only the lo network (no
eth). What are the additional steps I should take to re-enable
networking in the PBA?</p>
<p>If I can re-enable networking I'd try to remotely unlock using SSH. But
ultimately I'd make a small HTTPS server with Python which would ask for
the password and call sedutil-cli to unlock the disk.</p>
<h4 id="olivero2_commented_at_2021-04-27_2020"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-827903398">2021-04-27 20:20</a>:<a class="headerlink" href="#olivero2_commented_at_2021-04-27_2020" title="Permanent link">&para;</a></h4>
<p>For a (hopefully) complete list of files making PBA support possible,
use:</p>
<pre><code>find usr -iname \*opal\* -exec find '{}' -print \;
</code></pre>
<p>You might want to look at
<code>usr/share/rear/skel/default/etc/scripts/unlock-opal-disks</code> which
choreographs the final PBA boot stage and deals with final
initialization, password entry and unlocking. It is called via
<code>usr/share/rear/skel/OPALPBA/etc/inittab</code> or
<code>usr/share/rear/skel/default/usr/lib/systemd/system/sysinit-opalpba.service</code>
(depending on whether you are using <code>init</code> or <code>systemd</code>).</p>
<p>In the PBA, networking, <code>sshd</code> and stuff are intentionally left out to
keep it small, simple and secure. Python is generally not available on a
rescue system or PBA. Keep in mind the size limit for a PBA.</p>
<p>Note that all of this is well beyond scope for the current PBA
implementation, so you're pretty much on open waters. Currently, remote
unlocking requires firmware-level remote control capabilities (e.g. via
IPMI oder AMT). Hope this helps anyway. Good luck!</p>
<h4 id="jip-hop_commented_at_2021-04-28_0646"><img src="https://avatars.githubusercontent.com/u/2871973?v=4" width="50"><a href="https://github.com/Jip-Hop">Jip-Hop</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-828192082">2021-04-28 06:46</a>:<a class="headerlink" href="#jip-hop_commented_at_2021-04-28_0646" title="Permanent link">&para;</a></h4>
<p>Thanks for replying so quickly :)</p>
<p>My home server doesn't have IPMI and I'd prefer not to add it just for
unlocking the PBA since it would constantly consume power.</p>
<p>I manually made a PBA image containing everything I need (including
sedutil-cli, Python and networking) based on Tiny Core Linux. I still
had room to spare, so I'm not worried about the PBA size limit.</p>
<p>I understand why networking is currently not available in the PBA image.
Networking works in the rear rescue image though. I'm trying to discover
why it works in the rescue image, and not in the PBA, so I can reenable
it. Do you have another clue?</p>
<p>The rear workflow to generate a PBA image is super convenient! So I was
hoping to build on top of it.</p>
<h4 id="olivero2_commented_at_2021-04-28_1124"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-828376103">2021-04-28 11:24</a>:<a class="headerlink" href="#olivero2_commented_at_2021-04-28_1124" title="Permanent link">&para;</a></h4>
<p>Unfortunately, I cannot point specifically to what you might be missing.
As far as I remember, stripping down ReaR to meet PBA requirements was a
complex multi-step process with a considerable amount of trial and error
involved.</p>
<p>Your initial approach is on the right trajectory. However, rather than
changing settings to different values, just comment out the lines you
think might exclude stuff you need. For example, in
<code>001_configure_workflow.sh</code> do not set <code>USE_DHCLIENT='yes'</code>, but make
that line <code># USE_DHCLIENT='no'</code>. The reason is that there are
auto-detection and auto-configuration options in place which adapt to
different installations and operating systems. See
<code>usr/share/rear/conf/default.conf</code> for explanations.</p>
<p>So I'd go further down that route of initially commenting out everything
that looks like a strip-down setting in <code>001_configure_workflow.sh</code>,
<code>095_exclude_non_essential_files.sh</code>, including <code>COPY_AS_IS_EXCLUDE</code>
lines (you might miss important configuration files otherwise). Also
consider the hints mentioned in my previous comment. Then you could
enable the debug shell via <code>OPAL_PBA_DEBUG_PASSWORD</code> (as explained in
<code>usr/share/rear/conf/default.conf</code>), boot the image via a USB stick and
check what's available.</p>
<p>Note that much depends on your base operating system and its
configuration. ReaR images are generally way different from Tiny Core as
the former can vary wildly depending on which OS they were created with.</p>
<h4 id="jip-hop_commented_at_2021-05-14_1817"><img src="https://avatars.githubusercontent.com/u/2871973?v=4" width="50"><a href="https://github.com/Jip-Hop">Jip-Hop</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-841418760">2021-05-14 18:17</a>:<a class="headerlink" href="#jip-hop_commented_at_2021-05-14_1817" title="Permanent link">&para;</a></h4>
<p>Thanks again for replying. I went the Tiny Core Linux road after all for
my <a href="https://github.com/Jip-Hop/sedunlocksrv-pba">PBA</a>, but did borrow
the rear SED unlock code from
<a href="https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/lib/opal-functions.sh">opal-functions.sh</a>
and
<a href="https://github.com/rear/rear/blob/6a3d0b4d5e73c69a62ce0bd209b2b38ffb462569/usr/share/rear/skel/default/etc/scripts/unlock-opal-disks">unlock-opal-disks</a>.
I hope you don't mind ðŸ™‚</p>
<h4 id="olivero2_commented_at_2021-05-14_1904"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-841444509">2021-05-14 19:04</a>:<a class="headerlink" href="#olivero2_commented_at_2021-05-14_1904" title="Permanent link">&para;</a></h4>
<p>You're welcome! If it works best for you that way, it's perfectly fine.
As ReaR code is GPL-licensed, who could object? ðŸ˜ƒ</p>
<h4 id="jsmeix_commented_at_2021-05-17_1331"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2606#issuecomment-842327239">2021-05-17 13:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-17_1331" title="Permanent link">&para;</a></h4>
<p>@Jip-Hop<br />
feel free to 'borrow' ReaR code as you like under GPL license<br />
and ideally you may even bring something back to ReaR at a later time<br />
if you have adaptions and enhancements that could also improve ReaR :-)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-04-27.2606.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
