<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2871 Issue open: Customizing RSYNC_PORT - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2871 Issue open: Customizing RSYNC_PORT";
        var mkdocs_page_input_path = "issues/2022-09-28.2871.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2871 Issue open: Customizing RSYNC_PORT</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2871_issue_open_customizing_rsync_port"><a href="https://github.com/rear/rear/issues/2871">#2871 Issue</a> <code>open</code>: Customizing RSYNC_PORT<a class="headerlink" href="#2871_issue_open_customizing_rsync_port" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>discuss / RFC</code></p>
<h4 id="fadamo_opened_issue_at_2022-09-28_1308"><img src="https://avatars.githubusercontent.com/u/43404795?v=4" width="50"><a href="https://github.com/fadamo">fadamo</a> opened issue at <a href="https://github.com/rear/rear/issues/2871">2022-09-28 13:08</a>:<a class="headerlink" href="#fadamo_opened_issue_at_2022-09-28_1308" title="Permanent link">&para;</a></h4>
<p>I found that simply adding in local.conf</p>
<pre><code>readonly RSYNC_PORT=nnnnn
export RSYNC_PORT
</code></pre>
<p>I can customize rsyncd port.<br />
So I think it is possible to write</p>
<pre><code>RSYNC_PORT=${RSYNC_PORT:-873}
</code></pre>
<p>instead of</p>
<pre><code>RSYNC_PORT=873                  # default port (of rsync server)
</code></pre>
<p>in /usr/share/rear/verify/RSYNC/default/100_check_rsync.sh<br />
to give a proper way to customize that port.</p>
<h4 id="jsmeix_commented_at_2022-10-05_1144"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268326421">2022-10-05 11:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-05_1144" title="Permanent link">&para;</a></h4>
<p>In current ReaR 2.7 code there is<br />
no longer a global variable RSYNC_PORT.<br />
Instead there is a function <code>rsync_port()</code><br />
in usr/share/rear/lib/rsync-functions.sh<br />
see<br />
<a href="https://github.com/rear/rear/commit/e0d3c6e8da6d72cfaff580683839397ceab45cf4">https://github.com/rear/rear/commit/e0d3c6e8da6d72cfaff580683839397ceab45cf4</a><br />
which reads (excerpt):</p>
<pre><code>... introducing generic functions for rsync URL parsing and
use them for both BACKUP_URL and OUTPUT_URL, as appropriate.
Replace all uses of global RSYNC_* variables derived
from BACKUP_URL by those functions
</code></pre>
<p>See also<br />
<a href="https://github.com/rear/rear/pull/2831#discussion_r909526458">https://github.com/rear/rear/pull/2831#discussion_r909526458</a><br />
and<br />
<a href="https://github.com/rear/rear/pull/2831#discussion_r909594701">https://github.com/rear/rear/pull/2831#discussion_r909594701</a></p>
<h4 id="jsmeix_commented_at_2022-10-05_1320"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268425781">2022-10-05 13:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-05_1320" title="Permanent link">&para;</a></h4>
<p>@fadamo<br />
by the way:</p>
<p>Your</p>
<pre><code>readonly VARIABLE=value
export VARIABLE
</code></pre>
<p>method in etc/rear/local.conf is a good real world example<br />
why <code>make rear working with "set -ue -o pipefail"</code>, cf.<br />
<a href="https://github.com/rear/rear/issues/700">https://github.com/rear/rear/issues/700</a><br />
is not such a good idea in practice, see the section<br />
"Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
that reads (excerpt)</p>
<pre><code>Using 'set -eu -o pipefail' also during runtime
is currently not recommended because
it is a double-edged sword
which can cause more problems in practice
(i.e. problems for ReaR users)
than it intends to solve in theory.
</code></pre>
<p>In this case here <code>set -eu -o pipefail</code><br />
(therein in particular the <code>set -e</code> part)<br />
would hinder the user to do some "dirty hacks"<br />
to make ReaR behave as he needs it in his specific case,<br />
cf. the section "Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
and my continuous mantra: "Final power to the user!" ;-)</p>
<h4 id="fadamo_commented_at_2022-10-05_1451"><img src="https://avatars.githubusercontent.com/u/43404795?v=4" width="50"><a href="https://github.com/fadamo">fadamo</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268551576">2022-10-05 14:51</a>:<a class="headerlink" href="#fadamo_commented_at_2022-10-05_1451" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In current ReaR 2.7 code there is no longer a global variable
RSYNC_PORT. Instead there is a function <code>rsync_port()</code> in
usr/share/rear/lib/rsync-functions.sh see
<a href="https://github.com/rear/rear/commit/e0d3c6e8da6d72cfaff580683839397ceab45cf4">e0d3c6e</a>
which reads (excerpt):</p>
<pre><code>... introducing generic functions for rsync URL parsing and
use them for both BACKUP_URL and OUTPUT_URL, as appropriate.
Replace all uses of global RSYNC_* variables derived
from BACKUP_URL by those functions
</code></pre>
<p>See also <a href="https://github.com/rear/rear/pull/2831#discussion_r909526458">#2831
(comment)</a>
and <a href="https://github.com/rear/rear/pull/2831#discussion_r909594701">#2831
(comment)</a></p>
<p>In current ReaR 2.7 code there is no longer a global variable
RSYNC_PORT. Instead there is a function <code>rsync_port()</code> in
usr/share/rear/lib/rsync-functions.sh see
<a href="https://github.com/rear/rear/commit/e0d3c6e8da6d72cfaff580683839397ceab45cf4">e0d3c6e</a>
which reads (excerpt):</p>
<pre><code>... introducing generic functions for rsync URL parsing and
use them for both BACKUP_URL and OUTPUT_URL, as appropriate.
Replace all uses of global RSYNC_* variables derived
from BACKUP_URL by those functions
</code></pre>
<p>See also <a href="https://github.com/rear/rear/pull/2831#discussion_r909526458">#2831
(comment)</a>
and <a href="https://github.com/rear/rear/pull/2831#discussion_r909594701">#2831
(comment)</a></p>
</blockquote>
<p>This is fine:
<a href="https://github.com/rear/rear/pull/2831#discussion_r909526458">https://github.com/rear/rear/pull/2831#discussion_r909526458</a>
!<br />
Are you going to implement it ?</p>
<h4 id="fadamo_commented_at_2022-10-05_1503"><img src="https://avatars.githubusercontent.com/u/43404795?v=4" width="50"><a href="https://github.com/fadamo">fadamo</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268567469">2022-10-05 15:03</a>:<a class="headerlink" href="#fadamo_commented_at_2022-10-05_1503" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Using 'set -eu -o pipefail' also during runtime<br />
is currently not recommended because<br />
it is a double-edged sword<br />
which can cause more problems in practice</p>
</blockquote>
<p>In depends on how you start writing <em>brand new</em> scripts.<br />
I always use</p>
<pre><code>#!/bin/bash -eEu
set -o pipefail
</code></pre>
<p>Instead, modifying old scripts is more complex.<br />
BTW, this is your coding style, not mine, so I respect your ideas. And I
really appreciate ReaR.</p>
<h4 id="pcahyna_commented_at_2022-10-05_1628"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268662689">2022-10-05 16:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-10-05_1628" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In current ReaR 2.7 code there is<br />
no longer a global variable RSYNC_PORT.<br />
Instead there is a function <code>rsync_port()</code></p>
</blockquote>
<p>to me it seemed that <code>RSYNC_*</code> variables have effectively been internal
variables, not something that was intended to be customizable by users
(the values have been supplied in <code>BACKUP_URL</code>). So I decided to
restructure the code and get rid of them without feeling the need for
backward compatibility. Setting it to <code>readonly</code> is a nice hack, but the
proper fix would be to extract the port from the URL.</p>
<h4 id="pcahyna_commented_at_2022-10-05_1631"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1268665011">2022-10-05 16:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-10-05_1631" title="Permanent link">&para;</a></h4>
<p>Concerning</p>
<blockquote>
<p>In this case here <code>set -eu -o pipefail</code><br />
(therein in particular the <code>set -e</code> part)<br />
would hinder the user to do some "dirty hacks"</p>
</blockquote>
<p>I am more positive towards stuff like <code>set -e</code>. I would not make it the
default in production, but set it during test runs. This would allow to
discover many problems (depending on test coverage), but not prevent
from using "dirty hacks".</p>
<h4 id="jsmeix_commented_at_2022-10-06_0704"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1269450656">2022-10-06 07:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-06_0704" title="Permanent link">&para;</a></h4>
<p>Regarding <code>set -eu -o pipefail</code> see the whole text in<br />
the section "Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
that also reads (excerpt)</p>
<pre><code>Preferably during development of new scripts
or when scripts are much overhauled
and while testing new code use 'set -ue'
to die from unset variables and unhandled errors
and use 'set -o pipefail' to better notice
failures in a pipeline.
...
Using 'set -eu -o pipefail' also during runtime
is currently not recommended ...
</code></pre>
<p>where "during runtime" actually means<br />
"during runtime on the user's system".<br />
I made that text more clear so that it is now</p>
<pre><code>Using 'set -eu -o pipefail' also in general
during runtime on the user's system
is currently not recommended ...
</code></pre>
<h4 id="jsmeix_commented_at_2022-10-06_0706"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1269453185">2022-10-06 07:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-06_0706" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I agree with all your reasoning in your<br />
<a href="https://github.com/rear/rear/issues/2871#issuecomment-1268662689">https://github.com/rear/rear/issues/2871#issuecomment-1268662689</a><br />
in particular with your conclusion that<br />
<code>the proper fix would be to extract the port from the URL</code>.</p>
<h4 id="jsmeix_commented_at_2022-10-06_0736"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1269495899">2022-10-06 07:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-06_0736" title="Permanent link">&para;</a></h4>
<p>I did<br />
<a href="https://github.com/rear/rear/issues/2877">https://github.com/rear/rear/issues/2877</a><br />
to implement a sufficiently easy way in practice<br />
so that certain scripts can be run with<br />
specific bash options like <code>set -eu -o pipefail</code><br />
during development (e.g. while testing things).<br />
Of course also users can use that as needed<br />
(e.g. for debugging or whatever they like).</p>
<h4 id="github-actions_commented_at_2022-12-06_0232"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1338643644">2022-12-06 02:32</a>:<a class="headerlink" href="#github-actions_commented_at_2022-12-06_0232" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-02-07_0229"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1420107445">2023-02-07 02:29</a>:<a class="headerlink" href="#github-actions_commented_at_2023-02-07_0229" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-04-09_0219"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2871#issuecomment-1501021874">2023-04-09 02:19</a>:<a class="headerlink" href="#github-actions_commented_at_2023-04-09_0219" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-09-28.2871.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
