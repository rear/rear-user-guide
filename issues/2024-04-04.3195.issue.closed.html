<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3195 Issue closed: rear mkopalpba fails - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3195 Issue closed: rear mkopalpba fails";
        var mkdocs_page_input_path = "issues/2024-04-04.3195.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3195 Issue closed: rear mkopalpba fails</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3195_issue_closed_rear_mkopalpba_fails"><a href="https://github.com/rear/rear/issues/3195">#3195 Issue</a> <code>closed</code>: <code>rear mkopalpba</code> fails<a class="headerlink" href="#3195_issue_closed_rear_mkopalpba_fails" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code>,
<code>won't fix / can't fix / obsolete</code></p>
<h4 id="edmcman_opened_issue_at_2024-04-04_1953"><img src="https://avatars.githubusercontent.com/u/1017189?v=4" width="50"><a href="https://github.com/edmcman">edmcman</a> opened issue at <a href="https://github.com/rear/rear/issues/3195">2024-04-04 19:53</a>:<a class="headerlink" href="#edmcman_opened_issue_at_2024-04-04_1953" title="Permanent link">&para;</a></h4>
<!-- Relax-and-Recover (ReaR) Issue Template
Fill in the following items when submitting a new issue.
Use GitHub Markdown, see "Basic writing and formatting syntax" on
https://docs.github.com/en/get-started/writing-on-github
Support is voluntary without guarantee/warranty/liability -->

<ul>
<li>ReaR version ("/usr/sbin/rear -V"):</li>
</ul>
<p>Relax-and-Recover 2.7 / Git</p>
<p>ffdea7e7</p>
<ul>
<li>
<p>If your ReaR version is not the current version, explain why you
    can't upgrade:</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:    22.04
Codename:   jammy
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=RAWDISK
OUTPUT_URL="file:///var/lib/rear/output"
SECURE_BOOT_BOOTLOADER="/boot/efi/EFI/ubuntu/shimx64.efi"
</code></pre>
<ul>
<li>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):</li>
</ul>
<p>System 76 PC</p>
<ul>
<li>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</li>
</ul>
<p>x86</p>
<ul>
<li>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</li>
</ul>
<p>Open Firmware, GRUB</p>
<ul>
<li>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</li>
</ul>
<p>NVMe</p>
<ul>
<li>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</li>
</ul>
<!-- -->

<pre><code>/dev/nvme1n1       /dev/nvme1n1                  nvme   disk                         1.9T 
`-/dev/nvme1n1p1   /dev/nvme1n1p1 /dev/nvme1n1   nvme   part  vfat        OPAL PBA    99M 
/dev/nvme0n1       /dev/nvme0n1                  nvme   disk                       465.8G 
|-/dev/nvme0n1p1   /dev/nvme0n1p1 /dev/nvme0n1   nvme   part  vfat        EFI        512M /boot/efi
|-/dev/nvme0n1p2   /dev/nvme0n1p2 /dev/nvme0n1   nvme   part  ext4                   1.7G /boot
`-/dev/nvme0n1p3   /dev/nvme0n1p3 /dev/nvme0n1   nvme   part  crypto_LUKS          463.6G 
  `-/dev/mapper/nvme0n1p3_crypt
                   /dev/dm-0      /dev/nvme0n1p3        crypt LVM2_member          463.6G 
    |-/dev/mapper/vgubuntu-root
    |              /dev/dm-1      /dev/dm-0             lvm   ext4                 461.7G /
    `-/dev/mapper/vgubuntu-swap_1
                   /dev/dm-2      /dev/dm-0             lvm   swap                   1.9G [SWAP]
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>After updating to the latest git head, I get the following error when
running <code>rear mkopalpba</code>. Prior to updating, I did not receive this
error on eadcc683.</p>
<pre><code>root@banana:~# rear -d mkopalpba
Relax-and-Recover 2.7 / Git
Running rear mkopalpba (PID 110956 date 2024-04-04 15:48:18)
Command line options: /usr/sbin/rear -d mkopalpba
Using log file: /var/log/rear/rear-banana.log
Using build area: /var/tmp/rear.i338ZwpVcBBJ9za
Setting TMPDIR to '/var/tmp/rear.i338ZwpVcBBJ9za/tmp' (was unset when ReaR was launched)
Running 'init' stage ======================
Running workflow mkopalpba on the normal/original system
Running 'prep' stage ======================
Re-configuring Relax-and-Recover to create a TCG Opal pre-boot authentication (PBA) image
Found EFI system partition /dev/nvme0n1p1 on /boot/efi type vfat
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-6.5.0-26-generic' as kernel in the recovery system
Modified ReaR recovery system area after 'prep' stage (/var/tmp/rear.i338ZwpVcBBJ9za/rootfs contains regular files)
Running 'rescue' stage ======================
Creating recovery system root filesystem skeleton layout
Skipping 'docker0': not bound to any physical interface.
Skipping 'lo': not bound to any physical interface.
Handling network interface 'wlp0s20f3'
wlp0s20f3 is a physical device
Handled network interface 'wlp0s20f3'
Skipping 'zcctun0': not bound to any physical interface.
Included current keyboard mapping (via 'dumpkeys -f')
No default US keyboard mapping included (no KEYMAPS_DEFAULT_DIRECTORY specified)
No support for different keyboard layouts (neither KEYMAPS_DEFAULT_DIRECTORY nor KEYMAPS_DIRECTORIES specified)
Using '/boot/efi/EFI/ubuntu/shimx64.efi' as UEFI Secure Boot bootloader file
Running 'build' stage ======================
Copying files and directories
Copying binaries and libraries
A list of executables with their dependencies has been stored in /var/tmp/rear.i338ZwpVcBBJ9za/tmp/executable-dependencies
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules') and those in MODULES_LOAD
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/mtab' target '/proc/126971/mounts' on /proc/ /sys/ /dev/ or /run/
Skip copying broken symlink '/etc/resolv.conf' target '/run/systemd/resolve/stub-resolv.conf' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /var/tmp/rear.i338ZwpVcBBJ9za/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Testing that the existing programs in the PROGS array can be found as executable command within the recovery system
Testing that each program in the REQUIRED_PROGS array can be found as executable command within the recovery system
Running 'pack' stage ======================
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (68896025 bytes) in 5 seconds
Running 'output' stage ======================
ERROR: Creating a raw disk image requires an EFI bootloader or syslinux
You may use debugscript mode '-D' for full debug messages with 'set -x' output
Aborting due to an error, check /var/log/rear/rear-banana.log for details
Exiting rear mkopalpba (PID 110956) and its descendant processes ...
Running exit tasks
To remove the build area you may use (with caution): rm -Rf --one-file-system /var/tmp/rear.i338ZwpVcBBJ9za
Terminated
</code></pre>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<p><a href="https://github.com/rear/rear/files/14876514/rear-banana.log">rear-banana.log</a></p>
<h4 id="edmcman_commented_at_2024-04-04_2001"><img src="https://avatars.githubusercontent.com/u/1017189?v=4" width="50"><a href="https://github.com/edmcman">edmcman</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2038105688">2024-04-04 20:01</a>:<a class="headerlink" href="#edmcman_commented_at_2024-04-04_2001" title="Permanent link">&para;</a></h4>
<p>git bisect results</p>
<pre><code>3db2724c7860e38fad96ba4d35c8b174616c1496 is the first bad commit
commit 3db2724c7860e38fad96ba4d35c8b174616c1496
Author: Pavel Cahyna &lt;pcahyna@redhat.com&gt;
Date:   Mon Mar 4 15:56:53 2024 +0100

    Introduce a variable for GRUB image format

    Use it as the argument of the -O option to
    grub-mkstandalone/grub-mkimage instead of the hardcoded x86_64-efi.

    For easier porting to non-x86_64 EFI platforms.

 usr/share/rear/lib/uefi-functions.sh                   | 18 +++++++++---------
 .../Linux-i386/270_create_grub2_efi_bootloader.sh      |  6 +++---
 usr/share/rear/prep/Linux-arm/330_set_efi_arch.sh      |  2 ++
 usr/share/rear/prep/Linux-i386/330_set_efi_arch.sh     |  3 +++
 4 files changed, 17 insertions(+), 12 deletions(-)
</code></pre>
<h4 id="edmcman_commented_at_2024-04-04_2003"><img src="https://avatars.githubusercontent.com/u/1017189?v=4" width="50"><a href="https://github.com/edmcman">edmcman</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2038110093">2024-04-04 20:03</a>:<a class="headerlink" href="#edmcman_commented_at_2024-04-04_2003" title="Permanent link">&para;</a></h4>
<p>Looks like this is the problem:
<a href="https://github.com/rear/rear/commit/3db2724c7860e38fad96ba4d35c8b174616c1496#r140627966">https://github.com/rear/rear/commit/3db2724c7860e38fad96ba4d35c8b174616c1496#r140627966</a></p>
<h4 id="edmcman_commented_at_2024-04-04_2013"><img src="https://avatars.githubusercontent.com/u/1017189?v=4" width="50"><a href="https://github.com/edmcman">edmcman</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2038125809">2024-04-04 20:13</a>:<a class="headerlink" href="#edmcman_commented_at_2024-04-04_2013" title="Permanent link">&para;</a></h4>
<p>Duplicate of #3191</p>
<h4 id="jsmeix_commented_at_2024-04-05_1243"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2039712157">2024-04-05 12:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-05_1243" title="Permanent link">&para;</a></h4>
<p>@edmcman<br />
right now I merged<br />
<a href="https://github.com/rear/rear/pull/3192">https://github.com/rear/rear/pull/3192</a></p>
<p>Please test our current ReaR upstream GitHub master code<br />
as described in the section<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Testing_current_ReaR_upstream_GitHub_master_code">https://en.opensuse.org/SDB:Disaster_Recovery#Testing_current_ReaR_upstream_GitHub_master_code</a><br />
and<br />
please provide feedback here whether or not your issue is then fixed.<br />
I depend on your feedback because I am not a "rear mkopalpba" user.<br />
I don't have a TCG Opal 2-compliant self-encrypting disk.</p>
<h4 id="edmcman_commented_at_2024-04-05_1254"><img src="https://avatars.githubusercontent.com/u/1017189?v=4" width="50"><a href="https://github.com/edmcman">edmcman</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2039733438">2024-04-05 12:54</a>:<a class="headerlink" href="#edmcman_commented_at_2024-04-05_1254" title="Permanent link">&para;</a></h4>
<p>@jsmeix I can confirm this fixed the error. I'll just note here for
posterity because of #3194 I can't say that the generated PBA works,
but there is one generated now :-)</p>
<h4 id="jsmeix_commented_at_2024-04-05_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3195#issuecomment-2039745246">2024-04-05 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-04-05_1258" title="Permanent link">&para;</a></h4>
<p>@edmcman<br />
thank you for your prompt feedback - much appreciated!<br />
Have a nice weekend!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2024-04-04.3195.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
