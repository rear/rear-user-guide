<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2762 Issue closed: rear backup and TSM server - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2762 Issue closed: rear backup and TSM server";
        var mkdocs_page_input_path = "issues/2022-02-17.2762.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2762 Issue closed: rear backup and TSM server</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2762_issue_closed_rear_backup_and_tsm_server"><a href="https://github.com/rear/rear/issues/2762">#2762 Issue</a> <code>closed</code>: rear backup and TSM server<a class="headerlink" href="#2762_issue_closed_rear_backup_and_tsm_server" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>external tool</code>, <code>no-issue-activity</code></p>
<h4 id="xslima00_opened_issue_at_2022-02-17_0742"><img src="https://avatars.githubusercontent.com/u/28806908?u=45651cb1102180dcd57e18be6526196d379d50c8&v=4" width="50"><a href="https://github.com/xslima00">xslima00</a> opened issue at <a href="https://github.com/rear/rear/issues/2762">2022-02-17 07:42</a>:<a class="headerlink" href="#xslima00_opened_issue_at_2022-02-17_0742" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    NAME="Red Hat Enterprise Linux Server"<br />
    VERSION="7.6 (Maipo)"</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    ISO_PREFIX=rootvg-rear-$HOSTNAME<br />
    BACKUP=TSM<br />
    ONLY_INCLUDE_VG=( "rhel" )<br />
    SSH_ROOT_PASSWORD="passw0rd"<br />
    TSM_RESULT_FILE_PATH=/opt/tivoli/tsm/rear<br />
    TSM_RM_ISOFILE=Yes</p>
</li>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    description: pSeries LPAR<br />
    product: IBM,9080-M9S<br />
    vendor: IBM</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    4.14.0-115.32.1.el7a.ppc64le</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    disks are mapped via VIO with vscsi</p>
</li>
<li>
<p>Issue description<br />
    Hello, I´d like to ask if it´s possible to force rear to use
    additional parameters to identify TSM server. On classic machine it
    looks OK but in our case we have few TSM servers where "dsmc"
    command must be used with additional parameter -se=SERVER name.</p>
</li>
</ul>
<p>Example:</p>
<ul>
<li>Will not work as expected</li>
</ul>
<hr />
<pre><code>[root@XXXXXXXXX-503 ~]# dsmc q fi
IBM Spectrum Protect
Command Line Backup-Archive Client Interface
  Client Version 8, Release 1, Level 13.2
  Client date/time: 02/17/2022 08:36:01
(c) Copyright by IBM Corporation and other(s) 1990, 2022. All Rights Reserved.

Node Name: XXXXXXXXX-503
Please enter your user id &lt;XXXXXXXXX-503&gt;:
</code></pre>
<ul>
<li>We need following parameter:</li>
</ul>
<hr />
<pre><code>[root@XXXXXXXXX-503 ~]# dsmc q fi -se=XXXXXXXXX-41
IBM Spectrum Protect
Command Line Backup-Archive Client Interface
  Client Version 8, Release 1, Level 13.2
  Client date/time: 02/17/2022 08:37:36
(c) Copyright by IBM Corporation and other(s) 1990, 2022. All Rights Reserved.

Node Name: XXXXXXXXX-503
Session established with server XXXXXXXXX-41: Linux/ppc64le
  Server Version 8, Release 1, Level 12.000
  Server date/time: 02/17/2022 08:37:38  Last access: 02/17/2022 08:14:56

       Last Incr Date          Type    File Space Name

  1     02/16/2022 17:00:42     XFS     /
  2     02/16/2022 17:00:42     XFS     /boot
</code></pre>
<ul>
<li>Is it possible to force this parameter in rear configuration or some
    workaround has to be created from our side?</li>
</ul>
<h4 id="gdha_commented_at_2022-02-17_1641"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1043167564">2022-02-17 16:41</a>:<a class="headerlink" href="#gdha_commented_at_2022-02-17_1641" title="Permanent link">&para;</a></h4>
<p>@xslima00 Use <code>rear dump</code> to see all possible TSM parameters available,
or check the <code>/usr/share/rear/conf/default.conf</code> file if something could
fit your needs. If that is not the case you could try to add it and
propose a pull request to the team.<br />
Try the command <code>rear -s mkrescue | grep TSM</code> to retrieve all TSM
related scripts (that might help you to get started).</p>
<h4 id="jsmeix_commented_at_2022-02-18_1135"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1044378561">2022-02-18 11:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-02-18_1135" title="Permanent link">&para;</a></h4>
<p>TSM_DSMC_RESTORE_OPTIONS looks promising,<br />
cf. in our GitHub master code currently at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2006">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2006</a></p>
<p>In general regarding issues with third-party backup tools:<br />
Usually we at ReaR upstream do not use third-party backup tools<br />
so usually we cannot reproduce issues with third-party backup tools.<br />
Nevertheless we try to help as good as we can from plain looking at the
code.<br />
In this case the code that does the restore with TSM is mainly in<br />
usr/share/rear/restore/TSM/default/400_restore_with_tsm.sh<br />
in our GitHub master code currently<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/restore/TSM/default/400_restore_with_tsm.sh">https://github.com/rear/rear/blob/master/usr/share/rear/restore/TSM/default/400_restore_with_tsm.sh</a></p>
<p>@xslima00<br />
you use ReaR 2.4 which is dated June 2018, cf.<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a><br />
so it is rather old.</p>
<p>I recommend to try out our latest GitHub master code because<br />
the GitHub master code is the only place where we fix things<br />
and if there are issues it helps when you use exactly the code<br />
where we could fix things.</p>
<p>See the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="xslima00_commented_at_2022-02-19_0750"><img src="https://avatars.githubusercontent.com/u/28806908?u=45651cb1102180dcd57e18be6526196d379d50c8&v=4" width="50"><a href="https://github.com/xslima00">xslima00</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1045959017">2022-02-19 07:50</a>:<a class="headerlink" href="#xslima00_commented_at_2022-02-19_0750" title="Permanent link">&para;</a></h4>
<p>@gdha @jsmeix Thanks for the hints guys. I was checking TSM scripts used
by rear and found I have to actually modify following:<br />
/usr/share/rear/backup/TSM/default/500_make_TSM_backup.sh<br />
/usr/share/rear/output/TSM/default/950_dsmc_save_result_files.sh<br />
/usr/share/rear/output/TSM/default/960_dsmc_verify_isofile.sh<br />
/usr/share/rear/restore/TSM/default/400_restore_with_tsm.sh</p>
<p>Basically all those where command dsmc is used. It was necessary to add
to the end (-se=SERVER1) like in this example:</p>
<pre><code>grep dsmc /usr/share/rear/output/TSM/default/950_dsmc_save_result_files.sh
LC_ALL=${LANG_RECOVER} dsmc incremental "${TSM_RESULT_FILES[@]}" -se=SERVER1 &gt;/dev/null
LC_ALL=${LANG_RECOVER} dsmc archive -archmc="$TSM_ARCHIVE_MGMT_CLASS" "${TSM_RESULT_FILES[@]}" -se=SERVER1 &gt;/dev/null
</code></pre>
<p>For some smart reason this command line argument has to be always in the
end so <code>dsmc q fi -se=SERVER1</code> works while <code>dsmc -se=SERVER1 q fi</code> ends
with error.</p>
<p>I was also checking that rear use automatically default configuration
file /opt/tivoli/tsm/client/ba/bin/dsm.opt so I believe my issue would
be solved if it would possible to define which opt file should be used
in local.conf.</p>
<p>Meanwhile I have used following workaround which force rear to use
server parameter:</p>
<pre><code>#create fake dsmc
echo '/opt/tivoli/tsm/client/ba/bin/dsmc "$@" -se=SERVER1' &gt; /scripts/dsmc
chmod 555 /scripts/dsmc

#crontab entry
cat /etc/cron.d/rear
PATH=/scripts/:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
00 14 * * 5 root /usr/sbin/rear mkbackup &gt;/dev/null 2&gt;&amp;1

#local.conf entry
BACKUP_PROG_INCLUDE=( '/scripts/*' )
</code></pre>
<h4 id="github-actions_commented_at_2022-04-21_0315"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1104662506">2022-04-21 03:15</a>:<a class="headerlink" href="#github-actions_commented_at_2022-04-21_0315" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2022-06-21_0319"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1161189334">2022-06-21 03:19</a>:<a class="headerlink" href="#github-actions_commented_at_2022-06-21_0319" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2022-08-21_0326"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2762#issuecomment-1221459613">2022-08-21 03:26</a>:<a class="headerlink" href="#github-actions_commented_at_2022-08-21_0326" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-02-17.2762.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
