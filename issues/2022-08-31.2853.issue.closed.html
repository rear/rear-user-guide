<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2853 Issue closed: Let ReaR deal with LVM VGs without LVs - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2853 Issue closed: Let ReaR deal with LVM VGs without LVs";
        var mkdocs_page_input_path = "issues/2022-08-31.2853.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2853 Issue closed: Let ReaR deal with LVM VGs without LVs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2853_issue_closed_let_rear_deal_with_lvm_vgs_without_lvs"><a href="https://github.com/rear/rear/issues/2853">#2853 Issue</a> <code>closed</code>: Let ReaR deal with LVM VGs without LVs<a class="headerlink" href="#2853_issue_closed_let_rear_deal_with_lvm_vgs_without_lvs" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>no-issue-activity</code></p>
<h4 id="david-hill_opened_issue_at_2022-08-31_1236"><img src="https://avatars.githubusercontent.com/u/6233278?v=4" width="50"><a href="https://github.com/david-hill">david-hill</a> opened issue at <a href="https://github.com/rear/rear/issues/2853">2022-08-31 12:36</a>:<a class="headerlink" href="#david-hill_opened_issue_at_2022-08-31_1236" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>rear should skip mounted loop devices</p>
<pre><code>[dhill@knox rear]$ git diff
diff --git a/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh b/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
index e01dbf46..dd970944 100644
--- a/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
+++ b/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
@@ -82,6 +82,9 @@ local lvs_exit_code
         # Skip lines that are not describing physical devices
         # i.e. lines where pdev does not start with a leading / character:
         test "${pdev#/}" = "$pdev" &amp;&amp; continue
+        if [[ "${pdev}" =~ '/dev/loop' ]] then
+            continue
+        fi

         # Output lvmdev header only once to DISKLAYOUT_FILE:
         if is_false $header_printed ; then
</code></pre>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    All</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    RHEL 8.4</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<!-- -->

<pre><code>2022-08-30 12:46:16.127472961 Verifying that the 'disk' entries in /var/lib/rear/layout/disklayout.conf are correct
1200210141184
2022-08-30 12:46:16.130304394 Verifying that the 'part' entries for /dev/sda in /var/lib/rear/layout/disklayout.conf are correct
1048576
1048576
1200208027136
2097152
2022-08-30 12:46:16.132631819 Verifying that the 'part' entries for /dev/sda in /var/lib/rear/layout/disklayout.conf specify consecutive partitions
2022-08-30 12:46:16.136434519 Verifying that the 'lvm...' entries in /var/lib/rear/layout/disklayout.conf are correct
2022-08-30 12:46:16.142924055 LVM no 'lvmvol /dev/cinder-volumes' for 'lvmdev /dev/cinder-volumes'
2022-08-30 12:46:16.149657393 ERROR:
</code></pre>
<h4 id="gdha_commented_at_2022-09-01_0714"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1233847407">2022-09-01 07:14</a>:<a class="headerlink" href="#gdha_commented_at_2022-09-01_0714" title="Permanent link">&para;</a></h4>
<p>@david-hill Could you copy/paste the output of the <code>df</code> and <code>mount</code>
command please? Loop devices are normally skipped (on my ubuntu ws I
have more then 10 loop devices which are skipped during a rear
savelayout).</p>
<h4 id="david-hill_commented_at_2022-09-01_1041"><img src="https://avatars.githubusercontent.com/u/6233278?v=4" width="50"><a href="https://github.com/david-hill">david-hill</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1234093380">2022-09-01 10:41</a>:<a class="headerlink" href="#david-hill_commented_at_2022-09-01_1041" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@david-hill Could you copy/paste the output of the <code>df</code> and <code>mount</code>
command please? Loop devices are normally skipped (on my ubuntu ws I
have more then 10 loop devices which are skipped during a rear
savelayout).</p>
</blockquote>
<p>Is it a LVM mounted on a loop ? It has to be LVM otherwise you won't
have any issues ...</p>
<h4 id="gdha_commented_at_2022-09-01_1231"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1234215191">2022-09-01 12:31</a>:<a class="headerlink" href="#gdha_commented_at_2022-09-01_1231" title="Permanent link">&para;</a></h4>
<p>@david-hill Still need to see some output to understand it better...</p>
<h4 id="pcahyna_commented_at_2022-09-08_1556"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1240910816">2022-09-08 15:56</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-08_1556" title="Permanent link">&para;</a></h4>
<p>@gdha do you know how do the loop devices get skipped? I don't see any
code to skip them under <code>layout/save</code>. There is code in
200_partition_layout.sh that skips generating <code>disk</code> lines for devices
that are not in the known list (currently the list is: hd sd cciss vd
xvd dasd nvme mmcblk ) but there seems to be nothing to prevent <code>fs</code>
lines being generated for them in 230_filesystem_layout.sh ). Surely I
am missing something, as usually it has not been a problem.</p>
<h4 id="pcahyna_commented_at_2022-09-08_1559"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1240914748">2022-09-08 15:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-08_1559" title="Permanent link">&para;</a></h4>
<p>@david-hill could you please provide the
<code>/var/lib/rear/layout/disklayout.conf</code> file generated when you got the
error?</p>
<h4 id="pcahyna_commented_at_2022-09-16_1721"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1249604729">2022-09-16 17:21</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-16_1721" title="Permanent link">&para;</a></h4>
<p>@gdha I don't see that:</p>
<pre><code>dd if=/dev/zero of=/var/tmp/loopfs bs=1024 count=102400
mkfs.xfs /var/tmp/loopfs
mkdir /home/loopfs
mount -o loop /var/tmp/loopfs /home/loopfs
rear savelayout
</code></pre>
<p>results in this in layout:</p>
<pre><code>fs /dev/loop0 /home/loopfs xfs uuid=fbb2b182-5f12-49b0-9ff4-9bbf99e3cc35 label=  options=rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota
</code></pre>
<p>so, loop device is not skipped (unless it changed in ReaR 2.7; this was
with ReaR 2.6). Not sure why loop devices on Ubuntu are skipped, aren't
they mounted under something in <code>AUTOEXCLUDE_PATH</code> ?</p>
<h4 id="pcahyna_commented_at_2022-09-16_1740"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1249623128">2022-09-16 17:40</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-16_1740" title="Permanent link">&para;</a></h4>
<p>@david-hill your issue is only tangentially related to loop devices.
Using a PV/VG on a disk:</p>
<pre><code>parted --script -a optimal /dev/vdc -- mklabel gpt mkpart extra ext2 1M -1M set 1 lvm on
pvcreate --yes /dev/vdc1
vgcreate sigvg  /dev/vdc1
rear savelayout
</code></pre>
<p>results in the same error:</p>
<pre><code>Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
LVM no 'lvmvol /dev/sigvg' for 'lvmdev /dev/sigvg'
ERROR: 
====================
BUG in /usr/share/rear/layout/save/default/950_verify_disklayout_file.sh line 254:
'Entries in /var/lib/rear/layout/disklayout.conf are broken ('rear recover' would fail)'
</code></pre>
<p>without any loop device involved. The underlying issue is that ReaR does
not like volume groups without logical volumes. Unused volume groups may
be unusual, but I think there is nothing really wrong with them, and PR
#2603 fixed a bug ( #2596 ) where an unused PV (without VG) aborted
mkrescue. So, by analogy, I think we should also allow a VG without any
LV (either exclude it, or add it to the layout as empty).</p>
<h4 id="pcahyna_commented_at_2022-09-16_1743"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1249628411">2022-09-16 17:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-16_1743" title="Permanent link">&para;</a></h4>
<p>What to do with loop devices is a separate question, but I think should
be addressed consistently for all storage objects on them (you see above
that filesystems on loop devices are not being excluded either).</p>
<h4 id="david-hill_commented_at_2022-09-16_1834"><img src="https://avatars.githubusercontent.com/u/6233278?v=4" width="50"><a href="https://github.com/david-hill">david-hill</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1249683681">2022-09-16 18:34</a>:<a class="headerlink" href="#david-hill_commented_at_2022-09-16_1834" title="Permanent link">&para;</a></h4>
<p>I would suggest we just skip /dev/loop ... is there any possibility we
have any useful data on there ?</p>
<h4 id="gdha_commented_at_2022-09-17_0840"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1250030203">2022-09-17 08:40</a>:<a class="headerlink" href="#gdha_commented_at_2022-09-17_0840" title="Permanent link">&para;</a></h4>
<p>@pcahyna On my ubuntu ws the loop devices are of type squashfs, so this
is the reason of exclusion. The one I created manually is included as
you can see:</p>
<pre><code> cat /var/lib/rear/layout/disklayout.conf 
# Disk layout dated 20220917103612 (YYYYmmddHHMMSS)
# NAME                           KNAME       PKNAME    TRAN   TYPE FSTYPE      LABEL   SIZE MOUNTPOINT                    UUID
# /dev/loop0                     /dev/loop0                   loop squashfs           55.6M /snap/core18/2566             
# /dev/loop1                     /dev/loop1                   loop squashfs          142.2M /snap/chromium/2076           
# /dev/loop2                     /dev/loop2                   loop squashfs              9M /snap/canonical-livepatch/146 
# /dev/loop3                     /dev/loop3                   loop squashfs           63.2M /snap/core20/1623             
# /dev/loop4                     /dev/loop4                   loop squashfs              4K /snap/bare/5                  
# /dev/loop5                     /dev/loop5                   loop squashfs           91.7M /snap/gtk-common-themes/1535  
# /dev/loop6                     /dev/loop6                   loop squashfs          162.9M /snap/gnome-3-28-1804/145     
# /dev/loop7                     /dev/loop7                   loop squashfs          400.8M /snap/gnome-3-38-2004/112     
# /dev/loop8                     /dev/loop8                   loop squashfs          114.9M /snap/core/13741              
# /dev/loop9                     /dev/loop9                   loop squashfs             62M /snap/core20/1611             
# /dev/loop10                    /dev/loop10                  loop squashfs          164.8M /snap/gnome-3-28-1804/161     
# /dev/loop11                    /dev/loop11                  loop squashfs            114M /snap/core/13425              
# /dev/loop12                    /dev/loop12                  loop squashfs           55.6M /snap/core18/2560             
# /dev/loop13                    /dev/loop13                  loop squashfs          142.2M /snap/chromium/2082           
# /dev/loop14                    /dev/loop14                  loop squashfs          346.3M /snap/gnome-3-38-2004/115     
# /dev/loop15                    /dev/loop15                  loop squashfs              9M /snap/canonical-livepatch/138 
# /dev/loop16                    /dev/loop16                  loop squashfs           81.3M /snap/gtk-common-themes/1534  
# /dev/loop17                    /dev/loop17                  loop ext4                100M /home/loopfs                  d89d7f90-1bc9-45a5-a795-de9897577f50
...
fs /dev/loop17 /home/loopfs ext4 uuid=d89d7f90-1bc9-45a5-a795-de9897577f50 label= blocksize=1024 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=4081 default_mount_options=user_xattr,acl options=rw,relatime,data=ordered
</code></pre>
<p>So, yes it would be better to exclude loop devices if they are not
really required.</p>
<h4 id="pcahyna_commented_at_2022-09-17_1235"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1250063689">2022-09-17 12:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-17_1235" title="Permanent link">&para;</a></h4>
<p>Why shouldn't be any useful data on /dev/loop ? Is it because the
backing files of loop devices can be already saved when the filesystem
where they reside is backed up? This makes sense, but beware: if the
loop devices are mounted or in any other way used (like being PVs for
active VGs, esp. when using thin pools) when the backing files are being
backed up, the backup will very likely be inconsistent. This is a
similar reasoning like why we usually don't back up data by using just
<code>dd</code> on the underlying block device.<br />
Properly saving loop devices and all storage objects on top of them
(instead of skipping) would be a way around the problem, but would
require some special code (to call losetup during layout recreation to
set up the loop devices properly).<br />
Another option would be to exclude them and to warn (or error out) when
backing files of loop devices are being backed up and active read-write
storage objects (filesystems, LVM) reside on top of them. This would
guide the user to think how to temporarily deactivate this stuff during
backup to prevent inconsistent backups (similarly to how one can shut
down database server before backup and start them after to prevent
inconsistent database files, cf the description of <code>POST_BACKUP_SCRIPT</code>
in default.conf).</p>
<h4 id="jsmeix_commented_at_2022-09-19_0959"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1250812894">2022-09-19 09:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-19_0959" title="Permanent link">&para;</a></h4>
<p>Let's keep this issue to<br />
"Let ReaR deal with LVM VGs without LVs"<br />
in the same way as we did it<br />
for
<a href="https://github.com/rear/rear/issues/2596">https://github.com/rear/rear/issues/2596</a><br />
via
<a href="https://github.com/rear/rear/pull/2603">https://github.com/rear/rear/pull/2603</a></p>
<p>For the separated question what to do with loop devices, cf.<br />
<a href="https://github.com/rear/rear/issues/2853#issuecomment-1249628411">https://github.com/rear/rear/issues/2853#issuecomment-1249628411</a><br />
I created a separated issue<br />
<a href="https://github.com/rear/rear/issues/2865">https://github.com/rear/rear/issues/2865</a></p>
<h4 id="jsmeix_commented_at_2022-09-19_1005"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1250819615">2022-09-19 10:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-19_1005" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your above<br />
<a href="https://github.com/rear/rear/issues/2853#issuecomment-1250063689">https://github.com/rear/rear/issues/2853#issuecomment-1250063689</a></p>
<p>In general we do not know in ReaR what files are in the backup.<br />
In particular not for alomst all non-internal backup methods<br />
because ReaR does not implement making a backup with<br />
almost all non-internal (external) backup methods,<br />
see "BACKUP SOFTWARE INTEGRATION" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a></p>
<p>So in general we cannot compare what files are in the backup<br />
with what storage devices or filesystems are in disklayout.conf.</p>
<p>Furthermore even with internal backup methods we do not know<br />
during "rear mkrescue" what files are actually in the backup<br />
because no backup is actually made during "rear mkrescue".</p>
<h4 id="github-actions_commented_at_2022-11-19_0259"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1320767132">2022-11-19 02:59</a>:<a class="headerlink" href="#github-actions_commented_at_2022-11-19_0259" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-01-28_0232"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1407262196">2023-01-28 02:32</a>:<a class="headerlink" href="#github-actions_commented_at_2023-01-28_0232" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-04-08_0208"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1500763279">2023-04-08 02:08</a>:<a class="headerlink" href="#github-actions_commented_at_2023-04-08_0208" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-06-25_0301"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1605838028">2023-06-25 03:01</a>:<a class="headerlink" href="#github-actions_commented_at_2023-06-25_0301" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-08-27_0203"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1694547004">2023-08-27 02:03</a>:<a class="headerlink" href="#github-actions_commented_at_2023-08-27_0203" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-10-28_0200"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1783663076">2023-10-28 02:00</a>:<a class="headerlink" href="#github-actions_commented_at_2023-10-28_0200" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2023-12-28_0205"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1870752649">2023-12-28 02:05</a>:<a class="headerlink" href="#github-actions_commented_at_2023-12-28_0205" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2024-03-09_0158"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-1986689449">2024-03-09 01:58</a>:<a class="headerlink" href="#github-actions_commented_at_2024-03-09_0158" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="github-actions_commented_at_2024-05-11_0205"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-2105454236">2024-05-11 02:05</a>:<a class="headerlink" href="#github-actions_commented_at_2024-05-11_0205" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="gdha_commented_at_2024-06-14_1341"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-2168082685">2024-06-14 13:41</a>:<a class="headerlink" href="#gdha_commented_at_2024-06-14_1341" title="Permanent link">&para;</a></h4>
<p>Did a test setup with dmpvg dummy volume group without a logical volume
attached to it. On ReaR 2.6 it resulted in an error:</p>
<pre><code>#-&gt; rear -v savelayout
Relax-and-Recover 2.6 / 2020-06-17
Running rear savelayout (PID 4182717)
Using log file: /var/log/rear/rear-itsgbhhlsp00741.log
Running workflow savelayout on the normal/original system
Creating disk layout
Overwriting existing disk layout file /var/lib/rear/layout/disklayout.conf
GRUB found in first bytes on /dev/sda and GRUB 2 is installed, using GRUB2 as a guessed bootloader for 'rear recover'
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
LVM no 'lvmvol /dev/dmpvg' for 'lvmdev /dev/dmpvg'
ERROR:
====================
BUG in /usr/share/rear/layout/save/default/950_verify_disklayout_file.sh line 254:
'Entries in /var/lib/rear/layout/disklayout.conf are broken ('rear recover' would fail)'
--------------------
</code></pre>
<p>And, the disklayout.conf contained for sdp the following:</p>
<pre><code>#-&gt; grep sdp /var/lib/rear/layout/disklayout.conf
# /dev/sdp                              /dev/sdp                    disk              500G
# `-/dev/sdp1                           /dev/sdp1  /dev/sdp         part LVM2_member  500G
# Disk /dev/sdp
disk /dev/sdp 536870912000 gpt
# Partitions on /dev/sdp
lvmdev /dev/dmpvg /dev/sdp1 hlto4h-Utho-tQW1-dat4-K5h1-QYe8-vpvErQ 536866717696
</code></pre>
<p>And when using the pre-3.0 candidate I get no errors and the
disklayout.conf files contains for device sdp:</p>
<pre><code>#-&gt; grep sdp /app/scm-dvl/gdhaese1/projects/rear/var/lib/rear/layout/disklayout.conf
# /dev/sdp                              /dev/sdp                    disk                    500G
# `-/dev/sdp1                           /dev/sdp1  /dev/sdp         part LVM2_member        500G                     hlto4h-Utho-tQW1-dat4-K5h1-QYe8-vpvErQ
# Disk /dev/sdp
#disk /dev/sdp 536870912000 gpt
# Partitions on /dev/sdp
#part /dev/sdp 536868814848 1048576 primary none /dev/sdp1
#lvmdev /dev/dmpvg /dev/sdp1 hlto4h-Utho-tQW1-dat4-K5h1-QYe8-vpvErQ 536866717696
</code></pre>
<p>The device is not in use and is not recreated - I can life with that.</p>
<p>@jsmeix @pcahyna This issue is fixed for me.</p>
<h4 id="github-actions_commented_at_2024-08-14_0224"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2853#issuecomment-2287713124">2024-08-14 02:24</a>:<a class="headerlink" href="#github-actions_commented_at_2024-08-14_0224" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-08-31.2853.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
