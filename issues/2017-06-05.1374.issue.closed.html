<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1374 Issue closed: ReaR UEFI image fails booting if secure boot enabled - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1374 Issue closed: ReaR UEFI image fails booting if secure boot enabled";
        var mkdocs_page_input_path = "issues/2017-06-05.1374.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#1374 Issue closed: ReaR UEFI image fails booting if secure boot enabled</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1374_issue_closed_rear_uefi_image_fails_booting_if_secure_boot_enabled"><a href="https://github.com/rear/rear/issues/1374">#1374 Issue</a> <code>closed</code>: ReaR UEFI image fails booting if secure boot enabled<a class="headerlink" href="#1374_issue_closed_rear_uefi_image_fails_booting_if_secure_boot_enabled" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="porana_opened_issue_at_2017-06-05_1054"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> opened issue at <a href="https://github.com/rear/rear/issues/1374">2017-06-05 10:54</a>:<a class="headerlink" href="#porana_opened_issue_at_2017-06-05_1054" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>rear version (/usr/sbin/rear -V): rear118a-1.18.a-7.1</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a):</li>
</ul>
<pre> 
LSB Version:    n/a
Distributor ID: SUSE
Description:    SUSE Linux Enterprise Server for SAP Applications 12 SP2
Release:        12.2
Codename:       n/a
</pre>

<ul>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf): /etc/rear/local.conf</li>
</ul>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://xx.xx.xx.xx/home/rear-nfs/
NETFS_KEEP_OLD_BACKUP_COPY=yes
ISO_MKISOFS_BIN=/usr/bin/ebiso
USING_UEFI_BOOTLOADER=1
UEFI_BOOTLOADER=/boot/efi/EFI/sles_sap/shim.efi
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
BACKUP_PROG_INCLUDE=( '/var/cache/*' '/var/lib/mailman/*' '/var/tmp/*' '/var/lib/pgsql/*' '/usr/local/*' '/opt/*' '/var/lib/libvirt/images/*' '/boot/grub2/i386/*' '/var/opt/*' '/srv/*' '/boot/grub2/x86_64/*' '/var/lib/mariadb/*' '/var/spool/*' '/var/lib/mysql/*' '/tmp/*' '/home/*' '/var/log/*' '/var/lib/named/*' '/var/lib/machines/*' )
SSH_ROOT_PASSWORD="xxxxxx"
</pre>

<ul>
<li>Are you using legacy BIOS or UEFI boot?<br />
    UEFI with secure boot enabled</li>
<li>Brief description of the issue:<br />
    rear rescue image fails to boot when secure boot enabled</li>
<li>Work-around, if any:<br />
    disable secure boot. boot with rear rescue image and complete rear
    recover. enable secure boot again.</li>
</ul>
<p>i have seen similar issue
<a href="https://github.com/rear/rear/issues/702">https://github.com/rear/rear/issues/702</a>
with SLES11 SP3.</p>
<p>we are using SLES 12 SP2, is there any change is required for SLES12 SP2
to make it work?</p>
<h4 id="porana_commented_at_2017-06-06_1000"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-306439536">2017-06-06 10:00</a>:<a class="headerlink" href="#porana_commented_at_2017-06-06_1000" title="Permanent link">&para;</a></h4>
<p>One more update:</p>
<p>when we tried to boot the image from EFI shell its giving <strong>Security
violation</strong> error.</p>
<pre><code>FS0:\EFI\BOOT\&gt;BOOTX64.efi 
Command Error Status: Security Violation
FS0:\EFI\BOOT\&gt;
</code></pre>
<p>from the above error message, we can interpret that the BOOTX64.efi is
missing signature certificate.<br />
Please correct my interpretation if its not correct.</p>
<h4 id="jsmeix_commented_at_2017-06-07_1500"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-306822047">2017-06-07 15:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-06-07_1500" title="Permanent link">&para;</a></h4>
<p>@porana<br />
please provide a complete log file with debugging information<br />
for a "rear -d -D mkrescue/mkbackup" run.<br />
You may also have a look at<br />
"Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="porana_commented_at_2017-06-07_1919"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-306897890">2017-06-07 19:19</a>:<a class="headerlink" href="#porana_commented_at_2017-06-07_1919" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/1059012/rear-rear199.zip">rear-rear199.zip</a><br />
i have uploaded the complete log file with debug information.</p>
<h4 id="jsmeix_commented_at_2017-06-09_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-307381475">2017-06-09 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-06-09_1258" title="Permanent link">&para;</a></h4>
<p>I am not at all an UEFI or even Secure Boot expert<br />
but as far as I see there is not something apparently<br />
going wrong in your "rear -d -D mkrescue" log.</p>
<p>@porana<br />
could you re-run "rear -d -D mkrescue" with</p>
<pre>
KEEP_BUILD_DIR="yes"
</pre>

<p>in your etc/rear/local.conf file and<br />
then inspect if the contents of your<br />
$TMPDIR/rear.XXXXXXXXXXXXXXX/rootfs/<br />
look o.k. - in particular whether or not all<br />
needed files for UEFI Secure Boot are there?</p>
<h4 id="porana_commented_at_2017-06-13_0730"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308031696">2017-06-13 07:30</a>:<a class="headerlink" href="#porana_commented_at_2017-06-13_0730" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix,</p>
<p>Thanks for your time. as per our understanding, secure boot does not
have any extra files other than shim.efi. secure boot validates the efi
applications(like BOOTX64.efi. shim.efi, grub.efi, etc,...) using secure
boot tools. whether it has valid signature on that file?</p>
<p>we have following observations from the log file:</p>
<pre><code>/usr/share/rear/output/ISO/Linux-i386/25_populate_efibootimg.sh
++ cp -v /boot/efi/EFI/sles_sap/shim.efi /tmp/rear.IfJpNOAQSVgsczd/tmp/mnt/EFI/BOOT/BOOTX64.efi
'/boot/efi/EFI/sles_sap/shim.efi' -&gt; '/tmp/rear.IfJpNOAQSVgsczd/tmp/mnt/EFI/BOOT/BOOTX64.efi'
</code></pre>
<p>here its copying shim.efi to BOOTX64.efi, here if we verify the
signature using sbverify tool, it will show you some signature table has
present.</p>
<pre><code>rear199:/var/log/rear # sbverify /boot/efi/EFI/sles_sap/shim.efi
warning: data remaining[1045472 vs 1170720]: gaps between PE/COFF sections?
Signature verification failed
</code></pre>
<p>we tried to reproduce the same manually. we can see that shim.efi has
signature table present.</p>
<pre><code>rear199:/var/log/rear # cp -v /boot/efi/EFI/sles_sap/shim.efi /tmp/mnt/EFI/BOOT/BOOTX64.efi
'/boot/efi/EFI/sles_sap/shim.efi' -&gt; '/tmp/mnt/EFI/BOOT/BOOTX64.efi'
rear199:/var/log/rear # sbverify /tmp/mnt/EFI/BOOT/BOOTX64.efi
warning: data remaining[1045472 vs 1170720]: gaps between PE/COFF sections?
Signature verification failed
</code></pre>
<p>after copying to BOOTX64.efi also, there is no change in the signature
table.</p>
<p>after this rear is trying to create bootable grub2 image using
grub2-mkimage command.</p>
<p><code>grub2-mkimage -v -O x86_64-efi -c /tmp/mnt/EFI/BOOT/embedded_grub.cfg -o /tmp/mnt/EFI/BOOT/BOOTX64.efi -p /EFI/BOOT part_gpt part_msdos fat ext2 normal chain boot configfile linux linuxefi multiboot jfs iso9660 usb usbms usb_keyboard video udf ntfs all_video gzio efi_gop reboot search test echo btrfs</code></p>
<p>after running this comamnd, we verified the BOOTx64.efi with sbverify
comamnd. here its giving the error saying no signature table present</p>
<pre><code>rear199:/tmp/mnt/EFI/BOOT # sbverify /tmp/mnt/EFI/BOOT/BOOTX64.efi
No signature table present
Signature verification failed
</code></pre>
<p>looks like grub2-mkimage is wiping out the secure boot signature table
on BOOTX64.efi.<br />
we are not sure here, is there a way to create signature on the
BOOTX64.efi, after grub2-mkimage comamnd executed. or is there a way to
retain the signature table while running grub2-mkimage on BOOTX64.efi.</p>
<p>@gdha , @gozora , @pavoldomin do you have any input on this issue, as
you guys worked similar issue
<a href="https://github.com/rear/rear/issues/702">https://github.com/rear/rear/issues/702</a>
earlier.</p>
<h4 id="gozora_commented_at_2017-06-13_0823"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308043744">2017-06-13 08:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-13_0823" title="Permanent link">&para;</a></h4>
<p>Hi @porana,</p>
<p>I'll certainly take a look on this issue but it will take couple of
days. I've returned from vacation yesterday evening and need to solve
couple of (for me) priority things first.<br />
It would help me if you could upload your recovery image (*.iso)
somewhere. You can provide me login credentials to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#99;&#64;&#103;&#111;&#122;&#111;&#114;&#97;&#46;&#115;&#107;">&#99;&#64;&#103;&#111;&#122;&#111;&#114;&#97;&#46;&#115;&#107;</a> if
needed.</p>
<p>V.</p>
<h4 id="porana_commented_at_2017-06-13_1025"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308074039">2017-06-13 10:25</a>:<a class="headerlink" href="#porana_commented_at_2017-06-13_1025" title="Permanent link">&para;</a></h4>
<p>Hi @gozora,</p>
<p>Thanks for your commitment.<br />
i have uploaded the *.iso file to dropbox and i have given permissions
for you (<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#99;&#64;&#103;&#111;&#122;&#111;&#114;&#97;&#46;&#115;&#107;">&#99;&#64;&#103;&#111;&#122;&#111;&#114;&#97;&#46;&#115;&#107;</a>). you can download it from there. if you have any
problem creating account for dropbox, please let me know i can share you
the direct link for the iso download.</p>
<p>Thanks &amp; Regards,<br />
Jagan</p>
<h4 id="gozora_commented_at_2017-06-13_1049"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308079223">2017-06-13 10:49</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-13_1049" title="Permanent link">&para;</a></h4>
<p>@porana I've got the iso, thanks.</p>
<h4 id="gozora_commented_at_2017-06-13_1243"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308103478">2017-06-13 12:43</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-13_1243" title="Permanent link">&para;</a></h4>
<p>@porana just by heaving a quick look on this issue please try to
download and install <a href="https://github.com/rear/rear/releases/tag/rear-2.1">latest ReaR
version</a> which
contains some commits that might help to resolve your issue (9a31a5fa
and his predecessors).</p>
<p>I'd recommend first try ReaR 2.1 without following parameters:</p>
<pre><code>USING_UEFI_BOOTLOADER=1
UEFI_BOOTLOADER=/boot/efi/EFI/sles_sap/shim.efi
</code></pre>
<p>If you still have trouble with booting please attach output log from
<code>rear -d -D mkrescue</code> (located in /var/log/rear/ directory).</p>
<p>V.</p>
<h4 id="porana_commented_at_2017-06-14_0700"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308337971">2017-06-14 07:00</a>:<a class="headerlink" href="#porana_commented_at_2017-06-14_0700" title="Permanent link">&para;</a></h4>
<p>Hi @gozora,</p>
<p>Even with Rear 2.1 also, its same issue. you can find the attached log
file for the same.</p>
<p><a href="https://github.com/rear/rear/files/1073747/rear-rear199.zip">rear-rear199.zip</a><br />
its still not booting with secure boot enabled.</p>
<h4 id="gozora_commented_at_2017-06-14_0847"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308365922">2017-06-14 08:47</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-14_0847" title="Permanent link">&para;</a></h4>
<p>Thanks @porana,<br />
Is <em>Relax-and-Recover </em><em>(no Secure Boot)</em>** boot option working for you?</p>
<p>V.</p>
<h4 id="porana_commented_at_2017-06-14_0937"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308379113">2017-06-14 09:37</a>:<a class="headerlink" href="#porana_commented_at_2017-06-14_0937" title="Permanent link">&para;</a></h4>
<p>@gozora I think there was some miscommunication. Let me explain you the
issue once again.</p>
<p>Option 1:<br />
if Secure boot enabled at <strong><em>BIOS</em></strong> level on the server, the rescue
image fails to boot. we did not even get the grub menu of
Relax-and-Recover.</p>
<p>Option 2:<br />
if Secure boot disabled at <strong><em>BIOS</em></strong> level on the server, the same
rescue image boots and we get the grub menu of Relax-and-Recover. i.e.
it will show all the 4 options on the grub menu.</p>
<ol>
<li>Relax-and-Recover (no Secure Boot)</li>
<li>Relax-and-Recover (Secure Boot)</li>
<li>Reboot</li>
<li>Exit to EFI shell</li>
</ol>
<p>in this case both Relax-and-Recover (Secure Boot) and Relax-and-Recover
(no Secure Boot) options works fine and we are able to do recovery.</p>
<p>in our case all our severs are default secure boot enabled at <strong><em>BIOS</em></strong>
level. so we are not able to boot with the rescue image. if we disable
the secure boot at <strong><em>BIOS</em></strong> level, then only we are able to boot with
the rescue image.</p>
<p>let us know, if you still does not understand the issue. we will try to
send some screen shots.</p>
<h4 id="ipcctv_commented_at_2017-06-14_2119"><img src="https://avatars.githubusercontent.com/u/17221517?v=4" width="50"><a href="https://github.com/ipcctv">ipcctv</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308561327">2017-06-14 21:19</a>:<a class="headerlink" href="#ipcctv_commented_at_2017-06-14_2119" title="Permanent link">&para;</a></h4>
<p>I've been looking at this on HP DL360 Gen 9 servers recently when
using<br />
RHEL. In my rear logs, I saw io errors when accessing the NVRAM
variables.<br />
Access to this area being blocked for security reasons by secure boot.</p>
<p>On HP servers at least, if you do have a good backup from server A,
and<br />
are trying to restore to a different server, you can during boot, use
the<br />
advanced features (F9) I think and there is a 'add' option. You get a
file<br />
explorer type menu to navigate down to the boot option.</p>
<p>On 14 June 2017 at 10:37, porana <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>@gozora <a href="https://github.com/gozora">https://github.com/gozora</a> I think
there was some<br />
miscommunication. Let me explain you the issue once again.</p>
<p>Option 1:<br />
if Secure boot enabled at <em>BIOS</em> level on the server, the rescue
image<br />
fails to boot. we did not even get the grub menu of Relax-and-Recover.</p>
<p>Option 2:<br />
if Secure boot disabled at <em>BIOS</em> level on the server, the same
rescue<br />
image boots and we get the grub menu of Relax-and-Recover. i.e. it
will<br />
show all the 4 options on the grub menu.</p>
<ol>
<li>Relax-and-Recover (no Secure Boot)</li>
<li>Relax-and-Recover (Secure Boot)</li>
<li>Reboot</li>
<li>Exit to EFI shell</li>
</ol>
<p>in this case both Relax-and-Recover (Secure Boot) and
Relax-and-Recover<br />
(no Secure Boot) options works fine and we are able to do recovery.</p>
<p>in our case all our severs are default secure boot enabled at <em>BIOS</em><br />
level. so we are not able to boot with the rescue image. if we disable
the<br />
secure boot at <em>BIOS</em> level, then only we are able to boot with the<br />
rescue image.</p>
<p>let us know, if you still does not understand the issue. we will try
to<br />
send some screen shots.</p>
<p>â€”<br />
You are receiving this because you are subscribed to this thread.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/1374#issuecomment-308379113">https://github.com/rear/rear/issues/1374#issuecomment-308379113</a>,
or mute<br />
the thread<br />
<a href="https://github.com/notifications/unsubscribe-auth/AQbHjR57ld5Sp34vh7zfi48H7LMSn_W6ks5sD6n2gaJpZM4Nv5u5">https://github.com/notifications/unsubscribe-auth/AQbHjR57ld5Sp34vh7zfi48H7LMSn_W6ks5sD6n2gaJpZM4Nv5u5</a><br />
.</p>
</blockquote>
<h4 id="porana_commented_at_2017-06-15_1221"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308714170">2017-06-15 12:21</a>:<a class="headerlink" href="#porana_commented_at_2017-06-15_1221" title="Permanent link">&para;</a></h4>
<p>Hi @gozora, for better understanding of the issue, we have created a
video and uploaded to the dropbox. please have a watch.</p>
<h4 id="gozora_commented_at_2017-06-16_0727"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308954441">2017-06-16 07:27</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-16_0727" title="Permanent link">&para;</a></h4>
<p>@porana I'll try to reproduce your problem next days.</p>
<h4 id="porana_commented_at_2017-06-16_0915"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-308976239">2017-06-16 09:15</a>:<a class="headerlink" href="#porana_commented_at_2017-06-16_0915" title="Permanent link">&para;</a></h4>
<p>@gozora Thanks a lot for your time.<br />
hope you understood the issue now.</p>
<h4 id="gozora_commented_at_2017-06-16_1723"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-309084899">2017-06-16 17:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-16_1723" title="Permanent link">&para;</a></h4>
<p>@porana looks like I'm on the track!</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/12116358/27237340-056a91ae-52c9-11e7-86bc-363fd7c6d380.png" /></p>
<p>First time in my life when I'm actually happy that something is not
booting :-).</p>
<p>V.</p>
<h4 id="porana_commented_at_2017-06-17_0856"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-309202929">2017-06-17 08:56</a>:<a class="headerlink" href="#porana_commented_at_2017-06-17_0856" title="Permanent link">&para;</a></h4>
<p>@gozora, I'm also very happy after seeing that message.<br />
good that you are able to reproduce the issue looks like.</p>
<p>the below SUSE link can give you some insight into the secure boot, how
it implemented in SLES.<br />
<a href="url">https://www.suse.com/documentation/sled11/book_sle_admin/data/sec_uefi_secboot.html</a></p>
<h4 id="gozora_commented_at_2017-06-18_1155"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-309273113">2017-06-18 11:55</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-18_1155" title="Permanent link">&para;</a></h4>
<p>Finally I have SLE12 SP2 booted in Secure boot mode!<br />
@porana can you please send me output from following command:</p>
<pre><code>echo "===PK==="; mokutil --pk; echo "===KEK==="; mokutil --kek; echo "===DB==="; mokutil --db
</code></pre>
<p>I'm starting to have a dim feeling that current ReaR code can't work
correctly with enabled Secure boot ...<br />
I'll continue with investigation in next days.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-06-18_1623"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-309287539">2017-06-18 16:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-18_1623" title="Permanent link">&para;</a></h4>
<p>Hello @porana,</p>
<p>I've created small
<a href="https://github.com/gozora/rear/commit/1686526e5e4d79fb4ea922fb121d88f8af4dccce">patch</a>
that should resolve your problem.</p>
<p>Please download and install ReaR from my Github page
(<code>git clone https://github.com/gozora/rear.git</code>).<br />
If not done already, add
<code>UEFI_BOOTLOADER=/boot/efi/EFI/sles_sap/shim.efi</code> to your
<em>/etc/rear/local.conf</em>. Then you just need to recreate your ReaR
recovery system (<code>rear mkrescue</code>) and try to boot newly created ISO.<br />
With this patch, ReaR booted with Secure boot without any problems.</p>
<p>V.</p>
<h4 id="porana_commented_at_2017-06-19_1233"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-309425961">2017-06-19 12:33</a>:<a class="headerlink" href="#porana_commented_at_2017-06-19_1233" title="Permanent link">&para;</a></h4>
<p>HI @gozora,</p>
<p>Thanks for the patch. it has solved our problem.<br />
now we are able to boot with rescue image when secure boot enabled.</p>
<p>once again, thanks a lot!!!</p>
<h4 id="gozora_commented_at_2017-06-21_1546"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-310121286">2017-06-21 15:46</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-21_1546" title="Permanent link">&para;</a></h4>
<p>With #1385 merged, this issue can be closed.</p>
<p>@porana please be aware that we've changed ReaRs behavior a bit.<br />
If you decide to use upstream version be sure to update your
configuration as follows:</p>
<pre><code>- UEFI_BOOTLOADER=/boot/efi/EFI/sles_sap/shim.efi
+ SECURE_BOOT_BOOTLOADER="/boot/efi/EFI/sles_sap/shim.efi"
</code></pre>
<h4 id="porana_commented_at_2017-06-22_0655"><img src="https://avatars.githubusercontent.com/u/28658860?v=4" width="50"><a href="https://github.com/porana">porana</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-310292829">2017-06-22 06:55</a>:<a class="headerlink" href="#porana_commented_at_2017-06-22_0655" title="Permanent link">&para;</a></h4>
<p>@gozora, Thanks<br />
this make sense, instead of just copying the same Boot loader.</p>
<h4 id="jsmeix_commented_at_2017-06-22_0737"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-310301134">2017-06-22 07:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-06-22_0737" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
as always you did great debugging and<br />
fixing/improving UEFI related stuff in ReaR.<br />
Many thanks for it!</p>
<h4 id="gozora_commented_at_2017-06-22_0740"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1374#issuecomment-310301643">2017-06-22 07:40</a>:<a class="headerlink" href="#gozora_commented_at_2017-06-22_0740" title="Permanent link">&para;</a></h4>
<p>@jsmeix it was fun after all, and except that I have test environment
with working Secure Boot!!!<br />
So, no problem ;-).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-06-05.1374.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
