<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2795 PR merged: Verify file hashes at the end of recover after file restore from backup - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2795 PR merged: Verify file hashes at the end of recover after file restore from backup";
        var mkdocs_page_input_path = "issues/2022-04-26.2795.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2795 PR merged: Verify file hashes at the end of recover after file restore from backup</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2795_pr_merged_verify_file_hashes_at_the_end_of_recover_after_file_restore_from_backup"><a href="https://github.com/rear/rear/pull/2795">#2795 PR</a> <code>merged</code>: Verify file hashes at the end of recover after file restore from backup<a class="headerlink" href="#2795_pr_merged_verify_file_hashes_at_the_end_of_recover_after_file_restore_from_backup" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2022-04-26_1624"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2795">2022-04-26 16:24</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2022-04-26_1624" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL): #2785</p>
</li>
<li>
<p>How was this pull request tested?<br />
    On RHEL 8.5: <code>rear mkbackuponly</code>, change of UUID of <code>/boot</code> and
    remount, <code>rear mkrescue</code> and recovery.<br />
    After recovery, the system does not boot, as it can not mount
    <code>/boot</code>. After manual fixing of <code>/etc/fstab</code>, checked the recovery
    log - it contains</p>
</li>
</ul>
<!-- -->

<pre><code>2022-04-26 10:17:49.073321433 Including finalize/default/060_compare_files.sh
2022-04-26 10:17:49.082885638 Some configuration files in the restored system do not match the saved layout!
</code></pre>
<ul>
<li>Brief description of the changes in this pull request:</li>
</ul>
<p>Configuration files can get out-of-sync with the recreated layout. This
leads to inconsistent configuration, e.g. filesystem not mountable at
boot, if they are mounted by UUIDs, and failures to migrate UUIDs in
files (if needed).</p>
<p>To detect this problem, use the saved md5sums of configuration files
(originally used for "checklayout") to verify the restored files and
inform the user in the case of a mismatch.</p>
<p>No attempt is made to repair the problem; the user is informed, but they
must fix the problem manually.</p>
<p>If a file may need a migration of UUIDs, then it is very likely prone to
get out-of-sync with the layout if it gets modified. Add all such files
to the list of files whose hashes are recorded in the saved layout to
detect such problems.</p>
<p>Introduce a variable called <code>FILES_TO_PATCH_PATTERNS</code> to hold the list
of these files (shell glob patterns, actually), as it is now needed in
multiple places.</p>
<p>Change <code>finalize/GNU/Linux/250_migrate_disk_devices_layout.sh</code> to use
<code>FILES_TO_PATCH_PATTERNS</code> as well.</p>
<p>Supersedes #2788 , #2786</p>
<p>TODO: the log says that files have changed, but it does not say which
files. The md5sum output contains this information, but it does not
appear in the log. What is the best way to show the output in the log?</p>
<h4 id="pcahyna_commented_at_2022-04-26_1626"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1110000894">2022-04-26 16:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-26_1626" title="Permanent link">&para;</a></h4>
<p>Suggestions for alternative wording of the message (should it be made
more prominent, e.g. by prefixing it with "WARNING!"?) and an
alternative name for <code>FILES_TO_PATCH_PATTERNS</code> are welcome.</p>
<h4 id="jsmeix_commented_at_2022-04-27_0948"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1110798744">2022-04-27 09:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_0948" title="Permanent link">&para;</a></h4>
<p>In general regarding non fatal errors and LogPrintError usage:</p>
<p>In case of non fatal errors they should be prefixed with "Error: "<br />
in the LogPrintError message, e.g. see the commit message in my<br />
<a href="https://github.com/rear/rear/pull/2788/commits/cf96b605420a24514a96bf543977a1ba70f56343">https://github.com/rear/rear/pull/2788/commits/cf96b605420a24514a96bf543977a1ba70f56343</a></p>
<pre><code>decide for the user that ... is an error so show it as "Error" to the user, cf.
https://schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html
</code></pre>
<p>By the way:<br />
LogPrintError does not automatically add an "Error: " prefix<br />
because LogPrintError is intended to be also used for<br />
"error-like" messages when the user must decide if that means<br />
a real error in his case, see the comment at the LogPrintError
function<br />
in rear/lib/_input-output-functions.sh which is currently online at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/_input-output-functions.sh#L492">https://github.com/rear/rear/blob/master/usr/share/rear/lib/_input-output-functions.sh#L492</a></p>
<h4 id="jsmeix_commented_at_2022-04-27_1009"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1110819672">2022-04-27 10:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_1009" title="Permanent link">&para;</a></h4>
<p>In general how to show command stdout and stderr output<br />
on the users's terminal and also have it in the log file,<br />
see backup/BORG/default/500_make_backup.sh<br />
where the general form is<br />
(including stdin redirection from the users's keyboard)</p>
<pre><code>COMMAND 0&lt;&amp;6 1&gt;&gt; &gt;( tee -a "$RUNTIME_LOGFILE" 1&gt;&amp;7 ) 2&gt;&gt; &gt;( tee -a "$RUNTIME_LOGFILE" 1&gt;&amp;8 )
</code></pre>
<p>For the reason why this is used as general form<br />
see the lengthy comments at<br />
<a href="https://github.com/rear/rear/pull/2382#pullrequestreview-403320309">https://github.com/rear/rear/pull/2382#pullrequestreview-403320309</a></p>
<p>Perhaps this could be done in a simpler and more straightforward way<br />
but I don't have the needed expert knowledge in this area<br />
to fully understand what actually goes on with such redirections.</p>
<h4 id="pcahyna_commented_at_2022-04-27_1039"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1110847776">2022-04-27 10:39</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-27_1039" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In general regarding non fatal errors and LogPrintError usage:</p>
<p>In case of non fatal errors they should be prefixed with "Error: " in
the LogPrintError message, e.g. see the commit message in my
<a href="https://github.com/rear/rear/commit/cf96b605420a24514a96bf543977a1ba70f56343">cf96b60</a></p>
<pre><code>decide for the user that ... is an error so show it as "Error" to the user, cf.
https://schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html
</code></pre>
<p>By the way: LogPrintError does not automatically add an "Error: "
prefix because LogPrintError is intended to be also used for
"error-like" messages when the user must decide if that means a real
error in his case, see the comment at the LogPrintError function in
rear/lib/_input-output-functions.sh which is currently online at
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/_input-output-functions.sh#L492">https://github.com/rear/rear/blob/master/usr/share/rear/lib/_input-output-functions.sh#L492</a></p>
</blockquote>
<p>I agree with displaying it as <code>Error:</code> because while not fatal, the
condition is likely serious and and often needs manual intervention.</p>
<h4 id="jsmeix_commented_at_2022-04-27_1043"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1110851069">2022-04-27 10:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-27_1043" title="Permanent link">&para;</a></h4>
<p>In general regarding what to do in case of a FAILED md5sum<br />
cf. skel/default/etc/scripts/system-setup</p>
<pre><code># In case of a FAILED md5sum inform the user:
echo "Possibly corrupted Relax-and-Recover rescue system"
</code></pre>
<p>Here plain <code>echo</code> is used because during recovery system startup<br />
we do not have ReaR functions (rear is not running).</p>
<p>When something went wrong during "rear recover" we at least<br />
show the issue to the user (which is done in this pull request)<br />
and sometimes we let the user confirm it via an appropriate UserInput
call<br />
or we may force the user to make decisions via an appropriate user
dialog.</p>
<p>When restored config files are inconsistent with the recreated system<br />
I think we should not continue "rear recover" but instead force<br />
the user to make decisions via an appropriate user dialog.<br />
Usually one user dialog option is to<br />
"Use Relax-and-Recover shell and return back to here"<br />
so the user could manually fix things before proceeding.</p>
<p>This is not needed in this pull request here.<br />
Better enhance it step by step with separated pull requests.</p>
<h4 id="pcahyna_commented_at_2022-04-27_1612"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1111191978">2022-04-27 16:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-27_1612" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In general how to show command stdout and stderr output on the users's
terminal and also have it in the log file, see
backup/BORG/default/500_make_backup.sh where the general form is
(including stdin redirection from the users's keyboard)</p>
<pre><code>COMMAND 0&lt;&amp;6 1&gt;&gt; &gt;( tee -a "$RUNTIME_LOGFILE" 1&gt;&amp;7 ) 2&gt;&gt; &gt;( tee -a "$RUNTIME_LOGFILE" 1&gt;&amp;8 )
</code></pre>
<p>For the reason why this is used as general form see the lengthy
comments at <a href="https://github.com/rear/rear/pull/2382#pullrequestreview-403320309">#2382
(review)</a></p>
<p>Perhaps this could be done in a simpler and more straightforward way
but I don't have the needed expert knowledge in this area to fully
understand what actually goes on with such redirections.</p>
</blockquote>
<p>What I don't understand:
<a href="https://github.com/rear/rear/wiki/Coding-Style#what-to-do-with-stdin-stdout-and-stderr">https://github.com/rear/rear/wiki/Coding-Style#what-to-do-with-stdin-stdout-and-stderr</a>
says "Because stdout and stderr are redirected into ReaR's log file
(...)", but I don't see the output from md5sum in the log file anywhere
(with my current code).</p>
<p>And according to the linked discussion, one should be able to use <code>2&gt;</code>
instead of <code>2&gt;&gt;</code>, am I right?</p>
<h4 id="jsmeix_commented_at_2022-04-28_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1111870052">2022-04-28 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-28_0759" title="Permanent link">&para;</a></h4>
<p>In general regarding <code>1&gt;</code> and <code>2&gt;</code> versus <code>1&gt;&gt;</code> and <code>2&gt;&gt;</code>:</p>
<p>See usr/sbin/rear</p>
<pre><code># To be on the safe side append to the log file '&gt;&gt;' instead of plain writing to it '&gt;'
# because when a program (bash in this case) is plain writing to the log file it can overwrite
# output of a possibly simultaneously running process that likes to append to the log file
# (e.g. when a background process runs that also uses the ReaR log file for logging).
</code></pre>
<p>In general all log messages must be always appended<br />
because previous log messages must never be overwritten<br />
(it is the whole point of a log that existing entries are sacrosanct).</p>
<p>For better readability here a quotation what I had written in<br />
<a href="https://github.com/rear/rear/pull/2382#pullrequestreview-403320309">https://github.com/rear/rear/pull/2382#pullrequestreview-403320309</a><br />
(excerpts):</p>
<pre><code>I think when using process substitution we must ensure
to append to the filename that is the result of the process substitution
because when we do not append we overwrite existing things in that file.
So I think we must append via
2&gt;&gt; &gt;( COMMAND )
instead of plain writing via
2&gt; &gt;( COMMAND )
...
Meanwhile I think when using process substitution &gt;( COMMAND )
we could use both 2&gt;&gt; &gt;( COMMAND ) and 2&gt; &gt;( COMMAND )
because &gt;( COMMAND ) evaluates to a file name where to the
current bash writes and where from COMMAND gets its stdin.
Usually that intermediate file is a named pipe (FIFO).
I think it does not matter if the current bash writes or appends to
that intermediate file because the current bash is a single process
so that both methods result that all is written sequentially and
nothing is overwritten by another process (i.e. the current bash is
the only writer to that intermediate file).
But what matters is that COMMAND appends to the ReaR log file
because when using process substitution COMMAND is run
asynchronously as another process beside the current bash.
Because the current bash has stdout redirected to the log file
now the process substitution 2&gt; &gt;( COMMAND ) also writes
asynchronously to the ReaR log file at the same time while
the current bash stdout appends to the ReaR log file.
With
COMMAND = tee -a $RUNTIME_LOGFILE
I am sure it appends to the ReaR log file.
</code></pre>
<p>So</p>
<pre><code>2&gt;&gt; &gt;( tee -a $RUNTIME_LOGFILE )
</code></pre>
<p>is simple (just use append mode everywhere in case of log messages)<br />
while in contrast</p>
<pre><code>2&gt; &gt;( tee -a $RUNTIME_LOGFILE )
</code></pre>
<p>has a complicated reasoning behind why that could also work.</p>
<p>Because I don't see a reason why <code>2&gt;</code> is better here than <code>2&gt;&gt;</code><br />
I would prefer to<br />
"just use append mode everywhere in case of log messages".</p>
<p>Or is there a reason why <code>2&gt;</code> is better here than <code>2&gt;&gt;</code> ?</p>
<h4 id="jsmeix_commented_at_2022-04-28_0836"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1111904371">2022-04-28 08:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-28_0836" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your "I don't see the output from md5sum in the log file":</p>
<p>See usr/sbin/rear</p>
<pre><code># In debug modes stdout and stderr are redirected to the log
# cf. https://github.com/rear/rear/issues/2416
# In non-debug modes (in particular also in verbose mode)
# stdout and stderr are redirected to a temporary file if possible
# i.e. when TMP_DIR exists - it does not exist for the 'help' workflow
...
# In non-debug modes the log cannot contain possibly false alarm messages
# cf. https://github.com/rear/rear/issues/2416
# but in non-debug modes stdout and stderr of all programs is still available
# for the Error function to extract some latest messages
# cf. https://github.com/rear/rear/issues/2623
</code></pre>
<p>I updated<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style#what-to-do-with-stdin-stdout-and-stderr">https://github.com/rear/rear/wiki/Coding-Style#what-to-do-with-stdin-stdout-and-stderr</a></p>
<p>Thank you for pointing out the outdated info in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="pcahyna_commented_at_2022-04-28_1341"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1112218957">2022-04-28 13:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-28_1341" title="Permanent link">&para;</a></h4>
<p>I changed the error message in de9a211b557f97ef08a2ecc2029f3f543a821a57.</p>
<h4 id="pcahyna_commented_at_2022-04-28_1347"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1112227700">2022-04-28 13:47</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-28_1347" title="Permanent link">&para;</a></h4>
<p>@jsmeix I think I addressed all your review comments except for adding
<code>crypttab</code> to the list of file patterns.</p>
<h4 id="pcahyna_commented_at_2022-04-28_1350"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1112230957">2022-04-28 13:50</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-28_1350" title="Permanent link">&para;</a></h4>
<p>@bwelterl can you please have a look if you are interested? This should
address your comment
<a href="https://github.com/rear/rear/pull/2788#discussion_r850477309">https://github.com/rear/rear/pull/2788#discussion_r850477309</a></p>
<h4 id="pcahyna_commented_at_2022-04-28_1541"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1112363240">2022-04-28 15:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-28_1541" title="Permanent link">&para;</a></h4>
<p>I repeated the test with the updated code. The log now has:</p>
<pre><code>2022-04-28 11:26:08.986818408 Including finalize/default/060_compare_files.sh
/etc/rear/local.conf: FAILED
/etc/mtab: FAILED open or read
/etc/fstab: FAILED
md5sum: /etc/mtab: No such file or directory
md5sum: WARNING: 1 listed file could not be read
md5sum: WARNING: 2 computed checksums did NOT match
2022-04-28 11:26:09.002365987 Error: configuration files shown above in the restored system do not match the saved layout!
</code></pre>
<p>In the test I changed local.conf between <code>mkbackuponly</code> and <code>mkrescue</code>.
It is a question if the check should fail because of this mismatch, but
if not, probably <code>/etc/rear/</code> should not be in <code>CHECK_CONFIG_FILES</code> at
all.<br />
The <code>mtab</code> error is more serious, I am afraid it will appear every time,
making the check practically useless - do we really want to patch UUIDs
in <code>mtab</code> ? ( On this system, <code>/etc/mtab</code> is a symlink to
../proc/self/mounts`. )</p>
<h4 id="jsmeix_commented_at_2022-04-29_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1113105441">2022-04-29 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-29_0927" title="Permanent link">&para;</a></h4>
<p>Regarding
<a href="https://github.com/rear/rear/pull/2795#issuecomment-1112363240">https://github.com/rear/rear/pull/2795#issuecomment-1112363240</a></p>
<p>Regarding<br />
FILES_TO_PATCH_PATTERNS=" ... [e]tc/mtab ..."</p>
<p>I have<br />
on SLES 10 SP4</p>
<pre><code># file /etc/mtab 
/etc/mtab: ASCII text
</code></pre>
<p>on SLES11 SP4</p>
<pre><code># file /etc/mtab
/etc/mtab: ASCII text
</code></pre>
<p>on SLES12 SP5</p>
<pre><code># file /etc/mtab
/etc/mtab: symbolic link to ../proc/self/mounts
</code></pre>
<p>on SLES15 SP3</p>
<pre><code># file /etc/mtab
/etc/mtab: symbolic link to ../proc/self/mounts
</code></pre>
<p>In curent ReaR master code</p>
<pre><code># find usr/share/rear -type f | xargs grep 'mtab'
</code></pre>
<p>shows several scripts where we have special mtab handling<br />
in particular the finalize scripts</p>
<pre><code>finalize/GNU/Linux/250_migrate_disk_devices_layout.sh
finalize/GNU/Linux/250_migrate_lun_wwid.sh
finalize/GNU/Linux/320_migrate_network_configuration_files.sh
finalize/GNU/Linux/260_rename_diskbyid.sh
finalize/GNU/Linux/280_migrate_uuid_tags.sh
</code></pre>
<p>mention <code>the symlink target of etc/mtab is /mnt/local/proc/12345/mounts</code></p>
<p>We have special symlink handling in those finalize scripts<br />
that originated in particular for mtab at<br />
<a href="https://github.com/rear/rear/pull/2048">https://github.com/rear/rear/pull/2048</a><br />
"Do not patch $TARGET_FS_ROOT/etc/mtab if symbolic link"<br />
which means on the other hand that<br />
we do patch $TARGET_FS_ROOT/etc/mtab if it is not a symbolic link.</p>
<p>Because current ReaR master code supports when etc/mtab is not a
symbolic link<br />
I think we should not abandon this support now with this pull request.</p>
<p>So I think special symlink handling is needed for the files<br />
where FILES_TO_PATCH_PATTERNS evaluates to.</p>
<p>Offhandedly I think special handling of symlinks and<br />
other special files (e.g. files in /proc/ /sys/ /dev/ or /run/)<br />
is needed in <code>layout/save/default/600_snapshot_files.sh</code><br />
that matches the special handling of symlink and other special files<br />
in the above mentioned finalize scripts (perhaps not an exact copy<br />
of what is done in those finalize scripts but something similar).</p>
<p>Simply put:<br />
Offhandedly I think usually (i.e. except possible exceptions)<br />
files that will be skipped when patching in the finalize stage<br />
should also be skipped by this md5sum test here<br />
because this md5sum test here is not and<br />
cannot be meant to verify if all restored config files are OK,<br />
instead this test is only meant to check if certain restored files<br />
of specific interest for "rear recover" are OK.</p>
<h4 id="jsmeix_commented_at_2022-04-29_0951"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1113124577">2022-04-29 09:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-29_0951" title="Permanent link">&para;</a></h4>
<p>Regarding
<a href="https://github.com/rear/rear/pull/2795#issuecomment-1112363240">https://github.com/rear/rear/pull/2795#issuecomment-1112363240</a></p>
<p>CHECK_CONFIG_FILES=( ... '/etc/rear/' ... )</p>
<p><code># git log --follow -p usr/share/rear/conf/default.conf</code><br />
shows that this originated at<br />
<a href="https://github.com/rear/rear/commit/929279d9cc8a19e683680b900ee2b21f14177808">https://github.com/rear/rear/commit/929279d9cc8a19e683680b900ee2b21f14177808</a></p>
<p>As usual the old commits do not have any explanatory comment<br />
or a link to an issue that explanains things or something like that<br />
so we cannot know WHY /etc/rear/ was added to CHECK_CONFIG_FILES<br />
which gives us the freedom to do what we like from our current point of
view.</p>
<p>Currently I don't know whether or not<br />
/etc/rear/ should be in CHECK_CONFIG_FILES.</p>
<p>Offhandedly my gut feeling is that a changed local.conf<br />
between mkbackuponly and mkrescue calls for possible<br />
problems later during "rear recover" so it should be shown<br />
to the user during "rear recover" so that the user is made aware<br />
that there could be problems because of his changed local.conf</p>
<p>Cf. my meanwhile enhanced part<br />
"It is your task to ensure your backup is consistent"<br />
in the section<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
that reads in particular:</p>
<pre><code>... after each change of the basic system
... "rear mkbackup" needs to be run to create
a new ReaR recovery system together
with a matching new backup of the files
</code></pre>
<p>A changed local.conf indicates a change of the basic system<br />
or the changed local.conf could be itself considered as such a change<br />
of the basic system because ReaR belongs to the basic system<br />
when one considers disaster recovery as a basic system thing.</p>
<h4 id="pcahyna_commented_at_2022-05-02_1148"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1114759470">2022-05-02 11:48</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-02_1148" title="Permanent link">&para;</a></h4>
<p>Here's what the recovery log shows:</p>
<pre><code>/etc/rear/local.conf: FAILED
/etc/fstab: FAILED
md5sum: WARNING: 2 computed checksums did NOT match
2022-05-02 06:17:37.663028084 Error: configuration files shown above in the restored system do not match the saved layout!
</code></pre>
<p>(there is now a change to the last log message as you proposed.)<br />
And here are the messages from the log from <code>rear -d mkrescue</code></p>
<pre><code>2022-05-02 06:11:24.985098966 Including layout/save/default/600_snapshot_files.sh
2022-05-02 06:11:24.995463992 Adding symlink /etc/sysconfig/grub with target /etc/default/grub to CHECK_CONFIG_FILES
2022-05-02 06:11:25.004853338 Skip adding symlink /etc/mtab target /proc/22743/mounts on /proc/ /sys/ /dev/ or /run/ to CHECK_CONFIG_FILES
</code></pre>
<h4 id="pcahyna_commented_at_2022-05-02_1202"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1114769283">2022-05-02 12:02</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-02_1202" title="Permanent link">&para;</a></h4>
<p>I believe all the comments are addressed now and I consider the branch
ready to be merged (with squashing of commits marked as <code>fixup!</code> in
order to not overcomplicate history).</p>
<h4 id="jsmeix_commented_at_2022-05-02_1209"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1114774428">2022-05-02 12:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-02_1209" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for all your work here!<br />
It became really complicated to get it done correctly.<br />
Feel free to merge it when you like.</p>
<h4 id="pcahyna_commented_at_2022-05-02_1343"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1114899955">2022-05-02 13:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-02_1343" title="Permanent link">&para;</a></h4>
<p>@jsmeix yes, it is complicated. When thinking about the symlink support,
I realized that there is still a gap in the present approach: what if
another file that matches <code>CHECK_CONFIG_FILES</code> or
<code>FILES_TO_PATCH_PATTERNS</code> gets added (when it was missing previously)?
This won't be detected by <code>md5sum -c</code>, but may represent a change
relevant to layout. This may explain why <code>md5sum -c</code> is not used but the
complete list of checksums is regenerated and compared in
<code>layout/compare/default/510_compare_files.sh</code> :
<a href="https://github.com/rear/rear/pull/2788#issuecomment-1105249183">https://github.com/rear/rear/pull/2788#issuecomment-1105249183</a></p>
<h4 id="jsmeix_commented_at_2022-05-03_1151"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1116010676">2022-05-03 11:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_1151" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes, you are right - thank you for your sharp and thorough analysis!</p>
<p>The simple high level goal is to detect all changes in files where<br />
CHECK_CONFIG_FILES and FILES_TO_PATCH_PATTERNS<br />
evaluate to.</p>
<p>When CHECK_CONFIG_FILES and FILES_TO_PATCH_PATTERNS<br />
evaluate to different files this is a change that must be detected.</p>
<p>This means <code>md5sum -c</code> cannot be used here but instead the complete<br />
list of files must be regenerated and their checksums must be
regenerated<br />
and compared with the previous list of files and checksums.</p>
<p>This means the same checksum generating code as currently in your<br />
layout/save/default/600_snapshot_files.sh here in this pull request<br />
must be also run to regenerate those checksums in your new<br />
finalize/default/060_compare_files.sh here in this pull request<br />
and also in<br />
layout/compare/default/510_compare_files.sh in master code</p>
<h4 id="jsmeix_commented_at_2022-05-03_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1116068722">2022-05-03 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-03_1258" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I did a quick
<a href="https://github.com/rear/rear/pull/2796">https://github.com/rear/rear/pull/2796</a><br />
which is only meant as a proposal so you could have a look<br />
how things might be done according to<br />
<a href="https://github.com/rear/rear/pull/2795#issuecomment-1116010676">https://github.com/rear/rear/pull/2795#issuecomment-1116010676</a></p>
<p>I did not plain copy the your checksum generating code in<br />
layout/save/default/600_snapshot_files.sh here in this pull request<br />
but I modified it somewhat - in particular I do not add things<br />
to the user config variable CHECK_CONFIG_FILES<br />
but instead I use a local files_for_md5sum array<br />
because I feel uncertain changing user config variables.</p>
<h4 id="pcahyna_commented_at_2022-05-04_0916"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117093699">2022-05-04 09:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-04_0916" title="Permanent link">&para;</a></h4>
<blockquote>
<p>This means the same checksum generating code as currently in your<br />
layout/save/default/600_snapshot_files.sh here in this pull
request<br />
must be also run to regenerate those checksums in your new<br />
finalize/default/060_compare_files.sh here in this pull request<br />
and also in<br />
layout/compare/default/510_compare_files.sh in master code</p>
</blockquote>
<p>I don't think that any modification of
<code>layout/compare/default/510_compare_files.sh</code> (except for replacing the
<code>diff -u</code> by a better comparison like <code>cmp</code> and using <code>sort</code> to avoid
false warnings when the set of files is unchanged, but the order is
changed) is needed. <code>layout/save/default/600_snapshot_files.sh</code> appends
to the variable <code>CHECK_CONFIG_FILES</code>, so
<code>layout/compare/default/510_compare_files.sh</code> will inherit it (
<code>layout/save</code> is executed before <code>layout/compare</code> ). I now see that it
is highly non-obvious, so I should add a comment explaining it.<br />
You are right that if I move to something else than <code>md5sum -c</code> in
<code>finalize</code>, the same code needs to be run there
(<code>finalize/default/060_compare_files.sh</code>) to regenerate
<code>CHECK_CONFIG_FILES</code>.</p>
<h4 id="pcahyna_commented_at_2022-05-04_0925"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117101245">2022-05-04 09:25</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-04_0925" title="Permanent link">&para;</a></h4>
<blockquote>
<p>in particular I do not add things<br />
to the user config variable CHECK_CONFIG_FILES<br />
but instead I use a local files_for_md5sum array<br />
because I feel uncertain changing user config variables.</p>
</blockquote>
<p>I understand your feeling, but if we are to use an internal variable for
this, I think it should be global, not local (do we have a standard
prefix for global variables not exposed to the user?) and set only once
in <code>layout/save/default/600_snapshot_files.sh</code> to avoid duplication.</p>
<h4 id="jsmeix_commented_at_2022-05-04_1130"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117202668">2022-05-04 11:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-04_1130" title="Permanent link">&para;</a></h4>
<p>Meanwhile I think I am overcautious because<br />
we often modify config variables when needed<br />
(e.g. there are many <code>COPY_AS_IS+=</code> in the scripts)<br />
so it is OK to append to CHECK_CONFIG_FILES.</p>
<p>We do not have a special syntax for global nopn-config variables.<br />
In
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a>
there is only</p>
<pre><code>All variables that are used in more than a single script must be all-caps
</code></pre>
<h4 id="jsmeix_commented_at_2022-05-04_1142"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117212235">2022-05-04 11:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-04_1142" title="Permanent link">&para;</a></h4>
<p>I used layout/compare/default/510_compare_files.sh for my proposal
in<br />
<a href="https://github.com/rear/rear/pull/2796">https://github.com/rear/rear/pull/2796</a><br />
to not cause conflicts with your<br />
layout/save/default/600_snapshot_files.sh in this pull request here.</p>
<h4 id="pcahyna_commented_at_2022-05-04_1206"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117234279">2022-05-04 12:06</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-04_1206" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I used layout/compare/default/510_compare_files.sh for my proposal
in #2796 to not cause conflicts with your
layout/save/default/600_snapshot_files.sh in this pull request here.</p>
</blockquote>
<p>Ah ok, that's good. I propose to do one adjustment here: split
<code>layout/save/default/600_snapshot_files.sh</code> into two files: one would
adjust <code>CHECK_CONFIG_FILES</code> according to <code>FILES_TO_PATCH_PATTERNS</code> (my
new code) and the other would actually perform the hash calculation (the
original code). This would enable us to symlink the former from other
places and thus share the code, without having to always execute the
latter. Then I would merge it and do other improvements (like the issue
I found above, and #2796) separately.</p>
<h4 id="jsmeix_commented_at_2022-05-04_1216"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117243691">2022-05-04 12:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-04_1216" title="Permanent link">&para;</a></h4>
<p>My
<a href="https://github.com/rear/rear/pull/2795#issuecomment-1114774428">https://github.com/rear/rear/pull/2795#issuecomment-1114774428</a><br />
still holds. i.e.:<br />
Feel free to merge it when you like.</p>
<h4 id="pcahyna_commented_at_2022-05-04_1402"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1117352941">2022-05-04 14:02</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-04_1402" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks a lot for all your helpful review - I now added
<code>layout/save/default/490_check_files_to_patch.sh</code> with the new stuff and
retested, so if you are fine with the name, I am going to squash the
commits and merge.</p>
<h4 id="jsmeix_commented_at_2022-05-05_0706"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1118237748">2022-05-05 07:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-05_0706" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your patience with this complicated and laborious thing!</p>
<h4 id="pcahyna_commented_at_2022-05-05_1339"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1118565879">2022-05-05 13:39</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-05_1339" title="Permanent link">&para;</a></h4>
<p>Regarding</p>
<blockquote>
<p>When CHECK_CONFIG_FILES and FILES_TO_PATCH_PATTERNS evaluate to
different files this is a change that must be detected.</p>
<p>This means <code>md5sum -c</code> cannot be used here but instead the complete
list of files must be regenerated and their checksums must be
regenerated and compared with the previous list of files and
checksums.</p>
</blockquote>
<p>and</p>
<blockquote>
<p>I think <code>[e]tc/crypttab</code> should be added here because it contains
UUIDs.</p>
</blockquote>
<p>these issues remain.</p>
<p>The approach to solve the first one is discussed in
<a href="https://github.com/rear/rear/pull/2796#issuecomment-1118387393">https://github.com/rear/rear/pull/2796#issuecomment-1118387393</a>
.<br />
But since it likely is a rare issue, I believe that properly solving
#2787 will bring more benefit to users, if we want to continue
improving this stuff and need to choose what we will dedicate our time
to.</p>
<h4 id="jsmeix_commented_at_2022-05-05_1355"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2795#issuecomment-1118586494">2022-05-05 13:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-05_1355" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/58ddf3e094456df3c41f0b2089ee962d34836da6">https://github.com/rear/rear/commit/58ddf3e094456df3c41f0b2089ee962d34836da6</a><br />
I dared to "just add right now" <code>[e]tc/crypttab</code><br />
to FILES_TO_PATCH_PATTERNS in default.conf<br />
because I cannot imagine a reason why it should not be checked<br />
and patched if a UUID changed therein - i.e. I cannot imagine<br />
what could go wrong or could be worse when it is checked<br />
(and patched if needed) compared to ignoring it (as it was before).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-04-26.2795.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
