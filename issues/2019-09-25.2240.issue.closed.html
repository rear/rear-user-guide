<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2240 Issue closed: sshd segfault in ReaR recovery system (also segfaults in SLES15-SP1 system) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2240 Issue closed: sshd segfault in ReaR recovery system (also segfaults in SLES15-SP1 system)";
        var mkdocs_page_input_path = "issues/2019-09-25.2240.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2240 Issue closed: sshd segfault in ReaR recovery system (also segfaults in SLES15-SP1 system)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2240_issue_closed_sshd_segfault_in_rear_recovery_system_also_segfaults_in_sles15-sp1_system"><a href="https://github.com/rear/rear/issues/2240">#2240 Issue</a> <code>closed</code>: sshd segfault in ReaR recovery system (also segfaults in SLES15-SP1 system)<a class="headerlink" href="#2240_issue_closed_sshd_segfault_in_rear_recovery_system_also_segfaults_in_sles15-sp1_system" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>external tool</code>, <code>not ReaR / invalid</code></p>
<h4 id="shaunsjm_opened_issue_at_2019-09-25_1924"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> opened issue at <a href="https://github.com/rear/rear/issues/2240">2019-09-25 19:24</a>:<a class="headerlink" href="#shaunsjm_opened_issue_at_2019-09-25_1924" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.5 / 2019-05-10</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME="SLES"
VERSION="15-SP1"
VERSION_ID="15.1"
PRETTY_NAME="SUSE Linux Enterprise Server 15 SP1"
ID="sles"
ID_LIKE="suse"
ANSI_COLOR="0;32"
CPE_NAME="cpe:/o:suse:sles:15:sp1"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    LOCAL.CONF</li>
</ul>
<!-- -->

<pre><code># Begin example setup for SLE12-SP2 with default btrfs subvolumes.
# Since SLE12-SP1 what is mounted at '/' is a btrfs snapshot subvolume
# see https://github.com/rear/rear/issues/556
# and since SLE12-SP2 btrfs quota via "snapper setup-quota" is needed
# see https://github.com/rear/rear/issues/999
# You must adapt "your.NFS.server.IP/path/to/your/rear/backup" at BACKUP_URL.
# You must decide whether or not you want to have /home/* in the backup.
# It depends on the size of your harddisk whether or not /home is by default
# a btrfs subvolume or a separated xfs filesystem on a separated partition.
# You may activate SSH_ROOT_PASSWORD and adapt the "password_on_the_rear_recovery_system".
# For basic information see the SLE12-SP2 manuals.
# Also see the support database article "SDB:Disaster Recovery"
# at http://en.opensuse.org/SDB:Disaster_Recovery
# In particular note:
# There is no such thing as a disaster recovery solution that "just works".
# Regarding btrfs snapshots:
# Recovery of btrfs snapshot subvolumes is not possible.
# Only recovery of "normal" btrfs subvolumes is possible.
# On SLE12-SP1 and SP2 the only exception is the btrfs snapshot subvolume
# that is mounted at '/' but that one is not recreated but instead
# it is created anew from scratch during the recovery installation with the
# default first btrfs snapper snapshot subvolume path "@/.snapshots/1/snapshot"
# by the SUSE tool "installation-helper --step 1" (cf. below).
# Other snapshots like "@/.snapshots/234/snapshot" are not recreated.
# Create rear recovery system as ISO image:
OUTPUT=ISO
# Store the backup file via NFS on a NFS server:
BACKUP=NETFS
# BACKUP_OPTIONS variable contains the NFS mount options and
# with 'mount -o nolock' no rpc.statd (plus rpcbind) are needed:
BACKUP_OPTIONS="nolock,credentials=/etc/rear/cifs-rear"
# If the NFS server is not an IP address but a hostname,
# DNS must work in the rear recovery system when the backup is restored.
BACKUP_URL=cifs://den-vmutility/Linux-Rear-Migrations
# Keep an older copy of the backup in a HOSTNAME.old directory
# provided there is no '.lockfile' in the HOSTNAME directory:
NETFS_KEEP_OLD_BACKUP_COPY=yes
# Have all modules of the original system in the recovery system with the
# same module loading ordering as in the original system by using the output of
#   lsmod | tail -n +2 | cut -d ' ' -f 1 | tac | tr -s '[:space:]' ' '
# as value for MODULES_LOAD (cf. https://github.com/rear/rear/issues/626):
#MODULES_LOAD=( )
# On SLE12-SP1 and SP2 with default btrfs subvolumes what is mounted at '/' is a btrfs snapshot subvolume
# that is controlled by snapper so that snapper is needed in the recovery system.
# In SLE12-SP1 and SP2 some btrfs subvolume directories (/var/lib/pgsql /var/lib/libvirt/images /var/lib/mariadb)
# have the "no copy on write (C)" file attribute set so that chattr is required in the recovery system
# and accordingly also lsattr is useful to have in the recovery system (but not strictly required):
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
# Snapper setup by the recovery system uses /usr/lib/snapper/installation-helper
# that is linked to all libraries where snapper is linked to
# (except libdbus that is only needed by snapper).
# "installation-helper --step 1" creates a snapper config based on /etc/snapper/config-templates/default
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default /etc/rear/cifs-rear )
# Files in btrfs subvolumes are excluded by 'tar --one-file-system'
# so that such files must be explicitly included to be in the backup.
# Files in the following SLE12-SP2 default btrfs subvolumes are
# in the below example not included to be in the backup
#   /.snapshots  /var/crash
# but files in /home are included to be in the backup.
# You may use a command like
#   findmnt -n -r -o TARGET -t btrfs | grep -v '^/$' | egrep -v 'snapshots|crash'
# to generate the values:
BACKUP_PROG_INCLUDE=( /var/cache /var/lib/mailman /var/tmp /var/lib/pgsql /usr/local /opt /var/lib/libvirt/images /boot/grub2/i386-pc /var/opt /srv /boot/grub2/x86_64-efi /var/lib/mariadb /var/spool /var/lib/mysql /tmp /home /var/log /var/lib/named /var/lib/machines )
# The following POST_RECOVERY_SCRIPT implements during "rear recover"
# btrfs quota setup for snapper if that is used in the original system:
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
# This option defines a root password to allow SSH connection
# whithout a public/private key pair
SSH_ROOT_PASSWORD='$1$dQS13sX5$L3Y4je4sdHLqveto/Ic4t.'
ONLY_INCLUDE_VG=( "system" )
AUTOEXCLUDE_MULTIPATH=n
ISO_MKISOFS_BIN="$( type -p xorrisofs || type -p mkisofs || type -p genisoimage )"
EXCLUDE_VG=( "vgapp" "vgarchlog" "vgu00-04" "vgu05-09" )
EXCLUDE_MOUNTPOINTS=('/app' '/archlog' '/u00' '/u01' '/u02' '/u03' '/u04' '/u05' '/u06' '/u07' '/u08' '/u09')
CLONE_ALL_USERS_GROUPS="true"
# Let the rear recovery system run dhclient to get an IP address
# instead of using the same IP address as the original system:
#USE_DHCLIENT="yes"
# End example setup for SLE12-SP2 with default btrfs subvolumes.
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR): VMWare guest</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86_64</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    BIOS and GRUB2</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    CIFS mount to a windows server</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    While booted to rear recovery RESCUE ISO sshd will segfault when you
    try to ssh to the server to run the rear recover.<br />
    This is my first use of REAR with SUSE SLES 15. Other SLES versions
    do not have this issue.</p>
</li>
<li>
<p>Workaround, if any:<br />
    None</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
    I have console screen printouts since I could not capture the
    journalctl log by using ssh.<br />
<a href="https://github.com/rear/rear/files/3654405/rear-rescue-sshd-segfault.docx">rear-rescue-sshd-segfault.docx</a></p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2019-09-26_1255"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-535489020">2019-09-26 12:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-09-26_1255" title="Permanent link">&para;</a></h4>
<p>@shaunsJM<br />
in your attached<br />
<a href="https://github.com/rear/rear/files/3654405/rear-rescue-sshd-segfault.docx">https://github.com/rear/rear/files/3654405/rear-rescue-sshd-segfault.docx</a><br />
there are sshd related error messages<br />
<code>Could not load host key: /etc/ssh/ssh_host_*_key</code><br />
so it seems those key files are missing in the ReaR recovery system,<br />
cf. the <code>SSH_*</code> config variables and their explanation in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1321">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1321</a></p>
<h4 id="shaunsjm_commented_at_2019-09-26_2201"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-535702619">2019-09-26 22:01</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-09-26_2201" title="Permanent link">&para;</a></h4>
<p>I believe the "Could not load host key" message is not the real issue
and is a distraction.</p>
<p>If local.conf is configured with a SSH_ROOT_PASSWORD then a
public/private key pair is not needed.</p>
<pre><code># SSH_ROOT_PASSWORD defines a password for remote access to the recovery system as 'root' via SSH
# without requiring a public/private key pair. This password is valid only while the recovery system
# is running and will not allow access afterwards to the restored target system.
</code></pre>
<p>This issue only happens on SLES 15, and not on SLES 12 using a very
similar local.conf configuration with a SSH_ROOT_PASSWORD defined in
local.conf</p>
<h4 id="jsmeix_commented_at_2019-09-27_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-535910261">2019-09-27 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-09-27_1201" title="Permanent link">&para;</a></h4>
<p>@shaunsJM</p>
<p>On my ReaR test systems I always use <code>SSH_ROOT_PASSWORD="rear"</code><br />
(never ever user your original root password as plain text there).<br />
I had never noticed an ssh issue with that, in particular not<br />
at the time when I did my tests on SLES12 and SLES15.<br />
I am not at all an ssh expert so I cannot actually debug ssh issues.<br />
Perhaps something is "unusual" on your particular SLES15 system?<br />
Perhaps there was some recent ssh related update on SLES15<br />
that causes this issue in ReaR as a side effect?<br />
In any case a segfault of sshd is usually first and foremost<br />
an issue in sshd itself or in one of its libraries.</p>
<p>After "rear mkrescue/mkbackup" you can check things inside the<br />
ReaR recovery system by using <code>KEEP_BUILD_DIR="yes"</code>,<br />
see the <code>KEEP_BILD_DIR</code> description in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L128</a><br />
via <code>chroot $TMPDIR/rear.XXXXXXXXXXXXXXX/rootfs/</code><br />
and then try to start sshd from inside the ReaR recovery system.<br />
I guess there could be certain issues when starting a service<br />
that usually needs the outer network to work properly<br />
from within the limited <code>chroot</code> environment<br />
but for some basic tests it could help,<br />
at least <code>sshd</code> should not segfault.</p>
<p>I am not in the office since some weeks and for some more weeks<br />
so that I cannot do much for ReaR.<br />
I cannot try out or test anything for ReaR - in particular not on
SLES.<br />
I expect to be back in the office at about beginning of October.<br />
But I also expect that I have to do first and foremost other stuff with
higher priority,<br />
cf.
<a href="https://github.com/rear/rear/issues/799#issuecomment-531247109">https://github.com/rear/rear/issues/799#issuecomment-531247109</a></p>
<h4 id="gozora_commented_at_2019-09-27_1313"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-535933655">2019-09-27 13:13</a>:<a class="headerlink" href="#gozora_commented_at_2019-09-27_1313" title="Permanent link">&para;</a></h4>
<p>@shaunsJM can you verify your <em>openssh</em> installation on your ORIGINAL
system, by running <code>rpm --verify openssh | grep ^S</code> ?</p>
<p>V.</p>
<h4 id="shaunsjm_commented_at_2019-09-27_1448"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-535971474">2019-09-27 14:48</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-09-27_1448" title="Permanent link">&para;</a></h4>
<p>@gozora Thanks for the help. Here it the rpm verify output:<br />
S.5....T. c /etc/ssh/sshd_config</p>
<h4 id="shaunsjm_commented_at_2019-09-27_1604"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-536000772">2019-09-27 16:04</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-09-27_1604" title="Permanent link">&para;</a></h4>
<p>@jsmeix I'm thinking something about the sshd changed between the
version SLES12 and 15. During my testing yesterday, I managed to stumble
upon a scenario where after running a ReaR backup, any new ssh
connections into the server would produce a sshd segfault in the
messages log. I will spend some time trying to reproduce it. If I can
reproduce it, I will log a call with SUSE to have them look at why.<br />
When you get back and have some time, try loading OpenSUSE Leap 15.1 and
see if you get the same results. Like I said to begin with, ReaR is
working great and I can recover without any issues if I start the the
recovery from the console. It is just a nice thing to be able to sshd
into the recovery environment.<br />
Thanks! Shaun</p>
<h4 id="gozora_commented_at_2019-09-27_1909"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-536063040">2019-09-27 19:09</a>:<a class="headerlink" href="#gozora_commented_at_2019-09-27_1909" title="Permanent link">&para;</a></h4>
<p>@shaunsJM hmm, looks good at first sight.<br />
Can you tell me, until it is not a secret of course, what are the
changes you've made in your <em>/etc/ssh/sshd_config</em> ?</p>
<p>I just tested ssh connection to ReaR recovery system of my SUSE Linux
Enterprise Server 15 with <em>openssh-7.6p1-7.8.x86_64</em>, and all works
fine...</p>
<p>Btw, my sshd in ReaR recovery system also suffers from messages like
mentioned earlier:</p>
<pre><code>RESCUE sle15:~ # systemctl status sshd
● sshd.service - Relax-and-Recover sshd service
   Loaded: loaded (/usr/lib/systemd/system/sshd.service; static; vendor preset: enabled)
   Active: active (running) since Fri 2019-09-27 20:59:41 CEST; 1min 13s ago
 Main PID: 106 (sshd)
    Tasks: 5 (limit: 4915)
   CGroup: /system.slice/sshd.service
           ├─106 /bin/sshd -D
           ├─744 sshd: root@pts/0
           ├─746 -bash
           ├─751 systemctl status sshd
           └─752 less

Sep 27 20:59:41 sle15 sshd[106]: Server listening on 0.0.0.0 port 22.
Sep 27 20:59:41 sle15 sshd[106]: Server listening on :: port 22.
Sep 27 21:00:18 sle15 sshd[742]: error: Could not load host key: /etc/ssh/ssh_host_dsa_key
Sep 27 21:00:18 sle15 sshd[742]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key
Sep 27 21:00:18 sle15 sshd[742]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key
Sep 27 21:00:18 sle15 sshd[742]: Connection closed by 192.168.0.1 port 60840 [preauth]
Sep 27 21:00:23 sle15 sshd[744]: error: Could not load host key: /etc/ssh/ssh_host_dsa_key
Sep 27 21:00:23 sle15 sshd[744]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key
Sep 27 21:00:23 sle15 sshd[744]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key
</code></pre>
<p>But this is most probably caused by ReaR security feature, described in
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1320-L1377">default.conf</a></p>
<p>For your reference, here is how my sshd is linked:</p>
<pre><code>RESCUE sle15:~ # ldd /bin/sshd
    linux-vdso.so.1 (0x00007ffc0a946000)
    libaudit.so.1 =&gt; /usr/lib64/libaudit.so.1 (0x00007fd66a99a000)
    libpam.so.0 =&gt; /lib64/libpam.so.0 (0x00007fd66a78b000)
    libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fd66a562000)
    libsystemd.so.0 =&gt; /usr/lib64/libsystemd.so.0 (0x00007fd66a2cd000)
    libcrypto.so.1.1 =&gt; /usr/lib64/libcrypto.so.1.1 (0x00007fd669e42000)
    libutil.so.1 =&gt; /lib64/libutil.so.1 (0x00007fd669c3f000)
    libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fd669a28000)
    libcrypt.so.1 =&gt; /lib64/libcrypt.so.1 (0x00007fd6697ed000)
    libgssapi_krb5.so.2 =&gt; /usr/lib64/libgssapi_krb5.so.2 (0x00007fd6695a2000)
    libkrb5.so.3 =&gt; /usr/lib64/libkrb5.so.3 (0x00007fd6692c8000)
    libcom_err.so.2 =&gt; /lib64/libcom_err.so.2 (0x00007fd6690c4000)
    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fd668d0a000)
    libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fd668b06000)
    libpcre.so.1 =&gt; /usr/lib64/libpcre.so.1 (0x00007fd668879000)
    /lib64/ld-linux-x86-64.so.2 (0x00007fd66ae8f000)
    libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007fd668662000)
    libcap.so.2 =&gt; /usr/lib64/libcap.so.2 (0x00007fd66845d000)
    librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fd668255000)
    liblzma.so.5 =&gt; /usr/lib64/liblzma.so.5 (0x00007fd66801a000)
    liblz4.so.1 =&gt; /usr/lib64/liblz4.so.1 (0x00007fd667e05000)
    libgcrypt.so.20 =&gt; /usr/lib64/libgcrypt.so.20 (0x00007fd667ae9000)
    libgpg-error.so.0 =&gt; /usr/lib64/libgpg-error.so.0 (0x00007fd6678c9000)
    libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fd6676ab000)
    libk5crypto.so.3 =&gt; /usr/lib64/libk5crypto.so.3 (0x00007fd667479000)
    libkrb5support.so.0 =&gt; /usr/lib64/libkrb5support.so.0 (0x00007fd66726c000)
    libkeyutils.so.1 =&gt; /usr/lib64/libkeyutils.so.1 (0x00007fd667068000)
</code></pre>
<p>V.</p>
<h4 id="shaunsjm_commented_at_2019-09-27_2231"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-536116399">2019-09-27 22:31</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-09-27_2231" title="Permanent link">&para;</a></h4>
<p>@gozora Any chance you can upgrade to SLES 15 SP1? My openssh version is
openssh-7.9p1-4.7.x86_64 on SLES 15 SP1.<br />
My only change to sshd_config is setting "PermitRootLogin
without-password" But I also tried setting it to yes.</p>
<p>@jsmeix and @gozora<br />
Possible progress, I can easily reproduce the sshd segfault on a SLES 15
SP1 server without ReaR installed. So it doesn't appear to be ReaR
having the issue. Something in the way sshd is reading those system wide
ssh keys in /etc/ssh. I did create a workaround that allows me to get on
the server using ssh.<br />
I created a setup-sshd.sh in /etc/rear and have it included in the
making of the ISO. Once in the ReaR recovery shell I run the
/etc/rear/setup-sshd.sh and I can now login using ssh.<br />
here is the script so you can see what it does.<br />
<code>#!/bin/bash rm /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_ed25519_key ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -q -P "" ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -q -P "" systemctl restart sshd</code></p>
<p>This stops the segfault and allows me to login using ssh.</p>
<p>Big thanks to @jsmeix and @gozora for looking at this with me. I will
create a case with SUSE to see why the segfault is happening. Thanks!</p>
<h4 id="gozora_commented_at_2019-09-28_0720"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-536161747">2019-09-28 07:20</a>:<a class="headerlink" href="#gozora_commented_at_2019-09-28_0720" title="Permanent link">&para;</a></h4>
<p>@shaunsJM following configuration allowed ReaR to copy host keys into
ReaR recovery image:</p>
<pre><code>RESCUE sle15:~ # cat /etc/rear/local.conf 
...

SSH_FILES=/etc/ssh
SSH_UNPROTECTED_PRIVATE_KEYS="yes"
</code></pre>
<p>With this setup you should be able to connect to ReaR recovery system
without your workaround (which is fully valid by the way ;-)).</p>
<p>V.</p>
<h4 id="shaunsjm_commented_at_2019-09-30_1526"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-536614799">2019-09-30 15:26</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-09-30_1526" title="Permanent link">&para;</a></h4>
<p>@gozora I debated using SSH_UNPROTECTED_PRIVATE_KEYS="yes" but had
some concerns about security. So I was leaving that as my last option.
But thanks for pointing it out! :)</p>
<h4 id="jsmeix_commented_at_2019-10-01_1542"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-537097853">2019-10-01 15:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-01_1542" title="Permanent link">&para;</a></h4>
<p>According to<br />
<a href="https://github.com/rear/rear/issues/2240#issuecomment-536116399">https://github.com/rear/rear/issues/2240#issuecomment-536116399</a></p>
<pre><code>I can ... reproduce the sshd segfault on a SLES 15 SP1 server
without ReaR installed.
</code></pre>
<p>the root cause is not in ReaR so that I close this issue accordingly.<br />
Nevertheless further comments can of course be added here<br />
to describe how things go on with sshd on SLES15-SP1.<br />
@shaunsJM<br />
thank you for your explicit feedback where the root cause of this issue
is.</p>
<h4 id="shaunsjm_commented_at_2019-10-10_1943"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-540751862">2019-10-10 19:43</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-10-10_1943" title="Permanent link">&para;</a></h4>
<p>A quick update, I logged the issue with SUSE and they are releasing a
patch to fix the ssh segfault issue.</p>
<h4 id="jsmeix_commented_at_2019-10-11_0937"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-540993495">2019-10-11 09:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-11_0937" title="Permanent link">&para;</a></h4>
<p>@shaunsJM<br />
out of curiosity: could you send me your SUSE bugzilla bug number<br />
(or post it here if it is even a public accessible SUSE bugzilla bug)<br />
or your SUSE issue ticket number (or whatever that thingy is called)<br />
to my SUSE mail address: <code>jsmeix@suse.com</code><br />
so that I could see what goes on there?<br />
Thank you in advance!</p>
<h4 id="shaunsjm_commented_at_2019-10-22_1526"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-545017833">2019-10-22 15:26</a>:<a class="headerlink" href="#shaunsjm_commented_at_2019-10-22_1526" title="Permanent link">&para;</a></h4>
<p>This should be my last update for this... SUSE has created a PTF
(Program Temporary Fix) for sshd. I've been able to test it out and
confirm that sshd will no longer segfault if the host keys are missing.
SUSE didn't give me any ETA on when this fix will be included in the
next update of sshd.<br />
I further tested out a ReaR recovery and I'm able to ssh into the ReaR
recovery console without any problems. Again thanks for the help @jsmeix
and @gozora</p>
<h4 id="jsmeix_commented_at_2019-10-23_0925"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2240#issuecomment-545354309">2019-10-23 09:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-10-23_0925" title="Permanent link">&para;</a></h4>
<p>@shaunsJM<br />
thank you for your positive feedback.</p>
<p>FYI<br />
regarding PTF versus maintenance update:</p>
<p>A PTF is fully supported so you do not need to have a maintenance
update<br />
to have full support from SUSE for what you currently have installed.</p>
<p>Usually some time after you got a PTF you will get a maintenance
update<br />
that includes what is fixed by the PTF.<br />
But there is no time limit when such a maintenance update will come.<br />
In certain cases it may even come never (e.g. when a PTF contains<br />
a special fix for a corner case) so a temporary fix could become<br />
temporary as long as a SLES version is supported.</p>
<p>For more details see for example<br />
<a href="https://www.suse.com/support/handbook/">https://www.suse.com/support/handbook/</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-09-25.2240.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
