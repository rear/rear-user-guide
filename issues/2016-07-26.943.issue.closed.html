<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#943 Issue closed: P2V HP microserver to VmWare - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#943 Issue closed: P2V HP microserver to VmWare";
        var mkdocs_page_input_path = "issues/2016-07-26.943.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#943 Issue closed: P2V HP microserver to VmWare</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="943_issue_closed_p2v_hp_microserver_to_vmware"><a href="https://github.com/rear/rear/issues/943">#943 Issue</a> <code>closed</code>: P2V HP microserver to VmWare<a class="headerlink" href="#943_issue_closed_p2v_hp_microserver_to_vmware" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="mzlumin_opened_issue_at_2016-07-26_1416"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> opened issue at <a href="https://github.com/rear/rear/issues/943">2016-07-26 14:16</a>:<a class="headerlink" href="#mzlumin_opened_issue_at_2016-07-26_1416" title="Permanent link">&para;</a></h4>
<p>Hey Guys,</p>
<p>first of all, thank you for this epic and outstanding fabulous tool! I
love using ReaR at my home environment.</p>
<p>However i am a bit lost and wanted to ask if you may can help me out to
get my physical Server backed up.</p>
<ul>
<li>rear version :<br />
<code>Relax-and-Recover 1.18-git201607251102 / 2016-07-25</code></li>
<li>OS version :<br />
<code>Distributor ID: Ubuntu Description:    Ubuntu 15.10 Release:        15.10 Codename:       wily</code></li>
<li>rear configuration file (local.conf):<br />
<code>OUTPUT=ISO BACKUP=NETFS BACKUP_URL="cifs://192.168.0.13/g/BACKUPS/rear" BACKUP_OPTIONS="cred=/etc/rear/creds" BACKUP_PROG_EXCLUDE=( '/proc/kcore' '/home/zuli12/downloads/*' '/dev/shm/*' '/mnt/*' '/media/*' )</code></li>
</ul>
<p>Some Information on the original System as rear dump output:<br />
<a href="url">https://gist.github.com/mzlumin/6d12b93b2a90f0c66d2eddeeed302ffb</a></p>
<p>rear savelayout output:<br />
<a href="url">https://gist.github.com/mzlumin/ee5c04923a1a3ee7171a0554121ccd10</a></p>
<p>gdha's disklayout build script output:<br />
<a href="url">https://gist.github.com/mzlumin/66a2daf960eba5832cc077d6c2b701c8</a></p>
<p>I am running LVM over an 2TB HDD, i have build this using the default
Ubuntu Server install proccess and i am trying to recover this one on an
VmWare 12 Workstation Pro ( i have been able to restore 2 VM's without
Issues )</p>
<p>Phsysikal CPU Info:<br />
<a href="url">https://gist.github.com/mzlumin/db241e02f73fdb5b0ceb0b4e34829536</a></p>
<p>VmWare Host CPU is a Intel Core I5<br />
<code>Prozessor  Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz, 3401 MHz, 4 Kern(e), 4 logische(r) Prozessor(en)</code></p>
<p>OK so if i try to recover from the saved backup i run through the
interactive menu until i face some parted faults, please see here:</p>
<p><img alt="unbenannt1" src="https://cloud.githubusercontent.com/assets/20663710/17141345/0987a5f6-534c-11e6-8963-2d604e8cf48d.JPG" /></p>
<p><img alt="unbenannt" src="https://cloud.githubusercontent.com/assets/20663710/17141367/120e6fca-534c-11e6-9485-360b2f43a9f3.JPG" /></p>
<p>I have also tried to modify the script and layout, however it seem not
to work for me, i would ask you for some help in this Case :(</p>
<p>Thanks,<br />
Mario</p>
<h4 id="gdha_commented_at_2016-07-29_0825"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236123439">2016-07-29 08:25</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-29_0825" title="Permanent link">&para;</a></h4>
<p>See also the discussion of issue #102 - it is about the same</p>
<h4 id="jsmeix_commented_at_2016-07-29_0856"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236129462">2016-07-29 08:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-29_0856" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I think the parted "Warning ... not properly aligned ..."<br />
is
<a href="https://github.com/rear/rear/issues/102">https://github.com/rear/rear/issues/102</a><br />
but that does not let "rear recover" fail.</p>
<p>I think the subsequent parted "Error" is a different issue<br />
and that one lets "rear recover" fail.</p>
<p>@mzlumin<br />
I have no personal experience in using rear for migration.<br />
I think in general using rear for migrating a system<br />
onto different kind of "hardware" is tricky and depending<br />
on the exact difference it may become a complicated task.<br />
I think in your case you need to manually adapt the<br />
var/lib/rear/layout/disklayout.conf file into something<br />
that matches the new "hardware", cf. the section<br />
"Restore to different hardware" in<br />
doc/user-guide/06-layout-configuration.adoc<br />
Again:<br />
I have no personal experience in using rear for migration<br />
so that my above information could be totally wrong.</p>
<h4 id="jsmeix_commented_at_2016-07-29_0917"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236133622">2016-07-29 09:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-29_0917" title="Permanent link">&para;</a></h4>
<p>Perhaps my curently first steps in
<a href="https://github.com/rear/rear/issues/841">https://github.com/rear/rear/issues/841</a><br />
to implement rear recovery system update support<br />
could be already useful here:</p>
<p>Instead of manually changing files like<br />
var/lib/rear/layout/disklayout.conf<br />
in the running rear recovery system<br />
my currently implemented first steps in<br />
<a href="https://github.com/rear/rear/issues/841#issuecomment-229069740">https://github.com/rear/rear/issues/841#issuecomment-229069740</a><br />
to download and install files into<br />
the running rear recovery system<br />
could make this task much easier for the user.</p>
<p>@gdha @mzlumin<br />
if you are interested I could do a pull request and merge it<br />
to have its current state available in rear master code<br />
so that you could test it and try out if it is useful for you<br />
and provide feedback and issue reports if it does not work.</p>
<h4 id="jsmeix_commented_at_2016-07-29_0928"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236135919">2016-07-29 09:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-29_0928" title="Permanent link">&para;</a></h4>
<p>I created
<a href="https://github.com/rear/rear/pull/945">https://github.com/rear/rear/pull/945</a></p>
<p>@gdha<br />
if you like it, please merge it.<br />
It is a pure additional functionality so that<br />
it cannot cause backward incompatible regressions.</p>
<h4 id="mzlumin_commented_at_2016-07-29_1012"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236144629">2016-07-29 10:12</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-07-29_1012" title="Permanent link">&para;</a></h4>
<p>@jsmeix @gdha<br />
Thanks for the heads up on this and the answers.<br />
I will look into #841 , i will surely try it out on my site if you want
to.</p>
<p>I consider this also might help a few other people out there in such a
Case ? :)</p>
<p>If this one is merged i need to get the newest revision, correct ?<br />
Is there anything i need to look at afterwards, or should it work out of
the Box ? Just some silly enduser questions :)</p>
<h4 id="jsmeix_commented_at_2016-07-29_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236151041">2016-07-29 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-29_1047" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
in general regarding how to test the currently<br />
newest rear GitHub master code:</p>
<p>Basically "git clone" it into a directory and<br />
then run rear from within that directory.</p>
<pre>
# git clone https://github.com/rear/rear.git
# cd rear
# vi etc/rear/local.conf
# usr/sbin/rear -d -D mkbackup
</pre>

<h4 id="mzlumin_commented_at_2016-07-29_1152"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236161559">2016-07-29 11:52</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-07-29_1152" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix will do that.<br />
Is it okay if i do the clone now and try it out ? Or do i need to wait
for the merge ?</p>
<p>Do i need to run anything advanced then or is trying and report if that
works enough for you ?</p>
<p>Thanks</p>
<h4 id="jsmeix_commented_at_2016-07-29_1227"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236167459">2016-07-29 12:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-29_1227" title="Permanent link">&para;</a></h4>
<p>As long as it is not merged into rear master<br />
cloning the rear master code does not contain it.</p>
<p>When it is merged clone it and then read my comments<br />
how to use it (in particular my comments in default.conf)<br />
and for an example how it I used it see<br />
<a href="https://github.com/rear/rear/issues/841#issuecomment-229069740">https://github.com/rear/rear/issues/841#issuecomment-229069740</a></p>
<h4 id="mzlumin_commented_at_2016-07-29_1318"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236177847">2016-07-29 13:18</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-07-29_1318" title="Permanent link">&para;</a></h4>
<p>Thanks will do that as soon as possible after the merge ! :)</p>
<h4 id="jsmeix_commented_at_2016-08-01_1041"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236547810">2016-08-01 10:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-01_1041" title="Permanent link">&para;</a></h4>
<p>Right now I merged
<a href="https://github.com/rear/rear/pull/945">https://github.com/rear/rear/pull/945</a><br />
so that you can try it out.</p>
<p>See default.conf how RECOVERY_UPDATE_URL works.</p>
<p>Note that this new RECOVERY_UPDATE_URL<br />
functionality does not at all do anything to make<br />
your initial problem P2V migration go away.</p>
<p>The RECOVERY_UPDATE_URL functionality<br />
only could help you to adapt the rear recovery system<br />
more easily on the new hardware so that "rear recover"<br />
works on the new hardware.</p>
<p>In short what I think you should do is:</p>
<p>On the old system update rear to the newest rear GitHub<br />
master code as described above<br />
in
<a href="https://github.com/rear/rear/issues/943#issuecomment-236151041">https://github.com/rear/rear/issues/943#issuecomment-236151041</a><br />
and have in your etc/rear/local.conf (in the directory<br />
whereto you "git cloned" the newest rear GitHub master code)</p>
<pre>
RECOVERY_UPDATE_URL="http://your_HTTP_server/$HOSTNAME.rear_config.tar.gz"
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" curl )
</pre>

<p>and then run "rear mkbackup" there.</p>
<p>Now you have a rear recovery system with the<br />
new RECOVERY_UPDATE_URL functionality.</p>
<p>When you boot the new hardware with the above created<br />
new rear recovery system and run "rear recover" there,<br />
it will download</p>
<pre>
http://your_HTTP_server/$HOSTNAME.rear_config.tar.gz
</pre>

<p>from your HTTP server and install it into the<br />
rear recovery system before it proceeds.</p>
<p>This way you can provide for example an adapted<br />
var/lib/rear/layout/disklayout.conf to be installed<br />
into the rear recovery system before it<br />
creates partitions, filesystems, and so on<br />
so that you can get partitions, filesystems, and so on<br />
created by "rear rcover" on the new hardware<br />
as you need it there.</p>
<p>Probably your first experiments with an adapted<br />
var/lib/rear/layout/disklayout.conf will fail but<br />
with the RECOVERY_UPDATE_URL functionality<br />
it should be much easier for you to do several<br />
trial and error attempts until you got it right<br />
because now you can update the disklayout.conf file<br />
on your HTTP server, pack it into a *.tar.gz and<br />
reboot the new hardware with the same above created<br />
new rear recovery system but now it will install<br />
the updated disklayout.conf file from your HTTP server.</p>
<p>Bottom line:<br />
With the RECOVERY_UPDATE_URL functionality<br />
you get shorter/easier trial and error cycles when you<br />
need adaptions in the rear recovery system to make<br />
"rear recover" work.</p>
<h4 id="mzlumin_commented_at_2016-08-01_1131"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236556450">2016-08-01 11:31</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1131" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix i am on it to create the backup at this time, and i have
build up an simple WebServer to server the config Files.</p>
<p>This will really help a lot to get things changed quicker! Thanks for
the merge.</p>
<p>However i consider i will struggle to get this working with my
experience of partitions and stuff though.</p>
<p>But i will give it a try and report back for sure.</p>
<h4 id="jsmeix_commented_at_2016-08-01_1159"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236561433">2016-08-01 11:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-01_1159" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
many thanks in advance for your feedback about<br />
the RECOVERY_UPDATE_URL functionality,<br />
see
<a href="https://github.com/rear/rear/pull/945#discussion_r72958496">https://github.com/rear/rear/pull/945#discussion_r72958496</a></p>
<pre>
The new RECOVERY_UPDATE_URL functionality
will require further enhancements...
</pre>

<p>At least it should help you to struggle faster ;-)</p>
<h4 id="jsmeix_commented_at_2016-08-01_1210"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236563507">2016-08-01 12:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-01_1210" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
I think for your tests you could simplify it and<br />
leave out the $HOSTNAME indirection and<br />
use a fixed tar.gz so that you can use a fixed URL like:</p>
<pre>
RECOVERY_UPDATE_URL="http://your_HTTP_server/P2Vstuff.tar.gz"
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" curl )
</pre>

<h4 id="mzlumin_commented_at_2016-08-01_1236"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236568684">2016-08-01 12:36</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1236" title="Permanent link">&para;</a></h4>
<p>No worries @jsmeix i think i will get the Update_URL functionality to
work, also i have added ssh access, seems to work better on VmWare
though :)</p>
<p>Let's see how far i come with this one.</p>
<p>Thanks!</p>
<h4 id="jsmeix_commented_at_2016-08-01_1312"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236576355">2016-08-01 13:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-01_1312" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
if you need scp support for automated update<br />
via RECOVERY_UPDATE_URL like</p>
<pre>
RECOVERY_UPDATE_URL="scp://user:password@host/path/to/file.tar.gz"
</pre>

<p>I think I could add this relatively easily.</p>
<h4 id="mzlumin_commented_at_2016-08-01_1344"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236584230">2016-08-01 13:44</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1344" title="Permanent link">&para;</a></h4>
<p>Wow, basically i think this would also help some people out there, in my
particular case i don't need scp, but thanks for the information!</p>
<p>I consider i might need more help with the actual recovery as i am
somehow too silly to get this working.</p>
<p>I will post the results with the new git version soon, will get this
done in the next 2 hours i think.<br />
A quick view showed it does download the file just fine, i will need to
look into it to say something.</p>
<p>Will keep you posted - Thanks @jsmeix</p>
<h4 id="mzlumin_commented_at_2016-08-01_1516"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236611157">2016-08-01 15:16</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1516" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix</p>
<p>ok i can confirm that it is way easier to get things modified using the
newest git and the UPDATE_URL attribute - Thanks again for that.</p>
<p>However i seem to be to silly to get things working, it has not
magically fixed my Issues as you stated :(<br />
Here is my latest log from the recover test:<br />
<a href="url">https://gist.github.com/mzlumin/80258ba5ce094aae0153882eeb8a1c47</a></p>
<p>Here is the disklayout File:<br />
<a href="url">https://gist.github.com/mzlumin/0ed1fa5c2720de5dc1901c833af19f55</a></p>
<p>I tried my best, but as said, i'm not to deep with partitions and stuff
unfortunately :&amp;</p>
<p>What i am wondering about is the last lines in the Log File:</p>
<p><code>+++ parted -s /dev/sda mkpart '"logical"' 256909312B 2147483647999B parted: invalid token: logical Error: Expecting a partition type.</code></p>
<p>I am pretty sure that a somehow equal config works on another Box, also
with those logical partition ?</p>
<h4 id="mzlumin_commented_at_2016-08-01_1521"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236612784">2016-08-01 15:21</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1521" title="Permanent link">&para;</a></h4>
<p>Ah forgot, this one is the script which is getting built on this box
which fails:</p>
<p><a href="url">https://gist.github.com/mzlumin/0460c2bcaf60979beab663866d7fc7f8</a></p>
<h4 id="mzlumin_commented_at_2016-08-01_1524"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236613555">2016-08-01 15:24</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-01_1524" title="Permanent link">&para;</a></h4>
<p>Also the Links directly, seems the referral points to an 404:</p>
<p>Log FIle:
<a href="https://gist.github.com/mzlumin/80258ba5ce094aae0153882eeb8a1c47">https://gist.github.com/mzlumin/80258ba5ce094aae0153882eeb8a1c47</a></p>
<p>Disklayout:
<a href="https://gist.github.com/mzlumin/0ed1fa5c2720de5dc1901c833af19f55">https://gist.github.com/mzlumin/0ed1fa5c2720de5dc1901c833af19f55</a></p>
<p>Script:
<a href="https://gist.github.com/mzlumin/0460c2bcaf60979beab663866d7fc7f8">https://gist.github.com/mzlumin/0460c2bcaf60979beab663866d7fc7f8</a></p>
<h4 id="jsmeix_commented_at_2016-08-02_1255"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-236895334">2016-08-02 12:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-02_1255" title="Permanent link">&para;</a></h4>
<p>Welcome to parted!</p>
<p>In general regarding parted see<br />
<a href="https://www.gnu.org/software/parted/manual/parted.html">https://www.gnu.org/software/parted/manual/parted.html</a></p>
<p>I can reproduce your parted behaviour<br />
on my SLES12-SP1 test system:</p>
<pre>
# parted -s /dev/sdb mklabel msdos
# parted -s /dev/sdb print        
Model: ATA QEMU HARDDISK (scsi)
Disk /dev/sdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags: 
Number  Start  End  Size  Type  File system  Flags
# parted -s /dev/sdb mkpart primary 4MiB 8MiB
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type     File system  Flags
 1      4194kB  8389kB  4194kB  primary               type=83
# parted -s /dev/sdb set 1 boot on
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type     File system  Flags
 1      4194kB  8389kB  4194kB  primary               boot, type=83

# parted -s /dev/sdb mkpart primary 8MiB 16MiB
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type     File system  Flags
 1      4194kB  8389kB  4194kB  primary               boot, type=83
 2      8389kB  16.8MB  8389kB  primary               type=83
# parted -s /dev/sdb mkpart logical 16MiB 32MiB
parted: invalid token: logical
Error: Expecting a partition type.
</pre>

<p>The reason is that you cannot have a logical partition<br />
directly on the disk.</p>
<p>You first need an extended partition - a container partition<br />
that usually goes to the end of the whole disk,<br />
then you can add logical partitions inside the extended<br />
container partition:</p>
<pre>
# parted -s /dev/sdb mkpart extended 16MiB 128MiB
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type      File system  Flags
 1      4194kB  8389kB  4194kB  primary                boot, type=83
 2      8389kB  16.8MB  8389kB  primary                type=83
 3      16.8MB  134MB   117MB   extended               lba, type=0f
# parted -s /dev/sdb mkpart logical 16MiB 32MiB
Error: You requested a partition from 16.8MB to 33.6MB (sectors 32768..65535).
The closest location we can manage is 16.8MB to 33.6MB (sectors 32769..65535).
# parted -s /dev/sdb mkpart logical 17MiB 34MiB
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type      File system  Flags
 1      4194kB  8389kB  4194kB  primary                boot, type=83
 2      8389kB  16.8MB  8389kB  primary                type=83
 3      16.8MB  134MB   117MB   extended               lba, type=0f
 5      17.8MB  35.7MB  17.8MB  logical                type=83
# parted -s /dev/sdb mkpart logical 34MiB 64MiB
Error: You requested a partition from 35.7MB to 67.1MB (sectors 69632..131071).
The closest location we can manage is 35.7MB to 67.1MB (sectors 69633..131071).
# parted -s /dev/sdb mkpart logical 36MiB 68MiB
# parted -s /dev/sdb print
...
Number  Start   End     Size    Type      File system  Flags
 1      4194kB  8389kB  4194kB  primary                boot, type=83
 2      8389kB  16.8MB  8389kB  primary                type=83
 3      16.8MB  134MB   117MB   extended               lba, type=0f
 5      17.8MB  35.7MB  17.8MB  logical                type=83
 6      37.7MB  71.3MB  33.6MB  logical                type=83
</pre>

<p>I suggest that you boot the rear recovery system on the<br />
new hardware, log in as root but do not run "rear recover".<br />
Instead do the parted calls manually until you know what<br />
exact parted calls will work so that you can make the<br />
disklayout.conf according to the exact parted calls<br />
that had actually worked.</p>
<h4 id="mzlumin_commented_at_2016-08-04_1124"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-237526256">2016-08-04 11:24</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-04_1124" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix i think with that last information i have been able to
get this working!</p>
<p>Just one last thing i have seen while testing these, i have tried it
using the latest git, it also downloaded the file from the WebServer:</p>
<blockquote>
<p>2016-08-04 15:02:17 Relax-and-Recover 1.18 / Git<br />
2016-08-04 15:02:17 Command line options: /bin/rear recover<br />
2016-08-04 15:02:17 Using log file: /var/log/rear/rear-Stark.log<br />
2016-08-04 15:02:17 Including /etc/rear/os.conf<br />
2016-08-04 15:02:17 Including conf/Linux-i386.conf<br />
2016-08-04 15:02:17 Including conf/GNU/Linux.conf<br />
2016-08-04 15:02:17 Including conf/Ubuntu.conf<br />
2016-08-04 15:02:17 Including /etc/rear/local.conf<br />
2016-08-04 15:02:17 Including /etc/rear/rescue.conf<br />
2016-08-04 15:02:17 Running 'init' stage<br />
2016-08-04 15:02:17 Including init/default/01_set_drlm_env.sh<br />
2016-08-04 15:02:17 Including
init/default/03_update_recovery_system.sh<br />
2016-08-04 15:02:17 Updating recovery system with the content from
'<a href="http://192.168.0.13/Stark.rear_config.tar.gz">http://192.168.0.13/Stark.rear_config.tar.gz</a>':</p>
<ul>
<li>Trying 192.168.0.13...</li>
<li>Connected to 192.168.0.13 (192.168.0.13) port 80 (#0)<br />
    GET /Stark.rear_config.tar.gz HTTP/1.1<br />
    Host: 192.168.0.13<br />
    User-Agent: curl/7.43.0<br />
    Accept: <em>/</em></li>
</ul>
<p>&lt; HTTP/1.1 200 OK<br />
&lt; Date: Thu, 04 Aug 2016 11:02:17 GMT<br />
&lt; Server: Apache/2.4.18 (Win32) OpenSSL/1.0.2e PHP/7.0.8<br />
&lt; Last-Modified: Thu, 04 Aug 2016 11:02:07 GMT<br />
&lt; ETag: "d92-5393ce17b2a22"<br />
&lt; Accept-Ranges: bytes<br />
&lt; Content-Length: 3474<br />
&lt; Content-Type: application/x-gzip<br />
&lt;<br />
{ [3474 bytes data]</p>
<ul>
<li>Connection #0 to host 192.168.0.13 left intact</li>
</ul>
</blockquote>
<p>The only thing was that it has not used those modified files, if i e.g.
looked at the disklayout file, although modified on the webserver and
packed again to the same name...</p>
<p>I just give it another shot with a fresh backup and recovery..</p>
<p>Thanks anyways for your great help!</p>
<h4 id="jsmeix_commented_at_2016-08-04_1257"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-237544630">2016-08-04 12:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-04_1257" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
when using the latest rear master code<br />
from within a sub-directory "rear" as in</p>
<pre>
# git clone https://github.com/rear/rear.git
# cd rear
# vi etc/rear/local.conf
# usr/sbin/rear -d -D mkbackup
</pre>

<p>the disklayout.conf file is not in<br />
/var/lib/rear/layout/disklayout.conf<br />
but in that "rear" sub-directory<br />
/.../rear/var/lib/rear/layout/disklayout.conf<br />
below whatever path of parent directories.</p>
<p>Accordingly in the rear recovery system you must<br />
install an updated disklayout.conf into the same<br />
/.../rear/var/lib/rear/layout/disklayout.conf</p>
<p>For example on my SLES12-SP1 test system<br />
I run the newest GitHub master code in /root/rear<br />
with /root/rear/etc/rear/local.conf</p>
<pre>
RECOVERY_UPDATE_URL="http://10.160.4.244/$HOSTNAME.rear-update.tar.gz"
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" curl )
</pre>

<p>where 10.160.4.244 is my HTTP server<br />
and "g215" is the hostname of the system<br />
where I run "usr/sbin/rear -d -D mkbackup".</p>
<p>When I change /root/rear/var/lib/rear/layout/disklayout.conf<br />
I make a tar.gz as</p>
<pre>
tar -czvf g215.rear-update.tar.gz /root/rear/var/lib/rear/layout/disklayout.conf
</pre>

<p>and copy that into /srv/www/htdocs/ on my HTTP server.</p>
<p>In the rear recovery system it looks then as follows:</p>
<pre>
RESCUE g215:~ # rear -d -D recover
...
Updating recovery system with the content from 'http://10.160.4.244/g215.rear-update.tar.gz':
/ ~
root/rear/var/lib/rear/layout/disklayout.conf
~
Updated recovery system.
...
</pre>

<p>This way I get the new disklayout.conf available<br />
in the rear recovery system at<br />
/root/rear/var/lib/rear/layout/disklayout.conf</p>
<p>I guess you get your modified disklayout.conf<br />
installed at the wrong place in your rear recovery system.</p>
<p>Note that the RECOVERY_UPDATE functionality is meant<br />
to be usable in a generic way which is the reason why<br />
it does not have sophisticated built-in "intelligence"<br />
whereto stuff might be "best" installed. It simply installs<br />
any content of the tar.gz in the root '/' of the recovery system.</p>
<h4 id="mzlumin_commented_at_2016-08-08_0945"><img src="https://avatars.githubusercontent.com/u/20663710?v=4" width="50"><a href="https://github.com/mzlumin">mzlumin</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-238189840">2016-08-08 09:45</a>:<a class="headerlink" href="#mzlumin_commented_at_2016-08-08_0945" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix i consider this one can be set to solved or fixed :)</p>
<p>Thanks for all your help and for getting this amazing project running!</p>
<h4 id="jsmeix_commented_at_2016-08-08_1003"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/943#issuecomment-238193701">2016-08-08 10:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-08_1003" title="Permanent link">&para;</a></h4>
<p>@mzlumin<br />
I understand your latest comment that<br />
with the right content in the update tar.gz<br />
it also works for you.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-07-26.943.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
