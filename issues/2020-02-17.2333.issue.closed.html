<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2333 Issue closed: Mapping disks doesn't map corresponding XFS information file - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2333 Issue closed: Mapping disks doesn\u0027t map corresponding XFS information file";
        var mkdocs_page_input_path = "issues/2020-02-17.2333.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2333 Issue closed: Mapping disks doesn't map corresponding XFS information file</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2333_issue_closed_mapping_disks_doesnt_map_corresponding_xfs_information_file"><a href="https://github.com/rear/rear/issues/2333">#2333 Issue</a> <code>closed</code>: Mapping disks doesn't map corresponding XFS information file<a class="headerlink" href="#2333_issue_closed_mapping_disks_doesnt_map_corresponding_xfs_information_file" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="rmetrich_opened_issue_at_2020-02-17_1536"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> opened issue at <a href="https://github.com/rear/rear/issues/2333">2020-02-17 15:36</a>:<a class="headerlink" href="#rmetrich_opened_issue_at_2020-02-17_1536" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): Latest Upstream</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"): RHEL 7</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"): N/A</p>
</li>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR): ALL</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): ALL</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): ALL</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): ALL</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift): XFS</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>When a disk mapping is performed and XFS is used, e.g. <code>/dev/sda</code> to
<code>/dev/vda</code>, there is no mapping done for</p>
<ul>
<li>content of <code>/var/lib/rear/layout/xfs/sdaX.xfs</code></li>
<li>file name <code>/var/lib/rear/layout/xfs/sdaX.xfs</code> which should be mapped
    onto <code>/var/lib/rear/layout/xfs/vdaX.xfs</code></li>
</ul>
<p>This makes <code>rear recover</code> fail due to not using XFS options found in the
information file <code>/var/lib/rear/layout/xfs/vdaX.xfs</code></p>
<ul>
<li>Workaround, if any: Admin must renamed the file
    <code>/var/lib/rear/layout/xfs/sdaX.xfs</code> himself</li>
</ul>
<h2 id="log_file_excerpt">Log file excerpt:<a class="headerlink" href="#log_file_excerpt" title="Permanent link">&para;</a></h2>
<pre><code>+++ mkfs.xfs -f -m uuid=93abea19-a62f-4319-b421-8caf4b01e57b /dev/vdb

--&gt; SHOULD HAVE BEEN mkfs.xfs -f -d sunit=1024,swidth=1024 -m uuid=93abea19-a62f-4319-b421-8caf4b01e57b /dev/vdb

...

+++ mount -o rw,relatime,attr2,inode64,sunit=1024,swidth=1024,noquota /dev/vdb /mnt/local/mnt
mount: wrong fs type, bad option, bad superblock on /dev/vdb,
       missing codepage or helper program, or other error

       In some cases useful info is found in syslog - try
       dmesg | tail or so.
</code></pre>
<h2 id="reproducer">Reproducer:<a class="headerlink" href="#reproducer" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Format a XFS file systems with sunit/swidth option</p>
<pre><code># mkfs.xfs -d sunit=1024,swidth=1024 /dev/sdb
</code></pre>
</li>
<li>
<p>Create a ReaR ISO</p>
<pre><code># rear mkrescue
</code></pre>
</li>
<li>
<p>Recover in a VM with VirtIO instead of SCSI (disk will be mapped
    onto /dev/vdb)</p>
</li>
</ol>
<h4 id="rmetrich_commented_at_2020-02-17_1546"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587053519">2020-02-17 15:46</a>:<a class="headerlink" href="#rmetrich_commented_at_2020-02-17_1546" title="Permanent link">&para;</a></h4>
<p>Probably <code>/usr/share/rear/layout/prepare/default/320_apply_mappings.sh</code>
should be updated to add XFS files:</p>
<pre><code>for file_to_migrate in "$LAYOUT_FILE" "$original_disk_space_usage_file" "$rescue_config_file" $VAR_DIR/layout/xfs/*.xfs; do
</code></pre>
<p>But this isn't sufficient because the files must also be renamed.</p>
<p>Unfortunately I don't have time for now.</p>
<h4 id="gozora_commented_at_2020-02-17_2157"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587171463">2020-02-17 21:57</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-17_2157" title="Permanent link">&para;</a></h4>
<p>I'll take a look.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-02-18_0819"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587336068">2020-02-18 08:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_0819" title="Permanent link">&para;</a></h4>
<p>Cf.<br />
<a href="https://github.com/rear/rear/pull/2005#discussion_r242087432">https://github.com/rear/rear/pull/2005#discussion_r242087432</a></p>
<p>I also set "enhancement" here because the ReaR migration mode<br />
never promised to automatically do 100% of what needs to be done,<br />
for example see things like<br />
<a href="https://github.com/rear/rear/issues/1437">https://github.com/rear/rear/issues/1437</a><br />
<a href="https://github.com/rear/rear/issues/2312">https://github.com/rear/rear/issues/2312</a><br />
<a href="https://github.com/rear/rear/issues/1854">https://github.com/rear/rear/issues/1854</a><br />
...</p>
<h4 id="gozora_commented_at_2020-02-18_0825"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587338079">2020-02-18 08:25</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0825" title="Permanent link">&para;</a></h4>
<p>So far I have following:
<a href="https://github.com/rear/rear/compare/master...gozora:xfs_mapping">https://github.com/rear/rear/compare/master...gozora:xfs_mapping</a><br />
Couple of test I've done so far looks good, but I need to do some more,
before PR is created.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-02-18_0842"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587344258">2020-02-18 08:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_0842" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
another workaround could be using MKFS_XFS_OPTIONS, cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L485">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L485</a></p>
<p>@gozora<br />
perhaps the current behaviour that</p>
<pre><code># The function xfs_parse in lib/filesystems-functions.sh falls back to mkfs.xfs defaults
# (i.e. xfs_parse outputs nothing) when there is no $xfs_info_filename file where the
# XFS filesystem options of that particular device on the original system were saved
</code></pre>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/GNU/Linux/131_include_filesystem_code.sh#L175">https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/GNU/Linux/131_include_filesystem_code.sh#L175</a><br />
is not right in migration mode?</p>
<p>Perhaps in migration mode it should be "some kind of error"<br />
when there is no <code>$VAR_DIR/layout/xfs/$XFS_DEVICE.xfs</code>.<br />
With "some kind of error" I mean there should be at least<br />
a <code>LogPrintError</code> message that tells about it or<br />
might there perhaps be even a hard <code>Error</code> exit<br />
or is it perhaps almost always better to create the XFS<br />
with defaults in migration mode when there is no<br />
<code>$VAR_DIR/layout/xfs/$XFS_DEVICE.xfs</code>?</p>
<h4 id="jsmeix_commented_at_2020-02-18_0901"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587351021">2020-02-18 09:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_0901" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
on first glance I think the current code in your<br />
<a href="https://github.com/rear/rear/compare/master...gozora:xfs_mapping">https://github.com/rear/rear/compare/master...gozora:xfs_mapping</a></p>
<pre><code>    for file in $(ls ${work_file_source}[0-9]*.xfs); do
       suffix=${file##$work_file_source}
       cp $file ${work_file_target}${suffix}.restore
</code></pre>
<p>depends on the assumption that a device node where<br />
XFS is created is always of the form <code>disk_device[0-9]*</code>.</p>
<p>I fear this is perhaps not always the case<br />
e.g. whatever higher-level storage objects<br />
like LVM logical volumes or RAID arrays?</p>
<p>For example on one of my current test systems I have</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT

NAME                             KNAME      PKNAME     TRAN TYPE  FSTYPE             SIZE MOUNTPOINT
/dev/sda                         /dev/sda              ata  disk                      20G 
|-/dev/sda1                      /dev/sda1  /dev/sda        part                       1G 
|-/dev/sda2                      /dev/sda2  /dev/sda        part  linux_raid_member    4G 
| `-/dev/md126                   /dev/md126 /dev/sda2       raid1 LVM2_member          4G 
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md126      lvm   ext4                13G /
|-/dev/sda3                      /dev/sda3  /dev/sda        part  linux_raid_member    5G 
| `-/dev/md127                   /dev/md127 /dev/sda3       raid1 LVM2_member          5G 
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md127      lvm   ext4                13G /
|-/dev/sda4                      /dev/sda4  /dev/sda        part  linux_raid_member    6G 
| `-/dev/md125                   /dev/md125 /dev/sda4       raid1 LVM2_member          6G 
|   |-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md125      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvhome /dev/dm-1  /dev/md125      lvm   ext3                 1G /home
`-/dev/sda5                      /dev/sda5  /dev/sda        part  linux_raid_member    2G 
  `-/dev/md124                   /dev/md124 /dev/sda5       raid0 ext2                 3G /other
/dev/sdb                         /dev/sdb              ata  disk                      21G 
|-/dev/sdb1                      /dev/sdb1  /dev/sdb        part                       1G 
|-/dev/sdb2                      /dev/sdb2  /dev/sdb        part  linux_raid_member    4G 
| `-/dev/md126                   /dev/md126 /dev/sdb2       raid1 LVM2_member          4G 
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md126      lvm   ext4                13G /
|-/dev/sdb3                      /dev/sdb3  /dev/sdb        part  linux_raid_member    5G 
| `-/dev/md127                   /dev/md127 /dev/sdb3       raid1 LVM2_member          5G 
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md127      lvm   ext4                13G /
|-/dev/sdb4                      /dev/sdb4  /dev/sdb        part  linux_raid_member    6G 
| `-/dev/md125                   /dev/md125 /dev/sdb4       raid1 LVM2_member          6G 
|   |-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md125      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvhome /dev/dm-1  /dev/md125      lvm   ext3                 1G /home
|-/dev/sdb5                      /dev/sdb5  /dev/sdb        part  linux_raid_member    1G 
| `-/dev/md124                   /dev/md124 /dev/sdb5       raid0 ext2                 3G /other
`-/dev/sdb6                      /dev/sdb6  /dev/sdb        part  swap                 2G [SWAP]
</code></pre>
<p>that contains in particular (excerpt)</p>
<pre><code>NAME                             KNAME      PKNAME     TRAN TYPE  FSTYPE             SIZE MOUNTPOINT
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md126      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md127      lvm   ext4                13G /
|   |-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md125      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvhome /dev/dm-1  /dev/md125      lvm   ext3                 1G /home
  `-/dev/md124                   /dev/md124 /dev/sda5       raid0 ext2                 3G /other
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md126      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md127      lvm   ext4                13G /
|   |-/dev/mapper/vg15gib-lvroot /dev/dm-0  /dev/md125      lvm   ext4                13G /
|   `-/dev/mapper/vg15gib-lvhome /dev/dm-1  /dev/md125      lvm   ext3                 1G /home
| `-/dev/md124                   /dev/md124 /dev/sdb5       raid0 ext2                 3G /other
</code></pre>
<p>so neither NAME (like <code>/dev/mapper/vg15gib-lvroot</code>)<br />
nor KNAME (like <code>/dev/dm-0</code>) match <code>disk_device[0-9]*</code><br />
(I assume <code>disk_device</code> is not <code>dm-</code> but only <code>dm</code>).</p>
<h4 id="gozora_commented_at_2020-02-18_0903"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587351954">2020-02-18 09:03</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0903" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Perhaps in migration mode it should be "some kind of error"<br />
when there is no $VAR_DIR/layout/xfs/$XFS_PARTITION_DEVICE.xfs.<br />
With "some kind of error" I mean there should be at least<br />
a LogPrintError message that tells about it or<br />
might there perhaps be even a hard Error exit<br />
or is it perhaps almost always better to create the XFS<br />
with defaults in migration mode when there is no<br />
$VAR_DIR/layout/xfs/$XFS_PARTITION_DEVICE.xfs?</p>
</blockquote>
<p>Lets try with "just a log message" for start.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-02-18_0905"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587352652">2020-02-18 09:05</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0905" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks for your
<a href="https://github.com/rear/rear/issues/2333#issuecomment-587351021">https://github.com/rear/rear/issues/2333#issuecomment-587351021</a>,
Like I said, it need some more testing ;-). I'll look into that for
sure.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-02-18_0925"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587361165">2020-02-18 09:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_0925" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
according to<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/GNU/Linux/131_include_filesystem_code.sh#L183">https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/GNU/Linux/131_include_filesystem_code.sh#L183</a></p>
<pre><code># In case of fallback to mkfs.xfs defaults xfs_opts is empty:
contains_visible_char "$xfs_opts" &amp;&amp; Log "Using $xfs_device_basename mkfs.xfs options: $xfs_opts" || LogPrint "Using $xfs_device_basename mkfs.xfs defaults"
</code></pre>
<p>I would assume there was a message on the terminal where "rear recover"
runs</p>
<pre><code>Using vdb mkfs.xfs defaults
</code></pre>
<p>before the</p>
<pre><code>Confirm disk recreation script and continue 'rear recover'
</code></pre>
<p>user confirmation dialog that one gets in migration mode?</p>
<p>So I assume there was at least a small info shown to the user<br />
that could make him aware about such XFS issues?</p>
<p>Or was there no info and things went "silently wrong"?</p>
<h4 id="jsmeix_commented_at_2020-02-18_0931"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587364049">2020-02-18 09:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_0931" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
the initial comment here shows already an example</p>
<pre><code>mkfs.xfs -d sunit=1024,swidth=1024 /dev/sdb
</code></pre>
<p>where the device node name where XFS is created<br />
does not match <code>disk_device[0-9]*</code>.<br />
Here it seems the XFS should be created on the raw disk.</p>
<h4 id="gozora_commented_at_2020-02-18_0939"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587367811">2020-02-18 09:39</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0939" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>yep, fully agree!<br />
I wanted to have at least some code that could be improved ;-), That is
how I usually work.<br />
I'll try to make it better before official PR is created.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-02-18_0944"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587370100">2020-02-18 09:44</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0944" title="Permanent link">&para;</a></h4>
<p>@jsmeix @rmetrich if you want, you can of course take over and fix this
problem by your self (I'll not be angry at all), I've assigned this
issue to my self mainly because its my code that is not working properly
;-).</p>
<p>V.</p>
<h4 id="rmetrich_commented_at_2020-02-18_0949"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587372798">2020-02-18 09:49</a>:<a class="headerlink" href="#rmetrich_commented_at_2020-02-18_0949" title="Permanent link">&para;</a></h4>
<p>@gozora no no, assign it to yourself, I really don't have any time to
deal with this now.<br />
And thank you already for your involvement.</p>
<h4 id="gozora_commented_at_2020-02-18_0951"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587373656">2020-02-18 09:51</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_0951" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>My code gets even funnier:</p>
<pre><code>RESCUE suse-efi:/var/lib/rear/layout/xfs # ll
total 48
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdavgdata-lv_data1.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdavgdata-lv_data2.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdavgdata-lv_data3.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcsdavgdata-lv_data1.xfs.restore.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcsdavgdata-lv_data2.xfs.restore.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcsdavgdata-lv_data3.xfs.restore.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcvgdata-lv_data1.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcvgdata-lv_data2.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:55 sdcvgdata-lv_data3.xfs.restore
-rw-r--r-- 1 root root 673 Feb 18 10:34 vgdata-lv_data1.xfs
-rw-r--r-- 1 root root 673 Feb 18 10:34 vgdata-lv_data2.xfs
-rw-r--r-- 1 root root 673 Feb 18 10:34 vgdata-lv_data3.xfs
</code></pre>
<p>It will need much more improvement :-)</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-02-18_1055"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587401862">2020-02-18 10:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_1055" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
my offhanded idea is to not mess around with file names<br />
but to use a <code>restore</code> sub-directory instead.</p>
<h4 id="gozora_commented_at_2020-02-18_1057"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587403198">2020-02-18 10:57</a>:<a class="headerlink" href="#gozora_commented_at_2020-02-18_1057" title="Permanent link">&para;</a></h4>
<p>Do you mean to copy relevant (*.xfs) files into
/var/lib/rear/layout/xfs/restore?</p>
<h4 id="jsmeix_commented_at_2020-02-18_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-587455435">2020-02-18 13:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-02-18_1317" title="Permanent link">&para;</a></h4>
<p>Yes, something like that - but it is only an offhanded idea.</p>
<h4 id="gozora_commented_at_2020-04-15_1058"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-613969837">2020-04-15 10:58</a>:<a class="headerlink" href="#gozora_commented_at_2020-04-15_1058" title="Permanent link">&para;</a></h4>
<p>Due lack of time I'm assigning "ReaR future" label.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-06-15_2114"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-644394005">2020-06-15 21:14</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-15_2114" title="Permanent link">&para;</a></h4>
<p>Just a status update after couple of months :-).<br />
Now I have some seemingly working code in
<a href="https://github.com/gozora/rear/tree/xfs_new">gozora/xfs_new</a>.<br />
So far I've tested migration on standalone (/dev/sd) and dm-multipath
devices, which worked well.<br />
I'd like to test with software RAID in upcoming days.<br />
Code comments will of course follow soon.</p>
<p>Any comments, tests, recommendations are more then welcome!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-06-18_2115"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-646309847">2020-06-18 21:15</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_2115" title="Permanent link">&para;</a></h4>
<p>I just successfully migrated VM from VirtualBox to Qemu. Code in
<a href="https://github.com/gozora/rear/tree/xfs_new">gozora/xfs_new</a> is
renaming source configuration files to destination just fine. I'll add
comments to new code and create PR soon.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-06-22_1535"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2333#issuecomment-647600054">2020-06-22 15:35</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-22_1535" title="Permanent link">&para;</a></h4>
<p>With #2431 merged, this issue can be closed.</p>
<p>V.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-02-17.2333.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
