<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2500 Issue closed: OUTPUT=USB fails to UEFI boot on Lenovo X390 but OUTPUT=RAWDISK works - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2500 Issue closed: OUTPUT=USB fails to UEFI boot on Lenovo X390 but OUTPUT=RAWDISK works";
        var mkdocs_page_input_path = "issues/2020-10-13.2500.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2500 Issue closed: OUTPUT=USB fails to UEFI boot on Lenovo X390 but OUTPUT=RAWDISK works</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2500_issue_closed_outputusb_fails_to_uefi_boot_on_lenovo_x390_but_outputrawdisk_works"><a href="https://github.com/rear/rear/issues/2500">#2500 Issue</a> <code>closed</code>: OUTPUT=USB fails to UEFI boot on Lenovo X390 but OUTPUT=RAWDISK works<a class="headerlink" href="#2500_issue_closed_outputusb_fails_to_uefi_boot_on_lenovo_x390_but_outputrawdisk_works" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>,
<code>special hardware or VM</code></p>
<h4 id="mrmanor_opened_issue_at_2020-10-13_1947"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> opened issue at <a href="https://github.com/rear/rear/issues/2500">2020-10-13 19:47</a>:<a class="headerlink" href="#mrmanor_opened_issue_at_2020-10-13_1947" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.6 / 2020-06-17</li>
<li>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</li>
</ul>
<!-- -->

<pre><code>ituska:~ # cat /etc/os-release
NAME="openSUSE Leap"
VERSION="15.2"
ID="opensuse-leap"
ID_LIKE="suse opensuse"
VERSION_ID="15.2"
PRETTY_NAME="openSUSE Leap 15.2"
ANSI_COLOR="0;32"
CPE_NAME="cpe:/o:opensuse:leap:15.2"
BUG_REPORT_URL="https://bugs.opensuse.org"
HOME_URL="https://www.opensuse.org/"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>ituska:~ # cat /etc/rear/*.conf | grep -v ^#
OS_VENDOR=SUSE_LINUX
OS_VERSION=15

OUTPUT=USB
USB_DEVICE=/dev/disk/by-label/REAR-000
USING_UEFI_BOOTLOADER=yes
GRUB_RESCUE=n
EXCLUDE_BACKUP+=( fs:/crash )
COPY_AS_IS+=( /usr/src/linux-* )

SSH_FILES='yes'
SSH_UNPROTECTED_PRIVATE_KEYS="yes"

BACKUP=BORG
BORGBACKUP_HOST="raagi.tng.vink-slott.dk"
BORGBACKUP_USERNAME="borg"
BORGBACKUP_REPO="/~/${HOSTNAME}"
BORGBACKUP_PRUNE_KEEP_HOURLY=5
BORGBACKUP_PRUNE_KEEP_WEEKLY=2
BORGBACKUP_COMPRESSION="zlib,8"

BORGBACKUP_ENC_TYPE="keyfile"
export BORG_KEYS_DIR=~root/keys
export BORG_PASSPHRASE="****"
COPY_AS_IS_BORG=( $BORG_KEYS_DIR )

export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    Lenovo X390</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI with GRUB2</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    localSSD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                    KNAME          PKNAME         TRAN   TYPE  FSTYPE        SIZE MOUNTPOINT
/dev/sda                /dev/sda                      usb    disk  iso9660       7.2G 
|-/dev/sda1             /dev/sda1      /dev/sda              part  vfat          400M 
`-/dev/sda2             /dev/sda2      /dev/sda              part  ext3          6.8G 
/dev/nvme0n1            /dev/nvme0n1                  nvme   disk                477G 
|-/dev/nvme0n1p1        /dev/nvme0n1p1 /dev/nvme0n1   nvme   part  vfat          500M /boot/efi
|-/dev/nvme0n1p2        /dev/nvme0n1p2 /dev/nvme0n1   nvme   part  crypto_LUKS   147G 
| `-/dev/mapper/cr_root /dev/dm-1      /dev/nvme0n1p2        crypt xfs           147G /
|-/dev/nvme0n1p3        /dev/nvme0n1p3 /dev/nvme0n1   nvme   part  crypto_LUKS 314.1G 
| `-/dev/mapper/cr_home /dev/dm-2      /dev/nvme0n1p3        crypt xfs         314.1G /home
`-/dev/nvme0n1p4        /dev/nvme0n1p4 /dev/nvme0n1   nvme   part  crypto_LUKS  15.4G 
  `-/dev/mapper/cr_swap /dev/dm-0      /dev/nvme0n1p4        crypt swap         15.4G [SWAP]
</code></pre>
<p>(/dev/sda is target USB stick for rear)</p>
<ul>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    Backup seems to complete without major issues, and content in backup
    target. But when I try to select the USB for boot, the Lenovo
    returns to the boot menu within seconds</p>
</li>
<li>
<p>Workaround, if any:<br />
    No idea</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
    rear -D mkrescue</p>
</li>
</ul>
<p>verbatim content from a prevous run</p>
<pre><code>ituska:~ # rear -v mkbackup                                    
Relax-and-Recover 2.6 / 2020-06-17
Running rear mkbackup (PID 4163)
Using log file: /var/log/rear/rear-ituska.log
Running workflow mkbackup on the normal/original system
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-5.3.18-lp152.44-default' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /var/lib/rear/layout/disklayout.conf
Using sysconfig bootloader 'grub2-efi'
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
Creating recovery system root filesystem skeleton layout
To log into the recovery system via ssh set up /root/.ssh/authorized_keys or specify SSH_ROOT_PASSWORD
Trying to find what to use as UEFI bootloader...
Trying to find a 'well known file' to be used as UEFI bootloader...
Using '/boot/efi/EFI/opensuse/grubx64.efi' as UEFI bootloader file
Copying logfile /var/log/rear/rear-ituska.log into initramfs as '/tmp/rear-ituska-partial-2020-10-13T21:06:19+02:00.log'
Copying files and directories
Copying binaries and libraries
Copying all kernel modules in /lib/modules/5.3.18-lp152.44-default (MODULES contains 'all_modules')
Copying all files in /lib*/firmware/
Testing that the recovery system in /tmp/rear.vR2n5ifUx2qbJXr/rootfs contains a usable system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (357287957 bytes) in 33 seconds
GRUB2 modules to load: cryptodisk fat gcry_rijndael gcry_sha256 luks part_gpt xfs
Saved /var/log/rear/rear-ituska.log as rear/ituska/20201013.2106/rear-ituska.log
Creating backup archive 'rear_6' in Borg repository /~/ituska on raagi.tng.vink-slott.dk
Creating archive at "ssh://borg@raagi.tng.vink-slott.dk:22/~/ituska::rear_6"
Pruning old backup archives in Borg repository /~/ituska on raagi.tng.vink-slott.dk
Exiting rear mkbackup (PID 4163) and its descendant processes ...
Running exit tasks
</code></pre>
<h4 id="mrmanor_commented_at_2020-10-13_1951"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-707970823">2020-10-13 19:51</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-13_1951" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/5373754/rear-ituska.log">rear-ituska.log</a><br />
Log from rear -D mkrescue</p>
<h4 id="gozora_commented_at_2020-10-13_2143"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708026060">2020-10-13 21:43</a>:<a class="headerlink" href="#gozora_commented_at_2020-10-13_2143" title="Permanent link">&para;</a></h4>
<p>Hello @MrManor,</p>
<p>What kernel version are you using?</p>
<p>Maybe it is
<a href="https://github.com/rear/rear/issues/2254">https://github.com/rear/rear/issues/2254</a>
related?</p>
<p>V.</p>
<h4 id="mrmanor_commented_at_2020-10-14_0638"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708193218">2020-10-14 06:38</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-14_0638" title="Permanent link">&para;</a></h4>
<blockquote>
<p>What kernel version are you using?</p>
</blockquote>
<pre><code>Linux ituska 5.3.18-lp152.44-default #1 SMP Wed Sep 30 18:51:43 UTC 2020 (914f31e) x86_64 x86_64 x86_64 GNU/Linux
</code></pre>
<blockquote>
<p>Maybe it is #2254 related?<br />
I dont think so - To me seems that the PC never starts to load the
kernel. When I select the USB stick from the bios menu with possible
devices for boot, the PC switches to a black (textmode?) screen for a
less than 1 sec - and then returns to the bios boot select menu. So I
was more guessing that I (or ReaR) got something UEFI related wrong.<br />
That was also why I tried inserting the USING_UEFI_BOOTLOADER
statement above.</p>
</blockquote>
<h4 id="gozora_commented_at_2020-10-14_0708"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708207189">2020-10-14 07:08</a>:<a class="headerlink" href="#gozora_commented_at_2020-10-14_0708" title="Permanent link">&para;</a></h4>
<p>Can you try with ReaR 2.5 ?<br />
We have introduced <a href="https://github.com/rear/rear/pull/2293">new way</a> how
EFI images (*.efi) are created in ReaR 2.6 ...</p>
<p>Maybe it will help, and you finally hit the problem from #2254 :-).</p>
<p>V.</p>
<h4 id="mrmanor_commented_at_2020-10-14_0755"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708229632">2020-10-14 07:55</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-14_0755" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Can you try with ReaR 2.5 ?</p>
</blockquote>
<p>You want me to downgrade? I am running 2.6 / 2020-06-17 at the moment.</p>
<blockquote>
<p>We have introduced <a href="https://github.com/rear/rear/pull/2293">new way</a>
how EFI images (*.efi) are created in ReaR 2.6 ...</p>
</blockquote>
<p>It is a long tread - I'll will have to dig into it after work...</p>
<blockquote>
<p>Maybe it will help, and you finally hit the problem from #2254 :-).</p>
</blockquote>
<p>Well that would be progress, wouldn't it :-)</p>
<p>As I have never worked with ReaR before: I would like to know what to
expect when I some day manage to boot from the USB stick? Will it load a
GRUB menu, a kernel starting to load, or some ReaR related menu?</p>
<h4 id="mrmanor_commented_at_2020-10-14_1610"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708505172">2020-10-14 16:10</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-14_1610" title="Permanent link">&para;</a></h4>
<p>So I removed ReaR 2.6 and found Rear v. 2.3 in OpenSUSE's official
repository. I removed "USING_UEFI_BOOTLOADER=yes" from the config, and
did another run. No difference - the Lenovo still refuses to boot.</p>
<h4 id="gozora_commented_at_2020-10-14_1759"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-708566387">2020-10-14 17:59</a>:<a class="headerlink" href="#gozora_commented_at_2020-10-14_1759" title="Permanent link">&para;</a></h4>
<p>That is actually a good sign, means one problem less.<br />
When time permits. I'll install OpenSUSE 15.2 with ReaR 2.6 on USB and
Borg back-end and try to reproduce your problem.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-10-16_1138"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-709993748">2020-10-16 11:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-10-16_1138" title="Permanent link">&para;</a></h4>
<p>@MrManor<br />
I am not at all a booting expert and even less an expert with UEFI
booting<br />
so just as a basically blind shot into the dark:</p>
<p>Do you perhaps have other hardware that can boot from USB?<br />
If yes could you try if the USB with the ReaR recovery system boots on
different hardware?<br />
Of course you would not run "rear recover" on the other hardware but
there should be no harm<br />
when you only boot the ReaR recovery system and when it boots only shut
it down.</p>
<p>My reason behind is that I noticed that you have a NVMe disk<br />
which indicates that the Lenovo X390 is rather modern hardware<br />
and perhaps this particular hardware behaves somehow special?</p>
<p>@gozora<br />
for SUSE systems we have<br />
usr/share/rear/finalize/SUSE_LINUX/i386/675_install_shim.sh<br />
cf.
<a href="https://github.com/rear/rear/issues/2116">https://github.com/rear/rear/issues/2116</a><br />
therein in particular <code>UEFI (secure boot NOT enabled) + GRUB2-EFI</code><br />
so it seems on SUSE systems calling "shim-install" is needed in any case
for UEFI<br />
so it may be also needed to make a UEFI bootable USB device<br />
but I am no expert here and may confuse things.</p>
<h4 id="jsmeix_commented_at_2020-10-16_1230"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-710016096">2020-10-16 12:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-10-16_1230" title="Permanent link">&para;</a></h4>
<p>@MrManor<br />
regarding how things look like when booting from USB via UEFI and GRUB<br />
you may have a look at<br />
<a href="https://github.com/rear/rear/issues/2276">https://github.com/rear/rear/issues/2276</a><br />
where @gozora posted some screenshots, e.g.<br />
<a href="https://github.com/rear/rear/issues/2276#issuecomment-559269612">https://github.com/rear/rear/issues/2276#issuecomment-559269612</a><br />
<a href="https://github.com/rear/rear/issues/2276#issuecomment-562843028">https://github.com/rear/rear/issues/2276#issuecomment-562843028</a><br />
how the GRUB menue would look like<br />
provided the UEFI firmware was able to load and run GRUB which seems to
fail here.<br />
Then in the GRUB menue you could select what kernel (and initrd) GRUB
should load.</p>
<h4 id="mrmanor_commented_at_2020-10-16_1531"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-710117550">2020-10-16 15:31</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-16_1531" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Do you perhaps have other hardware that can boot from USB?</p>
</blockquote>
<p>I found a very old desktop, one capable of both EFI and legacy boot. I
am sure no expert on UEFI boot either, so I am not sure if the "U" makes
any difference.</p>
<p>Tried the USB keys made using ReaR v. 2.3 and also the one made using
ReaR v. 2.6. They both loaded successfully when selecting EFI from the
PC boot menu. I came to a grub menu in both cases, although only one
menu item from the v2.3 generation. From the v 2.6 I selected "Secure
boot" and in both cases I managed to boot up all the way, to a root
login prompt.</p>
<h4 id="mrmanor_commented_at_2020-10-16_1539"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-710121801">2020-10-16 15:39</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-10-16_1539" title="Permanent link">&para;</a></h4>
<blockquote>
<p>My reason behind is that I noticed that you have a NVMe disk<br />
which indicates that the Lenovo X390 is rather modern hardware<br />
and perhaps this particular hardware behaves somehow special?</p>
</blockquote>
<p>Yes it is quite new. But it should be possible to build a USB boot stick
for it. After all, it came with windows and I replaced it using a <a href="http://download.opensuse.org/distribution/leap/15.2/iso/openSUSE-Leap-15.2-NET-x86_64.iso">LEAP
15.2
install</a>
placed on a USB</p>
<h4 id="olivero2_commented_at_2020-11-09_2111"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724280432">2020-11-09 21:11</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-09_2111" title="Permanent link">&para;</a></h4>
<p>@MrManor<br />
The <code>RAWDISK</code> output method in ReaR has its independent implementation
for creating bootable media. It creates an image file which can be
copied with <code>dd</code> to a USB stick. You could quickly try if that works for
you:</p>
<ol>
<li>In your ReaR configuration file:<ul>
<li>Change <code>OUTPUT=USB</code> to <code>OUTPUT=RAWDISK</code></li>
<li>Add <code>OUTPUT_URL="file:///var/lib/rear/output"</code></li>
<li>If secure boot is enabled, set <code>SECURE_BOOT_BOOTLOADER</code> to your
    system's shim path, e.g.
    <code>SECURE_BOOT_BOOTLOADER="/boot/efi/EFI/BOOT/shim.efi"</code> as
    described in <code>default.conf</code>.</li>
</ul>
</li>
<li>Run <code>sudo rear mkrescue</code></li>
<li>Copy the image to your USB stick:<ul>
<li>Use <code>lsblk -o +MODEL</code> to find the correct disk device path for
    your USB stick (typically <code>/dev/sdX</code>).</li>
<li><strong>RE-CHECK. The following command will overwrite the entire USB
    stick.</strong></li>
<li>Use the following command, replacing <code>USB-DEVICE</code> with the USB
    stick’s device name.
        sudo zcat "/var/lib/rear/output/$(hostname)/rear-$(hostname).raw.gz" | sudo dd bs=1M of=/dev/USB-DEVICE</li>
</ul>
</li>
</ol>
<h4 id="mrmanor_commented_at_2020-11-10_1925"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724915242">2020-11-10 19:25</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-11-10_1925" title="Permanent link">&para;</a></h4>
<p>@OliverO2: Thanks for looking into this problem.</p>
<p>I found the shim.efi and modified site.conf like this (rest of site.conf
is like shown in my first post):</p>
<pre><code>### Rescue boot ###
OUTPUT=RAWDISK
OUTPUT_URL="file:///var/lib/rear/output"
SECURE_BOOT_BOOTLOADER="/boot/efi/EFI/opensuse/shim.efi"
USB_DEVICE=/dev/disk/by-label/REAR-000
#USING_UEFI_BOOTLOADER=yes
GRUB_RESCUE=n
#ONLY_INCLUDE_VG=( "vg00" )
#EXCLUDE_BACKUP+=( fs:/crash fs:/usr/sap fs:/oracle )
EXCLUDE_BACKUP+=( fs:/crash )
COPY_AS_IS+=( /usr/src/linux-* )
</code></pre>
<p>Ran command as root</p>
<pre><code>ituska:~ # rear mkrescue
ERROR: Could not copy result files to /var/lib/rear/output/ituska at file location
Aborting due to an error, check /var/log/rear/rear-ituska.log for details
Terminated
</code></pre>
<p>But it failed. I really cant guess why. There is plenty of space on
disk, the ../output catalog is there, but not mutch in it.</p>
<pre><code>klaus@ituska:~&gt; sudo tree /var/lib/rear/output/ituska
/var/lib/rear/output/ituska
├── rear-ituska.log
└── VERSION
</code></pre>
<p><a href="https://github.com/rear/rear/files/5519698/rear-ituska.log">rear-ituska.log</a></p>
<p>By the way. This using the downgraded 2.3 version of Rear as suggested
by @gozora earlier.</p>
<h4 id="olivero2_commented_at_2020-11-10_2035"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724951685">2020-11-10 20:35</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-10_2035" title="Permanent link">&para;</a></h4>
<p>Thanks for providing detailed information.</p>
<p>As <code>OUTPUT=RAWDISK</code> premiered in ReaR v2.4, it was not used in your last
run with v2.3. So you need to use a more recent version of ReaR. Version
2.6 will be fine.</p>
<h4 id="mrmanor_commented_at_2020-11-10_2117"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724971985">2020-11-10 21:17</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-11-10_2117" title="Permanent link">&para;</a></h4>
<p>Success! I was able to boot into the rescue system using the usb build
from rear mkrescue.</p>
<h4 id="olivero2_commented_at_2020-11-10_2118"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724972731">2020-11-10 21:18</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-10_2118" title="Permanent link">&para;</a></h4>
<p>Excellent! Thanks for your feedback!</p>
<h4 id="mrmanor_commented_at_2020-11-10_2207"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-724996463">2020-11-10 22:07</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-11-10_2207" title="Permanent link">&para;</a></h4>
<p>So now I know how to build a usb for rescue boot. Not very user frendly
- but it can boot.<br />
Can I modify my settings to use this way of creating a boot stick during
normal <strong>rear mkbackup</strong>? (I did try to just change RAW back to USB and
run rear mkbackup, but this was no good)</p>
<h4 id="olivero2_commented_at_2020-11-10_2219"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725001878">2020-11-10 22:19</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-10_2219" title="Permanent link">&para;</a></h4>
<p><code>RAWDISK</code> was created to have bootable disk images which can be
transferred to any kind of disk (USB stick or other). <code>RAWDISK</code> recovery
images are expected to be stored somewhere in the regular file system
and <code>dd</code>'ed to a USB stick when necessary. In my case, I store those
disk images on backup media right next to the backup data.</p>
<p>So no, there is no built-in mechanism to automatically transfer
<code>RAWDISK</code> images to a USB stick during <code>mkbackup</code>.</p>
<h4 id="jsmeix_commented_at_2020-11-11_0752"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725265909">2020-11-11 07:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-11_0752" title="Permanent link">&para;</a></h4>
<p>Only as a side note about a similar issue see<br />
<a href="https://github.com/rear/rear/issues/2210">https://github.com/rear/rear/issues/2210</a></p>
<p>Accordingly something like</p>
<pre><code>rear mkbackup &amp;&amp; dd bs=1M if=&lt;RAWDISK_image_file&gt; of=&lt;USB_disk_device&gt;
</code></pre>
<p>could do "all in one" automatically<br />
but it mercilessly overwrites any &lt;USB_disk_device&gt; that exists
at that time<br />
so manually overwriting the right USB device is probably safer.</p>
<p>Alternatively "inside" ReaR one could use POST_BACKUP_SCRIPT<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L3145">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L3145</a><br />
but POST_BACKUP_SCRIPT only works for the mkbackup/mkbackuponly
workflows<br />
(i.e. not for "rear mkrescue").</p>
<h4 id="jsmeix_commented_at_2020-11-11_0759"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725269079">2020-11-11 07:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-11_0759" title="Permanent link">&para;</a></h4>
<p>FYI<br />
the error exit in
<a href="https://github.com/rear/rear/issues/2500#issuecomment-724915242">https://github.com/rear/rear/issues/2500#issuecomment-724915242</a><br />
that shows up in
<a href="https://github.com/rear/rear/files/5519698/rear-ituska.log">https://github.com/rear/rear/files/5519698/rear-ituska.log</a>
as</p>
<pre><code>2020-11-10 20:15:01.486152863 Copying result files '/tmp/rear.MDScTcSPRhEjgI8/tmp/VERSION /tmp/rear.MDScTcSPRhEjgI8/tmp/README /tmp/rear.MDScTcSPRhEjgI8/tmp/rear-ituska.log' to /var/lib/rear/output/ituska at file location
cp: cannot stat '/tmp/rear.MDScTcSPRhEjgI8/tmp/README': No such file or directory
2020-11-10 20:15:01.489660275 ERROR: Could not copy result files to /var/lib/rear/output/ituska at file location
</code></pre>
<p>was fixed via
<a href="https://github.com/rear/rear/pull/2147">https://github.com/rear/rear/pull/2147</a>
for ReaR 2.6</p>
<h4 id="jsmeix_commented_at_2020-11-11_0817"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725276827">2020-11-11 08:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-11_0817" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for your help here!</p>
<p>FYI:<br />
I improved the RAWDISK dd example command in default.conf via<br />
<a href="https://github.com/rear/rear/commit/7c6949fe228eee7aaf869f64f15e77546bbd126e">https://github.com/rear/rear/commit/7c6949fe228eee7aaf869f64f15e77546bbd126e</a></p>
<h4 id="olivero2_commented_at_2020-11-11_0823"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725279410">2020-11-11 08:23</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-11_0823" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Good point. While you're at it, you might consider compression (enabled
by default) and change the line to something similar as posted above:</p>
<pre><code>sudo zcat "$image_file" | sudo dd bs=1M of="$disk_device"
</code></pre>
<h4 id="jsmeix_commented_at_2020-11-11_0900"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725296382">2020-11-11 09:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-11_0900" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you to point that out. I did<br />
<a href="https://github.com/rear/rear/commit/8f09ede7d617290e948dd779539d4da385d454e3">https://github.com/rear/rear/commit/8f09ede7d617290e948dd779539d4da385d454e3</a></p>
<h4 id="mrmanor_commented_at_2020-11-11_1916"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725610494">2020-11-11 19:16</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-11-11_1916" title="Permanent link">&para;</a></h4>
<p>Thanks a lot for your attention and pointing me to a workable solution.
I guess this issue can be closed by that. Sorry if my limited English
made me miss some points during this issue, but I do suspect others will
end up in the same situation like me - pussled by not being able to boot
after running rear mkbackup.</p>
<h4 id="jsmeix_commented_at_2020-11-12_0731"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-725895579">2020-11-12 07:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-12_0731" title="Permanent link">&para;</a></h4>
<p>@MrManor<br />
thank you for your issue report and your cooperative feedback.<br />
Don't worry about your English - it is more than good enough.</p>
<p>I reopen the issue because we need some enhancement in ReaR<br />
to make a UEFI bootable USB medium for the <code>OUTPUT=USB</code> method<br />
that works as good as <code>OUTPUT=RAWDISK</code> already does.</p>
<p>But I am not at all a sufficient UEFI expert to implement that myself.<br />
So someone else would have to compare the <code>OUTPUT=USB</code> code<br />
with the <code>OUTPUT=RAWDISK</code> code to find out what <code>OUTPUT=RAWDISK</code><br />
does better and then improve the <code>OUTPUT=USB</code> code accordingly.</p>
<p>Because all that would have to happen on a voluntary base<br />
it means it is unknown if that would happen and when.<br />
Accordingly the "Milestone" of this issue is "ReaR future",<br />
cf.
<a href="https://github.com/rear/rear/milestones">https://github.com/rear/rear/milestones</a></p>
<p>So at least for now using <code>OUTPUT=RAWDISK</code><br />
plus manual creating the bootable USB medium<br />
is the right way for those cases where <code>OUTPUT=USB</code><br />
fails to make a UEFI bootable USB medium.</p>
<h4 id="mrmanor_commented_at_2020-11-17_1850"><img src="https://avatars.githubusercontent.com/u/4838974?u=90b6d54e6e83c88de3d3b25e135a8cce0ba50a50&v=4" width="50"><a href="https://github.com/MrManor">MrManor</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-729129726">2020-11-17 18:50</a>:<a class="headerlink" href="#mrmanor_commented_at_2020-11-17_1850" title="Permanent link">&para;</a></h4>
<p>Thanks for your feedback - and I must say I was very unsure if I should
close the issue. I could not really grasp from your feedback if you
considered the problem as solved.<br />
I will stay following this issue and please let me know if I can of any
assistance in testing.</p>
<h4 id="github-actions_commented_at_2021-01-17_0256"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-761721470">2021-01-17 02:56</a>:<a class="headerlink" href="#github-actions_commented_at_2021-01-17_0256" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="gdha_commented_at_2022-02-28_1550"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-1054395372">2022-02-28 15:50</a>:<a class="headerlink" href="#gdha_commented_at_2022-02-28_1550" title="Permanent link">&para;</a></h4>
<p>A customer using IoT Lenovo SE30 with Ubuntu 20.04 seems to have the
same issue as above issue is describing - by adding<br />
<em>REAR_INITRD_COMPRESSION=lzma</em></p>
<p>to local.conf file and reformatted the USB device and then made the
image.</p>
<p>It fails to boot.<br />
Then I go into and edit the boot strings and <strong>add (hd0,1)</strong> to both,
kernel and initrd lines.<br />
Then I boot, it takes a good 3 min and guess what, I get the “ReaR”
login screen now, awesome!!!</p>
<h4 id="gdha_commented_at_2022-03-03_1624"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-1058228584">2022-03-03 16:24</a>:<a class="headerlink" href="#gdha_commented_at_2022-03-03_1624" title="Permanent link">&para;</a></h4>
<p><em>Note</em>: have a closer look at
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=755256">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=755256</a><br />
When we are using <code>REAR_INITRD_COMPRESSION=lzma</code><br />
we should include with grub2 configuration the line:<br />
<strong>insmod xzio</strong><br />
and perhaps also something like:<br />
<strong>set root='hd0,msdos1'</strong></p>
<h4 id="jsmeix_commented_at_2022-03-09_1402"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2500#issuecomment-1062951489">2022-03-09 14:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-09_1402" title="Permanent link">&para;</a></h4>
<p>I think that with
<a href="https://github.com/rear/rear/pull/2763">https://github.com/rear/rear/pull/2763</a>
merged<br />
this issue should be fixed - if not we can reopen it.</p>
<p>Likely not fully automated everywhere but the new<br />
GRUB2_SEARCH_ROOT_COMMAND config variable<br />
should at least provide "final power to the user"<br />
to specify what he needs in his particular case.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-10-13.2500.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
