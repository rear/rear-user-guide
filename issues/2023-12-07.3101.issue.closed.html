<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3101 Issue closed: ReaR 2.7 Ignores loop partition type Disks - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3101 Issue closed: ReaR 2.7 Ignores loop partition type Disks";
        var mkdocs_page_input_path = "issues/2023-12-07.3101.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3101 Issue closed: ReaR 2.7 Ignores loop partition type Disks</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3101_issue_closed_rear_27_ignores_loop_partition_type_disks"><a href="https://github.com/rear/rear/issues/3101">#3101 Issue</a> <code>closed</code>: ReaR 2.7 Ignores loop partition type Disks<a class="headerlink" href="#3101_issue_closed_rear_27_ignores_loop_partition_type_disks" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="ramzcode_opened_issue_at_2023-12-07_1358"><img src="https://avatars.githubusercontent.com/u/76745955?u=f5c61d1790c8abce888534760cd418243fbf82f5&v=4" width="50"><a href="https://github.com/ramzcode">ramzcode</a> opened issue at <a href="https://github.com/rear/rear/issues/3101">2023-12-07 13:58</a>:<a class="headerlink" href="#ramzcode_opened_issue_at_2023-12-07_1358" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.7</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    Amazon Linux 2 &amp; Mostly for other Distros too</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    AUTOEXCLUDE_DISKS=n added to include extra disks</p>
</li>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    VM KVM / AWS EC2</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    BIOS</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    SSD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME               KNAME            PKNAME       TRAN   TYPE FSTYPE LABEL SIZE MOUNTPOINT
/dev/nvme1n1       /dev/nvme1n1                  nvme   disk ext4           8G /disk-a
/dev/nvme2n1       /dev/nvme2n1                  nvme   disk               23G
`-/dev/nvme2n1p1   /dev/nvme2n1p1   /dev/nvme2n1 nvme   part ext4          23G /disk-b
/dev/nvme0n1       /dev/nvme0n1                  nvme   disk                8G
|-/dev/nvme0n1p1   /dev/nvme0n1p1   /dev/nvme0n1 nvme   part xfs    /       8G /
`-/dev/nvme0n1p128 /dev/nvme0n1p128 /dev/nvme0n1 nvme   part                1M
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>When a disk is formatted directly<br />
with out a partition table like, GPT, MBR or DOS,<br />
then the disk partition type is set to loop.<br />
ex: <code>mkfs.ext4 /dev/nvme1n1</code>.<br />
Due to the Type ReaR excludes the disk / partitions and FS.</p>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>Reformat the disk with Partition table like GPT<br />
or remove the loop type from the EXCLUDED List<br />
in the ReaR default conf file.</p>
<h4 id="ramzcode_commented_at_2023-12-07_1400"><img src="https://avatars.githubusercontent.com/u/76745955?u=f5c61d1790c8abce888534760cd418243fbf82f5&v=4" width="50"><a href="https://github.com/ramzcode">ramzcode</a> commented at <a href="https://github.com/rear/rear/issues/3101#issuecomment-1845394043">2023-12-07 14:00</a>:<a class="headerlink" href="#ramzcode_commented_at_2023-12-07_1400" title="Permanent link">&para;</a></h4>
<p><img width="331" alt="image (2)" src="https://github.com/rear/rear/assets/76745955/41b20a76-1063-493a-98ec-df66abe328da"></p>
<h4 id="jsmeix_commented_at_2023-12-11_1244"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3101#issuecomment-1850008540">2023-12-11 12:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-11_1244" title="Permanent link">&para;</a></h4>
<p>I can reproduce the "rear mkrescue" part with a USB disk /dev/sdb</p>
<pre><code># dd if=/dev/zero of=/dev/sdb count=64 bs=1M
64+0 records in
64+0 records out
67108864 bytes (67 MB, 64 MiB) copied, 1.94995 s, 34.4 MB/s

# lsblk -ipo KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT
KNAME     PKNAME    TRAN   TYPE  FSTYPE      LABEL   SIZE MOUNTPOINT
...
/dev/sdb            usb    disk                    465.8G

# parted -s /dev/sdb unit GiB print
Error: /dev/sdb: unrecognised disk label
Model: TOSHIBA External USB 3.0 (scsi)
Disk /dev/sdb: 466GiB
Sector size (logical/physical): 512B/512B
Partition Table: unknown
Disk Flags:

# mkfs.ext4 /dev/sdb
mke2fs 1.46.4 (18-Aug-2021)
Creating filesystem with 122096645 4k blocks and 30531584 inodes
Filesystem UUID: e1fe595f-0d9f-4d10-a152-45864d5ece07
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
        102400000
Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (262144 blocks): done
Writing superblocks and filesystem accounting information: done

# lsblk -ipo KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT
KNAME     PKNAME    TRAN   TYPE  FSTYPE      LABEL   SIZE MOUNTPOINT
...
/dev/sdb            usb    disk  ext4              465.8G

# parted -s /dev/sdb unit GiB print
Model: TOSHIBA External USB 3.0 (scsi)
Disk /dev/sdb: 466GiB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 
Number  Start    End     Size    File system  Flags
 1      0.00GiB  466GiB  466GiB  ext4

# mkdir /mountpoint_sdb

# mount -v /dev/sdb /mountpoint_sdb
mount: /dev/sdb mounted on /mountpoint_sdb.

# lsblk -ipo KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT
KNAME     PKNAME    TRAN   TYPE  FSTYPE      LABEL   SIZE MOUNTPOINT
...
/dev/sdb            usb    disk  ext4              465.8G /mountpoint_sdb

# usr/sbin/rear -D mkrescue
...


# less var/lib/rear/layout/disklayout.conf
...
# Disk /dev/sdb
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/sdb 500107859968 loop
# Partitions on /dev/sdb
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
...
fs /dev/sdb /mountpoint_sdb ext4 uuid=e1fe595f-0d9f-4d10-a152-45864d5ece07 label= blocksize=4096 reserved_blocks=4% max_mounts=-1 check_interval=0d bytes_per_inode=16380 default_mount_options=user_xattr,acl options=rw,relatime
</code></pre>
<p>Excerpts from my 'rear -D mkrescue' debug log file:</p>
<pre><code>+ source /root/rear.github.master/usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh
...
++ echo '# Disk /dev/sdb'
++ echo '# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;'
++ echo 'disk /dev/sdb 500107859968 loop'
++ echo '# Partitions on /dev/sdb'
++ echo '# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;'
++ extract_partitions /dev/sdb
++ declare device=/dev/sdb
+++ get_sysfs_name /dev/sdb
+++ local name=sdb
+++ name=sdb
+++ [[ -e /sys/block/sdb ]]
+++ echo sdb
+++ return 0
++ declare sysfs_name=sdb
++ sysfs_paths_unfiltered=(/sys/block/$sysfs_name/$sysfs_name*)
++ declare -a sysfs_paths_unfiltered
++ sysfs_paths=()
++ declare -a sysfs_paths
++ declare path sysfs_path
++ [[ 0 -eq 0 ]]
++ [[ /dev/sdb = *\/\m\a\p\p\e\r\/* ]]
++ :
++ declare partition_name partition_prefix start_block
++ declare partition_nr size start
++ sort -un /var/tmp/rear.tvClaM8FOHZNYWr/tmp/partitions_unsorted
++ [[ ! -s /var/tmp/rear.tvClaM8FOHZNYWr/tmp/partitions ]]
++ Debug 'No partitions found on /dev/sdb.'

...

+ source /root/rear.github.master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh
...
2023-12-11 13:05:51.970513644 Processing filesystem 'ext4' on '/dev/sdb' mounted at '/mountpoint_sdb
...
</code></pre>
<p>Right now I cannot reproduce the "rear recover" part.<br />
I need to set up a VM to do this.</p>
<p>I think all needed information is there in disklayout.conf<br />
so that ReaR could recreate a disk with a filesystem<br />
directly on the disk without a partiton table<br />
BUT<br />
currently I have no idea how difficult it may get in practice<br />
to implement support for recreating disks without partitons<br />
and filesystem directly on the disk.</p>
<h4 id="ramzcode_commented_at_2023-12-21_0851"><img src="https://avatars.githubusercontent.com/u/76745955?u=f5c61d1790c8abce888534760cd418243fbf82f5&v=4" width="50"><a href="https://github.com/ramzcode">ramzcode</a> commented at <a href="https://github.com/rear/rear/issues/3101#issuecomment-1865883094">2023-12-21 08:51</a>:<a class="headerlink" href="#ramzcode_commented_at_2023-12-21_0851" title="Permanent link">&para;</a></h4>
<p>@jsmeix Sorry for the confusion, actually i missed to mount the FS, and
due to this ReaR did not include it.</p>
<p>I gave a retry with mount point for a loop typed disk and with proper
fstab entry and it did work. Also from your disklayout, it states that
correctly. For sure recover should handle it without any problem and for
me things worked perfectly.</p>
<p>Only one things is, the logs were either not clear to me or i did miss
the point that a unmounted disk will be ignored by ReaR</p>
<p>Once again thank you.</p>
<h4 id="jsmeix_commented_at_2023-12-21_1055"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3101#issuecomment-1866051553">2023-12-21 10:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-21_1055" title="Permanent link">&para;</a></h4>
<p>@ramzcode<br />
thank you for your information what the root cause was<br />
in your particular case and that things worked well<br />
when that filesystem on the "raw" disk was mounted.<br />
It helps so much to have feedback how things behave<br />
for users "in real world out there" - and in particular<br />
positive feedback when things work (reasonably) well.</p>
<p>In general regarding<br />
what disk layout components to include or exclude<br />
see my<br />
<a href="https://github.com/rear/rear/issues/2229#issuecomment-531474858">https://github.com/rear/rear/issues/2229#issuecomment-531474858</a></p>
<p>Perhaps changing AUTOEXCLUDE_DISKS (by default set to 'y')<br />
could help. But I did not test it.</p>
<p>In general see the "How to exclude something" part in default.conf<br />
for ReaR 2.7 online starting at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L2974">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L2974</a><br />
which tells that disks that are not used by mounted filesystems<br />
are automatically excluded via 'AUTOEXCLUDE_DISKS=y'.</p>
<p>The main script where things are automatically excluded<br />
usr/share/rear/layout/save/default/320_autoexclude.sh<br />
In your case (unmounted filesystem) there is a</p>
<pre><code>DebugPrint "Automatically excluding disk $name (not used by any mounted filesystem)"
</code></pre>
<p>which you would see when you run ReaR in debug mode.</p>
<p>I recommend to run ReaR in debug '-d' mode<br />
(personally I basically always use debugscript '-D' mode)<br />
in particular during development of a disaster recovery procedure<br />
while trying out this or that with ReaR to make things work.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-12-07.3101.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
