<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1571 Issue closed: OUTPUT_URL=null conflicts with OUTPUT=USB but ReaR does not error out appropriately - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1571 Issue closed: OUTPUT_URL=null conflicts with OUTPUT=USB but ReaR does not error out appropriately";
        var mkdocs_page_input_path = "issues/2017-11-09.1571.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1571 Issue closed: OUTPUT_URL=null conflicts with OUTPUT=USB but ReaR does not error out appropriately</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1571_issue_closed_output_urlnull_conflicts_with_outputusb_but_rear_does_not_error_out_appropriately"><a href="https://github.com/rear/rear/issues/1571">#1571 Issue</a> <code>closed</code>: OUTPUT_URL=null conflicts with OUTPUT=USB but ReaR does not error out appropriately<a class="headerlink" href="#1571_issue_closed_output_urlnull_conflicts_with_outputusb_but_rear_does_not_error_out_appropriately" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="prophet60091_opened_issue_at_2017-11-09_0052"><img src="https://avatars.githubusercontent.com/u/10421956?u=dbb2055e5875881c064e86ed6d13f125468de9d1&v=4" width="50"><a href="https://github.com/prophet60091">prophet60091</a> opened issue at <a href="https://github.com/rear/rear/issues/1571">2017-11-09 00:52</a>:<a class="headerlink" href="#prophet60091_opened_issue_at_2017-11-09_0052" title="Permanent link">&para;</a></h4>
<p><strong>Version:</strong><br />
<code>2.2-git.0.0 /2017-10-30</code><br />
<strong>OS</strong><br />
<code>centOS  Linux release 7.2.1511</code></p>
<p><strong>site.conf:</strong></p>
<pre><code>OUTPUT=USB
OUTPUT_URL=null
BACKUP=NETFS
BACKUP_PROG=rsync
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
export "TMPDIR=/home/backup/tmp"
</code></pre>
<p><strong>UEFI boot</strong></p>
<p><strong>Brief description of the issue:</strong><br />
after running<br />
<code>rear format /dev/sdc -- --efi</code><br />
and then<br />
<code>rear mkbackup</code><br />
It errors out after after the initrd.cgz is created with</p>
<pre> 
BUG in /usr/share/rear/output/USB/Linux-i386/850_make_USB_bootable.sh line 40 
Filesystem for device ' dev/sdc2' could not be found 
</pre>

<p>I think this is the relevant portion of the log:</p>
<pre><code> 2017-11-08 17:06:10.542111909 Entering debugscripts mode via 'set -x'.
+ source /usr/share/rear/output/USB/Linux-i386/850_make_USB_bootable.sh
++ FEATURE_DD_OFLAG=
+++ get_version 'dd --version'
+++ TERM=dumb
+++ dd --version
+++ sed -rn 's/^[^0-9\.]*([0-9]+\.[-0-9a-z\.]+).*$/\1/p'
+++ head -1
++ dd_version=8.22
++ version_newer 8.22 5.3.0
++ v1list=(${1//[-.]/ })
++ local v1list
++ v2list=(${2//[-.]/ })
++ local v2list
++ local max=2
++ ((  2 &lt; 3  ))
++ max=3
++ local pos
+++ seq 0 2
++ for pos in '$(seq 0 $(( max -1 )))'
++ ((  10#08 &lt; 10#05  ))
++ ((  10#08 &gt; 10#05  ))
++ return 0
++ FEATURE_DD_OFLAG=y
++ '[' /dev/sdc -a /dev/sdc2 ']'
++ BugIfError 'RAW_USB_DEVICE and REAL_USB_DEVICE should be already set'
++ ((  0 != 0  ))
+++ get_usb_syslinux_version
+++ for file in '$BUILD_DIR/outputfs/{boot/syslinux,}/{ld,ext}linux.sys'
+++ [[ -s /home/backup/tmp/rear.4t1uO1nBlTaGUrP/outputfs/boot/syslinux/ldlinux.sys ]]
+++ for file in '$BUILD_DIR/outputfs/{boot/syslinux,}/{ld,ext}linux.sys'
+++ [[ -s /home/backup/tmp/rear.4t1uO1nBlTaGUrP/outputfs/boot/syslinux/extlinux.sys ]]
+++ for file in '$BUILD_DIR/outputfs/{boot/syslinux,}/{ld,ext}linux.sys'
+++ [[ -s /home/backup/tmp/rear.4t1uO1nBlTaGUrP/outputfs//ldlinux.sys ]]
+++ for file in '$BUILD_DIR/outputfs/{boot/syslinux,}/{ld,ext}linux.sys'
+++ [[ -s /home/backup/tmp/rear.4t1uO1nBlTaGUrP/outputfs//extlinux.sys ]]
+++ return 1
++ usb_syslinux_version=
+++ get_syslinux_version
+++ local syslinux_version
++++ get_version extlinux --version
++++ TERM=dumb
++++ extlinux --version
++++ sed -rn 's/^[^0-9\.]*([0-9]+\.[-0-9a-z\.]+).*$/\1/p'
++++ head -1
+++ syslinux_version=4.05
+++ [[ -z 4.05 ]]
+++ [[ -z 4.05 ]]
+++ [[ -z 4.05 ]]
+++
</code></pre>
<p>tried manually setting usb_filesystem in the site.conf, but didn't
work<br />
tried reformatting</p>
<h4 id="prophet60091_commented_at_2017-11-09_0116"><img src="https://avatars.githubusercontent.com/u/10421956?u=dbb2055e5875881c064e86ed6d13f125468de9d1&v=4" width="50"><a href="https://github.com/prophet60091">prophet60091</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343015863">2017-11-09 01:16</a>:<a class="headerlink" href="#prophet60091_commented_at_2017-11-09_0116" title="Permanent link">&para;</a></h4>
<p>I should add that yes /proc/mounts was not listed the device, however,
If unplug it and plug it back in, it automounts and I run rear mkbackup,
it errors with USB device /dev/sdc2 is already mounted on
'/run/media/root/rear-000</p>
<p>It seems to be a kind of catch22 proc mounts wont have the info unless
it's mounted, but I cannot mount it and start the backup.</p>
<h4 id="gozora_commented_at_2017-11-09_0805"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343076919">2017-11-09 08:05</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-09_0805" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>Please attach FULL logfile created by <code>rear -d -D mkrescue</code></p>
<p>thx</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-11-09_0817"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343079409">2017-11-09 08:17</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-09_0817" title="Permanent link">&para;</a></h4>
<p>thinking of it, try to disable automount of rear ubs disk or try to
umount the disk manually, prior <code>rear mkrescue</code></p>
<h4 id="jsmeix_commented_at_2017-11-09_1022"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343110811">2017-11-09 10:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-09_1022" title="Permanent link">&para;</a></h4>
<p>As far as I understand it there is not much what ReaR could do.</p>
<p>During "rear mkrescue/mkbackup" ReaR needs to mount<br />
the USB device at a ReaR-specific mount point but that<br />
could conflict with whatever existing USB automount magic<br />
that may have already mounted that USB device elsewhere.</p>
<p>I think ReaR should never ever try to mess around with<br />
the existing system setup (like changing how an existing<br />
USB automount magic behaves) because the setup<br />
of the original system is sacrosanct for ReaR<br />
(i.e. ReaR should never change the original system).<br />
Instead the user of ReaR has to setup his system<br />
so that his system setup does not conflict with ReaR.</p>
<h4 id="jsmeix_commented_at_2017-11-09_1046"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343117433">2017-11-09 10:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-09_1046" title="Permanent link">&para;</a></h4>
<p>@prophet60091<br />
as far as I see the script that mounts the USB device<br />
at the ReaR-specific mount point is<br />
usr/share/rear/output/default/100_mount_output_path.sh<br />
which calls</p>
<pre>
mount_url $OUTPUT_URL $BUILD_DIR/outputfs $OUTPUT_OPTIONS
</pre>

<p>and the mount_url function is defined in<br />
usr/share/rear/lib/global-functions.sh</p>
<p>For me on my SLES12 test system the mount_url function<br />
is called like (from my "rear -d -D mkbackup" log file):</p>
<pre>
+ source /root/rear.master/usr/share/rear/output/default/100_mount_output_path.sh
...
++ mount_url usb:///dev/disk/by-label/MyBackup /tmp/rear.Gql4esSs7sKmOdb/outputfs
</pre>

<p>according to what I have in my test system</p>
<pre>
# ls -l /dev/disk/by-label/MyBackup
lrwxrwxrwx ... /dev/disk/by-label/MyBackup -> ../../sdb1
</pre>

<p>If you like you could perhaps do a GitHub pull request<br />
that enhances ReaR so that when the USB device<br />
that is configured in ReaR is already mounted<br />
could be automatically unmounted to that then<br />
it works to mount it at the ReaR-specific mount point<br />
$BUILD_DIR/outputfs = /tmp/rear.XXX.../outputfs</p>
<h4 id="gozora_commented_at_2017-11-09_1135"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343128675">2017-11-09 11:35</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-09_1135" title="Permanent link">&para;</a></h4>
<blockquote>
<p>If you like you could perhaps do a GitHub pull request<br />
that enhances ReaR so that when the USB device<br />
that is configured in ReaR is already mounted<br />
could be automatically unmounted to that then<br />
it works to mount it at the ReaR-specific mount point<br />
$BUILD_DIR/outputfs = /tmp/rear.XXX.../outputfs</p>
</blockquote>
<p>I'd disagree here, as we don't know neither reason nor method how
particular USB disk was mounted, ReaR should not interfere here but
rather let user to disable automatic mounting of USB disk or solve such
situation by him self.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-11-09_1228"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343140065">2017-11-09 12:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-09_1228" title="Permanent link">&para;</a></h4>
<p>I think I should have better explained why I thought<br />
it could be o.k. to let ReaR automatically umount it:</p>
<p>My reasoning was that I assumed that when the user<br />
(who must be 'root') runs "rear mkrescue/mkbackup"<br />
then he knows what that results and he really wants it<br />
which means he wants that ReaR writes onto the USB device<br />
that he has configured in ReaR to be used by ReaR.</p>
<p>On the other hand:<br />
When the user accidentally misconfigured a wrong<br />
USB device in ReaR e.g. 'sdb1' instead of 'sdd1' like</p>
<pre>
USB_DEVICE=/dev/sdb1
</pre>

<p>or</p>
<pre>
BACKUP_URL=usb:///dev/sdb1
</pre>

<p>where /dev/sdb1 is one of his system filesystems,<br />
then it is probably not so much o.k. to let ReaR<br />
"just automatically umount it" ;-)</p>
<p>Bottom line:<br />
I agree with<br />
<a href="https://github.com/rear/rear/issues/1571#issuecomment-343128675">https://github.com/rear/rear/issues/1571#issuecomment-343128675</a><br />
that ReaR should not automatically umount it.</p>
<h4 id="jsmeix_commented_at_2017-11-09_1231"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343140615">2017-11-09 12:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-09_1231" title="Permanent link">&para;</a></h4>
<p>Accordingly I close the issue as "invalid" for ReaR<br />
because the user must solve such situations by himself<br />
because ReaR must never ever try to mess around<br />
with the existing system.</p>
<h4 id="jsmeix_commented_at_2017-11-09_1240"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343142767">2017-11-09 12:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-09_1240" title="Permanent link">&para;</a></h4>
<p>@prophet60091<br />
you could add a script that implements<br />
what you need for your particular case<br />
to the 'init' stage.<br />
I.e. add such a script to the<br />
usr/share/rear/init/default/<br />
directory.<br />
ReaR scripts must be named<br />
with an exactly three digits prefix like<br />
usr/share/rear/init/default/123_my_special_stuff.sh</p>
<h4 id="prophet60091_commented_at_2017-11-09_1604"><img src="https://avatars.githubusercontent.com/u/10421956?u=dbb2055e5875881c064e86ed6d13f125468de9d1&v=4" width="50"><a href="https://github.com/prophet60091">prophet60091</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343201910">2017-11-09 16:04</a>:<a class="headerlink" href="#prophet60091_commented_at_2017-11-09_1604" title="Permanent link">&para;</a></h4>
<p>Well, I've tried not auto mounting, and I've tried also just unmounting
before running the script. In this case it gives the error that I
originally described.<br />
Here the full log:</p>
<p><a href="url">https://github.com/prophet60091/rearlogs/blob/master/FSnotFound.log</a></p>
<p>If it's mounted as it would be after running the format for example then
get error:**<br />
<code>Message: USB device '/dev/sdb2' is already mounted on '/run/media/root/REAR-000'</code></p>
<p>full log
<a href="url">https://github.com/prophet60091/rearlogs/blob/master/mounted.log</a></p>
<p>The problem seems to be that it looking in /proc/mounts isn't going to
work when the device isn't mounted. But mounting it will cause
complaints of being already mounted.</p>
<p>I tried hardcoding the file system to usb_filesystem=ext4 (I've used 3
as well no difference there)</p>
<p>I already noticed in the log that there is another complaint that states
RAW_USB_DEVICE and REAL_USB_DEVICE, should already be set.</p>
<p>I think I can track it down, but what should the values of those two
variables be ideally set to? The script mentioned in this issue, says
it's assuming they are set, but I don't know where.</p>
<h4 id="gozora_commented_at_2017-11-09_1620"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343207496">2017-11-09 16:20</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-09_1620" title="Permanent link">&para;</a></h4>
<p>@prophet60091 just for fun of it, can you remove <code>OUTPUT_URL=null</code> from
your config file ?</p>
<p>V.</p>
<h4 id="prophet60091_commented_at_2017-11-09_1629"><img src="https://avatars.githubusercontent.com/u/10421956?u=dbb2055e5875881c064e86ed6d13f125468de9d1&v=4" width="50"><a href="https://github.com/prophet60091">prophet60091</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343210604">2017-11-09 16:29</a>:<a class="headerlink" href="#prophet60091_commented_at_2017-11-09_1629" title="Permanent link">&para;</a></h4>
<p>wow. that solved it.</p>
<p>I had left it part of the config from doing ISOs earlier in the day and
didn't think it would be a culprit. Good call, and thank you!</p>
<h4 id="gozora_commented_at_2017-11-09_1634"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343212185">2017-11-09 16:34</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-09_1634" title="Permanent link">&para;</a></h4>
<p>Anytime! ðŸ˜ƒ</p>
<h4 id="jsmeix_commented_at_2017-11-10_0844"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343412481">2017-11-10 08:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_0844" title="Permanent link">&para;</a></h4>
<p>Wow!<br />
Now we have a real minor bug/enhancement here because<br />
ReaR should error out for known not working settings,<br />
cf. "Try to care about possible errors" at<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="jsmeix_commented_at_2017-11-10_0846"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343412850">2017-11-10 08:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_0846" title="Permanent link">&para;</a></h4>
<p>I will do a pull request...</p>
<h4 id="jsmeix_commented_at_2017-11-10_1114"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343446647">2017-11-10 11:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1114" title="Permanent link">&para;</a></h4>
<p>I can reproduce it with "rear mkrescue" with</p>
<pre>
OUTPUT=USB
OUTPUT_URL=null
BACKUP=NETFS
BACKUP_URL=usb:///dev/sdb1
</pre>

<pre>
# usr/sbin/rear -d -D mkrescue
...
Saved /root/rear.master/var/log/rear/rear-e205.log as rear/e205/20171110.1210/rear-e205.log
ERROR: 
====================
BUG in /root/rear.master/usr/share/rear/output/USB/Linux-i386/850_make_USB_bootable.sh line 40:
'Filesystem for device '/dev/sdb1' could not be found'
</pre>

<h4 id="jsmeix_commented_at_2017-11-10_1228"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343461088">2017-11-10 12:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1228" title="Permanent link">&para;</a></h4>
<p>Seems to be much more complicated than expected.<br />
That USB stuff was added a longer time ago<br />
as a dirty hack for a very specific use case and<br />
that results and endless sequence of weird issues<br />
like this one.</p>
<p>By chance I found while debugging this script:<br />
build/USB/default/800_enforce_usb_output.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/build/USB/default/800_enforce_usb_output.sh">https://github.com/rear/rear/blob/master/usr/share/rear/build/USB/default/800_enforce_usb_output.sh</a></p>
<p>Its code does not make any sense for me.<br />
WHY could OUTPUT=... be different in<br />
$ROOTFS_DIR/etc/rear/local.conf<br />
compared to what the user had set<br />
in /etc/rear/local.conf on the original system<br />
that justifies to enforce OUTPUT=USB in<br />
$ROOTFS_DIR/etc/rear/local.conf<br />
and WHY does OUTPUT=... matter at all<br />
in the ReaR recovery system?<br />
I would expect that OUTPUT is only used for<br />
"rear mkrescue/mkbackup" but not for "rear recover".</p>
<p>@gdha<br />
do you perhaps have any idea what the reason is/was<br />
for this script?</p>
<p>It this script stays inexplicable for us I would suggest<br />
to "just blindly remove it right now" and then wait<br />
and see if any user reports any regression.</p>
<p>Or we may only disable it with an added initial</p>
<pre>
# No idea what the reason behind is for the code below
# so that it is - at least for now - just disabled:
return 0
</pre>

<h4 id="jsmeix_commented_at_2017-11-10_1302"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343467593">2017-11-10 13:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1302" title="Permanent link">&para;</a></h4>
<p>O.k. seems I found how it fails:<br />
In my log I get (excerpts):</p>
<pre>
+ source /root/rear.master/usr/share/rear/output/default/100_mount_output_path.sh
++ mount_url null /tmp/rear.8n2C189DVGc6flF/outputfs
++ local url=null
++ case $(url_scheme $url) in
+++ url_scheme null
++ return 0
...
+ source /root/rear.master/usr/share/rear/output/USB/Linux-i386/850_make_USB_bootable.sh
+++ grep -E '^/dev/sdb1 |^/dev/sdb1 ' /proc/mounts
++ usb_filesystem=
++ case "$usb_filesystem" in
++ BugError 'Filesystem for device '\''/dev/sdb1'\'' could not be found'
</pre>

<p>i.e. 850_make_USB_bootable.sh expects that the USB device<br />
was already mounted by 100_mount_output_path.sh<br />
but because of OUTPUT_URL=null the 'mount_url null ...'<br />
function call did nothing (and 'return 0') so that<br />
the 'grep ... /proc/mounts' in 850_make_USB_bootable.sh<br />
cannot find a mounted USB device which results the BugError.</p>
<p>Accordingly I think now that the actual conflict is<br />
"OUTPUT=USB" together with "OUTPUT_URL=null"<br />
and ReaR should detect this and error out.</p>
<h4 id="jsmeix_commented_at_2017-11-10_1319"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343471240">2017-11-10 13:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1319" title="Permanent link">&para;</a></h4>
<p>With the change in<br />
<a href="https://github.com/rear/rear/pull/1572">https://github.com/rear/rear/pull/1572</a><br />
it errors out instantly in this case:</p>
<pre>
# usr/sbin/rear -d -D mkrescue
Relax-and-Recover 2.2 / Git
Using log file: /root/rear.master/var/log/rear/rear-e205.log
ERROR: 'OUTPUT_URL=null' conflicts with 'OUTPUT=USB'
Aborting due to an error, check /root/rear.master/var/log/rear/rear-e205.log for details
Terminated
</pre>

<h4 id="jsmeix_commented_at_2017-11-10_1322"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343471924">2017-11-10 13:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1322" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1572">https://github.com/rear/rear/pull/1572</a>
merged<br />
I consider this issue to be sufficiently avoided/fixed.</p>
<h4 id="jsmeix_commented_at_2017-11-10_1328"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343473157">2017-11-10 13:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1328" title="Permanent link">&para;</a></h4>
<p>FWIW:<br />
With</p>
<pre>
OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/sdb1
</pre>

<p>"rear mkrescue" and "rear mkbackup"<br />
and then also "rear recover"<br />
still "just work" for me.</p>
<h4 id="gdha_commented_at_2017-11-10_1452"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343493650">2017-11-10 14:52</a>:<a class="headerlink" href="#gdha_commented_at_2017-11-10_1452" title="Permanent link">&para;</a></h4>
<p>If <code>OUTPUT=USB</code> the <code>OUTPUT_URL</code> with USB may <strong>not</strong> be <em>null</em> IMHO as
otherwise it is a complete useless definition as we must be able to boot
from the USB drive, right. That is the purpose of OUTPUT_URL. However,
in recover mode the OUTPUT_URL is not required as the BACKUP_URL is
important there.<br />
I agree USB part was a quick and dirty hack by Jeroen and Dag, but we
may not complain as it is used a lot and seems to be functional most of
times.</p>
<h4 id="jsmeix_commented_at_2017-11-10_1509"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343498132">2017-11-10 15:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-10_1509" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
many thanks for the info.<br />
Accordingly
<a href="https://github.com/rear/rear/pull/1572">https://github.com/rear/rear/pull/1572</a><br />
is the right fix.</p>
<p>@gdha<br />
do you perhaps also have an idea what the reason behind<br />
the 800_enforce_usb_output.sh script could be, cf. my<br />
<a href="https://github.com/rear/rear/issues/1571#issuecomment-343461088">https://github.com/rear/rear/issues/1571#issuecomment-343461088</a></p>
<p>Only a side note for the fun of it:<br />
I am allowed to complain (at least a bit from time to time)<br />
because I fixed so much with it ;-)</p>
<p>Have a nice weekend!</p>
<h4 id="gdha_commented_at_2017-11-10_1614"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1571#issuecomment-343516020">2017-11-10 16:14</a>:<a class="headerlink" href="#gdha_commented_at_2017-11-10_1614" title="Permanent link">&para;</a></h4>
<p>@jsmeix concerning:</p>
<pre><code>build/USB/default/800_enforce_usb_output.sh
https://github.com/rear/rear/blob/master/usr/share/rear/build/USB/default/800_enforce_usb_output.sh

Its code does not make any sense for me.
WHY could OUTPUT=... be different in
$ROOTFS_DIR/etc/rear/local.conf
</code></pre>
<p>I seem to remember (and that is already an achievement!) that that was a
hack when Dag plugged in the USB drive into a Proliant server it
automagically started doing things with ReaR. However, I might be
completely wrong here - if @dagwieers could bring some light that would
be even better.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-11-09.1571.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
