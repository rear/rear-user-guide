<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1475 PR merged: BACKUP_PROG_OPTIONS used to be a string variable, turn it into an array - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1475 PR merged: BACKUP_PROG_OPTIONS used to be a string variable, turn it into an array";
        var mkdocs_page_input_path = "issues/2017-09-06.1475.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1475 PR merged: BACKUP_PROG_OPTIONS used to be a string variable, turn it into an array</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1475_pr_merged_backup_prog_options_used_to_be_a_string_variable_turn_it_into_an_array"><a href="https://github.com/rear/rear/pull/1475">#1475 PR</a> <code>merged</code>: BACKUP_PROG_OPTIONS used to be a string variable, turn it into an array<a class="headerlink" href="#1475_pr_merged_backup_prog_options_used_to_be_a_string_variable_turn_it_into_an_array" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="gdha_opened_issue_at_2017-09-06_1641"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/pull/1475">2017-09-06 16:41</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-09-06_1641" title="Permanent link">&para;</a></h4>
<p>BACKUP_PROG_OPTIONS used to be a string variable, turn it into an
array (GD, 06/SEP/2017 - issue #1175)</p>
<p>added new script prep/NETFS/GNU/Linux/205_inspect_tar_capabilities.sh
which will automatically add capabilities to the BACKUP_PROG_OPTIONS
array</p>
<h4 id="jsmeix_commented_at_2017-09-07_1058"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327766317">2017-09-07 10:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1058" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I wonder if that is really a "breaking change"<br />
(i.e. a backward incompatible change) because<br />
according to my current (limited) experience<br />
in general bash behaves well backward compatible<br />
for strings and arrays.<br />
For example:<br />
a string variable 'var' can also be evaluated<br />
by using array syntax "${var[@]}" e.g.</p>
<pre>
# BACKUP_PROG_OPTIONS="--this --that"

# echo "${BACKUP_PROG_OPTIONS[@]}"
--this --that
</pre>

<p>and also for adding more array elements</p>
<pre>
# BACKUP_PROG_OPTIONS="--this --that"

# BACKUP_PROG_OPTIONS=( "${BACKUP_PROG_OPTIONS[@]}" "--xattrs" )

# echo "${BACKUP_PROG_OPTIONS[@]}"
--this --that --xattrs
</pre>

<p>so that for users who specify BACKUP_PROG_OPTIONS<br />
as a string of words in their local.conf things should still<br />
work o.k. (unless I overlooked something special here).</p>
<h4 id="jsmeix_commented_at_2017-09-07_1102"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327767135">2017-09-07 11:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1102" title="Permanent link">&para;</a></h4>
<p>It looks as if this pull request already implements<br />
<a href="https://github.com/rear/rear/issues/1411">https://github.com/rear/rear/issues/1411</a><br />
or do I misunderstand something here?</p>
<h4 id="gdha_commented_at_2017-09-07_1118"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327770466">2017-09-07 11:18</a>:<a class="headerlink" href="#gdha_commented_at_2017-09-07_1118" title="Permanent link">&para;</a></h4>
<p>@jsmeix Good catch of #1411 (forgot about that request) - thanks.</p>
<h4 id="schlomo_commented_at_2017-09-07_1122"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327771332">2017-09-07 11:22</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1122" title="Permanent link">&para;</a></h4>
<p>@jsmeix please use <code>declare -p</code> to "view" variables and arrays. Consider
this example:</p>
<pre><code>$ v="hello world" ; declare -p v ; v=( "${v[@]}" yes we can) ; declare -p v
declare -- v="hello world"
declare -a v=([0]="hello world" [1]="yes" [2]="we" [3]="can")
</code></pre>
<p>We can see how the initial value that consists of two words is now a
single value with two words. The root cause is that we now quote the
array variable whereas the previous implementation on purpose did not
quote it. This is actually the core of the breaking change:<br />
<img alt="image" src="https://user-images.githubusercontent.com/101384/30161117-941a42ae-93cf-11e7-9946-20f2e7a52bf6.png" /></p>
<h4 id="jsmeix_commented_at_2017-09-07_1158"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327778253">2017-09-07 11:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1158" title="Permanent link">&para;</a></h4>
<p>Good grief!<br />
@schlomo you are right:</p>
<pre>
# set -x

# opts="-i -s"
+ opts='-i -s'

# echo 'Hello World' | grep $opts 'hello' | cat -n
+ grep -i -s hello
+ echo 'Hello World'
+ cat -n
     1  Hello World

# opts=( "${opts[@]}" "-o" )
+ opts=("${opts[@]}" "-o")

# echo 'Hello World' | grep "${opts[@]}" 'hello' | cat -n
+ grep '-i -s' -o hello
+ echo 'Hello World'
+ cat -n
grep: invalid option -- ' '
Usage: grep [OPTION]... PATTERN [FILE]...
Try `grep --help' for more information.

# echo 'Hello World' | grep ${opts[*]} 'hello' | cat -n
+ grep -i -s -o hello
+ echo 'Hello World'
+ cat -n
     1  Hello
</pre>

<h4 id="schlomo_commented_at_2017-09-07_1206"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327779735">2017-09-07 12:06</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1206" title="Permanent link">&para;</a></h4>
<p>Let's just try to keep unquoted arrays like <code>${opts[*]}</code> to the absolute
minimum :-)</p>
<h4 id="jsmeix_commented_at_2017-09-07_1211"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327780785">2017-09-07 12:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1211" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
can you check if using explicitly unquoted</p>
<pre>
${BACKUP_PROG_OPTIONS[*]}
</pre>

<p>in the backup restore command pipe</p>
<pre>
dd if=$restore_input | $BACKUP_PROG_DECRYPT_OPTIONS $BACKUP_PROG_CRYPT_KEY | $BACKUP_PROG --block-number --totals --verbose ${BACKUP_PROG_OPTIONS[*]} "${BACKUP_PROG_COMPRESS_OPTIONS[@]}" -C $TARGET_FS_ROOT/ -x -f -
</pre>

<p>could make it behave still backward compatible<br />
or - if that is not possible -<br />
could you check if we could somehow import a user-defined<br />
BACKUP_PROG_OPTIONS string of words like</p>
<pre>
BACKUP_PROG_OPTIONS="--this --that"
</pre>

<p>with each word as a separated array element<br />
into the new BACKUP_PROG_OPTIONS() array?</p>
<h4 id="schlomo_commented_at_2017-09-07_1221"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327782839">2017-09-07 12:21</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1221" title="Permanent link">&para;</a></h4>
<p>I am against unquoted arrays for the sake of backwards compatibility. In
general I want ReaR to look forward more than backward. That means that
we should guide users in their upgrade process without compromising on
the new functionality.</p>
<p>Specifically, I can imagine adding a test that occurs after reading the
user configuration. This test would check for blanks in
<code>$BACKUP_PROG_OPTIONS</code> (just the first value, therefore no array) and
abort ReaR with a error message that the user has to update their
configuration to use the array notation instead. The error message can
even suggest how:</p>
<pre><code>Error "The BACKUP_PROG_OPTIONS variable is now a Bash array and not a string. Please update your configuration to look like this:${IFS}BACKUP_PROG_OPTIONS+=( $BACKUP_PROG_OPTIONS )"
</code></pre>
<p>Example:</p>
<pre><code>2017-09-07 14:19:53.284830783 ERROR: The BACKUP_PROG_OPTIONS variable is now a Bash array and not a string. Please update your configuration to look like this:     
BACKUP_PROG_OPTIONS+=( --anchored )
</code></pre>
<p>This will actually put the old - bad - options there and how how to
write it üòÑ</p>
<h4 id="jsmeix_commented_at_2017-09-07_1222"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327783190">2017-09-07 12:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1222" title="Permanent link">&para;</a></h4>
<p>Only a quick unpolished proposal how we might import<br />
user-defined BACKUP_PROG_OPTIONS string of words<br />
as separated array elements into BACKUP_PROG_OPTIONS()</p>
<pre>
# BACKUP_PROG_OPTIONS="--this --that"

# old_backup_prog_options="$BACKUP_PROG_OPTIONS"

# unset BACKUP_PROG_OPTIONS

# for backup_prog_option in $old_backup_prog_options ; do BACKUP_PROG_OPTIONS=( "${BACKUP_PROG_OPTIONS[@]}" "$backup_prog_option" ) ; done

# for backup_prog_option in "${BACKUP_PROG_OPTIONS[@]}" ; do echo $backup_prog_option ; done
--this
--that
</pre>

<p>With some additional testing via "declare -p" whether or not<br />
the initial BACKUP_PROG_OPTIONS is a string or<br />
already an array we could keep backward compatibility.</p>
<h4 id="jsmeix_commented_at_2017-09-07_1224"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327783644">2017-09-07 12:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1224" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
a test with a meaningful Error exit message is perfectly fine for me.<br />
I only do not want to rely only on release notes<br />
because nobody reads documentation until it is too late ;-)</p>
<h4 id="schlomo_commented_at_2017-09-07_1229"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327784670">2017-09-07 12:29</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1229" title="Permanent link">&para;</a></h4>
<p>I also initially thought about an automatic migration but favor the
Error message to make the whole topic more explicit and to get our users
to actually update their configuration.</p>
<h4 id="jsmeix_commented_at_2017-09-07_1237"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327786386">2017-09-07 12:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1237" title="Permanent link">&para;</a></h4>
<p>In general I would prefer a test using 'declare -p'<br />
over a test of spaces in plain $VAR because it could be</p>
<pre>
VAR=( "first value" "second value" )
</pre>

<p>i.e. already an array where the first element intentionally<br />
and rightfully contains a blank.<br />
I mean "in general" for BACKUP_PROG_OPTIONS the<br />
values might never contain blanks - hmmm wait:</p>
<pre>
BACKUP_PROG_OPTIONS=( '--suffix="my suffix"' )
</pre>

<p>or some other unexpected special things like that ;-)</p>
<h4 id="schlomo_commented_at_2017-09-07_1317"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327796162">2017-09-07 13:17</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1317" title="Permanent link">&para;</a></h4>
<p>Actually <code>BACKUP_PROG_OPTIONS=( '--suffix="my suffix"' )</code> won't work as
intended because the <code>"</code> would be part of the string. If at all then
<code>BACKUP_PROG_OPTIONS=( '--suffix=my suffix' )</code>. However, in this
specific case IMHO we can keep it simple and really just check for
<code>$IFS</code> in the first value because the previous implementation for
<strong>tar</strong> specifically did not really make it simple for users to put
there complex multi word options (quoted quoting hell).</p>
<p>For the sake of simplicity I would therefore keep the test simple and
trust that the actual backup will die complaining about strange options.
So in any case, our test for the old form is just a courtesy to the
user.</p>
<h4 id="schlomo_commented_at_2017-09-07_1318"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327796220">2017-09-07 13:17</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1318" title="Permanent link">&para;</a></h4>
<p>@gdha maybe you just merge and continue?</p>
<h4 id="gdha_commented_at_2017-09-07_1449"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327823112">2017-09-07 14:49</a>:<a class="headerlink" href="#gdha_commented_at_2017-09-07_1449" title="Permanent link">&para;</a></h4>
<p>@schlomo I like the <strong>Error</strong> bail-out : +1</p>
<pre><code>$ BACKUP_PROG_OPTIONS="--anchored --selinux"
$ echo "${BACKUP_PROG_OPTIONS}"
--anchored --selinux
$ echo "${BACKUP_PROG_OPTIONS}" | grep " "
--anchored --selinux
$ echo "${#BACKUP_PROG_OPTIONS[@]}"
1
</code></pre>
<p>If I understand it well we check if the variable (string) contains a
<strong>blank</strong> and if the amount of values in the array is <em>1</em> we have a
mismatch, right?</p>
<h4 id="schlomo_commented_at_2017-09-07_1454"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-327824746">2017-09-07 14:54</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-07_1454" title="Permanent link">&para;</a></h4>
<p>Yes, good point. If there are two array values and the first one has a
blank then it might be intentional.</p>
<pre><code>[[ ${#BACKUP_PROG_OPTIONS[@]} -eq 1 &amp;&amp; "$BACKUP_PROG_OPTIONS" == *\ * ]] &amp;&amp; Error "..."
</code></pre>
<p>should work just fine. No external program calls and positive logic üòÑ</p>
<h4 id="gdha_commented_at_2017-09-08_0708"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328019265">2017-09-08 07:08</a>:<a class="headerlink" href="#gdha_commented_at_2017-09-08_0708" title="Permanent link">&para;</a></h4>
<p>@schlomo @jsmeix Could you verify and give your blessing?</p>
<h4 id="jsmeix_commented_at_2017-09-11_0944"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328477866">2017-09-11 09:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_0944" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
now there is in prep/NETFS/GNU/Linux/205_inspect_tar_capabilities.sh</p>
<pre>
echo "BACKUP_PROG_OPTIONS=( ${BACKUP_PROG_OPTIONS[@]} )" >> $ROOTFS_DIR/etc/rear/rescue.conf
</pre>

<p>which fails if a BACKUP_PROG_OPTIONS array element<br />
contains a string of words.<br />
E.g. on commandline:</p>
<pre>
# arr=( 'first' 'second=foo.bar' 'the end' )

# for e in "${arr[@]}" ; do echo "'$e'" ; done
'first'
'second=foo.bar'
'the end'

# echo "arr=( ${arr[@]} )"
arr=( first second=foo.bar the end )

# arr=( first second=foo.bar the end )

# for e in "${arr[@]}" ; do echo "'$e'" ; done
'first'
'second=foo.bar'
'the'
'end'
</pre>

<p>What seems to work for me is:</p>
<pre>
# arr=( 'first' 'second=foo.bar' 'the end' )

# echo "arr=( $( for e in "${arr[@]}" ; do echo -n "'$e' " ; done ) )"
arr=( 'first' 'second=foo.bar' 'the end'  )
</pre>

<p>It looks rather complicated but currently I don't know<br />
a better way.</p>
<h4 id="schlomo_commented_at_2017-09-11_0956"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328481161">2017-09-11 09:56</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-11_0956" title="Permanent link">&para;</a></h4>
<p><code>declare -p</code> is the official way to solve this problem, I indeed did not
catch this one. Sorry.</p>
<h4 id="jsmeix_commented_at_2017-09-11_1018"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328486901">2017-09-11 10:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1018" title="Permanent link">&para;</a></h4>
<p>Somewhere in the ReaR code I noticed a comment<br />
that in particular the "declare -p" output for arrays<br />
cannot be used to re-create arrays<br />
but I cannot find it right now.</p>
<p>At least on my SLES11 machine it seems to work<br />
to use the "declare -p" output to re-create arrays:</p>
<pre>
# unset arr

# arr=( 'first' '--second=foo.bar' 'the end'  )

# for e in "${arr[@]}" ; do echo "'$e'" ; done
'first'
'--second=foo.bar'
'the end'

# declare -p arr
declare -a arr='([0]="first" [1]="--second=foo.bar" [2]="the end")'

# declare -a arr='([0]="first" [1]="--second=foo.bar" [2]="the end")'

# for e in "${arr[@]}" ; do echo "'$e'" ; done
'first'
'--second=foo.bar'
'the end'
</pre>

<h4 id="jsmeix_commented_at_2017-09-11_1026"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328488802">2017-09-11 10:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1026" title="Permanent link">&para;</a></h4>
<p>I found the comment about 'declare' in an older ReaR version<br />
(but it is not about arrays - I confused that)<br />
therein in rescue/NETFS/default/60_store_NETFS_variables.sh</p>
<pre>
# store all NETFS* variables
# I don't know why it does not work with the full declare -- var=value syntax
# found out by experiment that I need to remove the declare -- stuff.
declare -p ${!NETFS*} | sed -e 's/declare .. //' >>$ROOTFS_DIR/etc/rear/rescue.conf
</pre>

<p>and according to<br />
<a href="https://github.com/rear/rear/commit/52b6c063ed4eb8874b2f8e9720565eefe71ab496">https://github.com/rear/rear/commit/52b6c063ed4eb8874b2f8e9720565eefe71ab496</a><br />
that comment is from you @schlomo - could you<br />
perhaps still explain what the reasoning behind was?</p>
<h4 id="schlomo_commented_at_2017-09-11_1030"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328489537">2017-09-11 10:30</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-11_1030" title="Permanent link">&para;</a></h4>
<p>It might be related to Bash 2.x, not sure any more. If I wrote it then
for sure I observed that behavior somewhere.</p>
<p>Maybe we should add some test code to our <code>Makefile</code>. If not to test
ReaR scripts we could at least test for features that we use.</p>
<h4 id="jsmeix_commented_at_2017-09-11_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328489997">2017-09-11 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1032" title="Permanent link">&para;</a></h4>
<p>For me on SLES11 'declare -p' also seems to<br />
"just work" to recreate string variables:</p>
<pre>
# unset var

# var=" this and that "

# echo "'$var'"
' this and that '

# declare -p var
declare -- var=" this and that "

# declare -- var=" this and that "

# echo "'$var'"
' this and that '
</pre>

<h4 id="gdha_commented_at_2017-09-11_1144"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328504563">2017-09-11 11:44</a>:<a class="headerlink" href="#gdha_commented_at_2017-09-11_1144" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schlomo there is not need to over-engineer this array
declaration in rescue.conf as I could not find any option declaration
with a <strong>space</strong> within tar.</p>
<h4 id="jsmeix_commented_at_2017-09-11_1205"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328508726">2017-09-11 12:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-11_1205" title="Permanent link">&para;</a></h4>
<p>@gdha see<br />
<a href="https://github.com/rear/rear/pull/1475#issuecomment-327786386">https://github.com/rear/rear/pull/1475#issuecomment-327786386</a></p>
<pre>
BACKUP_PROG_OPTIONS=( '--suffix="my suffix"' )
</pre
or some other unexpected special things like that ;-)
With "unexpected special things" I mean that users can
specify anything as their BACKUP_PROG_OPTIONS
and then ReaR should not fail.

#### <img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50">
<p><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328521156">2017-09-11 12:58</a>:</p>
<p>@jsmeix I was referring to <code>tar --usage</code> option and not to hypothetical cases.</p>
<h4 id="schlomo_commented_at_2017-09-11_1300"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328521619">2017-09-11 13:00</a>:<a class="headerlink" href="#schlomo_commented_at_2017-09-11_1300" title="Permanent link">&para;</a></h4>
<p>üëç for keeping it simple and sticking to problems that we know from reality.</p>
<p>That said, if we can use a Bash feature vs. self-coding then I would expect that to reduce the risk for bugs.</p>
<h4 id="jsmeix_commented_at_2017-09-12_0754"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1475#issuecomment-328771983">2017-09-12 07:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-12_0754" title="Permanent link">&para;</a></h4>
<p>I am referring to a real tar option and not to hypothetical cases.
You could have done "man tar" or "tar --usage | grep STRING"
to verify what I am talking about - didn't you?
Here for your convenience a real example
(on my SLES11 system):</p>
<pre>
# mkdir foo

# echo Hello >foo/hello

# tar -cvf foo.tar foo
foo/
foo/hello

# tar -xv --suffix="my suffix" -f foo.tar
foo/
foo/hello
Renaming `foo/hello' to `foo/hellomy suffix'

# find foo
foo
foo/hello
foo/hellomy suffix
</pre>

<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-09-06.1475.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
