<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#568 Issue closed: Backup log contains the BACKUP_PROG_CRYPT_KEY - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#568 Issue closed: Backup log contains the BACKUP_PROG_CRYPT_KEY";
        var mkdocs_page_input_path = "issues/2015-03-26.568.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#568 Issue closed: Backup log contains the BACKUP_PROG_CRYPT_KEY</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="568_issue_closed_backup_log_contains_the_backup_prog_crypt_key"><a href="https://github.com/rear/rear/issues/568">#568 Issue</a> <code>closed</code>: Backup log contains the BACKUP_PROG_CRYPT_KEY<a class="headerlink" href="#568_issue_closed_backup_log_contains_the_backup_prog_crypt_key" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code></p>
<h4 id="davixd_opened_issue_at_2015-03-26_1514"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> opened issue at <a href="https://github.com/rear/rear/issues/568">2015-03-26 15:14</a>:<a class="headerlink" href="#davixd_opened_issue_at_2015-03-26_1514" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
the backup log contains the BACKUP_PROG_CRYPT_KEY, is it possible to
blank it?</p>
<p>My /etc/rear/local.conf:<br />
OUTPUT=ISO<br />
BACKUP=NETFS<br />
BACKUP_URL="nfs://10.0.xx.xx/backup/"<br />
BACKUP_PROG_ARCHIVE="backup_$(hostname)_$(date
-Iseconds)_crypt_des3"<br />
GRUB_RESCUE=1<br />
GRUB_RESCUE_PASSWORD="SECRET"<br />
BACKUP_PROG_CRYPT_ENABLED=1<br />
BACKUP_PROG_CRYPT_KEY=”testpw123”</p>
<p>On the target server:<br />
[root@fs-01 rear-backup]# cat
backup_rear-backup.xxx.int_2015-03-26T14:50:16+0100_crypt_des3.log<br />
2015-03-26 14:50:37 tar --warning=no-xdev --sparse --block-number
--totals --verbose --no-wildcards-match-slash --one-file-system
--ignore-failed-read --anchored --gzip -X
/tmp/rear.b7bE08LIU8DwWBV/tmp/backup-exclude.txt -C / -c -f - / /var
/boot /var/log/rear/rear-rear-backup.log | /usr/bin/openssl des3 -salt
-k ”testpw123” | dd
of=/tmp/rear.b7bE08LIU8DwWBV/outputfs/rear-backup/backup_rear-backup.xxx.int_2015-03-26T14:50:16+0100_crypt_des3.tar.gz<br />
tar: Removing leading `/' from member names<br />
...</p>
<p>Because nfs use no encryption, it is not a good idea to send the
password of the crypt backup true the same line. Is it possible to
disable it? Or antoher best practice to do it?</p>
<p>My goal is:<br />
The backup file needs to be encrypted on target and the line secure
(rsync or nfs but without sending the password of the backup file).</p>
<p>Many thanks in advance!</p>
<p>Best regards<br />
davixd</p>
<h4 id="schlomo_commented_at_2015-03-26_1526"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-86568346">2015-03-26 15:26</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-26_1526" title="Permanent link">&para;</a></h4>
<p>IMHO full automation and security are always in confict and require some
trade off.</p>
<p>The log is not the main problem. The rescue system also contains this
password and most likely it lies next to your encrypted archive. In any
case, if you want to have an automated restore then the rescue system
needs the password.</p>
<p>I can think about some ideas:</p>
<ul>
<li>Use asymmetric cryptography: The key to encrypt stays on the server,
    the rescue image contains another key that can be used to decrypt
    the backup.</li>
<li>Control ReaR from outside (e.g. an external agent) that provides the
    encryption/decryption keys on-the-fly without storing it on disk.
    Maybe the discussion in #522 helps there. Basically you can add
    ReaR config on the command line without storing it in a file.</li>
</ul>
<h4 id="davixd_commented_at_2015-03-26_1545"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-86582627">2015-03-26 15:45</a>:<a class="headerlink" href="#davixd_commented_at_2015-03-26_1545" title="Permanent link">&para;</a></h4>
<p>Thanks for the advice/tip! But for me there is no need for such a
complex scenario, because I dont need a full automated restore system.</p>
<p>What I have in mind:<br />
encrypt the backup file while or after (on the the source system).
Sending the backup file to the target without any password in log or
rescue medium. While restoring, the rescue medium have to ask for the
password (and password have to be typed in, stdin) to be restored.</p>
<p>Is something like this possible with rear?</p>
<h4 id="schlomo_commented_at_2015-03-26_1554"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-86587284">2015-03-26 15:54</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-26_1554" title="Permanent link">&para;</a></h4>
<p>I think that it can be done, but probably you would need to change
something in ReaR or maybe change the way how the password is
integrated. Maybe
<a href="https://www.openssl.org/docs/apps/openssl.html#PASS-PHRASE-ARGUMENTS">https://www.openssl.org/docs/apps/openssl.html#PASS-PHRASE-ARGUMENTS</a>
can servce as a method to allow different usage scenarios with the same
code. If you have the password stored in a file that is excluded from
backup then you are almost there. Maybe one needs to separate between
the backup password and the restore password, the default beeing the
same.</p>
<p>In any case, ReaR needs to be extended for this feature. Do you want to
provide us a patch?</p>
<h4 id="davixd_commented_at_2015-03-26_1723"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-86631419">2015-03-26 17:23</a>:<a class="headerlink" href="#davixd_commented_at_2015-03-26_1723" title="Permanent link">&para;</a></h4>
<p>Iam new to this project, so I have to find out first, how everything is
working together. Before I even didn't know, that the rescue image is
saving the BACKUP_PROG_CRYPT_KEY. But sure, when I will have
something, I will post the patch for that.</p>
<p>Thanks.</p>
<p>davixd</p>
<h4 id="davixd_commented_at_2015-03-30_1456"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-87712306">2015-03-30 14:56</a>:<a class="headerlink" href="#davixd_commented_at_2015-03-30_1456" title="Permanent link">&para;</a></h4>
<p>I have modified some codes lines, to achieve this goal and its working.</p>
<p>Edit: /usr/share/rear/backup/NETFS/default/50_make_backup.sh</p>
<p>Modify line 43 to: LogPrint "Encrypting archive with a key."<br />
Modfy line 81 to: $(cat $TMP_DIR/backup-include.txt) $LOGFILE |
$BACKUP_PROG_CRYPT_OPTIONS BACKUP_PROG_CRYPT_KEY | $SPLIT_COMMAND</p>
<p>With this settings the crypted key don't occur in the logs and is not
present in the rescue iso. To recover the key have to be typed it in in
/etc/rear/local.conf, BACKUP_PROG_CRYPT_KEY="".</p>
<p>Is there another place where the crypt key is also stored? If not, then
the rescue iso and the backup.tar.gz is save to be transported over
unsecure lines.</p>
<p>I have tested it successful in basic configuration (backup and
recover):<br />
/etc/rear/local.conf:<br />
OUTPUT=ISO<br />
BACKUP=NETFS<br />
BACKUP_URL="nfs://10.0.x.x/backup/rear/"<br />
GRUB_RESCUE=1<br />
GRUB_RESCUE_PASSWORD="SECRET"<br />
BACKUP_PROG_CRYPT_ENABLED=1<br />
BACKUP_PROG_CRYPT_KEY="testpw123"</p>
<p>I hope there are no side effects, I will test it also with extended
settings.</p>
<h4 id="schlomo_commented_at_2015-03-30_1556"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-87734163">2015-03-30 15:56</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-30_1556" title="Permanent link">&para;</a></h4>
<p>Great!</p>
<p>Could you please provide a pull request with your change?</p>
<p>Also, could you please make sure that ReaR refuses to start working if
the key is missing? Or give the user a chance to type it in
interactively?</p>
<p>I find giving users clear guidance an important aspect. Most likely the
user doing the restore won't know exactly what was configured years ago.</p>
<p>Thanks a lot!</p>
<h4 id="davixd_commented_at_2015-03-31_1602"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-88143391">2015-03-31 16:02</a>:<a class="headerlink" href="#davixd_commented_at_2015-03-31_1602" title="Permanent link">&para;</a></h4>
<p>Yes, sure, a pull request will come soon.</p>
<p>ReaR is already giving a hint, when the key is missing to type it in in
local.conf.<br />
What have to / can be done: Is to make it interactively. I will try it
soon.</p>
<p>Is incremental backup supported by ReaR? Cause I tried it with
BACKUP=NETFS and there is a problem while recovering grub.</p>
<p>Many thanks in advance!</p>
<h4 id="schlomo_commented_at_2015-03-31_1927"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-88218414">2015-03-31 19:27</a>:<a class="headerlink" href="#schlomo_commented_at_2015-03-31_1927" title="Permanent link">&para;</a></h4>
<p>Did you try
<a href="https://help.github.com/articles/using-pull-requests/">https://help.github.com/articles/using-pull-requests/</a>?</p>
<h4 id="gdha_commented_at_2015-05-31_1544"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-107210156">2015-05-31 15:44</a>:<a class="headerlink" href="#gdha_commented_at_2015-05-31_1544" title="Permanent link">&para;</a></h4>
<p>@davixd How far are you with the pull request? If I don't hear something
soon I'll push this to the milestone 1.18...</p>
<h4 id="davixd_commented_at_2015-06-07_1129"><img src="https://avatars.githubusercontent.com/u/11666104?u=b2be3387355394ed91e4dfbefa27fb41584fc906&v=4" width="50"><a href="https://github.com/davixd">davixd</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-109740677">2015-06-07 11:29</a>:<a class="headerlink" href="#davixd_commented_at_2015-06-07_1129" title="Permanent link">&para;</a></h4>
<p>Hi guys,<br />
sorry, but I was very very busy in the last few months.</p>
<p>Here is my pull request:<br />
<a href="https://github.com/rear/rear/pull/594">https://github.com/rear/rear/pull/594</a></p>
<p>These are the two changes, which have to be made in
/usr/share/rear/backup/NETFS/default/50_make_backup.sh, to achieve
this goal.</p>
<p>The asking for interactive password is not included yet, but while
trying to recover the backup without a password, rear shows a hint in
the error message (stdout) to get sure there is a password set in
/etc/rear/local.conf.</p>
<p>I hope my pull request is done the right way (my first pull request).</p>
<h4 id="gdha_commented_at_2015-06-16_1158"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/568#issuecomment-112399779">2015-06-16 11:58</a>:<a class="headerlink" href="#gdha_commented_at_2015-06-16_1158" title="Permanent link">&para;</a></h4>
<p>@davixd Thank you for the pull request - it is just fine.<br />
Just add a label so we do not forget to add proper documentation for
this feature.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-03-26.568.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
