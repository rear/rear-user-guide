<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#703 Issue closed: Boot From GRUB asked for Username and Password - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#703 Issue closed: Boot From GRUB asked for Username and Password";
        var mkdocs_page_input_path = "issues/2015-11-18.703.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#703 Issue closed: Boot From GRUB asked for Username and Password</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="703_issue_closed_boot_from_grub_asked_for_username_and_password"><a href="https://github.com/rear/rear/issues/703">#703 Issue</a> <code>closed</code>: Boot From GRUB asked for Username and Password<a class="headerlink" href="#703_issue_closed_boot_from_grub_asked_for_username_and_password" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>documentation</code>, <code>cleanup</code>, <code>support / question</code>,
<code>fixed / solved / done</code></p>
<h4 id="firsttris_opened_issue_at_2015-11-18_1944"><img src="https://avatars.githubusercontent.com/u/1709260?u=945c2037f8b7f9953a62ad14140e4812bebaa541&v=4" width="50"><a href="https://github.com/firsttris">firsttris</a> opened issue at <a href="https://github.com/rear/rear/issues/703">2015-11-18 19:44</a>:<a class="headerlink" href="#firsttris_opened_issue_at_2015-11-18_1944" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>my first rear restore... i boot relax-and-recover from GRUB and it asks
for a Username and Password...</p>
<p>wonderful.... i never set one... never read about this in the docs</p>
<p>Which credentials are they asking for?</p>
<p>i have tried rearadmin/REAR;REAR/REAR; root/REAR; admin/REAR;
root/recovery; root/</p>
<p>no option is correct...</p>
<p>regards</p>
<h4 id="gozora_commented_at_2015-11-18_2025"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-157852947">2015-11-18 20:25</a>:<a class="headerlink" href="#gozora_commented_at_2015-11-18_2025" title="Permanent link">&para;</a></h4>
<p>hi, if it is grub that asks you for password, default one is "SECRET"
<a href="http://relax-and-recover.org/usage/">http://relax-and-recover.org/usage/</a></p>
<h4 id="firsttris_commented_at_2015-11-18_2033"><img src="https://avatars.githubusercontent.com/u/1709260?u=945c2037f8b7f9953a62ad14140e4812bebaa541&v=4" width="50"><a href="https://github.com/firsttris">firsttris</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-157854833">2015-11-18 20:33</a>:<a class="headerlink" href="#firsttris_commented_at_2015-11-18_2033" title="Permanent link">&para;</a></h4>
<blockquote>
<p>The entry in the bootloader is password protected. The default
password is REAR. Change it in your own local.conf</p>
</blockquote>
<p>default user/password seems to be rearadmin/REAR but its not working...</p>
<p>i already tried to change them in local.conf..</p>
<p>...without success can not pass the passwort protection in GRUB...</p>
<p>my config:<br />
BACKUP=NETFS<br />
USB_DEVICE=/dev/disk/by-label/REAR-000<br />
OUTPUT=USB<br />
GRUB_RESCUE=y<br />
GRUB_RESCUE_PASSWORD="REAR"<br />
GRUB_SUPERUSER="root"</p>
<h4 id="gozora_commented_at_2015-11-18_2205"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-157879507">2015-11-18 22:05</a>:<a class="headerlink" href="#gozora_commented_at_2015-11-18_2205" title="Permanent link">&para;</a></h4>
<p>ok, it took me a while to figure it out.<br />
Problem is that <strong>GRUB_RESCUE_PASSWORD</strong> needs to be set hashed. (as
password_pbkdf2 option is in use)<br />
Means that you should use should create hash from password:</p>
<h1 id="grub-mkpasswd-pbkdf2">grub-mkpasswd-pbkdf2<a class="headerlink" href="#grub-mkpasswd-pbkdf2" title="Permanent link">&para;</a></h1>
<p>Enter password:<br />
Reenter password:<br />
Your PBKDF2 is
grub.pbkdf2.sha512.10000.F876269F3E0A87C3F8820643C210C4A090CA1E57E013A089EF69101B211940B3EBDA67B3850BA74C95A05FD44C3C5D19F0614AAF64659D4609B8E7F2D755D32C.1B8F56B392C7381CED82B46AB79E5F6A2F6F86ADD7B3D9B6034522DDF8B46913F70C45AA64ED3AE66F54760673D1CF36049660265ACC220F2B5C48487784ED5A</p>
<p>And use this output as feed for GRUB_RESCUE_PASSWORD, so the final
output would look something like this:</p>
<blockquote>
<p>GRUB_RESCUE=y<br />
GRUB_RESCUE_PASSWORD="grub.pbkdf2.sha512.10000.26A20D64CFF7668AC6D6A8E98F2EB960E1F7CBE4E7E128C1A2C77801860FB1377020CD3109FBE3CC841FAC8BB7D09B5B51FDE9DDD39507DE741716E97D77C6FC.352F331A65F1665315F8639A94E994248A3EA5D618671DBD6C44787C6217249675F5E6AB3A80F95914A1AF046645C6E5811D73EC5D34D3D2FAFFEA55B9E40DD4"<br />
GRUB_SUPERUSER="root"`</p>
</blockquote>
<p>Hope it helps ...</p>
<h4 id="gozora_commented_at_2015-11-18_2208"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-157880441">2015-11-18 22:08</a>:<a class="headerlink" href="#gozora_commented_at_2015-11-18_2208" title="Permanent link">&para;</a></h4>
<p>Just realized that hashes in my comment differ (dam you salt!), but the
principle stays the same ...</p>
<h4 id="firsttris_commented_at_2015-11-19_0539"><img src="https://avatars.githubusercontent.com/u/1709260?u=945c2037f8b7f9953a62ad14140e4812bebaa541&v=4" width="50"><a href="https://github.com/firsttris">firsttris</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-157957990">2015-11-19 05:39</a>:<a class="headerlink" href="#firsttris_commented_at_2015-11-19_0539" title="Permanent link">&para;</a></h4>
<p>thx very much gozora üëç i will try after work</p>
<h4 id="shoodle_commented_at_2016-03-10_1228"><img src="https://avatars.githubusercontent.com/u/17763325?v=4" width="50"><a href="https://github.com/shoodle">shoodle</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-194819540">2016-03-10 12:28</a>:<a class="headerlink" href="#shoodle_commented_at_2016-03-10_1228" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
i am opening this issue again, because i think it is not solved.</p>
<p>Today i wrote a config file like this /etc/rear/site.conf:</p>
<blockquote>
<p>OUTPUT=USB<br />
BACKUP_PROG=rsync<br />
BACKUP_PROG_EXCLUDE=( '/dev/<em>' '/proc/</em>' '/sys/<em>' '/tmp/</em>' '/run/<em>'
'/mnt/</em>' '/media/*' '/lost+found' )<br />
BACKUP=NETFS<br />
BACKUP_PROG_INCLUDE=( '/' )<br />
MANUAL_INCLUDE=YES<br />
BACKUP_URL=usb:///dev/disk/by-label/REAR-000<br />
GRUB_RESCUE=1</p>
</blockquote>
<p>When the backup finished i found a modified /boot/grub/grub.cfg and a
new entry /etc/grub.d/01_users.</p>
<p>When i booted my computer <strong>ALL</strong> menu entries in the grub menu were
protected with "username" and "password". When i tried to access an
entry with username "rearadmin" and password "REAR" i get the message</p>
<blockquote>
<p>Failed to boot both default and fallback entries.</p>
</blockquote>
<p>Therefore i cannot acces any of the different os entries in my system!</p>
<p>Booting with a rescue CD and removing /etc/grub.d/01_users and
restoring the backup copy /boot/grub/grub.cfg.old to grub.cfg didn't
help. (Because of a different os on the CD i couldn't chroot and run
grub-config).</p>
<p>When i read
<a href="https://help.ubuntu.com/community/Grub2/Passwords">https://help.ubuntu.com/community/Grub2/Passwords</a>
i get the impression that something is wrong with the line</p>
<blockquote>
<p>password_pbkdf2 rearadmin REAR</p>
</blockquote>
<p>in /etc/grub.d/01_users (it should be an encrypted passwod).</p>
<p>What can I do to get access to my computer again??</p>
<h4 id="jsmeix_commented_at_2016-07-25_1137"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234930048">2016-07-25 11:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-25_1137" title="Permanent link">&para;</a></h4>
<p>FYI, regarding "all menu entries in the grub menu were protected with
username and password":</p>
<p>I also noticed it while I made
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a></p>
<h4 id="jsmeix_commented_at_2016-07-25_1141"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234930705">2016-07-25 11:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-25_1141" title="Permanent link">&para;</a></h4>
<p>@firsttris<br />
can you tell us why you need that GRUB_RESCUE functionality?</p>
<p>In short:<br />
Currently we are thinking about if we perhaps better<br />
drop that scaring GRUB_RESCUE functionality,<br />
cf.<a href="https://github.com/rear/rear/issues/938">https://github.com/rear/rear/issues/938</a><br />
and
<a href="https://github.com/rear/rear/issues/935">https://github.com/rear/rear/issues/935</a><br />
and
<a href="https://github.com/rear/rear/issues/913">https://github.com/rear/rear/issues/913</a></p>
<h4 id="jsmeix_commented_at_2016-07-25_1143"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234931183">2016-07-25 11:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-25_1143" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
did you ever successfully use the GRUB_RESCUE functionality<br />
on a system with GRUB 2?</p>
<p>I ask because for me it did not at all work on SLE12.</p>
<p>I needed
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a><br />
to make it somewhat working on SLE12,<br />
see also
<a href="https://github.com/rear/rear/issues/938#issuecomment-234929757">https://github.com/rear/rear/issues/938#issuecomment-234929757</a></p>
<h4 id="firsttris_commented_at_2016-07-25_1152"><img src="https://avatars.githubusercontent.com/u/1709260?u=945c2037f8b7f9953a62ad14140e4812bebaa541&v=4" width="50"><a href="https://github.com/firsttris">firsttris</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234932728">2016-07-25 11:52</a>:<a class="headerlink" href="#firsttris_commented_at_2016-07-25_1152" title="Permanent link">&para;</a></h4>
<p>i just wanted to recover from usb:<br />
<a href="http://relax-and-recover.org/usage/#recovery_from_usb">http://relax-and-recover.org/usage/#recovery_from_usb</a><br />
actually i thought this would be the default way....<br />
my disk is gone i boot from usb to restore my main disk..<br />
regards<br />
firsttris</p>
<h4 id="gozora_commented_at_2016-07-25_1209"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234935861">2016-07-25 12:09</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-25_1209" title="Permanent link">&para;</a></h4>
<p>@jsmeix well, some time has passed, so I don't really remember, but I
guess that it worked fine for me...<br />
I can do tests again if you want...<br />
@shoodle can you share information like, what OS and ReaR version are
you using? Is the only problem here that you can't boot rescue image
because it is protected by password?</p>
<h4 id="jsmeix_commented_at_2016-07-25_1211"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-234936091">2016-07-25 12:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-25_1211" title="Permanent link">&para;</a></h4>
<p>As far as I understand<br />
<a href="http://relax-and-recover.org/usage/#recovery_from_usb">http://relax-and-recover.org/usage/#recovery_from_usb</a><br />
therein the items</p>
<pre>
Recovery from USB
Rescue system
Storing on a central NFS server
...
</pre>

<p>are all separated "Usage scenarios".</p>
<p>In particular as far as I understand it<br />
for "Recovery from USB" you do not need<br />
that locally installed "Rescue system" via GRUB_RESCUE.</p>
<h4 id="gozora_commented_at_2016-07-25_1729"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235023170">2016-07-25 17:29</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-25_1729" title="Permanent link">&para;</a></h4>
<p>Quite strange, when I setup similar config:</p>
<pre><code>BACKUP=NETFS
OUTPUT=USB
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
USB_DEVICE=/dev/disk/by-label/REAR-000
EXCLUDE_MD=( $(grep -o -E '^md[0-9]+' /proc/mdstat) ) # exclude all md devices
GRUB_RESCUE=1
COPY_AS_IS=( ${COPY_AS_IS[@]} /sbin/sysctl /etc/sysctl.conf /sbin/vconfig /sbin/if* /etc/sysconfig/network /sbin/shutdown.wrap )
</code></pre>
<p>I was stopped by following piece of
<a href="https://github.com/rear/rear/blame/fa2e33dd49b6bc2fe17a7f34a99d23b5b71389e0/usr/share/rear/output/default/94_grub2_rescue.sh#L68">code</a>,
telling me:</p>
<p><code>Message: GRUB_RESCUE_PASSWORD needs to be set. Run grub2-mkpasswd-pbkdf2 to generate pbkdf2 hash</code></p>
<p>Here I start to have problems with logic. because couple of lines above
this code I read condition like this:</p>
<p><code>if is_true $USING_UEFI_BOOTLOADER ; then ...</code></p>
<p>What is the purpose to check if GRUB_RESCUE_PASSWORD is set ONLY when
using UEFI? Or do I read it wrong?</p>
<p>BTW when I set <strong>GRUB_RESCUE=1</strong> and used <strong>GRUB_RESCUE_PASSWORD</strong>
hence allow ReaR to modify my grub.cfg, only grub entry protected with
password was that created by rear.</p>
<p>Unfortunately (most probably) systemd started to play tricks on me and
for some reason avoided me to create another backup :-/ (most probably
some race condition when discovering USB devices), so I have to solve
this first before I continue to investigate this further...</p>
<p>This looks to be bigger than I've expected so I need to get a beer or
two and think about it a bit.<br />
I'll report back with findings soon.</p>
<p>P.S. all tests have been done on <strong>CentOS Linux release 7.2.1511
(Core)</strong> with UEFI enabled</p>
<h4 id="gozora_commented_at_2016-07-25_1950"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235063997">2016-07-25 19:50</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-25_1950" title="Permanent link">&para;</a></h4>
<blockquote>
<p>What is the purpose to check if GRUB_RESCUE_PASSWORD is set ONLY
when using UEFI? Or do I read it wrong?</p>
</blockquote>
<p>Yes, Vladimir you read it wrong! The condition was closed couple of
lines before ;-), You should read code more carefully next time ...</p>
<h4 id="jsmeix_commented_at_2016-07-26_1013"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235226776">2016-07-26 10:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-26_1013" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
The "GRUB_RESCUE_PASSWORD needs to be set ..." message<br />
is from older code where I also had issues with,<br />
cf.
<a href="https://github.com/rear/rear/issues/938#issuecomment-234899163">https://github.com/rear/rear/issues/938#issuecomment-234899163</a></p>
<p>My current code for 94_grub2_rescue.sh<br />
in
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a><br />
works much better for me (on SLES12-SP1).</p>
<p>Now it supports to set GRUB2 password only optionally<br />
and additionally one can (also optionally) use an existing<br />
GRUB2 user via GRUB_RESCUE_USER without the need<br />
to let rear create a GRUB2 superuser.</p>
<p>I would very much appreciate if if you test it with my<br />
current code in
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a></p>
<h4 id="gozora_commented_at_2016-07-26_1216"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235250269">2016-07-26 12:16</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-26_1216" title="Permanent link">&para;</a></h4>
<p>@jsmeix sure will do ...<br />
I guess #942 is not yet merged with ReaR, so I have to use sources from
your repo, right?</p>
<h4 id="jsmeix_commented_at_2016-07-26_1316"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235263877">2016-07-26 13:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-26_1316" title="Permanent link">&para;</a></h4>
<p>In general regarding how to test<br />
some newest rear GitHub code in whatever other git branch<br />
that is not yet merged with rear upstream master code,<br />
see
<a href="https://github.com/rear/rear/issues/895#issuecomment-229655856">https://github.com/rear/rear/issues/895#issuecomment-229655856</a></p>
<h4 id="gozora_commented_at_2016-07-26_1324"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235265954">2016-07-26 13:24</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-26_1324" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks, will do ...<br />
Did you test this code with EFI enabled or legacy boot?</p>
<h4 id="jsmeix_commented_at_2016-07-26_1328"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235267011">2016-07-26 13:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-26_1328" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
What a question ;-)<br />
Do you think I like to notice more problems than I already see?<br />
Does this answer your question?<br />
.<br />
.<br />
.<br />
If not:<br />
.<br />
.<br />
.<br />
I tested only with legacy BIOS boot.</p>
<h4 id="gozora_commented_at_2016-07-26_1329"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235267324">2016-07-26 13:29</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-26_1329" title="Permanent link">&para;</a></h4>
<p>:D</p>
<h4 id="gozora_commented_at_2016-07-26_2102"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235404491">2016-07-26 21:02</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-26_2102" title="Permanent link">&para;</a></h4>
<p>I've made my life easier and switched (after long time) to legacy boot
as well. I've done testing on <strong>CentOS Linux release 7.2.1511
(Core)</strong>.<br />
First and only problem I've encounter was that <em>grub2 menuentry
"Relax-and-Recover"</em> did not boot because wrong path to initrd and
kernel.</p>
<p>ReaR created:</p>
<pre><code>search --no-floppy --fs-uuid  --set=root c3e2e7b1-2849-4797-a4ee-b2923c157e7c
linux  /boot/rear-kernel  selinux=0
initrd /boot/rear-initrd.cgz
</code></pre>
<p>but only following worked:</p>
<pre><code>search --no-floppy --fs-uuid  --set=root c3e2e7b1-2849-4797-a4ee-b2923c157e7c
linux  /rear-kernel  selinux=0
initrd /rear-initrd.cgz
</code></pre>
<p>I was thinking how to determine correct boot entries/paths for all
possible distros and come to conclusion that maybe we could copy it from
existing grug.cfg. Something like</p>
<p><code>grep -E initrd|kernel /boot/grub2/grub.cfg | sed awk parse hell whatever we need to know ...</code></p>
<p>What do you think?</p>
<p>To my opinion more severe thing is that once user sets
<strong>GRUB_RESCUE_PASSWORD</strong> and <strong>GRUB_SUPERUSER</strong> it will never change
in actual grub.cfg configuration until <em>/etc/grub.d/01_users</em> exists.
(hope I've understood code right this time ;-) ).<br />
This can be quite confusing.</p>
<p>Didn't you think about removing condition (on line 106 of
94_grub2_rescue.sh)<br />
<code>if [[ ! -f $grub_users_file ]] ; then</code><br />
so that grub use and password is changed every time?</p>
<h4 id="jsmeix_commented_at_2016-07-27_0720"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235506494">2016-07-27 07:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-27_0720" title="Permanent link">&para;</a></h4>
<p>Seems to be again a nice mess how GRUB 2 works<br />
on different Linux distributions.</p>
<p>On my SLES12-SP1 "linux /rear-kernel" and "initrd /rear-initrd.cgz"<br />
just failed to boot so that I changed it to the absolute path<br />
where the files actually are in the system, cf.<br />
<a href="https://github.com/rear/rear/pull/942#issuecomment-234944705">https://github.com/rear/rear/pull/942#issuecomment-234944705</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/938#issuecomment-234929757">https://github.com/rear/rear/issues/938#issuecomment-234929757</a></p>
<p>In contrast this does not work on CentOS.</p>
<p>Currently I don't know how to fix such Linux distribution mess<br />
so that it works in a generic way on all Linux distributions.</p>
<p>Regarding the GRUB 2 password protection,<br />
see my comments in default.conf and<br />
<a href="https://github.com/rear/rear/pull/942#issuecomment-235262557">https://github.com/rear/rear/pull/942#issuecomment-235262557</a></p>
<p>My general problem with the GRUB 2 password protection stuff<br />
is that I do not want that rear behaves as if it was the ultimate<br />
master of the whole GRUB 2 configuration.</p>
<p>The whole GRUB 2 password protection setup in rear is<br />
already scaring enough because it can change how other<br />
GRUB 2 boot entries behave (at least on SLE12)<br />
because it does general changes of the whole GRUB 2<br />
configuration - in particular with GRUB_SUPERUSER<br />
rear creates a new GRUB 2 superuser which is a general<br />
change of the whole GRUB 2 configuration.</p>
<p>The more I think about the GRUB 2 password protection setup<br />
in rear the less I like it at all.</p>
<p>Perhaps I should completely remove that scaring part of the<br />
GRUB_RESCUE setup.<br />
This would keep things simple and straightforward (KISS)<br />
because such a simplified GRUB_RESCUE setup<br />
would only add the one more GRUB 2 menue entry and<br />
leaves the rest of the GRUB 2 configuration unchanged.</p>
<p>If a user wants GRUB 2 password protection<br />
he can do that on his own as he likes and needs it.<br />
I think there is no real need that rear does that.<br />
I think GRUB 2 password protection setup in the<br />
currently running system is really not at all an<br />
expected native functionality of rear.</p>
<h4 id="jsmeix_commented_at_2016-07-27_0732"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235508682">2016-07-27 07:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-27_0732" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
many thanks for your testing!<br />
Your always valuable contributions to rear help a lot<br />
and are very much appreciated!</p>
<h4 id="gozora_commented_at_2016-07-27_0804"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235515034">2016-07-27 08:04</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-27_0804" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Pleasure ;-)</p>
<blockquote>
<p>Currently I don't know how to fix such Linux distribution mess<br />
so that it works in a generic way on all Linux distributions.</p>
</blockquote>
<p>I was thinking of a function that would discover correct values from
current boot loader setting, as that looks to be most precise way how to
get correct boot data.<br />
I'll start to work on it hopefully today.</p>
<blockquote>
<p>If a user wants GRUB 2 password protection<br />
he can do that on his own as he likes and needs it.<br />
I think there is no real need that rear does that.<br />
I think GRUB 2 password protection setup in the<br />
currently running system is really not at all an<br />
expected native functionality of rear.</p>
</blockquote>
<p>I share your opinion here. however this could be applied to ReaR grub
entry it self. "if a user wants GRUB 2 ReaR entry, he can do that on his
own as he likes and needs it" ;-)<br />
But I agree that <strong>GRUB_RESCUE</strong> option might be convenient in some
cases.</p>
<h4 id="jsmeix_commented_at_2016-07-27_0829"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235520748">2016-07-27 08:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-27_0829" title="Permanent link">&para;</a></h4>
<p>I think what actually causes pain with the current<br />
GRUB 2 password protection setup in rear<br />
is the GRUB_SUPERUSER setup because that<br />
changes how GRUB 2 as a whole behaves.</p>
<p>I think what is o.k. is my new GRUB_RESCUE_USER<br />
setup because that (plus a GRUB_RESCUE_PASSWORD) only<br />
adds a password_pbkdf2 line to the 'Relax-and-Recover' entry<br />
but it does not change the general GRUB 2 configuration<br />
(in particular it does not change what GRUB 2 users<br />
or superuser exists).</p>
<p>I think I will remove GRUB_SUPERUSER setup<br />
from rear and keep GRUB_RESCUE_USER plus<br />
GRUB_RESCUE_PASSWORD setup support in rear<br />
so that the user can have GRUB 2 password protection<br />
for the 'Relax-and-Recover' entry provided he already<br />
has a GRUB 2 user or superuser.</p>
<h4 id="jsmeix_commented_at_2016-07-27_0913"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235531395">2016-07-27 09:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-27_0913" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
regarding correct values for boot loader setting,<br />
see what @gdha asked in<br />
<a href="https://github.com/rear/rear/pull/942#discussion-diff-72051269">https://github.com/rear/rear/pull/942#discussion-diff-72051269</a></p>
<pre>
are you sure /boot is required?
Does the --set=root not fulfil this?
Just want to double check (I could be wrong).
</pre>

<p>I am not a sufficient GRUB 2 setup expert to know<br />
what the best way is so that it works generically<br />
on all Linux distributions.</p>
<p>I guess the less special GRUB 2 automatisms are used<br />
the more reliable it could (hopefully) work everywhere?</p>
<h4 id="gozora_commented_at_2016-07-27_1022"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235546639">2016-07-27 10:22</a>:<a class="headerlink" href="#gozora_commented_at_2016-07-27_1022" title="Permanent link">&para;</a></h4>
<p>@jsmeix I'm not grub expert neither, but I think that this is the only
prerequisite you need to become one :-).<br />
Like I said, I'll try to put something together and then we can discuss
whether is can be useful for the future or not.</p>
<h4 id="jsmeix_commented_at_2016-07-27_1319"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235582188">2016-07-27 13:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-27_1319" title="Permanent link">&para;</a></h4>
<p>Guess what - I use fixing the GRUB_RESCUE stuff<br />
as an opportunity to learn a bit how to deal<br />
with GRUB 2 issues in rear ;-)</p>
<h4 id="jsmeix_commented_at_2016-07-28_1302"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235887700">2016-07-28 13:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-28_1302" title="Permanent link">&para;</a></h4>
<p>With the now merged
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a><br />
I consider this issue here as sufficiently solved.</p>
<p>Note that with
<a href="https://github.com/rear/rear/pull/942">https://github.com/rear/rear/pull/942</a><br />
the whole GRUB_RESCUE feature for GRUB2<br />
was completely overhauled.</p>
<p>I made GRUB_RESCUE work for GRUB2<br />
on SUSE and Red Hat based Linux distributions.</p>
<p>The former GRUB2 superuser setup support in rear<br />
via GRUB_SUPERUSER is dropped and also<br />
the former GRUB2 password setup support<br />
in rear via GRUB_RESCUE_PASSWORD is dropped.<br />
Both kind of setup can change the behaviour<br />
of the GRUB2 bootloader as a whole in unexpected<br />
ways but rear is not meant to change the general<br />
GRUB2 configuration of the currently running system.<br />
It should work by default reasonably backward compatible<br />
when formerly a GRUB_SUPERUSER was used.</p>
<p>Now the optional GRUB2 password protection<br />
only works via the new GRUB_RESCUE_USER setting.<br />
It must specify an already configured GRUB2 user<br />
except the special value 'unrestricted' is set<br />
via GRUB_RESCUE_USER="unrestricted"<br />
which creates the 'Relax-and-Recover' GRUB2<br />
menue entry so that it can be booted by anyone.</p>
<p>For more details see the description in default.conf</p>
<h4 id="jsmeix_commented_at_2016-07-28_1315"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-235890869">2016-07-28 13:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-28_1315" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
regarding<br />
<a href="https://github.com/rear/rear/issues/703#issuecomment-235515034">https://github.com/rear/rear/issues/703#issuecomment-235515034</a><br />
"discover correct values from current boot loader setting":</p>
<p>At least for now this is not needed because in<br />
output/default/94_grub2_rescue.sh<br />
I use now different values for 'linux' and 'initrd'<br />
depending on the Linux distribution.</p>
<p>This is of course not the preferred generic solution<br />
but probably it is "good enough for now".</p>
<h4 id="gdha_commented_at_2017-01-19_0850"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-273715123">2017-01-19 08:50</a>:<a class="headerlink" href="#gdha_commented_at_2017-01-19_0850" title="Permanent link">&para;</a></h4>
<p>@jsmeix The above was not yet added to any kind of documentation except
for the default.conf file, right?</p>
<h4 id="jsmeix_commented_at_2017-01-19_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/703#issuecomment-273722542">2017-01-19 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-19_0927" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I assume with "The above" you mean<br />
<a href="https://github.com/rear/rear/issues/703#issuecomment-235887700">https://github.com/rear/rear/issues/703#issuecomment-235887700</a></p>
<p>Don't worry about documentation regarding "GRUB_RESCUE" ;-)<br />
It never was documented except in default.conf.<br />
Accordingly I documented my changes only in default.conf.</p>
<p>And for GRUB2 my code informs the user about the changes,<br />
see output/default/940_grub2_rescue.sh</p>
<pre>
    # Report no longer supported GRUB 2 superuser setup if GRUB_SUPERUSER is non-empty
    # (be prepared for 'set -u' by specifying an empty fallback value if GRUB_SUPERUSER is not set):
    test ${GRUB_SUPERUSER:-} && LogPrint "Skipping GRUB 2 superuser setup: GRUB_SUPERUSER is no longer supported (see default.conf)."
    # Report no longer supported GRUB 2 password setup if GRUB_RESCUE_PASSWORD is non-empty
    # (be prepared for 'set -u' by specifying an empty fallback value if GRUB_RESCUE_PASSWORD is not set):
    test ${GRUB_RESCUE_PASSWORD:-} && LogPrint "Skipping GRUB 2 password setup: GRUB_RESCUE_PASSWORD is no longer supported (see default.conf)."
</pre>

<p>I did not change anything regarding "GRUB_RESCUE"<br />
for GRUB Legacy because I never tested it with GRUB Legacy.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-11-18.703.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
