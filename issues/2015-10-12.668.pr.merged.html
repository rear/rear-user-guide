<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2015 10 12.668.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2015 10 12.668.pr.merged";
        var mkdocs_page_input_path = "issues/2015-10-12.668.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2015 10 12.668.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="668_pr_merged_check_for_fdrupstream_changed_files_and_required_programs"><a href="https://github.com/rear/rear/pull/668">#668 PR</a> <code>merged</code>: Check for FDRUPSTREAM changed files and required programs<a class="headerlink" href="#668_pr_merged_check_for_fdrupstream_changed_files_and_required_programs" title="Permanent link">&para;</a></h1>
<h4 id="rowens275_opened_issue_at_2015-10-12_1725"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> opened issue at <a href="https://github.com/rear/rear/pull/668">2015-10-12 17:25</a>:<a class="headerlink" href="#rowens275_opened_issue_at_2015-10-12_1725" title="Permanent link">&para;</a></h4>
<p>Some improvements, but no major change in function. I've created
CHECK_CONFIG_FILES_FDRUPSTREAM to track changes in certain files in
$FDRUPSTREAM_INSTALL_PATH which should trigger a new ISO build. I've
also created REQUIRED_PROGS_FDRUPSTREAM which only checks for one
critical file, but that is enough to verify that the user has
$FDRUPSTREAM_INSTALL_PATH set correctly.</p>
<h4 id="schlomo_commented_at_2015-10-15_1352"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-148393353">2015-10-15 13:52</a>:<a class="headerlink" href="#schlomo_commented_at_2015-10-15_1352" title="Permanent link">&para;</a></h4>
<p>I would always advice to not quote the patterns so that they are
expanded there where you write them and not somewhere else. That gives
you much more control and reduces risk for other code using those
arrays. Maybe the other code does not handle such patterns well, you can
never know for sure.</p>
<p>In any case, if you want to enable users to change the install path then
all that has to go to the prep stage. Please nevertheless leave the
variables in the default.conf (e.g. set to empty arrays) because we use
the default.conf as documentation for user changeable variables. In the
prep stage you should then <em>extend</em> the arrays thereby giving users the
ability to also add stuff to the arrays.</p>
<h4 id="schlomo_commented_at_2015-10-15_1353"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-148393456">2015-10-15 13:52</a>:<a class="headerlink" href="#schlomo_commented_at_2015-10-15_1353" title="Permanent link">&para;</a></h4>
<p>Do you want us to merge this now? In any case we cannot test it as we
don't have your software.</p>
<h4 id="rowens275_commented_at_2015-10-15_1459"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-148412586">2015-10-15 14:59</a>:<a class="headerlink" href="#rowens275_commented_at_2015-10-15_1459" title="Permanent link">&para;</a></h4>
<p>Yes, go ahead and merge. It is working as it is, but is probably not
ideal. I will make some changes and submit another pull request, but
things are very busy for me here right now so that may take several
days.</p>
<p>Is there an impending release? I just want to know if I have a hard
deadline...</p>
<h4 id="rowens275_commented_at_2015-10-29_1725"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152256561">2015-10-29 17:25</a>:<a class="headerlink" href="#rowens275_commented_at_2015-10-29_1725" title="Permanent link">&para;</a></h4>
<p>I moved the variables to the prep stage as you suggested, but that broke
checklayout for me. The reason is that I am adding files to
CHECK_CONFIG_FILES via CHECK_CONFIG_FILES_FDRUPSTREAM in
layout/save/default/40_check_backup_special_files.sh, but
51_compare_files.sh doesn't know anything about that. So my additional
files get included in files.md5sum, but 51_compare_files.sh only
generates md5sums for the files defined in default.conf.</p>
<p>I am struggling to find the proper way to address this. I created
layout/compare/FDRUPSTREAM/default/40_stuff.sh, but as far as it knows
CHECK_CONFIG_FILES_FDRUPSTREAM is empty. I don't think it's a good
idea for me to hard-code those values in two places -- I already extend
that array (from its default empty value) in the prep stage like this:</p>
<p>CHECK_CONFIG_FILES_FDRUPSTREAM=(
"${CHECK_CONFIG_FILES_FDRUPSTREAM[@]}"
"$FDRUPSTREAM_INSTALL_PATH"/uscmd*
"$FDRUPSTREAM_INSTALL_PATH"/usdaemon*
"$FDRUPSTREAM_INSTALL_PATH"/us "$FDRUPSTREAM_INSTALL_PATH"/us1
"$FDRUPSTREAM_INSTALL_PATH"/us.ser "$FDRUPSTREAM_INSTALL_PATH"/<em>.so
"$FDRUPSTREAM_INSTALL_PATH"/usudb</em> "$FDRUPSTREAM_INSTALL_PATH"/<em>.dat
"$FDRUPSTREAM_INSTALL_PATH"/</em>.cfg )</p>
<p>I could move this line to its own script in the prep stage, and call
that script in the layout/compare stage, but that feels kind of wrong.
Is there somewhere more "central" I could define this array?</p>
<h4 id="schlomo_commented_at_2015-10-29_1736"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152259597">2015-10-29 17:36</a>:<a class="headerlink" href="#schlomo_commented_at_2015-10-29_1736" title="Permanent link">&para;</a></h4>
<p>Do I understand you correctly that you want to use <code>rear savelayout</code>
which should also include FDRUPSTREAM stuff?</p>
<p>I just realized that the <code>savelayout</code> workflow does not call the
<code>prep</code>stage. Maybe this is the problem. To check this can you please try
to edit <code>usr/share/rear/lib/savelayout-workflow.sh</code> so that it looks
like this:</p>
<pre><code>if [[ "$VERBOSE" ]]; then
    WORKFLOW_savelayout_DESCRIPTION="save the disk layout of the system"
fi
WORKFLOWS=( ${WORKFLOWS[@]} savelayout )
WORKFLOW_savelayout () {
    SourceStage "prep"
    DISKLAYOUT_FILE=$VAR_DIR/layout/disklayout.conf
    SourceStage "layout/save"
}
</code></pre>
<p>Please let me know if this solves your problem. Actually this is also
what happens in the <code>mkrescue</code> workflow :-)</p>
<p>@gdha what do you think: Maybe we should always <code>prep</code> before
<code>savelayout</code> so that it becomes extensible?</p>
<h4 id="rowens275_commented_at_2015-10-29_1744"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152262170">2015-10-29 17:44</a>:<a class="headerlink" href="#rowens275_commented_at_2015-10-29_1744" title="Permanent link">&para;</a></h4>
<p>I haven't tried your suggestion yet, but wanted to quickly comment.
mkrescue properly updates files.md5sum, but it's probably because of
layout/save/default/40_check_backup_special_files.sh, which I now
realize must have been a workaround created by the TSM folks.</p>
<p>I haven't yet tried running savelayout by itself, but checklayout is
where I noticed the problem of my array not being extended.</p>
<h4 id="gdha_commented_at_2015-10-29_1906"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152289063">2015-10-29 19:06</a>:<a class="headerlink" href="#gdha_commented_at_2015-10-29_1906" title="Permanent link">&para;</a></h4>
<p>The checklayout workflow:</p>
<pre><code>WORKFLOW_checklayout () {
    ORIG_LAYOUT=$VAR_DIR/layout/disklayout.conf
    TEMP_LAYOUT=$TMP_DIR/checklayout.conf

    SourceStage "layout/precompare"

    DISKLAYOUT_FILE=$TEMP_LAYOUT
    SourceStage "layout/save"

    SourceStage "layout/compare"
}
</code></pre>
<p>also doesn't include the prep workflow. It should be tested I guess -
not sure it benefits the situation?</p>
<h4 id="rowens275_commented_at_2015-10-29_1911"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152290610">2015-10-29 19:11</a>:<a class="headerlink" href="#rowens275_commented_at_2015-10-29_1911" title="Permanent link">&para;</a></h4>
<p>I made the change Schlomo suggested, and also added this line to
lib/checklayout-workflow.sh, before all other SourceStage lines (not
sure if the order matters):</p>
<p>SourceStage "prep"</p>
<p>This makes checklayout work for me, and includes
CHECK_CONFIG_FILES_FDRUPSTREAM. I have not tested for any negative
consequences yet.</p>
<h4 id="schlomo_commented_at_2015-10-29_1914"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152291393">2015-10-29 19:14</a>:<a class="headerlink" href="#schlomo_commented_at_2015-10-29_1914" title="Permanent link">&para;</a></h4>
<p>Nice. Yes, the order matters. What you see there is the "recipe" which
ReaR works through when you call the workflow.</p>
<h4 id="rowens275_commented_at_2015-10-29_1949"><img src="https://avatars.githubusercontent.com/u/14808030?v=4" width="50"><a href="https://github.com/rowens275">rowens275</a> commented at <a href="https://github.com/rear/rear/pull/668#issuecomment-152299835">2015-10-29 19:49</a>:<a class="headerlink" href="#rowens275_commented_at_2015-10-29_1949" title="Permanent link">&para;</a></h4>
<p>I can test this with BACKUP=FDRUPSTREAM. But I am concerned that I don't
know enough about the inner workings of ReaR to feel confident that
there are no adverse effects for other backup methods. If you guys have
any suggestions of things to look out for, let me know.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-10-12.668.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
