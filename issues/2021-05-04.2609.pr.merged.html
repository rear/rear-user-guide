<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2609 PR merged: Better description and error checking for GRUB_RESCUE with UEFI plus some alignment with create_grub2_cfg function - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2609 PR merged: Better description and error checking for GRUB_RESCUE with UEFI plus some alignment with create_grub2_cfg function";
        var mkdocs_page_input_path = "issues/2021-05-04.2609.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2609 PR merged: Better description and error checking for GRUB_RESCUE with UEFI plus some alignment with create_grub2_cfg function</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2609_pr_merged_better_description_and_error_checking_for_grub_rescue_with_uefi_plus_some_alignment_with_create_grub2_cfg_function"><a href="https://github.com/rear/rear/pull/2609">#2609 PR</a> <code>merged</code>: Better description and error checking for GRUB_RESCUE with UEFI plus some alignment with create_grub2_cfg function<a class="headerlink" href="#2609_pr_merged_better_description_and_error_checking_for_grub_rescue_with_uefi_plus_some_alignment_with_create_grub2_cfg_function" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2021-05-04_1019"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/2609">2021-05-04 10:19</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2021-05-04_1019" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2545">https://github.com/rear/rear/issues/2545</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Not at all tested by me - currently I don't have a UEFI test system</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    Improved user messages during GRUB_RESCUE setup in particular for
    the UEFI case<br />
    plus some error checking in the UEFI case and some minor code
    simplifications.</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2021-05-04_1033"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831843037">2021-05-04 10:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1033" title="Permanent link">&para;</a></h4>
<p>@pcahyna @gozora<br />
currently we have in output/default/940_grub2_rescue.sh (excerpt)</p>
<pre><code>    # Create configuration file for "Relax-and-Recover" UEFI boot entry.
    # This file will not interact with existing Grub2 configuration in any way.
    (   echo "set btrfs_relative_path=y"
        echo "insmod efi_gop"
        echo "insmod efi_uga"
        echo "insmod video_bochs"
        echo "insmod video_cirrus"
        echo "insmod all_video"
...
    ) &gt; $grub_config_dir/rear.cfg
</code></pre>
<p>We cleaned up that kind of explicit <code>insmod GRUB_module</code>
specifications<br />
some time ago because those had caused various issues, e.g. see<br />
<a href="https://github.com/rear/rear/pull/2390">https://github.com/rear/rear/pull/2390</a></p>
<p>@pcahyna @gozora<br />
could you please have a look here if same kind of cleanup<br />
is perhaps also needed in output/default/940_grub2_rescue.sh<br />
or correct me if I am wrong.<br />
Thank you in advance!</p>
<h4 id="pcahyna_commented_at_2021-05-04_1125"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831869199">2021-05-04 11:25</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-04_1125" title="Permanent link">&para;</a></h4>
<p>@jsmeix storage modules are detected automatically, but I had to re-add
video modules in 361268355f493aeb0c22069c3e143bdba5be7203, otherwise
graphics did not work. We then cleaned up those modules in
2470edf534bc836a3f13d8c48e3007a24bb63bf4 and
0cc1b6a7450133f952b8c187e85d61397a45dbe1 because we determined that
<code>all_video</code> is enough: discussion in #2388.<br />
Unfortunately, the change did not propagate from <code>create_grub2_cfg()</code> in
bootloader-functions.sh to here, because 940_grub2_rescue.sh has its
own version of GRUB2 config code (see the XXX in
361268355f493aeb0c22069c3e143bdba5be7203)</p>
<h4 id="jsmeix_commented_at_2021-05-04_1154"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831883795">2021-05-04 11:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1154" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for finding the matching git commits!</p>
<p>I like to summarize:</p>
<p>On Dec 15, 2019<br />
the GRUB2 modules <code>efi_gop</code> <code>efi_uga</code> <code>video_bochs</code> <code>video_cirrus</code>
<code>all_video</code><br />
and <code>set gfxpayload=keep</code> were added to 940_grub2_rescue.sh via<br />
<a href="https://github.com/rear/rear/commit/361268355f493aeb0c22069c3e143bdba5be7203">https://github.com/rear/rear/commit/361268355f493aeb0c22069c3e143bdba5be7203</a></p>
<p>On May 7, 2020<br />
the GRUB2 modules <code>video_bochs</code> <code>video_cirrus</code> were removed from
create_grub2_cfg via<br />
<a href="https://github.com/rear/rear/commit/0cc1b6a7450133f952b8c187e85d61397a45dbe1">https://github.com/rear/rear/commit/0cc1b6a7450133f952b8c187e85d61397a45dbe1</a></p>
<p>On May 13, 2020<br />
the GRUB2 modules <code>efi_gop</code> <code>efi_uga</code> were removed from
create_grub2_cfg via<br />
<a href="https://github.com/rear/rear/commit/2470edf534bc836a3f13d8c48e3007a24bb63bf4">https://github.com/rear/rear/commit/2470edf534bc836a3f13d8c48e3007a24bb63bf4</a></p>
<p>So now there is in create_grub2_cfg only</p>
<pre><code>insmod all_video

set gfxpayload=keep
insmod gzio
insmod part_gpt
insmod ext2
</code></pre>
<p>while in 940_grub2_rescue.sh we have currently still</p>
<pre><code>insmod efi_gop
insmod efi_uga
insmod video_bochs
insmod video_cirrus
insmod all_video
set gfxpayload=keep
</code></pre>
<p>According to<br />
<a href="https://github.com/rear/rear/commit/361268355f493aeb0c22069c3e143bdba5be7203">https://github.com/rear/rear/commit/361268355f493aeb0c22069c3e143bdba5be7203</a></p>
<pre><code>XXX the Grub2 config file generation for GRUB2_RESCUE should be unified with
config file generation for ISO (create_grub2_cfg).
</code></pre>
<p>things in 940_grub2_rescue.sh should match what we meanwhile have in
create_grub2_cfg<br />
so I should change 940_grub2_rescue.sh so that the code there becomes</p>
<pre><code>    # Create configuration file for "Relax-and-Recover" UEFI boot entry.
    # This file will not interact with existing Grub2 configuration in any way.
    (   echo "set btrfs_relative_path=y"
        echo "insmod all_video"
        echo ""
        echo "set gfxpayload=keep"
</code></pre>
<p>Is that right?<br />
If yes I would change 940_grub2_rescue.sh accordingly.</p>
<p>What about</p>
<pre><code>insmod gzio
insmod part_gpt
insmod ext2
</code></pre>
<p>that we have in create_grub2_cfg but not in 940_grub2_rescue.sh ?</p>
<h4 id="pcahyna_commented_at_2021-05-04_1226"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831902713">2021-05-04 12:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-04_1226" title="Permanent link">&para;</a></h4>
<blockquote>
<p>things in 940_grub2_rescue.sh should match what we meanwhile have in
create_grub2_cfg<br />
so I should change 940_grub2_rescue.sh so that the code there
becomes</p>
<pre><code>    # Create configuration file for "Relax-and-Recover" UEFI boot entry.
    # This file will not interact with existing Grub2 configuration in any way.
    (   echo "set btrfs_relative_path=y"
        echo "insmod all_video"
        echo ""
        echo "set gfxpayload=keep"
</code></pre>
<p>Is that right?<br />
If yes I would change 940_grub2_rescue.sh accordingly.</p>
</blockquote>
<p>Would it be feasible to just use <code>create_grub2_cfg()</code> in
940_grub2_rescue.sh instead of carrying a copy of the code?</p>
<blockquote>
<p>What about</p>
<pre><code>insmod gzio
insmod part_gpt
insmod ext2
</code></pre>
<p>that we have in create_grub2_cfg but not in 940_grub2_rescue.sh ?</p>
</blockquote>
<p>I don't know. This seemed a bit arbitrary (why ext2? What if we are
using some other filesystem?) but I avoided touching that part when
changing the GRUB2 stuff, because it was not causing any immediate
problems. Looking at log, it was added in 33305d0fa without any
explanation and it appeared de novo (the tree at that point does no have
any other occurrence of <code>insmod ext2</code>).</p>
<h4 id="jsmeix_commented_at_2021-05-04_1233"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831906612">2021-05-04 12:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1233" title="Permanent link">&para;</a></h4>
<p>I am neither a sufficient UEFI expert nor a sufficient GRUB2 expert<br />
to implement using create_grub2_cfg() in 940_grub2_rescue.sh</p>
<p>Additionally this would be a too major change that exceeds too much<br />
the intent of this pull request.</p>
<p>Of course we could need some major cleanup of the whole grown<br />
various pieces of different bootloader related code parts in ReaR,<br />
e.g. cf.
<a href="https://github.com/rear/rear/issues/764">https://github.com/rear/rear/issues/764</a></p>
<h4 id="jsmeix_commented_at_2021-05-04_1245"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-831913358">2021-05-04 12:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-04_1245" title="Permanent link">&para;</a></h4>
<p>Via<br />
<a href="https://github.com/rear/rear/pull/2609/commits/3eb8f0589d6d2d6b49bf589137517f36b675f9dc">https://github.com/rear/rear/pull/2609/commits/3eb8f0589d6d2d6b49bf589137517f36b675f9dc</a><br />
the GRUB2 configuration file that is created by
output/default/940_grub2_rescue.sh<br />
does no longer "insmod" the GRUB2 modules <code>efi_gop</code> <code>efi_uga</code>
<code>video_bochs</code> <code>video_cirrus</code><br />
to create this GRUB2 configuration file like the create_grub2_cfg
function does it<br />
cf.
<a href="https://github.com/rear/rear/pull/2609#issuecomment-831883795">https://github.com/rear/rear/pull/2609#issuecomment-831883795</a></p>
<p>When this is wrong I can revert it back to what it was before or change
it<br />
to whatever I am told what "the right list of GRUB2 modules" should be
here.</p>
<h4 id="jsmeix_commented_at_2021-05-07_0949"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-834223564">2021-05-07 09:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-07_0949" title="Permanent link">&para;</a></h4>
<p>@gozora @rear/contributors<br />
could you have a look here and ideally do a review provided you have
time for it?<br />
If not I would like to merge it as is "bona fide" on Monday afternoon.</p>
<h4 id="jsmeix_commented_at_2021-05-10_1321"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-836692302">2021-05-10 13:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-10_1321" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for your review.<br />
Currently I cannot do the needed complete cleanup regarding<br />
our various different kind of UEFI boot setup code places<br />
so I only added a TODO comment to have it at least described.</p>
<p>If there are no objections I would like to merge it as is tomorrow
afternoon.</p>
<h4 id="pcahyna_commented_at_2021-05-10_1459"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-836805091">2021-05-10 14:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-05-10_1459" title="Permanent link">&para;</a></h4>
<p>@jsmeix no further comment on the changes from me, a TODO is enough for
the scope of the PR, but I think you should adjust the PR title and the
merge commit message, because in addition to improving user messages you
did some functional changes (removing the GRUB video modules from
generated config).</p>
<h4 id="jsmeix_commented_at_2021-05-11_1013"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2609#issuecomment-838212410">2021-05-11 10:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-05-11_1013" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for all your help here to move one step forward in the UEFI
area.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-05-04.2609.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
