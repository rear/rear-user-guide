<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2081 PR merged: Enable creation of non consecutive partitions - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2081 PR merged: Enable creation of non consecutive partitions";
        var mkdocs_page_input_path = "issues/2019-03-12.2081.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2081 PR merged: Enable creation of non consecutive partitions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2081_pr_merged_enable_creation_of_non_consecutive_partitions"><a href="https://github.com/rear/rear/pull/2081">#2081 PR</a> <code>merged</code>: Enable creation of non consecutive partitions<a class="headerlink" href="#2081_pr_merged_enable_creation_of_non_consecutive_partitions" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="rmetrich_opened_issue_at_2019-03-12_1538"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> opened issue at <a href="https://github.com/rear/rear/pull/2081">2019-03-12 15:38</a>:<a class="headerlink" href="#rmetrich_opened_issue_at_2019-03-12_1538" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/1681">https://github.com/rear/rear/issues/1681</a><br />
<a href="https://github.com/rear/rear/issues/1771">https://github.com/rear/rear/issues/1771</a><br />
<a href="https://github.com/rear/rear/issues/1793">https://github.com/rear/rear/issues/1793</a></p>
</li>
<li>
<p>How was this pull request tested?</p>
</li>
</ul>
<p>Tested with 4 disks:</p>
<ul>
<li>Disk 1: GPT with consecutive partitions</li>
<li>Disk 2: MSDOS with consecutive partitions</li>
<li>Disk 3: GPT with non-consecutive partitions (1, 3, 4, 6)</li>
<li>Disk 4: MSDOS with non-consecutive partitions (1, 3 (extended), 5
    (logical), 6 (logical))</li>
</ul>
<!-- -->

<ul>
<li>Brief description of the changes in this pull request:</li>
</ul>
<p><code>parted</code> is not capable of creating non-consecutive partitions. To still
be able to do so, the trick consists in creating dummy partitions to
fill the gaps between partition numbers.<br />
Allocation of these dummy partitions is done from the end of the target
partition, because <code>parted</code> is not capable of resizing a partition from
the beginning.</p>
<p>Example (see also in <code>/usr/share/rear/lib/layout-functions.sh</code>,
<code>create_disk_partition()</code> function):</p>
<pre><code>The GPT disk contains only 1 partition numbered 3 named PART

# parted -m -s /dev/sda unit B print
/dev/sda:21474836480B:scsi:512:512:gpt:QEMU QEMU HARDDISK:;
3:1048576B:2097151B:1048576B::PART:;

We need to create these partitions to recreate the exact same partitions:

# parted -m -s /dev/sda unit B print
/dev/sda:21474836480B:scsi:512:512:gpt:QEMU QEMU HARDDISK:;
3:1048576B:2096127B:1047552B::PART:;
2:2096128B:2096639B:512B::dummy2:;
1:2096640B:2097151B:512B::dummy1:;

Then delete dummy partition 1 and 2 and resize 3 to its original end.
</code></pre>
<h4 id="jsmeix_commented_at_2019-03-12_1600"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-472062863">2019-03-12 16:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-12_1600" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
Wow!<br />
I will have a look tomorrow...</p>
<h4 id="jsmeix_commented_at_2019-03-14_1130"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-472812934">2019-03-14 11:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-14_1130" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
when I was thinking about how to implement that in the past<br />
because of
<a href="https://github.com/rear/rear/issues/1681">https://github.com/rear/rear/issues/1681</a><br />
and
<a href="https://github.com/rear/rear/issues/1771">https://github.com/rear/rear/issues/1771</a><br />
I had the idea to create all dummy partitions all at the end of the
disk.</p>
<p>I assume the mimimum size of a partition is 4096 bytes = 4 * 512
bytes<br />
(I hope this is safe for
<a href="https://en.wikipedia.org/wiki/Advanced_Format">https://en.wikipedia.org/wiki/Advanced_Format</a>
)<br />
then if we use 1 MiB at the end of the disk for dummy partitions<br />
we should be able to create up to 256 = 1024 * 1024 / 4096<br />
dummy partitions in that last 1 MiB at the end of the disk.</p>
<p>This way we could create all "real" partitions normally<br />
without the need to resize them - except the last "real" partition<br />
that must be created at most up to the end of the disk minus 1 MiB.</p>
<p>After all "real" partitions were created normally we can remove<br />
the dummy partitions at the end of the disk.</p>
<p>I think we could even leave the last "real" partition as is<br />
which would make it at most 1 MiB smaller than it was before.<br />
I think that 1 MiB less cannot be of real importance.</p>
<p>Or could that somehow mess up things when LVM or things like that<br />
is used on the last "real" partition that got recreated 1 MiB smaller?</p>
<p>I think things will mess up when the last "real" partition<br />
is recreated 1 MiB smaller and that partition is an extended partition<br />
and the last logical partition goes up to the end of the extended
partition<br />
which means if the extended partition is recreated 1 MiB smaller then<br />
the last logical partition must be also recreated 1 MiB smaller.</p>
<h4 id="rmetrich_commented_at_2019-03-14_1236"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-472834259">2019-03-14 12:36</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-03-14_1236" title="Permanent link">&para;</a></h4>
<p>@jsmeix I did some testing and it messed up LVM indeed. I believe
resizing the partition is safer. Also it's hard to tell which is the
last partition to resize because partitions must be in right order but
allocated blocks are not (partition 1 can point to end of disk for
example).</p>
<h4 id="jsmeix_commented_at_2019-03-14_1321"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-472850662">2019-03-14 13:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-14_1321" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
thank you for your testing - that makes things clear.</p>
<p>FYI:<br />
With "last partition" I meant what is located "last" on the disk<br />
(not what has the highest partition number), i.e. same as in<br />
layout/prepare/default/420_autoresize_last_partitions.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh#L161">https://github.com/rear/rear/blob/master/usr/share/rear/layout/prepare/default/420_autoresize_last_partitions.sh#L161</a></p>
<pre><code># The last partition is the /dev/&lt;partition&gt; with biggest &lt;partition start(bytes)&gt; value.
</code></pre>
<h4 id="jsmeix_commented_at_2019-03-28_1228"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-477574294">2019-03-28 12:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-28_1228" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
do you think you can make this working for ReaR 2.5<br />
or should it better be postponed?</p>
<p>I think changes in the layout code that recreates partitions<br />
are now somewhat late for ReaR 2.5 and because currently<br />
we do not have real user issues with sparse partition schemes<br />
I think it should be postponed after ReaR 2.5 to avoid regressions.</p>
<h4 id="rmetrich_commented_at_2019-03-28_1239"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-477577805">2019-03-28 12:39</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-03-28_1239" title="Permanent link">&para;</a></h4>
<p>Better postpone it to later ... even if it seems to work.</p>
<h4 id="jsmeix_commented_at_2019-03-28_1458"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-477631933">2019-03-28 14:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-28_1458" title="Permanent link">&para;</a></h4>
<p>A side note FYI:</p>
<p>When you need "associative" arrays that are indexed by a number<br />
(in your case the partition number for <code>partitions_to_resize()</code>)<br />
you can use the normal bash 3.x non-associative arrays<br />
because one can set arbirary index numbers like:</p>
<pre><code># arr[2]="two"
# arr[4]="four"
# arr[7]="seven"

# declare -p arr
declare -a arr='([2]="two" [4]="four" [7]="seven")'

# for index in $( seq 256 ) ; do test "${arr[$index]}" &amp;&amp; echo "element with index $index is '${arr[$index]}'"  ; done
element with index 2 is 'two'
element with index 4 is 'four'
element with index 7 is 'seven'
</code></pre>
<p>Alternatively when you need pairs of numbers in an array<br />
you may concatenate the numbers of one pair<br />
with a non-digit separator character like<br />
<code>partition_number:end_btye</code><br />
as in</p>
<pre><code>arr=( 2:12345 7:23456 123:3456789 )
</code></pre>
<p>and split them later with something like</p>
<pre><code>for e in "${arr[@]}" ; do
    partition_number=${e%%:*}
    end_btye=${e##*:}
    echo partition_number $partition_number end_btye $end_btye
done
</code></pre>
<p>which results this output</p>
<pre><code>partition_number 2 end_btye 12345
partition_number 7 end_btye 23456
partition_number 123 end_btye 3456789
</code></pre>
<p>Alternatively when you need tuples of words in an array<br />
you can store them as strings with usual $IFS separators<br />
like in this code example</p>
<pre><code># Array elemets are "partition_number start_byte end_btye"
arr=( "2 1234 2345" "7 3456 4567" "123 5678 6789" )

declare -p arr

for e in "${arr[@]}" ; do
    read partition_number start_byte end_btye junk &lt;&lt;&lt;"$e"
    echo partition_number:$partition_number start_byte:$start_byte end_btye:$end_btye
done
</code></pre>
<p>which results this output</p>
<pre><code>declare -a arr='([0]="2 1234 2345" [1]="7 3456 4567" [2]="123 5678 6789")'
partition_number:2 start_byte:1234 end_btye:2345
partition_number:7 start_byte:3456 end_btye:4567
partition_number:123 start_byte:5678 end_btye:6789
</code></pre>
<h4 id="jsmeix_commented_at_2019-03-29_1040"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-477951823">2019-03-29 10:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-29_1040" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
many thanks for all your efforts to deal with<br />
all that various different <code>parted</code> versions!</p>
<h4 id="rmetrich_commented_at_2019-03-29_1107"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-477959450">2019-03-29 11:07</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-03-29_1107" title="Permanent link">&para;</a></h4>
<p>Sorry it's still WiP, testing ...</p>
<h4 id="rmetrich_commented_at_2019-03-29_1403"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478009079">2019-03-29 14:03</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-03-29_1403" title="Permanent link">&para;</a></h4>
<p>Code is now stable, I hope :-)</p>
<h4 id="rmetrich_commented_at_2019-03-29_1516"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478036017">2019-03-29 15:16</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-03-29_1516" title="Permanent link">&para;</a></h4>
<p>@jsmeix Could you test on a SLES12-SP4, which has "parted resize" but
not "parted resizepart", but still "parted resize" with only NUM and END
arguments.</p>
<p>You just need to add some disk, partition it with msdos or GPT with gaps
in partitions, and try restoring :-)</p>
<h4 id="jsmeix_commented_at_2019-03-29_1520"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478037294">2019-03-29 15:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-29_1520" title="Permanent link">&para;</a></h4>
<p>For documentation here a summary with excerpts from<br />
<a href="https://github.com/rear/rear/pull/2081#discussion_r270031759">https://github.com/rear/rear/pull/2081#discussion_r270031759</a><br />
that show where non consecutive partitions should now work on SLES:</p>
<p>On my SLES10-SP4 system</p>
<pre><code># parted --version
GNU Parted 1.6.25.1

# parted --help
...
  resize NUMBER START END
    resize partition NUMBER and its file system
</code></pre>
<p>means <code>FEATURE_PARTED_RESIZEPART=n</code><br />
and <code>FEATURE_PARTED_RESIZE=n</code> so that<br />
non consecutive partitions do not work on SLES10.</p>
<p>On my SLES11-SP4 system</p>
<pre><code># parted --version
parted (GNU parted) 2.3 ...

# parted --help
...
  resize NUMBER START END
    resize partition NUMBER and its file system
</code></pre>
<p>means <code>FEATURE_PARTED_RESIZEPART=n</code><br />
and <code>FEATURE_PARTED_RESIZE=n</code> so that<br />
non consecutive partitions do not work on SLES11.</p>
<p>On my SLES12-SP4 system:</p>
<pre><code># parted --version
parted (GNU parted) 3.1 ...

# parted --help
...
  resize NUMBER END
    change end sector of partition NUMBER
</code></pre>
<p>means <code>FEATURE_PARTED_RESIZEPART=n</code><br />
and <code>FEATURE_PARTED_RESIZE=y</code> so that<br />
non consecutive partitions should now work on SLES12.</p>
<p>On my SLES15-like openSUSE Leap 15.0 system:</p>
<pre><code># parted --version
parted (GNU parted) 3.2 ...

# parted --help
...
  resizepart NUMBER END
    resize partition NUMBER
</code></pre>
<p>means <code>FEATURE_PARTED_RESIZEPART=y</code><br />
and <code>FEATURE_PARTED_RESIZE=n</code> so that<br />
non consecutive partitions should now work on SLES15.</p>
<h4 id="jsmeix_commented_at_2019-03-29_1522"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478038072">2019-03-29 15:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-29_1522" title="Permanent link">&para;</a></h4>
<p>I will test it on SLES and provide feedback<br />
( but not before next Monday ;-)</p>
<p>@rmetrich<br />
many thanks for your efforts and have a nice weekend!</p>
<h4 id="jsmeix_commented_at_2019-04-02_0959"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478928237">2019-04-02 09:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-02_0959" title="Permanent link">&para;</a></h4>
<p>I did my first test:<br />
Things seem to work well for me on SLES12-SP4<br />
with missing primary MSDOS partitions<br />
(I get byte-by-byte identical partitions recreated).</p>
<h4 id="jsmeix_commented_at_2019-04-02_1333"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-478997530">2019-04-02 13:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-02_1333" title="Permanent link">&para;</a></h4>
<p>I did my second test:<br />
Things seem to work well for me on SLES15 with missing GPT partitions<br />
(I get byte-by-byte identical partitions recreated).</p>
<h4 id="rmetrich_commented_at_2019-04-02_1407"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-479012375">2019-04-02 14:07</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-04-02_1407" title="Permanent link">&para;</a></h4>
<p>Thanks @jsmeix for testing on SUSE.</p>
<h4 id="jsmeix_commented_at_2019-04-02_1424"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-479020756">2019-04-02 14:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-02_1424" title="Permanent link">&para;</a></h4>
<p>@gdha @schabrolles @gozora<br />
could you also have a look here?</p>
<h4 id="jsmeix_commented_at_2019-04-02_1425"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-479021300">2019-04-02 14:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-02_1425" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
I like to also test SLES11 to see how things behave<br />
when non-consecutive partitions are not supported...</p>
<h4 id="jsmeix_commented_at_2019-05-23_0928"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-495141084">2019-05-23 09:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-05-23_0928" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
feel free to merge it as soon as you like.</p>
<p>I will not find time to also test SLES11 to see how things behave<br />
when non-consecutive partitions are not supported, cf.<br />
<a href="https://github.com/rear/rear/pull/2081#issuecomment-479021300">https://github.com/rear/rear/pull/2081#issuecomment-479021300</a></p>
<p>Personally I would appreciate it if you merge it sooner than later<br />
because I need to do enhancements for partition creation<br />
on IBM Z architecture, cf.<br />
<a href="https://github.com/rear/rear/pull/2142#issuecomment-494840866">https://github.com/rear/rear/pull/2142#issuecomment-494840866</a><br />
and I would prefer to do my enhancements<br />
on top of your enhancements in this pull request here.</p>
<h4 id="rmetrich_commented_at_2019-05-24_1101"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-495575396">2019-05-24 11:01</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-05-24_1101" title="Permanent link">&para;</a></h4>
<p>@jsmeix Done :-)</p>
<h4 id="jsmeix_commented_at_2019-05-24_1216"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-495599459">2019-05-24 12:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-05-24_1216" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
you did something but this pull request is<br />
not yet merged into the current master code,<br />
cf.
<a href="https://github.com/rear/rear/commits">https://github.com/rear/rear/commits</a></p>
<h4 id="rmetrich_commented_at_2019-05-24_1256"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-495614861">2019-05-24 12:56</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-05-24_1256" title="Permanent link">&para;</a></h4>
<p>Odd, I clicked!<br />
Anyway this time, should be ok</p>
<h4 id="jsmeix_commented_at_2019-05-27_0715"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-496105822">2019-05-27 07:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-05-27_0715" title="Permanent link">&para;</a></h4>
<p>Never mind!<br />
That's just how computers behave nowadays:<br />
Internally deterministic but unpredictable from the outside.</p>
<p>I guess the 'click' event handler callback function manager got a<br />
temporary system communication bus conflict with the user interface<br />
database agent when launching a request handler for the time slice<br />
watchdog processor on the remote client control daemon instance<br />
container cloud blockchain as a service buzz bleep fubar argh!</p>
<h4 id="jsmeix_commented_at_2019-05-27_1108"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-496175444">2019-05-27 11:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-05-27_1108" title="Permanent link">&para;</a></h4>
<p>There is a possibly severe issue/regression since this is merged:</p>
<p>Before there have been the explicit <code>parted</code> calls<br />
in the diskrestore.sh script so that in MIGATION_MODE<br />
one could edit them directly, for example</p>
<pre><code>parted -s /dev/dasda mklabel dasd &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda1'" 98304B 314621951B &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda2'" 314621952B 838926335B &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda3'" 838926336B 7385198591B &gt;&amp;2
</code></pre>
<p>cf.
<a href="https://github.com/rear/rear/pull/2142#issuecomment-495554406">https://github.com/rear/rear/pull/2142#issuecomment-495554406</a></p>
<p>Since this is merged the explicit <code>parted</code> calls in diskrestore.sh<br />
are replaced by indirect function calls like in my case now</p>
<pre><code>create_disk_label /dev/dasda dasd
create_disk_partition "/dev/dasda" "ext2" 1 98304 314621951
create_disk_partition "/dev/dasda" "ext2" 2 314621952 838926335
create_disk_partition "/dev/dasda" "ext2" 3 838926336 7385333759
</code></pre>
<p>which could no longer be "just edited" by an admin<br />
unless he knows how those functions evaluate.</p>
<p>I think it is the main purpose of the generated diskrestore.sh script<br />
that when things do not "just work" an admin can relatively easily<br />
understand what actually goes on and change that as he needs<br />
to fix disk layout recreation issues during "rear recover",<br />
see in the section about "Restore to different hardware"<br />
"The Ad-Hoc Way" at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
therein in particular the line</p>
<pre><code>It’s simple bash code. Change it to use better values.
</code></pre>
<p>is now no longer true, it is no longer <code>simple bash code</code>.</p>
<p>See also in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<pre><code>Disaster recovery with Relax-and-Recover (ReaR)
...
if the worst comes to the worst - even temporary quick
and dirty workarounds are relatively easily possible.
</code></pre>
<h4 id="rmetrich_commented_at_2019-06-04_1251"><img src="https://avatars.githubusercontent.com/u/1163635?u=36b5e32e1dd55f1ce77cad431a5683fce40a7934&v=4" width="50"><a href="https://github.com/rmetrich">rmetrich</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-498658075">2019-06-04 12:51</a>:<a class="headerlink" href="#rmetrich_commented_at_2019-06-04_1251" title="Permanent link">&para;</a></h4>
<blockquote>
<p>There is a possibly severe issue/regression since this is merged:</p>
<p>Before there have been the explicit <code>parted</code> calls<br />
in the diskrestore.sh script so that in MIGATION_MODE<br />
one could edit them directly, for example</p>
<pre><code>parted -s /dev/dasda mklabel dasd &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda1'" 98304B 314621951B &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda2'" 314621952B 838926335B &gt;&amp;2
parted -s /dev/dasda mkpart "'dasda3'" 838926336B 7385198591B &gt;&amp;2
</code></pre>
<p>cf. <a href="https://github.com/rear/rear/pull/2142#issuecomment-495554406">#2142
(comment)</a></p>
<p>Since this is merged the explicit <code>parted</code> calls in diskrestore.sh<br />
are replaced by indirect function calls like in my case now</p>
<pre><code>create_disk_label /dev/dasda dasd
create_disk_partition "/dev/dasda" "ext2" 1 98304 314621951
create_disk_partition "/dev/dasda" "ext2" 2 314621952 838926335
create_disk_partition "/dev/dasda" "ext2" 3 838926336 7385333759
</code></pre>
<p>which could no longer be "just edited" by an admin<br />
unless he knows how those functions evaluate.</p>
<p>I think it is the main purpose of the generated diskrestore.sh
script<br />
that when things do not "just work" an admin can relatively easily<br />
understand what actually goes on and change that as he needs<br />
to fix disk layout recreation issues during "rear recover",<br />
see in the section about "Restore to different hardware"<br />
"The Ad-Hoc Way" at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
therein in particular the line</p>
<pre><code>It’s simple bash code. Change it to use better values.
</code></pre>
<p>is now no longer true, it is no longer <code>simple bash code</code>.</p>
<p>See also in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<pre><code>Disaster recovery with Relax-and-Recover (ReaR)
...
if the worst comes to the worst - even temporary quick
and dirty workarounds are relatively easily possible.
</code></pre>
</blockquote>
<p>The old <code>parted</code> directives can still be used by the user to recreate
his partitions, so there is no real regression here. Also the
<code>create_disk_partition</code> function has been documented to let the user
understand how it works.</p>
<h4 id="jsmeix_commented_at_2019-06-04_1403"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2081#issuecomment-498685526">2019-06-04 14:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-06-04_1403" title="Permanent link">&para;</a></h4>
<p>@rmetrich<br />
on my test system I did some enhancements that output comments<br />
with the actual <code>parted</code> calls in the diskrestore.sh script so the
user<br />
can see the real commands but I did not yet do a pull request for it...</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2026 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-03-12.2081.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
