<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2863 Issue closed: Add basic 'barrel' support to ReaR - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2863 Issue closed: Add basic \u0027barrel\u0027 support to ReaR";
        var mkdocs_page_input_path = "issues/2022-09-16.2863.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2863 Issue closed: Add basic 'barrel' support to ReaR</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2863_issue_closed_add_basic_barrel_support_to_rear"><a href="https://github.com/rear/rear/issues/2863">#2863 Issue</a> <code>closed</code>: Add basic 'barrel' support to ReaR<a class="headerlink" href="#2863_issue_closed_add_basic_barrel_support_to_rear" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>severe improvement</code></p>
<h4 id="jsmeix_opened_issue_at_2022-09-16_0902"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2863">2022-09-16 09:02</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2022-09-16_0902" title="Permanent link">&para;</a></h4>
<p>Barrel is a new command-line program for storage management<br />
in particular for a SUSE specific storage layout, see</p>
<p><a href="https://github.com/aschnell/barrel">https://github.com/aschnell/barrel</a></p>
<p>Barrel can save a whole storage layout (as a devicegraph) via</p>
<pre><code>barrel save devicegraph --name barrel-devicegraph.xml
</code></pre>
<p>into an XML file.</p>
<p>Barrel can (re)-create that whole storage layout<br />
from scratch on bare metal via</p>
<pre><code>barrel load devicegraph --name barrel-devicegraph.xml --mapping barrel-mapping.json
</code></pre>
<p>with device mapping as needed<br />
(e.g. when the disks on the new machine are different<br />
compared to where "barrel save devicegraph" was run).</p>
<p>The crucial advantage when ReaR uses barrel is that<br />
then ReaR uses SUSE's own tool to store and<br />
recreate the SUSE specific storage layout<br />
(in particular the SUSE specific btrfs structure)<br />
instead of how it is currently done<br />
where ReaR uses its own implementation<br />
to store and recreate the storage layout<br />
(because before barrel there was no SUSE tool<br />
to store and recreate a SUSE specific storage layout),<br />
cf. the section<br />
"The limitation is what the special ReaR recovery system can do"<br />
in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
that reads (excerpt):</p>
<pre><code>The ReaR recovery system with the ReaR installer
is totally different compared to the installation system
on an openSUSE or SUSE Linux Enterprise install medium
with the YaST installer and AutoYaST.
This means when ReaR is used to recover your system,
a totally different installer recreates your system.
Therefore when the initial installation of
the basic operating system from an openSUSE
or SUSE Linux Enterprise install medium had worked,
the special ReaR recovery system may not work
in your particular case or it may work
but recreate your system with some
(possibly subtle but severe) differences.
</code></pre>
<p>Barrel is available for SLES15-SP4<br />
so basic 'barrel' support in ReaR will be implemented<br />
for SLES15-SP4 and later.</p>
<p>FYI:<br />
Its name is 'barrel' because it even supports<br />
"shooting yourself in the foot" when used without care ;-)</p>
<h4 id="jsmeix_commented_at_2022-10-05_1204"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2863#issuecomment-1268347241">2022-10-05 12:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-05_1204" title="Permanent link">&para;</a></h4>
<p>Additional basic 'barrel' support increases<br />
the ReaR recovery system ISO image size by 2.45 MiB<br />
(from 77.92 MiB to 80.37 MiB)<br />
and the ReaR recovery system size (i.e. what is<br />
in /var/tmp/rear.XXXX/rootfs/ ) by 6.72 MiB<br />
(from 164.97 MiB to 171.69 MiB)<br />
on my test system: SLES15 SP4 KVM/QEMU VM<br />
with the default SUSE storage structure, cf.<br />
<a href="https://github.com/rear/rear/pull/2876#issue-1395991143">https://github.com/rear/rear/pull/2876#issue-1395991143</a><br />
with a rather minimal ReaR recovery system via</p>
<pre><code>FIRMWARE_FILES=( 'no' )
MODULES=( 'loaded_modules' )
</code></pre>
<p>but the ReaR recovery system increase because of what<br />
is needed by 'barrel' should not depend on firmware files<br />
or kernel modules.</p>
<h4 id="jsmeix_commented_at_2022-10-13_1321"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2863#issuecomment-1277603662">2022-10-13 13:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-13_1321" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2876">https://github.com/rear/rear/pull/2876</a>
merged<br />
this particular issue is done so far.</p>
<p>What is currently known to be not yet done:</p>
<p>Current 'barrel' device mapping must be done manually via</p>
<pre><code>BARREL_MAPPING_FILE="/etc/barrel-mapping.json"
COPY_AS_IS+=( $BARREL_MAPPING_FILE )
</code></pre>
<p>in etc/rear/local.conf with an appropriate manually created<br />
/etc/barrel-mapping.json file with content for example like</p>
<pre><code>{
    "mapping" : {
        "/dev/sda" : "/dev/disk/by-id/ata-QEMU_HARDDISK_QM00001"
    }
}
</code></pre>
<p>which works for me for my KVM/QEMU test VMs because<br />
all my VMs have /dev/disk/by-id/ata-QEMU_HARDDISK_QM00001<br />
as a symbolic link that points to ../../sda</p>
<p>Currently undocumented config variables about 'barrel' support.<br />
I cannot know now what the right way will be so I don't want<br />
to have them "officially documented" in default.conf until I got<br />
a better gut feeling how things should be in practice.</p>
<p>The currently function <code>lsblk_output()</code><br />
is currently intentionally a local function<br />
in layout/recreate/default/200_run_layout_code.sh<br />
regardless of the other places where lsblk output is shown.<br />
This will be cleaned up later via a separated pull request, cf.<br />
<a href="https://github.com/rear/rear/pull/2876#discussion_r994438204">https://github.com/rear/rear/pull/2876#discussion_r994438204</a></p>
<p>There is no problem handling when DISKS_TO_BE_WIPED<br />
is set to an empty string in the 'else' clause in<br />
layout/recreate/default/120_confirm_wipedisk_disks.sh<br />
i.e. when the default DISKS_TO_BE_WIPED="" in default.conf<br />
is used and the <code>create_disk_label</code> function is not called<br />
for any disk in diskrestore.sh which is is normally<br />
an error case where the empty DISKS_TO_BE_WIPED<br />
is a symptom but not the cause of the problem, cf.<br />
<a href="https://github.com/rear/rear/pull/2876#discussion_r994446525">https://github.com/rear/rear/pull/2876#discussion_r994446525</a></p>
<p>Currently it does not work to run diskrestore.sh<br />
then "Again wipe the disks in DISKS_TO_BE_WIPED"<br />
and then re-run diskrestore.sh<br />
because the second run of diskrestore.sh does nothing<br />
because all is marked as already done by the first run<br />
or more precisely: The second run of diskrestore.sh<br />
does not start from the beginning but skips what was<br />
already done by the first run but when the disks got wiped<br />
there is nothing left what was done by the first run.<br />
The reason why things get marked as done and skipped can be seen<br />
how it is meant to behave in the section "The Ad-Hoc Way" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
so one can modify diskrestore.sh step by step and re-run it<br />
and it only does the not yet done things, cf.<br />
<a href="https://github.com/rear/rear/pull/2876#issuecomment-1277148093">https://github.com/rear/rear/pull/2876#issuecomment-1277148093</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-09-16.2863.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
