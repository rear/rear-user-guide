<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2310 Issue closed: Changing IP-addresses via mappings/ip_addresses does not work - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2310 Issue closed: Changing IP-addresses via mappings/ip_addresses does not work";
        var mkdocs_page_input_path = "issues/2020-01-14.2310.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2310 Issue closed: Changing IP-addresses via mappings/ip_addresses does not work</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2310_issue_closed_changing_ip-addresses_via_mappingsip_addresses_does_not_work"><a href="https://github.com/rear/rear/issues/2310">#2310 Issue</a> <code>closed</code>: Changing IP-addresses via mappings/ip_addresses does not work<a class="headerlink" href="#2310_issue_closed_changing_ip-addresses_via_mappingsip_addresses_does_not_work" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>cleanup</code>, <code>waiting for info</code>,
<code>needs sponsorship</code>, <code>no-issue-activity</code></p>
<h4 id="tumbajamba_opened_issue_at_2020-01-14_1532"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> opened issue at <a href="https://github.com/rear/rear/issues/2310">2020-01-14 15:32</a>:<a class="headerlink" href="#tumbajamba_opened_issue_at_2020-01-14_1532" title="Permanent link">&para;</a></h4>
<p>Hello dear Devs ;-)</p>
<p>I would like to report a bug(at least it looks like a bug to me) and
hopefully contribute to the project and help you guys to make your great
project even more polished and stable.</p>
<p><strong>Description:</strong><br />
Netmask suffix E.g. /24 or /16 are ignored when you define them in
ip_addresses file on SLES15 SP01 System. After restore the system ends
up with ip-configuration like this: <code>192.168.20.192/32</code>.</p>
<p><strong>Steps to reproduce:</strong><br />
defining ip-addresses in the rescue-system before restore:</p>
<pre><code>vi /etc/rear/mappings/ip_addresses
eth0 192.168.20.192/24
eth1 192.168.21.192/24
eth2 172.20.20.192/16
</code></pre>
<p>After restoring my network config files look like this</p>
<pre><code>cat /etc/sysconfig/network/ifcfg-eth0
BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.20.192'
MTU=''
NAME='Virtual Ethernet card 1'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
</code></pre>
<p>As one can see the netmask value /24 or /16 is ignored/missing.</p>
<p>This is how the config file should look like(note /24 suffix):</p>
<pre><code>BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.20.192/24'
MTU=''
NAME='Virtual Ethernet card 1'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
</code></pre>
<p>Would you kindly check and fix the issue.</p>
<p><strong>Additional info:</strong></p>
<ul>
<li>Rear Version: Relax-and-Recover 2.5-git.0.ef3febb.unknown.changed /
    2019-07-04</li>
<li>System architecture: PPC64LE -&gt; Power9 CPU</li>
<li>Bootloader: GRUB</li>
<li>Hardware: IBM E950 (PowerVM LPAR)</li>
<li>OS version: SUSE Linux Enterprise Server 15 SP1</li>
</ul>
<p>Thank you so much in advance!</p>
<h4 id="jsmeix_commented_at_2020-01-15_0918"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574568493">2020-01-15 09:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_0918" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
thank you for your report!</p>
<p>I am not a real networking expert but I think the root cause could be
in<br />
usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
therein the code parts that are related to</p>
<pre><code># change the ip addresses in the configuration files if a mapping is available
</code></pre>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L78">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L78</a><br />
which contains in particular</p>
<pre><code># TODO: what if NETMASK keyword is not defined?
</code></pre>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L95">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L95</a><br />
where that code originates from<br />
<a href="https://github.com/rear/rear/commit/8472c46b31de2b748a6f948325101a970c452e61">https://github.com/rear/rear/commit/8472c46b31de2b748a6f948325101a970c452e61</a></p>
<p>As far as I understand that code part</p>
<pre><code>        # RHEL 4, 5,... cannot handle IPADDR="x.x.x.x/cidr"
        nmask=$(prefix2netmask ${new_ip#*/})    # ipaddress/cidr (recalculate the cidr)
        if [[ "$nmask" = "0.0.0.0" ]]; then
            nmask=""
            nip="$new_ip"           # keep ipaddress/cidr
        else
            nip="${new_ip%%/*}"     # only keep ipaddress
        fi

        # Fedora/Suse Family
        for network_file in $TARGET_FS_ROOT/etc/sysconfig/*/ifcfg-*${new_mac}* $TARGET_FS_ROOT/etc/sysconfig/*/ifcfg-*${dev}*; do
            # TODO: what if NETMASK keyword is not defined? Should be keep new_ip then??
            sed_script="s#^IPADDR=.*#IPADDR='${nip}'#g;s#^NETMASK=.*#NETMASK='${nmask}'#g;s#^NETWORK=.*#NETWORK=''#g;s#^BROADCAST=.*#BROADCAST=''#g;s#^BOOTPROTO=.*#BOOTPROTO='static'#g
;s#STARTMODE='[mo].*#STARTMODE='auto'#g;/^IPADDR_/d;/^LABEL_/d;/^NETMASK_/d"
</code></pre>
<p>I think</p>
<pre><code>nmask=$(prefix2netmask ${new_ip#*/})
</code></pre>
<p>results <code>nmask=255.255.255.0</code> for <code>new_ip=192.168.20.192/24</code><br />
according to what is described for the prefix2netmask function<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/network-functions.sh#L85">https://github.com/rear/rear/blob/master/usr/share/rear/lib/network-functions.sh#L85</a><br />
and then (because `"$nmask" = "0.0.0.0" is false)</p>
<pre><code>nip="${new_ip%%/*}"
</code></pre>
<p>results <code>nip=192.168.20.192</code><br />
but because in /etc/sysconfig/network/ifcfg-eth0<br />
the NETMASK keyword is not defined<br />
the sed_script replaces the IPADDR only with the<br />
plain new IP <code>192.168.20.192</code> without the <code>/24</code> CIDR suffix.</p>
<p>Accordingly I think what needs to be done is to implement the</p>
<pre><code># TODO: what if NETMASK keyword is not defined?
</code></pre>
<p>part in
finalize/GNU/Linux/320_migrate_network_configuration_files.sh</p>
<h4 id="jsmeix_commented_at_2020-01-15_0921"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574569537">2020-01-15 09:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_0921" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
to verify if my assumptions in my above<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574568493">https://github.com/rear/rear/issues/2310#issuecomment-574568493</a><br />
are true in your case I would need your "rear -D recover" debug log
file,<br />
cf. "Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
so that I could see what actually happens in your case while<br />
finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
is run on your particular system.</p>
<h4 id="tumbajamba_commented_at_2020-01-15_0933"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574574326">2020-01-15 09:33</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_0933" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
<a href="https://github.com/rear/rear/files/4064063/rear-lin0001.log">rear-lin0001.log</a><br />
Here we are! Thx for the quick response and reaction!<br />
Please let me know what was the root cause of the issue.</p>
<h4 id="jsmeix_commented_at_2020-01-15_0933"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574574414">2020-01-15 09:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_0933" title="Permanent link">&para;</a></h4>
<p>Ugh!<br />
It seems there is much more TODO in this area to get things working<br />
sufficiently well with nowadays network ifcfg file syntax because<br />
on my SLES15-like openSUSE Leap 15.0 system<br />
/etc/sysconfig/network/ifcfg.template<br />
shows in particular</p>
<pre><code>## Type:    string
## Default: ""
#
# If using a static configuration you have to set an IP address and a netmask
# or prefix length. The following examples are equivalent:
#
# 1) IPADDR=192.168.1.1/24     # NETMASK and PREFIXLEN will be ignored
# 2) IPADDR=192.168.1.1
#    PREFIXLEN=24              # NETMASK will be ignored
# 3) IPADDR=192.168.1.1
#    NETMASK=255.255.255.0
#
# For multiple addresses use this variable multiple times and extend them with
# different suffixes. For example IPADDR_1=, IPADDR_2=. See section 'Multiple
# addresses' in manpage ifcfg).
#
IPADDR=

## Type:    string
## Default: ""
#
# Set the network mask for the ip address. This variable will be ignored if a
# prefixlength is set in variable PREFIXLEN in IPADDR.
# For multiple addresses use the same suffixes as with IPADDR.
#
# Note: Deprecated IPv4 only variable.
#
NETMASK=

## Type:    integer(0,64)
## Default: ""
#
# Set the prefixlength of the ip address. This variable will be ignored if a
# prefixlength is set in variable IPADDR.
# For multiple addresses use the same suffixes as with IPADDR.
#
PREFIXLEN=
</code></pre>
<p>so we would have to add supprt for all combinations of<br />
IPADDR, NETMASK, PREFIXLEN ...</p>
<h4 id="tumbajamba_commented_at_2020-01-15_0940"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574577209">2020-01-15 09:40</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_0940" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
To make things complete I would like to suggest you implement the
function for changing the hostname of the target machine just like:</p>
<pre><code>vi /etc/rear/mappings/hostname
new-server-name
</code></pre>
<p>That is a pretty cool step for the deployment of new machines based on
REAR.</p>
<p>Regards<br />
Vadim</p>
<h4 id="jsmeix_commented_at_2020-01-15_1007"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574588463">2020-01-15 10:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_1007" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
what "function for changing the hostname of the target machine" do you
mean?</p>
<p>I do not find the string <code>hostname</code> in any usr/share/rear/finalize file</p>
<pre><code># find usr/share/rear/finalize/ -type f | xargs grep -i 'hostname'
</code></pre>
<p>results no output for me so I assume there is currently no<br />
"function for changing the hostname of the target machine"<br />
in ReaR?</p>
<h4 id="tumbajamba_commented_at_2020-01-15_1018"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574592858">2020-01-15 10:18</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_1018" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Hahaha I'm sorry for confusing you ;-) It was an idea btw. suggestion
for a new feature "changing hostname for target machine". Since you've
already implemented features like:</p>
<pre><code>mappings/ip_addresses
mappings/routes
.....
</code></pre>
<p>So it would just make sense to implement a function:<br />
<code>mappings/hostname</code></p>
<p>Which would complete the processes of deploying a new server out of the
existing machine based on REAR-Software.</p>
<p>It doesn't have anything to do with the current bug-ticket.</p>
<p>Regards<br />
Vadim</p>
<h4 id="jsmeix_commented_at_2020-01-15_1025"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574595709">2020-01-15 10:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_1025" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
your
<a href="https://github.com/rear/rear/files/4064063/rear-lin0001.log">https://github.com/rear/rear/files/4064063/rear-lin0001.log</a><br />
contains only</p>
<pre><code>  11201 + source /usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh
  11202 ++ PATCH_FILES=($TARGET_FS_ROOT/etc/sysconfig/*/ifcfg-* $TARGET_FS_ROOT/etc/network/inter[f]aces $TARGET_FS_ROOT/etc/network/interfaces.d/*)
  11203 ++ test /mnt/local/etc/sysconfig/network/ifcfg-eth0
  11204 ++ mkdir -v -p /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings
  11205 mkdir: created directory '/tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings'
  11206 ++ for mapping_file in mac ip_addresses routes
  11207 ++ read_and_strip_file /etc/rear/mappings/mac
  11208 ++ local filename=/etc/rear/mappings/mac
  11209 ++ test -s /etc/rear/mappings/mac
  11210 ++ return 1
  11211 ++ for mapping_file in mac ip_addresses routes
  11212 ++ read_and_strip_file /etc/rear/mappings/ip_addresses
  11213 ++ local filename=/etc/rear/mappings/ip_addresses
  11214 ++ test -s /etc/rear/mappings/ip_addresses
  11215 ++ return 1
  11216 ++ for mapping_file in mac ip_addresses routes
  11217 ++ read_and_strip_file /etc/rear/mappings/routes
  11218 ++ local filename=/etc/rear/mappings/routes
  11219 ++ test -s /etc/rear/mappings/routes
  11220 ++ return 1
  11221 ++ LogPrint 'Migrating network configuration files according to the mapping files ...'
  11222 ++ Log 'Migrating network configuration files according to the mapping files ...'
  11223 ++ echo '2020-01-02 11:20:22.238963962 Migrating network configuration files according to the mapping files ...'
  11224 2020-01-02 11:20:22.238963962 Migrating network configuration files according to the mapping files ...
  11225 ++ Print 'Migrating network configuration files according to the mapping files ...'
  11226 ++ test -s /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings/mac
  11227 ++ test -s /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings/mac
  11228 +++ cut -f 1 -d ' ' /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings/ip_addresses
  11229 ++ test -s /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings/ip_addresses
  11230 ++ test -s /tmp/rear.40WhjaLs5wTQ7Q2/tmp/mappings/routes
  11231 + source_return_code=0
</code></pre>
<p>which shows that
finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
does not actually change any file.<br />
The <code>return 1</code> lines come from the read_and_strip_file function<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/global-functions.sh#L11">https://github.com/rear/rear/blob/master/usr/share/rear/lib/global-functions.sh#L11</a><br />
and show that there is none of the mapping files</p>
<pre><code>/etc/rear/mappings/mac
/etc/rear/mappings/ip_addresses
/etc/rear/mappings/routes
</code></pre>
<p>in the ReaR recovery system where "rear recover" is running<br />
which contradicts your initial description where you wrote<br />
that you have /etc/rear/mappings/ip_addresses<br />
in your ReaR recovery system:</p>
<pre><code>defining ip-addresses in the rescue-system before restore:

vi /etc/rear/mappings/ip_addresses
eth0 192.168.20.192/24
eth1 192.168.21.192/24
eth2 172.20.20.192/16
</code></pre>
<h4 id="tumbajamba_commented_at_2020-01-15_1033"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574599152">2020-01-15 10:33</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_1033" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I'm going to double-check this and make another restore attempt with a
new log file.</p>
<p>Aghhh! You right, I recovered the LPAR again without ip_addresses just
before I went home yesterday! I'll generate another log</p>
<h4 id="tumbajamba_commented_at_2020-01-15_1106"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574611530">2020-01-15 11:06</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_1106" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Ok got it! here is the proper log-file:<br />
<a href="https://github.com/rear/rear/files/4064573/rear-lin0002.log">rear-lin0002.log</a></p>
<p>And I think your assumption about the root cause was correct!</p>
<h4 id="jsmeix_commented_at_2020-01-15_1313"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574654142">2020-01-15 13:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_1313" title="Permanent link">&para;</a></h4>
<p>So I will finally have to bite the bullet and cleanup and enhance<br />
finalize/GNU/Linux/320_migrate_network_configuration_files.sh</p>
<p>I had tried to avoid that because its code is "too obsure for me", cf.<br />
<a href="https://github.com/rear/rear/commit/d4ee9de5dfd2d4ebdac74b6d496f38518cf63491">https://github.com/rear/rear/commit/d4ee9de5dfd2d4ebdac74b6d496f38518cf63491</a></p>
<h4 id="tumbajamba_commented_at_2020-01-15_1331"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574660330">2020-01-15 13:31</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-15_1331" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Well, thx a lot.<br />
Viel Erfolg!</p>
<p>Regards<br />
Vadim</p>
<h4 id="jsmeix_commented_at_2020-01-15_1609"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-574730970">2020-01-15 16:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-15_1609" title="Permanent link">&para;</a></h4>
<p>Currently
<a href="https://github.com/rear/rear/pull/2313">https://github.com/rear/rear/pull/2313</a><br />
is just an initial incomplete "submit early submit often" part of
today<br />
so that you could have an early look at what I am doing<br />
(perhaps you notice already issues by plain looking at my changes,<br />
in particular my comments describe what I think what the code does)<br />
of a general cleanup as a first step which I do primarily<br />
to get some basic understanding of the code.<br />
There is not yet any actual enhancement (that will be the second step).</p>
<h4 id="tumbajamba_commented_at_2020-01-16_0615"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-575001163">2020-01-16 06:15</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-01-16_0615" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
It sounds good that you've already started to polish and comment the
code, keep updates coming.</p>
<p>As far as I understand there are several ways of defining netmask on
SLES/SUSE 15 in <code>/etc/sysconfig/network/ifcfg-*</code>.</p>
<p>Are you going to process them depending on syntax in initial(source)
config files found in source system?</p>
<p>like this:</p>
<pre><code>IF source                            THEN target

1) NETMASK=255.255.255.0             NETMASK=255.255.255.0
2) IPADDR=192.168.1.1/24             IPADDR=192.168.1.2/24 
3) PREFIXLEN=24                      PREFIXLEN=24
</code></pre>
<p>According to <code>/etc/sysconfig/network/ifcfg.template</code> the parameter
<code>NETMASK=</code> is deprecated:</p>
<pre><code>## Type:    string
## Default: ""
#
# Set the network mask for the ip address. This variable will be ignored if a
# prefixlength is set in variable PREFIXLEN in IPADDR.
# For multiple addresses use the same suffixes as with IPADDR.
#
# Note: Deprecated IPv4 only variable.
#
NETMASK=
</code></pre>
<p>So it might be a good idea to always use 192.168.1.2/24 notation since
it seems to be compatible with standard yast syntax and according to
<code>ifcfg.template</code> is the most "dominant" solution which overwrites all
other options. In this case other netmask entries(<code>PREFIXLEN,NETMASK</code>)
should be removed from the config file.</p>
<h4 id="jsmeix_commented_at_2020-01-16_0836"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-575043164">2020-01-16 08:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-01-16_0836" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
because
finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
works on the user's restored files of his target system in /mnt/local<br />
what it does must match what there is on the user's target system.</p>
<p>E.g. when the user has</p>
<pre><code>IPADDR=192.168.1.1
NETMASK=255.255.255.0
</code></pre>
<p>cf. example <code>3)</code> in the /etc/sysconfig/network/ifcfg.template excerpt<br />
in
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574574414">https://github.com/rear/rear/issues/2310#issuecomment-574574414</a><br />
then finalize/GNU/Linux/320_migrate_network_configuration_files.sh<br />
needs to adapt that existing syntax only to the new values.</p>
<p>It is already somewhat scaring that during "rear recover" finalize
stage<br />
some of the user's (normally sacrosanct) config files from<br />
his restored backup get "just modified" in an automated<br />
(and mostly silent) way by ReaR without an explicit confirmation<br />
from the user that he wants ReaR to do that.</p>
<p>I will never ever implement automated modification by ReaR<br />
of the used syntax (or even semantics) in user's own files.</p>
<p>Regarding<br />
<a href="https://github.com/rear/rear/issues/2312">https://github.com/rear/rear/issues/2312</a><br />
I have some first ideas how to provide generic functionality in ReaR<br />
so that the user can manually and explicitly specify the exact things<br />
that he needs to be done during "rear recover" finalize stage how<br />
to adapt and modify his own restored files in his (re)-created<br />
target system.<br />
This follows my general <code>final power to the user</code> principle,<br />
cf. things like<br />
<a href="https://github.com/rear/rear/pull/2283#pullrequestreview-322105398">https://github.com/rear/rear/pull/2283#pullrequestreview-322105398</a><br />
that reads (excerpt):</p>
<pre><code>Because I want "final power to the user"
it is mandatory for me that there are basically
no hardcoded "decisions" in ReaR.

Instead there must be for basically all and everything
a config variable (exceptions are common "hardcoded"
values like etc/fstab) so that the user can - if needed -
specify what he wants and then ReaR has to obey
which means ReaR must error out when the user
specified something plain wrong or impossible.

Usually config variables should be empty by default
which means by default ReaR will try its automated things
or ... config variables have a reasonable default value
when there is no automatism implemented.
</code></pre>
<p>or<br />
<a href="https://github.com/rear/rear/issues/2010">https://github.com/rear/rear/issues/2010</a><br />
and some more...</p>
<h4 id="jsmeix_commented_at_2020-03-02_1320"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-593398054">2020-03-02 13:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-02_1320" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
I think your initial issue here should now be fixed (hopefully), see<br />
<a href="https://github.com/rear/rear/pull/2313#issuecomment-593397109">https://github.com/rear/rear/pull/2313#issuecomment-593397109</a><br />
and I would appreciate it if you could test it.</p>
<h4 id="tumbajamba_commented_at_2020-03-04_1042"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-594447901">2020-03-04 10:42</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-03-04_1042" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix,</p>
<p>I tested your script and found at least one bug.<br />
Let me explain:</p>
<p>I have 3 network interfaces in my server. The config of each looks like
this:</p>
<pre><code>/etc/sysconfig/network/ifcfg-eth0

BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.20.191/24'
MTU=''
NAME='Virtual Ethernet card 0'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'

/etc/sysconfig/network/ifcfg-eth1

BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.21.191'
NETMASK='255.255.255.0'
MTU=''
NAME='Virtual Ethernet card 1'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'



/etc/sysconfig/network/ifcfg-eth2

BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='172.20.20.191'
PREFIXLEN=16
MTU=''
NAME='Virtual Ethernet card 2'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
</code></pre>
<p>After a backup, I restored my SLES with the following
<strong>mappings/ip_addresses</strong> config:</p>
<pre><code>/etc/rear/mappings/ip_addresses

eth0 192.168.20.192/24
eth1 192.168.21.192/24
eth2 172.20.20.192/16
</code></pre>
<p>The result was like this:</p>
<pre><code>cat /etc/sysconfig/network/ifcfg-eth0
BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.20.191/24'
MTU=''
NAME='Virtual Ethernet card 0'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'

lin0000:~ # cat /etc/sysconfig/network/ifcfg-eth1
BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.21.191'
NETMASK='255.255.255.0'
MTU=''
NAME='Virtual Ethernet card 1'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'

lin0000:~ # cat /etc/sysconfig/network/ifcfg-eth2
BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='172.20.20.191'
PREFIXLEN=16
MTU=''
NAME='Virtual Ethernet card 2'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
</code></pre>
<p>The IP-Address from <strong>mappings/ip_addresses</strong> doesn't work, instead,
the new script is using original IP address which is a bit dangerous,
since it may cause IP address conflict in the network.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1420"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-594550800">2020-03-04 14:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1420" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
thank you so much for testing it!</p>
<p>I expected that you find issues and I need such testing and feedback<br />
to get to a point where things work OK (to some reasonable extent).</p>
<p>Could you attach here a <code>rear -D recover</code> debug log file<br />
so that I can see what exactly goes on on your system?</p>
<p>Regarding how to get a <code>rear -D recover</code> debug log file<br />
see the section "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="tumbajamba_commented_at_2020-03-04_1433"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-594559412">2020-03-04 14:33</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-03-04_1433" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
sure! Thx a lot!<br />
<a href="https://github.com/rear/rear/files/4287797/rear-lin0000.log">rear-lin0000.log</a></p>
<p>By the way, I found a misconfiguration on my end:</p>
<pre><code>cat /etc/sysconfig/network/ifcfg-eth1

BOOTPROTO='static'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR='192.168.21.191/24'
NETMASK='255.255.255.0'
MTU=''
NAME='Virtual Ethernet card 1'
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
</code></pre>
<p>This config contains two diffrent netmask notation: <strong>/24</strong> and
<strong>255.255.255.0</strong>, so ignore this issue if you find it in the log file,
its not a problem of your script.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1516"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-594591924">2020-03-04 15:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1516" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
in your case 320_migrate_network_configuration_files.sh<br />
does basically nothing so it seems the result in your case is still<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574595709">https://github.com/rear/rear/issues/2310#issuecomment-574595709</a></p>
<p>As far as I see it seems the root cause is<br />
that you do not have a <code>/etc/mappings/mac</code> file so<br />
320_migrate_network_configuration_files.sh does</p>
<pre><code>Using generated fallback $TMP_DIR/mappings/mac file (/etc/rear/mappings/mac is missing or has no content)
</code></pre>
<p>but that fallback seems to not work.</p>
<p>I thought a <code>/etc/mappings/mac</code> file gets automatically generated by<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
and/or by<br />
usr/share/rear/finalize/GNU/Linux/300_create_mac_mapping.sh<br />
so that usually a <code>/etc/mappings/mac</code> file should be there<br />
but it seems that code also does not work<br />
or I misunderstand how that whole stuff is meant to work.</p>
<p>Currently I am confused and I will need sufficient time<br />
to get that whole networking migration code<br />
somewhat sorted out...</p>
<h4 id="tumbajamba_commented_at_2020-03-05_0659"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-595060546">2020-03-05 06:59</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-03-05_0659" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
But wouldn't it be the easiest just to use IP-addresses from
<code>/etc/rear/mappings/ip_addresses</code> in case there is no
<code>/etc/mappings/mac</code> available or even use them always in general? Why
would you need the mac file if you just want to swap the IP-addresses?</p>
<h4 id="jsmeix_commented_at_2020-03-05_0916"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-595116017">2020-03-05 09:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-05_0916" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
I tried hard to not change how things work in ReaR<br />
so as a first step for now I only intended to<br />
"Cleanup and enhance 320_migrate_network_configuration_files.sh"<br />
via
<a href="https://github.com/rear/rear/pull/2313">https://github.com/rear/rear/pull/2313</a><br />
which is only a general cleanup as first step which I do primarily<br />
to get some basic understanding of the code, see<br />
<a href="https://github.com/rear/rear/pull/2313#issue-363216311">https://github.com/rear/rear/pull/2313#issue-363216311</a><br />
because "I am not a real networking expert" see<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574568493">https://github.com/rear/rear/issues/2310#issuecomment-574568493</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574654142">https://github.com/rear/rear/issues/2310#issuecomment-574654142</a></p>
<p>Anything more would have to happen via<br />
<a href="https://github.com/rear/rear/issues/2312">https://github.com/rear/rear/issues/2312</a><br />
where currently nothing at all is done.</p>
<p>I added "needs sponsorship" (i.e. I need substantial help) because
since<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-594591924">https://github.com/rear/rear/issues/2310#issuecomment-594591924</a><br />
it does no longer look as if I could do that alone in a reasonable way.</p>
<h4 id="tumbajamba_commented_at_2020-03-05_0919"><img src="https://avatars.githubusercontent.com/u/59883016?v=4" width="50"><a href="https://github.com/tumbajamba">tumbajamba</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-595117457">2020-03-05 09:19</a>:<a class="headerlink" href="#tumbajamba_commented_at_2020-03-05_0919" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Too bad we are not able to get it fixed. Hopefully, someone would fix it
someday. Thank you for your effort.</p>
<p>Regards,<br />
Vadim</p>
<h4 id="jsmeix_commented_at_2020-03-05_1021"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-595149640">2020-03-05 10:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-05_1021" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
no need to give up right now.<br />
I only meant that I alone won't be able to solve it in a reasonable
way.<br />
Therefore I asked for help and because of<br />
<a href="https://en.wikipedia.org/wiki/Linus%27s_law">https://en.wikipedia.org/wiki/Linus%27s_law</a><br />
there is hope that things might get solved even sooner than later.<br />
On the other hand ReaR upstream maintainers are often very busy<br />
with other tasks (those stuff what primarily makes their salary)<br />
so solving things might get delayed for a long time, e.g. cf.<br />
<a href="https://github.com/rear/rear/issues/799#issuecomment-531247109">https://github.com/rear/rear/issues/799#issuecomment-531247109</a></p>
<p>In general ReaR is first and foremost meant to recreate<br />
a system as much as possible exactly as it was before, cf.<br />
"Goal: Recreate a destroyed system" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
and in most cases ReaR is used in this way.</p>
<p>Changing the system via "rear recover" is what we call "migration"<br />
and that is not done so often so that it is neither as well tested<br />
nor as well supported as the "recreating exactly as before" case.<br />
E.g. ReaR does not fully support to migrate the bootloader, cf.<br />
<a href="https://github.com/rear/rear/issues/1437">https://github.com/rear/rear/issues/1437</a></p>
<p>For example personally I only use DHCP when testing ReaR<br />
because it is not so easy for me to get some fixed IP addresses<br />
that I could use in my network (i.e. in SUSE's network)<br />
for testing IP address migration with ReaR and in general<br />
networking stuff is not so much on my personal agenda.</p>
<p>As far as I can imagine the current workaround to migrate<br />
the networking setup on the recreated tartget system is<br />
to do that manually after "rear recover" had finished<br />
but still from inside the running ReaR recovery system<br />
by manually adapting the restored network config files<br />
of the recreated tartget system in <code>/mnt/local/etc/...</code><br />
or by <code>chroot /mnt/local</code> to manually adapt the networking<br />
setup inside the recreated tartget system while still the kernel<br />
and the networking setup of the ReaR recovery system is used.<br />
To avoid that the networking setup of the ReaR recovery system is<br />
using the IP address of the original system you may use DHCP<br />
in the ReaR recovery system or setup networking of the ReaR<br />
recovery system manually, cf. in "man rear" the section<br />
"RESCUE IMAGE KERNEL COMMAND LINE OPTIONS"<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear.8.adoc">https://github.com/rear/rear/blob/master/doc/rear.8.adoc</a><br />
and config variables like <code>USE_DHCLIENT</code> <code>USE_RESOLV_CONF</code><br />
<code>NETWORKING_PREPARATION_COMMANDS</code> in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf</a></p>
<p>From my personal perception "system migration with ReaR"<br />
is more and more asked for by ReaR users.<br />
In particular migration from one kind of hardware to another<br />
kind of hardware and here mainly migration from physical<br />
hardware to virtual hardware i.e. "P2V"<br />
<a href="https://en.wikipedia.org/wiki/Physical-to-Virtual">https://en.wikipedia.org/wiki/Physical-to-Virtual</a><br />
but that also does not "just work" with ReaR, cf.<br />
<a href="http://lists.relax-and-recover.org/pipermail/rear-users/2018-November/003626.html">http://lists.relax-and-recover.org/pipermail/rear-users/2018-November/003626.html</a></p>
<p>@tumbajamba<br />
when you have a sufficient SLE15-HA contract with SUSE, cf.<br />
"SUSE support for Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
it might help to speed up things when you submit<br />
a feature request to SUSE to get something like<br />
<a href="https://github.com/rear/rear/issues/2312">https://github.com/rear/rear/issues/2312</a><br />
implemented. The drwaback in this case is that usually<br />
it is me alone who has to do basically all and everything<br />
for ReaR at SUSE so we could be back in the exact same<br />
situation as now...</p>
<h4 id="jsmeix_commented_at_2020-03-13_1339"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-598724857">2020-03-13 13:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-13_1339" title="Permanent link">&para;</a></h4>
<p>@tumbajamba<br />
I merged the new 320_migrate_network_configuration_files.sh via<br />
<a href="https://github.com/rear/rear/commit/78d7a519b4700c828544df00763a90886e0847a6">https://github.com/rear/rear/commit/78d7a519b4700c828544df00763a90886e0847a6</a><br />
so the new one is now available at<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh">https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh</a></p>
<p>It contains now in particular a recent fix that @yontalcar found<br />
<a href="https://github.com/rear/rear/pull/2313/commits/9277ff22b623a491556cb560b1bcd3d3172475be">https://github.com/rear/rear/pull/2313/commits/9277ff22b623a491556cb560b1bcd3d3172475be</a></p>
<p>The fix is in the code that generates a new <code>mappings/mac</code> file<br />
as fallback when there is none (as in your case) see<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L198">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/GNU/Linux/320_migrate_network_configuration_files.sh#L198</a><br />
and subsequent lines.</p>
<p>So perhaps that fix might even help in your case<br />
so you may try out again how far it works for you.</p>
<h4 id="jsmeix_commented_at_2020-04-16_1343"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-614661284">2020-04-16 13:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-16_1343" title="Permanent link">&para;</a></h4>
<p>Only an offhanded unverified idea of a possible reason<br />
why there is none of the mapping files</p>
<pre><code>/etc/rear/mappings/mac
/etc/rear/mappings/ip_addresses
/etc/rear/mappings/routes
</code></pre>
<p>in the recovery system when "rear recover" is running its
<code>finalize</code>stage<br />
regardless that the user had a /etc/rear/mappings/ip_addresses file<br />
in his recovery system, cf.<br />
<a href="https://github.com/rear/rear/issues/2310#issuecomment-574595709">https://github.com/rear/rear/issues/2310#issuecomment-574595709</a></p>
<p>In<br />
skel/default/etc/scripts/system-setup.d/55-migrate-network-devices.sh<br />
there is this code (excerpts):</p>
<pre><code>MAC_MAPPING_FILE=/etc/rear/mappings/mac
...
# Temporary rear_mappings_mac used when interfaces have been renamed
tmp_mac_mapping_file=$(mktemp)
...
# A later script in finalize/* will also go over the MAC mappings file and
# apply them to the files in the recovered system, unless we did the mapping
# automatically, which means some device has been renamed and will probably
# gets its name back upon reboot.
if [ -s $tmp_mac_mapping_file ] ; then
    rm $MAC_MAPPING_FILE $tmp_mac_mapping_file
fi
</code></pre>
<p>so it seems at least /etc/rear/mappings/mac can get deleted<br />
during recovery system startup phase under some conditions.<br />
But I do not understand what the comment tries to tell<br />
why /etc/rear/mappings/mac must be deleted.</p>
<p>@rmetrich<br />
as far as I see it seems the code that deletes /etc/rear/mappings/mac<br />
was added by you via<br />
<a href="https://github.com/rear/rear/commit/37dbb032c134f5f9777cb733d53024a3fb960cad">https://github.com/rear/rear/commit/37dbb032c134f5f9777cb733d53024a3fb960cad</a></p>
<p>Could you have a look here?</p>
<p>Perhaps /etc/rear/mappings/mac is deleted too often here?</p>
<p>Perhaps the current autometed network migration in the recovery system<br />
conflicts with user intended network migration of the recreated system<br />
via user provided network migration files like /etc/rear/mappings/mac ?</p>
<p>This are only offhanded unverified ideas so I could be plain wrong.</p>
<h4 id="github-actions_commented_at_2020-06-29_0137"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2310#issuecomment-650857735">2020-06-29 01:37</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-29_0137" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-01-14.2310.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
