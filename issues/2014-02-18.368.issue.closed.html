<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#368 Issue closed: Does REAR support DRBD on LVM? - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#368 Issue closed: Does REAR support DRBD on LVM?";
        var mkdocs_page_input_path = "issues/2014-02-18.368.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#368 Issue closed: Does REAR support DRBD on LVM?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="368_issue_closed_does_rear_support_drbd_on_lvm"><a href="https://github.com/rear/rear/issues/368">#368 Issue</a> <code>closed</code>: Does REAR support DRBD on LVM?<a class="headerlink" href="#368_issue_closed_does_rear_support_drbd_on_lvm" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="dragon299_opened_issue_at_2014-02-18_1408"><img src="https://avatars.githubusercontent.com/u/2734035?v=4" width="50"><a href="https://github.com/dragon299">dragon299</a> opened issue at <a href="https://github.com/rear/rear/issues/368">2014-02-18 14:08</a>:<a class="headerlink" href="#dragon299_opened_issue_at_2014-02-18_1408" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>I am currently try to find out, if REAR does support DRBD on LVM volume.
I know that LVM on DRBD works perfectly but I never tried the other way
around.</p>
<p>Is there someone who already tried this?</p>
<p>Thank you.</p>
<h4 id="jhoekx_commented_at_2014-02-18_1418"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-35387775">2014-02-18 14:18</a>:<a class="headerlink" href="#jhoekx_commented_at_2014-02-18_1418" title="Permanent link">&para;</a></h4>
<p>We implemented and tested it in both ways a few years ago. It should
work...</p>
<h4 id="dragon299_commented_at_2014-02-18_1508"><img src="https://avatars.githubusercontent.com/u/2734035?v=4" width="50"><a href="https://github.com/dragon299">dragon299</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-35393006">2014-02-18 15:08</a>:<a class="headerlink" href="#dragon299_commented_at_2014-02-18_1508" title="Permanent link">&para;</a></h4>
<p>I tried it now with a very special (maybe stupid) configuration (LVM on
DRBD on LVM) and I got the following "error":</p>
<p>Disk configuration is identical, proceeding with restore.<br />
No code has been generated to restore device pv:/dev/drbd0 (lvmdev).<br />
Please add code to /var/lib/rear/layout/diskrestore.sh to manually
install it or choose abort.</p>
<h4 id="bbeaver_commented_at_2014-08-09_1850"><img src="https://avatars.githubusercontent.com/u/7350825?u=2ec61633eda874b17db7b1eb383363444e6064d6&v=4" width="50"><a href="https://github.com/bbeaver">bbeaver</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-51695200">2014-08-09 18:50</a>:<a class="headerlink" href="#bbeaver_commented_at_2014-08-09_1850" title="Permanent link">&para;</a></h4>
<p>Any updates or solutions for this yet? I've run into the same issue.
While testing a Rear recover of a system which includes a DRBD device on
an LVM volume, received this error:</p>
<p>No code has been generated to restore device /dev/drbd0 (drbd). Please
add code to /var/lib/rear/layout/diskrestore.sh to manually install it
or choose abort.</p>
<p>My local.conf looks like this:</p>
<p>OUTPUT=ISO<br />
BACKUP=NETFS<br />
BACKUP_OPTIONS="nfsvers=3,nolock"<br />
BACKUP_URL="nfs://x.x.x.x/nfs01/"<br />
BACKUP_TYPE=incremental<br />
FULLBACKUPDAY="Mon"</p>
<p>Thanks</p>
<h4 id="gdha_commented_at_2014-08-11_1419"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-51786001">2014-08-11 14:19</a>:<a class="headerlink" href="#gdha_commented_at_2014-08-11_1419" title="Permanent link">&para;</a></h4>
<p>@bbeaver Personally I don not have experience with DRBD. If you could
run savelayout in debug mode that would be a nice start.</p>
<h4 id="bbeaver_commented_at_2014-08-11_1838"><img src="https://avatars.githubusercontent.com/u/7350825?u=2ec61633eda874b17db7b1eb383363444e6064d6&v=4" width="50"><a href="https://github.com/bbeaver">bbeaver</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-51821750">2014-08-11 18:38</a>:<a class="headerlink" href="#bbeaver_commented_at_2014-08-11_1838" title="Permanent link">&para;</a></h4>
<p>Please see savelayout info below:</p>
<p>disklayout.conf:</p>
<pre><code>disk /dev/sda 320072933376 msdos
part /dev/sda 524288000 1048576 primary boot /dev/sda1
part /dev/sda 319547244544 525336576 primary lvm /dev/sda2
lvmdev /dev/vg_centos01 /dev/sda2 j2PzQ3-tTlb-T6bz-1yal-mkS8-9Eif-oyBaWf 624115712
lvmgrp /dev/vg_centos01 4096 76185 312053760
lvmvol /dev/vg_centos01 lv_root 12800 104857600 
lvmvol /dev/vg_centos01 lv_swap 976 7995392 
lvmvol /dev/vg_centos01 lv_home 37500 307200000 
lvmvol /dev/vg_centos01 lvol0 2560 20971520 
lvmvol /dev/vg_centos01 lvol1 256 2097152 
fs /dev/mapper/vg_centos01-lv_root / ext4 uuid=541142d0-5cf6-4c55-af1d-75fc55b9b5f2 label=_CentOS-6.5-x86_ blocksize=4096 reserved_blocks=0% max_mounts=-1 check_interval=0d bytes_per_inode=16384 default_mount_options=user_xattr,acl options=rw
fs /dev/sda1 /boot ext4 uuid=b83eaf94-8194-4af2-9da6-0f3bbc16353c label= blocksize=1024 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=4095 default_mount_options=user_xattr,acl options=rw
fs /dev/mapper/vg_centos01-lv_home /home ext4 uuid=1fe2fb96-7334-4a6e-9432-92784cd4c0a8 label= blocksize=4096 reserved_blocks=5% max_mounts=-1 check_interval=0d bytes_per_inode=16382 default_mount_options=user_xattr,acl options=rw
fs /dev/drbd0 /drbd0 ext4 uuid=cf5c0b71-ea5b-4e87-8747-da2d65f38cd2 label= blocksize=4096 reserved_blocks=4% max_mounts=24 check_interval=180d bytes_per_inode=16383 options=rw
swap /dev/mapper/vg_centos01-lv_swap uuid=ef75bca1-63f8-438c-90d9-0696266b2a16 label=
drbd /dev/drbd0 clusterdb /dev/vg_centos01/lvol0
</code></pre>
<p>disktodo.conf:</p>
<pre><code>todo /dev/sda disk
todo /dev/sda1 part
todo /dev/sda2 part
todo pv:/dev/sda2 lvmdev
todo /dev/vg_centos01 lvmgrp
todo /dev/mapper/vg_centos01-lv_root lvmvol
todo /dev/mapper/vg_centos01-lv_swap lvmvol
todo /dev/mapper/vg_centos01-lv_home lvmvol
todo /dev/mapper/vg_centos01-lvol0 lvmvol
todo /dev/mapper/vg_centos01-lvol1 lvmvol
todo fs:/ fs
todo fs:/boot fs
todo fs:/home fs
todo fs:/drbd0 fs
todo swap:/dev/mapper/vg_centos01-lv_swap swap
todo /dev/drbd0 drbd
</code></pre>
<p>diskdeps.conf:</p>
<pre><code>/dev/sda1 /dev/sda
/dev/sda2 /dev/sda
/dev/vg_centos01 pv:/dev/sda2
pv:/dev/sda2 /dev/sda2
/dev/mapper/vg_centos01-lv_root /dev/vg_centos01
/dev/mapper/vg_centos01-lv_swap /dev/vg_centos01
/dev/mapper/vg_centos01-lv_home /dev/vg_centos01
/dev/mapper/vg_centos01-lvol0 /dev/vg_centos01
/dev/mapper/vg_centos01-lvol1 /dev/vg_centos01
fs:/ /dev/mapper/vg_centos01-lv_root
fs:/boot /dev/sda1
fs:/boot fs:/
fs:/home /dev/mapper/vg_centos01-lv_home
fs:/home fs:/
fs:/drbd0 /dev/drbd0
fs:/drbd0 fs:/
swap:/dev/mapper/vg_centos01-lv_swap /dev/mapper/vg_centos01-lv_swap
/dev/drbd0 /dev/vg_centos01/lvol0
</code></pre>
<p>Thanks</p>
<h4 id="bbeaver_commented_at_2014-08-16_1817"><img src="https://avatars.githubusercontent.com/u/7350825?u=2ec61633eda874b17db7b1eb383363444e6064d6&v=4" width="50"><a href="https://github.com/bbeaver">bbeaver</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-52401639">2014-08-16 18:17</a>:<a class="headerlink" href="#bbeaver_commented_at_2014-08-16_1817" title="Permanent link">&para;</a></h4>
<p>After performing additional tests, I believe REAR handles full NETFS tar
restores of drbd nodes properly by just skipping over the error
mentioned above. I've been able to run full rear restore tests on each
of my 2 node drdb cluster nodes successfully. After confirming I had a
full rear backup for each of the drbd nodes, I manually destroyed the
primary node using the dd utillity. Then performed a rear recovery, and
chose the option to "Continue" when receiving the "No code has been
generated to restore device /dev/drbd0 (drbd) Please add code to
/var/lib/rear/layout/diskrestore.sh to manually install it or choose
abort" error message. I did not add any code to
/var/lib/rear/layout/diskrestore.sh. REAR restored the node perfectly,
and drbd automatically knew to re-sync on it's own from the remaining
online node.</p>
<h4 id="gdha_commented_at_2014-08-18_1256"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-52487881">2014-08-18 12:56</a>:<a class="headerlink" href="#gdha_commented_at_2014-08-18_1256" title="Permanent link">&para;</a></h4>
<p>By any chance do you have the script
<code>/var/lib/rear/layout/diskrestore.sh</code> by hand so we could review it?</p>
<h4 id="bbeaver_commented_at_2014-08-18_1332"><img src="https://avatars.githubusercontent.com/u/7350825?u=2ec61633eda874b17db7b1eb383363444e6064d6&v=4" width="50"><a href="https://github.com/bbeaver">bbeaver</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-52491904">2014-08-18 13:32</a>:<a class="headerlink" href="#bbeaver_commented_at_2014-08-18_1332" title="Permanent link">&para;</a></h4>
<p>I do not have the diskrestore.sh file. Apparently this is not created by
default, and I did not create one.</p>
<p>Thanks</p>
<h4 id="gdha_commented_at_2015-06-03_1119"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-108306772">2015-06-03 11:19</a>:<a class="headerlink" href="#gdha_commented_at_2015-06-03_1119" title="Permanent link">&para;</a></h4>
<p>@bbeaver the diskrestore.sh script is generated during the
<code>rear recover</code> session. You should copy it over to another system at the
moment rear stops working. The script is auto-generated. That is the
reason you do not have it by default.<br />
Furthermore, running a <code>rear -vD recover</code> will generate a full debug
file which is interesting to see where it fails and why...</p>
<h4 id="dragon299_commented_at_2016-09-07_1443"><img src="https://avatars.githubusercontent.com/u/2734035?v=4" width="50"><a href="https://github.com/dragon299">dragon299</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-245303193">2016-09-07 14:43</a>:<a class="headerlink" href="#dragon299_commented_at_2016-09-07_1443" title="Permanent link">&para;</a></h4>
<p>A few days ago I was able to do a restore with DRBD on LVM using REAR
1.17.2 on RedHat 7.2 without any issues. Maybe the problem is already
fixed or does not exist on all plattforms.</p>
<h4 id="gdha_commented_at_2016-09-07_1445"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-245303914">2016-09-07 14:45</a>:<a class="headerlink" href="#gdha_commented_at_2016-09-07_1445" title="Permanent link">&para;</a></h4>
<p>@dragon299 That is good news. You can always pre-view the diskrestore.sh
script - see
<a href="http://www.it3.be/2016/06/08/rear-diskrestore/">http://www.it3.be/2016/06/08/rear-diskrestore/</a></p>
<h4 id="jsmeix_commented_at_2016-09-21_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/368#issuecomment-248606346">2016-09-21 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-09-21_1306" title="Permanent link">&para;</a></h4>
<p>According to
<a href="https://github.com/rear/rear/issues/368#issuecomment-245303193">https://github.com/rear/rear/issues/368#issuecomment-245303193</a><br />
I think we can clse it as "fixed" - at least for now - it can be<br />
reopened if needed.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2014-02-18.368.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
