<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1479 Issue closed: An error occurred during layout recreation - SLES11SP4 on Power - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1479 Issue closed: An error occurred during layout recreation - SLES11SP4 on Power";
        var mkdocs_page_input_path = "issues/2017-09-08.1479.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1479 Issue closed: An error occurred during layout recreation - SLES11SP4 on Power</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1479_issue_closed_an_error_occurred_during_layout_recreation_-_sles11sp4_on_power"><a href="https://github.com/rear/rear/issues/1479">#1479 Issue</a> <code>closed</code>: An error occurred during layout recreation - SLES11SP4 on Power<a class="headerlink" href="#1479_issue_closed_an_error_occurred_during_layout_recreation_-_sles11sp4_on_power" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="sebaobi_opened_issue_at_2017-09-08_1142"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> opened issue at <a href="https://github.com/rear/rear/issues/1479">2017-09-08 11:42</a>:<a class="headerlink" href="#sebaobi_opened_issue_at_2017-09-08_1142" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>rear version (/usr/sbin/rear -V): Relax-and-Recover
    2.2-git.0.2658745.unknown.changed / 2017-08-03</p>
</li>
<li>
<p>OS version (cat /etc/rear/os.conf or lsb_release -a): SUSE Linux
    Enterprise Server 11 SP4 (ppc64)</p>
</li>
<li>
<p>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</p>
</li>
</ul>
<!-- -->

<pre><code>BACKUP=NSR
OUTPUT=ISO
OUTPUT_URL=nfs://192.168.12.10/data/col1/rear
NSRSERVER=nsr_server
POOLNAME=ddos
RETENTION_TIME=Month
USE_CFG2HTML=y
AUTOEXCLUDE_MULTIPATH=n
BOOT_OVER_SAN=y
REQUIRED_PROGS=(
"${REQUIRED_PROGS[@]}"
parted
sfdisk
)

PROGS=(
"${PROGS[@]}"
partprobe
fdisk
cfdisk
bootlist
pseries_platform
nvram
ofpathname
bc
agetty
)

#Exclude firmware only when running in Virtualized mode (meaning not PowerNV mode).
if [[ $(awk '/platform/ {print $NF}' &lt; /proc/cpuinfo) != PowerNV ]] ; then
    COPY_AS_IS_EXCLUDE=( ${COPY_AS_IS_EXCLUDE[@]} /lib*/firmware )
fi

KERNEL_CMDLINE="LANG=en_US.UTF-8 SYSFONT=latarcyrheb-sun16 KEYTABLE=us console=hvc0"
</code></pre>
<ul>
<li>
<p>Are you using legacy BIOS or UEFI boot? BIOS</p>
</li>
<li>
<p>Brief description of the issue:<br />
    We are trying to restore a SLES 11 SP4 PPC running on Power. Source
    and destination server have the same disk layout but we encountered
    an issue during layout recreation.<br />
    An extract of the log:</p>
</li>
</ul>
<!-- -->

<pre><code>+++ LogPrint 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
+++ Log 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
++++ date '+%Y-%m-%d %H:%M:%S.%N '
+++ local 'timestamp=2017-09-08 13:10:01.097854488 '
+++ test 1 -gt 0
+++ echo '2017-09-08 13:10:01.097854488 Creating LVM PV /dev/mapper/relax01_rvg_part2'
2017-09-08 13:10:01.097854488 Creating LVM PV /dev/mapper/relax01_rvg_part2
+++ Print 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
+++ test 1
+++ echo -e 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
+++ lvm vgchange -a n OS
  Volume group "OS" not found
+++ true
+++ lvm pvcreate -ff --yes -v --uuid 7DGexv-5mGb-83xw-STdI-aKDH-zahP-eHZ87u --norestorefile /dev/mapper/relax01_rvg_part2
    connect() failed on local socket: No such file or directory
    Internal cluster locking initialisation failed.
    WARNING: Falling back to local file-based locking.
    Volume Groups with the clustered attribute will be inaccessible.
  Device /dev/mapper/relax01_rvg_part2 not found (or ignored by filtering).
2017-09-08 13:10:03.515589517 An error occurred during layout recreation.
2017-09-08 13:11:38.224627824 User selected: 6) Abort Relax-and-Recover
2017-09-08 13:11:38.226158664 Error detected during restore.
2017-09-08 13:11:38.227441044 Restoring backup of /var/lib/rear/layout/disklayout.conf
2017-09-08 13:11:38.229934269 ERROR: There was an error restoring the system layout. See /var/log/rear/relax01.log for details.
==== Stack trace ====
Trace 0: /bin/rear:538 main
Trace 1: /usr/share/rear/lib/recover-workflow.sh:22 WORKFLOW_recover
Trace 2: /usr/share/rear/lib/framework-functions.sh:95 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:49 Source
Trace 4: /usr/share/rear/layout/recreate/default/200_run_script.sh:65 source
Message: There was an error restoring the system layout. See /var/log/rear/relax01.log for details.
== End stack trace ==
2017-09-08 13:11:38.234191271 Running exit tasks.
2017-09-08 13:11:38.236102995 Finished in 152 seconds
2017-09-08 13:11:38.237305155 Removing build area /tmp/rear.MnFW1oKS6GzX9B4
removed directory: `/tmp/rear.MnFW1oKS6GzX9B4'
2017-09-08 13:11:38.242741139 End of program reached
</code></pre>
<h4 id="jsmeix_commented_at_2017-09-08_1153"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-328083434">2017-09-08 11:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-08_1153" title="Permanent link">&para;</a></h4>
<p>@sebaobi<br />
can you attach your complete<br />
var/lib/rear/layout/disklayout.conf<br />
file?</p>
<h4 id="schabrolles_commented_at_2017-09-08_1156"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-328083883">2017-09-08 11:56</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-08_1156" title="Permanent link">&para;</a></h4>
<p>@sebaobi Could you please add also <code>var/lib/rear/layout/diskrestore.sh</code>
please</p>
<h4 id="sebaobi_commented_at_2017-09-08_1536"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-328137583">2017-09-08 15:36</a>:<a class="headerlink" href="#sebaobi_commented_at_2017-09-08_1536" title="Permanent link">&para;</a></h4>
<p>RESCUE relax01:/ # less /var/lib/rear/layout/disklayout.conf</p>
<pre><code>lvmdev /dev/OS /dev/mapper/relax01_rvg_part2 7DGexv-5mGb-83xw-STdI-aKDH-zahP-eHZ87u 41525248
lvmgrp /dev/OS 4096 5068 20758528
lvmvol /dev/OS root 1536 12582912
lvmvol /dev/OS swap 1024 8388608
lvmvol /dev/OS tmp 1024 8388608
lvmvol /dev/OS var 1024 8388608
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/mapper/OS-root / ext3 uuid=5fabe5fc-22ee-4e51-8311-8917169d316d label= blocksize=4096 reserved_blocks=4% max_mounts=23 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
fs /dev/mapper/OS-tmp /tmp ext3 uuid=f9f8eed5-f1a7-496e-af2c-cbeb451a0a42 label= blocksize=4096 reserved_blocks=4% max_mounts=27 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
fs /dev/mapper/OS-var /var ext3 uuid=22af31d8-7b3c-475d-910b-800df685ef68 label= blocksize=4096 reserved_blocks=4% max_mounts=20 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/mapper/OS-swap uuid=0b4fb267-464d-4e33-a671-83892c305437 label=
/dev/sdd
part /dev/mapper/relax01_rvg 212860928 1048576 primary boot,prep /dev/mapper/relax01_rvg_part1
part /dev/mapper/relax01_rvg 21260926976 213909504 primary lvm /dev/mapper/relax01_rvg_part2
</code></pre>
<p>RESCUE relax01:~ # less /var/lib/rear/layout/diskrestore.sh</p>
<pre><code>#!/bin/bash

LogPrint "Start system layout restoration."

mkdir -p /mnt/local
if create_component "vgchange" "rear" ; then
    lvm vgchange -a n &gt;/dev/null
    component_created "vgchange" "rear"
fi

set -e
set -x

if create_component "/dev/mapper/mpathb" "multipath" ; then
# Create /dev/mapper/mpathb (multipath)
LogPrint "Creating partitions for disk /dev/mapper/mpathb (msdos)"
my_udevsettle
parted -s /dev/mapper/mpathb mklabel msdos &gt;&amp;2
my_udevsettle
my_udevsettle
parted -s /dev/mapper/mpathb mkpart '"primary"' 2097152B 214958079B &gt;&amp;2
my_udevsettle
my_udevsettle
parted -s /dev/mapper/mpathb set 1 boot on &gt;&amp;2
my_udevsettle
my_udevsettle
parted -s /dev/mapper/mpathb set 1 prep on &gt;&amp;2
my_udevsettle
my_udevsettle
parted -s /dev/mapper/mpathb mkpart '"primary"' 214962176B 21474836479B &gt;&amp;2
my_udevsettle
my_udevsettle
parted -s /dev/mapper/mpathb set 2 lvm on &gt;&amp;2
my_udevsettle
sleep 1
if ! partprobe -s /dev/mapper/mpathb &gt;&amp;2 ; then
    LogPrint 'retrying partprobe /dev/mapper/mpathb after 10 seconds'
    sleep 10
    if ! partprobe -s /dev/mapper/mpathb &gt;&amp;2 ; then
        LogPrint 'retrying partprobe /dev/mapper/mpathb after 1 minute'
        sleep 60
        if ! partprobe -s /dev/mapper/mpathb &gt;&amp;2 ; then
            LogPrint 'partprobe /dev/mapper/mpathb failed, proceeding bona fide'
        fi
    fi
fi
component_created "/dev/mapper/mpathb" "multipath"
else
    LogPrint "Skipping /dev/mapper/mpathb (multipath) as it has already been created."
fi

if create_component "/dev/mapper/relax01_rvg_part1" "part" ; then
# Create /dev/mapper/relax01_rvg_part1 (part)
component_created "/dev/mapper/relax01_rvg_part1" "part"
else
    LogPrint "Skipping /dev/mapper/relax01_rvg_part1 (part) as it has already been created."
fi

if create_component "/dev/mapper/relax01_rvg_part2" "part" ; then
# Create /dev/mapper/relax01_rvg_part2 (part)
component_created "/dev/mapper/relax01_rvg_part2" "part"
else
    LogPrint "Skipping /dev/mapper/relax01_rvg_part2 (part) as it has already been created."
fi

if create_component "pv:/dev/mapper/relax01_rvg_part2" "lvmdev" ; then
# Create pv:/dev/mapper/relax01_rvg_part2 (lvmdev)
LogPrint "Creating LVM PV /dev/mapper/relax01_rvg_part2"
lvm vgchange -a n OS || true
lvm pvcreate -ff --yes -v --uuid "7DGexv-5mGb-83xw-STdI-aKDH-zahP-eHZ87u" --norestorefile /dev/mapper/relax01_rvg_part2 &gt;&amp;2
component_created "pv:/dev/mapper/relax01_rvg_part2" "lvmdev"
else
    LogPrint "Skipping pv:/dev/mapper/relax01_rvg_part2 (lvmdev) as it has already been created."
fi

if create_component "/dev/OS" "lvmgrp" ; then
# Create /dev/OS (lvmgrp)
LogPrint "Creating LVM VG OS"
if [ -e "/dev/OS" ] ; then
    rm -rf "/dev/OS"
fi
lvm vgcreate --physicalextentsize 4096k OS /dev/mapper/relax01_rvg_part2 &gt;&amp;2
lvm vgchange --available y OS &gt;&amp;2
component_created "/dev/OS" "lvmgrp"
else
    LogPrint "Skipping /dev/OS (lvmgrp) as it has already been created."
fi

if create_component "/dev/mapper/OS-root" "lvmvol" ; then
# Create /dev/mapper/OS-root (lvmvol)
LogPrint "Creating LVM volume OS/root"
lvm lvcreate -l 1536 -n root OS &lt;&lt;&lt;y
component_created "/dev/mapper/OS-root" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/OS-root (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/OS-swap" "lvmvol" ; then
# Create /dev/mapper/OS-swap (lvmvol)
LogPrint "Creating LVM volume OS/swap"
lvm lvcreate -l 1024 -n swap OS &lt;&lt;&lt;y
component_created "/dev/mapper/OS-swap" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/OS-swap (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/OS-tmp" "lvmvol" ; then
# Create /dev/mapper/OS-tmp (lvmvol)
LogPrint "Creating LVM volume OS/tmp"
lvm lvcreate -l 1024 -n tmp OS &lt;&lt;&lt;y
component_created "/dev/mapper/OS-tmp" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/OS-tmp (lvmvol) as it has already been created."
fi

if create_component "/dev/mapper/OS-var" "lvmvol" ; then
# Create /dev/mapper/OS-var (lvmvol)
LogPrint "Creating LVM volume OS/var"
lvm lvcreate -l 1024 -n var OS &lt;&lt;&lt;y
component_created "/dev/mapper/OS-var" "lvmvol"
else
    LogPrint "Skipping /dev/mapper/OS-var (lvmvol) as it has already been created."
fi

if create_component "fs:/" "fs" ; then
# Create fs:/ (fs)
# Wait until udev had created '/dev/mapper/OS-root' before creating a filesystem there:
my_udevsettle
LogPrint 'Creating filesystem of type 'ext3' with mount point '/' on '/dev/mapper/OS-root'.'
# Using wipefs to cleanup '/dev/mapper/OS-root' before creating filesystem.
wipefs --all --force /dev/mapper/OS-root || wipefs --all /dev/mapper/OS-root || dd if=/dev/zero of=/dev/mapper/OS-root bs=512 count=1 || true
# Try 'mkfs -U' to create the filesystem with initially correct UUID
# but if that fails assume it failed because of missing support for '-U'
# (e.g. in RHEL 5 it fails, see https://github.com/rear/rear/issues/890)
# then fall back to using mkfs without '-U' plus 'tune2fs/tune4fs -U'
if ! mkfs -t ext3 -b 4096 -i 16384 -U 5fabe5fc-22ee-4e51-8311-8917169d316d -F /dev/mapper/OS-root &gt;&amp;2 ; then
    mkfs -t ext3 -b 4096 -i 16384 -F /dev/mapper/OS-root &gt;&amp;2
    tune2fs -U 5fabe5fc-22ee-4e51-8311-8917169d316d /dev/mapper/OS-root &gt;&amp;2
fi
tune2fs  -m 4 -c 23 -i 180d /dev/mapper/OS-root &gt;&amp;2
LogPrint "Mounting filesystem /"
mkdir -p /mnt/local/
mount -o rw,acl,user_xattr /dev/mapper/OS-root /mnt/local/
component_created "fs:/" "fs"
else
    LogPrint "Skipping fs:/ (fs) as it has already been created."
fi

if create_component "fs:/tmp" "fs" ; then
# Create fs:/tmp (fs)
# Wait until udev had created '/dev/mapper/OS-tmp' before creating a filesystem there:
my_udevsettle
LogPrint 'Creating filesystem of type 'ext3' with mount point '/tmp' on '/dev/mapper/OS-tmp'.'
# Using wipefs to cleanup '/dev/mapper/OS-tmp' before creating filesystem.
wipefs --all --force /dev/mapper/OS-tmp || wipefs --all /dev/mapper/OS-tmp || dd if=/dev/zero of=/dev/mapper/OS-tmp bs=512 count=1 || true
# Try 'mkfs -U' to create the filesystem with initially correct UUID
# but if that fails assume it failed because of missing support for '-U'
# (e.g. in RHEL 5 it fails, see https://github.com/rear/rear/issues/890)
# then fall back to using mkfs without '-U' plus 'tune2fs/tune4fs -U'
if ! mkfs -t ext3 -b 4096 -i 16384 -U f9f8eed5-f1a7-496e-af2c-cbeb451a0a42 -F /dev/mapper/OS-tmp &gt;&amp;2 ; then
    mkfs -t ext3 -b 4096 -i 16384 -F /dev/mapper/OS-tmp &gt;&amp;2
    tune2fs -U f9f8eed5-f1a7-496e-af2c-cbeb451a0a42 /dev/mapper/OS-tmp &gt;&amp;2
fi
tune2fs  -m 4 -c 27 -i 180d /dev/mapper/OS-tmp &gt;&amp;2
LogPrint "Mounting filesystem /tmp"
mkdir -p /mnt/local/tmp
mount -o rw,acl,user_xattr /dev/mapper/OS-tmp /mnt/local/tmp
component_created "fs:/tmp" "fs"
else
    LogPrint "Skipping fs:/tmp (fs) as it has already been created."
fi

if create_component "fs:/var" "fs" ; then
# Create fs:/var (fs)
# Wait until udev had created '/dev/mapper/OS-var' before creating a filesystem there:
my_udevsettle
LogPrint 'Creating filesystem of type 'ext3' with mount point '/var' on '/dev/mapper/OS-var'.'
# Using wipefs to cleanup '/dev/mapper/OS-var' before creating filesystem.
wipefs --all --force /dev/mapper/OS-var || wipefs --all /dev/mapper/OS-var || dd if=/dev/zero of=/dev/mapper/OS-var bs=512 count=1 || true
# Try 'mkfs -U' to create the filesystem with initially correct UUID
# but if that fails assume it failed because of missing support for '-U'
# (e.g. in RHEL 5 it fails, see https://github.com/rear/rear/issues/890)
# then fall back to using mkfs without '-U' plus 'tune2fs/tune4fs -U'
if ! mkfs -t ext3 -b 4096 -i 16384 -U 22af31d8-7b3c-475d-910b-800df685ef68 -F /dev/mapper/OS-var &gt;&amp;2 ; then
    mkfs -t ext3 -b 4096 -i 16384 -F /dev/mapper/OS-var &gt;&amp;2
    tune2fs -U 22af31d8-7b3c-475d-910b-800df685ef68 /dev/mapper/OS-var &gt;&amp;2
fi
tune2fs  -m 4 -c 20 -i 180d /dev/mapper/OS-var &gt;&amp;2
LogPrint "Mounting filesystem /var"
mkdir -p /mnt/local/var
mount -o rw,acl,user_xattr /dev/mapper/OS-var /mnt/local/var
component_created "fs:/var" "fs"
else
    LogPrint "Skipping fs:/var (fs) as it has already been created."
fi

if create_component "swap:/dev/mapper/OS-swap" "swap" ; then
# Create swap:/dev/mapper/OS-swap (swap)
LogPrint "Creating swap on /dev/mapper/OS-swap"
mkswap -U 0b4fb267-464d-4e33-a671-83892c305437 /dev/mapper/OS-swap &gt;&amp;2
mkswap -U 0b4fb267-464d-4e33-a671-83892c305437 /dev/mapper/OS-swap &gt;&amp;2
component_created "swap:/dev/mapper/OS-swap" "swap"
else
    LogPrint "Skipping swap:/dev/mapper/OS-swap (swap) as it has already been created."
fi


set +x
set +e

LogPrint "Disk layout created."
</code></pre>
<h4 id="schabrolles_commented_at_2017-09-10_0929"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-328330836">2017-09-10 09:29</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-10_0929" title="Permanent link">&para;</a></h4>
<p>@sebaobi There is definitely something strange here.</p>
<ol>
<li>
<p><code>disklayout</code> file doesn't have any <code>disk</code> or <code>multipath</code> type
    device. (only part)<br />
    I assume you use multipath on the source system, so you should have
    <code>multipath</code> devices define in you <code>disklayout</code>.</p>
</li>
<li>
<p><code>diskrestore.sh</code> script starts with creating partions on
    <code>/dev/mapper/mpathb</code> and then try to use <code>/dev/mapper/relax01_rvg</code>
    as device name to create LVM.</p>
</li>
<li>
<p>How many disk/LUN do you have on your system ? (could you send
    <code>multipath -ll</code> output ?)</p>
</li>
<li>when you ran <code>rear recover</code>, did you have a menu with some "Choice"
    to make ? (press 1 to confirm mappings, press 5 to continue etc
    ....)<br />
    If it is the case, could you please try to recover again and attach
    a copy of what you have on screen (menu + choice you make) and the
    full log file generated in <code>/var/log/rear</code>.</li>
</ol>
<h4 id="sebaobi_commented_at_2017-09-13_1013"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329123020">2017-09-13 10:13</a>:<a class="headerlink" href="#sebaobi_commented_at_2017-09-13_1013" title="Permanent link">&para;</a></h4>
<p>Hello,<br />
I have one LUN, here you are multipath output:</p>
<pre><code>`RESCUE iterelax01:~ # multipath -ll
mpathb (3600507680c8182613800000000000417) dm-0 IBM,2145
size=20G features='0' hwhandler='0' wp=rw
|-+- policy='round-robin 0' prio=50 status=active
| |- 1:0:2:0 sda 8:0  active ready running
| `- 2:0:0:0 sdc 8:32 active ready running
`-+- policy='round-robin 0' prio=10 status=enabled
  |- 1:0:3:0 sdb 8:16 active ready running
  `- 2:0:1:0 sdd 8:48 active ready running`
</code></pre>
<p>This is output from my recover session:</p>
<pre><code>`RESCUE relax01:~ # rear -v recover
Relax-and-Recover 2.2-git.0.2658745.unknown.changed / 2017-08-03
Using log file: /var/log/rear/rear-relax01.log
Running workflow recover within the ReaR rescue/recovery system
Will do driver migration (recreating initramfs/initrd)
We will recover the following file systems from EMC NetWorker: / /tmp /var
Setting up multipathing
Activating multipath
multipath activated
mpathb  (253, 0)
mpathb (3600507680c8182613800000000000417) dm-0 IBM,2145
size=20G features='0' hwhandler='0' wp=rw
|-+- policy='round-robin 0' prio=0 status=active
| |- 1:0:2:0 sda 8:0  active undef running
| `- 2:0:0:0 sdc 8:32 active undef running
`-+- policy='round-robin 0' prio=0 status=enabled
  |- 1:0:3:0 sdb 8:16 active undef running
  `- 2:0:1:0 sdd 8:48 active undef running
Comparing disks.
Device mapper!relax01_rvg does not exist.
Switching to manual disk layout configuration.
Using /dev/mapper/mpathb (same size) for recreating /dev/mapper/relax01_rvg
Current disk mapping table (source -&gt; target):
    /dev/mapper/relax01_rvg /dev/mapper/mpathb
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default 1 timeout 300 seconds)

Continuing 'rear recover' by default
Please confirm that '/var/lib/rear/layout/disklayout.conf' is as you expect.

1) View disk layout (disklayout.conf)  4) Go to Relax-and-Recover shell
2) Edit disk layout (disklayout.conf)  5) Continue recovery
3) View original disk space usage      6) Abort Relax-and-Recover



#? 1
lvmdev /dev/OS /dev/mapper/relax01_rvg_part2 7DGexv-5mGb-83xw-STdI-aKDH-zahP-eHZ87u 41525248
lvmgrp /dev/OS 4096 5068 20758528
lvmvol /dev/OS root 1536 12582912
lvmvol /dev/OS swap 1024 8388608
lvmvol /dev/OS tmp 1024 8388608
lvmvol /dev/OS var 1024 8388608
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; [uuid=&lt;uuid&gt;] [label=&lt;label&gt;] [&lt;attributes&gt;]
fs /dev/mapper/OS-root / ext3 uuid=5fabe5fc-22ee-4e51-8311-8917169d316d label= blocksize=4096 reserved_blocks=4% max_mounts=23 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
fs /dev/mapper/OS-tmp /tmp ext3 uuid=f9f8eed5-f1a7-496e-af2c-cbeb451a0a42 label= blocksize=4096 reserved_blocks=4% max_mounts=27 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
fs /dev/mapper/OS-var /var ext3 uuid=22af31d8-7b3c-475d-910b-800df685ef68 label= blocksize=4096 reserved_blocks=4% max_mounts=20 check_interval=180d bytes_per_inode=16384 options=rw,acl,user_xattr
# Swap partitions or swap files
# Format: swap &lt;filename&gt; uuid=&lt;uuid&gt; label=&lt;label&gt;
swap /dev/mapper/OS-swap uuid=0b4fb267-464d-4e33-a671-83892c305437 label=
multipath /dev/mapper/mpathb 21474836480 /dev/sda,/dev/sdb,/dev/sdc,/dev/sdd
part /dev/mapper/mpathb 212860928 1048576 primary boot,prep /dev/mapper/relax01_rvg_part1
part /dev/mapper/mpathb 21260926976 213909504 primary lvm /dev/mapper/relax01_rvg_part2



#? 5
Partition primary on /dev/mapper/mpathb: size reduced to fit on disk.
Please confirm that '/var/lib/rear/layout/diskrestore.sh' is as you expect.

1) View restore script (diskrestore.sh)
2) Edit restore script (diskrestore.sh)
3) View original disk space usage
4) Go to Relax-and-Recover shell
5) Continue recovery
6) Abort Relax-and-Recover

1) View restore script (diskrestore.sh)
2) Edit restore script (diskrestore.sh)
3) View original disk space usage
4) Go to Relax-and-Recover shell
5) Continue recovery
6) Abort Relax-and-Recover
#? 5
Start system layout restoration.
Creating partitions for disk /dev/mapper/mpathb (msdos)
Creating LVM PV /dev/mapper/relax01_rvg_part2
An error occurred during layout recreation.`
</code></pre>
<p>And logs from recover session:</p>
<pre><code>2017-09-13 11:31:19.495479661 Relax-and-Recover 2.2-git.0.2658745.unknown.changed / 2017-08-03
2017-09-13 11:31:19.496542861 Command line options: /bin/rear -v recover
2017-09-13 11:31:19.497558613 Using log file: /var/log/rear/rear-relax01.log
2017-09-13 11:31:19.498905378 Including /etc/rear/os.conf
2017-09-13 11:31:19.500439675 Including conf/Linux-ppc64.conf
2017-09-13 11:31:19.501945824 Including conf/GNU/Linux.conf
2017-09-13 11:31:19.506324162 Including conf/SUSE_LINUX.conf
2017-09-13 11:31:19.507889027 Including /etc/rear/site.conf
2017-09-13 11:31:19.511782357 Including /etc/rear/local.conf
2017-09-13 11:31:19.513038052 Including /etc/rear/rescue.conf
2017-09-13 11:31:19.515631292 ======================
2017-09-13 11:31:19.516622561 Running 'init' stage
2017-09-13 11:31:19.517527049 ======================
2017-09-13 11:31:19.521405821 Including init/default/010_set_drlm_env.sh
2017-09-13 11:31:19.522589073 Including init/default/030_update_recovery_system.sh
2017-09-13 11:31:19.523734920 Including init/default/050_check_rear_recover_mode.sh
2017-09-13 11:31:19.524896500 Running workflow recover within the ReaR rescue/recovery system
2017-09-13 11:31:19.526126495 Finished running 'init' stage in 0 seconds
2017-09-13 11:31:19.532631154 Using build area '/tmp/rear.6nRwpcczyG6Mh6F'
mkdir: created directory `/tmp/rear.6nRwpcczyG6Mh6F/rootfs'
mkdir: created directory `/tmp/rear.6nRwpcczyG6Mh6F/tmp'
2017-09-13 11:31:19.535209271 Running recover workflow
2017-09-13 11:31:19.536251265 ======================
2017-09-13 11:31:19.537150144 Running 'setup' stage
2017-09-13 11:31:19.538026163 ======================
2017-09-13 11:31:19.541887326 Including setup/default/010_pre_recovery_script.sh
2017-09-13 11:31:19.542939945 Finished running 'setup' stage in 0 seconds
2017-09-13 11:31:19.543946426 ======================
2017-09-13 11:31:19.544881676 Running 'verify' stage
2017-09-13 11:31:19.545815785 ======================
2017-09-13 11:31:19.549688661 Including verify/default/020_cciss_scsi_engage.sh
2017-09-13 11:31:19.551666874 Including verify/default/020_translate_url.sh
2017-09-13 11:31:19.553169429 Including verify/default/030_translate_tape.sh
2017-09-13 11:31:19.554453012 Including verify/default/040_validate_variables.sh
2017-09-13 11:31:19.556796213 Including verify/default/050_create_mappings_dir.sh
2017-09-13 11:31:19.558006790 Including verify/GNU/Linux/050_sane_recovery_check.sh
2017-09-13 11:31:19.559257184 Including verify/GNU/Linux/230_storage_and_network_modules.sh
2017-09-13 11:31:19.560484444 Including storage drivers
2017-09-13 11:31:19.565035456 Including network drivers
2017-09-13 11:31:19.569818084 Including crypto drivers
2017-09-13 11:31:19.573269603 Including virtualization drivers
2017-09-13 11:31:19.576256660 Including additional drivers
2017-09-13 11:31:19.579115033 Including verify/GNU/Linux/260_recovery_storage_drivers.sh
2017-09-13 11:31:19.626720548 Will do driver migration (recreating initramfs/initrd)
2017-09-13 11:31:19.628058705 Including verify/NSR/default/400_verify_nsr.sh
2017-09-13 11:31:19.629205669 NSRSERVER (c301bcksrv) was defined in /etc/rear/local.conf
2017-09-13 11:31:19.630634474 Skipping ping test
2017-09-13 11:31:19.631945247 EMC NetWorker server NSRSERVER=c301bcksrv
2017-09-13 11:31:19.633220485 Including verify/NSR/default/410_verify_nsr_paths.sh
2017-09-13 11:31:19.635456897 We will recover the following file systems from EMC NetWorker: / /tmp /var
2017-09-13 11:31:19.636667587 Finished running 'verify' stage in 0 seconds
2017-09-13 11:31:19.637650770 ======================
2017-09-13 11:31:19.638564973 Running 'layout/prepare' stage
2017-09-13 11:31:19.639523268 ======================
2017-09-13 11:31:19.643709899 Including layout/prepare/default/010_prepare_files.sh
2017-09-13 11:31:19.647157063 Including layout/prepare/GNU/Linux/100_include_partition_code.sh
2017-09-13 11:31:19.654270898 Including layout/prepare/GNU/Linux/110_include_lvm_code.sh
2017-09-13 11:31:19.660011949 Including layout/prepare/GNU/Linux/120_include_raid_code.sh
/usr/share/rear/lib/_input-output-functions.sh: line 199: type: mdadm: not found
2017-09-13 11:31:19.661249357 Including layout/prepare/GNU/Linux/130_include_filesystem_code.sh
2017-09-13 11:31:19.664067010 Including layout/prepare/GNU/Linux/130_include_mount_filesystem_code.sh
2017-09-13 11:31:19.665895961 Including layout/prepare/GNU/Linux/130_include_mount_subvolumes_code.sh
2017-09-13 11:31:19.670475845 Including layout/prepare/GNU/Linux/140_include_swap_code.sh
2017-09-13 11:31:19.675200575 Including layout/prepare/GNU/Linux/150_include_drbd_code.sh
2017-09-13 11:31:19.676610080 Including layout/prepare/GNU/Linux/160_include_luks_code.sh
2017-09-13 11:31:19.678075024 Including layout/prepare/GNU/Linux/170_include_hpraid_code.sh
/usr/share/rear/lib/_input-output-functions.sh: line 199: type: hpacucli: not found
/usr/share/rear/lib/_input-output-functions.sh: line 199: type: hpssacli: not found
2017-09-13 11:31:19.679716178 Including layout/prepare/default/200_recreate_hpraid.sh
2017-09-13 11:31:19.681788953 Including layout/prepare/GNU/Linux/210_load_multipath.sh
2017-09-13 11:31:19.683849604 Setting up multipathing
2017-09-13 11:31:19.685083793 Activating multipath
2017-09-13 11:31:19.697866040 multipath activated
2017-09-13 11:31:19.705361773 Including layout/prepare/default/250_compare_disks.sh
2017-09-13 11:31:19.706524343 Comparing disks.
2017-09-13 11:31:19.711304693 Looking for mapper!relax01_rvg...
2017-09-13 11:31:19.712561017 Device mapper!relax01_rvg does not exist.
2017-09-13 11:31:19.713901280 Switching to manual disk layout configuration.
2017-09-13 11:31:19.715231567 Including layout/prepare/default/270_overrule_migration_mode.sh
2017-09-13 11:31:19.717605641 Including layout/prepare/default/300_map_disks.sh
2017-09-13 11:31:19.767502479 Using /dev/mapper/mpathb (same size) for recreating /dev/mapper/relax01_rvg
2017-09-13 11:31:19.772174292 Current disk mapping table (source -&gt; target):
2017-09-13 11:31:19.774464661     /dev/mapper/relax01_rvg /dev/mapper/mpathb
2017-09-13 11:31:19.776208320 UserInput -p Confirm or edit the disk mapping -D Confirm disk mapping and continue 'rear recover' Confirm disk mapping and continue 'rear recover' Edit disk mapping (/var/lib/rear/layout/disk_mappings) Use Relax-and-Recover shell and return back to here Abort 'rear recover'
2017-09-13 11:31:19.786938203 Confirm or edit the disk mapping
2017-09-13 11:31:19.788240011 1) Confirm disk mapping and continue 'rear recover'
2017-09-13 11:31:19.789446695 2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
2017-09-13 11:31:19.790657059 3) Use Relax-and-Recover shell and return back to here
2017-09-13 11:31:19.791967849 4) Abort 'rear recover'
2017-09-13 11:31:19.793162407 (default 1 timeout 300 seconds)
2017-09-13 11:32:11.988017099 UserInput: 'read' got as user input ''
2017-09-13 11:32:11.989946001 Continuing 'rear recover' by default
2017-09-13 11:32:11.993875067 Including layout/prepare/default/310_remove_exclusions.sh
2017-09-13 11:32:11.997593260 Including layout/prepare/default/320_apply_mappings.sh
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 56: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 56: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 107: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
2017-09-13 11:32:12.008256875 Including layout/prepare/default/400_autoresize_disks.sh
2017-09-13 11:32:12.013139087 Including layout/prepare/default/500_confirm_layout.sh
2017-09-13 11:32:12.014361435 Please confirm that '/var/lib/rear/layout/disklayout.conf' is as you expect.
+++ echo '2017-09-13 11:34:07.914033284 Creating partitions for disk /dev/mapper/mpathb (msdos)'
2017-09-13 11:34:07.914033284 Creating partitions for disk /dev/mapper/mpathb (msdos)
+++ Print 'Creating partitions for disk /dev/mapper/mpathb (msdos)'
+++ test 1
+++ echo -e 'Creating partitions for disk /dev/mapper/mpathb (msdos)'
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ parted -s /dev/mapper/mpathb mklabel msdos
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ parted -s /dev/mapper/mpathb mkpart '"primary"' 2097152B 214958079B
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ parted -s /dev/mapper/mpathb set 1 boot on
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ my_udevsettle
+++ has_binary udevadm
+++ for bin in '$@'
+++ type udevadm
+++ return 0
+++ udevadm settle
+++ return 0
+++ local device=/dev/mapper/mpathb
+++ local type=multipath
+++ local touchfile=multipath--dev-mapper-mpathb
+++ touch /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/multipath--dev-mapper-mpathb
+++ create_component /dev/mapper/relax01_rvg_part1 part
+++ local device=/dev/mapper/relax01_rvg_part1
+++ local type=part
+++ local touchfile=part--dev-mapper-relax01_rvg_part1
+++ '[' -e /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/part--dev-mapper-relax01_rvg_part1 ']'
+++ return 0
+++ component_created /dev/mapper/relax01_rvg_part1 part
+++ local device=/dev/mapper/relax01_rvg_part1
+++ local type=part
+++ local touchfile=part--dev-mapper-relax01_rvg_part1
+++ touch /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/part--dev-mapper-relax01_rvg_part1
+++ create_component /dev/mapper/relax01_rvg_part2 part
+++ local device=/dev/mapper/relax01_rvg_part2
+++ local type=part
+++ local touchfile=part--dev-mapper-relax01_rvg_part2
+++ '[' -e /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/part--dev-mapper-relax01_rvg_part2 ']'
+++ return 0
+++ component_created /dev/mapper/relax01_rvg_part2 part
+++ local device=/dev/mapper/relax01_rvg_part2
+++ local type=part
+++ local touchfile=part--dev-mapper-relax01_rvg_part2
+++ touch /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/part--dev-mapper-relax01_rvg_part2
+++ create_component pv:/dev/mapper/relax01_rvg_part2 lvmdev
+++ local device=pv:/dev/mapper/relax01_rvg_part2
+++ local type=lvmdev
+++ local touchfile=lvmdev-pv:-dev-mapper-relax01_rvg_part2
+++ '[' -e /tmp/rear.6nRwpcczyG6Mh6F/tmp/touch/lvmdev-pv:-dev-mapper-relax01_rvg_part2 ']'
+++ return 0
+++ LogPrint 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
+++ Log 'Creating LVM PV /dev/mapper/relax01_rvg_part2'
++++ date '+%Y-%m-%d %H:%M:%S.%N '
+++ local 'timestamp=2017-09-13 11:34:38.364223420 '
+++ test 1 -gt 0
+++ echo '2017-09-13 11:34:38.364223420 Creating LVM PV /dev/mapper/ITE_iterelax01_rvg_part2'
2017-09-13 11:34:38.364223420 Creating LVM PV /dev/mapper/ITE_iterelax01_rvg_part2
+++ Print 'Creating LVM PV /dev/mapper/ITE_iterelax01_rvg_part2'
+++ test 1
+++ echo -e 'Creating LVM PV /dev/mapper/ITE_iterelax01_rvg_part2'
+++ lvm vgchange -a n OS
  Volume group "OS" not found
+++ true
+++ lvm pvcreate -ff --yes -v --uuid 7DGexv-5mGb-83xw-STdI-aKDH-zahP-eHZ87u --norestorefile /dev/mapper/ITE_iterelax01_rvg_part2
    connect() failed on local socket: No such file or directory
    Internal cluster locking initialisation failed.
    WARNING: Falling back to local file-based locking.
    Volume Groups with the clustered attribute will be inaccessible.
  Device /dev/mapper/ITE_iterelax01_rvg_part2 not found (or ignored by filtering).
2017-09-13 11:34:40.895634689 An error occurred during layout recreation.
2017-09-13 11:36:49.811943195 User selected: 6) Abort Relax-and-Recover
2017-09-13 11:36:49.813350154 Error detected during restore.
2017-09-13 11:36:49.814571490 Restoring backup of /var/lib/rear/layout/disklayout.conf
2017-09-13 11:36:49.817068652 ERROR: There was an error restoring the system layout. See /var/log/rear/rear-iterelax01.log for details.
==== Stack trace ====
Trace 0: /bin/rear:538 main
Trace 1: /usr/share/rear/lib/recover-workflow.sh:22 WORKFLOW_recover
Trace 2: /usr/share/rear/lib/framework-functions.sh:95 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:49 Source
Trace 4: /usr/share/rear/layout/recreate/default/200_run_script.sh:65 source
Message: There was an error restoring the system layout. See /var/log/rear/rear-iterelax01.log for details.
== End stack trace ==
2017-09-13 11:36:49.821225283 Running exit tasks.
2017-09-13 11:36:49.823175789 Finished in 330 seconds
2017-09-13 11:36:49.824358941 Removing build area /tmp/rear.6nRwpcczyG6Mh6F
removed directory: `/tmp/rear.6nRwpcczyG6Mh6F'
2017-09-13 11:36:49.829686577 End of program reached
</code></pre>
<h4 id="schabrolles_commented_at_2017-09-13_1025"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329125807">2017-09-13 10:25</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_1025" title="Permanent link">&para;</a></h4>
<pre><code>2017-09-13 11:32:11.997593260 Including layout/prepare/default/320_apply_mappings.sh
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 56: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 56: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
/usr/share/rear/layout/prepare/default/320_apply_mappings.sh: line 107: ((: &lt; 12 : syntax error: operand expected (error token is "&lt; 12 ")
</code></pre>
<p>@sebaobi could you pleas show me the content of
<code>cat /etc/rear/os.conf</code><br />
it is like <code>$OS_VERSION</code> variable is not set on your system.</p>
<h4 id="sebaobi_commented_at_2017-09-13_1030"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329126972">2017-09-13 10:30</a>:<a class="headerlink" href="#sebaobi_commented_at_2017-09-13_1030" title="Permanent link">&para;</a></h4>
<pre><code>RESCUE relax01:~ # cat /etc/rear/os.conf
OS_VENDOR=SUSE_LINUX
OS_VERSION=
# The following information was added automatically by the mkrescue workflow:
ARCH='Linux-ppc64'
OS='GNU/Linux'
OS_VERSION=''
OS_VENDOR='SUSE_LINUX'
OS_VENDOR_VERSION='SUSE_LINUX/'
OS_VENDOR_ARCH='SUSE_LINUX/ppc64'
# End of what was added automatically by the mkrescue workflow.
</code></pre>
<h4 id="schabrolles_commented_at_2017-09-13_1034"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329127884">2017-09-13 10:34</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_1034" title="Permanent link">&para;</a></h4>
<p>Change <code>OS_VERSION=''</code> to <code>OS_VERSION='11'</code> and try to recover again. If
it works we will have a look why this variable was not set correctly
during <code>rear mkrescue</code>.</p>
<h4 id="sebaobi_commented_at_2017-09-13_1047"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329130755">2017-09-13 10:47</a>:<a class="headerlink" href="#sebaobi_commented_at_2017-09-13_1047" title="Permanent link">&para;</a></h4>
<p>Hehe thnx for this hint :), it seems almost perfect but now i have issue
with udev:</p>
<pre><code>RESCUE relax01:~ # rear -v recover
Relax-and-Recover 2.2-git.0.2658745.unknown.changed / 2017-08-03
Using log file: /var/log/rear/rear-relax01.log
Running workflow recover within the ReaR rescue/recovery system
Will do driver migration (recreating initramfs/initrd)
We will recover the following file systems from EMC NetWorker: / /tmp /var
Setting up multipathing
Activating multipath
multipath activated
mpathb  (253, 0)
mpathb (3600507680c8182613800000000000417) dm-0 IBM,2145
size=20G features='0' hwhandler='0' wp=rw
|-+- policy='round-robin 0' prio=0 status=active
| |- 1:0:2:0 sda 8:0  active undef running
| `- 2:0:0:0 sdc 8:32 active undef running
`-+- policy='round-robin 0' prio=0 status=enabled
  |- 1:0:3:0 sdb 8:16 active undef running
  `- 2:0:1:0 sdd 8:48 active undef running
Comparing disks.
Device mapper!relax01_rvg does not exist.
Switching to manual disk layout configuration.
Using /dev/mapper/mpathb (same size) for recreating /dev/mapper/relax01_rvg
Current disk mapping table (source -&gt; target):
    /dev/mapper/relax01_rvg /dev/mapper/mpathb
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default 1 timeout 300 seconds)
1
User confirmed disk mapping
Please confirm that '/var/lib/rear/layout/disklayout.conf' is as you expect.

1) View disk layout (disklayout.conf)  4) Go to Relax-and-Recover shell
2) Edit disk layout (disklayout.conf)  5) Continue recovery
3) View original disk space usage      6) Abort Relax-and-Recover
#? 5
Partition primary on /dev/mapper/mpathb: size reduced to fit on disk.
Please confirm that '/var/lib/rear/layout/diskrestore.sh' is as you expect.

1) View restore script (diskrestore.sh)
2) Edit restore script (diskrestore.sh)
3) View original disk space usage
4) Go to Relax-and-Recover shell
5) Continue recovery
6) Abort Relax-and-Recover
#? 5
Start system layout restoration.
Creating partitions for disk /dev/mapper/mpathb (msdos)
Creating LVM PV /dev/mapper/mpathb_part2
Creating LVM VG OS
Creating LVM volume OS/root
  Logical volume "root" created
Creating LVM volume OS/swap
  Logical volume "swap" created
Creating LVM volume OS/tmp
  Logical volume "tmp" created
Creating LVM volume OS/var
  Logical volume "var" created
Creating filesystem of type ext3 with mount point / on /dev/mapper/OS-root.
Mounting filesystem /
Creating filesystem of type ext3 with mount point /tmp on /dev/mapper/OS-tmp.
Mounting filesystem /tmp
Creating filesystem of type ext3 with mount point /var on /dev/mapper/OS-var.
Mounting filesystem /var
Creating swap on /dev/mapper/OS-swap
Disk layout created.
Starting nsrwatch on console 8
Restore filesystem / /tmp /var  with recover
Function 'iconv_open' failed for UTF-8 to ANSI conversion. The function may be unable to determine the current locale. Verify appropriate values in environment variables LC_MESSAGES, LC_ALL and LANG.
Restore the Mountpoints (with permissions) from /var/lib/rear/recovery/mountpoint_permissions
Updating udev configuration (70-persistent-net.rules)
ERROR: Could not copy '/etc/udev/rules.d/70-persistent-net.rules' -&gt; '/mnt/local//etc/udev/rules.d/70-persistent-net.rules'
Aborting due to an error, check /var/log/rear/rear-relax01.log for details
Terminated
</code></pre>
<p>Log:</p>
<pre><code>2017-09-13 12:32:09.219198132 Using build area '/tmp/rear.lVf2CxV7YcPa1Wk'
...skipping...
2017-09-13 12:33:03.905347824 Updating udev configuration (70-persistent-net.rules)
`/etc/udev/rules.d/70-persistent-net.rules' -&gt; `/mnt/local//etc/udev/rules.d/70-persistent-net.rules'
cp: cannot create regular file `/mnt/local//etc/udev/rules.d/70-persistent-net.rules': No such file or directory
2017-09-13 12:33:03.907776501 ERROR: Could not copy '/etc/udev/rules.d/70-persistent-net.rules' -&gt; '/mnt/local//etc/udev/rules.d/70-persistent-net.rules'
==== Stack trace ====
Trace 0: /bin/rear:538 main
Trace 1: /usr/share/rear/lib/recover-workflow.sh:26 WORKFLOW_recover
Trace 2: /usr/share/rear/lib/framework-functions.sh:95 SourceStage
Trace 3: /usr/share/rear/lib/framework-functions.sh:49 Source
Trace 4: /usr/share/rear/finalize/GNU/Linux/310_migrate_udev_rules.sh:36 source
Trace 5: /usr/share/rear/lib/_input-output-functions.sh:242 StopIfError
Message: Could not copy '/etc/udev/rules.d/70-persistent-net.rules' -&gt; '/mnt/local//etc/udev/rules.d/70-persistent-net.rules'
== End stack trace ==
2017-09-13 12:33:03.911742036 Running exit tasks.
2017-09-13 12:33:03.913542675 Finished in 54 seconds
2017-09-13 12:33:03.914707090 Removing build area /tmp/rear.lVf2CxV7YcPa1Wk
removed directory: `/tmp/rear.lVf2CxV7YcPa1Wk'
2017-09-13 12:33:03.919761121 End of program reached
</code></pre>
<h4 id="schabrolles_commented_at_2017-09-13_1058"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329132894">2017-09-13 10:58</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_1058" title="Permanent link">&para;</a></h4>
<p>I don't know <code>BACKUP=NSR</code>, but are you sure that the restoration works
?<br />
Tell me if you can enter in <code>/mnt/local/etc/udev/rules.d</code></p>
<h4 id="sebaobi_commented_at_2017-09-13_1103"><img src="https://avatars.githubusercontent.com/u/31764216?u=6322b380ea2e4a25884b27b5d0b0572b700cdf91&v=4" width="50"><a href="https://github.com/sebaobi">sebaobi</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329133886">2017-09-13 11:03</a>:<a class="headerlink" href="#sebaobi_commented_at_2017-09-13_1103" title="Permanent link">&para;</a></h4>
<p>Sure but something goes wrong because i can't see etc folder in
/mnt/local/ 👍</p>
<pre><code>RESCUE relax01:/mnt/local # df -h
Filesystem           Size  Used Avail Use% Mounted on
/dev/mapper/OS-root  6.0G  141M  5.6G   3% /mnt/local
/dev/mapper/OS-tmp   4.0G  137M  3.7G   4% /mnt/local/tmp
/dev/mapper/OS-var   4.0G  137M  3.7G   4% /mnt/local/var


RESCUE relax01:/mnt/local # cd /mnt/local/ ; pwd ; ls -al
/mnt/local
total 44
drwxr-xr-x  9 root root  4096 Sep 13 12:51 .
drwxr-xr-x  4 root root     0 Sep  8 13:01 ..
-rw-r--r--  1 root root     0 Sep 13 12:51 .autorelabel
drwxr-xr-x 15 root root  4096 Sep 13 12:51 dev
drwx------  2 root root 16384 Sep 13 12:51 lost+found
drwxr-xr-x  4 root root  4096 Sep 13 12:51 media
dr-xr-xr-x  2 root root  4096 Sep 13 12:51 proc
drwxr-xr-x  2 root root  4096 Sep 13 12:51 sys
drwxrwxrwt  3 root root  4096 Sep 13 12:51 tmp
drwxr-xr-x  3 root root  4096 Sep 13 12:51 var
</code></pre>
<h4 id="schabrolles_commented_at_2017-09-13_1104"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329134282">2017-09-13 11:04</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_1104" title="Permanent link">&para;</a></h4>
<p>I think there is some problem in your NSR backup configuration.<br />
@jsmeix any suggestion / comments ?</p>
<h4 id="jsmeix_commented_at_2017-09-13_1120"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329137438">2017-09-13 11:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-13_1120" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I am already looking... ;-)</p>
<h4 id="jsmeix_commented_at_2017-09-13_1138"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329141066">2017-09-13 11:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-13_1138" title="Permanent link">&para;</a></h4>
<p>@sebaobi<br />
I don't know about NSR but it looks<br />
as if the backup restore was incomplete.</p>
<p>After backup restore you must have at least all the usual files<br />
and directories back that are needed by the basic system.</p>
<p>When e.g. the etc/ directory is missing it is a fatal error<br />
in the backup restore and then subsequent ReaR scripts<br />
that run after the backup restore just fail because<br />
those scripts expect the usual files and directories<br />
below /mnt/local - see also<br />
<a href="https://github.com/rear/rear/pull/1457#issuecomment-327492288">https://github.com/rear/rear/pull/1457#issuecomment-327492288</a></p>
<p>Accordingly you should inspect your logs<br />
what exactly happpened during your particular<br />
NSR backup restore.</p>
<p>In your<br />
<a href="https://github.com/rear/rear/issues/1479#issuecomment-329130755">https://github.com/rear/rear/issues/1479#issuecomment-329130755</a><br />
there is only</p>
<pre>
Starting nsrwatch on console 8
Restore filesystem / /tmp /var  with recover
</pre>

<p>which are from<br />
usr/share/rear/restore/NSR/default/400_restore_with_nsr.sh<br />
plus a suspicious</p>
<pre>
Function 'iconv_open' failed for UTF-8 to ANSI conversion. The function may be unable to determine the current locale. Verify appropriate values in environment variables LC_MESSAGES, LC_ALL and LANG.
</pre>

<p>message where I cannot know wherefrom that comes.<br />
Perhapos it comes from the NSR 'recover' command in<br />
usr/share/rear/restore/NSR/default/400_restore_with_nsr.sh<br />
You need to inspect your log to find that out.<br />
If it is from the NSR 'recover' command it could indicate<br />
that the NSR backup restore failed (or failed at a certain point).</p>
<p>Regarding UTF-8 and ReaR see<br />
"Character encoding" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>Simply put:<br />
UTF-8 is not supported in ReaR.<br />
Only plain 7-bit ASCII (more precisely the POSIX/C locale)<br />
works in ReaR.</p>
<h4 id="jsmeix_commented_at_2017-09-13_1149"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329143331">2017-09-13 11:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-13_1149" title="Permanent link">&para;</a></h4>
<p>@schabrolles regarding OS_VERSION:<br />
I think with an empty predefined OS_VERSION<br />
in /etc/rear/os.conf the automated setting<br />
by the SetOSVendorAndVersion function<br />
in usr/share/rear/lib/config-functions.sh<br />
is skipped.</p>
<h4 id="schabrolles_commented_at_2017-09-13_1207"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329147189">2017-09-13 12:07</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-13_1207" title="Permanent link">&para;</a></h4>
<p>@jsmeix chat about adding a test in <code>config-functions.sh</code></p>
<pre><code>if (test "$OS_VERSION" = none || test -z "$OS_VERSION")  ; then
    OS_VERSION="$( lsb_release -r -s | tr -s '[:blank:]' '_' )"
    test "$OS_VERSION" || Error "Failed to detect OS_VERSION. You may manually specify it in $CONFIG_DIR/os.conf"
fi
</code></pre>
<h4 id="jsmeix_commented_at_2017-09-13_1259"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329159634">2017-09-13 12:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-13_1259" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I think the comment</p>
<pre>
# If OS_VERSION has the default value, detect the actual value:
</pre>

<p>means that any predefined value should be accepted at this place<br />
which is o.k. for me because in general I prefer to<br />
"give the user the final power".</p>
<p>I think testing only for empty OS_VERSION is insufficient<br />
because the user could have set something invalid.</p>
<p>I think in the particular code that depends on<br />
particular OS_VERSION values, there could be an<br />
assertion with an Error exit if something invalid is used.</p>
<p>As far as I see in<br />
<a href="https://github.com/rear/rear/issues/1479#issuecomment-329125807">https://github.com/rear/rear/issues/1479#issuecomment-329125807</a><br />
I assume that code is in the get_part_device_name_format<br />
function therein via OS_MASTER_VERSION which is set<br />
from the OS_VERSION value by SetOSVendorAndVersion.<br />
The current code in the get_part_device_name_format<br />
uses "if OS_MASTER_VERSION ... else ... fi" which means<br />
the else clause is also used when OS_MASTER_VERSION<br />
has a totally unexpected value.</p>
<p>I don't know what the right way is:<br />
A generic test at a central place that<br />
certain variables have right values,<br />
cf.
<a href="https://github.com/rear/rear/pull/1440">https://github.com/rear/rear/pull/1440</a><br />
or<br />
testing as needed at each place in the code?</p>
<p>The former requires continuous maintenance to keep<br />
that central test up-to-date but all is at one place<br />
while the latter has that functionality spread over<br />
the whole code but the latter may work better<br />
in real life pactice?</p>
<p>Personally I prefer assertions as needed<br />
at each place in the code.</p>
<h4 id="jsmeix_commented_at_2017-09-14_0838"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329414240">2017-09-14 08:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-14_0838" title="Permanent link">&para;</a></h4>
<p>@schabrolles FYI<br />
in general regarding code that depends on OS_VENDOR<br />
or OS_VERSION or similar vendor or version strings see<br />
<a href="https://github.com/rear/rear/issues/1368#issuecomment-302410707">https://github.com/rear/rear/issues/1368#issuecomment-302410707</a></p>
<p>That reads in particular (excerpts):</p>
<pre>
we cannot rely on what version strings
the system tells about itself.
We must inspect "the real thing",
i.e. the really existing ... stuff.
When we inspect the really existing ... stuff
it means ... ReaR works generically.
...
I think Linux distribution specific scripts or
even special Linux distribution version specific scripts
will not really help because in the end any user on any
recent Linux system can manually create any[thing]
so that in the end only generically working ... scripts
could properly implement [anything] in ReaR.
</pre>

<p>Accordingly the OS_MASTER_VENDOR/OS_MASTER_VERSION<br />
specific behaviour of the get_part_device_name_format() function<br />
should ideally be replaced by inspecting "the real thing"<br />
on the current system and then do "the right thing"<br />
according to what there really is on the current system.<br />
But I don't know if it is possible in this case to autodetect<br />
what "the real thing" is on the current system.</p>
<p>If inspecting "the real thing" does not work,<br />
using vendor or version strings is the only feasible way out.</p>
<p>When using vendor or version strings is the only way,<br />
the code of get_part_device_name_format() works<br />
sufficiently well because in particular the (SUSE) case<br />
tests the old way (SLES11 - which will eventually die out)<br />
and uses the current way (since SLES12) by default and<br />
as fallback.</p>
<p>When a user has OS_VERSION explicitly set to an<br />
invalid value, it will still work for the current way<br />
and only in case of the old way it will fail.<br />
From my point of view this is totally acceptable.<br />
We do not need to overengineer the ReaR code<br />
to be fail-safe for any possible misconfiguration.</p>
<h4 id="schabrolles_commented_at_2017-09-14_1607"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329530867">2017-09-14 16:07</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-14_1607" title="Permanent link">&para;</a></h4>
<p>@jsmeix I agree .... But in the case of
get_part_device_name_format(), I don't really know how we can do
that ....<br />
get_part_device_name_format() is called by apply_layout_mappings()
during disk layout migration step.<br />
It will generate diskrestore.sh script and migrate
<code>sda2 =&gt; mpatha-part2</code> or the other way <code>mpatha-part2 =&gt; vda2</code></p>
<p>Before the generation of diskrestore.sh script, there is no way to check
how the current system will name multipath devices partitions (p1,
_part1, -part1 etc....) because no partition has been created yet.
That's why I decided to use the OS_VERSION (or OS_MASTER_VENDOR). I
know it is not the best way ...</p>
<p>The only alternative is to dig into the udev scripts to try to find and
understand how the mpath partition will be named (not easy and not
really reliable as script are different for each version/distro, they
can change...).</p>
<p>If you have a better idea, please tell me (I will also try to have a
second look on it)</p>
<hr />
<p>Regarding this issue, I think there where some old data with
<code>empty OS_VERSION</code> when the rescue script ran. that's why you got the
message
<code># The following information was added automatically by the mkrescue workflow:</code>
at the third line (usually it is on the first one).<br />
As you said, because it was set <code>OS_VERSION=</code>, ReaR doesn't try to get
it via lsb-release when rescue workflow occured.</p>
<h4 id="jsmeix_commented_at_2017-09-15_0853"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329722718">2017-09-15 08:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-15_0853" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
many thanks for your detailed explanation why in this case<br />
using vendor or version strings is the only reasonable way<br />
(digging into udev will make you lose your reason ;-)</p>
<p>Regarding<br />
"ReaR doesn't try to get it via lsb-release when rescue workflow":<br />
There is no lsb-release program in the ReaR recovery system.<br />
On my SLES12 system the /usr/bin/lsb_release script<br />
seems to work in the ReaR recovery system:</p>
<pre>
RESCUE e205:~ # scp root@e205:/usr/bin/lsb_release /usr/bin/lsb_release

RESCUE e205:~ # type -a lsb_release
lsb_release is /bin/lsb_release

RESCUE e205:~ # lsb_release -i -s
SUSE

RESCUE e205:~ # lsb_release -r -s
12.2

RESCUE e205:~ # cat /etc/os-release 
NAME="SLES"
VERSION="12-SP2"
VERSION_ID="12.2"
PRETTY_NAME="SUSE Linux Enterprise Server 12 SP2"
ID="sles"
ANSI_COLOR="0;32"
CPE_NAME="cpe:/o:suse:sles:12:sp2"
</pre>

<p>But even lsb_release in the ReaR recovery system<br />
won't help in this case here because the user had<br />
specified an invalid value for OS_VERSION<br />
in his config file and ReaR must obey what the<br />
user has explicity specified.</p>
<p>I think the user must have the final power to even<br />
specify invalid values.<br />
I think a computer program must never ever make a final decision<br />
against something its master (i.e. the user) has commanded.</p>
<p>A good example is nowadays "rm -rf /":</p>
<pre>
# rm -rf /
rm: it is dangerous to operate recursively on '/'
rm: use --no-preserve-root to override this failsafe

# rm -rf --no-preserve-root /
[what the user commanded happens]
</pre>

<p>What is problematic with the OS_VENDOR and OS_VERSION<br />
variables in ReaR is that they do not behave in compliance with<br />
many (but not all!) other ReaR config variables because<br />
for the OS_VENDOR and OS_VERSION variables the<br />
lsb_release automatism is used in SetOSVendorAndVersion only</p>
<pre>
if test "$OS_VENDOR" = generic -o "$OS_VERSION" = none
</pre>

<p>in contrast to other ReaR config variables because:<br />
Often when a ReaR config variable is empty it tells ReaR to<br />
"do something automatic", cf. default.conf</p>
<pre>
# Most variables can be set to an empty
# value VAR= which means that this
# setting is off or set to some automatic mode.
</pre>

<p>but note the 'most' (i.e. not all) and<br />
the 'off or automatic' therein and note also in default.conf</p>
<pre>
# In case of doubt inspect the scripts
# how exactly a particular variable works.
</pre>

<p>and the OS_VENDOR and OS_VERSION variables<br />
are described (shortly) in default conf and nothing there<br />
indicates that empy values "do it right automatically".<br />
I think the current OS_VENDOR and OS_VERSION behaviour<br />
is probably not ideal but that "possibly unexpected behaviour"<br />
also could happen is sufficiently documented.<br />
Furthermore:<br />
Setting a OS_VENDOR or OS_VERSION variable<br />
explicitly to an empty value should raise the question<br />
what then happens - i.e. how then things behave that<br />
depend on OS_VENDOR or OS_VERSION (if nothing<br />
depends on them there would be no such variables).</p>
<h4 id="schabrolles_commented_at_2017-09-15_0911"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329726685">2017-09-15 09:11</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-09-15_0911" title="Permanent link">&para;</a></h4>
<p>@jsmeix When I say <em>"ReaR doesn't try to get it via lsb-release when
rescue workflow":</em><br />
I mean when <code>rear mkrescue</code> command was process .... this mean on the
source system, during backup/mkrescue process; not when the system is in
rescue mode. I may be not use the good workflow name (my mistake)</p>
<h4 id="jsmeix_commented_at_2017-09-15_0924"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-329729997">2017-09-15 09:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-15_0924" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
ah! - thanks for clarification.</p>
<p>Via<br />
<a href="https://github.com/rear/rear/commit/efd5537ae18ffb9eb82594c5891fb22aa17b5920">https://github.com/rear/rear/commit/efd5537ae18ffb9eb82594c5891fb22aa17b5920</a><br />
I added more explanatory descriptions for the<br />
OS_VENDOR and OS_VERSION variables<br />
in default.conf.</p>
<h4 id="jsmeix_commented_at_2017-10-06_1400"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1479#issuecomment-334763307">2017-10-06 14:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-10-06_1400" title="Permanent link">&para;</a></h4>
<p>Because "no news is good news" I assume<br />
the questions are sufficiently answered<br />
so that I can close this issue.<br />
If the same issue persists this issue report can be reopened but<br />
new and different issues need new and separated issue reports.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-09-08.1479.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
