<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2854 PR closed: skip LVM PVs mounted on /dev/loop - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2854 PR closed: skip LVM PVs mounted on /dev/loop";
        var mkdocs_page_input_path = "issues/2022-08-31.2854.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2854 PR closed: skip LVM PVs mounted on /dev/loop</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2854_pr_closed_skip_lvm_pvs_mounted_on_devloop"><a href="https://github.com/rear/rear/pull/2854">#2854 PR</a> <code>closed</code>: skip LVM PVs mounted on /dev/loop<a class="headerlink" href="#2854_pr_closed_skip_lvm_pvs_mounted_on_devloop" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>minor bug</code>, <code>no-pr-activity</code></p>
<h4 id="david-hill_opened_issue_at_2022-08-31_1248"><img src="https://avatars.githubusercontent.com/u/6233278?v=4" width="50"><a href="https://github.com/david-hill">david-hill</a> opened issue at <a href="https://github.com/rear/rear/pull/2854">2022-08-31 12:48</a>:<a class="headerlink" href="#david-hill_opened_issue_at_2022-08-31_1248" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong> / <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2853">https://github.com/rear/rear/issues/2853</a></p>
</li>
<li>
<p>How was this pull request tested?</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>Skip physical volumes that are created on loop back devices like</p>
<pre><code>/dev/loop0p2:cinder_volume:996853760:-1:8:8:-1:4096:121686:41046:80640:something
</code></pre>
<h4 id="devil0000_commented_at_2022-09-01_1400"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1234322595">2022-09-01 14:00</a>:<a class="headerlink" href="#devil0000_commented_at_2022-09-01_1400" title="Permanent link">&para;</a></h4>
<p>#2853</p>
<h4 id="jsmeix_commented_at_2022-09-08_1311"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1240698170">2022-09-08 13:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-08_1311" title="Permanent link">&para;</a></h4>
<p>@david-hill<br />
thank you for your code enhancements.</p>
<h4 id="jsmeix_commented_at_2022-09-08_1312"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1240699279">2022-09-08 13:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-08_1312" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
when there are no objections<br />
I would like to merge it tomorrow afternoon.</p>
<h4 id="pcahyna_commented_at_2022-09-08_1601"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1240917067">2022-09-08 16:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-08_1601" title="Permanent link">&para;</a></h4>
<p>It is not really an objection, but I would like to understand why is it
needed when no such condition is needed for filesystems that sit
directly on top of /dev/loop without LVM. At least, I don't see any such
condition in the code.</p>
<h4 id="jsmeix_commented_at_2022-09-08_1605"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1240921299">2022-09-08 16:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-08_1605" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
no problem - I will wait with merging it<br />
until we understand how this happens because<br />
perhaps the fix here is not (yet) the exact right one.</p>
<h4 id="david-hill_commented_at_2022-09-08_1615"><img src="https://avatars.githubusercontent.com/u/6233278?v=4" width="50"><a href="https://github.com/david-hill">david-hill</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1240932872">2022-09-08 16:15</a>:<a class="headerlink" href="#david-hill_commented_at_2022-09-08_1615" title="Permanent link">&para;</a></h4>
<p>I didn't personally hit this issue and it's probably easy to reproduce .
Create a file in /var/run/tmp of 10GB, create a LVM PV/VG on it and no
LVs. Mount it as a loopback device (I think it's the only way)</p>
<h4 id="pcahyna_commented_at_2022-09-12_0808"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1243366976">2022-09-12 08:08</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-12_0808" title="Permanent link">&para;</a></h4>
<p>Thank you @david-hill for the information, I will attempt a reproducer
myself.</p>
<h4 id="pcahyna_commented_at_2022-09-19_1332"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1251027687">2022-09-19 13:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-19_1332" title="Permanent link">&para;</a></h4>
<p>I tried the proposed patch and even if we agree that skipping loop
devices is what we want (cf.
<a href="https://github.com/rear/rear/issues/2865">https://github.com/rear/rear/issues/2865</a>
), this approach is not entirely correct. While the patch fixes the case
where there is no LV in the VG that resides on the loop device, it leads
to another error when there actually is a LV - to demonstrate, this:</p>
<pre><code>dd if=/dev/zero of=/var/tmp/loopvol bs=1024 count=102400
losetup /dev/loop0 /var/tmp/loopvol
pvcreate --yes /dev/loop0
vgcreate myvg /dev/loop0
lvcreate -y -n  my_lv  myvg -L 50M
rear savelayout
</code></pre>
<p>results in this error</p>
<pre><code>LVM no 'lvmdev /dev/myvg' for 'lvmvol /dev/myvg'
ERROR: 
====================
BUG in /usr/share/rear/layout/save/default/950_verify_disklayout_file.sh line 254:
'Entries in /var/lib/rear/layout/disklayout.conf are broken ('rear recover' would fail)'
</code></pre>
<p>The problem apparently is that the patch skips PVs on loop devices, but
it does not exclude the VGs and LVs residing on them - the resulting
layout has:</p>
<pre><code>lvmgrp /dev/myvg 4096 24 98304
lvmvol /dev/myvg my_lv 54525952b linear
</code></pre>
<p>and no matching <code>lvmdev /dev/myvg</code> indeed. Exclusion would have to
become more comprehensive in order to make this work.</p>
<h4 id="gdha_commented_at_2022-09-19_1341"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1251038194">2022-09-19 13:41</a>:<a class="headerlink" href="#gdha_commented_at_2022-09-19_1341" title="Permanent link">&para;</a></h4>
<p>@pcahyna @jsmeix <strong>What is a loop device?</strong></p>
<p><em>The loop device is a block device that maps its data blocks not to a
physical device such as a hard disk or optical disk drive, but to the
blocks of a regular file in a filesystem or to another block device.</em></p>
<p>Is it not the purpose of ReaR to map only physical devices? Or, do we
make our scope wider to also cover loop devices? When we decide on this
we can continue to work on this PR or just skipt it...</p>
<h4 id="jsmeix_commented_at_2022-09-19_1448"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1251128373">2022-09-19 14:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-09-19_1448" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
thank you for the explanation what a loop device really is.<br />
(My personal usage of loop mounts was always only this way.)</p>
<p>As far as I understand it this means<br />
ReaR should not care about loop devices<br />
and what is mounted there.</p>
<p>My reasoning (as far as I understand it):</p>
<p>When something is mounted at a loop device<br />
that something is a file or another block device.</p>
<ol>
<li></li>
</ol>
<p>When it is a file this file is restored from the backup.</p>
<ol>
<li></li>
</ol>
<p>When it is another block device and that other block device<br />
is a physical device this physical device is recreated<br />
by "rear recover" and its data is restored from the backup.</p>
<ol>
<li></li>
</ol>
<p>When it is another block device but this other block device<br />
is not a physical device but a higher level storage device<br />
this higher level storage device is also recreated<br />
by "rear recover" and its data is restored from the backup.</p>
<ol>
<li></li>
</ol>
<p>When it is another block device but this other block device<br />
is neither a physical device nor a higher level storage device<br />
then I don't know what to do - I hope this case does not happen.</p>
<p>As far as I can imagine this are all possible cases.</p>
<p>For the above cases 1, 2, and 3 the actual data<br />
must be restored from the backup.<br />
When it is missing in the backup there is nothing<br />
what ReaR could do (it is the user's task to ensure<br />
his backup contains what he needs to recreate his system).</p>
<p>With the backup restore also config files get restored<br />
so some config file could specify the loop mount<br />
to let the system boot with automated loop mount<br />
so also after "rear recover" the system will<br />
reboot with that automated loop mount,<br />
otherwise (when that loop mount is in no config file)<br />
the system should boot without the loop mount<br />
which means that loop mount was done manually<br />
and ReaR should not care about manual loop mounts.</p>
<h4 id="pcahyna_commented_at_2022-09-19_1628"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1251253537">2022-09-19 16:28</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-09-19_1628" title="Permanent link">&para;</a></h4>
<p>@jsmeix I suggest to continue the discussion of the merits of the
proposal in #2865 , and discuss here only the details of the
implementation (once we agree that it should be implemented). Concerning
your last comment, "When something is mounted at a loop device that
something is a file or another block device." this sounds confusing,
because it seems you are speaking about the backing store the loop
device is attached to (like a disk image file), rather than about what
is mounted on the loop device (like a filesystem).</p>
<h4 id="github-actions_commented_at_2022-11-19_0259"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/pull/2854#issuecomment-1320767127">2022-11-19 02:59</a>:<a class="headerlink" href="#github-actions_commented_at_2022-11-19_0259" title="Permanent link">&para;</a></h4>
<p>Stale pull request message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-08-31.2854.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
