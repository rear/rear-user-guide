<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2548 Issue closed: GPT table creation does not recover old disk and partition GUIDs - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2548 Issue closed: GPT table creation does not recover old disk and partition GUIDs";
        var mkdocs_page_input_path = "issues/2020-12-21.2548.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2548 Issue closed: GPT table creation does not recover old disk and partition GUIDs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2548_issue_closed_gpt_table_creation_does_not_recover_old_disk_and_partition_guids"><a href="https://github.com/rear/rear/issues/2548">#2548 Issue</a> <code>closed</code>: GPT table creation does not recover old disk and partition GUIDs<a class="headerlink" href="#2548_issue_closed_gpt_table_creation_does_not_recover_old_disk_and_partition_guids" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>won't fix / can't fix / obsolete</code>, <code>minor bug</code></p>
<h4 id="devil0000_opened_issue_at_2020-12-21_1829"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> opened issue at <a href="https://github.com/rear/rear/issues/2548">2020-12-21 18:29</a>:<a class="headerlink" href="#devil0000_opened_issue_at_2020-12-21_1829" title="Permanent link">&para;</a></h4>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"): 2.6</li>
<li>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"): ubuntu 20.04</li>
<li>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): uefi/grub</li>
<li>Partition table type on system: gpt</li>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    After a recover a new UEFI boot entry gets created for the recovered
    efi since the GPT partition GUID changed.<br />
    Of course this is more a minor issue only affecting people making
    use of multiple boot options tried to boot in order.<br />
    This however has two side effects:<ol>
<li>it changes the boot order putting the recovered efi partition as
    first</li>
<li>it fills the boot records list with another entry keeping the
    old one (getting messy and maybe running out of entries over
    time)</li>
</ol>
</li>
<li>Workaround/solution:<br />
    There are at least two possible workarounds/fixes possible for this:<ul>
<li>one can cleanup the old efi boot entries and set the boot order
    again (manually or with e.g. evibootmgr)</li>
<li>one can replace the GUID (e.g. using gdisk or sgdisk) and use
    the old efi boot entry</li>
</ul>
</li>
</ul>
<p>The complete fix for rear would be also writing GPT GUIDs to the layout
file and then setting them e.g. with sgdisk.</p>
<h4 id="gdha_commented_at_2021-01-08_1105"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-756696635">2021-01-08 11:05</a>:<a class="headerlink" href="#gdha_commented_at_2021-01-08_1105" title="Permanent link">&para;</a></h4>
<p>@DEvil0000 No interest in writing a PR for your proposal?</p>
<h4 id="gdha_commented_at_2021-01-12_1646"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-758786571">2021-01-12 16:46</a>:<a class="headerlink" href="#gdha_commented_at_2021-01-12_1646" title="Permanent link">&para;</a></h4>
<p>@DEvil0000 PR has been merged, if you could recheck if all goes well?</p>
<h4 id="devil0000_commented_at_2021-01-13_1127"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-759387522">2021-01-13 11:27</a>:<a class="headerlink" href="#devil0000_commented_at_2021-01-13_1127" title="Permanent link">&para;</a></h4>
<p>The vfat ID now gets set for the UEFI partition but the GPT partition
GUID (not type id) is still newly generated and was not addressed by
#2546</p>
<h4 id="gdha_commented_at_2021-01-22_1647"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-765544933">2021-01-22 16:47</a>:<a class="headerlink" href="#gdha_commented_at_2021-01-22_1647" title="Permanent link">&para;</a></h4>
<p>@DEvil0000 Sorry for the delay in answer - please show us what is really
missing here - it seems we misunderstood</p>
<h4 id="devil0000_commented_at_2021-01-22_1726"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-765569381">2021-01-22 17:26</a>:<a class="headerlink" href="#devil0000_commented_at_2021-01-22_1726" title="Permanent link">&para;</a></h4>
<p>A efi boot entry contains <code>disk</code>, <code>partition</code> and <code>efi payload path</code>.
There may also be a filesystem ID/UUID but thats not what this ticket is
about.<br />
Example UEFI boot entries (might use less details or different ids and
methods - UEFI records are quite a beast):</p>
<pre><code>Boot0019* Ubuntu 1  HD(1,800,32000,a44dc908-e0d1-4df5-903f-a8db5f6f66b3)File(\EFI\ubuntu\grubx64.efi)
Boot001A* Ubuntu 2  HD(4,df6609e,2fbe1,773a0059-be41-4828-944a-32217f941c95)File(\EFI\ubuntu\grubx64.efi)
</code></pre>
<p>The <code>disk</code> may be referenced by its bios id (a integer based on boot
order bios settings normally) or by a disk UUID. See <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table">wiki (Partition
table header, offset
0x38)</a> for GPT but I
think msdos has the same thing at the same offset in this case.</p>
<p>When using a msdos <code>partition</code> table the partitions are numberd from 1-4
or such. For an UEFI boot (payload) record you reference the partition
id then.<br />
When using GPT partition tables the partitions have a UUID for the
partition type and a UUID for the actual partition. See <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table">wiki (Partition
entries, offset
0x10)</a>. This
<code>Unique partition GUID</code> must get recovered so existing old UEFI boot
entries still match otherwise the system BIOS/Firmware will create a new
entry or you would need to create one manually.</p>
<p>So when using a GPT partition table and UEFI you should definitely save
the GPT UUIDs (disk and partition) and also insert those when creating
the partition on recover. This way you restore the system "as it was".<br />
Then you will not face any issues with UEFI and existing boot entries.</p>
<p>Edit:<br />
My proposal is to also store those GPT UUIDs in the layout file and
write them correctly to GPT when created.<br />
There is also a GPT partition name which you might need to recover -
don't remember if that was recovered.<br />
BTW I am using USB method if that makes a difference.</p>
<h4 id="gdha_commented_at_2021-01-25_1407"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-766840372">2021-01-25 14:07</a>:<a class="headerlink" href="#gdha_commented_at_2021-01-25_1407" title="Permanent link">&para;</a></h4>
<p>@DEvil0000 Not all system are equal it seems - my UEFI knowledge became
a bit rusty...</p>
<pre><code>root@velo:~# efibootmgr 
BootCurrent: 0004
Timeout: 0 seconds
BootOrder: 0004,0003,0000,0001
Boot0000* UEFI Micron 2200S NVMe 512GB 194624E8DCEE 1
Boot0001* Linux Firmware Updater
Boot0003* UEFI Micron 2200S NVMe 512GB 194624E8DCEE 1 2
Boot0004* ubuntu

root@velo:~# parted /dev/nvme0n1 print
Model: Micron 2200S NVMe 512GB (nvme)
Disk /dev/nvme0n1: 512GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name                  Flags
 1      1049kB  819MB   818MB   fat32        EFI system partition  boot, esp
 2      819MB   6188MB  5369MB  fat32        Basic data partition  msftres
 3      6188MB  512GB   506GB   ext4
</code></pre>
<p>Not sure where to start? @gozora Do you have some more insights on these
matters?</p>
<h4 id="gozora_commented_at_2021-01-26_0731"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2548#issuecomment-767359358">2021-01-26 07:31</a>:<a class="headerlink" href="#gozora_commented_at_2021-01-26_0731" title="Permanent link">&para;</a></h4>
<p>Let us not forget that there are also users that are migrating to
different HW. For this group of people recreating all the UEFI boot
configuration entries make little sense.<br />
I think that current minimalist approach, that adds just entry for newly
restored system, is good because it is simple. If one is concerned about
mess in boot entries, he can easily clean it up (using <code>efibootmgr</code>).</p>
<p>Of course if anybody is willing to cover this complex topic with a pull
request, I have no objections.</p>
<p>Hope it helps.</p>
<p>V.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-12-21.2548.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
