<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2820 Issue closed: wipefs will fail - Follow-up error: "/var/lib/rear/layout/diskrestore.sh: line 280: 3560 Aborted (core dumped)" - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2820 Issue closed: wipefs will fail - Follow-up error: \"/var/lib/rear/layout/diskrestore.sh: line 280: 3560 Aborted (core dumped)\"";
        var mkdocs_page_input_path = "issues/2022-06-10.2820.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2820 Issue closed: wipefs will fail - Follow-up error: "/var/lib/rear/layout/diskrestore.sh: line 280: 3560 Aborted (core dumped)"</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2820_issue_closed_wipefs_will_fail_-_follow-up_error_varlibrearlayoutdiskrestoresh_line_280_3560_aborted_core_dumped"><a href="https://github.com/rear/rear/issues/2820">#2820 Issue</a> <code>closed</code>: wipefs will fail - Follow-up error: "/var/lib/rear/layout/diskrestore.sh: line 280: 3560 Aborted (core dumped)"<a class="headerlink" href="#2820_issue_closed_wipefs_will_fail_-_follow-up_error_varlibrearlayoutdiskrestoresh_line_280_3560_aborted_core_dumped" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="githopp192_opened_issue_at_2022-06-10_1347"><img src="https://avatars.githubusercontent.com/u/32612067?u=b6007aaa015ff323addaf197670b509febc7c77c&v=4" width="50"><a href="https://github.com/Githopp192">Githopp192</a> opened issue at <a href="https://github.com/rear/rear/issues/2820">2022-06-10 13:47</a>:<a class="headerlink" href="#githopp192_opened_issue_at_2022-06-10_1347" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):</li>
</ul>
<p>Relax-and-Recover 2.6 / 2020-06-17</p>
<ul>
<li>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</li>
</ul>
<!-- -->

<pre><code>VERSION="8.5 (Ootpa)"
ID="rhel"
ID_LIKE="fedora"
VERSION_ID="8.5"
PLATFORM_ID="platform:el8"
PRETTY_NAME="Red Hat Enterprise Linux 8.5 (Ootpa)"
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>BACKUP=BACULA
export TMPDIR="/home/TMPDIR"
COPY_AS_IS_BACULA=( /usr/lib64/libbac* /opt/bacula/working /etc/bacula /var/spool/bacula )
COPY_AS_IS_EXCLUDE_BACULA=( /var/lib/bacula )
PROGS_BACULA=( bacula bacula-fd bconsole bacula-console bextract bls bscan btape smartctl gawk )
BACULA_CLIENT=baculaclient-fd
CLONE_ALL_USERS_GROUPS=y
OUTPUT_URL=nfs://nas/volumex/Backup/REAR
OUTPUT_PREFIX=server2.opn9.9opn
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    HP Proliant DL360 G7</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):</p>
</li>
</ul>
<p>BIOS, Bootloader GRUB</p>
<ul>
<li>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):</li>
</ul>
<p>local disks (DM (mdadm))</p>
<ul>
<li>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</li>
</ul>
<!-- -->

<pre><code>NAME                                 KNAME      PKNAME     TRAN TYPE  FSTYPE            LABEL             SIZE MOUNTPOINT
/dev/sda                             /dev/sda              sas  disk                                    279.4G
|-/dev/sda1                          /dev/sda1  /dev/sda        part  ext4                                  1G /mnt/local/boot
`-/dev/sda2                          /dev/sda2  /dev/sda        part  linux_raid_member server2:pv00 278.4G
  `-/dev/md127                       /dev/md127 /dev/sda2       raid1 LVM2_member                       278.2G
    |-/dev/mapper/cl_server2-home /dev/dm-0  /dev/md127      lvm   xfs               home               60G /mnt/local/home
    |-/dev/mapper/cl_server2-root /dev/dm-1  /dev/md127      lvm   xfs               root               50G /mnt/local
    `-/dev/mapper/cl_server2-swap /dev/dm-2  /dev/md127      lvm   swap              swap               20G
/dev/sdb                             /dev/sdb              sas  disk                                    279.4G
`-/dev/sdb1                          /dev/sdb1  /dev/sdb        part  linux_raid_member server2:pv00 278.4G
  `-/dev/md127                       /dev/md127 /dev/sdb1       raid1 LVM2_member                       278.2G
    |-/dev/mapper/cl_server2-home /dev/dm-0  /dev/md127      lvm   xfs               home               60G /mnt/local/home
    |-/dev/mapper/cl_server2-root /dev/dm-1  /dev/md127      lvm   xfs               root               50G /mnt/local
    `-/dev/mapper/cl_server2-swap /dev/dm-2  /dev/md127      lvm   swap              swap               20G
/dev/sdc                             /dev/sdc              usb  disk                                      1.9G
`-/dev/sdc1                          /dev/sdc1  /dev/sdc        part  vfat              RELAXRECOVE       1.9G
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>wipefs will fail: ( and "/var/lib/rear/layout/diskrestore.sh: line 280:
3560 Aborted (core dumped)")</p>
<pre><code>+++ Log 'Creating filesystem of type xfs with mount point / on /dev/mapper/server2-root.'
+++ echo '2022-06-10 12:37:20.597201555 Creating filesystem of type xfs with mount point / on /dev/mapper/server2-root.'
2022-06-10 12:37:20.597201555 Creating filesystem of type xfs with mount point / on /dev/mapper/server2-root.
+++ Print 'Creating filesystem of type xfs with mount point / on /dev/mapper/server2-root.'
+++ wipefs --all --force /dev/mapper/server2-root
wipefs: error: /dev/mapper/server2-root: probing initialization failed: No such file or directory
+++ wipefs --all /dev/mapper/server2-root
wipefs: error: /dev/mapper/server2-root: probing initialization failed: No such file or directory
+++ dd if=/dev/zero of=/dev/mapper/server2-root bs=512 count=1
1+0 records in
1+0 records out
512 bytes copied, 3.9181e-05 s, 13.1 MB/s
+++ mkfs.xfs -f -m uuid=37c0e068-87f8-4cf4-bf8a-840c443f1720 -i size=512 -d agcount=4 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=1 -b size=4096 -i maxpct=25 -d sunit=0 -d swidth=0 -l version=2 -l lazy-count=1 -n size=4096 -n version=2 -r extsize=4096 /dev/mapper/server2-root
mkfs.xfs: xfs_mkfs.c:2569: validate_datadev: Assertion `cfg-&gt;dblocks' failed.
/var/lib/rear/layout/diskrestore.sh: line 280:  3558 Aborted                 (core dumped) mkfs.xfs -f -m uuid=37c0e068-87f8-4cf4-bf8a-840c443f1720 -i size=512 -d agcount=4 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=1 -b size=4096 -i maxpct=25 -d sunit=0 -d swidth=0 -l version=2 -l lazy-count=1 -n size=4096 -n version=2 -r extsize=4096 /dev/mapper/server2-root 1&gt;&amp;2
+++ mkfs.xfs -f -i size=512 -d agcount=4 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=1 -b size=4096 -i maxpct=25 -d sunit=0 -d swidth=0 -l version=2 -l lazy-count=1 -n size=4096 -n version=2 -r extsize=4096 /dev/mapper/server2-root
mkfs.xfs: xfs_mkfs.c:2569: validate_datadev: Assertion `cfg-&gt;dblocks' failed.
/var/lib/rear/layout/diskrestore.sh: line 280:  3560 Aborted                 (core dumped) mkfs.xfs -f -i size=512 -d agcount=4 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=1 -b size=4096 -i maxpct=25 -d sunit=0 -d swidth=0 -l version=2 -l lazy-count=1 -n size=4096 -n version=2 -r extsize=4096 /dev/mapper/server2-root 1&gt;&amp;2
2022-06-10 12:37:20.622458874 UserInput: called in /usr/share/rear/layout/recreate/default/200_run_layout_code.sh line 127
2022-06-10 12:37:20.628167932 UserInput: Default input in choices - using choice number 1 as default input
2022-06-10 12:37:20.630880621 The disk layout recreation script failed
</code></pre>
<p>run the command manually wih <strong>"&lt;&lt;&lt;y" will fail:</strong></p>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>run the command manually lvm lvcreate :</p>
<p><strong>lvm lvcreate -L 53687091200b -n root cl_server2 &lt;&lt;&lt;y</strong></p>
<pre><code>WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 14336. Wipe it? [y/n]: 
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 15360. Wipe it? [y/n]: [n]
  Aborted wiping of xfs_external_log.
  1 existing signature left on the device.
  Failed to wipe signatures on logical volume cl_server2/root.
  Aborting. Failed to wipe start of new LV.
</code></pre>
<p><strong>run the command: lvm create without "&lt;&lt;&lt;y" will succeed:</strong></p>
<pre><code>RESCUE server2:~ # lvm lvcreate -L 53687091200b -n root cl_server2
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 15360. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 16384. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 17408. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 18432. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 19456. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 20480. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 21504. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
WARNING: xfs_external_log signature detected on /dev/cl_server2/root at offset 22528. Wipe it? [y/n]: y
  Wiping xfs_external_log signature on /dev/cl_server2/root.
  Logical volume "root" created.
</code></pre>
<p>Afterwards REAR did complete successfully.</p>
<ul>
<li>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</li>
</ul>
<p>To paste verbatim text like command output or file content,<br />
include it between a leading and a closing line of three backticks like</p>
<pre><code>```
verbatim content
```
</code></pre>
<h4 id="jsmeix_commented_at_2022-06-13_0920"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153681719">2022-06-13 09:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_0920" title="Permanent link">&para;</a></h4>
<p>The <code>&lt;&lt;&lt;y</code> in <code>lvm lvcreate ... $vg &lt;&lt;&lt;y</code> in<br />
usr/share/rear/layout/prepare/GNU/Linux/110_include_lvm_code.sh<br />
originates from<br />
<a href="https://github.com/rear/rear/commit/5bc24808da0a5d2b6d711c428fef0aa415f2fc01">https://github.com/rear/rear/commit/5bc24808da0a5d2b6d711c428fef0aa415f2fc01</a><br />
which mentiones<br />
<a href="https://github.com/rear/rear/issues/492">https://github.com/rear/rear/issues/492</a><br />
and therein there is the comment</p>
<pre><code>lvcreate hangs because it expects yes prompt to be entered
during restore if existing filesystem signature detected
https://github.com/rear/rear/issues/513
</code></pre>
<p>and there it was suggested to use</p>
<pre><code>yes | lvm lvcreate
</code></pre>
<p>which should provide as many <code>y</code> as needed by <code>lvm lvcreate</code><br />
and not only a single <code>y</code> as via <code>lvm lvcreate ... &lt;&lt;&lt;y</code></p>
<h4 id="jsmeix_commented_at_2022-06-13_0928"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153688878">2022-06-13 09:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_0928" title="Permanent link">&para;</a></h4>
<p>@Githopp192<br />
does it work without manual intervention when you exchange in<br />
usr/share/rear/layout/prepare/GNU/Linux/110_include_lvm_code.sh<br />
code like</p>
<pre><code>lvm lvcreate ... &lt;&lt;&lt;y
</code></pre>
<p>by</p>
<pre><code>yes | lvm lvcreate ...
</code></pre>
<p>?</p>
<p>For only a test you could do this change in the booted<br />
ReaR recovery system before you run "rear recover" therein<br />
to test if with that change "rear recover" works<br />
without manual intervention.</p>
<p>Alternatively you can do this change on your original system<br />
but then you need to run "rear mkrescue" or "rear mkbackup"<br />
first to get an updated ReaR recovery system, then you boot<br />
that updated ReaR recovery system on your replacement hardware<br />
and test if "rear recover" works without manual intervention.</p>
<h4 id="pcahyna_commented_at_2022-06-13_0944"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153705810">2022-06-13 09:44</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-13_0944" title="Permanent link">&para;</a></h4>
<p>Hi, I believe a proper fix (suggested by @rmetrich some time ago) is to
use "-y" to "lvcreate" instead of supplying "y" to it on stdin.</p>
<h4 id="jsmeix_commented_at_2022-06-13_1005"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153724860">2022-06-13 10:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_1005" title="Permanent link">&para;</a></h4>
<p>I was wondering all the time why 'y' via stdin is used.<br />
Perhaps old versions of lvcreate did not support '-y'?<br />
I will check SLE10...</p>
<h4 id="pcahyna_commented_at_2022-06-13_1024"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153742866">2022-06-13 10:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-13_1024" title="Permanent link">&para;</a></h4>
<p>Yes, please check the oldest version of SLES that you care about. I
checked RHEL 6, <code>-y</code> is supported there.</p>
<h4 id="jsmeix_commented_at_2022-06-13_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153750220">2022-06-13 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_1032" title="Permanent link">&para;</a></h4>
<p>On SLES 10 SP4 with</p>
<pre><code># lvm version
  LVM version:     2.02.17 (2006-12-14)
  Library version: 1.02.13 (2006-11-28)
  Driver version:  4.7.0
</code></pre>
<p>"man lvcreate" does not show '-y' or '--yes'<br />
(only "man pvcreate" shows '-y' and '--yes').</p>
<p>On SLES 11 SP4 with</p>
<pre><code># lvm version
  LVM version:     2.02.98(2) (2012-10-15)
  Library version: 1.03.01 (2011-10-15)
  Driver version:  4.25.0
</code></pre>
<p>"man lvcreate" does not show '-y' or '--yes'<br />
(only "man pvcreate" shows '-y' and '--yes').</p>
<p>On SLES 12 SP5 with</p>
<pre><code># lvm version
  LVM version:     2.02.180(2) (2018-07-19)
  Library version: 1.03.01 (2018-07-19)
  Driver version:  4.39.0
</code></pre>
<p>"man lvcreate" and "man pvcreate" and "man vgcreate"<br />
show '-y' and '--yes'</p>
<p>I would not mind SLE10 because<br />
we (i.e. SUSE) never provided ReaR for SLE10.</p>
<p>But I do not want to actively break SLE11 support because<br />
this was the first one where we (i.e. SUSE) provided ReaR<br />
(i.e. it is me who gets all ReaR support issues at SUSE)<br />
so I prefer to not actively break SLE11 support in ReaR<br />
regardless that SLE11 is no longer officially supported<br />
by upstream ReaR according to our release notes<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a></p>
<p>When there is a good reason why</p>
<pre><code>yes | lvm lvcreate ...
</code></pre>
<p>has drawbacks in practice for our users compared to</p>
<pre><code>lvm lvcreate -y ...
</code></pre>
<p>then we should break SLE11 support because it is more<br />
important that current ReaR works well with current<br />
Linux distributions than keeping support for rather<br />
old Linux distributions.</p>
<h4 id="jsmeix_commented_at_2022-06-13_1056"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153771757">2022-06-13 10:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_1056" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/2821">https://github.com/rear/rear/pull/2821</a><br />
is a currently untested proposal for a fix.<br />
Please have a look if we could and should include that<br />
right now into ReaR 2.7 or better postpone it to ReaR 2.8.</p>
<h4 id="pcahyna_commented_at_2022-06-13_1114"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153788226">2022-06-13 11:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-13_1114" title="Permanent link">&para;</a></h4>
<blockquote>
<p>"man lvcreate" does not show '-y' or '--yes'<br />
(only "man pvcreate" shows '-y' and '--yes').</p>
</blockquote>
<p>Check the <code>lvm(8)</code> man page - it lists the common options, on RHEL 6
<code>--yes</code> is there and the lvcreate command accepts it, despite missing
from the <code>lvcreate(8)</code> man page.</p>
<p>I will try to provide a reliable reproducer (I tried already, but it is
a bit difficult and I ran out of time) and then we can test whether a
fix adding <code>-y</code> is working properly or whether we need to provide y's on
stdin.</p>
<p>I would not block 2.8 on it.</p>
<h4 id="githopp192_commented_at_2022-06-13_1124"><img src="https://avatars.githubusercontent.com/u/32612067?u=b6007aaa015ff323addaf197670b509febc7c77c&v=4" width="50"><a href="https://github.com/Githopp192">Githopp192</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153797034">2022-06-13 11:24</a>:<a class="headerlink" href="#githopp192_commented_at_2022-06-13_1124" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@Githopp192 does it work without manual intervention when you exchange
in usr/share/rear/layout/prepare/GNU/Linux/110_include_lvm_code.sh
code like</p>
<pre><code>lvm lvcreate ... &lt;&lt;&lt;y
</code></pre>
<p>by</p>
<pre><code>yes | lvm lvcreate ...
</code></pre>
<p>?</p>
<p>For only a test you could do this change in the booted ReaR recovery
system before you run "rear recover" therein to test if with that
change "rear recover" works without manual intervention.</p>
<p>Alternatively you can do this change on your original system but then
you need to run "rear mkrescue" or "rear mkbackup" first to get an
updated ReaR recovery system, then you boot that updated ReaR recovery
system on your replacement hardware and test if "rear recover" works
without manual intervention.</p>
</blockquote>
<p>yes, i'm going to test this soon - when i'm into the REAR console
again.<br />
Thx in the meantime</p>
<h4 id="jsmeix_commented_at_2022-06-13_1131"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1153802966">2022-06-13 11:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-13_1131" title="Permanent link">&para;</a></h4>
<p>I had checked "man lvm" on SLES10 and SLES11<br />
and both do not show '-y' or '--yes'.</p>
<p>I see we already have some '--yes' in<br />
layout/prepare/GNU/Linux/110_include_lvm_code.sh<br />
so the current code may already no longer work on SLE11.</p>
<p>Checking if the current code does no longer work on SLE11:</p>
<p>Currently we have:</p>
<pre><code>... lvm pvcreate -ff --yes ...
</code></pre>
<p>On SLES11 "man pvcreate" reads</p>
<pre><code>-f, --force
Force  the  creation  without any confirmation.
You can not recreate (reinitialize) a physical volume
belonging to an existing volume group.
In an emergency you can override this behaviour with -ff.
...
-y, --yes
Answer yes to all questions.
</code></pre>
<p>We also have:</p>
<pre><code>lvm vgremove --force --force --yes $vg &gt;&amp;2 || true
</code></pre>
<p>On SLES11 "man vgremove" only describes '-f, --force'<br />
but without repeating it and there is no '--yes'<br />
but when that command fails it doesn't matter<br />
because of the '|| true'.</p>
<p>So the current code in<br />
layout/prepare/GNU/Linux/110_include_lvm_code.sh<br />
should still work with SLE11.</p>
<h4 id="pcahyna_commented_at_2022-06-21_1235"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161689917">2022-06-21 12:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-21_1235" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>so the current code may already no longer work on SLE11</p>
</blockquote>
<p>Did you mean "SLE10", because otherwise it contradicts what you wrote
below "So the current code in<br />
layout/prepare/GNU/Linux/110_include_lvm_code.sh<br />
should still work with SLE11" ?</p>
<p>Concerning "both do not show '-y' or '--yes'." - could you please try on
a SLES11 system whether the <code>-y</code> or <code>--yes</code> option actually work? I saw
on a RHEL 6 system that the option is there, even if the man page
forgets to document it.<br />
Concerning "but when that command fails it doesn't matter because of the
'|| true'." I believe it matters, because the command is there for a
reason, and if it fails because of an unknown option, the result is not
what we want, <code>|| true</code> merely hides the problem. Am I missing
something?</p>
<h4 id="jsmeix_commented_at_2022-06-21_1256"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161712127">2022-06-21 12:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-21_1256" title="Permanent link">&para;</a></h4>
<p>@pcahyna</p>
<p>I meant SLES11 and in<br />
<a href="https://github.com/rear/rear/issues/2820#issuecomment-1153802966">https://github.com/rear/rear/issues/2820#issuecomment-1153802966</a><br />
I added a like</p>
<pre><code>Checking if the current code does no longer work on SLE11:
</code></pre>
<p>to avoid that the subsequent text looks like a contradiction.</p>
<p>I think the code</p>
<pre><code>lvm vgremove --force --force --yes $vg &gt;&amp;2 || true
</code></pre>
<p>is meant to try to remove the VG<br />
(e.g. when it is already there on a used disk)<br />
but if that is not possible for whatever reason<br />
we proceed "bona fide".</p>
<pre><code># git log --follow -p usr/share/rear/layout/prepare/GNU/Linux/110_include_lvm_code.sh
</code></pre>
<p>shows that the vgremove originated at<br />
<a href="https://github.com/rear/rear/commit/70acf6fa39b3d133c0a632e3496e5a273dc9ef27">https://github.com/rear/rear/commit/70acf6fa39b3d133c0a632e3496e5a273dc9ef27</a><br />
which points to<br />
<a href="https://github.com/rear/rear/pull/2564">https://github.com/rear/rear/pull/2564</a></p>
<h4 id="pcahyna_commented_at_2022-06-21_1311"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161729066">2022-06-21 13:11</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-21_1311" title="Permanent link">&para;</a></h4>
<p>We have been working with @vcrhonek on a reliable reproducer (the
original issue is usually quite random depending on what signatures are
on the disk and where).</p>
<p>Here is already a minimal reproducer to show the principle without any
involvement of ReaR. Assuming that <code>/dev/vdb</code> is a free disk:</p>
<pre><code>umount /mnt
wipefs -a /dev/vdb
yum install -y lvm2 xfsprogs
LOOPFILE=loopbackfile.img
pvcreate /dev/vdb
vgcreate sigvg /dev/vdb
lvcreate  sigvg -n xfsloglv -l 100%FREE
dd if=/dev/zero of="$LOOPFILE" bs=100M count=10
LOOPDEV=$(losetup -f)
losetup -f "$LOOPFILE"
MKFSOUT=$(mkfs.xfs -l logdev=/dev/sigvg/xfsloglv,size=2048b "$LOOPDEV")
losetup -d "$LOOPDEV"
BSIZE=$(echo $MKFSOUT | sed "s/.*\/dev\/sigvg\/xfsloglv bsize=\([^ ]*\)[ ]*.*/\1/")
dd if=/dev/sigvg/xfsloglv of=/dev/sigvg/xfsloglv bs="$BSIZE" seek=1
lvremove /dev/sigvg/xfsloglv
vgremove /dev/sigvg
pvremove /dev/vdb
pvcreate /dev/vdb
vgcreate sigvg /dev/vdb
lvcreate  sigvg -n pokuslv -l 100%FREE
</code></pre>
<p>The last lvcreate command will ask for confirmation many times, if one
adds <code>-y</code>, it succeeds without asking.</p>
<p>@jsmeix could you please try it on the old SLES versions that you care
about? (I will try RHEL 6.)</p>
<p>EDIT: reproducer updated to avoid options that old tools don't accept.</p>
<h4 id="pcahyna_commented_at_2022-06-21_1339"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161763122">2022-06-21 13:39</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-21_1339" title="Permanent link">&para;</a></h4>
<p>I have checked that <code>lvcreate</code> on RHEL 6 accepts <code>-y</code>. (<code>lvremove</code> too).</p>
<h4 id="jsmeix_commented_at_2022-06-21_1516"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161902999">2022-06-21 15:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-21_1516" title="Permanent link">&para;</a></h4>
<p>The reproducer doesn't reproduce<br />
for me on SLES11 SP4<br />
where /dev/sdb is a 1GiB free (virtual) disk:</p>
<pre><code># lsblk
NAME   MAJ:MIN RM   SIZE RO MOUNTPOINT
sdb      8:16   0     1G  0 
sda      8:0    0    12G  0 
├─sda1   8:1    0     2G  0 [SWAP]
└─sda2   8:2    0    10G  0 /
sr0     11:0    1   3.2G  0

# lvm version
  LVM version:     2.02.98(2) (2012-10-15)
  Library version: 1.03.01 (2011-10-15)
  Driver version:  4.25.0

# DISK=/dev/sdb

# wipefs -a $DISK

# LOOPFILE=loopbackfile.img

# pvcreate $DISK
  Physical volume "/dev/sdb" successfully created

# vgcreate sigvg $DISK
  Volume group "sigvg" successfully created

# lvcreate sigvg -n xfsloglv -l 100%FREE
  Logical volume "xfsloglv" created

# dd if=/dev/zero of="$LOOPFILE" bs=100M count=10
10+0 records in
10+0 records out
1048576000 bytes (1.0 GB) copied, 4.08083 s, 257 MB/s

# LOOPDEV=$(losetup -f)

# echo $LOOPDEV
/dev/loop0

# lsblk -o NAME,KNAME,FSTYPE,LABEL,SIZE,MOUNTPOINT /dev/sdb
NAME                    KNAME FSTYPE      LABEL   SIZE MOUNTPOINT
sdb                     sdb   LVM2_member           1G 
└─sigvg-xfsloglv (dm-0) dm-0                     1020M

# losetup -f "$LOOPFILE"

# MKFSOUT=$(mkfs.xfs -l logdev=/dev/sigvg/xfsloglv,size=2048b "$LOOPDEV")

# losetup -d "$LOOPDEV"

# BSIZE=$(echo $MKFSOUT | sed "s/.*\/dev\/sigvg\/xfsloglv bsize=\([^ ]*\)[ ]*.*/\1/")

# echo $BSIZE
4096

# dd if=/dev/sigvg/xfsloglv of=/dev/sigvg/xfsloglv bs="$BSIZE" seek=1
dd: writing `/dev/sigvg/xfsloglv': No space left on device
261120+0 records in
261119+0 records out
1069543424 bytes (1.1 GB) copied, 8.20103 s, 130 MB/s

# lvremove /dev/sigvg/xfsloglv
Do you really want to remove active logical volume xfsloglv? [y/n]: y
  Logical volume "xfsloglv" successfully removed

# vgremove /dev/sigvg
  Volume group "sigvg" successfully removed

# pvremove $DISK
  Labels on physical volume "/dev/sdb" successfully wiped

# pvcreate $DISK
  Physical volume "/dev/sdb" successfully created

# vgcreate sigvg $DISK
  Volume group "sigvg" successfully created

# lvcreate sigvg -n pokuslv -l 100%FREE
  Logical volume "pokuslv" created
</code></pre>
<p>On SLES11 SP4 'lvremove' does not accept '-y'<br />
but <code>yes | lvremove ...</code> works:</p>
<pre><code># lvremove -y /dev/sigvg/pokuslv
lvremove: invalid option -- 'y'
  Error during parsing of command line.

# yes | lvremove /dev/sigvg/pokuslv
Do you really want to remove active logical volume pokuslv? [y/n]:   Logical volume "pokuslv" successfully removed
</code></pre>
<p>Currently I don't know how to let 'lvcreate'<br />
ask for confirmation.</p>
<h4 id="pcahyna_commented_at_2022-06-21_1523"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161910376">2022-06-21 15:23</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-21_1523" title="Permanent link">&para;</a></h4>
<p>On RHEL 6, <code>lvcreate</code> did not ask for confirmation either. I think that
in old LVM versions lvcreate has not looked at signatures. But <code>-y</code>
worked in the sense that it was harmless.<br />
Concerning <code>lvcreate</code> on SLES11, you could try whether it accepts <code>-y</code>
or fails with <code>invalid option -- 'y'</code> or similar.</p>
<h4 id="jsmeix_commented_at_2022-06-21_1543"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161934013">2022-06-21 15:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-21_1543" title="Permanent link">&para;</a></h4>
<p>Sigh - I am too old and it's too late in the evening<br />
so I needed your hint to just try out<br />
if 'lvcreate' accepts '-y' on SLES11 SP4</p>
<pre><code># lvcreate sigvg -y -n pokuslv -l 100%FREE
lvcreate: invalid option -- 'y'
  Error during parsing of command line.

# yes | lvcreate sigvg -n pokuslv -l 100%FREE
  Logical volume "pokuslv" created
</code></pre>
<h4 id="jsmeix_commented_at_2022-06-21_1550"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1161942491">2022-06-21 15:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-21_1550" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
what is the reason behind why you don't like<br />
the traditional <code>yes | ...</code> pipe?</p>
<p>It was suggested in<br />
<a href="https://github.com/rear/rear/issues/513">https://github.com/rear/rear/issues/513</a><br />
where it has worked at least for the reporter of that issue.</p>
<p>But it was implemeted differently via <code>&lt;&lt;&lt;y</code><br />
that behaves like a limited <code>yes | ...</code> pipe<br />
which only inputs a single 'y'<br />
but I don't see a reason for that limitation.</p>
<h4 id="pcahyna_commented_at_2022-06-22_0753"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162772415">2022-06-22 07:53</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_0753" title="Permanent link">&para;</a></h4>
<p>I prefer to use the switch that exists for this purpose than to use a
more convoluted solution. Of course, if the option is not there in the
releases that you care about, there is not much choice remaining.<br />
Please be aware that <code>yes | lvcreate</code> returns an error status if one
uses <code>set -o pipefail</code>, so you need to check that <code>pipefail</code> is not
enabled in any place where the change will be made, or that the exit
code of the pipeline does not matter. And one will have to remember to
never use <code>pipefail</code> in places that use the <code>yes</code> pipeline.</p>
<pre><code># set -o pipefail
# yes | lvremove /dev/sigvg/xfsloglv
Do you really want to remove active logical volume xfsloglv? [y/n]:   Logical volume "xfsloglv" successfully removed
# echo $?
141
</code></pre>
<h4 id="pcahyna_commented_at_2022-06-22_0826"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162804476">2022-06-22 08:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_0826" title="Permanent link">&para;</a></h4>
<p>Or, if one cares about pipefail and exit codes, one may use this
"truism":</p>
<pre><code># ( yes || true ) | lvremove /dev/sigvg/xfsloglv
Do you really want to remove active logical volume xfsloglv? [y/n]:   Logical volume "xfsloglv" successfully removed
# echo $?
0
</code></pre>
<h4 id="jsmeix_commented_at_2022-06-22_0840"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162818874">2022-06-22 08:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_0840" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for your explanation<br />
about complications when a pipe is used!</p>
<p>In my<br />
<a href="https://github.com/rear/rear/pull/2821">https://github.com/rear/rear/pull/2821</a><br />
things already smelled fishy to me because I got a<br />
"yes: standard output: Broken pipe" stderr message<br />
but my "fix" <code>yes 2&gt;/dev/null | ...</code> doesn't fix anything<br />
instead it even makes things worse by hiding information<br />
because I failed to see the consequences<br />
when <code>yes</code> gets SIGPIPE (141 - 128 = 13 = SIGPIPE).</p>
<h4 id="pcahyna_commented_at_2022-06-22_0858"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162837852">2022-06-22 08:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_0858" title="Permanent link">&para;</a></h4>
<p>I should have looked at #2821 and the comment about broken pipe.
Interestingly, I never saw this <code>Broken pipe</code> error message, although I
was expecting to see one (indeed, <code>yes</code> gets terminated rather
ungracefully by SIGPIPE).</p>
<h4 id="jsmeix_commented_at_2022-06-22_0953"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162892444">2022-06-22 09:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_0953" title="Permanent link">&para;</a></h4>
<p>I think there is no other way than to let 'yes' get a SIGPIPE.<br />
At least I don't know how in <code>producer | consumer</code> the consumer<br />
could gracefully terminate the producer (in a simple way)<br />
because I think normally the consumer does not know<br />
(and should not care about) that stdin comes from a pipe.<br />
I think normally a consumer just reads its stdin (fd0)<br />
until it finally exits - likely without explicit closing fd0.<br />
I don't know if closing fd0 would avoid SIGPIPE for the producer.</p>
<p>I think the problem is when 'yes' does not propely handle SIGPIPE<br />
because SIGPIPE is likely a common way how 'yes' terminates<br />
regularily in practice (like in this example here).<br />
But I am no 'yes' expert ;-)</p>
<h4 id="pcahyna_commented_at_2022-06-22_0957"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162896359">2022-06-22 09:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_0957" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think the problem is when 'yes' does not propely handle SIGPIPE<br />
because SIGPIPE is likely a common way how 'yes' terminates<br />
regularily in practice</p>
</blockquote>
<p>Exactly my thought. So, what to do? Will you need support for such old
SLES versions even in ReaR 2.8? If so, <code>( yes 2&gt; /dev/null || true )</code> is
probably the best way to handle it.</p>
<h4 id="jsmeix_commented_at_2022-06-22_1021"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162919836">2022-06-22 10:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_1021" title="Permanent link">&para;</a></h4>
<p>Yes, <code>( yes 2&gt; /dev/null || true ) | ...</code><br />
is what I prefer to do for now<br />
strictly in compliance with our<br />
"Try hard to care about possible errors" and<br />
"Maintain backward compatibility" and<br />
"Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
:-)</p>
<p>FYI<br />
why I am so much interested<br />
in SLE11 backward compatibility in ReaR 2.7:</p>
<p>ReaR 2.7 has very many generic enhancements and fixes<br />
because the last release ReaR 2.6 is two years ago and<br />
SLE11 is the oldest SLE version that officially provides ReaR<br />
which means there might be some exceptional SLE11 customers<br />
that may need some specific ReaR 2.7 fix or enhancement<br />
for their ReaR use cases in their particular environments<br />
and then I would like to be able to "just provide" it to them<br />
without introducing regressions at unexpected other places.</p>
<p>I hope to release ReaR 2.8 in a much shorter time<br />
than two years (preferably in one year) and I think<br />
I can drop SLE11 support in ReaR 2.8.</p>
<p>Perhaps we should drop even more e.g. bash 3.x support<br />
(so we could use associative arrays) and things like that.</p>
<p>Perhaps then we better call it ReaR 3.0 cf.<br />
<a href="https://github.com/rear/rear/issues/1390">https://github.com/rear/rear/issues/1390</a></p>
<h4 id="pcahyna_commented_at_2022-06-22_1030"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162927975">2022-06-22 10:30</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_1030" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think I can drop SLE11 support in ReaR 2.8</p>
</blockquote>
<p>Why to worry about it here then, if #2821 has milestone set to ReaR 2.8
? Or do you plan to merge it before releasing 2.7?</p>
<h4 id="jsmeix_commented_at_2022-06-22_1040"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162937477">2022-06-22 10:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_1040" title="Permanent link">&para;</a></h4>
<p>Yesterday I postponed<br />
<a href="https://github.com/rear/rear/pull/2821">https://github.com/rear/rear/pull/2821</a><br />
from ReaR 2.7 to ReaR 2.8<br />
because I got no feedback from @Githopp192 here about<br />
<a href="https://github.com/rear/rear/issues/2820#issuecomment-1153688878">https://github.com/rear/rear/issues/2820#issuecomment-1153688878</a><br />
whether or not <code>yes | lvm lvcreate ...</code> works for him.</p>
<h4 id="jsmeix_commented_at_2022-06-22_1146"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1162997124">2022-06-22 11:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_1146" title="Permanent link">&para;</a></h4>
<p>I messed up
<a href="https://github.com/rear/rear/pull/2821">https://github.com/rear/rear/pull/2821</a><br />
so I closed it and did the same again from scratch as<br />
<a href="https://github.com/rear/rear/pull/2827">https://github.com/rear/rear/pull/2827</a></p>
<h4 id="pcahyna_commented_at_2022-06-22_1227"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1163035007">2022-06-22 12:27</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-06-22_1227" title="Permanent link">&para;</a></h4>
<p>I think it will be hard to get feedback from the original reporter. This
issue occurs randomly and infrequently, depending on where the
signatures end up on the disks. If the original disks are wiped, it is
not easily possible to reproduce the problem again. I can try to
reproduce the problem using the strategy above, but not immediately.</p>
<h4 id="githopp192_commented_at_2022-06-22_1418"><img src="https://avatars.githubusercontent.com/u/32612067?u=b6007aaa015ff323addaf197670b509febc7c77c&v=4" width="50"><a href="https://github.com/Githopp192">Githopp192</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1163163789">2022-06-22 14:18</a>:<a class="headerlink" href="#githopp192_commented_at_2022-06-22_1418" title="Permanent link">&para;</a></h4>
<p>that's correct @pcahyna .. i did run REAR several times on the same
machine &amp; the issue did not re-occur.</p>
<h4 id="jsmeix_commented_at_2022-06-22_1532"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1163267287">2022-06-22 15:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-22_1532" title="Permanent link">&para;</a></h4>
<p>@Githopp192<br />
thank you for your feedback!<br />
It helps us to know how things behave in your environment<br />
(in this case that things actually behave in your environment<br />
as we imagine they would do).</p>
<p>By the way:<br />
You may have a look at the section<br />
"Prepare replacement hardware for disaster recovery" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>In our current GitHub master code we have additionally<br />
support for the new DISKS_TO_BE_WIPED config variable<br />
that is described in default.conf currently at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L440">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L440</a><br />
<code>Wiping disks during "rear recover" before recreating the disk layout</code></p>
<p>For some details about that see<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/recreate/default/README.wipe_disks">https://github.com/rear/rear/blob/master/usr/share/rear/layout/recreate/default/README.wipe_disks</a><br />
What I wrote therein is certainly not some "final wisdom".<br />
It is mainly a collection of what I had found out<br />
up to that point in time when I wrote it.</p>
<p>To try out our current GitHub master code see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2022-06-24_1313"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1165562377">2022-06-24 13:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-06-24_1313" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2827">https://github.com/rear/rear/pull/2827</a>
merged<br />
this issue should be hopefully avoided<br />
(but we could not reproduce this issue).</p>
<h4 id="githopp192_commented_at_2022-06-27_2148"><img src="https://avatars.githubusercontent.com/u/32612067?u=b6007aaa015ff323addaf197670b509febc7c77c&v=4" width="50"><a href="https://github.com/Githopp192">Githopp192</a> commented at <a href="https://github.com/rear/rear/issues/2820#issuecomment-1167944933">2022-06-27 21:48</a>:<a class="headerlink" href="#githopp192_commented_at_2022-06-27_2148" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@Githopp192 thank you for your feedback! It helps us to know how
things behave in your environment (in this case that things actually
behave in your environment as we imagine they would do).</p>
<p>By the way: You may have a look at the section "Prepare replacement
hardware for disaster recovery" in
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>In our current GitHub master code we have additionally support for the
new DISKS_TO_BE_WIPED config variable that is described in
default.conf currently at
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L440">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L440</a>
<code>Wiping disks during "rear recover" before recreating the disk layout</code></p>
<p>For some details about that see
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/recreate/default/README.wipe_disks">https://github.com/rear/rear/blob/master/usr/share/rear/layout/recreate/default/README.wipe_disks</a>
What I wrote therein is certaily not some "final wisdom". It is mainly
a collection of what I had found out up to that point in time when I
wrote it.</p>
<p>To try out our current GitHub master code see the section "Testing
current ReaR upstream GitHub master code" in
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
</blockquote>
<p>Thx a lot @jsmeix .. now i've got a clearer view what is going on.</p>
<p>and more and more I perceive how complex the whole matter is and how
much work is behind it.<br />
For this - thank you !</p>
<p>So far I have been able to restore every system with REAR.<br />
But I could only do that because I know a lot about bash-shell
programming and i'm spending hours with debugging regulary :-)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-06-10.2820.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
