<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#811 PR merged: ebiso image size is too small if BACKUP is TSM - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#811 PR merged: ebiso image size is too small if BACKUP is TSM";
        var mkdocs_page_input_path = "issues/2016-03-30.811.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#811 PR merged: ebiso image size is too small if BACKUP is TSM</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="811_pr_merged_ebiso_image_size_is_too_small_if_backup_is_tsm"><a href="https://github.com/rear/rear/pull/811">#811 PR</a> <code>merged</code>: ebiso image size is too small if BACKUP is TSM<a class="headerlink" href="#811_pr_merged_ebiso_image_size_is_too_small_if_backup_is_tsm" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code></p>
<h4 id="pavoldomin_opened_issue_at_2016-03-30_2119"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> opened issue at <a href="https://github.com/rear/rear/pull/811">2016-03-30 21:19</a>:<a class="headerlink" href="#pavoldomin_opened_issue_at_2016-03-30_2119" title="Permanent link">&para;</a></h4>
<p>The patch increases the UEFI image size, if BACKUP is TSM. The reference
issue: #810</p>
<p>I must admit I start to dislike this UEFI image size determination code
(which is my own partly).<br />
Perhaps we should think about more scientific approach to calculate
needed size for the UEFI image?<br />
On the other hands its just few lines of code (compared to bit more if
'more scientific approach' is in place). Any comments please?</p>
<h4 id="jsmeix_commented_at_2016-03-31_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-203847222">2016-03-31 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-03-31_0927" title="Permanent link">&para;</a></h4>
<p>Regardless that I know basically nothing at all about<br />
how to make an UEFI bootable ISO image<br />
I like to suggest a general approach<br />
how to deal with such kind of issues:</p>
<p>Provide a new variable in default.conf like</p>
<pre>
# The size of the UEFI boot image in KiB.
# It must be big enough for initrd and kernel.
# If unset or empty rear will use default/fallback values:
# Usually 32000 KiB should be sufficient.
# When elilo or shim is used 128000 KiB should be sufficient.
# Additional space is needed when special backup restore software
# is used (e.g. additional 96000 KiB when TSM is used):
EFIBOOT_IMAGE_SIZE_KiB=32000
</pre>

<p>and use that in the efiboot_img_size function.</p>
<p>Reasoning:</p>
<p>As far as I understand it from
<a href="https://github.com/rear/rear/issues/810#issue-144721705">https://github.com/rear/rear/issues/810#issue-144721705</a></p>
<pre>
Work-around, if any
I have modified rear code:
extended UEFI image size by experimentally
determined value for this particular setup
</pre>

<p>the main problem is how to automatically determine<br />
a correct value.</p>
<p>When there is no reliably working automatism,<br />
I think it should be possible for the user to<br />
explicitly specify something that makes it work<br />
for his particular case - otherwise we may need<br />
to endlessly adapt and enhance the automatism<br />
trying to make it work for all (corner) cases until<br />
it becomes an overcomplicated monster that<br />
nobody can maintain any longer.</p>
<p>A possible enhancement request:</p>
<p>I wonder why the size is measured in KiB and not in MiB.<br />
Is such fine granularity really useful?<br />
All rear defaults have '000' at the end i.e. are measured in 1000 KiB<br />
so that I assume using 1024*1024 Bytes as unit is more appropriate.</p>
<p>By the way:</p>
<p>I needed reverse engineering to find out that the measurement unit<br />
of that plain "size" named variable is KiB because I found it used in<br />
20_mount_efibootimg.sh</p>
<pre>
dd if=/dev/zero of=$TMP_DIR/efiboot.img count=$(efiboot_img_size) bs=1024
</pre>

<p>I wished variable names were more meaningful, cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="pavoldomin_commented_at_2016-03-31_1241"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-203914834">2016-03-31 12:41</a>:<a class="headerlink" href="#pavoldomin_commented_at_2016-03-31_1241" title="Permanent link">&para;</a></h4>
<p>Thanks for feedback!</p>
<p>Frankly, I am against adding new variable to the config file (there is
too many of them already), as we can find the needed value automatically
(by counting the total size of the to-be-copied files). ReaR user should
not be forced to determine the space needed for uefi boot image I
think.<br />
Perhaps @gozora may comment on this, as this has been discussed when he
was adding his ebiso support patch.</p>
<p>I absolutely agree with the variable names and units comment. Also [[
... ]] &amp;&amp; ... does not seem to honor the style as i read it now :)<br />
I'll change it like:</p>
<pre><code>dd if=/dev/zero of=$TMP_DIR/efiboot.img count=$(efiboot_img_size_MiB) bs=1048576
</code></pre>
<h4 id="gozora_commented_at_2016-03-31_1301"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-203925203">2016-03-31 13:01</a>:<a class="headerlink" href="#gozora_commented_at_2016-03-31_1301" title="Permanent link">&para;</a></h4>
<p>At the time I was writing ebiso, I primary focused to implement it into
ReaR with least pain possible.<br />
So I just took existing approach for ISO creation and just extended it,
with a thought that it (if there is need) will be changed. Looks like
the time is here.<br />
As far as I remember <code>dd ...</code> command was called (with some fixed size)
to create blank UEFI image and consecutively mounted. After loop mount
was settled, files were copied.<br />
In this I agree with @pavoldomin that users should not decide about
image size, but size should be rather determined automatically before
<code>dd</code> command is triggered. Maybe we could add some additional
script/flow.before blank image is created to have some better guess
about final image size?<br />
It is been a time since I was in touch with ReaR code, so I definitely
need some refreshment.to have more accurate view.<br />
@jsmeix if you want, I can take a closer look (during weekend) to find
possible way, how to automatize this.</p>
<h4 id="jsmeix_commented_at_2016-03-31_1402"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-203953864">2016-03-31 14:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-03-31_1402" title="Permanent link">&para;</a></h4>
<p>@pavoldomin<br />
I fully agree with you.</p>
<p>My above comment was made under the (wrong) assumption that "there is no
reliably working automatism".</p>
<p>When rear "can find the needed value automatically (by counting the
total size of the to-be-copied files)" it should do that and not bother
the user with tasks that can be reliably automated.</p>
<h4 id="jsmeix_commented_at_2016-03-31_1405"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-203954683">2016-03-31 14:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-03-31_1405" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I would very much appreciate it if you could have a closer look.</p>
<p>I am not really the right one for this issue because<br />
"I know basically nothing at all about how to make<br />
an UEFI bootable ISO image".</p>
<h4 id="gozora_commented_at_2016-04-03_1525"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/811#issuecomment-204995243">2016-04-03 15:25</a>:<a class="headerlink" href="#gozora_commented_at_2016-04-03_1525" title="Permanent link">&para;</a></h4>
<p>As mentioned in issue #810, pull request #813 was created and it
should supersede this pull, request.<br />
Hope nobody minds ...</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-03-30.811.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
