<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3495 Issue open: checklayout should not highlight a disc swap - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3495 Issue open: checklayout should not highlight a disc swap";
        var mkdocs_page_input_path = "issues/2025-07-10.3495.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3495 Issue open: checklayout should not highlight a disc swap</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3495_issue_open_checklayout_should_not_highlight_a_disc_swap"><a href="https://github.com/rear/rear/issues/3495">#3495 Issue</a> <code>open</code>: checklayout should not highlight a disc swap<a class="headerlink" href="#3495_issue_open_checklayout_should_not_highlight_a_disc_swap" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>discuss / RFC</code>, <code>support / question</code></p>
<h4 id="bwelterl_opened_issue_at_2025-07-10_1038"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> opened issue at <a href="https://github.com/rear/rear/issues/3495">2025-07-10 10:38</a>:<a class="headerlink" href="#bwelterl_opened_issue_at_2025-07-10_1038" title="Permanent link">&para;</a></h4>
<h3 id="is_your_feature_request_related_to_a_problem_please_describe">Is your feature request related to a problem? Please describe.<a class="headerlink" href="#is_your_feature_request_related_to_a_problem_please_describe" title="Permanent link">&para;</a></h3>
<p>When a cron job is configured to check a layout change, if a swap of
disk happens during the boot (usual with VMs), the layout file changes,
and a new rescue ISO is created than can be avoided.<br />
There is no more adherence of disk names sdx/vdx in linux system, so
Rear should be able to manage a name swap.</p>
<h3 id="describe_the_solution_youd_like">Describe the solution you'd like<a class="headerlink" href="#describe_the_solution_youd_like" title="Permanent link">&para;</a></h3>
<p>The idea is to exclude the name of the device in the comparison of disk
layout file, only the concrete internal disk layout must be stable
(partition size, LV size/name)<br />
Thank you !</p>
<h4 id="jsmeix_commented_at_2025-07-10_1133"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057071253">2025-07-10 11:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-10_1133" title="Permanent link">&para;</a></h4>
<p>@bwelterl<br />
what exactly do you mean with "a swap of disk"<br />
(why singular "disk" and not "disks"?)<br />
and/or "name swap" in your specific case?<br />
Couldn't you not provide a "real world" example<br />
from your particular environment?<br />
E.g. on your specific system the output of</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT[S]
</code></pre>
<p>before and after the "swap of disk".</p>
<p>I ask because "rear recover" is first and foremost<br />
intended to work on pristine new replacement hadware<br />
("bare metal" disaster recovery is the primary use case)<br />
and all what reliably exists on pristine new hadware<br />
are only plain kernel device nodes like<br />
/dev/sda and /dev/sdb.</p>
<p>In particular higher level disk device names like<br />
all what is in <code>/dev/disk/by-*</code> are different<br />
on replacement hadware like UUID based names<br />
or could be different like <code>by-path</code> names when<br />
things are not wired 100% same on replacement hadware.</p>
<p>Therefore disklayout.conf is based on kernel device nodes<br />
and any change in kernel device nodes is considered to be<br />
a "migration" in ReaR, see the MIGRATION_MODE description<br />
in usr/share/rear/conf/default.conf<br />
<a href="https://github.com/rear/rear/blob/rear-2.9/usr/share/rear/conf/default.conf#L454">https://github.com/rear/rear/blob/rear-2.9/usr/share/rear/conf/default.conf#L454</a></p>
<p>Therefore - to be on the safe side - it is correct<br />
that any change in kernel disk device nodes indicates<br />
that a new ReaR recovery system should be made.</p>
<p>It is not and cannot be ReaR's task to make a decision<br />
what a change in kernel disk device nodes actually means,<br />
in particular not to let ReaR make an automated decision<br />
if such a change could be ignored (at least not until<br />
someone adds AI to ReaR - and then good luck with the<br />
"intelligence" of that - have fun when AI hallucinates<br />
disk layout thingies for new replacement hadware ;-)</p>
<p>Additionally you may have a look at the section<br />
"Relax-and-Recover versus backup and restore"<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore">https://en.opensuse.org/SDB:Disaster_Recovery#Relax-and-Recover_versus_backup_and_restore</a><br />
which reads (excerpt):</p>
<pre><code>It is your task to ensure your backup is consistent.
...
Therefore after each change of the basic system
(in particular after a change of the disk layout)
"rear mkbackup" needs to be run to create
a new ReaR recovery system together with a
matching new backup of the files
(or when third party backup software is used
"rear mkrescue" needs to be run to create
a new ReaR recovery system and additionally
a matching new backup of the files must be created).
</code></pre>
<h4 id="bwelterl_commented_at_2025-07-10_1208"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057174791">2025-07-10 12:08</a>:<a class="headerlink" href="#bwelterl_commented_at_2025-07-10_1208" title="Permanent link">&para;</a></h4>
<p>Hi Johannes,</p>
<p>Thanks for your answer.</p>
<p>For your information, the layout is standard, just 2 disks:</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT
NAME                            KNAME     PKNAME    TRAN   TYPE FSTYPE      LABEL   SIZE MOUNTPOINT
/dev/sr0                        /dev/sr0            sata   rom                     1024M 
/dev/vda                        /dev/vda                   disk                      20G 
|-/dev/vda1                     /dev/vda1 /dev/vda         part vfat                600M /boot/efi
|-/dev/vda2                     /dev/vda2 /dev/vda         part xfs                   1G /boot
`-/dev/vda3                     /dev/vda3 /dev/vda         part LVM2_member        18.4G 
  |-/dev/mapper/rhel_rhel8-swap /dev/dm-0 /dev/vda3        lvm  swap                  2G [SWAP]
  `-/dev/mapper/rhel_rhel8-root /dev/dm-1 /dev/vda3        lvm  xfs                16.4G /
/dev/vdb                        /dev/vdb                   disk xfs                  10G /var/www
/dev/vdc                        /dev/vdc                   disk LVM2_member       102.4M
</code></pre>
<p>But with recent linux kernel, even with scsi_mod.scan=sync, the
detection of devices at boot time is not deterministic.</p>
<p>So a reboot might change vda to vdb, all the other layout remains the
same.</p>
<p>Thus, the cron job that runs checklayout rebuilds a rescue ISO that is
not necessary.</p>
<p>As you said, everything in rear recovery is rebuilt, but has a strict
mapping to disk names, and even in this case, the migration mode is able
to recover. But, the issue here is not the recover, but the useless
rebuild of rescue ISO.</p>
<p>The comparison of layout might exclude the names.<br />
This is of course an enhancement of current behavior and needs some
discussion (without AI :).</p>
<ul>
<li>The layout file might include a generic name for the disk</li>
<li>or the diff somehow does not take the disk name into account.<br />
    Thanks !</li>
</ul>
<p>Benoit</p>
<h4 id="jsmeix_commented_at_2025-07-10_1321"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057439000">2025-07-10 13:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-10_1321" title="Permanent link">&para;</a></h4>
<p>My totally untested offhanded spontaneous idea<br />
what might be doable with reasonable effort in ReaR and<br />
what does not try to let ReaR make automated decisions<br />
is the following:</p>
<p>Let the user specify in his etc/rear/local.conf<br />
those kernel disk device nodes in his specific environment<br />
where differences of those kernel disk device nodes<br />
in disklayout.conf do not matter for him.</p>
<p>E.g. when the user specified in his local.conf something like</p>
<pre><code>INTERCHANGEABLE_VALUES=( '/dev/sda /dev/sdb' '/dev/vda /dev/vdb' )
</code></pre>
<p>then ReaR could "mindlessly" replace<br />
/dev/sda and /dev/sdb by one same unique dummy value XXX and<br />
/dev/vda and /dev/vdb by another same unique dummy value YYY<br />
in the layout files before they get compared by "rear checklayout"<br />
(cf. layout/compare/default/500_compare_layout.sh)<br />
so differences in those specified kernel device nodes<br />
would no longer be noticed.<br />
But a change from /dev/sda to /dev/vda would be noticed<br />
in this example - to get all of them interchangeable</p>
<pre><code>INTERCHANGEABLE_VALUES=( '/dev/sda /dev/sdb /dev/vda /dev/vdb' )
</code></pre>
<p>would do it.</p>
<p>My point is that this way we don't need to implement<br />
"intelligence" in ReaR (which will fail in some cases<br />
so it could result an ultimate disaster for the user<br />
instead of a recovery from a disaster, cf. the<br />
MIGRATION_MODE description in default.conf) and<br />
we keep the user in full control over what ReaR does for him.</p>
<h4 id="pcahyna_commented_at_2025-07-10_1429"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057694659">2025-07-10 14:29</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-07-10_1429" title="Permanent link">&para;</a></h4>
<p>I understand the motivation for the request, but I am afraid that "to
exclude the name of the device in the comparison of disk layout file,
only the concrete internal disk layout must be stable (partition size,
LV size/name)" will be hard to work out in practice (regardless of any
rules/configuration variables to determine what can safely swap with
what). The problem is that you also need to preserve the relation
between partitions (and other objects) and disks. So supposing that you
have this layout:</p>
<pre><code># Disk /dev/vda
# Format: disk &lt;devname&gt; &lt;size(bytes)&gt; &lt;partition label type&gt;
disk /dev/vda 10737418240 msdos
# Partitions on /dev/vda
# Format: part &lt;device&gt; &lt;partition size(bytes)&gt; &lt;partition start(bytes)&gt; &lt;partition type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
part /dev/vda 1073741824 1048576 primary boot /dev/vda1
</code></pre>
<p>one sees that there is a disk and a partition, but that's not all, it
also specifies that the partition is <em>on</em> that disk. If we strip all the
<code>/dev/vda</code> parts, we will have something like <code>disk 10737418240 msdos</code>
and <code>part 1073741824 1048576 primary boot 1</code>, but how do we know that
the two belong together?<br />
We could use the ordering in the file, but now we are imposing an
additional constraint on the format.</p>
<p>Generally speaking, disk device reordering throws a monkey wrench into
many of the layout concepts used by ReaR and I would say that the impact
on <code>checklayout</code> is one of the lesser concerns.</p>
<h4 id="jsmeix_commented_at_2025-07-10_1454"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057809635">2025-07-10 14:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-10_1454" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
did you perhaps misunderstand that my porposal in<br />
<a href="https://github.com/rear/rear/issues/3495#issuecomment-3057439000">https://github.com/rear/rear/issues/3495#issuecomment-3057439000</a><br />
is only meant to help the user with "rear checklayout"<br />
but it is not meant for "rear recover"?</p>
<p>For "rear recover" the current MIGRATION_MODE implementation<br />
works sufficiently at least for the sufficiently simple<br />
use case of @bwelterl where the automated disk mapping<br />
based on disk size should work sufficiently in practice<br />
in particular when each disk size is unique and when on<br />
the replacement hardware the disks have exact same size<br />
as on the original system (which is easily possible<br />
with virtual disks).</p>
<p>Yes, the current MIGRATION_MODE implementation<br />
has known severe insufficiencies in certain cases,<br />
for example <a href="https://github.com/rear/rear/issues/3477">https://github.com/rear/rear/issues/3477</a><br />
and <a href="https://github.com/rear/rear/issues/3473">https://github.com/rear/rear/issues/3473</a></p>
<h4 id="pcahyna_commented_at_2025-07-10_1457"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057821262">2025-07-10 14:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-07-10_1457" title="Permanent link">&para;</a></h4>
<p>@jsmeix I don't think I misunderstood anything here - my reply was only
about the "checklayout" part and was not meant to imply anything about
"recover" at all, except for the general remark at the end, which was
unrelated to your proposal.</p>
<h4 id="pcahyna_commented_at_2025-07-10_1459"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3057828748">2025-07-10 14:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-07-10_1459" title="Permanent link">&para;</a></h4>
<p>Actually, my whole reply is unrelated to your proposal.</p>
<h4 id="gdha_commented_at_2025-07-11_0645"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3060838614">2025-07-11 06:45</a>:<a class="headerlink" href="#gdha_commented_at_2025-07-11_0645" title="Permanent link">&para;</a></h4>
<p>Why not remove the checklayout job in cron? A weekly mkbackup job is
more than sufficient.</p>
<h4 id="pcahyna_commented_at_2025-07-15_1401"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3073732654">2025-07-15 14:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-07-15_1401" title="Permanent link">&para;</a></h4>
<p>@gdha exactly my thought.</p>
<p>The problem apparently occurs when using the crontab that used to be the
part of the package and was removed here:
89a8f18ec402b439caf4800421644f5bf5d174e5 and contained this:<br />
<code>/usr/sbin/rear checklayout || /usr/sbin/rear mkrescue</code>.<br />
We used to have it in the RHEL package until RHEL 8 and we also removed
it in RHEL 9. I believe that having this crontab was a bad idea given
that it does not perform any backup by itself, so having it as the
default merely gives a false sense of security (ReaR is being scheduled
periodically, but it does not perform an actual backup).<br />
I think the proper solution for the affected user should be to remove
the crontab or to adapt it so that it does what they need, which should
in any case include generating a rescue image whenever the backup gets
produced - not more often, not less. Generating the rescue image without
producing a backup at the same time risks running into consistency
issues.<br />
And indeed <code>mkbackup</code> is the way to do it, if an internal backup method
(like NETFS) is being used.</p>
<h4 id="jsmeix_commented_at_2025-07-23_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3108500224">2025-07-23 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-23_1335" title="Permanent link">&para;</a></h4>
<p>I think this issue is sufficiently discussed<br />
and a proper way what to do was found which is:</p>
<p>Do no longer use the deprecated (and by upstream removed)</p>
<pre><code>30 1 * * * /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue
</code></pre>
<p>daily cron job.</p>
<p>Instead do the following:<br />
Run "rear mkbackup" when needed<br />
in particular after each change of the basic system<br />
(for example after a change of the disk layout)<br />
or<br />
when a system backup is made by third party backup software<br />
then also run "rear mkrescue".</p>
<h4 id="bwelterl_commented_at_2025-07-23_1347"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3108653956">2025-07-23 13:47</a>:<a class="headerlink" href="#bwelterl_commented_at_2025-07-23_1347" title="Permanent link">&para;</a></h4>
<p>Thanks for all answers.</p>
<blockquote>
<p>Why not remove the checklayout job in cron? A weekly mkbackup job is
more than sufficient.</p>
</blockquote>
<p>We can't pronounce about the needs, it depends on the use.</p>
<p>There are 2 subjects here:</p>
<ul>
<li>the cron job, that I understand is deprecatd</li>
<li>the use of checklayout command.</li>
</ul>
<p>This is the subject. Is it still useful and supported if a cron job is
not usable ?<br />
And the question is to adapt it to avoid unexpected rescue/backup if
only a swap between 2 disks happened.</p>
<p>The initial improvement remains the same, with or without cron job, once
per week or per day does not matter.</p>
<p>Maybe a output of checklayout to a customized path, and then an external
tool to compare and eventually alert the user: a warning if only disk
name changed.</p>
<p>Thanks !</p>
<p>Benoit</p>
<h4 id="jsmeix_commented_at_2025-07-23_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3108827785">2025-07-23 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-23_1408" title="Permanent link">&para;</a></h4>
<p>@bwelterl<br />
I understand your request.</p>
<p>I could try to implement a proof of concept of my<br />
<a href="https://github.com/rear/rear/issues/3495#issuecomment-3057439000">https://github.com/rear/rear/issues/3495#issuecomment-3057439000</a><br />
to see whether or not it could work out in practice<br />
BUT ONLY IF the other<br />
@rear/contributors<br />
support my proposal in general<br />
because I do not want to waste my time<br />
for something that would not be accepted by them.</p>
<h4 id="bwelterl_commented_at_2025-07-23_1433"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3108918727">2025-07-23 14:33</a>:<a class="headerlink" href="#bwelterl_commented_at_2025-07-23_1433" title="Permanent link">&para;</a></h4>
<p>Thanks Johannes for your reply, and sorry for the delay of my answers.</p>
<p>Your proposal is certainly the easiest: generate a temporary layout file
with interchangeable values (defined in the var) changed to a generic
name, so we can keep the same diff logic.<br />
We can even add 2 levels:</p>
<ul>
<li>if a diff is seen in original layout file</li>
<li>if a INTERCHANGEABLE_VAR is not defined, return 1</li>
<li>else generate temporary layout file with generic value instead of
    INTERCHANGEABLE_VAR<ul>
<li>if a diff is seen, return 1</li>
<li>else print a warning</li>
</ul>
</li>
</ul>
<p>I might try to implement that.</p>
<p>Thank you !</p>
<p>Benoit</p>
<h4 id="jsmeix_commented_at_2025-07-23_1450"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3495#issuecomment-3108984956">2025-07-23 14:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-07-23_1450" title="Permanent link">&para;</a></h4>
<p>Yes, something like that is also my idea.</p>
<p>As a possible template see the code in the function<br />
apply_layout_mappings() in lib/layout-functions.sh<br />
how one could replace words by unique generic words.<br />
I think the code in apply_layout_mappings() is more<br />
complicated than what is needed for this issue here<br />
but it may help as a possible template how to do it.<br />
I mean in particular to have a look at the <code>sed</code> commands<br />
which may provide hints what to have in mind when replacing<br />
in particular higher level disk device node values.</p>
<p>So for e.g.</p>
<pre><code>INTERCHANGEABLE_VALUES=( '/dev/sda /dev/sdb' '/dev/vda /dev/vdb' )
</code></pre>
<p>both words <code>/dev/sda</code> and <code>/dev/sdb</code> would be replaced<br />
by the same unique generic word <code>_REAR0_</code><br />
and both words <code>/dev/vda</code> and <code>/dev/vdb</code> would be replaced<br />
by the same unique generic word <code>_REAR1_</code><br />
in the two disklayout files before they get compared.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2025-07-10.3495.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
