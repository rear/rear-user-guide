<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#469 Issue closed: Suggestion: Duply/Duplicity + TMP_DIR value not handled (and optionally ARCH_DIR) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#469 Issue closed: Suggestion: Duply/Duplicity + TMP_DIR value not handled (and optionally ARCH_DIR)";
        var mkdocs_page_input_path = "issues/2014-10-02.469.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#469 Issue closed: Suggestion: Duply/Duplicity + TMP_DIR value not handled (and optionally ARCH_DIR)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="469_issue_closed_suggestion_duplyduplicity_tmp_dir_value_not_handled_and_optionally_arch_dir"><a href="https://github.com/rear/rear/issues/469">#469 Issue</a> <code>closed</code>: Suggestion: Duply/Duplicity + TMP_DIR value not handled (and optionally ARCH_DIR)<a class="headerlink" href="#469_issue_closed_suggestion_duplyduplicity_tmp_dir_value_not_handled_and_optionally_arch_dir" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code></p>
<h4 id="reiner030_opened_issue_at_2014-10-02_1310"><img src="https://avatars.githubusercontent.com/u/29528?v=4" width="50"><a href="https://github.com/Reiner030">Reiner030</a> opened issue at <a href="https://github.com/rear/rear/issues/469">2014-10-02 13:10</a>:<a class="headerlink" href="#reiner030_opened_issue_at_2014-10-02_1310" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>mysqlf I use default /tmp folder but in duply profile this could be
setup:</p>
<pre><code># temporary file space. at least the size of the biggest file in backup
# for a successful restoration process. (default is '/tmp', if not set)
#TEMP_DIR=/tmp
</code></pre>
<p>and needs to be handeld/linked then in<br />
verify/DUPLICITY/default/20_check_tmpfs.sh<br />
verify/DUPLICITY/default/25_check_duply_profile.sh<br />
and perhaps also<br />
restore/DUPLICITY/default/10_restore_duply.sh</p>
<p>Also it could/should be helpful to use for duplicity tmp folder not
tmpfs if possible because there could be VMs/"appliances" with low RAM
but huge HDD temp space?</p>
<pre><code>2014-10-02 11:45:54 Including verify/DUPLICITY/default/20_check_tmpfs.sh
2014-10-02 11:45:54 File system /tmp not present - try to mount it via tmpfs
2014-10-02 11:45:54 Including verify/DUPLICITY/default/25_check_duply_profile.sh
2014-10-02 11:46:25 Including restore/DUPLICITY/default/10_restore_duply.sh
</code></pre>
<p>Also it could be helpful to recognize activated ARCH_DIR settings and
also activate it for ReaR recover to "buffer" the file metadata
temporary to fasten the restore with smaller net links?</p>
<pre><code># Modifies archive-dir option (since 0.6.0) Defines a folder that holds 
# unencrypted meta data of the backup, enabling new incrementals without the 
# need to decrypt backend metadata first. If empty or deleted somehow, the 
# private key and it's password are needed.
# NOTE: This is confidential data. Put it somewhere safe. It can grow quite 
#       big over time so you might want to put it not in the home dir.
# default '~/.cache/duplicity/duply_&lt;profile&gt;/'
# if set  '\${ARCH_DIR}/&lt;profile&gt;'
#ARCH_DIR=/some/space/safe/.duply-cache
</code></pre>
<p>Bests</p>
<h4 id="gdha_commented_at_2014-10-02_1418"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-57636162">2014-10-02 14:18</a>:<a class="headerlink" href="#gdha_commented_at_2014-10-02_1418" title="Permanent link">&para;</a></h4>
<p>in rear you can use <code>TMPDIR</code> instead (in the local.conf file)</p>
<h4 id="reiner030_commented_at_2014-10-06_1847"><img src="https://avatars.githubusercontent.com/u/29528?v=4" width="50"><a href="https://github.com/Reiner030">Reiner030</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-58071032">2014-10-06 18:47</a>:<a class="headerlink" href="#reiner030_commented_at_2014-10-06_1847" title="Permanent link">&para;</a></h4>
<p>My suggestions came because common/rear TMPDIR variable is overwritten
by duply:</p>
<pre><code># grep -nA2 TMPDIR /usr/bin/duply 
561:DUPL_VARS_GLOBAL="TMPDIR='$TEMP_DIR' \
562- ${DUPL_ARG_ENC}"
563-}
</code></pre>
<p>and defaults to /tmp:</p>
<pre><code># grep -n TEMP_DIR /usr/bin/duply | grep tmp
288:#TEMP_DIR=/tmp
972:  TEMP_DIR=${TEMP_DIR:-'/tmp'}
</code></pre>
<p>(and the possible size problem compared to HDD and tmpfs space)</p>
<p>In both cases it would be nice to auto-reassign the TEMP_DIR variable
of duply ?</p>
<p>Just checked: duplicity itself uses only TMPDIR:<br />
<a href="http://duplicity.nongnu.org/FAQ.html#tmp_space">http://duplicity.nongnu.org/FAQ.html#tmp_space</a></p>
<h4 id="reiner030_commented_at_2014-10-07_0829"><img src="https://avatars.githubusercontent.com/u/29528?v=4" width="50"><a href="https://github.com/Reiner030">Reiner030</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-58152467">2014-10-07 08:29</a>:<a class="headerlink" href="#reiner030_commented_at_2014-10-07_0829" title="Permanent link">&para;</a></h4>
<p>At home I got an idea howto solve it - here the short version how it for
the scripts. I do it "reverse" to the duply setting of temporary folder:</p>
<pre><code># grep TEMP /etc/duply/*/conf
#TEMP_DIR=/tmp

# grep -qE "^TEMP_DIR=\\$\{TMPDIR:-" /etc/duply/*/conf || \
  sed -ie "s/^#\?TEMP_DIR=\(.*\)$/TEMP_DIR=\${TMPDIR:-\1}/" /etc/duply/*/conf

# grep TEMP /etc/duply/*/conf
TEMP_DIR=${TMPDIR:-/tmp}
</code></pre>
<p>This shouldn't (must not?) be used on the original conf file because its
not nice to "fix" something in background without knowlede of the
administrator but could be announced as "should be set" and can be used
onto the conf in the rescue image ?</p>
<h4 id="gdha_commented_at_2014-10-08_0734"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-58320867">2014-10-08 07:34</a>:<a class="headerlink" href="#gdha_commented_at_2014-10-08_0734" title="Permanent link">&para;</a></h4>
<p>@Reiner030 sounds logically; will you prepare a pull request? Thank you
for the in-depth investigation. Gratien</p>
<h4 id="reiner030_commented_at_2014-10-13_2004"><img src="https://avatars.githubusercontent.com/u/29528?v=4" width="50"><a href="https://github.com/Reiner030">Reiner030</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-58946868">2014-10-13 20:04</a>:<a class="headerlink" href="#reiner030_commented_at_2014-10-13_2004" title="Permanent link">&para;</a></h4>
<p>yes... but I have small problem here:
<a href="https://github.com/Reiner030/rear/compare/duply-tmpdir-fix-volsize-check">https://github.com/Reiner030/rear/compare/duply-tmpdir-fix-volsize-check</a></p>
<p>/usr/share/rear/build/DUPLICITY/default/50_patch_duply_config.sh<br />
is created and I think it should be included automatically but it's not
used when building the ISO image</p>
<h4 id="gdha_commented_at_2014-10-16_0925"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-59335809">2014-10-16 09:25</a>:<a class="headerlink" href="#gdha_commented_at_2014-10-16_0925" title="Permanent link">&para;</a></h4>
<p>@Reiner030 check if the modified scripts were added to the ISO build
(after booting it). perhaps you were the standard installed rear rpm
instead of the local path?</p>
<h4 id="reiner030_commented_at_2014-10-16_1825"><img src="https://avatars.githubusercontent.com/u/29528?v=4" width="50"><a href="https://github.com/Reiner030">Reiner030</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-59406930">2014-10-16 18:25</a>:<a class="headerlink" href="#reiner030_commented_at_2014-10-16_1825" title="Permanent link">&para;</a></h4>
<p>Since I use Debian Wheezy this can't be ;) But I would check the debian
folder for necessary entries.</p>
<h4 id="gdha_commented_at_2014-12-05_1706"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/469#issuecomment-65820247">2014-12-05 17:06</a>:<a class="headerlink" href="#gdha_commented_at_2014-12-05_1706" title="Permanent link">&para;</a></h4>
<p>@Reiner030 can this issue be closed?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2014-10-02.469.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
