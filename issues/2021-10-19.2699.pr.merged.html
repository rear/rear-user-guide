<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2699 PR merged: Overhauled serial console support code - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2699 PR merged: Overhauled serial console support code";
        var mkdocs_page_input_path = "issues/2021-10-19.2699.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2699 PR merged: Overhauled serial console support code</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2699_pr_merged_overhauled_serial_console_support_code"><a href="https://github.com/rear/rear/pull/2699">#2699 PR</a> <code>merged</code>: Overhauled serial console support code<a class="headerlink" href="#2699_pr_merged_overhauled_serial_console_support_code" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code>,
<code>minor bug</code></p>
<h4 id="jsmeix_opened_issue_at_2021-10-19_1051"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/2699">2021-10-19 10:51</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2021-10-19_1051" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong> / <strong>Cleanup</strong> / <strong>Minor Bugfixes</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2663">https://github.com/rear/rear/issues/2663</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    I can not really test it because I do not have serial hardware,
    see<br />
<a href="https://github.com/rear/rear/pull/2699#issuecomment-948367891">https://github.com/rear/rear/pull/2699#issuecomment-948367891</a><br />
    what I could test.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    See the code changes...</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2021-10-19_1113"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-946619943">2021-10-19 11:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-19_1113" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
could you test if my overhauled serial console code<br />
in this pull request still works for you?</p>
<p>I found out why only a serial device was added<br />
to kernel commandline and recovery system bootloaders<br />
if there was a "speed" value for that serial device:<br />
See my comment for the new get_serial_device_speed function in<br />
<a href="https://github.com/rear/rear/blob/093bd1bc58bf68819f731ce374469147e06c2f15/usr/share/rear/lib/serial-functions.sh">https://github.com/rear/rear/blob/093bd1bc58bf68819f731ce374469147e06c2f15/usr/share/rear/lib/serial-functions.sh</a></p>
<h4 id="jsmeix_commented_at_2021-10-19_1329"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-946725562">2021-10-19 13:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-19_1329" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
with my recent commits here I enhanced how<br />
SERIAL_CONSOLE_DEVICE_GRUB can be used.<br />
Now the user can alternatively specify a whole<br />
GRUB 'serial' command that is used as specified, e.g.<br />
SERIAL_CONSOLE_DEVICE_GRUB="serial --unit=0 --speed=9600"<br />
See my updated description for it in default.conf.</p>
<h4 id="jsmeix_commented_at_2021-10-19_1343"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-946738475">2021-10-19 13:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-19_1343" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
if my current SERIAL_CONSOLE_DEVICE_GRUB implementation<br />
works well for you (or if you find bugs that can be easily corrected)<br />
i.e. when you agree with the intent of my current<br />
SERIAL_CONSOLE_DEVICE_GRUB implementation<br />
then I could try to implement the same kind also for<br />
SERIAL_CONSOLE_DEVICE_SYSLINUX</p>
<h4 id="devil0000_commented_at_2021-10-19_1736"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-946949300">2021-10-19 17:36</a>:<a class="headerlink" href="#devil0000_commented_at_2021-10-19_1736" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I found out why only a serial device was added</p>
</blockquote>
<p>makes sense. That was my guess, too</p>
<blockquote>
<p>Now the user can alternatively specify a whole GRUB 'serial' command</p>
</blockquote>
<p>sounds good but not sure if that much control was needed</p>
<blockquote>
<p>could you test if my overhauled serial console code</p>
</blockquote>
<p>will do as soon as I find the time for it. maybe tomorrow - hopefully
this week.</p>
<h4 id="jsmeix_commented_at_2021-10-20_0938"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-947497047">2021-10-20 09:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-20_0938" title="Permanent link">&para;</a></h4>
<p>That SERIAL_CONSOLE_DEVICE_GRUB can be a whole GRUB 'serial'
command<br />
was more a nice side effect of my added safeguard condition<br />
<code>if test -c $SERIAL_CONSOLE_DEVICE_GRUB ; then</code><br />
because that made me think about the <code>else</code> case.<br />
Instead of just show an error for that <code>else</code> case<br />
I found it more helpful to support a whole GRUB 'serial' command.<br />
Of course then SERIAL_CONSOLE_DEVICE_GRUB="/dev/sda1" results<br />
a broken GRUB config but that is what I mean with "final power to the
user".<br />
When the user manually specifies bad things then bad things will
happen.<br />
ReaR runs as 'root' and ReaR is meant for experienced admins.</p>
<h4 id="jsmeix_commented_at_2021-10-20_1244"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-947628950">2021-10-20 12:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-20_1244" title="Permanent link">&para;</a></h4>
<p>I cannot really test because my homeoffice laptop has no<br />
real serial hardware so that for all its serial device nodes<br />
<code>stty -F /dev/ttyS*</code> results "Input/output error" so not any 'speed'
value<br />
so there is not any (semi)-automated serial console setup.</p>
<p>The only test I could do so far is with</p>
<pre><code>OUTPUT=USB
USB_DEVICE_FILESYSTEM_PERCENTAGE=10
USB_DEVICE_FILESYSTEM_LABEL='MY-DATA'
USB_BOOT_PART_SIZE=1024
USB_BOOTLOADER="grub"
USB_DEVICE_BOOT_LABEL=MY-BOOT
OUTPUT_URL=usb:///dev/disk/by-label/MY-BOOT
USB_DEVICE_PARTED_LABEL=gpt
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/MY-DATA
USE_SERIAL_CONSOLE="yes"
SERIAL_CONSOLE_DEVICE_GRUB="serial --unit=4 --speed=9600"
KERNEL_CMDLINE+=" console=ttyS4,9600 "
</code></pre>
<p>which results on my USB disk</p>
<pre><code># parted -s /dev/sdb unit GiB print
Model: TOSHIBA External USB 3.0 (scsi)
Disk /dev/sdb: 466GiB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 
Number  Start    End      Size     File system  Name     Flags
 1      0.00GiB  0.01GiB  0.01GiB               primary  bios_grub
 2      0.01GiB  1.01GiB  1.00GiB  ext2         primary  legacy_boot
 3      1.01GiB  46.6GiB  45.6GiB  ext3         primary

# lsblk -ipo NAME,TRAN,TYPE,FSTYPE,SIZE,LABEL /dev/sdb
NAME        TRAN TYPE FSTYPE   SIZE LABEL
/dev/sdb    usb  disk        465.8G 
|-/dev/sdb1      part            8M 
|-/dev/sdb2      part ext2       1G MY-BOOT
`-/dev/sdb3      part ext3    45.6G MY-DATA
</code></pre>
<p>this boot/grub2/grub.cfg file on sdb2</p>
<pre><code>search --no-floppy --set=root --label MY-BOOT
insmod all_video
set gfxpayload=keep
insmod part_gpt
insmod part_msdos
insmod ext2
serial --unit=4 --speed=9600
set timeout="300"
set default="chainloader"
set fallback="chainloader"
echo 'Switching to GRUB2 boot menu...'
sleep --verbose --interruptible 3
menuentry "Relax-and-Recover (BIOS or UEFI in legacy BIOS mode)" --id=rear {
    insmod gzio
    echo 'Loading kernel /rear/linux-h9wr/20211020.1437/kernel ...'
    linux /rear/linux-h9wr/20211020.1437/kernel root=UUID=f05af948-6075-40a3-9191-354b0a0a9afc  selinux=0 console=tty0 
    echo 'Loading initial ramdisk /rear/linux-h9wr/20211020.1437/initrd.cgz ...'
    initrd /rear/linux-h9wr/20211020.1437/initrd.cgz
}
menuentry "Boot from second disk hd1 (usually the original system disk)" --id=chainloader {
    insmod chain
    set root=(hd1)
    chainloader +1
}
menuentry "Reboot" --id=reboot {
    reboot
}
menuentry "Exit (possibly continue bootchain)" --id=exit {
    exit
}
</code></pre>
<p>with fallback <code>KERNEL_CMDLINE=' selinux=0 console=tty0 '</code><br />
in contrast to what I had specified in local.conf<br />
<code>KERNEL_CMDLINE+=" console=ttyS4,9600 "</code>.<br />
This is because cmdline_add_console() in
usr/share/rear/lib/serial-functions.sh<br />
strips all existing 'console=...' parameters from the kernel
commandline<br />
that code was before in rescue/GNU/Linux/400_use_serial_console.sh<br />
cf.
<a href="https://github.com/rear/rear/commit/009b1b43eb18df78fc5c4dde1e9268376d948bb4">https://github.com/rear/rear/commit/009b1b43eb18df78fc5c4dde1e9268376d948bb4</a><br />
but if no serial device node has a 'speed' value it adds the fallback
'console=tty0'<br />
so I wonder how I could provide same final power to the user<br />
also for serial console setup of his kernel commandline<br />
as he has for his serial console setup for SYSLINUX and GRUB.</p>
<h4 id="jsmeix_commented_at_2021-10-21_0813"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-948367891">2021-10-21 08:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-21_0813" title="Permanent link">&para;</a></h4>
<p>With my recent enhancement SERIAL_CONSOLE_DEVICES_KERNEL<br />
I can specify serial consoles for the kernel of the recovery system<br />
as I like:</p>
<pre><code>OUTPUT=USB
USB_DEVICE_FILESYSTEM_PERCENTAGE=10
USB_DEVICE_FILESYSTEM_LABEL='MY-DATA'
USB_BOOT_PART_SIZE=1024
USB_BOOTLOADER="grub"
USB_DEVICE_BOOT_LABEL=MY-BOOT
OUTPUT_URL=usb:///dev/disk/by-label/MY-BOOT
USB_DEVICE_PARTED_LABEL=gpt
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/MY-DATA
USE_SERIAL_CONSOLE="yes"
SERIAL_CONSOLE_DEVICE_GRUB="serial --unit=4 --speed=9600"
SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS7 console=ttyS8,9600 console=tty0"
</code></pre>
<p>results this boot/grub2/grub.cfg file on my sdb2 USB boot partition</p>
<pre><code>search --no-floppy --set=root --label MY-BOOT
insmod all_video
set gfxpayload=keep
insmod part_gpt
insmod part_msdos
insmod ext2
serial --unit=4 --speed=9600
set timeout="300"
set default="chainloader"
set fallback="chainloader"
echo 'Switching to GRUB2 boot menu...'
sleep --verbose --interruptible 3
menuentry "Relax-and-Recover (BIOS or UEFI in legacy BIOS mode)" --id=rear {
    insmod gzio
    echo 'Loading kernel /rear/linux-h9wr/20211021.0955/kernel ...'
    linux /rear/linux-h9wr/20211021.0955/kernel root=UUID=f05af948-6075-40a3-9191-354b0a0a9afc  selinux=0 console=ttyS7 console=ttyS8,9600 console=tty0 
    echo 'Loading initial ramdisk /rear/linux-h9wr/20211021.0955/initrd.cgz ...'
    initrd /rear/linux-h9wr/20211021.0955/initrd.cgz
}
menuentry "Boot from second disk hd1 (usually the original system disk)" --id=chainloader {
    insmod chain
    set root=(hd1)
    chainloader +1
}
menuentry "Reboot" --id=reboot {
    reboot
}
menuentry "Exit (possibly continue bootchain)" --id=exit {
    exit
}
</code></pre>
<p>Booting from that USB disk works well for me<br />
on my older x86_64 laptop with traditional BIOS<br />
that has no serial hardware ("stty -F /dev/ttyS..." show "Input/output
error")<br />
so I see GRUB error messages about unavailable serial things<br />
(because of "sleep --verbose --interruptible 3" one can see such
messages)<br />
but GRUB is sufficiently fail-safe and shows its menu on the VGA
console<br />
and same for the kernel that also uses the VGA console.<br />
In the booted recovery system "dmesg" shows<br />
"... console=ttyS7 console=ttyS8,9600 console=tty0"<br />
in the kernel command line.</p>
<h4 id="jsmeix_commented_at_2021-10-21_1017"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-948465839">2021-10-21 10:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-21_1017" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
because my above little test without real serial hardware<br />
<a href="https://github.com/rear/rear/pull/2699#issuecomment-948367891">https://github.com/rear/rear/pull/2699#issuecomment-948367891</a><br />
worked at least for me I think it this pull request is now in a state<br />
where you could also test it - preferably with a real serial console.<br />
If you find issues I will fix them (as good as I can).</p>
<h4 id="jsmeix_commented_at_2021-10-21_1036"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-948479413">2021-10-21 10:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-21_1036" title="Permanent link">&para;</a></h4>
<p>I wonder why we explicitly set hardcoded GRUB serial options</p>
<pre><code>--word=8 --parity=no --stop=1
</code></pre>
<p>when those are the defaults in GRUB according to<br />
<a href="https://www.gnu.org/software/grub/manual/grub/grub.html#serial">https://www.gnu.org/software/grub/manual/grub/grub.html#serial</a><br />
that reads (excerpt)</p>
<pre><code>word and stop are the number of data bits and stop bits.
Data bits must be in the range 5-8 and stop bits must be 1 or 2.
Default is 8 data bits and one stop bit.
parity is one of ‘no’, ‘odd’, ‘even’ and defaults to ‘no’.
</code></pre>
<p>I think it is better to not explicitly enforce default values<br />
because that is against what is meant with defaults.</p>
<p>With SERIAL_CONSOLE_DEVICE_GRUB the user can specify<br />
a whole GRUB 'serial' command with all options<br />
when he needs non-default options like</p>
<pre><code>SERIAL_CONSOLE_DEVICE_GRUB="serial --unit=2 --speed=115200 --word=7 --stop=2 --parity=odd"
</code></pre>
<h4 id="jsmeix_commented_at_2021-10-26_1216"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-951879501">2021-10-26 12:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-26_1216" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
I would like to merge it tomorrow afternoon<br />
unless there are objections.</p>
<h4 id="devil0000_commented_at_2021-10-26_1633"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-952113219">2021-10-26 16:33</a>:<a class="headerlink" href="#devil0000_commented_at_2021-10-26_1633" title="Permanent link">&para;</a></h4>
<p>I was a bit busy the last days. Will try to test it tomorrow</p>
<h4 id="jsmeix_commented_at_2021-10-27_0538"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-952554825">2021-10-27 05:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-27_0538" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
OK - I will wait some more days so you could test it.</p>
<h4 id="devil0000_commented_at_2021-10-27_1234"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-952880500">2021-10-27 12:34</a>:<a class="headerlink" href="#devil0000_commented_at_2021-10-27_1234" title="Permanent link">&para;</a></h4>
<p>base config used:</p>
<pre><code>OUTPUT=USB
BACKUP=BORG
USB_DEVICE=/dev/disk/by-label/REAR-000
USB_DEVICE_FILESYSTEM_LABEL=REAR-000
USB_DEVICE_PARTED_LABEL=gpt
USB_DEVICE_FILESYSTEM=ext4
USB_UEFI_PART_SIZE="2048"
CLONE_USERS=(root)
CLONE_GROUPS=(root)
CLONE_ALL_USERS_GROUPS="false"
BORGBACKUP_REPO="/borg"
BORGBACKUP_UMASK="0002"
BORGBACKUP_ENC_TYPE="repokey"
export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
export BORG_UNKNOWN_UNENCRYPTED_REPO_ACCESS_IS_OK="yes"
export TMPDIR="/tmp/"
USE_RESOLV_CONF="no"
USE_DHCLIENT=no
USE_STATIC_NETWORKING=1
USE_SERIAL_CONSOLE=y
COPY_KERNEL_PARAMETERS=( 'net.ifnames' 'biosdevname', 'console' )
USING_UEFI_BOOTLOADER=0
USB_BOOTLOADER=grub
GRUB2_DEFAULT_BOOT="1"
#speedup testing:
REAR_INITRD_COMPRESSION="fast"
MODULES=( 'no_modules' )
FIRMWARE_FILES=( 'no' )
EXCLUDE_RUNTIME_LOGFILE="yes"
</code></pre>
<p>added for boot partition test as needed:</p>
<pre><code>USB_BOOT_PART_SIZE="2048"
OUTPUT_URL=usb:///dev/disk/by-label/REARBOOT
</code></pre>
<p>I tested in addition the following serial config combinations:</p>
<pre><code>SERIAL_CONSOLE_DEVICES="/dev/ttyS0"

SERIAL_CONSOLE_DEVICES=
SERIAL_CONSOLE_DEVICE_GRUB="serial --unit=1 --speed=115200"
SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS0"

SERIAL_CONSOLE_DEVICES=
SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS0"
SERIAL_CONSOLE_DEVICE_SYSLINUX="serial 1 115200"
USB_BOOTLOADER=syslinux
</code></pre>
<p>issues found:</p>
<ul>
<li>USB_BOOT_PART_SIZE is not set by default causing a missing boot
    partition. a default of at least 1gb would make sense; min about
    512mb; I like 2gb personally. I think it should be default to work
    well with all output modes. grub config is slightly wrong in this
    case and looking for label REARBOOT even it it does not exist but it
    still works.</li>
<li>if USB_BOOT_PART_SIZE is set the output URL default is wrong. it
    points to data not to boot. should be
    OUTPUT_URL=usb:///dev/disk/by-label/REARBOOT</li>
<li>mkrescue fails if data partition is mounted</li>
<li>default description is wrong:
    <code># SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS0 console=ttyS1,9600 console=tty0"</code>.
    the device should not be there but <code>console=</code> stuff should be</li>
</ul>
<p><strong>so the serial part looks good to me</strong></p>
<h4 id="jsmeix_commented_at_2021-10-28_0645"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-953549178">2021-10-28 06:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-28_0645" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
thank you for your review!<br />
It helps us so much to have a review by one who actually has serial
hardware.</p>
<p>Regarding USB_BOOT_PART_SIZE or other OUTPUT=USB issues:<br />
I will do further enhancements and cleanup for OUTPUT=USB<br />
see
<a href="https://github.com/rear/rear/issues/2666">https://github.com/rear/rear/issues/2666</a><br />
as time permits (but before ReaR 2.7 will be released).</p>
<p>Regarding SERIAL_CONSOLE_DEVICES_KERNEL description in default.conf</p>
<pre><code>SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS0 console=ttyS1,9600 console=tty0"
</code></pre>
<p>I think it is right because I had tested</p>
<pre><code>SERIAL_CONSOLE_DEVICES_KERNEL="/dev/ttyS7 console=ttyS8,9600 console=tty0"
</code></pre>
<p>and got in the kernel command line</p>
<pre><code>console=ttyS7 console=ttyS8,9600 console=tty0
</code></pre>
<p>see
<a href="https://github.com/rear/rear/pull/2699#issuecomment-948367891">https://github.com/rear/rear/pull/2699#issuecomment-948367891</a></p>
<h4 id="jsmeix_commented_at_2021-10-28_0646"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2699#issuecomment-953549872">2021-10-28 06:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-10-28_0646" title="Permanent link">&para;</a></h4>
<p>I would like to merge it today afternoon<br />
unless there are objections.</p>
<p>If the SERIAL_CONSOLE_DEVICES_KERNEL description in default.conf<br />
is really wrong I would fix it afterwards.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-10-19.2699.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
