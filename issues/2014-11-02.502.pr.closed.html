<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#502 PR closed: add support for modular custom function cf--$stage--my_function - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#502 PR closed: add support for modular custom function cf--$stage--my_function";
        var mkdocs_page_input_path = "issues/2014-11-02.502.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#502 PR closed: add support for modular custom function cf--$stage--my_function</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="502_pr_closed_add_support_for_modular_custom_function_cf--stage--my_function"><a href="https://github.com/rear/rear/pull/502">#502 PR</a> <code>closed</code>: add support for modular custom function cf--$stage--my_function<a class="headerlink" href="#502_pr_closed_add_support_for_modular_custom_function_cf--stage--my_function" title="Permanent link">&para;</a></h1>
<h4 id="tbsky_opened_issue_at_2014-11-02_0519"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> opened issue at <a href="https://github.com/rear/rear/pull/502">2014-11-02 05:19</a>:<a class="headerlink" href="#tbsky_opened_issue_at_2014-11-02_0519" title="Permanent link">&para;</a></h4>
<p>hi:<br />
I need to add a small custom script to rear. thanks for rear modular
design, I can easily add my script to something like
"/usr/share/rear/backup/NETFS/default/66_my_backup.sh" and
"/usr/share/rear/restore/NETFS/default/66_my_restore.sh" .</p>
<p>now I want to further enhance the modular design, try to put all my
scripts to /etc/rear/local.conf so it is easier to maintain and separate
my scripts from official rear system.</p>
<p>I try to use a "custom function" idea, so I can add my script to
/etc/rear/local.conf and rear will automatically find them and include
them. so my /etc/rear/local.conf would look like below:</p>
<p>function cf--backup--66_make_drbd_vm_backup {<br />
/share/bin/drbd-vm-backup -b -t drbd-single -d
$TMP_DIR/isofs/drbd-vm-backup<br />
}<br />
function cf--restore--66_restore_drbd_vm_backup {<br />
drbd-vm-backup -r -t drbd-single -d
$BUILD_DIR/outputfs/drbd-vm-backup<br />
}</p>
<p>with the patch I can enjoy rear modular design and maintain all the
custom change to /etc/rear/local.conf. I try this in my system and is
seems work well. but I don't really understand all the rear internals.so
please review and fix any non-proper codes.</p>
<h4 id="schlomo_commented_at_2014-11-02_0946"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61399814">2014-11-02 09:46</a>:<a class="headerlink" href="#schlomo_commented_at_2014-11-02_0946" title="Permanent link">&para;</a></h4>
<p>Hi @tbsky,</p>
<p>this is a really interesting idea and I would like to help you to
achieve your goal, though I don't feel well with this implementation
because this implementation sufferes IMHO from the following problems:</p>
<ul>
<li>No separation between code and config (Yes, I know you want to have
    that, but how would you write a unit test for it?)</li>
<li>The whole topic of SIMULATE is now spread over Source() and
    SourceStage() where before it was just in Source().</li>
<li>Sorting custom functions into the list of scripts uses a different
    method than sorting scripts, this might lead to future troubles</li>
<li>This code only plugs scripts into stages but not into different
    OUTPUT, BACKUP and OS* dimensions. It would be nice to find a
    solution that would manage that as well with the same code.</li>
</ul>
<p>If to follow this path then I would suggest that you add the functions
to the scripts array so that they will be sorted together with the real
scripts. Then you would extend the Source function to detect if it is
given a script or a function and do the right thing.</p>
<p>Can you please help me to understand why you must maintain your extra
code in configuration? Would you do the same with extra Apache stuff or
would you plug that into the appropriate subdir in /etc/httpd?</p>
<p>Can it be that your problem is more a problem of deployment than a
problem of having it all in the same file? Maybe you can share with us
how you deploy ReaR? How do you deploy the ReaR configuration?</p>
<p>Kind Regards,<br />
Schlomo</p>
<h4 id="tbsky_commented_at_2014-11-02_1553"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61411745">2014-11-02 15:53</a>:<a class="headerlink" href="#tbsky_commented_at_2014-11-02_1553" title="Permanent link">&para;</a></h4>
<p>hi schlomo:<br />
thanks a lot for your information! I am sorry I am not a native English
speaker. so I can only try my best to describe my thought :)</p>
<p>my environment:<br />
hard disks -&gt; mdadm raid -&gt; lvm -&gt; drbd -&gt; libvirtd vm (I am
using drbd device as kvm raw disk). this is a cluster node, so cluster
data is synced at drbd level and vm is controlled by cluster software.
the real application which running user services is at the vm level, so
I just backup the vm data in the past. about the host environment, it
was just too complicated to backup,so I gave up, until I met rear.</p>
<p>rear can backup the host os and layout of mdadm,lvm,drbd and restore all
these correctly. that is amazing! now only the vm left. I can just skip
that, since this part are really hard to handle correctly. if you
analyze the content of vm, there maybe windows vm with ntfs or linux vm
with lvm+ext4fs.</p>
<p>my thought:<br />
rear won't handle every situation, so it leaves some options for the
users. in my case, I need to define<br />
backup method and some include/exclude parameters. then if I want to
backup the vm in rear, I need to write my own custom script.</p>
<p>in my feeling, the script which go to /usr/share/rear should be
official/general usage script. there should be some other place to put
the custom/specific script. but currently I saw rear only offer
pre-restore/post-restore parameter. so if you need to hook other parts
of rear, you need put your code the the "official" /usr/share/rear
place, which in my feeling that place belongs to developer, not to end
user.</p>
<p>take an example for my thought. our company also use another software
"Freepbx" which is a pbx software. it will call custom setup/script
everywhere, so you can inject your custom setup and code into the
system. it even provide you config files so you can "overwrite" some of
the official code. and in fact I did need that feature to overwrite the
official code for some special case. and I can do it without touch the
"Freepbx" official code.</p>
<p>so I think if rear can have some custom hook is a good thing. the patch
try to do minimal changes to get the feature and maintain compatibility.
I think the official way maybe need to think about where end-users can
hook their code, like "pre-restore" or "post-restore". but the amazing
part is in current rear design, you can almost hook your code into every
place, just there is no official way. you need to code your custom
script as the official scripts.</p>
<p>I also think the custom code is not necessary to take the same treatment
as official code. there maybe no need about "function debug" or "test
unit". since it's the code written by end user for their specific needs.
in my case, the custom "script" is an one liner which calls the real
script I wrote for backup/restore the vm (my script is only doing dd
now) . as you can see in my example local.conf.</p>
<p>maybe my need is special. I can already archive my need in current rear
design. but maintain everything in one config file is a benefit to me.
so I don't need to care the location of my custom scripts which mix with
official rear scripts. I don't really concern about mix code and
configuration in one file, since rear config file is actually bash code.</p>
<h4 id="schlomo_commented_at_2014-11-02_1908"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61419030">2014-11-02 19:08</a>:<a class="headerlink" href="#schlomo_commented_at_2014-11-02_1908" title="Permanent link">&para;</a></h4>
<p>So how do you deploy ReaR and that local.conf?</p>
<p>Actually the "official" way to extend ReaR is exactly as you found
out:<br />
Simply drop your additions into the appropriate ReaR subdirectories.
Thats<br />
why it is so open and modular, so that people like you can easily add
their<br />
own stuff without any need to modify files from ReaR.</p>
<p>If you use packages like RPM or DEB there also can't be any confusion<br />
between ReaR files (from rear package) and your own addons.</p>
<p>Your setup sound really impressive and I still think that the answer
to<br />
your question lies in the deployment and configuration management.</p>
<p>However, if it makes you happy: Why not send us a patch to add a<br />
PRE_RESTORE and POST_RESTORE or PRE_BACKUP and POST_BACKUP
variable,<br />
whatever you need right now? Similar to the POST_RECOVERY_SCRIPT
variable.<br />
You could simply clone that.</p>
<p>Sometimes beeing more specific is actually simpler than beeing more<br />
generic. I am not sure if our users would understand this concept of<br />
injecting specially named functions.</p>
<p>On 2 November 2014 16:53, tbsky <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>hi schlomo:<br />
thanks a lot for your information! I am sorry I am not a native
English<br />
speaker. so I can only try my best to describe my thought :)</p>
<p>my environment:<br />
hard disks -&gt; mdadm raid -&gt; lvm -&gt; drbd -&gt; libvirtd vm (I
am using drbd<br />
device as kvm raw disk). this is a cluster node, so cluster data is
synced<br />
at drbd level and vm is controlled by cluster software. the real<br />
application which running user services is at the vm level, so I
just<br />
backup the vm data in the past. about the host environment, it was
just too<br />
complicated to backup,so I gave up, until I met rear.</p>
<p>rear can backup the host os and layout of mdadm,lvm,drbd and restore
all<br />
these correctly. that is amazing! now only the vm left. I can just
skip<br />
that, since this part are really hard to handle correctly. if you
analyze<br />
the content of vm, there maybe windows vm with ntfs or linux vm with<br />
lvm+ext4fs.</p>
<p>my thought:<br />
rear won't handle every situation, so it leaves some options for the<br />
users. in my case, I need to define<br />
backup method and some include/exclude parameters. then if I want to<br />
backup the vm in rear, I need to write my own custom script.</p>
<p>in my feeling, the script which go to /usr/share/rear should be
official/general usage script. there should be some other place to put
the custom/specific script. but currently I saw rear only offer
pre-restore/post-restore parameter. so if you need to hook other parts
of rear, you need put your code the the "official" /usr/share/rear
place, which in my feeling that place belongs to developer, not to end
user.</p>
<p>take an example for my thought. our company also use another
software<br />
"Freepbx" which is a pbx software. it will call custom setup/script<br />
everywhere, so you can inject your custom setup and code into the
system.<br />
it even provide you config files so you can "overwrite" some of the<br />
official code. and in fact I did need that feature to overwrite the<br />
official code for some special case. and I can do it without touch
the<br />
"Freepbx" official code.</p>
<p>so I think if rear can have some custom hook is a good thing. the
patch<br />
try to do minimal changes to get the feature and maintain
compatibility. I<br />
think the official way maybe need to think about where end-users can
hook<br />
their code, like "pre-restore" or "post-restore". but the amazing part
is<br />
in current rear design, you can almost hook your code into every
place,<br />
just there is no official way. you need to code your custom script as
the<br />
official scripts.</p>
<p>I also think the custom code is not necessary to take the same
treatment<br />
as official code. there maybe no need about "function debug" or
"test<br />
unit". since it's the code written by end user for their specific
needs. in<br />
my case, the custom "script" is an one liner which calls the real
script I<br />
wrote for backup/restore the vm (my script is only doing dd now) . as
you<br />
can see in my example local.conf.</p>
<p>maybe my need is special. I can already archive my need in current
rear design. but maintain everything in one config file is a benefit
to me. so I don't need to care the location of my custom scripts which
mix with official rear scripts. I don't really concern about mix code
and configuration in one file, since rear config file is actually bash
code.</p>
<p>—<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/502#issuecomment-61411745">https://github.com/rear/rear/pull/502#issuecomment-61411745</a>.</p>
</blockquote>
<h4 id="tbsky_commented_at_2014-11-03_0422"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61439295">2014-11-03 04:22</a>:<a class="headerlink" href="#tbsky_commented_at_2014-11-03_0422" title="Permanent link">&para;</a></h4>
<p>hi schlomo:<br />
thanks a lot for your confirm. I am just providing an idea to inject
end-user code. as you said "drop your additions into the appropriate
ReaR subdirectories" is the official way. then I will just stay with it.
as you said, there is no such difference.</p>
<p>the "PRE_BACKUP" or "POST_BACKUP" won't help a lot, since code may
need to inject at some specific stage. but maybe a "PRE" and "POST"
variable for every "official" script? so if I need to inject some code
at some stage, I can just use that variable to inject my code. "Freepbx"
use that method. I don't know if it will be considered too lousy.</p>
<p>about " how do you deploy ReaR and that local.conf". I am using
ScientificLinux(RHEL) 6.5 and rear 1.6.1 comes with EPEL (but now using
git master) . i just edit /etc/rear/local.conf and do "rear mkbackup".
my complete /etc/rear/local.conf with custom function below:</p>
<pre><code>BACKUP=NETFS
BACKUP_PROG_EXCLUDE=( "${BACKUP_PROG_EXCLUDE[@]}" '/share/cluster/iso/*' '/share/rear-tmp/*')
PROGS=( "${PROGS[@]}" '/lib/drbd/drbdadm-84' '/lib/drbd/drbdsetup-84' 'pv' '/share/bin/drbd-vm-backup')
ISO_MAX_SIZE=25000
BACKUP_URL=iso://backup/
OUTPUT=ISO
OUTPUT_URL=null
ISO_DIR=/share/rear-tmp

function cf--backup--66_make_drbd_vm_backup {
        /share/bin/drbd-vm-backup -b -t drbd-single -p gzip -d $TMP_DIR/isofs/drbd-vm-backup
}

function cf--restore--66_restore_drbd_vm_backup {
        drbd-vm-backup -r -t drbd-test,drbd-single -p gzip -c -d $BUILD_DIR/outputfs/drbd-vm-backup
}
</code></pre>
<p>without custom function, i will put custom backup/restore script to rear
directory (maybe make a rpm for it) and define some more variable at
local.conf. (since I don't want to put different custom scripts to
different cluster node, so I want to use configuration files to control
the behavior). my custom script will look like below.</p>
<p>add script parameters to /etc/rear/local.conf</p>
<pre><code>DRBD_BACKUP=drbd-single
DRBD_BACKUP_PARAMETER="-p gzip"
DRBD_RESTORE_PARAMETER="-p gzip"
</code></pre>
<p>66_make_drbd_vm_backup.sh</p>
<pre><code>if [ -n "$DRBD_BACKUP" ];then
        /share/bin/drbd-vm-backup -b -t $DRBD_BACKUP $DRBD_BACKUP_PARAMETER -d $TMP_DIR/isofs/drbd-vm-backup
fi
</code></pre>
<p>66_restore_drbd_vm.sh</p>
<pre><code>if [ -n "$DRBD_BACKUP" ];then
        drbd-vm-backup -r -t $DRBD_BACKUP $DRBD_RESTORE_PARAMETER -c -d $BUILD_DIR/outputfs/drbd-vm-backup
fi
</code></pre>
<p>as you can see, custom function will be clear and simple in my case. but
I can live without it :)<br />
and if rear would accept make a "PRE" and "POST" variable into every
official script, things will be simple and clear for me too.</p>
<h4 id="schlomo_commented_at_2014-11-03_0720"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61446037">2014-11-03 07:20</a>:<a class="headerlink" href="#schlomo_commented_at_2014-11-03_0720" title="Permanent link">&para;</a></h4>
<p>The recommended way in your scenario would be to create an RPM, e.g.
called<br />
"my-rear" which would ship the configuration as /etc/rear/site.conf<br />
(instead of local.conf) and it would ship your extra scripts and
simply<br />
depend on rear. That way you just install "my-rear" and everything
else<br />
works automatically.</p>
<p>That is actually how I deploy everything. Just put it into a custom RPM.</p>
<p>If you want to submit a patch that would allow wrapping every ReaR
script<br />
with a suitably named pre_* or post_* function then I would be happy
to<br />
review it (Hint: It should go into the Source function)</p>
<p>On 3 November 2014 05:22, tbsky <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>hi schlomo:<br />
thanks a lot for your confirm. I am just providing an idea to inject<br />
end-user code. as you said "drop your additions into the appropriate
ReaR<br />
subdirectories" is the official way. then I will just stay with it. as
you<br />
said, there is no such difference.</p>
<p>the "PRE_BACKUP" or "POST_BACKUP" won't help a lot, since code may
need to<br />
inject at some specific stage. but maybe a "PRE" and "POST" variable
for<br />
every "official" script? so if I need to inject some code at some
stage, I<br />
can just use that variable to inject my code. "Freepbx" use that
method. I<br />
don't know if it will be considered too lousy.</p>
<p>about " how do you deploy ReaR and that local.conf". I am using<br />
ScientificLinux(RHEL) 6.5 and rear 1.6.1 comes with EPEL (but now
using git<br />
master) . i just edit /etc/rear/local.conf and do "rear mkbackup".
my<br />
complete /etc/rear/local.conf with custom function below:</p>
<p>BACKUP=NETFS<br />
BACKUP_PROG_EXCLUDE=( "${BACKUP_PROG_EXCLUDE[@]}"
'/share/cluster/iso/<em>' '/share/rear-tmp/</em>')<br />
PROGS=( "${PROGS[@]}" '/lib/drbd/drbdadm-84'
'/lib/drbd/drbdsetup-84' 'pv' '/share/bin/drbd-vm-backup')<br />
ISO_MAX_SIZE=25000<br />
BACKUP_URL=iso://backup/<br />
OUTPUT=ISO<br />
OUTPUT_URL=null<br />
ISO_DIR=/share/rear-tmp</p>
<p>function cf--backup--66_make_drbd_vm_backup {<br />
/share/bin/drbd-vm-backup -b -t drbd-single -p gzip -d
$TMP_DIR/isofs/drbd-vm-backup<br />
}</p>
<p>function cf--restore--66_restore_drbd_vm_backup {<br />
drbd-vm-backup -r -t drbd-test,drbd-single -p gzip -c -d
$BUILD_DIR/outputfs/drbd-vm-backup<br />
}</p>
<p>without custom function, i will put custom backup/restore script to
rear<br />
directory (maybe make a rpm for it) and define some more variable at<br />
local.conf. (since I don't want to put different custom scripts to<br />
different cluster node, so I want to use configuration files to
control the<br />
behavior). my custom script will look like below.</p>
<p>add script parameters to /etc/rear/local.conf</p>
<p>DRBD_BACKUP=drbd-single<br />
DRBD_BACKUP_PARAMETER="-p gzip"<br />
DRBD_RESTORE_PARAMETER="-p gzip"</p>
<p>66_make_drbd_vm_backup.sh</p>
<p>if [ -n "$DRBD_BACKUP" ];then<br />
/share/bin/drbd-vm-backup -b -t $DRBD_BACKUP $DRBD_BACKUP_PARAMETER
-d $TMP_DIR/isofs/drbd-vm-backup<br />
fi</p>
<p>66_restore_drbd_vm.sh</p>
<p>if [ -n "$DRBD_BACKUP" ];then<br />
drbd-vm-backup -r -t $DRBD_BACKUP $DRBD_RESTORE_PARAMETER -c -d
$BUILD_DIR/outputfs/drbd-vm-backup<br />
fi</p>
<p>as you can see, custom function will be clear and simple in my case.
but I<br />
can live without it :)<br />
and if rear would accept make a "PRE" and "POST" variable into every<br />
official script, things will be simple and clear for me too.</p>
<p>—<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/502#issuecomment-61439295">https://github.com/rear/rear/pull/502#issuecomment-61439295</a>.</p>
</blockquote>
<h4 id="tbsky_commented_at_2014-11-03_0807"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61448611">2014-11-03 08:07</a>:<a class="headerlink" href="#tbsky_commented_at_2014-11-03_0807" title="Permanent link">&para;</a></h4>
<p>hi schlomo:</p>
<p>I am glad that you would take a review with the "pre" &amp; "post" script
idea. I will try to do it asap, I think it will make my life easier :)</p>
<p>my current linux machines has all kind of configuration, so I plan to
tune local.conf to adopt the situation. but if I can find a
configuration that suit all cases, I think I will take your route: make
a rpm and deploy it!</p>
<p>thanks again for your patience and kindly help!!</p>
<h4 id="gdha_commented_at_2014-11-04_1423"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61645872">2014-11-04 14:23</a>:<a class="headerlink" href="#gdha_commented_at_2014-11-04_1423" title="Permanent link">&para;</a></h4>
<p>@tbsky is the pull request obsolete now?</p>
<h4 id="tbsky_commented_at_2014-11-04_1516"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61654596">2014-11-04 15:16</a>:<a class="headerlink" href="#tbsky_commented_at_2014-11-04_1516" title="Permanent link">&para;</a></h4>
<p>hi gdha:<br />
yes I think it is obsolete now. how to I handle it? just close it?</p>
<h4 id="schlomo_commented_at_2014-11-04_1536"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61657972">2014-11-04 15:36</a>:<a class="headerlink" href="#schlomo_commented_at_2014-11-04_1536" title="Permanent link">&para;</a></h4>
<p>Yes, just close it, maybe with a reference to the new one.</p>
<p>On 4 November 2014 16:16, tbsky <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>hi gdha:<br />
yes I think it is obsolete now. how to I handle it? just close it?</p>
<p>—<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/pull/502#issuecomment-61654596">https://github.com/rear/rear/pull/502#issuecomment-61654596</a>.</p>
</blockquote>
<h4 id="tbsky_commented_at_2014-11-04_1558"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/pull/502#issuecomment-61661921">2014-11-04 15:58</a>:<a class="headerlink" href="#tbsky_commented_at_2014-11-04_1558" title="Permanent link">&para;</a></h4>
<p>ok. close it and reference to
<a href="https://github.com/rear/rear/pull/503">https://github.com/rear/rear/pull/503</a>
for further discussion :)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2014-11-02.502.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
