<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2006 Issue closed: No code has been generated to recreate disk - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2006 Issue closed: No code has been generated to recreate disk";
        var mkdocs_page_input_path = "issues/2018-12-17.2006.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2006 Issue closed: No code has been generated to recreate disk</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2006_issue_closed_no_code_has_been_generated_to_recreate_disk"><a href="https://github.com/rear/rear/issues/2006">#2006 Issue</a> <code>closed</code>: No code has been generated to recreate disk<a class="headerlink" href="#2006_issue_closed_no_code_has_been_generated_to_recreate_disk" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>waiting for info</code>, <code>support / question</code>,
<code>no-issue-activity</code></p>
<h4 id="gk1_opened_issue_at_2018-12-17_2028"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> opened issue at <a href="https://github.com/rear/rear/issues/2006">2018-12-17 20:28</a>:<a class="headerlink" href="#gk1_opened_issue_at_2018-12-17_2028" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): Relax-and_recover 2.4 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"): RHEL 7.4</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
### create a backup using the internal NETFS method, using 'tar'
BACKUP=NETFS
### write both rescue image and backup to the device labeled REAR-000
BACKUP_URL=cifs://192.168.187.35/backup/
BACKUP_OPTIONS="cred=/etc/rear/.cifs"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR): Baremetal restoring to ESXI VM</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): x86_64</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): Grub</p>
</li>
<li>
<p>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): Local software raid 10</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):
    No code created to recreate disk /dev/md127</p>
</li>
<li>
<p>Workaround, if any: none</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<h4 id="gk1_commented_at_2018-12-17_2030"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-447988135">2018-12-17 20:30</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-17_2030" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2687734/rear-PriSMS-1.log">rear-PriSMS-1.log</a></p>
<h4 id="jsmeix_commented_at_2018-12-18_0914"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-448150247">2018-12-18 09:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-18_0914" title="Permanent link">&para;</a></h4>
<p>@gk1<br />
from only your "rear -v -D recover" log in<br />
<a href="https://github.com/rear/rear/files/2687734/rear-PriSMS-1.log">https://github.com/rear/rear/files/2687734/rear-PriSMS-1.log</a><br />
it is in practice impossible to imagine your system disk layout<br />
so that we also need at least your <code>disklayout.conf</code> file or even
better<br />
all files in your <code>/var/lib/rear</code> directory and in its sub-directories,
cf. the<br />
section "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Additionally - if possible - could you provide us the output of</p>
<pre><code>lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>on your original system?</p>
<p>I do not understand what <code>RHEL 7.4</code> together with<br />
<code>Baremetal restoring to ESXI VM</code> means - but I am no VMware ESXi user.<br />
As far as I understand<br />
<a href="https://en.wikipedia.org/wiki/VMware_ESXi">https://en.wikipedia.org/wiki/VMware_ESXi</a><br />
<code>ESX runs on bare metal</code><br />
so that I assume what you mean is that you like to recover<br />
a RHEL 7.4 system that runs on VMware ESXi<br />
or what do I misunderstand here?</p>
<h4 id="gdha_commented_at_2018-12-18_1019"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-448170053">2018-12-18 10:19</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-18_1019" title="Permanent link">&para;</a></h4>
<p>@gk1 As DRDB is involved it is a cluster setup we are dealing with. Is
it possible to submit the <code>/var/lib/rear/layout/disklayout.conf</code> (all
content of this directory is even better) and <code>rear.log</code> (of the
recovery) of both nodes so we can compare?</p>
<h4 id="gk1_commented_at_2018-12-18_1440"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-448242644">2018-12-18 14:40</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-18_1440" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@gk1<br />
from only your "rear -v -D recover" log in<br />
<a href="https://github.com/rear/rear/files/2687734/rear-PriSMS-1.log">https://github.com/rear/rear/files/2687734/rear-PriSMS-1.log</a><br />
it is in practice impossible to imagine your system disk layout<br />
so that we also need at least your <code>disklayout.conf</code> file or even
better<br />
all files in your <code>/var/lib/rear</code> directory and in its
sub-directories, cf. the<br />
section "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Additionally - if possible - could you provide us the output of</p>
<pre><code>lsblk -i -p -o NAME,KNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>on your original system?</p>
<p>I do not understand what <code>RHEL 7.4</code> together with<br />
<code>Baremetal restoring to ESXI VM</code> means - but I am no VMware ESXi
user.<br />
As far as I understand<br />
<a href="https://en.wikipedia.org/wiki/VMware_ESXi">https://en.wikipedia.org/wiki/VMware_ESXi</a><br />
<code>ESX runs on bare metal</code><br />
so that I assume what you mean is that you like to recover<br />
a RHEL 7.4 system that runs on VMware ESXi<br />
or what do I misunderstand here?</p>
</blockquote>
<p>As far as the baremetel, We are running this clusters on bare metal, and
are trying to restore to an esxi based development system so we can
resolve issues beyond just the Disaster recovery. We have replicated the
number of disks in the esx guest to be able to do the restore.</p>
<p>It is a cluster as mention above. The second node of the cluster was
able to restore the system fine, outside of that the drbd was broken as
you can imagine, which is why we wanted to restore the primary as well.
The 2 boot iso images are different sizes, with the one for the primary
being smaller which i do not understand as it has more files and a
complete running image, the secondary boot iso is like 40mb larger. I
will gather the requested lsblk information later today and get back to
you. I do not have direct access to the machines full time and need to
request access to them again.</p>
<p>As far as the rear folder contents, is uploading a tar of the files ok?</p>
<h4 id="jsmeix_commented_at_2018-12-18_1502"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-448250175">2018-12-18 15:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-18_1502" title="Permanent link">&para;</a></h4>
<p>@gk1<br />
when your original system is <code>running ... on bare metal</code> and you<br />
<code>are trying to restore to an esxi based development system</code><br />
you do actually a migration from bare metal to VMware ESXi<br />
cf. the section about "Virtual machines" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>In general migrating with ReaR could become a complicated task<br />
depending on how much the replacement system is different<br />
compared to the original system.</p>
<p>Regarding migrating a system with ReaR see for example<br />
<a href="http://lists.relax-and-recover.org/pipermail/rear-users/2018-November/003626.html">http://lists.relax-and-recover.org/pipermail/rear-users/2018-November/003626.html</a><br />
and follow the links therein.</p>
<p>Any format of uploaded files is o.k. for us provided it is<br />
generally readable with usual free software so that<br />
in particular good old traditional <code>tar.gz</code> is fine.</p>
<h4 id="jsmeix_commented_at_2018-12-19_1118"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-448559745">2018-12-19 11:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-12-19_1118" title="Permanent link">&para;</a></h4>
<p>@gk1<br />
regarding your <code>2 boot iso images are different sizes</code>:</p>
<p>To compare what is in each of your two ReaR recovery systems<br />
set in etc/rear/local.conf <code>KEEP_BUILD_DIR="yes"</code> cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L129">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L129</a><br />
and create the ReaR recovery systems with "rear mkrecue" so that you
can<br />
compare what there is in <code>$TMPDIR/rear.XXXXXXXXXXXXXXX/rootfs/</code></p>
<h4 id="gk1_commented_at_2018-12-20_1853"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449099427">2018-12-20 18:53</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-20_1853" title="Permanent link">&para;</a></h4>
<p>Output of lsblk on both computers<br />
<a href="https://github.com/rear/rear/files/2700129/ISBLK.P1.txt">ISBLK
P1.txt</a><br />
<a href="https://github.com/rear/rear/files/2700130/ISBLK.P2.txt">ISBLK P2.txt</a></p>
<h4 id="gk1_commented_at_2018-12-20_1854"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449099829">2018-12-20 18:54</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-20_1854" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@gk1 As DRDB is involved it is a cluster setup we are dealing with. Is
it possible to submit the <code>/var/lib/rear/layout/disklayout.conf</code> (all
content of this directory is even better) and <code>rear.log</code> (of the
recovery) of both nodes so we can compare?</p>
</blockquote>
<p>Is that rear folder on the original machine, or from when i try to do
the restore?</p>
<h4 id="gk1_commented_at_2018-12-20_1909"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449104059">2018-12-20 19:09</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-20_1909" title="Permanent link">&para;</a></h4>
<p>contents of /var/lib/rear on running machines</p>
<p><a href="https://github.com/rear/rear/files/2700170/rear-folder.zip">rear-folder.zip</a></p>
<h4 id="gdha_commented_at_2018-12-21_1547"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449422803">2018-12-21 15:47</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-21_1547" title="Permanent link">&para;</a></h4>
<p>@gk1 From what I saw of the delivered output the md raid10 savelayout
output is incorrect and therefore, the recover part fails as the (saved)
input is incorrect (sounds obvious).</p>
<p>To find out what goes wrong could you deliver us the output of
<code>cat /proc/mdstat</code> and perhaps run <code>rear -vD savelayout</code> and deliver us
the rear logging of this?</p>
<h4 id="gk1_commented_at_2018-12-21_1559"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449426209">2018-12-21 15:59</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-21_1559" title="Permanent link">&para;</a></h4>
<p>whats weird though is the first time we made a backup/recovery of the
2nd machine, and we were able to restore that image to a vm without
incident. At least from the perspective of rear, the machine was able to
boot and recover in auto mode, and work. Just not the primary machine.</p>
<p><a href="https://github.com/rear/rear/files/2703381/output.zip">output.zip</a></p>
<h4 id="gdha_commented_at_2018-12-25_1028"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449837558">2018-12-25 10:28</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-25_1028" title="Permanent link">&para;</a></h4>
<p>@gk1 The output of
<a href="https://github.com/rear/rear/issues/2006#issuecomment-449426209">https://github.com/rear/rear/issues/2006#issuecomment-449426209</a>
is different from the output of
<a href="https://github.com/rear/rear/issues/2006#issuecomment-449104059">https://github.com/rear/rear/issues/2006#issuecomment-449104059</a></p>
<pre><code>[output of rear-folder.zip]
$ grep raid /var/lib/rear.p1/layout/disklayout.conf
#part /dev/sda 499843596288 1048576 primary raid /dev/sda1
#part /dev/sda 263192576 499844644864 primary boot,raid /dev/sda2
#part /dev/sdb 499843596288 1048576 primary raid /dev/sdb1
#part /dev/sdb 263192576 499844644864 primary boot,raid /dev/sdb2
#part /dev/sdc 499843596288 1048576 primary raid /dev/sdc1
#part /dev/sdc 263192576 499844644864 primary boot,raid /dev/sdc2
#part /dev/sdd 499843596288 1048576 primary raid /dev/sdd1
#part /dev/sdd 263192576 499844644864 primary boot,raid /dev/sdd2
raid /dev/md127 metadata= level= raid-devices= uuid= name=boot
raid /dev/md126 metadata= level= raid-devices= uuid= name=pv00

[output of output.zip]
$ grep raid var/lib/rear/layout/disklayout.conf
part /dev/sda 499843596288 1048576 primary raid /dev/sda1
part /dev/sda 263192576 499844644864 primary boot,raid /dev/sda2
part /dev/sdb 499843596288 1048576 primary raid /dev/sdb1
part /dev/sdb 263192576 499844644864 primary boot,raid /dev/sdb2
part /dev/sdc 499843596288 1048576 primary raid /dev/sdc1
part /dev/sdc 263192576 499844644864 primary boot,raid /dev/sdc2
part /dev/sdd 499843596288 1048576 primary raid /dev/sdd1
part /dev/sdd 263192576 499844644864 primary boot,raid /dev/sdd2
raid /dev/md127 metadata=1.0 level=raid10 raid-devices=4 uuid=1453db52:62d03d02:f96be2ec:37089c20 name=boot layout=n2 chunk=512 devices=/dev/sda2,/dev/sdb2,/dev/sdc2,/dev/sdd2
raid /dev/md126 metadata=1.2 level=raid10 raid-devices=4 uuid=404a87ef:f078fa0f:4fd31a09:03035519 name=pv00 layout=n2 chunk=512 devices=/dev/sda1,/dev/sdb1,/dev/sdc1,/dev/sdd1
</code></pre>
<p>What did you do different? That explains why it did work the first time
you ran a recover of course.</p>
<h4 id="gk1_commented_at_2018-12-26_1617"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-449988279">2018-12-26 16:17</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-26_1617" title="Permanent link">&para;</a></h4>
<p>The machines are the same. The first one was built by hand, the second
one was built from the Kickstart file of the first one.. Not sure why
the output would be different.</p>
<h4 id="gdha_commented_at_2018-12-27_0838"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-450104549">2018-12-27 08:38</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-27_0838" title="Permanent link">&para;</a></h4>
<p>@gk1 I noticed the same behavior on p1 and p2. What I meant was: "was
the configuration changed somehow?" Or, was rear updated in between on
both systems?</p>
<h4 id="gk1_commented_at_2018-12-27_0900"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-450108331">2018-12-27 09:00</a>:<a class="headerlink" href="#gk1_commented_at_2018-12-27_0900" title="Permanent link">&para;</a></h4>
<p>I installed the version of rear that is in the repo for rhel via yum, i
believe it was the same version. I dont believe that anything was
changed after the installation. There are others that login to the
machines, so it is possible. But we did make more than one backup, and
the results were the same each time.</p>
<h4 id="gdha_commented_at_2018-12-28_1129"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-450345121">2018-12-28 11:29</a>:<a class="headerlink" href="#gdha_commented_at_2018-12-28_1129" title="Permanent link">&para;</a></h4>
<p>@gk1 OK - perhaps follow the procedure on <strong>p1</strong> and <strong>p2</strong> described on
web page
<a href="http://www.it3.be/2016/06/08/rear-diskrestore/">http://www.it3.be/2016/06/08/rear-diskrestore/</a>
and attach the corresponding <code>/var/lib/rear/layout/diskrestore.sh</code>
script. Thanks.</p>
<h4 id="gk1_commented_at_2019-01-29_0118"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458368521">2019-01-29 01:18</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_0118" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2805617/mrds.zip">mrds.zip</a><br />
Attached is the output from the make_disk_restore file. I have
included both the /var/rear/layout folder and the /var/log/rear/ folders
and their contents. The script executes and then asks to proceed with
recovery. Output is as follows:</p>
<pre><code>/tmp/make_rear_diskrestore_script.sh

##################################################################################
#       Starting make_rear_diskrestore_script.sh to produce layout code script
#       (for debugging purposes only)
#
#       Log file : /var/log/rear/make_rear_diskrestore_script-20190128-2009.log
#       date : Mon Jan 28 20:09:14 EST 2019
##################################################################################


Proceed with recovery (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)
yes
No code has been generated to recreate /dev/md127 (raid).
    To recreate it manually add code to /var/lib/rear/layout/diskrestore.sh or abort.
Manually add code that recreates /dev/md127 (raid)
1) View /var/lib/rear/layout/diskrestore.sh
2) Edit /var/lib/rear/layout/diskrestore.sh
3) Go to Relax-and-Recover shell
4) Continue 'rear recover'
5) Abort 'rear recover'
(default '4' timeout 300 seconds)
5
ERROR: User chose to abort 'rear recover' in /usr/share/rear/layout/prepare/default/600_show_unprocessed.sh
Aborting due to an error, check  for details
Terminated
</code></pre>
<h4 id="gdha_commented_at_2019-01-29_0740"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458438023">2019-01-29 07:40</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-29_0740" title="Permanent link">&para;</a></h4>
<p>@gk1 thanks for the logs. We are getting closer to the issue:</p>
<pre><code>2019-01-28 01:30:04.072910737 Saving Software RAID configuration.
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 44: let: sparedevices=-: syntax error: operand expected (error token is "-")
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 65: [: : integer expression expected
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 44: let: sparedevices=-: syntax error: operand expected (error token is "-")
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 65: [: : integer expression expected
</code></pre>
<p>Could you drop me the output of the following commands?</p>
<pre><code>echo mdadm --detail --scan --config=partitions
mdadm --detail --scan --config=partitions
for p in a b c d
do
  echo mdadm --misc --detail /dev/sd${p}1
  mdadm --misc --detail /dev/sd${p}1
  echo mdadm --misc --detail /dev/sd${p}2
  mdadm --misc --detail /dev/sd${p}2
done
</code></pre>
<h4 id="gk1_commented_at_2019-01-29_0808"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458445233">2019-01-29 08:08</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_0808" title="Permanent link">&para;</a></h4>
<pre><code>mdadm --detail --scan --config=partitions
ARRAY /dev/md/boot metadata=1.0 name=localhost.localdomain:boot UUID=1453db52:62d03d02:f96be2ec:37089c20
ARRAY /dev/md/pv00 metadata=1.2 name=localhost.localdomain:pv00 UUID=404a87ef:f078fa0f:4fd31a09:03035519

mdadm --misc --detail /dev/sda1
mdadm: /dev/sda1 does not appear to be an md device
mdadm --misc --detail /dev/sda2
mdadm: /dev/sda2 does not appear to be an md device
mdadm --misc --detail /dev/sdb1
mdadm: /dev/sdb1 does not appear to be an md device
mdadm --misc --detail /dev/sdb2
mdadm: /dev/sdb2 does not appear to be an md device
mdadm --misc --detail /dev/sdc1
mdadm: /dev/sdc1 does not appear to be an md device
mdadm --misc --detail /dev/sdc2
mdadm: /dev/sdc2 does not appear to be an md device
mdadm --misc --detail /dev/sdd1
mdadm: /dev/sdd1 does not appear to be an md device
mdadm --misc --detail /dev/sdd2
mdadm: /dev/sdd2 does not appear to be an md device
</code></pre>
<h4 id="gdha_commented_at_2019-01-29_0842"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458454501">2019-01-29 08:42</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-29_0842" title="Permanent link">&para;</a></h4>
<p>@gk1 nice thanks. So what I would like to see then is:</p>
<pre><code>mdadm --misc --detail  /dev/md/boot 
mdadm --misc --detail  /dev/md/pv00
</code></pre>
<h4 id="gk1_commented_at_2019-01-29_0845"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458455395">2019-01-29 08:45</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_0845" title="Permanent link">&para;</a></h4>
<pre><code>[root@PriSMS-1 digitalglue]# mdadm --misc --detail  /dev/md/boot
/dev/md/boot:
           Version : 1.0
     Creation Time : Thu Jan 25 17:54:39 2018
        Raid Level : raid10
        Array Size : 513024 (501.00 MiB 525.34 MB)
     Used Dev Size : 256512 (250.50 MiB 262.67 MB)
      Raid Devices : 4
     Total Devices : 4
       Persistence : Superblock is persistent

     Intent Bitmap : Internal

       Update Time : Tue Jan 29 03:42:28 2019
             State : clean
    Active Devices : 4
   Working Devices : 4
    Failed Devices : 0
     Spare Devices : 0

            Layout : near=2
        Chunk Size : 512K

Consistency Policy : bitmap

              Name : localhost.localdomain:boot
              UUID : 1453db52:62d03d02:f96be2ec:37089c20
            Events : 183

    Number   Major   Minor   RaidDevice State
       0       8        2        0      active sync set-A   /dev/sda2
       1       8       18        1      active sync set-B   /dev/sdb2
       2       8       34        2      active sync set-A   /dev/sdc2
       3       8       50        3      active sync set-B   /dev/sdd2

[root@PriSMS-1 digitalglue]# mdadm --misc --detail  /dev/md/pv00
/dev/md/pv00:
           Version : 1.2
     Creation Time : Thu Jan 25 17:54:16 2018
        Raid Level : raid10
        Array Size : 975994880 (930.78 GiB 999.42 GB)
     Used Dev Size : 487997440 (465.39 GiB 499.71 GB)
      Raid Devices : 4
     Total Devices : 4
       Persistence : Superblock is persistent

     Intent Bitmap : Internal

       Update Time : Tue Jan 29 03:45:21 2019
             State : active
    Active Devices : 4
   Working Devices : 4
    Failed Devices : 0
     Spare Devices : 0

            Layout : near=2
        Chunk Size : 512K

Consistency Policy : bitmap

              Name : localhost.localdomain:pv00
              UUID : 404a87ef:f078fa0f:4fd31a09:03035519
            Events : 77819

    Number   Major   Minor   RaidDevice State
       0       8        1        0      active sync set-A   /dev/sda1
       1       8       17        1      active sync set-B   /dev/sdb1
       2       8       33        2      active sync set-A   /dev/sdc1
       3       8       49        3      active sync set-B   /dev/sdd1
[root@PriSMS-1 digitalglue]#
</code></pre>
<h4 id="jsmeix_commented_at_2019-01-29_1314"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458535067">2019-01-29 13:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-29_1314" title="Permanent link">&para;</a></h4>
<p>@gdha regarding your finding in<br />
<a href="https://github.com/rear/rear/issues/2006#issuecomment-458438023">https://github.com/rear/rear/issues/2006#issuecomment-458438023</a></p>
<pre><code>/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 44: let: sparedevices=-: syntax error: operand expected (error token is "-")
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh: line 65: [: : integer expression expected
</code></pre>
<p>The matching lines in layout/save/GNU/Linux/210_raid_layout.sh are</p>
<pre><code>42 ndevices=$( grep "Raid Devices" $TMP_DIR/mdraid | tr -d " " | cut -d ":" -f "2")
43 totaldevices=$( grep "Total Devices" $TMP_DIR/mdraid | tr -d " " | cut -d ":" -f "2")
44 let sparedevices=$totaldevices-$ndevices
...
65 if [ "$sparedevices" -gt 0 ] ; then
</code></pre>
<p>It seems the code in layout/save/GNU/Linux/210_raid_layout.sh<br />
does not sufficiently care about possible errors<br />
(cf.
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a>)<br />
or is not sufficiently safe against empty variables<br />
(cf.
<a href="https://github.com/rear/rear/pull/2021">https://github.com/rear/rear/pull/2021</a>).</p>
<p>Should I review layout/save/GNU/Linux/210_raid_layout.sh<br />
and do a pull request to make ReaR behave more fail-safe<br />
when needed values are empty?</p>
<p>In this case "fail-safe" also means that we can error out early here
because<br />
'layout/save' scripts run during "rear mkrescue" where it is o.k. to
error out<br />
because the user can correct what leads to the error and redo "rear
mkrescue"<br />
compared to let "rear recover" fail when it is too late to correct the
root cause.</p>
<h4 id="gdha_commented_at_2019-01-29_1327"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458538993">2019-01-29 13:27</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-29_1327" title="Permanent link">&para;</a></h4>
<p>@gk1 @jsmeix There is something strange going on these systems as I have
seen output were it was successful:</p>
<pre><code>raid /dev/md127 metadata=1.0 level=raid10 raid-devices=4 uuid=8317f7a0:292074d7:eee8ccf4:80f8c853 name=boot layout=n2 chunk=512 devices=/dev/sda2,/dev/sdb2,/dev/sdc2,/dev/sdd2
raid /dev/md126 metadata=1.2 level=raid10 raid-devices=4 uuid=fa2be560:fbb4b0eb:a1f25070:9a8ae44b name=pv00 layout=n2 chunk=512 devices=/dev/sda1,/dev/sdb1,/dev/sdc1,/dev/sdd1
</code></pre>
<p>and where it fails (like above):</p>
<pre><code>raid /dev/md127 metadata= level= raid-devices= uuid= name=boot
raid /dev/md126 metadata= level= raid-devices= uuid= name=pv00
</code></pre>
<p>The code in script
<code>/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh</code> should work,
but what I would like to see before making decisions in this particular
case it debugging output of this script only (do not want to see all
debugging).<br />
Therefore, it possible add <code>set -x</code> in top of the script and <code>set +x</code> at
the bottom of this script and run <code>rear -v savelaout</code> and post the log
of this action.</p>
<h4 id="gk1_commented_at_2019-01-29_1424"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458558067">2019-01-29 14:24</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_1424" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2808081/setx.zip">setx.zip</a><br />
I ran the script. here are the disklayout files, and the rear logs</p>
<h4 id="gk1_commented_at_2019-01-29_1428"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458559516">2019-01-29 14:28</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_1428" title="Permanent link">&para;</a></h4>
<p>If it would help I can provide you with Teamviewer access to the
machines to speed this along, we would just need to coordinate a time.</p>
<h4 id="gdha_commented_at_2019-01-29_1443"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458565241">2019-01-29 14:43</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-29_1443" title="Permanent link">&para;</a></h4>
<blockquote>
<p><a href="https://github.com/rear/rear/files/2808081/setx.zip">setx.zip</a><br />
I ran the script. here are the disklayout files, and the rear logs</p>
</blockquote>
<p>In this debug session it was successful again - looks like an
intermediate issue.<br />
Perhaps run it a few times and check when the raid line is bad:</p>
<pre><code>grep ^raid /var/lib/rear/layout/disklayout.conf
</code></pre>
<p>We are interested in the logs when it fails.</p>
<h4 id="gk1_commented_at_2019-01-29_1449"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458567365">2019-01-29 14:49</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_1449" title="Permanent link">&para;</a></h4>
<p>I ran it 15 times, and it was the same output each time.</p>
<pre><code>raid /dev/md127 metadata=1.0 level=raid10 raid-devices=4 uuid=1453db52:62d03d02:f96be2ec:37089c20 name=boot layout=n2 chunk=512 devices=/dev/sda2,/dev/sdb2,/dev/sdc2,/dev/sdd2
raid /dev/md126 metadata=1.2 level=raid10 raid-devices=4 uuid=404a87ef:f078fa0f:4fd31a09:03035519 name=pv00 layout=n2 chunk=512 devices=/dev/sda1,/dev/sdb1,/dev/sdc1,/dev/sdd1
</code></pre>
<h4 id="gdha_commented_at_2019-01-29_1451"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458568058">2019-01-29 14:51</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-29_1451" title="Permanent link">&para;</a></h4>
<p>@gk1 is the result the same on both systems? Above output is what it
should be</p>
<h4 id="gk1_commented_at_2019-01-29_1457"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458570478">2019-01-29 14:57</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-29_1457" title="Permanent link">&para;</a></h4>
<p>so on P2 when i started i grep'd for raid like above and it did not have
the UUID values in the line like the successful output, once i added the
set -x in the script and ran it again, 10 times, 10 successful outputs</p>
<pre><code>raid /dev/md127 metadata=1.0 level=raid10 raid-devices=4 uuid=8317f7a0:292074d7:eee8ccf4:80f8c853 name=boot layout=n2 chunk=512 devices=/dev/sda2,/dev/sdb2,/dev/sdc2,/dev/sdd2
raid /dev/md126 metadata=1.2 level=raid10 raid-devices=4 uuid=fa2be560:fbb4b0eb:a1f25070:9a8ae44b name=pv00 layout=n2 chunk=512 devices=/dev/sda1,/dev/sdb1,/dev/sdc1,/dev/sdd1
</code></pre>
<h4 id="jsmeix_commented_at_2019-01-29_1515"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-458577661">2019-01-29 15:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-29_1515" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
what I meant was more about general more fail-safe coding style.</p>
<p>In this particular case code like</p>
<pre><code>let sparedevices=$totaldevices-$ndevices
</code></pre>
<p>can never work as intended when $totaldevices or $ndevices<br />
is empty or unset or contains a string "fubar" or whatever<br />
because that can never evaluate right unless both<br />
$totaldevices and $ndevices are non negative integer values<br />
(we only have is_integer and is_positive_integer functions)<br />
and $totaldevices &gt;= $ndevices</p>
<p>If usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh had<br />
failed with an error for @gk1 during "rear mkrescue/mkbackup"<br />
he would have reported a much easier to understand issue here<br />
(which would have been an advantage to find the root cause)<br />
and he would not have had to learn the hard way that<br />
"something is somehow wrong" in his specific case<br />
when - at the very end - "rear recover" failed for him.</p>
<p>Or in other words:<br />
When "rear mkrescue" writes entries to 'disklayout.conf'<br />
that are invalid to recreate the system like</p>
<pre><code>raid /dev/md127 metadata= level= raid-devices= uuid= name=boot
raid /dev/md126 metadata= level= raid-devices= uuid= name=pv00
</code></pre>
<p>then "rear mkrescue" must error out.<br />
According to the "Disk layout file syntax" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<pre><code>raid /dev/&lt;name&gt; level=&lt;RAID level&gt; raid-devices=&lt;nr of devices&gt; [uuid=&lt;uuid&gt;] [spare-devices=&lt;nr of spares&gt;] [layout=&lt;RAID layout&gt;] [chunk=&lt;chunk size&gt;] devices=&lt;device1,device2,...&gt;
</code></pre>
<p>it is invalid when <code>level</code> or <code>raid-devices</code> are empty and when
<code>devices</code> is missing<br />
(I don't know about <code>metadata</code> that is not documented there).</p>
<h4 id="gk1_commented_at_2019-01-31_1541"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-459391371">2019-01-31 15:41</a>:<a class="headerlink" href="#gk1_commented_at_2019-01-31_1541" title="Permanent link">&para;</a></h4>
<p>Any thoughts on the output i sent?</p>
<h4 id="gdha_commented_at_2019-01-31_1631"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-459410721">2019-01-31 16:31</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-31_1631" title="Permanent link">&para;</a></h4>
<p>@gk1 so to recap: in debug mode the output for the raid rebuild are
fine, and when you switch off debug mode it is randomly good or bad.<br />
The only thing we can do is like @jsmeix proposed is bailing out when
the output doesn't make sense. IMHO the output is produced by underlying
commands out of control of ReaR, we can only act when the resulting
output seems crap. However, I suspect there might be something flaky on
the systems itself if the output is randomly different...</p>
<h4 id="jsmeix_commented_at_2019-02-05_1358"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-460646685">2019-02-05 13:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-05_1358" title="Permanent link">&para;</a></h4>
<p>...which would not be the first time where using ReaR revealed<br />
that something subtle was badly broken on the original system...</p>
<p>I am thinking about adding a generic script that runs after
disklayout.conf<br />
was written (i.e. at the end of the <code>layout/save</code> stage) e.g.<br />
layout/save/GNU/Linux/910_verify_disklayout_file.sh<br />
that verifies that the entries in disklayout.conf match syntactically<br />
what is specified in the section "Disk layout file syntax" at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<p>@gdha<br />
if you agree I will do a pull request with such a
verify_disklayout_file script.</p>
<h4 id="gk1_commented_at_2019-02-06_0216"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-460878437">2019-02-06 02:16</a>:<a class="headerlink" href="#gk1_commented_at_2019-02-06_0216" title="Permanent link">&para;</a></h4>
<p>Ok so what is the next step then? We would really like this to work. Can
i get you guys on the boxes to look, will that help?</p>
<p>Also i took the disklayout file that was created and had all the meta
data in it and copied it to the machine i am trying to restore onto, and
ran manual restore, was able to map the disks, but it is not able to
create the drbd partition. I dont have the error at the moment. We would
like to be able to use Rear to bare metal backup these machines.</p>
<p>I do agree there has to be something strange on these machines but i can
not figure out anything that would cause this. Like you said, the
commands output the data, although not always correctly it seems. These
are machines that have been hardened with the government STIG process,
which does a ton of things to them for security. Some of those things
could effect it, but hard to tell what.</p>
<p>I know we have asked a lot of you, and if its a question of support
contract purchase just say the word, we clearly need the help on this.</p>
<p>Thanks!!</p>
<h4 id="gdha_commented_at_2019-02-06_1454"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-461051716">2019-02-06 14:54</a>:<a class="headerlink" href="#gdha_commented_at_2019-02-06_1454" title="Permanent link">&para;</a></h4>
<p>@gk1 We suppose you have a support contract on your hardware? If yes,
please ask for a pro-active firmware investigation on your different
hardware components. It makes no sense to try to fix something in ReaR
if we cannot trust the hardware. The output of the savelayout has to be
consistent in all times.</p>
<h4 id="gk1_commented_at_2019-02-06_1910"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-461148541">2019-02-06 19:10</a>:<a class="headerlink" href="#gk1_commented_at_2019-02-06_1910" title="Permanent link">&para;</a></h4>
<p>Yes but i dont believe that the issue is hardware related. The machine
works just fine, reboots and starts fine and does what it is supposed to
do. I do believe that something in the software config, or security
settings could be the issue. But why does Rear work correctly generating
the layout with debug on, but not with it off? What is the difference
that could be causing that. That part really makes no sense to me.</p>
<h4 id="gdha_commented_at_2019-02-06_1919"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-461151712">2019-02-06 19:19</a>:<a class="headerlink" href="#gdha_commented_at_2019-02-06_1919" title="Permanent link">&para;</a></h4>
<p>Difference between debug on/off is the speed between the commands I
guess (cfr.
<a href="https://github.com/rear/rear/issues/2006#issuecomment-461148541">https://github.com/rear/rear/issues/2006#issuecomment-461148541</a>)
- that is the only explanation I have (so far).</p>
<h4 id="jsmeix_commented_at_2019-02-11_1142"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-462299156">2019-02-11 11:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-11_1142" title="Permanent link">&para;</a></h4>
<p>@gk1<br />
i.e. you may experiment with inserting some "sleep 1" delays<br />
before or after certain commands in<br />
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh</p>
<p>That script runs basically</p>
<pre><code>while read array device junk ; do
    ...
    mdadm --misc --detail $device &gt; $TMP_DIR/mdraid
    ...
done &lt; &lt;(mdadm --detail --scan --config=partitions)
</code></pre>
<p>i.e. it runs <code>mdadm</code> in a loop for each device<br />
and perhaps things go wrong on your machine<br />
when <code>mdadm</code> is called several times in a loop?</p>
<p>Furthermore you may add <code>set -x</code> at the beginning of<br />
/usr/share/rear/layout/save/GNU/Linux/210_raid_layout.sh<br />
and <code>set +x</code> at the end to get debug messages in your log<br />
only while that script runs, perhaps you see something of interest<br />
( oh! - wait - you won't see something of interest because it works<br />
in debug mode ;-)</p>
<h4 id="gdha_commented_at_2019-02-11_1614"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-462387916">2019-02-11 16:14</a>:<a class="headerlink" href="#gdha_commented_at_2019-02-11_1614" title="Permanent link">&para;</a></h4>
<p>@gk1 Try to use rear with always debug enabled and see how far you get
now? The layout should be fine now. What was the issue with drdb? As
@jsmeix explained in
<a href="https://github.com/rear/rear/issues/2006#issuecomment-462299156">https://github.com/rear/rear/issues/2006#issuecomment-462299156</a>
a <code>sleep 1</code> might fix this, but we are not sure. However, as it seems to
work in debug mode (which introduces a slight delay) this might be just
the case.</p>
<h4 id="gk1_commented_at_2019-02-15_1848"><img src="https://avatars.githubusercontent.com/u/1232073?u=3526e2337a972f3d11a4c5b0477a692ddd6dca7e&v=4" width="50"><a href="https://github.com/gk1">gk1</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-464157508">2019-02-15 18:48</a>:<a class="headerlink" href="#gk1_commented_at_2019-02-15_1848" title="Permanent link">&para;</a></h4>
<p>What is the command line argument to force debug in its entirety? I will
try to generate a new backup next week, and i will add the sleep delays
as well.</p>
<h4 id="gozora_commented_at_2019-02-15_1921"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-464168086">2019-02-15 19:21</a>:<a class="headerlink" href="#gozora_commented_at_2019-02-15_1921" title="Permanent link">&para;</a></h4>
<p>@gk1 <code>rear -d -D mkbackup</code></p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2019-02-22_1521"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-466433458">2019-02-22 15:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-02-22_1521" title="Permanent link">&para;</a></h4>
<p>Regarding my above<br />
<a href="https://github.com/rear/rear/issues/2006#issuecomment-460646685">https://github.com/rear/rear/issues/2006#issuecomment-460646685</a><br />
see<br />
<a href="https://github.com/rear/rear/issues/1681#issuecomment-466432296">https://github.com/rear/rear/issues/1681#issuecomment-466432296</a></p>
<h4 id="github-actions_commented_at_2020-06-28_0133"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2006#issuecomment-650665308">2020-06-28 01:33</a>:<a class="headerlink" href="#github-actions_commented_at_2020-06-28_0133" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-12-17.2006.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
