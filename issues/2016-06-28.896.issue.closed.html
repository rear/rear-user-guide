<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#896 Issue closed: Grub and LVM leads to physical device metadata to be overwritten - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#896 Issue closed: Grub and LVM leads to physical device metadata to be overwritten";
        var mkdocs_page_input_path = "issues/2016-06-28.896.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#896 Issue closed: Grub and LVM leads to physical device metadata to be overwritten</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="896_issue_closed_grub_and_lvm_leads_to_physical_device_metadata_to_be_overwritten"><a href="https://github.com/rear/rear/issues/896">#896 Issue</a> <code>closed</code>: Grub and LVM leads to physical device metadata to be overwritten<a class="headerlink" href="#896_issue_closed_grub_and_lvm_leads_to_physical_device_metadata_to_be_overwritten" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="stermeau_opened_issue_at_2016-06-28_1231"><img src="https://avatars.githubusercontent.com/u/11390759?v=4" width="50"><a href="https://github.com/stermeau">stermeau</a> opened issue at <a href="https://github.com/rear/rear/issues/896">2016-06-28 12:31</a>:<a class="headerlink" href="#stermeau_opened_issue_at_2016-06-28_1231" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 1.16.1 / Git<br />
    rpm : rear-1.16.1-1.el6.noarch</p>
</li>
<li>
<p>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    Red Hat Enterprise Linux Server release 6.3 (Santiago)</p>
</li>
<li>
<p>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):<br />
    PROGS=( "${PROGS[@]}" screen )<br />
    GRUB_RESCUE=n<br />
    USE_STATIC_NETWORKING=y<br />
    BACKUP=TSM<br />
    OUTPUT=ISO<br />
    TIMESYNC=NTP<br />
    AUTOEXCLUDE_MULTIPATH=<br />
    MODULES=(dm-multipath qla2xxx scsi_transport_fc)<br />
    MODULES_LOAD=(dm-multipath qla2xxx scsi_transport_fc)<br />
    BOOT_OVER_SAN=y<br />
    PRE_RECOVERY_SCRIPT=/sbin/multipathd<br />
    COPY_AS_IS=( "${COPY_AS_IS[@]}" /etc/multipath/bindings
    /etc/multipath.conf )<br />
    COPY_AS_IS_TSM=( "${COPY_AS_IS_TSM[@]}" /.tsm /.tsm_ora)<br />
    SSH_ROOT_PASSWORD="rear2rear"<br />
    ISO_PREFIX="rear-097484"</p>
</li>
<li>
<p>Brief description of the issue<br />
    At the end of the restore, REAR installs grub on all the "disks".<br />
    If a whole disk is used a physical devices, then the LVM metadata
    are overwritten.<br />
    After the reboot, the server hangs with:</p>
<h3 id="_1"><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>Setting up Logical Volume Management: Couldn't find device with uuid
BYblWm-WqbM-XR73-xL5M-h6ah-XXXXX-XXXXX.</p>
<h3 id="_2"><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>REAR shouldn't install grub on disks that are physical volumes</p>
</li>
<li>
<p>Work-around, if any</p>
</li>
</ul>
<h4 id="gdha_commented_at_2016-06-28_1454"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-229074610">2016-06-28 14:54</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-28_1454" title="Permanent link">&para;</a></h4>
<p>@stermeau The BOOT_OVER_SAN related code was never 100% finished due
to no HW to test to improve the existing code. The consultancy done so
far ended without extension, so it is very hard for me to improve code
(or add missing pieces), if I cannot spent time on it (via consultancy
or sponsoring). It is like it is - it is not polished yet.<br />
Of course, you are free to create pull requests to improve the code
where needed. If possible, I can assist, but I will not be in the
driving seat if I'm not paid for it (to define the proper expectations).</p>
<h4 id="didacog_commented_at_2016-06-28_1527"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-229084990">2016-06-28 15:27</a>:<a class="headerlink" href="#didacog_commented_at_2016-06-28_1527" title="Permanent link">&para;</a></h4>
<p>@gdha @stermeau</p>
<p>I will provide a pull request solving an error in efibootmgr on
BOOT_over_SAN soon. Maybe is a similar problem with /dev/mapper
devices. I can check this tomorrow and maybe provide pull request also
with this problem solved.</p>
<p>@stermeau can you provide (rear -vd recover) logs?<br />
Regards,<br />
Didac</p>
<h4 id="stermeau_commented_at_2016-06-28_1831"><img src="https://avatars.githubusercontent.com/u/11390759?v=4" width="50"><a href="https://github.com/stermeau">stermeau</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-229140237">2016-06-28 18:31</a>:<a class="headerlink" href="#stermeau_commented_at_2016-06-28_1831" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>@didacog , I have attached the log. Thanks for your help.<br />
<a href="https://github.com/rear/rear/files/337763/rear.txt">rear.txt</a></p>
<p>@gdha, the server is not booting from SAN. From my point of view, after
line 65 of 21_install_grub.sh ( same thing in 22_install_grub2.sh),
if the disk is a physical volume, it should be skipped.<br />
I will give it a try to submit a pull request if it works</p>
<h4 id="didacog_commented_at_2016-07-01_0914"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-229898510">2016-07-01 09:14</a>:<a class="headerlink" href="#didacog_commented_at_2016-07-01_0914" title="Permanent link">&para;</a></h4>
<p>@stermeau I will deepen a little bit more this weekend, I had issues
with efibootmgr but 21_install_grub.sh gets disk info in other manner.</p>
<p>Sorry but this week I'm quite busy... I will test few things this
weekend and update the issue.</p>
<h4 id="stermeau_commented_at_2016-07-04_1402"><img src="https://avatars.githubusercontent.com/u/11390759?v=4" width="50"><a href="https://github.com/stermeau">stermeau</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-230297775">2016-07-04 14:02</a>:<a class="headerlink" href="#stermeau_commented_at_2016-07-04_1402" title="Permanent link">&para;</a></h4>
<p>I submitted a pull request :
<a href="https://github.com/rear/rear/pull/901">https://github.com/rear/rear/pull/901</a></p>
<h4 id="gdha_commented_at_2016-07-05_1547"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-230518370">2016-07-05 15:47</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-05_1547" title="Permanent link">&para;</a></h4>
<p>@stermeau I noticed that you serious modified the local.conf file, but
please check script <code>prep/GNU/Linux/24_include_multipath_tools.sh</code>. If
you could improve its content then you would make me a happy man.</p>
<h4 id="stermeau_commented_at_2016-07-06_1208"><img src="https://avatars.githubusercontent.com/u/11390759?v=4" width="50"><a href="https://github.com/stermeau">stermeau</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-230753421">2016-07-06 12:08</a>:<a class="headerlink" href="#stermeau_commented_at_2016-07-06_1208" title="Permanent link">&para;</a></h4>
<p>@gdha I have updated the pull request.</p>
<p>Yes my local.conf is quite customized.<br />
Still /etc/multipath and /bindings /etc/multipath.conf are already
referenced in 24_include_multipath_tools.sh. So this is actually
useless.<br />
The MODULES* are specific to my environment with QLA cards.<br />
I think it would make sense to have the following added</p>
<pre><code> # To properly discover multipath devices

PRE_RECOVERY_SCRIPT=( "${PRE_RECOVERY_SCRIPT[@]}" /sbin/multipathd )

 # When using TSM

POST_RECOVERY_SCRIPT='cp /etc/adsm/TSM.PWD /mnt/local/etc/adsm'
</code></pre>
<h4 id="gdha_commented_at_2016-07-06_1214"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-230754576">2016-07-06 12:14</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-06_1214" title="Permanent link">&para;</a></h4>
<p>@stermeau Pull request was accepted - thank you for this.<br />
Concerning the multipath stuff: I guess you want the daemon to be
executed when you boot from the rear image - that is a good point indeed
and can be implemented.<br />
However, you lost me with the TSM stuff: is this something what is
missing in the current TSM hooks within rear? Wasn't this not restored
by TSM itself?</p>
<h4 id="gdha_commented_at_2016-09-13_1425"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/896#issuecomment-246698504">2016-09-13 14:25</a>:<a class="headerlink" href="#gdha_commented_at_2016-09-13_1425" title="Permanent link">&para;</a></h4>
<p>@stermeau can this be closed?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-06-28.896.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
