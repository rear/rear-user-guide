<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2972 Issue open: Cannot create rescue image on Ubuntu Server 23.04 - Confirmed bug in cp 9.x - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2972 Issue open: Cannot create rescue image on Ubuntu Server 23.04 - Confirmed bug in cp 9.x";
        var mkdocs_page_input_path = "issues/2023-04-23.2972.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2972 Issue open: Cannot create rescue image on Ubuntu Server 23.04 - Confirmed bug in cp 9.x</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2972_issue_open_cannot_create_rescue_image_on_ubuntu_server_2304_-_confirmed_bug_in_cp_9x"><a href="https://github.com/rear/rear/issues/2972">#2972 Issue</a> <code>open</code>: Cannot create rescue image on Ubuntu Server 23.04 - Confirmed bug in cp 9.x<a class="headerlink" href="#2972_issue_open_cannot_create_rescue_image_on_ubuntu_server_2304_-_confirmed_bug_in_cp_9x" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>external tool</code>, <code>not ReaR / invalid</code></p>
<h4 id="schlomo_opened_issue_at_2023-04-23_1047"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> opened issue at <a href="https://github.com/rear/rear/issues/2972">2023-04-23 10:47</a>:<a class="headerlink" href="#schlomo_opened_issue_at_2023-04-23_1047" title="Permanent link">&para;</a></h4>
<p>Trying out ReaR on Ubuntu 23.04 and I stumble over a very strange error:</p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>my configuration contains</p>
<pre><code>MODULES=( 'loaded_modules' )
</code></pre>
<p>otherwise this problem is not triggered.</p>
</li>
<li>
<p>running from source tree mounted via vboxsf but the problem is not
    related to that either, also not to <code>REAR_VAR</code>.</p>
</li>
</ol>
<h2 id="observable_problem">Observable Problem<a class="headerlink" href="#observable_problem" title="Permanent link">&para;</a></h2>
<pre><code>root@rear-u2304:/src/rear# REAR_VAR=/tmp/rear_var usr/sbin/rear -C /etc/rear/local.conf -D mkrescue
Relax-and-Recover 2.7 / Git
Running rear mkrescue (PID 55846 date 2023-04-23 10:32:31)
Command line options: usr/sbin/rear -C /etc/rear/local.conf -D mkrescue
Using log file: /tmp/rear_var/log/rear/rear-rear-u2304.log
Using build area: /var/tmp/rear.Acrvl84FH5J2jWn
Sourcing additional configuration file '/etc/rear/local.conf'
...
... lots more
...

Copying binaries and libraries
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules') and those in MODULES_LOAD
ERROR: Failed to copy '/lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/aesni-intel.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/crc32-pclmul.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/crct10dif-pclmul.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/ghash-clmulni-intel.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/polyval-clmulni.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/crypto/sha512-ssse3.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/events/rapl.ko /lib/modules/6.2.0-20-generic/kernel/arch/x86/kernel/msr.ko /lib/modules/6.2.0-20-generic/kernel/crypto/async_tx/async_memcpy.ko /lib/modules/6.2.0-20-generic/kernel/crypto/async_tx/async_pq.ko /lib/modules/6.2.0-20-generic/kernel/crypto/async_tx/async_raid6_recov.ko /lib/modules/6.2.0-20-generic/kernel/crypto/async_tx/async_tx.ko /lib/modules/6.2.0-20-generic/kernel/crypto/async_tx/async_xor.ko /lib/modules/6.2.0-20-generic/kernel/crypto/blake2b_generic.ko /lib/modules/6.2.0-20-generic/kernel/crypto/cryptd.ko /lib/modules/6.2.0-20-generic/kernel/crypto/crypto_simd.ko /lib/modules/6.2.0-20-generic/kernel/crypto/polyval-generic.ko /lib/modules/6.2.0-20-generic/kernel/crypto/xor.ko /lib/modules/6.2.0-20-generic/kernel/drivers/acpi/video.ko /lib/modules/6.2.0-20-generic/kernel/drivers/ata/ahci.ko /lib/modules/6.2.0-20-generic/kernel/drivers/ata/libahci.ko /lib/modules/6.2.0-20-generic/kernel/drivers/ata/pata_acpi.ko /lib/modules/6.2.0-20-generic/kernel/drivers/firmware/dmi-sysfs.ko /lib/modules/6.2.0-20-generic/kernel/drivers/firmware/efi/efi-pstore.ko /lib/modules/6.2.0-20-generic/kernel/drivers/gpu/drm/drm.ko /lib/modules/6.2.0-20-generic/kernel/drivers/gpu/drm/drm_kms_helper.ko /lib/modules/6.2.0-20-generic/kernel/drivers/gpu/drm/drm_ttm_helper.ko /lib/modules/6.2.0-20-generic/kernel/drivers/gpu/drm/ttm/ttm.ko /lib/modules/6.2.0-20-generic/kernel/drivers/gpu/drm/vmwgfx/vmwgfx.ko /lib/modules/6.2.0-20-generic/kernel/drivers/hid/hid-generic.ko /lib/modules/6.2.0-20-generic/kernel/drivers/hid/hid.ko /lib/modules/6.2.0-20-generic/kernel/drivers/hid/usbhid/usbhid.ko /lib/modules/6.2.0-20-generic/kernel/drivers/i2c/busses/i2c-piix4.ko /lib/modules/6.2.0-20-generic/kernel/drivers/input/input-leds.ko /lib/modules/6.2.0-20-generic/kernel/drivers/input/joydev.ko /lib/modules/6.2.0-20-generic/kernel/drivers/input/mouse/psmouse.ko /lib/modules/6.2.0-20-generic/kernel/drivers/input/serio/serio_raw.ko /lib/modules/6.2.0-20-generic/kernel/drivers/macintosh/mac_hid.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/dm-multipath.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/linear.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/multipath.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/raid0.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/raid1.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/raid10.ko /lib/modules/6.2.0-20-generic/kernel/drivers/md/raid456.ko /lib/modules/6.2.0-20-generic/kernel/drivers/net/ethernet/intel/e1000/e1000.ko /lib/modules/6.2.0-20-generic/kernel/drivers/platform/x86/wmi.ko /lib/modules/6.2.0-20-generic/kernel/drivers/powercap/intel_rapl_common.ko /lib/modules/6.2.0-20-generic/kernel/drivers/powercap/intel_rapl_msr.ko /lib/modules/6.2.0-20-generic/kernel/drivers/scsi/device_handler/scsi_dh_alua.ko /lib/modules/6.2.0-20-generic/kernel/drivers/scsi/device_handler/scsi_dh_emc.ko /lib/modules/6.2.0-20-generic/kernel/drivers/scsi/device_handler/scsi_dh_rdac.ko /lib/modules/6.2.0-20-generic/kernel/drivers/video/fbdev/core/syscopyarea.ko /lib/modules/6.2.0-20-generic/kernel/drivers/video/fbdev/core/sysfillrect.ko /lib/modules/6.2.0-20-generic/kernel/drivers/video/fbdev/core/sysimgblt.ko /lib/modules/6.2.0-20-generic/kernel/drivers/virt/vboxguest/vboxguest.ko /lib/modules/6.2.0-20-generic/kernel/fs/autofs/autofs4.ko /lib/modules/6.2.0-20-generic/kernel/fs/binfmt_misc.ko /lib/modules/6.2.0-20-generic/kernel/fs/btrfs/btrfs.ko /lib/modules/6.2.0-20-generic/kernel/fs/fscache/fscache.ko /lib/modules/6.2.0-20-generic/kernel/fs/lockd/lockd.ko /lib/modules/6.2.0-20-generic/kernel/fs/netfs/netfs.ko /lib/modules/6.2.0-20-generic/kernel/fs/nfs/nfs.ko /lib/modules/6.2.0-20-generic/kernel/fs/nfs/nfsv4.ko /lib/modules/6.2.0-20-generic/kernel/fs/nfs_common/grace.ko /lib/modules/6.2.0-20-generic/kernel/fs/nls/nls_iso8859-1.ko /lib/modules/6.2.0-20-generic/kernel/fs/vboxsf/vboxsf.ko /lib/modules/6.2.0-20-generic/kernel/lib/libcrc32c.ko /lib/modules/6.2.0-20-generic/kernel/lib/raid6/raid6_pq.ko /lib/modules/6.2.0-20-generic/kernel/net/ipv4/netfilter/ip_tables.ko /lib/modules/6.2.0-20-generic/kernel/net/netfilter/x_tables.ko /lib/modules/6.2.0-20-generic/kernel/net/sunrpc/auth_gss/auth_rpcgss.ko /lib/modules/6.2.0-20-generic/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko /lib/modules/6.2.0-20-generic/kernel/net/sunrpc/sunrpc.ko /lib/modules/6.2.0-20-generic/kernel/net/wireless/cfg80211.ko /lib/modules/6.2.0-20-generic/kernel/sound/ac97_bus.ko /lib/modules/6.2.0-20-generic/kernel/sound/core/snd-pcm.ko /lib/modules/6.2.0-20-generic/kernel/sound/core/snd-timer.ko /lib/modules/6.2.0-20-generic/kernel/sound/core/snd.ko /lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97/snd-ac97-codec.ko /lib/modules/6.2.0-20-generic/kernel/sound/pci/snd-intel8x0.ko /lib/modules/6.2.0-20-generic/kernel/sound/soundcore.ko '
Some latest log messages since the last called script 400_copy_modules.sh:
  '/lib/modules/6.2.0-20-generic/kernel/sound/core/snd-timer.ko' -&gt; '/var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/core/snd-timer.ko'
  '/lib/modules/6.2.0-20-generic/kernel/sound/core/snd.ko' -&gt; '/var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/core/snd.ko'
  /lib/modules/6.2.0-20-generic/kernel/sound/pci -&gt; /var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/pci
  /lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97 -&gt; /var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97
  '/lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97/snd-ac97-codec.ko' -&gt; '/var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97/snd-ac97-codec.ko'
  cp: 'lib/modules/6.2.0-20-generic/kernel/sound/pci/ac97': No such file or directory
  '/lib/modules/6.2.0-20-generic/kernel/sound/pci/snd-intel8x0.ko' -&gt; '/var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/pci/snd-intel8x0.ko'
  '/lib/modules/6.2.0-20-generic/kernel/sound/soundcore.ko' -&gt; '/var/tmp/rear.Acrvl84FH5J2jWn/rootfs/lib/modules/6.2.0-20-generic/kernel/sound/soundcore.ko'
Aborting due to an error, check /tmp/rear_var/log/rear/rear-rear-u2304.log for details
Exiting rear mkrescue (PID 55846) and its descendant processes ...
Running exit tasks
To remove the build area you may use (with caution): rm -Rf --one-file-system /var/tmp/rear.Acrvl84FH5J2jWn
Terminated
</code></pre>
<h2 id="root_cause_analysis">Root Cause Analysis<a class="headerlink" href="#root_cause_analysis" title="Permanent link">&para;</a></h2>
<p>A bit further digging leads to the observation that the <code>cp</code> utility
fails even though it actually copied all files. Here is an extract to
illustrate the problem:</p>
<pre><code>root@rear-u2304:~# cat /etc/os-release 
PRETTY_NAME="Ubuntu 23.04"
NAME="Ubuntu"
VERSION_ID="23.04"
VERSION="23.04 (Lunar Lobster)"
VERSION_CODENAME=lunar
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=lunar
LOGO=ubuntu-logo

root@rear-u2304:~# rm -Rf /tmp/f &amp;&amp; mkdir /tmp/f &amp;&amp; cp --verbose -t /tmp/f -L --preserve=all --parents /etc/apt/sources.list &amp;&amp; echo yes ; ls -lR /tmp/f/etc/apt/sources.list /etc/apt/sources.list
/etc -&gt; /tmp/f/etc
/etc/apt -&gt; /tmp/f/etc/apt
'/etc/apt/sources.list' -&gt; '/tmp/f/etc/apt/sources.list'
cp: ‘etc/apt’: No such file or directory
-rw-r--r-- 1 root root 2437 Apr 23 09:53 /etc/apt/sources.list
-rw-r--r-- 1 root root 2437 Apr 23 09:53 /tmp/f/etc/apt/sources.list

root@rear-u2304:~#
</code></pre>
<p>Anybody has an idea what could be the problem here?</p>
<p>On an Ubuntu 22.04 system this works as expected:</p>
<pre><code>schlomo@brho:~$ rm -Rf /tmp/f &amp;&amp; mkdir /tmp/f &amp;&amp; cp --verbose -t /tmp/f -L --preserve=all --parents /etc/apt/sources.list &amp;&amp; echo yes ; ls -lR /tmp/f/etc/apt/sources.list /etc/apt/sources.list
/etc -&gt; /tmp/f/etc
/etc/apt -&gt; /tmp/f/etc/apt
'/etc/apt/sources.list' -&gt; '/tmp/f/etc/apt/sources.list'
yes
-rw-r--r-- 1 root    root    263 Mär 26 15:20 /etc/apt/sources.list
-rw-r--r-- 1 schlomo schlomo 263 Mär 26 15:20 /tmp/f/etc/apt/sources.list
schlomo@brho:~$
</code></pre>
<p>I reported this bug to Ubuntu via
<a href="https://bugs.launchpad.net/ubuntu/+source/coreutils/+bug/2017414">https://bugs.launchpad.net/ubuntu/+source/coreutils/+bug/2017414</a>
and upstream via
<a href="https://debbugs.gnu.org/cgi/bugreport.cgi?bug=63245">https://debbugs.gnu.org/cgi/bugreport.cgi?bug=63245</a></p>
<h4 id="abbbi_commented_at_2023-05-03_0831"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532642990">2023-05-03 08:31</a>:<a class="headerlink" href="#abbbi_commented_at_2023-05-03_0831" title="Permanent link">&para;</a></h4>
<p>this will hit with upcoming debian/bookworm release, too.<br />
Works with debian/bullseye:</p>
<pre><code> rm -Rf /tmp/f &amp;&amp; mkdir /tmp/f &amp;&amp; cp --verbose -t /tmp/f -L --preserve=all --parents /etc/apt/sources.list &amp;&amp; echo yes ; ls -lR /tmp/f/etc/apt/sources.list /etc/apt/sources.list
/etc -&gt; /tmp/f/etc
/etc/apt -&gt; /tmp/f/etc/apt
'/etc/apt/sources.list' -&gt; '/tmp/f/etc/apt/sources.list'
yes
-rw-r--r-- 1 root root 47 May  3 10:29 /etc/apt/sources.list
-rw-r--r-- 1 root root 47 May  3 10:29 /tmp/f/etc/apt/sources.list
</code></pre>
<p>fails in bookworm and debian/sid:</p>
<pre><code>rm -Rf /tmp/f &amp;&amp; mkdir /tmp/f &amp;&amp; cp --verbose -t /tmp/f -L --preserve=all --parents /etc/apt/sources.list &amp;&amp; echo yes ; ls -lR /tmp/f/etc/apt/sources.list /etc/apt/sources.list
/etc -&gt; /tmp/f/etc
/etc/apt -&gt; /tmp/f/etc/apt
'/etc/apt/sources.list' -&gt; '/tmp/f/etc/apt/sources.list'
cp: 'etc/apt': No such file or directory
-rw-r--r-- 1 root root 47 May  3 10:28 /etc/apt/sources.list
-rw-r--r-- 1 root root 47 May  3 10:28 /tmp/f/etc/apt/sources.list
</code></pre>
<h4 id="schlomo_commented_at_2023-05-03_0842"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532655072">2023-05-03 08:42</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-03_0842" title="Permanent link">&para;</a></h4>
<p>Any idea how to escalate this to the upstream projects (coreutils)</p>
<h4 id="abbbi_commented_at_2023-05-03_0848"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532662112">2023-05-03 08:48</a>:<a class="headerlink" href="#abbbi_commented_at_2023-05-03_0848" title="Permanent link">&para;</a></h4>
<p>i just tried with the latest coreutils source and the behavior is the
same with the latest checkout, but theres a different error message,
which suggests the issue is related to preserving</p>
<pre><code>rm -Rf /tmp/f &amp;&amp; mkdir /tmp/f &amp;&amp; src/cp --verbose -t /tmp/f -L --preserve=all --parents /etc/apt/sources.list &amp;&amp; echo yes ; ls -lR /tmp/f/etc/apt/sources.list /etc/apt/sources.list
/etc -&gt; /tmp/f/etc
/etc/apt -&gt; /tmp/f/etc/apt
'/etc/apt/sources.list' -&gt; '/tmp/f/etc/apt/sources.list'
src/cp: preserving permissions for ‘/tmp/f/etc/apt’: No such file or directory
-rw-r--r-- 1 root root 278 Jun  7  2022 /etc/apt/sources.list
-rw-r--r-- 1 abi  abi  278 Jun  7  2022 /tmp/f/etc/apt/sources.list
</code></pre>
<p>maybe its best to report this to
<a href="https://debbugs.gnu.org/cgi/pkgreport.cgi?pkg=coreutils">https://debbugs.gnu.org/cgi/pkgreport.cgi?pkg=coreutils</a>
or the debian project directly.</p>
<h4 id="abbbi_commented_at_2023-05-03_1017"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532777738">2023-05-03 10:17</a>:<a class="headerlink" href="#abbbi_commented_at_2023-05-03_1017" title="Permanent link">&para;</a></h4>
<p>i just attempted to mkrescue on debian/bookworm which ships rear 2.7 by
default, and this worked like expected, so i guess this issue only hits
if REAR_VAR=/tmp/rear_var is used or some other condition is met?</p>
<h4 id="schlomo_commented_at_2023-05-03_1022"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532782994">2023-05-03 10:22</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-03_1022" title="Permanent link">&para;</a></h4>
<p>We use <code>cp --preserve=all</code> in these three places<br />
<a href="https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/GNU/Linux/400_copy_modules.sh#L138">https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/GNU/Linux/400_copy_modules.sh#L138</a><br />
<a href="https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/GNU/Linux/400_copy_modules.sh#L223">https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/GNU/Linux/400_copy_modules.sh#L223</a><br />
<a href="https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/default/490_fix_broken_links.sh#L78">https://github.com/rear/rear/blob/54df9693402bb1b81ed1633d33be4d3f772c071a/usr/share/rear/build/default/490_fix_broken_links.sh#L78</a></p>
<p>IMHO this code doesn't depend on <code>REAR_VAR</code> at all.</p>
<h4 id="abbbi_commented_at_2023-05-03_1025"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532785785">2023-05-03 10:25</a>:<a class="headerlink" href="#abbbi_commented_at_2023-05-03_1025" title="Permanent link">&para;</a></h4>
<p>yes, i missed the (MODULES contains 'loaded_modules') part. Default is
all_modules.</p>
<h4 id="jsmeix_commented_at_2023-05-03_1115"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532851980">2023-05-03 11:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-03_1115" title="Permanent link">&para;</a></h4>
<p>At other places we use '--preserve=all' implicitly via <code>cp ... -a</code>:</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'cp .* -a '

usr/share/rear/build/GNU/Linux/420_copy_firmware_files.sh:
    cp $verbose -t $ROOTFS_DIR -a --parents /lib*/firmware 2&gt;&gt;/dev/$DISPENSABLE_OUTPUT_DEV 1&gt;&amp;2

usr/share/rear/build/GNU/Linux/400_copy_modules.sh:
        if ! cp $verbose -t $ROOTFS_DIR -a -L --parents /lib/modules/$KERNEL_VERSION 2&gt;&gt;/dev/$DISPENSABLE_OUTPUT_DEV 1&gt;&amp;2 ; then

usr/share/rear/build/GNU/Linux/390_copy_binaries_libraries.sh:
    test -e $ROOTFS_DIR/$lib || cp $v -a -f $lib $ROOTFS_DIR/$lib 1&gt;&amp;2

usr/share/rear/finalize/GNU/Linux/250_migrate_disk_devices_layout.sh:
    cp $v -a --parents "$restored_file" $save_original_file_dir
</code></pre>
<p>I see right now that</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'cp .*-a '
</code></pre>
<p>finds some more places:</p>
<pre><code>usr/share/rear/output/RAWDISK/Linux-i386/270_create_grub2_efi_bootloader.sh:
    cp -a $v "$original_efi_root/." "$RAWDISK_BOOT_EFI_STAGING_ROOT" || Error "Could not copy EFI configuration"

usr/share/rear/output/RAWDISK/Linux-i386/270_create_grub2_efi_bootloader.sh:
            cp -a $v "$additional_grub_directory/$grub_modules_directory/$module" "$grub_target_directory/$grub_modules_directory"

usr/share/rear/build/Debian/i386/600_fix_debian_stuff.sh:
       cp -a $v /lib/libdevmapper* $ROOTFS_DIR/lib/ &gt;&amp;2

usr/share/rear/rescue/default/910_copy_logfile.sh:
cp -a $v $RUNTIME_LOGFILE $ROOTFS_DIR/tmp/${logfile_basename%.*}-partial-$(date -Iseconds).log &gt;&amp;2

usr/share/rear/restore/Fedora/050_copy_dev_files.sh:
cp -a /dev/. $TARGET_FS_ROOT/dev/

usr/share/rear/restore/YUM/default/950_grub_mkconfig.sh:
cp -a $TARGET_FS_ROOT/boot/grub/grub.conf $TARGET_FS_ROOT/boot/grub/grub.conf.bak

usr/share/rear/restore/YUM/default/400_restore_packages.sh:
cp -a /etc/yum.repos.d/* $TARGET_FS_ROOT/etc/yum.repos.d/

usr/share/rear/restore/YUM/default/410_restore_backup.sh:
                    cp -a $TMP_DIR/restore-exclude-list.txt $TARGET_FS_ROOT/tmp

usr/share/rear/restore/default/990_move_away_restored_files.sh:
        cp -a --parents $file_relative $move_away_dir || continue
usr/share/rear/restore/GALAXY11/default/500_migrate_commvault_certificates.sh:
    cp -a $certs "$TARGET_FS_ROOT/$GALAXY11_HOME_DIRECTORY" || Error "Could not copy $certs"
usr/share/rear/finalize/default/110_bind_mount_proc_sys_dev_run.sh:
            cp -a /dev/. $TARGET_FS_ROOT/dev || LogPrintError "Failed to copy /dev contents from ReaR recovery system to $TARGET_FS_ROOT/dev"
</code></pre>
<h4 id="schlomo_commented_at_2023-05-03_1129"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1532867051">2023-05-03 11:29</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-03_1129" title="Permanent link">&para;</a></h4>
<p>It seems related to -t i think, couldn't reproduce with regular cp -a</p>
<h4 id="schlomo_commented_at_2023-05-03_1740"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1533446728">2023-05-03 17:40</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-03_1740" title="Permanent link">&para;</a></h4>
<p><a href="https://debbugs.gnu.org/cgi/bugreport.cgi?bug=63245">https://debbugs.gnu.org/cgi/bugreport.cgi?bug=63245</a><br />
is the upstream bugreport with a patch proposal<br />
<a href="https://debbugs.gnu.org/cgi/bugreport.cgi?att=1;filename=cp-abs-parents.patch;msg=8;bug=63245">https://debbugs.gnu.org/cgi/bugreport.cgi?att=1;filename=cp-abs-parents.patch;msg=8;bug=63245</a></p>
<h4 id="jsmeix_commented_at_2023-05-04_0834"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1534302994">2023-05-04 08:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-04_0834" title="Permanent link">&para;</a></h4>
<p>openSUSE Bugzilla report:<br />
<a href="https://bugzilla.opensuse.org/show_bug.cgi?id=1211081">https://bugzilla.opensuse.org/show_bug.cgi?id=1211081</a></p>
<p>SUSE SLE15 and openSUSE Leap 15 are not affected because</p>
<pre><code># osc list SUSE:SLE-15:Update coreutils | grep tar
coreutils-8.29.tar.xz
</code></pre>
<p>So it seems only openSUSE Tumbleweed is affected because</p>
<pre><code># osc list openSUSE:Factory coreutils | grep tar
coreutils-9.3.tar.xz
</code></pre>
<h4 id="jsmeix_commented_at_2023-05-04_0843"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1534319424">2023-05-04 08:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-04_0843" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
please have a look here regarding<br />
whether or not RHEL or Fedora are affected<br />
i.e. if RHEL or Fedora contain coreutils 9.1-9.3 inclusive.</p>
<h4 id="pcahyna_commented_at_2023-05-04_0849"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1534329752">2023-05-04 08:49</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-04_0849" title="Permanent link">&para;</a></h4>
<p>RHEL does not (coreutils 8.*), but Fedora does (f37 has coreutils 9.1).</p>
<h4 id="jsmeix_commented_at_2023-05-31_1251"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2972#issuecomment-1570176909">2023-05-31 12:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-31_1251" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
is there something simple, fail-safe, and backward compatible<br />
that we could do with reasonable effort in ReaR<br />
to avoid this issue in ReaR?</p>
<p>In general I think it does not belong to ReaR<br />
to implement special stuff to avoid generic bugs<br />
in standard programs that are called by ReaR.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-04-23.2972.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
