<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#527 Issue closed: partition resizing - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#527 Issue closed: partition resizing";
        var mkdocs_page_input_path = "issues/2015-01-13.527.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#527 Issue closed: partition resizing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="527_issue_closed_partition_resizing"><a href="https://github.com/rear/rear/issues/527">#527 Issue</a> <code>closed</code>: partition resizing<a class="headerlink" href="#527_issue_closed_partition_resizing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>discuss / RFC</code>, <code>support / question</code></p>
<h4 id="lesmikesell_opened_issue_at_2015-01-13_2225"><img src="https://avatars.githubusercontent.com/u/1752645?v=4" width="50"><a href="https://github.com/lesmikesell">lesmikesell</a> opened issue at <a href="https://github.com/rear/rear/issues/527">2015-01-13 22:25</a>:<a class="headerlink" href="#lesmikesell_opened_issue_at_2015-01-13_2225" title="Permanent link">&para;</a></h4>
<p>I'm trying to use rear to convert a Centos5 system to a VM. The<br />
source has 3 primary partitions on /dev/sda:</p>
<pre><code>Disk /dev/sda: 146684248063B
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start          End            Size           Type     File system  Flags
 1      32256B         106928639B     106896384B     primary  ext3         boot
 2      106928640B     142387822079B  142280893440B  primary  ext3
 3      142387822080B  146681418239B  4293596160B    primary  linux-swap
</code></pre>
<p>I've tried both smaller and larger target disks and the restore script<br />
claims that it is resizing the partitions to fit, but parted always<br />
claims that the value for the last partition is 'outside of the<br />
device'. Actually, it only mentions resizing 2 partitions:</p>
<pre><code>Partition primary on /dev/sda: size reduced to fit on disk.
Partition primary on /dev/sda: size reduced to fit on disk.
</code></pre>
<p>(when in fact this target disk is actually bigger) - after failing I
have:</p>
<pre><code>Model: VMware Virtual disk (scsi)
Disk /dev/sda: 157840048127B
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start       End            Size           Type     File system  Flags
 1      32768B      106929151B     106896384B     primary               boot
 2      106930176B  157840048127B  157733117952B  primary
</code></pre>
<p>And the failing command is:<br />
<code>parted -s /dev/sda mkpart '"primary"' 157840084992B 157840048127B &gt;&amp;2</code></p>
<p>Excerpts from a debug log below:</p>
<pre><code>++ echo '2015-01-13 14:22:09 Device sda exists.'
2015-01-13 14:22:09 Device sda exists.
+++ get_disk_size sda
+++ local disk_name=sda
++++ get_block_size sda
++++ '[' -r /sys/block/sda/queue/logical_block_size ']'
++++ echo 512
+++ local block_size=512
+++ '[' -r /sys/block/sda/size ']'
+++ BugIfError 'Could not determine size of disk sda, please file a bug.'
+++ ((  0 != 0  ))
+++ local nr_blocks=308281344
+++ local disk_size=157840048128
+++ echo 157840048128
++ newsize=157840048128
++ '[' 157840048128 -eq 146684248064 ']'
++ LogPrint 'Device sda has size 157840048128, 146684248064 expected'
++ Log 'Device sda has size 157840048128, 146684248064 expected'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:09 Device sda has size 157840048128, 146684248064 expected'
2015-01-13 14:22:09 Device sda has size 157840048128, 146684248064 expected
++ Print 'Device sda has size 157840048128, 146684248064 expected'
++ test 1
++ echo -e 'Device sda has size 157840048128, 146684248064 expected'
++ MIGRATION_MODE=true
++ read disk dev size junk

[...]

+++ get_disk_size sda
+++ local disk_name=sda
++++ get_block_size sda
++++ '[' -r /sys/block/sda/queue/logical_block_size ']'
++++ echo 512
+++ local block_size=512
+++ '[' -r /sys/block/sda/size ']'
+++ BugIfError 'Could not determine size of disk sda, please file a bug.'
+++ ((  0 != 0  ))
+++ local nr_blocks=308281344
+++ local disk_size=157840048128
+++ echo 157840048128
++ newsize=157840048128
++ '[' 146684248064 -eq 157840048128 ']'

[...]

+++ grep '^disk ' /var/lib/rear/layout/disklayout.conf
++ read type device size junk
+++ get_sysfs_name /dev/sda
+++ local name=sda
+++ name=sda
+++ [[ -e /sys/block/sda ]]
+++ echo sda
+++ return 0
++ sysfsname=sda
++ [[ -d /sys/block/sda ]]
+++ get_disk_size sda
+++ local disk_name=sda
++++ get_block_size sda
++++ '[' -r /sys/block/sda/queue/logical_block_size ']'
++++ echo 512
+++ local block_size=512
+++ '[' -r /sys/block/sda/size ']'
+++ BugIfError 'Could not determine size of disk sda, please file a bug.'
+++ ((  0 != 0  ))
+++ local nr_blocks=308281344
+++ local disk_size=157840048128
+++ echo 157840048128
++ newsize=157840048128
++ ((  157840048128 == 146684248064  ))
++ oldsize=146684248064
++ difference=11155800064
++ Log 'Total resize of 11155800064B'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:28 Total resize of 11155800064B'
2015-01-13 14:22:28 Total resize of 11155800064B
++ Log 'Searching for resizeable partitions on disk /dev/sda (157840048128B)'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:28 Searching for resizeable partitions on disk /dev/sda (157840048128B)'
2015-01-13 14:22:28 Searching for resizeable partitions on disk /dev/sda (157840048128B)
++ partitions=()
++ resizeable_space=0
++ available_space=157840048128
++ read type part size start name flags name junk
+++ grep '^part /dev/sda' /var/lib/rear/layout/disklayout.conf
++++ grep '^swap /dev/sda' /var/lib/rear/layout/disklayout.conf
++++ cut '-d ' -f 2
+++ grep -v /dev/sda3
++ case "$flags" in
++ available_space=157733151744
++ Log 'Will not resize partition /dev/sda1.'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:28 Will not resize partition /dev/sda1.'
2015-01-13 14:22:28 Will not resize partition /dev/sda1.
++ read type part size start name flags name junk
++ case "$flags" in
++ partitions=("${partitions[@]}" "$name|${size%B}")
++ resizeable_space=142280893440
++ Log 'Will resize partition /dev/sda2.'
++ test 1 -gt 0
++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:28 Will resize partition /dev/sda2.'
2015-01-13 14:22:28 Will resize partition /dev/sda2.
++ read type part size start name flags name junk
++ ((  1 == 0  ))
++ ((  available_space &lt; 0  ))
++ for data in '"${partitions[@]}"'
++ name=/dev/sda2
++ partition_size=142280893440
+++ echo '142280893440 142280893440 157733151744'
+++ awk '{ printf "%d", ($1/$2)*$3; }'
++ new_size=157733151744
++ ((  new_size &gt; 0  ))
++ BugIfError 'Partition /dev/sda2 resized to a negative number.'
++ ((  0 != 0  ))
+++ echo /dev/sda2
+++ sed -r 's/.+([0-9])$/\1/'
++ nr=2
++ sed -r -i 's|^(part /dev/sda) 142280893440(.+)2$|\1 157733151744\22|' /var/lib/rear/layout/disklayout.conf.tmp
++ Log 'Resized partition /dev/sda2 from 142280893440B to 157733151744B.'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-13 14:22:28 Resized partition /dev/sda2 from 142280893440B to 157733151744B.'
2015-01-13 14:22:28 Resized partition /dev/sda2 from 142280893440B to 157733151744B.
++ read type device size junk
++ mv /var/lib/rear/layout/disklayout.conf.tmp /var/lib/rear/layout/disklayout.conf
</code></pre>
<h4 id="gdha_commented_at_2015-01-14_0950"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-69892320">2015-01-14 09:50</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-14_0950" title="Permanent link">&para;</a></h4>
<p>@lesmikesell which version of rear are you using? Did you tried the
latest git version too? Was the original
<code>/var/lib/rear/layout/disklayout.conf</code> correct with the real situation?</p>
<h4 id="gdha_commented_at_2015-01-20_1529"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-70671652">2015-01-20 15:29</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-20_1529" title="Permanent link">&para;</a></h4>
<p>@jhoekx were you busy with helping Mike? Via the mailing list.</p>
<h4 id="jhoekx_commented_at_2015-01-20_1538"><img src="https://avatars.githubusercontent.com/u/783473?v=4" width="50"><a href="https://github.com/jhoekx">jhoekx</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-70673283">2015-01-20 15:38</a>:<a class="headerlink" href="#jhoekx_commented_at_2015-01-20_1538" title="Permanent link">&para;</a></h4>
<p>I briefly checked based on the mailing list conversation, but haven't
had the time to investigate deeper...</p>
<h4 id="lesmikesell_commented_at_2015-01-20_1613"><img src="https://avatars.githubusercontent.com/u/1752645?v=4" width="50"><a href="https://github.com/lesmikesell">lesmikesell</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-70680109">2015-01-20 16:13</a>:<a class="headerlink" href="#lesmikesell_commented_at_2015-01-20_1613" title="Permanent link">&para;</a></h4>
<p>The rear version is the rear-1.16.1-1.el5 rpm as packaged in EPEL for
Centos 5. I didn't try anything newer. I think the disklayout.conf was
right for an exactly-matching destination drive. But the resizing math
came out wrong for both a smaller and larger destination. I ended up
making it work by obtaining the values from the source disk and editing
them into the restore.sh commands with a slightly larger target drive so
I don't need help with this particular instance - I'm just reporting a
bug in the resizing code. Contributing factors may be that this drive
has 3 primary partitions, one of which is /boot. The same system has 2
other drives, each with a single partition and those worked as expected.</p>
<h4 id="gdha_commented_at_2017-03-08_1228"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-285028264">2017-03-08 12:28</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-08_1228" title="Permanent link">&para;</a></h4>
<p>@lesmikesell I guess we can close this issue as it is old?</p>
<h4 id="lesmikesell_commented_at_2017-03-08_1645"><img src="https://avatars.githubusercontent.com/u/1752645?v=4" width="50"><a href="https://github.com/lesmikesell">lesmikesell</a> commented at <a href="https://github.com/rear/rear/issues/527#issuecomment-285095798">2017-03-08 16:45</a>:<a class="headerlink" href="#lesmikesell_commented_at_2017-03-08_1645" title="Permanent link">&para;</a></h4>
<p>Yes, closing. I haven't run into this situation again.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-01-13.527.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
