<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#770 Issue closed: /etc/udev/rules.d/70-persistent-net.rules - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#770 Issue closed: /etc/udev/rules.d/70-persistent-net.rules";
        var mkdocs_page_input_path = "issues/2016-02-12.770.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#770 Issue closed: /etc/udev/rules.d/70-persistent-net.rules</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="770_issue_closed_etcudevrulesd70-persistent-netrules"><a href="https://github.com/rear/rear/issues/770">#770 Issue</a> <code>closed</code>: /etc/udev/rules.d/70-persistent-net.rules<a class="headerlink" href="#770_issue_closed_etcudevrulesd70-persistent-netrules" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code></p>
<h4 id="gdha_opened_issue_at_2016-02-12_1102"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/770">2016-02-12 11:02</a>:<a class="headerlink" href="#gdha_opened_issue_at_2016-02-12_1102" title="Permanent link">&para;</a></h4>
<p>I was doing a test with a VM restore (cloning) of a RHEL6 system and
noticed that the eth0 device was renamed to eth2, and eth1 to eth3.
After the recover the system came up, but with no IP address configured
to eth2.</p>
<p>In the recover log we find the following:</p>
<pre><code>2016-02-11 05:34:29 Including finalize/GNU/Linux/30_create_mac_mapping.sh
cat: /sys/class/net/eth1/address: No such file or directory
2016-02-11 05:34:29 Including finalize/GNU/Linux/41_migrate_udev_rules.sh
2016-02-11 05:34:29 Updating udev configuration (70-persistent-net.rules)
</code></pre>
<p>However, this is easy to fix by:</p>
<ul>
<li>delete the /etc/udev/rules.d/70-persistent-net.rules file and
    reboot, or</li>
<li>editing /etc/udev/rules.d/70-persistent-net.rules and delete the old
    entries and edit NAME entry (change eth2 to eth0, and eth3 to eth1)
    and reboot</li>
</ul>
<p>This makes my think, wouldn't it be better to remove this restored
<code>/etc/udev/rules.d/70-persistent-net.rules</code> file during the recover
process? As this file gets recreated during the reboot.<br />
Any ideas or suggestions?</p>
<h4 id="schlomo_commented_at_2016-02-12_1109"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183278948">2016-02-12 11:09</a>:<a class="headerlink" href="#schlomo_commented_at_2016-02-12_1109" title="Permanent link">&para;</a></h4>
<p>Isn't that a bug earlier up in the rescue part? E.g. when we boot the
system and decide how to map the old interfaces of the source system to
the new interfaces of the recovery system?</p>
<p>the logic in 41_migrate_udev_rules.sh suggests that all decisions
have been made much earlier and not here.</p>
<h4 id="jsmeix_commented_at_2016-02-12_1205"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183296955">2016-02-12 12:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-12_1205" title="Permanent link">&para;</a></h4>
<p>On my SLES12 system /etc/udev/rules.d/70-persistent-net.rules contains:</p>
<pre>
# This file was automatically generated by the /usr/lib/udev/write_net_rules
# program,run by the persistent-net-generator.rules rules file.
#
# You can modify it,as long as you keep each rule on a single
# line,and change only the value of the NAME= key.
# PCI device 0x8086:0x10de (e1000e)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="00:26:b9:82:21:7a", ATTR{dev_id}=="0x0", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"
</pre>

<p>I think it is a generic issue what to do during backup restore with
files that are in the backup but should not be restored because they are
automatically created and maintained by the system.</p>
<p>The generic traditional example of such a file is /etc/mtab. As long as
it was a regular file it must not have been restored with outdated
content from a backup. Nowadays it is a symbolic link to
/proc/self/mounts which should probably be restored to ensure that link
is available (I don't know if that link is automatically created by the
system).</p>
<p>I think in general the backup should contain all files to be complete
and it is the task of the admin to explicitly exclude files from his
backup restore that he does not want to restore via EXCLUDE_RESTORE.</p>
<p>I think in general rear should handle the backup and restore task as
"completely separated third party stuff" and not try to mess around with
it.</p>
<p>Nevertheless rear could have in usr/share/rear/conf/default.conf a well
documented predefined EXCLUDE_RESTORE list of well-known files that
usually never make sense to be restored.</p>
<h4 id="schlomo_commented_at_2016-02-12_1218"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183300690">2016-02-12 12:18</a>:<a class="headerlink" href="#schlomo_commented_at_2016-02-12_1218" title="Permanent link">&para;</a></h4>
<p>guys, I think we have a bug somewhere earlier in our process. Why did
this suddenly pop up after working flawless for years?</p>
<h4 id="jsmeix_commented_at_2016-02-12_1222"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183301937">2016-02-12 12:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-12_1222" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
As far as I understand what @gdha wrote "After the recover the system
came up" it means that the issue was not in the rear recovery system but
that "rear recover" had worked but afterwards when booting the recovered
system the issue appeared.</p>
<p>I am not at all a networking configuration expert but I would assume
that rear does not need to change the networking configuration after the
backup restore.</p>
<p>I think that by default the new hardware where "rear recover" is run has
to be sufficiently compatible with the old hardware where "rear
mkbackup" was run so that the networking configuration files from the
backup would still work on the new hardware.</p>
<p>I think only configuration files regarding storage (partitioning, file
system, mount points - e.g. /etc/fstab) and configuration files
regarding the bootloader need to be adapted by rear after the backup
restore.<br />
But I could be wrong (in particular because I am not at all a networking
configuration expert).</p>
<h4 id="schlomo_commented_at_2016-02-12_1226"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183303449">2016-02-12 12:26</a>:<a class="headerlink" href="#schlomo_commented_at_2016-02-12_1226" title="Permanent link">&para;</a></h4>
<p>Yes, exactly my point. If the recovered system comes up and does not
work properly then this is a bug in ReaR. The buggy code was executed in
the environment of the rescue system. Either in the boot phase or in the
<code>rear recover</code> phase.</p>
<p>It worked before, even with RHEL6. So there must be a bug somewhere.
Either RHEL did an update or we have a change or both.</p>
<h4 id="jsmeix_commented_at_2016-02-12_1227"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183303751">2016-02-12 12:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-12_1227" title="Permanent link">&para;</a></h4>
<p>In gereral whenever "they" change basic system stuff, then "suddenly"
new interesting issues pop up in rear, in particular here it seems to be
systemd/udev related.</p>
<h4 id="jsmeix_commented_at_2016-02-12_1231"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183304428">2016-02-12 12:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-12_1231" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
can you exclude /etc/udev/rules.d/70-persistent-net.rules from the
backup restore via EXCLUDE_RESTORE and try again.</p>
<p>If it works then, it proves (from my point of view) that this issue is
just one more instance of the generic issue that files that are
automatically created and maintained by the system should be excluded
from the backup restore.</p>
<h4 id="gdha_commented_at_2016-02-12_1853"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183448856">2016-02-12 18:53</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-12_1853" title="Permanent link">&para;</a></h4>
<p>@jsmeix Doing the test again must be requested, but we could do it with
another system perhaps<br />
@schlomo a bug? maybe, the MAC address should be remapped, need to dig
deeper to be sure.</p>
<h4 id="gdha_commented_at_2016-02-13_1309"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183662465">2016-02-13 13:09</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-13_1309" title="Permanent link">&para;</a></h4>
<p>@schlomo I think it has to do with device renaming and as</p>
<pre><code>2016-02-11 05:34:29 Including finalize/GNU/Linux/30_create_mac_mapping.sh
cat: /sys/class/net/eth1/address: No such file or directory
</code></pre>
<p>suggests if did not find the device. udevd already kicked off and read
the original file (with unmodified MAC addresses) and created 2 new
entries. I've seen this many times already (and noticed the same in
several reported issues). When you use DHCP then it goes by unnoticed.</p>
<p>Personally, I think adding this file to <code>EXCLUDE_RESTORE</code> could prevent
this. Not yet tested this theory.</p>
<h4 id="schlomo_commented_at_2016-02-13_2007"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-183746239">2016-02-13 20:07</a>:<a class="headerlink" href="#schlomo_commented_at_2016-02-13_2007" title="Permanent link">&para;</a></h4>
<p>I think that we need to find a generic solution that works regardless of
the restore options. <code>EXCLUDE_RESTORE</code> would only cover <code>NETFS</code> but not
the other backup methods. Imagine ReaR failing because <code>TSM</code> restored
that file.</p>
<h4 id="jsmeix_commented_at_2016-02-15_0949"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-184137091">2016-02-15 09:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-15_0949" title="Permanent link">&para;</a></h4>
<p>@schlomo I have a generic question:<br />
Is rear meant to automatically exlude files from the backup restore that
should not be restored or it this something that the admin must do?</p>
<h4 id="schlomo_commented_at_2016-02-15_1248"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-184191909">2016-02-15 12:48</a>:<a class="headerlink" href="#schlomo_commented_at_2016-02-15_1248" title="Permanent link">&para;</a></h4>
<p>IMHO for ReaR there are three independent concerns:</p>
<ol>
<li>bare metal recovery (block devices, boot loaders ...)</li>
<li>restoring files (either through builtin backup or via external
    backup)</li>
<li>system reconfiguration (network card mapping, disk mapping, drivers
    matching ...)</li>
</ol>
<p>So far the part of restoring files is very independent from the other
parts. Hence nothing magic here.</p>
<p>I would also advise against a magic integration but to always assume
that the backup solution restored <em>all</em> files. If we need to remove some
as part of the system reconfiguration then this is OK.</p>
<h4 id="jsmeix_commented_at_2016-02-16_1044"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-184620459">2016-02-16 10:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-16_1044" title="Permanent link">&para;</a></h4>
<p>@schlomo many thanks for your explanation - I always appreciate your
valuable background information - it helps a lot!</p>
<p>Now (at least for me) it is perfectly clear.</p>
<p>If needed rear should remove restored files as part of the system
reconfiguration.</p>
<p>Therefore I created
<a href="https://github.com/rear/rear/issues/779">https://github.com/rear/rear/issues/779</a><br />
"Move away restored files that should not have been restored."</p>
<p>If you agree I will implement it - but probably after the 1.18 release.</p>
<h4 id="jsmeix_commented_at_2016-02-16_1357"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-184692516">2016-02-16 13:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-16_1357" title="Permanent link">&para;</a></h4>
<p>If you like, I implemented right now something for the 1.18 release, see
<a href="https://github.com/rear/rear/pull/780">https://github.com/rear/rear/pull/780</a></p>
<h4 id="gdha_commented_at_2016-02-18_1716"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-185820594">2016-02-18 17:16</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-18_1716" title="Permanent link">&para;</a></h4>
<p>Can be close as #779 pull request has been checked in.</p>
<h4 id="jsmeix_commented_at_2016-02-19_1123"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-186177485">2016-02-19 11:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-19_1123" title="Permanent link">&para;</a></h4>
<p>Unfortunately I think
<a href="https://github.com/rear/rear/issues/779">https://github.com/rear/rear/issues/779</a>
"Move away restored files that should not have been restored" may not
help regarding what @gdha wrote here in his initial comment
<a href="https://github.com/rear/rear/issues/770#issue-133211130">https://github.com/rear/rear/issues/770#issue-133211130</a></p>
<p>Reason (as far as I see):<br />
Via
<a href="https://github.com/rear/rear/issues/779">https://github.com/rear/rear/issues/779</a>
files are removed immediately after backup restore. Accordingly with</p>
<pre>
BACKUP_RESTORE_MOVE_AWAY_FILES=( /etc/udev/rules.d/70-persistent-net.rules )
</pre>

<p>/etc/udev/rules.d/70-persistent-net.rules gets removed immediately after
backup restore but later
usr/share/rear/finalize/GNU/Linux/41_migrate_udev_rules.sh is run
that creates /etc/udev/rules.d/70-persistent-net.rules anew.</p>
<p>When @gdha needs to remove /etc/udev/rules.d/70-persistent-net.rules in
the rear recovery system after "rear recover" finished and before
rebooting into the recreated system, then
<a href="https://github.com/rear/rear/issues/779">https://github.com/rear/rear/issues/779</a>
does not help and the real fix is probably (as @schlomo suggested) in
the rear recovery code that deals with udev rules.</p>
<p>FYI why it works in my particular case with SLE12-SP1:</p>
<p>In my case finalize/GNU/Linux/41_migrate_udev_rules.sh does the
following (excerpt from my "rear -d -D recover" log):</p>
<pre>
+ source /usr/share/rear/restore/default/99_move_away_restored_files.sh
++ pushd /mnt/local
...
++ cp -a --parents etc/udev/rules.d/70-persistent-net.rules var/lib/rear/moved_away_after_backup_restore/
...
++ rm -rf etc/udev/rules.d/70-persistent-net.rules
...
++ popd
.
.
.
+ source /usr/share/rear/finalize/GNU/Linux/41_migrate_udev_rules.sh
...
++ echo -e 'Updating udev configuration (70-persistent-net.rules)'
++ cp /mnt/local//etc/udev/rules.d/70-persistent-net.rules /mnt/local/root/rear-70-persistent-net.rules.old
cp: cannot stat '/mnt/local//etc/udev/rules.d/70-persistent-net.rules': No such file or directory
++ cp /etc/udev/rules.d/70-persistent-net.rules /mnt/local//etc/udev/rules.d/70-persistent-net.rules
</pre>

<p>In my case 70-persistent-net.rules in the rear recovery system and the
one in the original system are identical:</p>
<pre>
# diff -wups /var/lib/rear/moved_away_after_backup_restore/etc/udev/rules.d/70-persistent-net.rules /etc/udev/rules.d/70-persistent-net.rules  
Files /var/lib/rear/moved_away_after_backup_restore/etc/udev/rules.d/70-persistent-net.rules and /etc/udev/rules.d/70-persistent-net.rules are identical
</pre>

<p>so that all that deletion and re-creation does not actually change
anything in my particular case.</p>
<h4 id="jsmeix_commented_at_2016-02-19_1127"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-186178183">2016-02-19 11:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-19_1127" title="Permanent link">&para;</a></h4>
<p>I think there is perhaps a bug in 41_migrate_udev_rules.sh but I am
not at all a sufficient systemd/udev expert to really help here.</p>
<p>I will now blindly test what happens on my system when I change
41_migrate_udev_rules.sh so that it does not do anything with
70-persistent-net.rules ...</p>
<h4 id="jsmeix_commented_at_2016-02-19_1220"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-186195638">2016-02-19 12:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-19_1220" title="Permanent link">&para;</a></h4>
<p>I use two SLES12-SP1 test systems: Two KVM/QEMU virtual machines with
one NIC and DHCP on each where one is the "original system" where I run
"rear mkbackup" and the other one is the "replacement system" where I
run "rear recover".</p>
<p>I changed 41_migrate_udev_rules.sh to do nothing at all by adding at
its beginning</p>
<pre>
# do nothing at all:
return 0
</pre>

<p>For me the final result is the same:</p>
<p>99_move_away_restored_files.sh removes
/etc/udev/rules.d/70-persistent-net.rules</p>
<p>That is all what is done with it during "rear recover" (that ends on
2016-02-19 11:49:38.597966929 - I assume the "rear recover" time is
UTC).</p>
<p>After reboot into the recovered system 70-persistent-net.rules gets
re-created identical to what it was before</p>
<pre>
# ls -l /etc/udev/rules.d/70-persistent-net.rules
-rw-r--r-- 1 root root 439 Feb 19 12:56 /etc/udev/rules.d/70-persistent-net.rules
# diff -wups /var/lib/rear/moved_away_after_backup_restore/etc/udev/rules.d/70-persistent-net.rules /etc/udev/rules.d/70-persistent-net.rules
Files /var/lib/rear/moved_away_after_backup_restore/etc/udev/rules.d/70-persistent-net.rules and /etc/udev/rules.d/70-persistent-net.rules are identical
</pre>

<p>As expected my DHCP networking still "just works".</p>
<h4 id="gdha_commented_at_2016-03-02_1152"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/770#issuecomment-191208394">2016-03-02 11:52</a>:<a class="headerlink" href="#gdha_commented_at_2016-03-02_1152" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schlomo Yesterday we were able to retest this on the same
hardware where we noticed the behavior described in this issue with the
latest snapshot of 20160222.<br />
In the <code>/etc/rear/local.conf</code> file we added
<code>BACKUP_RESTORE_MOVE_AWAY_FILES=( /etc/udev/rules.d/70-persistent-net.rules )</code>
and ran a recover process where we noticed the following:</p>
<pre><code>2016-03-01 05:50:18 Including finalize/GNU/Linux/41_migrate_udev_rules.sh
diff: /mnt/local//etc/udev/rules.d/70-persistent-net.rules: No such file or directory
2016-03-01 05:50:18 Updating udev configuration (70-persistent-net.rules)
cp: cannot stat `/mnt/local//etc/udev/rules.d/70-persistent-net.rules`: No such file or directory
2016-03-01 05:50:18 Including finalize/GNU/Linux/42_migrate_network_configuration_files.sh
2016-03-01 05:50:18 SED_SCRIPT: ';s/00:50:56:99:1b:49/00:50:56:99:24:97/g;s/00:50:56:99:1B:49/00:50:56:99:24:97/g;s/00:50:56:99:f7:e9/00:50:56:99:b1:25/g;s/00:50:56:99:F7:E9/00:50:56:99:B1:25/g'
</code></pre>
<p>Indeed the <code>/mnt/local//etc/udev/rules.d/70-persistent-net.rules</code> was
successfully removed, and recovered from the rescue image by script
<code>42_migrate_network_configuration_files.sh</code> (in the meantime I improved
the verbosity of this script).<br />
However, the final
<code>/mnt/local//etc/udev/rules.d/70-persistent-net.rules</code> file was looking
good before we rebooted the system (and was still ok after the reboot as
well).<br />
This concludes my quest for this issue. If on-one resist we can close
this one?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-02-12.770.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
