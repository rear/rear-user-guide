<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#531 Issue closed: rear git201501071534 recovery system on Fedora 21: systemd at 100% CPU (/sbin/udevd missing) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#531 Issue closed: rear git201501071534 recovery system on Fedora 21: systemd at 100% CPU (/sbin/udevd missing)";
        var mkdocs_page_input_path = "issues/2015-01-20.531.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#531 Issue closed: rear git201501071534 recovery system on Fedora 21: systemd at 100% CPU (/sbin/udevd missing)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="531_issue_closed_rear_git201501071534_recovery_system_on_fedora_21_systemd_at_100_cpu_sbinudevd_missing"><a href="https://github.com/rear/rear/issues/531">#531 Issue</a> <code>closed</code>: rear git201501071534 recovery system on Fedora 21: systemd at 100% CPU (/sbin/udevd missing)<a class="headerlink" href="#531_issue_closed_rear_git201501071534_recovery_system_on_fedora_21_systemd_at_100_cpu_sbinudevd_missing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2015-01-20_1118"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/531">2015-01-20 11:18</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2015-01-20_1118" title="Permanent link">&para;</a></h4>
<p>I am testing rear git201501071534 version on Fedora 21:</p>
<p>When I boot the rear recovery system it works but<br />
there are two processes "systemd" and "systemd-journal"<br />
where each one continuously runs basically<br />
at 50% CPU usage.</p>
<p>The following dirty hack seems to "fix" it for me:</p>
<p>ln -s /bin/true /sbin/udevd</p>
<p>Details:</p>
<pre>
RESCUE f42:~ # cat /etc/os-release 
NAME=Fedora
VERSION="21 (Twenty One)"
ID=fedora
VERSION_ID=21
PRETTY_NAME="Fedora 21 (Twenty One)"
ANSI_COLOR="0;34"
CPE_NAME="cpe:/o:fedoraproject:fedora:21"
HOME_URL="https://fedoraproject.org/"
BUG_REPORT_URL="https://bugzilla.redhat.com/"
REDHAT_BUGZILLA_PRODUCT="Fedora"
REDHAT_BUGZILLA_PRODUCT_VERSION=21
REDHAT_SUPPORT_PRODUCT="Fedora"
REDHAT_SUPPORT_PRODUCT_VERSION=21

RESCUE f42:~ # top
...
  PID USER  ...  %CPU ...  COMMAND
   54  root          50.0         systemd-journal
     1  root          43.8         systemd

RESCUE f42:~ # journalctl
...
 systemd[1]: Enqueued job udev.service/start as 14149229
 systemd[1]: Installed new job udev.service/start as 14149229
 systemd[1]: Trying to enqueue job udev.service/start/replace
 systemd[1]: Incoming traffic on udev-kernel.socket
 systemd[1]: udev-kernel.socket changed running -> listening
 systemd[1]: udev-kernel.socket got notified about service death (failed permanently: no)
 systemd[1]: Started udev Kernel Device Manager.
 systemd[1]: Job udev.service/start finished, result=done
 systemd[1]: Starting of udev.service requested but condition failed. Ignoring.
 systemd[1]: ConditionPathExists=/sbin/udevd failed for udev.service.
 systemd[1]: udev-kernel.socket changed listening -> running
 systemd[1]: Enqueued job udev.service/start as 14149223
 systemd[1]: Installed new job udev.service/start as 14149223
 systemd[1]: Trying to enqueue job udev.service/start/replace
 systemd[1]: Incoming traffic on udev-kernel.socket
 systemd[1]: udev-kernel.socket changed running -> listening
 systemd[1]: udev-kernel.socket got notified about service death (failed permanently: no)
 systemd[1]: Started udev Kernel Device Manager.
 systemd[1]: Job udev.service/start finished, result=done
 systemd[1]: Starting of udev.service requested but condition failed. Ignoring.
 systemd[1]: ConditionPathExists=/sbin/udevd failed for udev.service.
...

RESCUE f42:~ # ls /sbin/udevd
ls: cannot access /sbin/udevd: No such file or directory

RESCUE f42:~ # ps auxw | grep udev
root ... /usr/lib/systemd/systemd-udevd

RESCUE f42:~ # ln -s /bin/true /sbin/udevd

RESCUE f42:~ # top
...
  PID USER  ...  %CPU ...  COMMAND
     1  root           0.0          systemd

RESCUE f42:~ # journalctl
...
 systemd[1]: udev.service failed.
 systemd[1]: Unit udev.service entered failed state.
 systemd[1]: Unit udev-kernel.socket entered failed state.
 systemd[1]: udev-kernel.socket changed running -> failed
 systemd[1]: udev-kernel.socket got notified about service death (failed permanently: yes)
 systemd[1]: Failed to start udev Kernel Device Manager.
 systemd[1]: Job udev.service/start finished, result=failed
 systemd[1]: udev.service changed dead -> failed
 systemd[1]: start request repeated too quickly for udev.service
 systemd[1]: Starting udev Kernel Device Manager...
 systemd[1]: ConditionPathExists=/sbin/udevd succeeded for udev.service.
</pre>

<h4 id="jsmeix_commented_at_2015-01-20_1147"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70642258">2015-01-20 11:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-20_1147" title="Permanent link">&para;</a></h4>
<p>See also
<a href="https://bugzilla.opensuse.org/show_bug.cgi?id=908854#c9">https://bugzilla.opensuse.org/show_bug.cgi?id=908854#c9</a></p>
<h4 id="gdha_commented_at_2015-01-20_1249"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70648460">2015-01-20 12:49</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-20_1249" title="Permanent link">&para;</a></h4>
<p>That must be introduced by
<code>./skel/default/usr/lib/systemd/system/udev.service</code> script and I think
the guilty entry might be <code>Restart=on-failure</code> in the service
description.</p>
<pre><code>[Unit]
Description=udev Kernel Device Manager
Wants=udev-control.socket udev-kernel.socket
After=udev-control.socket udev-kernel.socket
Before=basic.target
DefaultDependencies=no
ConditionPathExists=/sbin/udevd

[Service]
Type=notify
OOMScoreAdjust=-1000
Sockets=udev-control.socket udev-kernel.socket
Restart=on-failure
ExecStart=/sbin/udevd
</code></pre>
<p>Perhaps adding <code>RestartSec=10s</code> would be enough to reduce the CPU load?</p>
<h4 id="jsmeix_commented_at_2015-01-20_1351"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70655662">2015-01-20 13:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-20_1351" title="Permanent link">&para;</a></h4>
<p>Still same CPU load in the recovery system now with:</p>
<pre>
RESCUE f42:~ # cat /usr/lib/systemd/system/udev.service
[Unit]
Description=udev Kernel Device Manager
Wants=udev-control.socket udev-kernel.socket
After=udev-control.socket udev-kernel.socket
Before=basic.target
DefaultDependencies=no
ConditionPathExists=/sbin/udevd
[Service]
Type=notify
OOMScoreAdjust=-1000
Sockets=udev-control.socket udev-kernel.socket
Restart=on-failure
RestartSec=10s
ExecStart=/sbin/udevd
RESCUE f42:~ #
</pre>

<p>But CPU load is not the actual problem - it is only a symptom.</p>
<p>Regarding the actual problem:</p>
<p>It seems in my original Fedora 21 system there is no udevd executable:</p>
<pre>
[root@f42 ~]# type -a udevd
-bash: type: udevd: not found
[root@f42 ~]# ls -l /sbin/udevd /usr/sbin/udevd /bin/udevd /usr/bin/udevd
ls: cannot access /sbin/udevd: No such file or directory
ls: cannot access /usr/sbin/udevd: No such file or directory
ls: cannot access /bin/udevd: No such file or directory
ls: cannot access /usr/bin/udevd: No such file or directory
</pre>

<p>Accordingly it seems to not make sense to have a systemd unit file in
the rear recovery system with "ExecStart=/sbin/udevd" because this can
never work.</p>
<h4 id="gdha_commented_at_2015-01-20_1445"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70663709">2015-01-20 14:45</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-20_1445" title="Permanent link">&para;</a></h4>
<p>@jsmeix That is service for older Fedora releases (and/or other
distro's) still referring to this service of udevd. If you put the
<code>Restart=on-failure</code> in comment then the problem is gone.</p>
<h4 id="jsmeix_commented_at_2015-01-20_1453"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70665080">2015-01-20 14:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-20_1453" title="Permanent link">&para;</a></h4>
<p>FYI:</p>
<p>What "ExecStart=..." exist in my recovery system and what executables
are missing there:</p>
<pre>
RESCUE f42:~ # find /usr/lib/systemd/ | xargs grep -h 'ExecStart=' 2>/dev/null | grep -o '/[^ ]*' | sort -u
/bin/agetty
/bin/dbus-daemon
/bin/systemctl
/etc/scripts/boot
/etc/scripts/run-sshd
/etc/scripts/run-syslog
/etc/scripts/system-setup
/lib/systemd/systemd-logger
/lib/systemd/systemd-shutdownd
/sbin/agetty
/sbin/udevd
/usr/bin/udevadm
/usr/lib/systemd/systemd-journald
/usr/lib/systemd/systemd-udevd
RESCUE f42:~ # for e in $( find /usr/lib/systemd/ | xargs grep -h 'ExecStart=' 2>/dev/null | grep -o '/[^ ]*' | sort -u ) ; do ls -l $e | grep 'No such' ; done
ls: cannot access /lib/systemd/systemd-logger: No such file or directory
ls: cannot access /sbin/udevd: No such file or directory
RESCUE f42:~ # 
</pre>

<p>/lib/systemd/systemd-logger is used only in
/usr/lib/systemd/system/systemd-logger.service as
ExecStart=/lib/systemd/systemd-logger</p>
<p>/sbin/udevd is used only in /usr/lib/systemd/system/udev.service as<br />
ConditionPathExists=/sbin/udevd and ExecStart=/sbin/udevd</p>
<p>I think when the rear recovery system is generated, there should be a
test to ensure executables that are needed by systemd unit files do
actually exist.</p>
<h4 id="gdha_commented_at_2015-01-20_1517"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70669257">2015-01-20 15:17</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-20_1517" title="Permanent link">&para;</a></h4>
<p>@jsmeix Basically I agree with you. However, systemd development is
going so fast and is different on several distro's that it is very hard
for us to keep track where what is used and what became obsolete in the
meantime. Remember, this is part of the <code>skel</code> tree.<br />
If we want to change this then we should create additional scripts which
figures this out during the recovery image build. Not impossible, but
time consuming and error prone because it is impossible to test all
possible combinations in a limited time period (which means other stuff
may be broken).</p>
<p>To be honest, I do not care much about some missing executables as once
the system is recovered it is finished with rear. I care about rear's
functionality - doing a proper recovery.</p>
<h4 id="jsmeix_commented_at_2015-01-20_1533"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70672272">2015-01-20 15:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-20_1533" title="Permanent link">&para;</a></h4>
<p>I fully agree that systemd stuff are at least currently various too fast
moving targets so that others simply cannot keep up with that madness.</p>
<p>Feel free to close this issue.</p>
<p>Nevertheless I am willing to have a look if it is possible to add some
check scripts that implement some very basic tests whether or not the
rear recovery system seems to be self-consistent.</p>
<p>In this case I would like to get some initial basic hint how I should
implement it in particular the location of such scripts in rear and how
to make them automatically executed during "rear mkbackup/mkrescue".</p>
<h4 id="jsmeix_commented_at_2015-01-20_1548"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-70675087">2015-01-20 15:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-20_1548" title="Permanent link">&para;</a></h4>
<p>FYI:</p>
<p>What "ExecStart=..." exist in my recovery system for openSUSE 13.2<br />
and what executables are missing there:</p>
<pre>
RESCUE f74:~ # find /usr/lib/systemd/ | xargs grep -h 'ExecStart=' 2>/dev/null | grep -o '/[^ ]*' | sort -u
/bin/agetty
/bin/dbus-daemon
/bin/systemctl
/etc/scripts/boot
/etc/scripts/run-sshd
/etc/scripts/run-syslog
/etc/scripts/system-setup
/lib/systemd/systemd-logger
/lib/systemd/systemd-shutdownd
/sbin/agetty
/sbin/udevd
/usr/bin/udevadm
/usr/lib/systemd/systemd-journald
/usr/lib/systemd/systemd-udevd
RESCUE f74:~ # for e in $( find /usr/lib/systemd/ | xargs grep -h 'ExecStart=' 2>/dev/null | grep -o '/[^ ]*' | sort -u ) ; do ls -l $e | grep 'No such' ; done
ls: cannot access /lib/systemd/systemd-logger: No such file or directory
ls: cannot access /lib/systemd/systemd-shutdownd: No such file or directory
RESCUE f74:~ # find /usr/lib/systemd/ | xargs grep '/lib/systemd/systemd-logger' 2>/dev/null
/usr/lib/systemd/system/systemd-logger.service:ExecStart=/lib/systemd/systemd-logger
RESCUE f74:~ # find /usr/lib/systemd/ | xargs grep '/lib/systemd/systemd-shutdownd' 2>/dev/null
/usr/lib/systemd/system/systemd-shutdownd.service:ExecStart=/lib/systemd/systemd-shutdownd
</pre>

<h4 id="gdha_commented_at_2015-01-23_1524"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71208766">2015-01-23 15:24</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-23_1524" title="Permanent link">&para;</a></h4>
<p>@jsmeix about:</p>
<blockquote>
<p>Nevertheless I am willing to have a look if it is possible to add some
check scripts that implement some very basic tests whether or not the
rear recovery system seems to be self-consistent.</p>
<p>In this case I would like to get some initial basic hint how I should
implement it in particular the location of such scripts in rear and
how to make them automatically executed during "rear
mkbackup/mkrescue".</p>
</blockquote>
<p>I would add these scripts somewhere in the <em>build</em> stage (use <code>-s</code>
option):</p>
<pre><code>Source rescue/GNU/Linux/95_cfg2html.sh
Source rescue/GNU/Linux/96_collect_MC_serviceguard_infos.sh
Source build/GNU/Linux/00_create_symlinks.sh
Source build/GNU/Linux/09_create_lib_directories_and_symlinks.sh
Source build/GNU/Linux/10_copy_as_is.sh
Source build/GNU/Linux/11_touch_empty_files.sh
Source build/GNU/Linux/13_create_dotfiles.sh
Source build/GNU/Linux/15_adjust_permissions.sh
Source build/GNU/Linux/16_adjust_sshd_config.sh
Source build/GNU/Linux/39_copy_binaries_libraries.sh
Source build/GNU/Linux/40_copy_modules.sh
Source build/default/50_patch_sshd_config.sh
Source build/GNU/Linux/60_verify_and_adjust_udev.sh
Source build/GNU/Linux/61_verify_and_adjust_udev_systemd.sh
Source build/default/96_remove_encryption_keys.sh
Source build/default/97_add_rear_release.sh
Source build/default/98_verify_rootfs.sh
Source build/default/99_update_os_conf.sh
Source pack/Linux-i386/30_copy_kernel.sh
</code></pre>
<h4 id="jsmeix_commented_at_2015-01-26_1312"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71458330">2015-01-26 13:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-26_1312" title="Permanent link">&para;</a></h4>
<p>Right now I found another issue where something is missing<br />
in the recovery system:</p>
<p>When a vfat filesystem should be recreated "rear recover" fails with</p>
<pre>
/var/lib/rear/layout/diskrestore.sh: line 156: dosfslabel: command not found
</pre>

<p>One can manually make it work by adding</p>
<pre>
PROGS=( ${PROGS[@]} dosfslabel )
</pre>

<p>in /etc/rear/local.conf but it would be nicer if "rear mkbackup"
itself<br />
detects what is needed in the recovery system and reports an error<br />
if what is needed for the recovery system cannot be found<br />
in the original system where "rear mkbackup" runs.</p>
<h4 id="gdha_commented_at_2015-01-26_1746"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71503348">2015-01-26 17:46</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-26_1746" title="Permanent link">&para;</a></h4>
<p>try a 'grep -r dosfslabel .' and you will see it is detected for EFI<br />
systems where a vfat partition is required. Do you need it for
something<br />
else?</p>
<p>On Mon, Jan 26, 2015 at 2:12 PM, Johannes Meixner
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a><br />
wrote:</p>
<blockquote>
<p>Right now I found another issue where something is missing<br />
in the recovery system:</p>
<p>When a vfat filesystem should be recreated "rear recover" fails with</p>
<p>/var/lib/rear/layout/diskrestore.sh: line 156: dosfslabel: command not
found</p>
<p>One can manually make it work by adding</p>
<p>PROGS=( ${PROGS[@]} dosfslabel )</p>
<p>in /etc/rear/local.conf but it would be nicer if "rear mkbackup"
itself<br />
detects what is needed in the recovery system and reports an error<br />
if what is needed for the recovery system cannot be found<br />
in the original system where "rear mkbackup" runs.</p>
<p>—<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/531#issuecomment-71458330">https://github.com/rear/rear/issues/531#issuecomment-71458330</a>.</p>
</blockquote>
<h4 id="jsmeix_commented_at_2015-01-27_0903"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71612242">2015-01-27 09:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-27_0903" title="Permanent link">&para;</a></h4>
<p>Out of curiosity I made on my test system an additional normal data
partition (/dev/sda7) with a FAT filesystem on it.</p>
<p>In 23_filesystem_layout.sh there is</p>
<pre>
  (vfat)
  ...
  label=$(dosfslabel $device | tail -1)
</pre>

<p>and in 13_include_filesystem_code.sh there is</p>
<pre>
  (vfat)
  ...
  echo "dosfslabel $device $label >&2" >> "$LAYOUT_CODE"
</pre>

<h4 id="gdha_commented_at_2015-01-27_1100"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71627885">2015-01-27 11:00</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-27_1100" title="Permanent link">&para;</a></h4>
<p>was the FAT partition mounted? If yes, then you found a defect.</p>
<p>On Tue, Jan 27, 2015 at 10:03 AM, Johannes Meixner
&lt;<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a></p>
<blockquote>
<p>wrote:</p>
<p>Out of curiosity I made on my test system a normal partition
(/dev/sdXn)<br />
with a FAT filesystem on it.</p>
<p>—<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/531#issuecomment-71612242">https://github.com/rear/rear/issues/531#issuecomment-71612242</a>.</p>
</blockquote>
<h4 id="jsmeix_commented_at_2015-01-27_1121"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71631298">2015-01-27 11:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-27_1121" title="Permanent link">&para;</a></h4>
<p>It is mounted.</p>
<p>On the original system (it is the SLES12 system that I used in
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
for testing MD stuff where I just out of play instinct used the last
remaining cylinder of the disk as separate partition and because it is
so small I used FAT on it):</p>
<pre>
f143:~ # mount -t ext2,ext4,vfat
/dev/md0 on / type ext4 (rw,relatime,stripe=16,data=ordered)
/dev/sda7 on /remainder type vfat (rw,nosuid,nodev,noexec,relatime,gid=100,fmask=0002,dmask=0002,allow_utime=0020,codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,errors=remount-ro)
/dev/sda2 on /boot type ext2 (rw,relatime)
f143:~ # mdadm --detail /dev/md0
/dev/md0:
        Version : 1.0
  Creation Time : Mon Jan 26 13:21:59 2015
     Raid Level : raid0
     Array Size : 20945856 (19.98 GiB 21.45 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent
    Update Time : Mon Jan 26 13:21:59 2015
          State : clean 
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0
     Chunk Size : 32K
           Name : any:0
           UUID : d83d58d6:10642523:9803931f:4969ea21
         Events : 0
    Number   Major   Minor   RaidDevice State
       0       8        5        0      active sync   /dev/sda5
       1       8        6        1      active sync   /dev/sda6
f143:~ # fdisk -l -u=cylinders
Disk /dev/sda: 24 GiB, 25769803776 bytes, 50331648 sectors
Geometry: 255 heads, 63 sectors/track, 3133 cylinders
Units: cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x000edd6b
Device     Boot Start   End Cylinders Size Id Type
/dev/sda1           1   393       392   3G 82 Linux swap / Solaris
/dev/sda2  *      393   524       132   1G 83 Linux
/dev/sda3         524  3134      2610  20G  f W95 Ext'd (LBA)
/dev/sda5         524  1827      1304  10G fd Linux raid autodetect
/dev/sda6        1828  3131      1304  10G fd Linux raid autodetect
/dev/sda7        3132  3132         1   7M  c W95 FAT32 (LBA)
Disk /dev/md0: 20 GiB, 21448556544 bytes, 41891712 sectors
Geometry: 2 heads, 4 sectors/track, 5236464 cylinders
Units: cylinders of 8 * 512 = 4096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 32768 bytes / 65536 bytes
</pre>

<h4 id="gdha_commented_at_2015-01-27_1130"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71632234">2015-01-27 11:30</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-27_1130" title="Permanent link">&para;</a></h4>
<p>Just added <code>dosfslabel</code> to the conf/GNU/Linux.conf file which should fix
your vfat dosfslabel issue</p>
<h4 id="gdha_commented_at_2015-01-28_1615"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71862676">2015-01-28 16:15</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-28_1615" title="Permanent link">&para;</a></h4>
<p>@jsmeix can this issue be closed?</p>
<h4 id="jsmeix_commented_at_2015-01-29_1000"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-71997896">2015-01-29 10:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-29_1000" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I am sorry. I misused this issue when I found "dosfslabel" is missing in
the recovery system. I should have submitted a new separated issue for
"dosfslabel". The "dosfslabel" part of this isuse is fixed now.</p>
<p>This issue is initially about "on Fedora 21: systemd at 100% CPU
(/sbin/udevd missing)". In my last test with Fedora 21 it still happened
so that I think the initial issue is not yet fixed.</p>
<h4 id="gdha_commented_at_2015-01-30_1556"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-72222531">2015-01-30 15:56</a>:<a class="headerlink" href="#gdha_commented_at_2015-01-30_1556" title="Permanent link">&para;</a></h4>
<p>Guess we can add some more lines in here to remove the obsolete
<code>udev.service</code></p>
<pre><code>2015-01-30 14:55:25 Including build/GNU/Linux/61_verify_and_adjust_udev_systemd.sh
+ . /usr/share/rear/build/GNU/Linux/61_verify_and_adjust_udev_systemd.sh
++ test -d /tmp/rear.Vd25lI6NQG7yU5K/rootfs/usr/lib/systemd/system
++ Log 'Cleaning up systemd udev socket files'
++ test 1 -gt 0
+++ Stamp
+++ date '+%Y-%m-%d %H:%M:%S '
++ echo '2015-01-30 14:55:25 Cleaning up systemd udev socket files'
2015-01-30 14:55:25 Cleaning up systemd udev socket files
++ my_udev_files=($(find $ROOTFS_DIR/usr/lib/systemd/system/sockets.target.wants -type l -name "*udev*"  -printf "%P\n"))
+++ find /tmp/rear.Vd25lI6NQG7yU5K/rootfs/usr/lib/systemd/system/sockets.target.wants -type l -name '*udev*' -printf '%P\n'
++ for m in '"${my_udev_files[@]}"'
++ [[ ! -h /lib/systemd/system/sockets.target.wants/systemd-udevd-control.socket ]]
++ for m in '"${my_udev_files[@]}"'
++ [[ ! -h /lib/systemd/system/sockets.target.wants/systemd-udevd-kernel.socket ]]
++ for m in '"${my_udev_files[@]}"'
++ [[ ! -h /lib/systemd/system/sockets.target.wants/udev-control.socket ]]
++ [[ ! -h /usr/lib/systemd/system/sockets.target.wants/udev-control.socket ]]
++ rm -f /tmp/rear.Vd25lI6NQG7yU5K/rootfs/usr/lib/systemd/system/sockets.target.wants/udev-control.socket
++ for m in '"${my_udev_files[@]}"'
++ [[ ! -h /lib/systemd/system/sockets.target.wants/udev-kernel.socket ]]
++ [[ ! -h /usr/lib/systemd/system/sockets.target.wants/udev-kernel.socket ]]
++ rm -f /tmp/rear.Vd25lI6NQG7yU5K/rootfs/usr/lib/systemd/system/sockets.target.wants/udev-kernel.socket
</code></pre>
<h4 id="gdha_commented_at_2015-02-06_1322"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-73235326">2015-02-06 13:22</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-06_1322" title="Permanent link">&para;</a></h4>
<p>Did a test and now we have a sane CPU usage again! Fixed.</p>
<h4 id="gdha_commented_at_2015-02-23_1349"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/531#issuecomment-75543191">2015-02-23 13:49</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-23_1349" title="Permanent link">&para;</a></h4>
<p>added to the release notes so we can close this issue</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-01-20.531.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
