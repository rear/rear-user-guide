<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2655 PR merged: added grub bootloader for USB - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2655 PR merged: added grub bootloader for USB";
        var mkdocs_page_input_path = "issues/2021-07-12.2655.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2655 PR merged: added grub bootloader for USB</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2655_pr_merged_added_grub_bootloader_for_usb"><a href="https://github.com/rear/rear/pull/2655">#2655 PR</a> <code>merged</code>: added grub bootloader for USB<a class="headerlink" href="#2655_pr_merged_added_grub_bootloader_for_usb" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="devil0000_opened_issue_at_2021-07-12_1753"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> opened issue at <a href="https://github.com/rear/rear/pull/2655">2021-07-12 17:53</a>:<a class="headerlink" href="#devil0000_opened_issue_at_2021-07-12_1753" title="Permanent link">&para;</a></h4>
<ul>
<li>Type: <strong>New Feature</strong> / <strong>Enhancement</strong></li>
<li>Impact: <strong>Normal</strong></li>
<li>Reference to related issue (URL): partially #2648</li>
<li>How was this pull request tested?</li>
</ul>
<p>tested output usb with:</p>
<ol>
<li>USB_BOOTLOADER=</li>
<li>
<p>USB_BOOTLOADER=grub<br />
    on apu2 board (coreboot/seabios) - no efi</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    added option to write grub bootloader to usb (no efi)<br />
    it may not be perfect but a good starting point</p>
</li>
</ol>
<h4 id="jsmeix_commented_at_2021-07-14_0928"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-879742374">2021-07-14 09:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-14_0928" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
thank you for this very much missing enhancement!</p>
<p>I appreciate the new USB_BOOTLOADER config variable<br />
because - at least for me - it was an endless confusion<br />
what "install a bootloader" actually means in ReaR<br />
because in ReaR there are two separated bootloader install actions:</p>
<p>Installing the bootloader of the ReaR recovery system during "rear
mkrescue"<br />
versus<br />
(re)-installing the bootloader of the recreated system during "rear
recover".</p>
<p>With clearly named config variables like USB_BOOTLOADER<br />
it is now at least clear what bootloader will be used<br />
for the ReaR recovery system when it is made with OUTPUT=USB</p>
<h4 id="jsmeix_commented_at_2021-07-19_0725"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882309583">2021-07-19 07:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-19_0725" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
if you like and if you agree<br />
I could do my requested changes<br />
directly in your pull request code here.</p>
<h4 id="devil0000_commented_at_2021-07-19_0822"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882349825">2021-07-19 08:22</a>:<a class="headerlink" href="#devil0000_commented_at_2021-07-19_0822" title="Permanent link">&para;</a></h4>
<p>feel free to do changes.<br />
Do you need write access to the branch at PR source?</p>
<h4 id="jsmeix_commented_at_2021-07-19_0834"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882358303">2021-07-19 08:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-19_0834" title="Permanent link">&para;</a></h4>
<p>I have write access - this is why I asked you for permit.<br />
I have write access because the pull request sources<br />
are already within the ReaR upstream GitHub area,<br />
e.g. one of your commits has URL</p>
<pre><code>https://github.com/rear/rear/pull/2655/commits/249a977119251d0ce766aca7bf84514c301acca2
</code></pre>
<p>so the pull request sources already belong to<br />
<code>github.com/rear/rear</code> where I have write access.</p>
<h4 id="jsmeix_commented_at_2021-07-19_1121"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882469378">2021-07-19 11:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-19_1121" title="Permanent link">&para;</a></h4>
<p>Strange.<br />
I can no longer change pull request code via the GitHub web interface.<br />
I know I could do this in the past.</p>
<p>@rear/contributors<br />
if there are no objections I would like to merge it as is tomorrow
morning and<br />
then I will further adapt and enhance things via a subsequent pull
request from me.</p>
<p>Because USB_BOOTLOADER is a new config variable<br />
we are free to implement how it should behave.</p>
<p>Currently I am thinking about something like:</p>
<ul>
<li>USB_BOOTLOADER empty or unset (the default): Automatism what USB
    bootloader is used</li>
<li>USB_BOOTLOADER="extlinux": Enforce using syslinux/extlinux as USB
    bootloader</li>
<li>USB_BOOTLOADER="grub": Enforce using grub2 as USB bootloader</li>
<li>USB_BOOTLOADER="efi": Enforce EFI boot for USB</li>
</ul>
<p>This is currently only some offhanded idea...</p>
<h4 id="devil0000_commented_at_2021-07-19_1220"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882502849">2021-07-19 12:20</a>:<a class="headerlink" href="#devil0000_commented_at_2021-07-19_1220" title="Permanent link">&para;</a></h4>
<p>keep in mind that efi is not very specific - it may be used with
different bootloaders and efi payloads and so on.</p>
<h4 id="jsmeix_commented_at_2021-07-19_1236"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882512622">2021-07-19 12:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-19_1236" title="Permanent link">&para;</a></h4>
<p>Yes, I have had a look at
output/USB/Linux-i386/100_create_efiboot.sh<br />
and because of what I saw there I intentionally proposed the unspecific</p>
<ul>
<li>USB_BOOTLOADER="efi": Enforce EFI boot for USB</li>
</ul>
<p>to basically run output/USB/Linux-i386/100_create_efiboot.sh as is.</p>
<p>If needed we may later further enhance things like</p>
<ul>
<li>USB_BOOTLOADER="efi": Enforce EFI boot for USB (automatism what
    bootloader is used)</li>
<li>USB_BOOTLOADER="efi grub": Enforce EFI boot for USB with grub2 as
    bootloader</li>
<li>USB_BOOTLOADER="efi elilo": Enforce EFI boot for USB with elilo as
    bootloader</li>
</ul>
<h4 id="jsmeix_commented_at_2021-07-19_1301"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-882527521">2021-07-19 13:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-19_1301" title="Permanent link">&para;</a></h4>
<p>I think EFI boot setup and BIOS boot setup<br />
would normally exclude each other<br />
but I fail to see how<br />
output/USB/Linux-i386/100_create_efiboot.sh<br />
and<br />
output/USB/Linux-i386/300_create_extlinux.sh<br />
exclude each other.</p>
<p>What I can see is that output/USB/Linux-i386/100_create_efiboot.sh<br />
is only run when USING_UEFI_BOOTLOADER is true<br />
but I fail to see how output/USB/Linux-i386/300_create_extlinux.sh<br />
is not run when USING_UEFI_BOOTLOADER is true.</p>
<p>So - as far as I can currently see from plain looking at the code - it
seems<br />
output/USB/Linux-i386/300_create_extlinux.sh<br />
is run in any case - in particular also on systems with UEFI firmware.</p>
<p>I wonder if that makes sense?</p>
<h4 id="devil0000_commented_at_2021-07-20_0826"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-883203388">2021-07-20 08:26</a>:<a class="headerlink" href="#devil0000_commented_at_2021-07-20_0826" title="Permanent link">&para;</a></h4>
<p>I did not test or change that configuration combination / path in
software.</p>
<p>There may be good reasons for this. In case of elilo.efi it does not run
the grub config part in <code>100_create_efiboot.sh</code> what makes me believe
this case needs some syslinux/extlinux config then.<br />
Also there is still the option of creating a boot device which can boot
from legacy bios and efi method but I think thats not what was intended
here. I am however not familiar with this.</p>
<h4 id="jsmeix_commented_at_2021-07-20_1409"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-883424881">2021-07-20 14:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-20_1409" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
in your output/USB/Linux-i386/300_create_grub.sh there is</p>
<pre><code>USB_REAR_DIR="$BUILD_DIR/outputfs/$USB_PREFIX"
if [ ! -d "$USB_REAR_DIR" ]; then
    mkdir -p $v "$USB_REAR_DIR" &gt;/dev/null || Error "Could not create USB ReaR dir [$USB_REAR_DIR] !"
fi
</code></pre>
<p>but it seems USB_REAR_DIR is nowhere used<br />
so I would like to know why that directory is created there<br />
i.e. what the reason behind is why that directory is created?</p>
<p>USB_REAR_DIR also appears in
output/USB/Linux-i386/300_create_extlinux.sh<br />
but there it is used to write syslinux things there.</p>
<p>Is creating USB_REAR_DIR in
output/USB/Linux-i386/300_create_grub.sh<br />
perhaps only an obsolete leftover from some copy&amp;paste?</p>
<h4 id="devil0000_commented_at_2021-07-21_1110"><img src="https://avatars.githubusercontent.com/u/3344302?v=4" width="50"><a href="https://github.com/DEvil0000">DEvil0000</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-884106402">2021-07-21 11:10</a>:<a class="headerlink" href="#devil0000_commented_at_2021-07-21_1110" title="Permanent link">&para;</a></h4>
<p>Maybe the directory USB_REAR_DIR should be created elsewhere but it is
used to store the kernel and initrd later as well as parts of syslinux
config if syslinux is used. For one of the following scripts it needed
to exist.</p>
<h4 id="jsmeix_commented_at_2021-07-21_1244"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2655#issuecomment-884160426">2021-07-21 12:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-21_1244" title="Permanent link">&para;</a></h4>
<p>@DEvil0000<br />
thank you for the info!</p>
<p>What a mess that old USB related code is!<br />
The global looking variable USB_REAR_DIR is not used globally<br />
but the <code>$BUILD_DIR/outputfs/$USB_PREFIX</code> directory is needed<br />
so for now I at least explained things via<br />
<a href="https://github.com/rear/rear/pull/2659/commits/b20858a41d6a3d709bbfe34633915e9ac070223e">https://github.com/rear/rear/pull/2659/commits/b20858a41d6a3d709bbfe34633915e9ac070223e</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-07-12.2655.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
