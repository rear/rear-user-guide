<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2398 Issue closed: ReaR uses NFS4 with AIX mount - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2398 Issue closed: ReaR uses NFS4 with AIX mount";
        var mkdocs_page_input_path = "issues/2020-05-14.2398.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2398 Issue closed: ReaR uses NFS4 with AIX mount</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2398_issue_closed_rear_uses_nfs4_with_aix_mount"><a href="https://github.com/rear/rear/issues/2398">#2398 Issue</a> <code>closed</code>: ReaR uses NFS4 with AIX mount<a class="headerlink" href="#2398_issue_closed_rear_uses_nfs4_with_aix_mount" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="mahmoudrafat_opened_issue_at_2020-05-14_1317"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> opened issue at <a href="https://github.com/rear/rear/issues/2398">2020-05-14 13:17</a>:<a class="headerlink" href="#mahmoudrafat_opened_issue_at_2020-05-14_1317" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): 2.3</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    SUSE Linux Enterprise Server 12 SP3</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://IP/share
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://IP/share
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default 
BACKUP_PROG_INCLUDE=( '/var/lib/mysql/*' '/var/tmp/*' '/var/spool/*' '/var/lib/mailman/*' '/boot/grub2/powerpc-ieee1275/*' '/var/opt/*' '/var/cache/*' '/var/lib/machines/*' '/srv/*' '/var/lib/mariadb/*' '/tmp/*' '/var/lib/pgsql/*' '/opt/*' '/var/lib/libvirt/images/*' '/usr/local/*' '/var/log/*' '/var/lib/named/*' '/home/*' )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
EXCLUDE_MOUNTPOINTS=( '/MEG-sysbackup/*' '/run/user/*' '/sapmnt' '/usr/sap' )
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    SUSE on IBM power</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>I share a directory from AIX machine to use it as backup for ReaR,<br />
i can mount it using command</p>
<pre><code>mount -o vers=3 ip:/share /mount_point
</code></pre>
<p>but when i using ReaR it seems that it use NFS Version=4<br />
and produce error. like below.</p>
<p>The log file in /var/log/rear/xxx.log</p>
<pre><code>mkdir: created directory '/tmp/rear.rjbDv6M41RuA6rS/outputfs'
2020-05-14 16:16:38.263945559 Mounting with 'mount -v -t nfs -o rw,noatime IP:/share /tmp/rear.rjbDv6M41RuA6rS/outputfs'
mount.nfs: mount(2): Remote I/O error
mount.nfs: Remote I/O error
</code></pre>
<p>Can anyone help me?<br />
thanks..</p>
<h4 id="gozora_commented_at_2020-05-14_1321"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-628631177">2020-05-14 13:21</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-14_1321" title="Permanent link">&para;</a></h4>
<p>Hi @mahmoudrafat,</p>
<p>NFS version 4 is now Linux default, so it is not ReaR making trouble.<br />
Try to add <code>BACKUP_OPTIONS="nfsvers=3,nolock"</code> to your <em>local.conf</em>
(<em>site.conf</em>).</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-14_1324"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-628632642">2020-05-14 13:24</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-14_1324" title="Permanent link">&para;</a></h4>
<p>Hmm, now reading more carefully I see that you've already did that.</p>
<p>Can you provide full <em>/var/log/rear/rear.log</em>, so we can see what is
going on ?</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-05-14_1515"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-628702055">2020-05-14 15:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-14_1515" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat<br />
more precisely we need the full debug log, i.e. what you get<br />
with <code>rear -d -D mkrescue</code> or <code>rear -d -D mkbackup</code>, see also<br />
"Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Note that the full debug log may contain private information<br />
about your business environment like server names or<br />
even some real secrets so you may as a first step cut away<br />
what is not needed but what must stay is the full debug log<br />
of all parts that are related to mounting your AIX NFS share.</p>
<p>For comparison on my SLES12-SP5 x86_64 test system<br />
where I use this etc/rear/local.conf</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://192.168.122.1/nfs
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
PROGRESS_MODE=plain
PROGRESS_WAIT_SECONDS=3
KEEP_BUILD_DIR="yes"
FIRMWARE_FILES=( no )
</code></pre>
<p>what I get in the log for "rear -d -D mkrescue"</p>
<pre><code>+ source /root/rear.github.master/usr/share/rear/prep/NETFS/default/060_mount_NETFS_path.sh
...
++ mount_url nfs://192.168.122.1/nfs /tmp/rear.3EfnQShLll41m14/outputfs nfsvers=3,nolock
...
++ mount_cmd='mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs'
++ Log 'Mounting with '\''mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs'\'''
++ echo '2020-05-14 12:06:59.728550142 Mounting with '\''mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs'\'''
2020-05-14 12:06:59.728550142 Mounting with 'mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs'
++ eval mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs
+++ mount -v -t nfs -o nfsvers=3,nolock 192.168.122.1:/nfs /tmp/rear.3EfnQShLll41m14/outputfs
mount.nfs: trying 192.168.122.1 prog 100003 vers 3 prot TCP port 2049
mount.nfs: trying 192.168.122.1 prog 100005 vers 3 prot UDP port 20048
mount.nfs: timeout set for Thu May 14 12:08:59 2020
mount.nfs: trying text-based options 'nfsvers=3,nolock,addr=192.168.122.1'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: prog 100005, trying vers=3, prot=17
</code></pre>
<p>where mounting a NFS share works for me<br />
that is on an openSUSE Leap 15.1 NFS server.</p>
<h4 id="mahmoudrafat_commented_at_2020-05-14_1850"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-628823291">2020-05-14 18:50</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-14_1850" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/4729748/rear-test.log">rear-test.log</a></p>
<p>Hi, Thanks for your response,<br />
i attached the error part only because the log is too big more than 1000
page!!<br />
when i mount the shared directory with "mount -o nfsver=3 IP/share" it
is ok.<br />
may i change the rear mount command to use that command instead of mount
-v -t nfs -o rw,noatime" ?<br />
Note: that problem shows only when using AIX NFS server i did it when
using Redhat NFS server and it is ok.</p>
<h4 id="gozora_commented_at_2020-05-14_1858"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-628827395">2020-05-14 18:58</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-14_1858" title="Permanent link">&para;</a></h4>
<p>Hi @mahmoudrafat,</p>
<blockquote>
<p>i attached the error part only because the log is too big more than
1000 page!!</p>
</blockquote>
<p>You can attach files directly to this conversation by drag-n-drop, no
need to copy + paste file content.</p>
<blockquote>
<p>may i change the rear mount command to use that command instead of
mount -v -t nfs -o rw,noatime" ?</p>
</blockquote>
<p>You can, this right is granted to you by GPL ;-)</p>
<p>I'm just wondering why <code>BACKUP_OPTIONS</code> does not work for you, because
content of <code>BACKUP_OPTIONS</code> is normally passed to <code>mount</code> command by
ReaR, so I'd still like to see full output from <code>rear -d -D mkrescue</code> as
@jsmeix proposed in
<a href="https://github.com/rear/rear/issues/2398#issuecomment-628702055">https://github.com/rear/rear/issues/2398#issuecomment-628702055</a>.</p>
<p>V.</p>
<h4 id="mahmoudrafat_commented_at_2020-05-15_1328"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629235838">2020-05-15 13:28</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-15_1328" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/4729765/rear-test.log">rear-test.log</a></p>
<p>Hi, sorry for late due to time zone,<br />
I uploaded the log file for your review.</p>
<blockquote>
<p>You can, this right is granted to you by GPL ;-)</p>
</blockquote>
<p>Can you please explain how to do that?</p>
<p>Thanks.</p>
<h4 id="gozora_commented_at_2020-05-15_1352"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629248385">2020-05-15 13:52</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-15_1352" title="Permanent link">&para;</a></h4>
<p>Hmm, I always thought that if <code>OUTPUT_OPTIONS</code> is not explicitly set, it
somehow takes over content from <code>BACKUP_OPTIONS</code>, but this is only true
if following condition
<a href="https://github.com/rear/rear/blob/f6e9fbca381ffd7ba14cb3685c64ecad3f1b9585/usr/share/rear/prep/default/020_translate_url.sh#L47-L52">https://github.com/rear/rear/blob/f6e9fbca381ffd7ba14cb3685c64ecad3f1b9585/usr/share/rear/prep/default/020_translate_url.sh#L47-L52</a><br />
is matched.</p>
<p>@mahmoudrafat can you please add following line to your <em>local.conf</em> and
try to re-run <code>rear mkbackup</code></p>
<pre><code>OUTPUT_OPTIONS="nfsvers=3,nolock"
</code></pre>
<p>V.</p>
<h4 id="mahmoudrafat_commented_at_2020-05-15_2355"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629552970">2020-05-15 23:55</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-15_2355" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I did what you say and it make ISO image but the size is only 92M for
ISO and 166MB for tar file, that doesn't make sense because the used
space for the root is 22GB!<br />
Can you please tell me how to change mount option in rear
configuration?<br />
i need to test it with "mount -o nfsvers=3 " only</p>
<p><img alt="82104704-3dcbd800-9718-11ea-9370-20a2fc9b2a51" src="https://user-images.githubusercontent.com/34544193/83754739-c4673b80-a66c-11ea-8c03-09e139eeb3e3.png" /></p>
<p><img alt="82104703-3c9aab00-9718-11ea-80c3-afc3013c2e53" src="https://user-images.githubusercontent.com/34544193/83754744-c6c99580-a66c-11ea-8064-fe11e6e2a039.png" /></p>
<h4 id="schabrolles_commented_at_2020-05-16_0814"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629607734">2020-05-16 08:14</a>:<a class="headerlink" href="#schabrolles_commented_at_2020-05-16_0814" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat</p>
<p>I think you forget to add some specific option needed by Suse when BTRFS
and subvolume are used. Try to use the following as <code>local.conf</code></p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
OUPUT_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://192.168.122.1/nfs
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
PROGRESS_MODE=plain
PROGRESS_WAIT_SECONDS=3
KEEP_BUILD_DIR="yes"
FIRMWARE_FILES=( no )
REAR_INITRD_COMPRESSION=lzma

#SLES BTRFS specific
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )

for subvol in $(findmnt -n -r -t btrfs | cut -d ' ' -f 1 | grep -v '^/$' | egrep -v 'snapshots|crash') ; do
        BACKUP_PROG_INCLUDE=( "${BACKUP_PROG_INCLUDE[@]}" "$subvol" )
done

POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
</code></pre>
<h4 id="mahmoudrafat_commented_at_2020-05-17_1532"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629816484">2020-05-17 15:32</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-17_1532" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
I used the example from the docs and i don't think this is the problem
because i made it on VM machine with the same configuration.<br />
the problem with NFS share from AIX to SUSE.</p>
<h4 id="schabrolles_commented_at_2020-05-17_1557"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-629819794">2020-05-17 15:57</a>:<a class="headerlink" href="#schabrolles_commented_at_2020-05-17_1557" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat, compare to the one included into the doc I added
<code>OUPUT_OPTIONS="nfsvers=3,nolock"</code> (proposed by @gozora) ...</p>
<p>Although, did you apply the following command on the AIX machine ?</p>
<pre><code>nfso -po nfs_use_reserved_ports=1
nfso -po portcheck=1
</code></pre>
<h4 id="mahmoudrafat_commented_at_2020-05-18_1034"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-630096277">2020-05-18 10:34</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-18_1034" title="Permanent link">&para;</a></h4>
<p>@schabrolles, I did what @gozora Said and added
<code>OUPUT_OPTIONS="nfsvers=3,nolock"</code><br />
But it make an 150MB ISO only, see the previous comment.</p>
<blockquote>
<p>Although, did you apply the following command on the AIX machine ?</p>
</blockquote>
<p>I will check it.</p>
<h4 id="jsmeix_commented_at_2020-05-18_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-630169870">2020-05-18 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1306" title="Permanent link">&para;</a></h4>
<p>Now I see why</p>
<pre><code>OUTPUT_OPTIONS="nfsvers=3,nolock"
</code></pre>
<p>(it is <code>OUTPUT_OPTIONS</code> not <code>BACKUP_OPTIONS</code>)<br />
is needed when one has</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://IP/share
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://IP/share
</code></pre>
<p>i.e. when OUTPUT_URL is explicitly specified:</p>
<p>This is because prep/default/020_translate_url.sh contains</p>
<pre><code>if [[ -z "$OUTPUT_OPTIONS" ]] ; then
    if [[ -z "$OUTPUT_URL" &amp;&amp; -z "$OUTPUT_MOUNTCMD" ]] ; then
        ### There can be cases where it's intentionally empty.
        OUTPUT_OPTIONS=$BACKUP_OPTIONS
    fi
fi
</code></pre>
<p><a href="https://github.com/rear/rear/blob/master/usr/share/rear/prep/default/020_translate_url.sh#L48">https://github.com/rear/rear/blob/master/usr/share/rear/prep/default/020_translate_url.sh#L48</a><br />
so OUTPUT_OPTIONS inherits from BACKUP_OPTIONS<br />
only if OUTPUT_URL is not explicitly specified.</p>
<h4 id="jsmeix_commented_at_2020-05-18_1322"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-630179464">2020-05-18 13:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1322" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat<br />
to see what actually happens while the backup is made<br />
inspect your <code>backup.log</code> file.<br />
For debug information in the log file<br />
you must run rear with debug logging enabled<br />
like <code>rear -d -D mkrescue</code> or <code>rear -d -D mkbackup</code></p>
<h4 id="mahmoudrafat_commented_at_2020-05-20_0858"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-631340856">2020-05-20 08:58</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-05-20_0858" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
Ok i will try what you said and apply it after the holidays ends (we
have one week off).<br />
Many thanks.</p>
<h4 id="mahmoudrafat_commented_at_2020-06-04_1211"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-638808558">2020-06-04 12:11</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-06-04_1211" title="Permanent link">&para;</a></h4>
<p>Hi Again,<br />
Today i test the recover but it stuck at this point i don't know wheres
the problem is because small size of backup or something else, i
investigated the log file but didn't find anything wrong.<br />
does anyone face the same problem?<br />
@jsmeix</p>
<p><img alt="rear" src="https://user-images.githubusercontent.com/34544193/83755026-3a6ba280-a66d-11ea-80d8-34de8831e92c.png" /></p>
<h4 id="jsmeix_commented_at_2020-06-04_1310"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-638836932">2020-06-04 13:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-04_1310" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat<br />
at this point "rear recover" is about to recreate the disk storage
layout<br />
which happens before the backup of the files is restored<br />
so this new issue in your recent<br />
<a href="https://github.com/rear/rear/issues/2398#issuecomment-638808558">https://github.com/rear/rear/issues/2398#issuecomment-638808558</a><br />
has nothing to do with what is in the backup.</p>
<p>To get an initial basic understanding about<br />
your particular actual disk storage layout and<br />
what "rear mkrescue/mkbackup" finds out about it<br />
we need the output of</p>
<pre><code>lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>or if that is not possible on SLES12 the output of</p>
<pre><code>lsblk -io NAME,KNAME,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>or if that is also not possible at least the output of plain</p>
<pre><code>lsblk
</code></pre>
<p>and additionally we need your particular</p>
<pre><code>var/lib/rear/layout/disklayout.conf
</code></pre>
<p>file.</p>
<p>Because you use ReaR 2.3 which is meanwhile rather old<br />
(from our ReaR upstream developer's point of view) and<br />
because we at ReaR upstream do not support old ReaR releases<br />
I would seriously recommend to try out our current ReaR upstream<br />
GitHub master code from within a separated directory as a test<br />
to find out if things work better with our current ReaR upstream<br />
master code compared to your installed ReaR version,<br />
see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
how to do that.<br />
To run <code>git clone https://github.com/rear/rear.git</code> you need<br />
the RPM package <code>git-core</code> that provides <code>/usr/bin/git</code>.</p>
<h4 id="mahmoudrafat_commented_at_2020-06-10_0919"><img src="https://avatars.githubusercontent.com/u/34544193?v=4" width="50"><a href="https://github.com/mahmoudrafat">mahmoudrafat</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-641870112">2020-06-10 09:19</a>:<a class="headerlink" href="#mahmoudrafat_commented_at_2020-06-10_0919" title="Permanent link">&para;</a></h4>
<p>Thanks For your help, i made the backup and restore it without any
problem, here is the final config file for your attention.<br />
if there is no question you can close it.<br />
Thanks again for your great support.<br />
"/etc/rear/local.conf" file</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://IP/Share
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://IP/Share
OUTPUT_OPTIONS="nfsvers=3,nolock"
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default )
BACKUP_PROG_INCLUDE=( '/var/lib/mysql/*' '/var/tmp/*' '/var/spool/*' '/var/lib/mailman/*' '/boot/grub2/powerpc-ieee1275/*' '/var/opt/*' '/var/cache/*' '/var/lib/machines/*' '/srv/*' '/var/lib/mariadb/*' '/tmp/*' '/var/lib/pgsql/*' '/opt/*' '/var/lib/libvirt/images/*' '/usr/local/*' '/var/log/*' '/var/lib/named/*' '/home/*' )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
EXCLUDE_MOUNTPOINTS=( '/POint/*' )
EXCLUDE_VG=( 'VG_NAME' )
AUTOEXCLUDE_MULTIPATH=n
</code></pre>
<h4 id="jsmeix_commented_at_2020-06-15_0813"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2398#issuecomment-643975592">2020-06-15 08:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-15_0813" title="Permanent link">&para;</a></h4>
<p>@mahmoudrafat<br />
thank you for your feedeback that you got things working for your case<br />
and for your etc/rear/local.conf that shows how you made it working.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-14.2398.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
