<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1946 Issue closed: System won't boot after restore - symlink for /etc/mtab missing - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1946 Issue closed: System won\u0027t boot after restore - symlink for /etc/mtab missing";
        var mkdocs_page_input_path = "issues/2018-10-31.1946.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1946 Issue closed: System won't boot after restore - symlink for /etc/mtab missing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1946_issue_closed_system_wont_boot_after_restore_-_symlink_for_etcmtab_missing"><a href="https://github.com/rear/rear/issues/1946">#1946 Issue</a> <code>closed</code>: System won't boot after restore - symlink for /etc/mtab missing<a class="headerlink" href="#1946_issue_closed_system_wont_boot_after_restore_-_symlink_for_etcmtab_missing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>won't fix / can't fix / obsolete</code>,
<code>not ReaR / invalid</code></p>
<h4 id="jonathankeuser_opened_issue_at_2018-10-31_1052"><img src="https://avatars.githubusercontent.com/u/7705180?v=4" width="50"><a href="https://github.com/jonathankeuser">jonathankeuser</a> opened issue at <a href="https://github.com/rear/rear/issues/1946">2018-10-31 10:52</a>:<a class="headerlink" href="#jonathankeuser_opened_issue_at_2018-10-31_1052" title="Permanent link">&para;</a></h4>
<p>I'm using rear-2.4-1 on RHEL7.4:<br />
After a system restore my server won't boot anymore.</p>
<p>The reason for this is the following:<br />
On RHEL7-Systems - also CentOS - the file "/etc/mtab" is a symlink to
"/proc/self/mount". At a restore this file will not be created, empty
created or with an unusable content created. So my server will hang up
while booting:<br />
<code>[FAILED] Failed to mount /. See 'systemctl status -.mount' for details.</code></p>
<p>After booting the rescue image again, create the symlink for /etc/mtab
and boot the OS again, my server will boot successfully.</p>
<h4 id="jsmeix_commented_at_2018-10-31_1109"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434647524">2018-10-31 11:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-10-31_1109" title="Permanent link">&para;</a></h4>
<p>See<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/.github/ISSUE_TEMPLATE.md">https://raw.githubusercontent.com/rear/rear/master/.github/ISSUE_TEMPLATE.md</a></p>
<p>How things get restored depends on what you have in your backup,<br />
cf. "Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Perhaps BACKUP_RESTORE_MOVE_AWAY_FILES<br />
or POST_RECOVERY_SCRIPT may help in your particular<br />
case, see usr/share/rear/conf/default.conf</p>
<h4 id="gdha_commented_at_2018-10-31_1116"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434649350">2018-10-31 11:16</a>:<a class="headerlink" href="#gdha_commented_at_2018-10-31_1116" title="Permanent link">&para;</a></h4>
<p>@jonathankeuser Did you check your rear log file for something like:<br />
<code>'/tmp/rear.g7ZIwz3UWiFCXP1/rootfs/etc/mtab' -&gt; '/proc/self/mounts'</code>?<br />
I never had issues with RHEL 7 (or CenOS 7) so far with this.</p>
<h4 id="gdha_commented_at_2018-10-31_1221"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434666413">2018-10-31 12:21</a>:<a class="headerlink" href="#gdha_commented_at_2018-10-31_1221" title="Permanent link">&para;</a></h4>
<p>Is related to #1734</p>
<h4 id="jonathankeuser_commented_at_2018-10-31_1251"><img src="https://avatars.githubusercontent.com/u/7705180?v=4" width="50"><a href="https://github.com/jonathankeuser">jonathankeuser</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434674774">2018-10-31 12:51</a>:<a class="headerlink" href="#jonathankeuser_commented_at_2018-10-31_1251" title="Permanent link">&para;</a></h4>
<p>@jsmeix I created a workaroud using POST_RECOVERY_SCRIPT. The variable
BACKUP_RESTORE_MOVE_AWAY_FILES is empty. So it has no effect on this
behavior.</p>
<p>@gdha In the rear log file i found something like</p>
<blockquote>
<p>'/tmp/rear.g7ZIwz3UWiFCXP1/rootfs/etc/mtab' -&gt; '/proc/self/mounts'</p>
</blockquote>
<p>This link is also included in backup.tar.gz, but at a recover it is not
created. Also in the rear recovery log located at /var/lib/rear/restore/
is no entry to find.</p>
<h4 id="jsmeix_commented_at_2018-10-31_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434678737">2018-10-31 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-10-31_1304" title="Permanent link">&para;</a></h4>
<p>@jonathankeuser<br />
FYI what I have in my 'backup.tar.gz' and on my original system:</p>
<pre>
# tar -tvf backup.tar.gz | grep etc/mtab
lrwxrwxrwx root/root  0 2018-09-13 09:42 etc/mtab -> ../proc/self/mounts

# file /etc/mtab
/etc/mtab: symbolic link to ../proc/self/mounts
</pre>

<p>@gdha<br />
I do not understand how /etc/mtab in the recovery system is related<br />
to etc/mtab in the restored system (which is /mnt/local/etc/mtab in the
recovery system)<br />
at least I do not see a relationship in the code.</p>
<h4 id="gdha_commented_at_2018-10-31_1322"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434684199">2018-10-31 13:22</a>:<a class="headerlink" href="#gdha_commented_at_2018-10-31_1322" title="Permanent link">&para;</a></h4>
<p>@jsmeix We should not worry about ROOTFS/etc/mtab as it supposed to be a
symbolic link to <code>/proc/self/mounts</code> on RHEL 7.</p>
<p>On RHEL 5 anf 6: <code>/etc/mtab</code> is the file that mount and umount maintains
for a list of currently mounted filesystems. While, <code>/proc/mounts</code> is
the kernel's view of the mount.<br />
<code>/proc/mounts</code> is currently a link to <code>/proc/self/mounts</code> which lists
mount points of the processes's mount namespace. The VFS is responsible
to add to this file VFS options found in binary flags interface of each
filesystem, but, any specific filesystem option should be added by the
filesystem code using the superblock method show_options()</p>
<p>On RHEL7, various command and libraries have been updated to use
libmount to read mount information and <code>/etc/mtab</code> is now a symbolic
link to <code>/proc/self/mounts</code></p>
<p>Info pasted from
<a href="https://access.redhat.com/solutions/65949">https://access.redhat.com/solutions/65949</a></p>
<h4 id="jonathankeuser_commented_at_2018-10-31_1342"><img src="https://avatars.githubusercontent.com/u/7705180?v=4" width="50"><a href="https://github.com/jonathankeuser">jonathankeuser</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434691605">2018-10-31 13:42</a>:<a class="headerlink" href="#jonathankeuser_commented_at_2018-10-31_1342" title="Permanent link">&para;</a></h4>
<p>@jsmeix Sorry, I expressed myself a little bit incomprehensible:</p>
<blockquote>
<p>After booting the rescue image again, create the symlink for /etc/mtab
and boot the OS again, my server will boot successfully.</p>
</blockquote>
<p>I did not mean the /etc/mtab of the recovery system, but the mtab of the
system being restored which is located at /mnt/local/etc/mtab.</p>
<blockquote>
<p>FYI what I have in my 'backup.tar.gz' and on my original system:<br />
'# tar -tvf backup.tar.gz | grep etc/mtab<br />
lrwxrwxrwx root/root 0 2018-09-13 09:42 etc/mtab -&gt;
../proc/self/mounts'<br />
'# file /etc/mtab<br />
/etc/mtab: symbolic link to ../proc/self/mounts'</p>
</blockquote>
<p>That's about what I find in my original system, as described above.</p>
<h4 id="jsmeix_commented_at_2018-10-31_1348"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434693414">2018-10-31 13:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-10-31_1348" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I know about /etc/mtab which was traditionally a file<br />
versus a symbolic link on nowadays systems.<br />
My question was because your<br />
<a href="https://github.com/rear/rear/issues/1946#issuecomment-434649350">https://github.com/rear/rear/issues/1946#issuecomment-434649350</a><br />
is about etc/mtab in the recovery system<br />
while @jonathankeuser issue here (if I understand it correctly)<br />
is about the restored etc/mtab in the recreated system.</p>
<p>@jonathankeuser<br />
I did a "rear recover" (but I run SLES12) and for me etc/mtab gets
correctly<br />
restored and is still correct on the rebooted recreated system
(excerpts):</p>
<pre>
RESCUE d67:~ # export MIGRATION_MODE=1

RESCUE d67:~ # rear -D recover
Relax-and-Recover 2.4 / Git
Running rear recover (PID 1234)
...
Restoring from '/tmp/rear.IoLcmPctGOwFZtD/outputfs/d67/backup.tar.gz' (restore log in /var/lib/rear/restore/recover.backup.tar.gz.1234.restore.log) ...
...
Confirm restored config files or edit them
1) Confirm it is OK to recreate initrd and reinstall bootloader and continue 'rear recover'
2) Edit restored etc/fstab (/mnt/local/etc/fstab)
3) View restored etc/fstab (/mnt/local/etc/fstab)
4) Use Relax-and-Recover shell and return back to here
5) Abort 'rear recover'
(default '1' timeout 300 seconds)
4
...
rear> grep etc/mtab /var/lib/rear/restore/recover.backup.tar.gz.1234.restore.log
block 132653: etc/mtab
rear> ls -l /mnt/local/etc/mtab 
lrwxrwxrwx 1 root root 19 Sep 27 09:40 /mnt/local/etc/mtab -> ../proc/self/mounts
rear> exit
...
Finished recovering your system. You can explore it under '/mnt/local'.

RESCUE d67:~ # ls -l /mnt/local/etc/mtab 
lrwxrwxrwx 1 root root 19 Sep 27 09:40 /mnt/local/etc/mtab -> ../proc/self/mounts

RESCUE d67:~ # reboot

f186:~ # ls -l /etc/mtab
lrwxrwxrwx 1 root root 19 Sep 27 11:40 /etc/mtab -> ../proc/self/mounts
</pre>

<h4 id="gdha_commented_at_2018-10-31_1357"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434696513">2018-10-31 13:57</a>:<a class="headerlink" href="#gdha_commented_at_2018-10-31_1357" title="Permanent link">&para;</a></h4>
<p>@jsmeix The restoration of <code>/etc/mtab</code> is not the issue here, seems that
the symbolic link itself is not restored. However, I always thought that
everything under <code>/proc</code> file system is under control of the linux
kernel itself. Seems to be proven wrong?</p>
<h4 id="jsmeix_commented_at_2018-10-31_1614"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-434749940">2018-10-31 16:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-10-31_1614" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I am afraid - in this issue I do somehow not understand you.</p>
<p>I would think restoration of /etc/mtab means that the symbolic link
itself is restored?</p>
<p>Cf.
<a href="https://github.com/rear/rear/issues/1946#issuecomment-434674774">https://github.com/rear/rear/issues/1946#issuecomment-434674774</a><br />
<code>This link is also included in backup.tar.gz, but at a recover it is not created.</code></p>
<p>I.e. somehow for @jonathankeuser the link is in his 'tar' backup<br />
but it does not get restored (in contrast to what happens on my system).</p>
<p>Because we had in the past already some weird issues with 'tar' on
RHEL<br />
I guess this one could be perhaps another one of those kind of issues?</p>
<h4 id="gdha_commented_at_2018-11-05_1539"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-435920549">2018-11-05 15:39</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-05_1539" title="Permanent link">&para;</a></h4>
<p>I've performed a test on CentOS 7.5 with BACKUP=NETFS and <code>tar</code>. The tar
archive contained the following after grepping on:</p>
<pre><code># tar ztf backup.tar.gz  | grep -E '(mtab|mounts)'
etc/mtab
usr/share/man/man8/mountstats.8.gz
usr/lib/python2.7/site-packages/tuned/plugins/plugin_mounts.py
usr/lib/python2.7/site-packages/tuned/plugins/plugin_mounts.pyo
usr/lib/python2.7/site-packages/tuned/plugins/plugin_mounts.pyc
usr/sbin/mountstats
usr/lib64/python2.7/symtable.pyc
usr/lib64/python2.7/symtable.pyo
usr/lib64/python2.7/symtable.py
var/lib/nfs/rmtab
</code></pre>
<p>After doing a <strong>recovery</strong> test I still have:</p>
<pre><code>[root@client ~]# ls -l /etc/mtab /proc/self/mounts
lrwxrwxrwx. 1 root root 17 Sep 30 21:58 /etc/mtab -&gt; /proc/self/mounts
-r--r--r--. 1 root root  0 Nov  5 16:22 /proc/self/mounts
</code></pre>
<p>So far, nothing has changed for me (before and after the modification
done at <code>build/default/985_fix_broken_links.sh</code>)</p>
<h4 id="jsmeix_commented_at_2019-04-26_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1946#issuecomment-487047415">2019-04-26 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-26_1258" title="Permanent link">&para;</a></h4>
<p>Because we can neither reproduce nor imagine what goes actually wrong<br />
and because we had in the past already some weird issues with 'tar' on
RHEL<br />
I assume this one is another one of those kind of issues.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-10-31.1946.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
