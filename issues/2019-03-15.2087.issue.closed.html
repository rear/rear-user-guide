<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2087 Issue closed: "rear mkrescue" fails for mmcblk0boot0/mmcblk0rpmb partitions (mmcblk/eMMC disk type) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2087 Issue closed: \"rear mkrescue\" fails for mmcblk0boot0/mmcblk0rpmb partitions (mmcblk/eMMC disk type)";
        var mkdocs_page_input_path = "issues/2019-03-15.2087.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2087 Issue closed: "rear mkrescue" fails for mmcblk0boot0/mmcblk0rpmb partitions (mmcblk/eMMC disk type)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2087_issue_closed_rear_mkrescue_fails_for_mmcblk0boot0mmcblk0rpmb_partitions_mmcblkemmc_disk_type"><a href="https://github.com/rear/rear/issues/2087">#2087 Issue</a> <code>closed</code>: "rear mkrescue" fails for mmcblk0boot0/mmcblk0rpmb partitions (mmcblk/eMMC disk type)<a class="headerlink" href="#2087_issue_closed_rear_mkrescue_fails_for_mmcblk0boot0mmcblk0rpmb_partitions_mmcblkemmc_disk_type" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>,
<code>special hardware or VM</code></p>
<h4 id="fabz5_opened_issue_at_2019-03-15_1631"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> opened issue at <a href="https://github.com/rear/rear/issues/2087">2019-03-15 16:31</a>:<a class="headerlink" href="#fabz5_opened_issue_at_2019-03-15_1631" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4 / 2018-06-21</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    Distributor ID: Debian<br />
    Description: Debian GNU/Linux 9.8 (stretch)<br />
    Release: 9.8<br />
    Codename: stretch</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<p>/etc/rear/site.conf contains:</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://mynfsserver/backupdir
BACKUP=NETFS
BACKUP_URL=nfs://mynfsserver/backupdir
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PC (Minis Forum Z83-F)</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86-64 (amd64)</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI, GRUB (2.02~beta3-5+deb9u1)</p>
</li>
<li>
<p>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk (eMMC)</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    Running "rear -Dv mkbackup" fails with the following output:</p>
</li>
</ul>
<!-- -->

<pre><code>Relax-and-Recover 2.4 / 2018-06-21
Using log file: /var/log/rear/rear-testvm02.log
Using backup archive '/tmp/rear.a0gtr0AbNoYvAgO/outputfs/testvm02/backup.tar.gz'
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Creating disk layout
ERROR: Partition number '0' of partition mmcblk0boot0 is not a valid number.
ERROR: Partition number '' of partition mmcblk0rpmb is not a valid number.
ERROR: Partition mmcblk0rpmb is numbered ''. More than 128 partitions is not supported.
Aborting due to an error, check /var/log/rear/rear-testvm02.log for details
Exiting rear mkbackup (PID 15126) and its descendant processes
Running exit tasks
You should also rm -Rf /tmp/rear.a0gtr0AbNoYvAgO
zsh: terminated  rear -Dv mkbackup
</code></pre>
<ul>
<li>Workaround, if any:</li>
</ul>
<p>None found</p>
<ul>
<li>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):<br />
    I attached the /var/log/rear/rear-testvm02.log logfile. Do not get
    confused by the hostname, this is NOT a VM. :-)<br />
<a href="https://github.com/rear/rear/files/2972012/rear-testvm02.log">rear-testvm02.log</a></li>
</ul>
<h4 id="jsmeix_commented_at_2019-03-18_0909"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473826693">2019-03-18 09:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-18_0909" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
what is the output of the command</p>
<pre><code>lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
</code></pre>
<p>on your original system?</p>
<p>In your particular case you have /dev/mmcblk0boot0<br />
and that special kind of device node name<br />
can currently not be handled properly by ReaR.</p>
<p>My current analysis:</p>
<p>In your case it fails in
usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh<br />
therein when it calls the get_partition_number() function as</p>
<pre><code>get_partition_number mmcblk0boot0
</code></pre>
<p>The get_partition_number() function calls in your particular case</p>
<pre><code>echo "mmcblk0boot0" | grep -o -E "[0-9]+$"
</code></pre>
<p>to get the partition number which results in your case the trailing
<code>0</code><br />
but <code>0</code> is not a normally valid partition number, see the
get_partition_number<br />
function code in usr/share/rear/lib/layout-functions.sh<br />
for what kind of device node names it can deal with:</p>
<pre><code># Function returns partition number of partition block device name
#
# This function should support:
#   /dev/mapper/36001438005deb05d0000e00005c40000p1
#   /dev/mapper/36001438005deb05d0000e00005c40000_part1
#   /dev/sda1
#   /dev/cciss/c0d0p1
#
# Requires: grep v2.5 or higher (option -o)

get_partition_number() {
    local partition=$1
    local number=$(echo "$partition" | grep -o -E "[0-9]+$")

    # Test if $number is a positive integer, if not it is a bug
    [ $number -gt 0 ] 2&gt;/dev/null
    StopIfError "Partition number '$number' of partition $partition is not a valid number."

    # Catch if $number is too big, report it as a bug
    (( $number &lt;= 128 ))
    StopIfError "Partition $partition is numbered '$number'. More than 128 partitions is not supported."

    echo $number
}
</code></pre>
<p>This are the excerpts from your<br />
<a href="https://github.com/rear/rear/files/2972012/rear-testvm02.log">https://github.com/rear/rear/files/2972012/rear-testvm02.log</a><br />
that show what I described above:</p>
<pre><code>+++ for device in /dev/mapper/*
++++ dmsetup info -c --noheadings -o major,minor system-var
+++ mapper_number=254:1
+++ '[' 179:256 = 254:1 ']'
+++ [[ mmcblk0boot0 =~ ^mapper/ ]]
++++ readlink /dev/mmcblk0boot0
+++ my_dm=
+++ name=mmcblk0boot0
+++ echo /dev/mmcblk0boot0
+++ return 1
++ partition_name=/dev/mmcblk0boot0
++ partition_name=mmcblk0boot0
++ partition_name=mmcblk0boot0
+++ get_partition_number mmcblk0boot0
+++ local partition=mmcblk0boot0
++++ echo mmcblk0boot0
++++ grep -o -E '[0-9]+$'
+++ local number=0
+++ '[' 0 -gt 0 ']'
+++ StopIfError 'Partition number '\''0'\'' of partition mmcblk0boot0 is not a valid number.'
+++ ((  1 != 0  ))
+++ Error 'Partition number '\''0'\'' of partition mmcblk0boot0 is not a valid number.'
</code></pre>
<h4 id="jsmeix_commented_at_2019-03-18_0924"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473831802">2019-03-18 09:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-18_0924" title="Permanent link">&para;</a></h4>
<p><a href="http://relax-and-recover.org/documentation/release-notes-2-4">http://relax-and-recover.org/documentation/release-notes-2-4</a>
reads</p>
<pre><code>Version 2.1 (June 2017)
...
mmcblk disk types are now supported (issues #1301, #1302)
</code></pre>
<p>which points to<br />
<a href="https://github.com/rear/rear/issues/1301">https://github.com/rear/rear/issues/1301</a><br />
and<br />
<a href="https://github.com/rear/rear/pull/1302">https://github.com/rear/rear/pull/1302</a><br />
but it seems mmcblk disk types are currently not yet fully supported...</p>
<h4 id="fabz5_commented_at_2019-03-18_1022"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473851770">2019-03-18 10:22</a>:<a class="headerlink" href="#fabz5_commented_at_2019-03-18_1022" title="Permanent link">&para;</a></h4>
<p>I also found #1682, which seems related, but obviously does not help
with this issue.</p>
<p>Anyhow, calling<br />
<code>lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT</code><br />
gives:</p>
<pre><code>NAME                           KNAME             PKNAME         TRAN TYPE FSTYPE       SIZE MOUNTPOINT
/dev/mmcblk0                   /dev/mmcblk0                          disk             58.2G 
|-/dev/mmcblk0p1               /dev/mmcblk0p1    /dev/mmcblk0        part vfat         190M /boot/efi
 -/dev/mmcblk0p2               /dev/mmcblk0p2    /dev/mmcblk0        part LVM2_member 58.1G 
    |-/dev/mapper/system-root  /dev/dm-0         /dev/mmcblk0p2      lvm  ext4         1.9G /
    |-/dev/mapper/system-var   /dev/dm-1         /dev/mmcblk0p2      lvm  ext4         1.9G /var
    |-/dev/mapper/system-tmp   /dev/dm-2         /dev/mmcblk0p2      lvm  ext4         976M /tmp
    |-/dev/mapper/system-swap  /dev/dm-3         /dev/mmcblk0p2      lvm  swap         976M [SWAP]
     -/dev/mapper/system-spare /dev/dm-4         /dev/mmcblk0p2      lvm              52.3G 
/dev/mmcblk0boot0              /dev/mmcblk0boot0                     disk                4M 
/dev/mmcblk0boot1              /dev/mmcblk0boot1                     disk                4M 
/dev/mmcblk0rpmb               /dev/mmcblk0rpmb                      disk                4M
</code></pre>
<p>Thanks already for your efforts!</p>
<h4 id="jsmeix_commented_at_2019-03-18_1115"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473868951">2019-03-18 11:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-18_1115" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
I detected the totally different issuse<br />
<a href="https://github.com/rear/rear/pull/2088">https://github.com/rear/rear/pull/2088</a><br />
when I noticed in your<br />
<a href="https://github.com/rear/rear/issues/2087#issue-421604286">https://github.com/rear/rear/issues/2087#issue-421604286</a></p>
<pre><code>ERROR: Partition number '0' of partition mmcblk0boot0 is not a valid number.
ERROR: Partition number '' of partition mmcblk0rpmb is not a valid number.
ERROR: Partition mmcblk0rpmb is numbered ''. More than 128 partitions is not supported.
Aborting due to an error, check /var/log/rear/rear-testvm02.log for details
</code></pre>
<p>the triple <code>ERROR:</code>messages which is plain wrong.<br />
It should cleanly abort at the first error.</p>
<p>Because I cannot reproduce such a multiple <code>ERROR:</code>message<br />
I would like if you coud try out if my proposed fix in<br />
<a href="https://github.com/rear/rear/pull/2088">https://github.com/rear/rear/pull/2088</a><br />
helps in your case.</p>
<p>To do that edit in your usr/share/rear/lib/_input-output-functions.sh<br />
the Error function:<br />
Insert a <code>sleep 1</code> at its very end so that it becomes this</p>
<pre><code>function Error () {

    ...

    kill -USR1 $MASTER_PID
    sleep 1
}
</code></pre>
<p>Then re-run <code>rear -Dv mkbackup</code> and now it should error out with</p>
<pre><code>ERROR: Partition number '0' of partition mmcblk0boot0 is not a valid number.
Aborting due to an error, check /var/log/rear/rear-testvm02.log for details
</code></pre>
<h4 id="fabz5_commented_at_2019-03-18_1209"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473884096">2019-03-18 12:09</a>:<a class="headerlink" href="#fabz5_commented_at_2019-03-18_1209" title="Permanent link">&para;</a></h4>
<p>I edited the Error function as advised, but to no avail. The 3 error
messages remain. To make sure everything goes as expected I also a added
another line:</p>
<pre><code>     ...
     kill -USR1 $MASTER_PID
     LogPrintError "sleeping for 1 second"
     sleep 1
}
</code></pre>
<p>which results in:</p>
<pre><code>zsh 166 # rear -Dv mkbackup                                
Relax-and-Recover 2.4 / 2018-06-21
Using log file: /var/log/rear/rear-testvm02.log
Using backup archive '/tmp/rear.sONFeWwU2OmFyV2/outputfs/testvm02/backup.tar.gz'
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Creating disk layout
ERROR: Partition number '0' of partition mmcblk0boot0 is not a valid number.
sleeping for 1 second
ERROR: Partition number '' of partition mmcblk0rpmb is not a valid number.
sleeping for 1 second
ERROR: Partition mmcblk0rpmb is numbered ''. More than 128 partitions is not supported.
sleeping for 1 second
Aborting due to an error, check /var/log/rear/rear-testvm02.log for details
Exiting rear mkbackup (PID 8097) and its descendant processes
Running exit tasks
You should also rm -Rf /tmp/rear.sONFeWwU2OmFyV2
zsh: terminated  rear -Dv mkbackup
</code></pre>
<h4 id="jsmeix_commented_at_2019-03-18_1254"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-473897785">2019-03-18 12:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-18_1254" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
thank you so much for your prompt<br />
<a href="https://github.com/rear/rear/issues/2087#issuecomment-473884096">https://github.com/rear/rear/issues/2087#issuecomment-473884096</a><br />
I think that shows there is another bug in ReaR<br />
<a href="https://github.com/rear/rear/issues/2089">https://github.com/rear/rear/issues/2089</a></p>
<p>Regarding this issue here, i.e. regarding mmcblk/eMMC disks:</p>
<p>I myself never had nor do I have any mmcblk/eMMC disk device<br />
so that I cannot reproduce issues with it or actually help in this area.</p>
<p>Perhaps you could enhance ReaR to support mmcblk/eMMC disks<br />
as far as you need it for your particular use case?</p>
<p>Cf. "How to adapt and enhance Relax-and-Recover" and related scections
in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="fabz5_commented_at_2019-03-19_1034"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-474295672">2019-03-19 10:34</a>:<a class="headerlink" href="#fabz5_commented_at_2019-03-19_1034" title="Permanent link">&para;</a></h4>
<p>I'll see what I can do. :-)</p>
<h4 id="jsmeix_commented_at_2019-03-19_1329"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-474368999">2019-03-19 13:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-19_1329" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
I look forward to your GitHub pull request.</p>
<p>Regardless that I do not have any mmcblk/eMMC disk device<br />
I could help you - to some extent - with general coding stuff in ReaR.<br />
To avoid that you do much coding work on your own and then<br />
we will tell you about a lot of things that you should have done
differently<br />
I would recommend that you do a GitHub pull request as soon as
possible<br />
for you (i.e. when you have some very first step that works a bit for
you)<br />
so that we can check early if changes are needed.</p>
<p>In general:</p>
<p>Submit early and submit often, cf. Wikipedia:Release early, release
often<br />
<a href="http://www.wikipedia.org/wiki/Release_early,_release_often">http://www.wikipedia.org/wiki/Release_early,_release_often</a><br />
Do not mix up several independent separated issues in one big
all-in-one<br />
GitHub pull request because a pull request cannot be partially
accepted.<br />
On the other hand do not split several changes that belong to each
other<br />
into several pull requests.</p>
<p>See "Contributing" at<br />
<a href="http://relax-and-recover.org/development/">http://relax-and-recover.org/development/</a></p>
<p>See in particular<br />
"Keeping your forked repo synced with the upstream source" at<br />
<a href="https://2buntu.com/articles/1459/keeping-your-forked-repo-synced-with-the-upstream-source/">https://2buntu.com/articles/1459/keeping-your-forked-repo-synced-with-the-upstream-source/</a><br />
for an illustrated guide how to work with GitHub in general.<br />
The images therein might be a bit outdated but the general information<br />
how to work with GitHub should still apply.</p>
<h4 id="jsmeix_commented_at_2019-03-21_0803"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-475140045">2019-03-21 08:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-21_0803" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
is this issue soved for you since your
<a href="https://github.com/rear/rear/pull/2091">https://github.com/rear/rear/pull/2091</a><br />
is merged?</p>
<p>I.e. does now run "rear mkrescue/mkbackup" run for you without an
error<br />
or are there more adaptions and enhancements needed in ReaR<br />
to get mmcblk/eMMC disk devices supported in general<br />
or at least for your particular use case?</p>
<h4 id="jsmeix_commented_at_2019-03-21_0807"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-475140739">2019-03-21 08:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-21_0807" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
how you could try out our current ReaR GitHub master code<br />
where
<a href="https://github.com/rear/rear/pull/2091">https://github.com/rear/rear/pull/2091</a>
is merged:</p>
<p>Basically "git clone" our current ReaR upstream GitHub master code<br />
into a separated directory and then configure and run ReaR<br />
from within that directory like:</p>
<pre><code># git clone https://github.com/rear/rear.git

# mv rear rear.github.master

# cd rear.github.master

# vi etc/rear/local.conf

# usr/sbin/rear -D mkbackup
</code></pre>
<p>Note the relative paths "etc/rear/" and "usr/sbin/".</p>
<h4 id="fabz5_commented_at_2019-03-21_0849"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-475150370">2019-03-21 08:49</a>:<a class="headerlink" href="#fabz5_commented_at_2019-03-21_0849" title="Permanent link">&para;</a></h4>
<p>The issue is solved, at least concerning mkbackup. Thus it can be
closed.<br />
However there is still trouble with the restore in ReaR 2.4 (efibootmgr
is called with a wrong disk name). I will try out the current ReaR
master to see if this issue persists (from looking at the code, I guess
so). If I am right, I will open another issue.</p>
<p>Thanks a lot! :-)</p>
<h4 id="jsmeix_commented_at_2019-03-21_0903"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-475154239">2019-03-21 09:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-21_0903" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
thank your for your confirmation that this particular issue is solved.</p>
<p>When "rear recover" fails provide its debug log file as described<br />
in the section "Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2019-03-22_1451"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-475650821">2019-03-22 14:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-22_1451" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
I have a question about what a "eMMC" device actually is.</p>
<p>From your 'lsblk' output in<br />
<a href="https://github.com/rear/rear/issues/2087#issuecomment-473851770">https://github.com/rear/rear/issues/2087#issuecomment-473851770</a><br />
and your description in<br />
<a href="https://github.com/rear/rear/pull/2091#issue-262630887">https://github.com/rear/rear/pull/2091#issue-262630887</a><br />
I assume that at least your "eMMC" device is not one single disk<br />
but actually your "eMMC" device consists of four <code>disk</code> type block
devices:</p>
<pre><code>NAME               KNAME             PKNAME TRAN TYPE FSTYPE  SIZE 
/dev/mmcblk0       /dev/mmcblk0                  disk        58.2G 
/dev/mmcblk0boot0  /dev/mmcblk0boot0             disk           4M 
/dev/mmcblk0boot1  /dev/mmcblk0boot1             disk           4M 
/dev/mmcblk0rpmb   /dev/mmcblk0rpmb              disk           4M
</code></pre>
<p>where only the <code>/dev/mmcblk0</code> disk is what is of interest for ReaR.</p>
<p>Is my assumtion true?</p>
<p>If yes, it seems what is missing in ReaR is a generic method<br />
where the user can explicitly specify to exclude unwanted<br />
whole disks during "rear mkrescue".</p>
<p>It seems currently there is only a generic method in ReaR<br />
how to exclude unwanted components during "rear recover",<br />
see the section "Including/Excluding components" at<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<p>FYI:<br />
Because of
<a href="https://github.com/rear/rear/issues/1771">https://github.com/rear/rear/issues/1771</a><br />
it is currently not possible to exclude less than a whole disk<br />
(e.g. only certain partitions or filesystems on a disk).</p>
<h4 id="fabz5_commented_at_2019-03-27_2049"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-477341689">2019-03-27 20:49</a>:<a class="headerlink" href="#fabz5_commented_at_2019-03-27_2049" title="Permanent link">&para;</a></h4>
<p>Your assumption is true. However please note, that the "eMMC" is not
only recognised as four block devices, but that also the special
partitions "mmcblk0boot0/1, mmcblk0rpmb" are recognised as partitions ON
/dev/mmcblk0. They have the same names as the three additional disk type
block devices. In this particular case the exclusion of the three
special disk devices would not have been sufficient (they were already
excluded anyhow by
<a href="https://github.com/rear/rear/pull/1682">https://github.com/rear/rear/pull/1682</a>).</p>
<p>In general however the possibility to exclude entire disks from
mkrescue/mkbackup would be great.</p>
<h4 id="jsmeix_commented_at_2019-03-28_1110"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-477551079">2019-03-28 11:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-28_1110" title="Permanent link">&para;</a></h4>
<p>@fabz5<br />
thank you so much for your explanation.</p>
<p>As far as I understand it now there are not two different kind<br />
of <code>mmcblk*boot*</code> and <code>mmcblk*rpmb</code> thingies - the only ones<br />
that exist are the <code>disk</code> type block devices</p>
<pre><code>NAME               KNAME             PKNAME TRAN TYPE FSTYPE  SIZE 
/dev/mmcblk0boot0  /dev/mmcblk0boot0             disk           4M 
/dev/mmcblk0boot1  /dev/mmcblk0boot1             disk           4M 
/dev/mmcblk0rpmb   /dev/mmcblk0rpmb              disk           4M
</code></pre>
<p>but what ReaR wrongly did before
<a href="https://github.com/rear/rear/pull/2091">https://github.com/rear/rear/pull/2091</a><br />
is that it recognized those <code>disk</code> type block devices<br />
as if they were <code>part</code> type block devices below PKNAME /dev/mmcblk0<br />
i.e. as if the <code>lsblk</code> output would have been something like</p>
<pre><code>NAME                 KNAME               PKNAME       TYPE   SIZE 
/dev/mmcblk0         /dev/mmcblk0                     disk  58.2G 
|-/dev/mmcblk0boot0  /dev/mmcblk0boot0  /dev/mmcblk0  part     4M 
|-/dev/mmcblk0boot1  /dev/mmcblk0boot1  /dev/mmcblk0  part     4M 
 -/dev/mmcblk0rpmb   /dev/mmcblk0rpmb   /dev/mmcblk0  part     4M
</code></pre>
<p>The reason is that currently ReaR does not use the <code>lsblk</code> output<br />
but determines the disk devices layout by more traditional methods<br />
so that it could be another cleanup/enhancement to let ReaR<br />
use the <code>lsblk</code> output to determine the storage devices layout,<br />
cf.
<a href="https://github.com/rear/rear/issues/1390">https://github.com/rear/rear/issues/1390</a></p>
<h4 id="fabz5_commented_at_2019-04-04_1805"><img src="https://avatars.githubusercontent.com/u/3602156?v=4" width="50"><a href="https://github.com/fabz5">fabz5</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-480003768">2019-04-04 18:05</a>:<a class="headerlink" href="#fabz5_commented_at_2019-04-04_1805" title="Permanent link">&para;</a></h4>
<p>You are right about the <code>disk</code>type block devices. Using <code>lsblk</code>seems
like a reasonable idea to determine disk device layout indeed.</p>
<h4 id="jsmeix_commented_at_2019-04-05_0718"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2087#issuecomment-480173977">2019-04-05 07:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-04-05_0718" title="Permanent link">&para;</a></h4>
<p>I even think using <code>lsblk</code> to recreate the storage devices layout<br />
is a nowadays basically mandatory step forward because <code>lsblk</code><br />
should provide the right dependencies of arbitrary complex layers<br />
of storage devices "out of the box", for an (artificial) example<br />
of a complex layout see
<a href="https://github.com/rear/rear/issues/2023">https://github.com/rear/rear/issues/2023</a></p>
<p>In general cf.<br />
<a href="https://github.com/rear/rear/issues/1390#issuecomment-406516854">https://github.com/rear/rear/issues/1390#issuecomment-406516854</a><br />
and follow the link therein that links to<br />
<a href="https://github.com/rear/rear/issues/791#issuecomment-406513969">https://github.com/rear/rear/issues/791#issuecomment-406513969</a><br />
and then have a look at the links there</p>
<p>You may also have a look at issues that are linked in<br />
<a href="https://github.com/rear/rear/issues/2023#issuecomment-468187071">https://github.com/rear/rear/issues/2023#issuecomment-468187071</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-03-15.2087.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
