<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2017 11 21.1589.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2017 11 21.1589.issue.closed";
        var mkdocs_page_input_path = "issues/2017-11-21.1589.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2017 11 21.1589.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1589_issue_closed_function_btrfs_subvolume_exists_fails_to_properly_evaluate_some_entries"><a href="https://github.com/rear/rear/issues/1589">#1589 Issue</a> <code>closed</code>: function btrfs_subvolume_exists fails to properly evaluate some entries<a class="headerlink" href="#1589_issue_closed_function_btrfs_subvolume_exists_fails_to_properly_evaluate_some_entries" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="wackyone_opened_issue_at_2017-11-21_1553"><img src="https://avatars.githubusercontent.com/u/13967302?v=4" width="50"><a href="https://github.com/WackyOne">WackyOne</a> opened issue at <a href="https://github.com/rear/rear/issues/1589">2017-11-21 15:53</a>:<a class="headerlink" href="#wackyone_opened_issue_at_2017-11-21_1553" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 2.2-git.0.0.unknown / 2017-10-03</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    OS_VENDOR=SUSE_LINUX<br />
    OS_VERSION=12</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):<br />
    Empty (all defaults)</li>
<li>Are you using legacy BIOS or UEFI boot?<br />
    BIOS</li>
<li>Brief description of the issue:<br />
    There are various ways that subvolumes may appear under the root
    volume. One example is:<br />
    ID 259 gen 6876715 top level 5 path opt<br />
    ID 261 gen 6879102 top level 5 path tmp<br />
    ID 265 gen 6872990 top level 5 path var/opt<br />
    ID 267 gen 6879047 top level 5 path var/tmp<br />
    For path 'opt' and for path 'tmp' it matches twice, therefor
    returning false.</li>
<li>Work-around, if any:<br />
    I have no work-around other than changing the function to do a
    better match.</li>
</ul>
<h4 id="jsmeix_commented_at_2017-11-21_1634"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346083955">2017-11-21 16:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-21_1634" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
could you have a look what goes on here<br />
because the btrfs_subvolume_exists() function<br />
in lib/filesystems-functions.sh is from you so that<br />
perhaps you see immediatley what is missing here.<br />
Many thanks in advance!</p>
<h4 id="jsmeix_commented_at_2017-11-21_1639"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346085582">2017-11-21 16:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-21_1639" title="Permanent link">&para;</a></h4>
<p>@WackyOne<br />
when you use SUSE with its default btrfs subvolume structure<br />
you basically must use a matching<br />
conf/examples/SLE*btrfs-example.conf<br />
config file as template - regarding "matching" see<br />
<a href="https://github.com/rear/rear/issues/1368#issuecomment-302410707">https://github.com/rear/rear/issues/1368#issuecomment-302410707</a></p>
<h4 id="olivero2_commented_at_2017-11-21_1700"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346092379">2017-11-21 17:00</a>:<a class="headerlink" href="#olivero2_commented_at_2017-11-21_1700" title="Permanent link">&para;</a></h4>
<p>I'll try to come up with a fix. What we're seeing here is just an
unexpected (but valid) subvolume structure.</p>
<p>A fix would be quite easy if <code>btrfs subvolume list</code> would produce more
consistent output. But its output can look like this:</p>
<pre><code>ID 5125 gen 27216 top level 257 path @/var/lib/docker/btrfs/subvolumes/8bfcbb9c775e910d504ac7d0f091e9668d700fffcc4c10e71118330ddad47b80
</code></pre>
<p>or like this (at least with the <code>-a</code> option):</p>
<pre><code>ID 5125 gen 27216 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/8bfcbb9c775e910d504ac7d0f091e9668d700fffcc4c10e71118330ddad47b80
</code></pre>
<p>I'll check if this is still relevant.</p>
<h4 id="jsmeix_commented_at_2017-11-21_1714"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346096513">2017-11-21 17:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-21_1714" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
when I implemented some btrfs code in ReaR<br />
I learned to always use "btrfs subvolume list -a" (i.e. with '-a')<br />
but right now I don't remember the exact reason why but<br />
I guess it was something related to more consistent output.</p>
<p>E.g. see<br />
layout/prepare/GNU/Linux/130_include_mount_subvolumes_code.sh<br />
where I use things like</p>
<pre>
btrfs subvolume list -a ... | sed -e 's/&lt;FS_TREE&gt;\///' 
</pre>

<p>because - as far as I remember - when one cuts '&lt;FS_TREE&gt;' away<br />
the rest is the subvolume with absolute path (i.e. its path "relative"<br />
to the root of the btrfs filesystem) and usually that is what one<br />
wants to get (and not some path "relative" to whatever else).</p>
<h4 id="olivero2_commented_at_2017-11-21_1822"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346116390">2017-11-21 18:22</a>:<a class="headerlink" href="#olivero2_commented_at_2017-11-21_1822" title="Permanent link">&para;</a></h4>
<p>You are probably right in assuming that using <code>-a</code> and stripping the
<code>&lt;FS_TREE&gt;</code> stuff is even safer. So I'll amend my fix.</p>
<p>The problem is that <code>btrfs subvolume</code> is not properly documented and it
is not immediately clear (if at all) what the <code>&lt;FS_TREE&gt;</code> stuff in the
output actually means. If tried with different file system paths and it
looks weird.</p>
<p>Additionally, on Ubuntu 16.04 LTS, the btrfs-subvolume(8) manual page is
out of sync with actual behavior. For the <code>list</code> subcommand it states:</p>
<blockquote>
<p>For every subvolume the following information is shown by default.<br />
<code>ID &lt;ID&gt; top level &lt;ID&gt; path &lt;path&gt;</code> where path is the relative path
of the subvolume to the top level subvolume. [...]</p>
</blockquote>
<p>Actual output looks like:</p>
<blockquote>
<p><code>ID &lt;ID&gt; gen &lt;gen&gt; top level &lt;level&gt; path &lt;path&gt;</code></p>
</blockquote>
<p>So we don't have a specific format to really rely on and have to resort
to a reasonable guess.</p>
<h4 id="jsmeix_commented_at_2017-11-22_0918"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346290219">2017-11-22 09:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-22_0918" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
don't worry - also I am still wondering how btrfs works<br />
and what things like '&lt;FS_TREE&gt;' actually mean ;-)<br />
By luck I found (via Google)<br />
<a href="https://www.carta.tech/man-pages/man8/btrfs-subvolume.8.html">https://www.carta.tech/man-pages/man8/btrfs-subvolume.8.html</a><br />
that reads</p>
<pre>
... top-level subvolume, whose subvolume id is 5(FS_TREE)
</pre>

<p>(which is not in my "man btrfs-subvolume" man page).<br />
From that I guess/conclude 'FS_TREE' probably<br />
means the root of the btrfs filesystem.</p>
<p>Careful:<br />
The root of a filesystem is not the root of the tree<br />
of mounted filesystems (the latter is the '/' directory)<br />
and<br />
the root of a btrfs filesystem (i.e. its root subvolume)<br />
is not necessarily the "entry point" into the btrfs filesystem<br />
when the btrfs filesystem gets mounted at a mountpoint directory<br />
because any subvolume of a btrfs filesystem can be mounted<br />
so that any subvolume can be an "entry point" into the btrfs<br />
filesystem and one same btrfs filesystem can be mounted<br />
several times simultaneously so that one can set up a nice<br />
"mess of various entry points" into one same btrfs filesystem.<br />
It is left as an exercise for the reader to find out if and how<br />
access to same files works consistently when one same<br />
btrfs filesystem is mouted several times...</p>
<h4 id="jsmeix_commented_at_2017-11-22_1036"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346311098">2017-11-22 10:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-22_1036" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1591">https://github.com/rear/rear/pull/1591</a>
merged<br />
I consider this issue to be fixed.</p>
<p>@WackyOne<br />
please test with current GitHub ReaR master code<br />
whether or not it now also works in your particular case.<br />
FYI:<br />
How to verify that your ReaR code contains the fix:</p>
<pre>
# git log | grep 1591

Merge pull request #1591 from OliverO2/fix/btrfs_subvolume_exists
</pre>

<h4 id="jsmeix_commented_at_2017-11-22_1050"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346314457">2017-11-22 10:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-22_1050" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
many thanks for your prompt response<br />
and for your quick fix!</p>
<h4 id="olivero2_commented_at_2017-11-22_1108"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346318843">2017-11-22 11:08</a>:<a class="headerlink" href="#olivero2_commented_at_2017-11-22_1108" title="Permanent link">&para;</a></h4>
<p>@jsmeix Regarding the <code>&lt;FS_TREE&gt;</code> tag, look at the differences when
calling <code>btrfs subvolume list -a</code> with different mountpoints referring
to subvolumes of the same btrfs file system:</p>
<pre><code># findmnt -t btrfs
TARGET         SOURCE                             FSTYPE OPTIONS
/              /dev/sda2[/@]                      btrfs  rw,noatime,nodiratime,s
├─/volumes/01  /dev/sda2                          btrfs  rw,noatime,nodiratime,s
├─/var/lib/docker/btrfs
│              /dev/sda2[/@/var/lib/docker/btrfs] btrfs  rw,noatime,nodiratime,s
└─/home        /dev/sda2[/@home]                  btrfs  rw,noatime,nodiratime,s

# btrfs subvol list -a / | head
ID 257 gen 202134 top level 5 path &lt;FS_TREE&gt;/@
ID 258 gen 202134 top level 5 path &lt;FS_TREE&gt;/@home
ID 5125 gen 27216 top level 257 path @/var/lib/docker/btrfs/subvolumes/8bfcbb9c775e910d504ac7d0f091e9668d700fffcc4c10e71118330ddad47b80
ID 5126 gen 27217 top level 257 path @/var/lib/docker/btrfs/subvolumes/4209efbc4922061100d9922741e2b5135d396a1586d1111f72d1beb9ea1cc513
ID 5127 gen 27218 top level 257 path @/var/lib/docker/btrfs/subvolumes/e44faf88d5e4a25366e7e0eb2882f40b1c0d2b5fef1142f06b0dad3cd4e1ee4f
ID 5128 gen 27219 top level 257 path @/var/lib/docker/btrfs/subvolumes/268b6c560568411d38215d3d87c08ddc0fb373bb02b4d1a114c589c790a69101
ID 5129 gen 28716 top level 257 path @/var/lib/docker/btrfs/subvolumes/4c48e4299061b98be208013f5be89f05107f075fea4c4e659f117fa55225971b
ID 5134 gen 181545 top level 257 path @/var/lib/docker/btrfs/subvolumes/e18c9690831dd193f37d5dadf0e0ff0f9cac75e6bba09e5b471b7a16538e639b
ID 5137 gen 181545 top level 257 path @/var/lib/docker/btrfs/subvolumes/813f7476ee473d6a1e64b4e08877b0fd76ce0e6a472dfea8ca4f44711e545946
ID 5149 gen 181545 top level 257 path @/var/lib/docker/btrfs/subvolumes/1f45e82870cc392d533d0976f2e1a732b8fab8b85f322ae77533c8cfd676dbff

# btrfs subvol list -a /volumes/01 | head
ID 257 gen 202135 top level 5 path @
ID 258 gen 202135 top level 5 path @home
ID 5125 gen 27216 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/8bfcbb9c775e910d504ac7d0f091e9668d700fffcc4c10e71118330ddad47b80
ID 5126 gen 27217 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/4209efbc4922061100d9922741e2b5135d396a1586d1111f72d1beb9ea1cc513
ID 5127 gen 27218 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/e44faf88d5e4a25366e7e0eb2882f40b1c0d2b5fef1142f06b0dad3cd4e1ee4f
ID 5128 gen 27219 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/268b6c560568411d38215d3d87c08ddc0fb373bb02b4d1a114c589c790a69101
ID 5129 gen 28716 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/4c48e4299061b98be208013f5be89f05107f075fea4c4e659f117fa55225971b
ID 5134 gen 181545 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/e18c9690831dd193f37d5dadf0e0ff0f9cac75e6bba09e5b471b7a16538e639b
ID 5137 gen 181545 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/813f7476ee473d6a1e64b4e08877b0fd76ce0e6a472dfea8ca4f44711e545946
ID 5149 gen 181545 top level 257 path &lt;FS_TREE&gt;/@/var/lib/docker/btrfs/subvolumes/1f45e82870cc392d533d0976f2e1a732b8fab8b85f322ae77533c8cfd676dbff
</code></pre>
<h4 id="jsmeix_commented_at_2017-11-22_1151"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346328517">2017-11-22 11:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-22_1151" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
many thanks for that example.</p>
<p>It proves that whenever one does something<br />
with a btrfs filesystem that has subvolumes<br />
one basically must always inspect and use<br />
the btrfs filesystem at its top level subvolume<br />
(i.e. at its root subvolume) as entry point.</p>
<p>Using any other subvolume below the root subvolume<br />
as entry point causes nothing else but confusion<br />
(at least for me).</p>
<p>Because when looking at a btrfs filesystem from<br />
an inner entry point of view things look strange<br />
in particular things that belong to higher parts<br />
that are above the current inner entry point of view.</p>
<p>I think I can reproduce such unexpected<br />
"btrfs subvol list -a" output on my SLES12-SP2 system<br />
with its btrfs default structure.</p>
<p>The crucial point why "btrfs subvol list -a /" looks strange<br />
is when what is mounted at '/' is not the root subvolume<br />
but an inner subvolume so that '/' is an inner entry point<br />
of view.</p>
<p>What I get on SLES12-SP2 (excerpts as needed):</p>
<pre>
# findmnt -t btrfs -o TARGET,SOURCE
TARGET                    SOURCE
/                         /dev/sda2[/@/.snapshots/1/snapshot]
...
|-/var/lib/mysql          /dev/sda2[/@/var/lib/mysql]
|-/var/lib/named          /dev/sda2[/@/var/lib/named]
|-/var/lib/libvirt/images /dev/sda2[/@/var/lib/libvirt/images]
|-/var/lib/mariadb        /dev/sda2[/@/var/lib/mariadb]
|-/var/lib/mailman        /dev/sda2[/@/var/lib/mailman]
|-/var/lib/machines       /dev/sda2[/@/var/lib/machines]
|-/var/lib/pgsql          /dev/sda2[/@/var/lib/pgsql]

# btrfs subvolume create /var/lib/mystuff         
Create subvolume '/var/lib/mystuff'

# btrfs subvol list -a / | grep var/lib
ID 269 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/libvirt/images
ID 270 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/machines
ID 271 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mailman
ID 272 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mariadb
ID 273 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mysql
ID 274 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/named
ID 275 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/pgsql
ID 300 gen 879 top level 259 path @/.snapshots/1/snapshot/var/lib/mystuff

# mkdir /tmp/btrfsroot

# mount -t btrfs -o subvolid=0 /dev/sda2 /tmp/btrfsroot/

# btrfs subvol list -a /tmp/btrfsroot/ | grep var/lib
ID 269 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/libvirt/images
ID 270 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/machines
ID 271 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mailman
ID 272 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mariadb
ID 273 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/mysql
ID 274 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/named
ID 275 gen 760 top level 257 path &lt;FS_TREE>/@/var/lib/pgsql
ID 300 gen 879 top level 259 path &lt;FS_TREE>/@/.snapshots/1/snapshot/var/lib/mystuff
</pre>

<h4 id="wackyone_commented_at_2017-11-22_1358"><img src="https://avatars.githubusercontent.com/u/13967302?v=4" width="50"><a href="https://github.com/WackyOne">WackyOne</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346357273">2017-11-22 13:58</a>:<a class="headerlink" href="#wackyone_commented_at_2017-11-22_1358" title="Permanent link">&para;</a></h4>
<p>@jsmeix I tested the new code for my case and it works.</p>
<p>@OliverO2 thanks for the very quick resolution</p>
<h4 id="olivero2_commented_at_2017-11-22_1426"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346365050">2017-11-22 14:26</a>:<a class="headerlink" href="#olivero2_commented_at_2017-11-22_1426" title="Permanent link">&para;</a></h4>
<p>@WackyOne You're welcome. Thanks for the bug report and your test
feedback!</p>
<h4 id="jsmeix_commented_at_2017-11-23_0931"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1589#issuecomment-346567905">2017-11-23 09:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-23_0931" title="Permanent link">&para;</a></h4>
<p>@WackyOne<br />
many thanks for your prompt verification and feedback<br />
whether or not it also works for you.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-11-21.1589.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
