<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#774 Issue closed: issues if rear is installed in non-default path - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#774 Issue closed: issues if rear is installed in non-default path";
        var mkdocs_page_input_path = "issues/2016-02-15.774.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#774 Issue closed: issues if rear is installed in non-default path</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="774_issue_closed_issues_if_rear_is_installed_in_non-default_path"><a href="https://github.com/rear/rear/issues/774">#774 Issue</a> <code>closed</code>: issues if rear is installed in non-default path<a class="headerlink" href="#774_issue_closed_issues_if_rear_is_installed_in_non-default_path" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="abbbi_opened_issue_at_2016-02-15_1027"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> opened issue at <a href="https://github.com/rear/rear/issues/774">2016-02-15 10:27</a>:<a class="headerlink" href="#abbbi_opened_issue_at_2016-02-15_1027" title="Permanent link">&para;</a></h4>
<p>hi there,</p>
<p>im struggeling to get rear correctly working on a non-standard
installation path.<br />
Im using the DESTDIR= parameter to install rear into another path than
usually, that results in some<br />
issues which should at least be discussed.</p>
<p>For example, installing rear into /opt/rear/ with the following command:</p>
<p>make install DESTDIR=/opt/rear/</p>
<p>will result in the following error:</p>
<p>linux-fhta:~/rear # /opt/rear/usr/sbin/rear mkrescue -v<br />
/opt/rear/usr/sbin/rear: line 282: /usr/share/rear/conf/default.conf: No
such file or directory<br />
/opt/rear/usr/sbin/rear: line 290: IsInArray: command not found<br />
/opt/rear/usr/sbin/rear: line 296: has_binary: command not found<br />
ERROR: Required program 'pidof' missing, please check your PATH</p>
<p>Issue is that the Makefile does not use the DESTDIR parameter in all
places to replace the paths within the rear exectuable. I think i have
created a patch for this sometime in the past and it was reverted as it
lead to break rear in other modules or situations, the diff is one like
this:</p>
<pre><code>diff --git a/Makefile b/Makefile
index 16df320..b098d4b 100644
--- a/Makefile
+++ b/Makefile
@@ -136,9 +136,9 @@ install-config:
 install-bin:
        @echo -e "\033[1m== Installing binary ==\033[0;0m"
        install -Dp -m0755 $(rearbin) $(DESTDIR)$(sbindir)/rear
-       sed -i -e 's,^CONFIG_DIR=.*,CONFIG_DIR="$(sysconfdir)/rear",' \
-               -e 's,^SHARE_DIR=.*,SHARE_DIR="$(datadir)/rear",' \
-               -e 's,^VAR_DIR=.*,VAR_DIR="$(localstatedir)/lib/rear",' \
+       sed -i -e 's,^CONFIG_DIR=.*,CONFIG_DIR="$(DESTDIR)$(sysconfdir)/rear",' \
+               -e 's,^SHARE_DIR=.*,SHARE_DIR="$(DESTDIR)$(datadir)/rear",' \
+               -e 's,^VAR_DIR=.*,VAR_DIR="$(DESTDIR)$(localstatedir)/lib/rear",' \
                $(DESTDIR)$(sbindir)/rear

 install-data:
</code></pre>
<p>Is there another way to install REAR into a non-default path than using
DESTDIR=?</p>
<p>Another problem is that with a recent change, the "os.conf" file is
allways forcibly installed into the /etc/rear directory of the resulting
image. This causes rear to not find the os.conf configuration file and
exit upon execution during recovery. One has to copy the os.conf
configuration file within the recovery image from /etc/rear/os.conf to
$DESTDIR/etc/rear/os.conf:</p>
<pre><code>commit 5507548d9796706dfbab13f5617c854121694728
    write os.conf to /etc/rear/

    os.conf MUST be at /etc/rear/os.conf in the rescue image. $CONF_DIR may have been different depending on the rear installation directory.


diff --git a/usr/share/rear/build/default/99_update_os_conf.sh b/usr/share/rear/build/default/99_update_os_conf.sh
index f9ffcb6..9b51782 100644
--- a/usr/share/rear/build/default/99_update_os_conf.sh
+++ b/usr/share/rear/build/default/99_update_os_conf.sh
@@ -1,6 +1,6 @@
 # add os/version info to os.conf in the rescue system so that we don't need to pull lsb into the rescue system

-echo -e "#\n# WARNING ! This information was added automatically by the $WORKFLOW workflow !!!" &gt;&gt; $ROOTFS_DIR/$CONFIG_DIR/os.conf
+echo -e "#\n# WARNING ! This information was added automatically by the $WORKFLOW workflow !!!" &gt;&gt; $ROOTFS_DIR/etc/rear/os.conf
 for var in ARCH OS OS_VERSION OS_VENDOR OS_VENDOR_VERSION OS_VENDOR_ARCH ; do
        echo "$var='${!var}'"
-done &gt;&gt; $ROOTFS_DIR/$CONFIG_DIR/os.conf
+done &gt;&gt; $ROOTFS_DIR/etc/rear/os.conf
lines 1-13/13 (END)
</code></pre>
<h4 id="gdha_commented_at_2016-02-15_1324"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-184207439">2016-02-15 13:24</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-15_1324" title="Permanent link">&para;</a></h4>
<p>See also #329 - SEP Sesam also tried it and it broke rear (pull request
#324).<br />
You can use rear from the directory where you ran the 'git
clone<code>or untarred that archive as</code>./usr/sbin/rear`</p>
<h4 id="abbbi_commented_at_2016-02-16_2130"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-184882131">2016-02-16 21:30</a>:<a class="headerlink" href="#abbbi_commented_at_2016-02-16_2130" title="Permanent link">&para;</a></h4>
<p>hi again,</p>
<p>yes, i know that just executing rear from a cloned repository or
extracted archive will work.<br />
This is solving our first "Problem".</p>
<p>This however still creates files in /etc/rear/, even if the user does
not want it to. Is there a<br />
special usecase or why has the os.conf been hardcodet to /etc/?</p>
<p>I know the old commit from SEP Sesam broke some Fedora related things
:-)<br />
We from SEP ship REAR with our client installation and we dont want to
modify the system<br />
in pathes which are not related to SEP Sesam. Of course we can change
REAR to place os.conf in the right directory, but we dont want our
shipped REAR components to differ from your release versions!</p>
<h4 id="abbbi_commented_at_2016-02-17_0837"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-185095007">2016-02-17 08:37</a>:<a class="headerlink" href="#abbbi_commented_at_2016-02-17_0837" title="Permanent link">&para;</a></h4>
<p>After some more testing: simply running rear from extracted tar or git
checkout solves both problems. I think we can close this here :-)</p>
<h4 id="jsmeix_commented_at_2016-02-17_0845"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-185099426">2016-02-17 08:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-17_0845" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
it seems what you need is a general prefix for all of rear's files<br />
so that in particular rear creates files in <prefix>/etc/rear/.</p>
<p>In usr/sbin/rear there is</p>
<pre>
# Find out if we're running from checkout
REAR_DIR_PREFIX=""
readonly SCRIPT_FILE="$( readlink -f $( type -p "$0" || echo "$0" ) )"
if test "$SCRIPT_FILE" != "$( readlink -f /usr/sbin/$PROGRAM )" ; then
    REAR_DIR_PREFIX=${SCRIPT_FILE%/usr/sbin/$PROGRAM}
fi
readonly REAR_DIR_PREFIX
# Program directories - they must be set here. Everything else is then dynamic.
# Not yet readonly here because they are set via the /etc/rear/rescue.conf file
# in the recovery system that is sourced by the rear command in recover mode
# and CONFIG_DIR can also be changed via '-c' command line option:
SHARE_DIR="$REAR_DIR_PREFIX/usr/share/rear"
CONFIG_DIR="$REAR_DIR_PREFIX/etc/rear"
VAR_DIR="$REAR_DIR_PREFIX/var/lib/rear"
LOG_DIR="$REAR_DIR_PREFIX/var/log/rear"
</pre>

<p>Accordingly if for example $CONFIG_DIR is used in the scripts and no
hardcoded "/etc/rear", rear should create files accordingly.</p>
<p>It seems currently it is hardcoded in usr/sbin/rear when a non-empty
REAR_DIR_PREFIX will be used.</p>
<p>I assume you may need to adapt and enhance that for your needs and then
verify if a non-empty REAR_DIR_PREFIX will really be used in all the
various rear scripts as needed.</p>
<p>As far as I see there is a difference if rear runs in its recovery
system (basically when "rear recover" is run) in contrast to when rear
is run in the original system (e.g. when "rear mkbackup" is run).</p>
<p>As far as I see if rear runs in its recovery system then rear should use
hardcoded paths like "/etc/rear/" to match the actual direcories in the
recovery system.</p>
<p>In contrast when rear is run in the original system it should
consistently use REAR_DIR_PREFIX where appropriate.</p>
<h4 id="jsmeix_commented_at_2016-02-17_0851"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-185102119">2016-02-17 08:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-17_0851" title="Permanent link">&para;</a></h4>
<p>@abbbi<br />
I did not see your
<a href="https://github.com/rear/rear/issues/774#issuecomment-185095007">https://github.com/rear/rear/issues/774#issuecomment-185095007</a>
while I wrote my last comment.</p>
<p>As far as I see your
<a href="https://github.com/rear/rear/issues/774#issuecomment-185095007">https://github.com/rear/rear/issues/774#issuecomment-185095007</a>
proves that rear works correctly when a non-empty REAR_DIR_PREFIX is
used.</p>
<p>Accordingly I think all what you still may need to make rear working
perfectly for your use-case is to to adapt and enhance the current
hardcoded magic in usr/sbin/rear when a non-empty REAR_DIR_PREFIX will
be used.</p>
<h4 id="gdha_commented_at_2016-02-17_0859"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/774#issuecomment-185103897">2016-02-17 08:59</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-17_0859" title="Permanent link">&para;</a></h4>
<p>In recovery mode the <code>/etc/rear/rescue.conf</code> defines the rear paths</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-02-15.774.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
