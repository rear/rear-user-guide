<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#700 Issue closed: make rear working with "set -ue -o pipefail" - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#700 Issue closed: make rear working with \"set -ue -o pipefail\"";
        var mkdocs_page_input_path = "issues/2015-11-18.700.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#700 Issue closed: make rear working with "set -ue -o pipefail"</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="700_issue_closed_make_rear_working_with_set_-ue_-o_pipefail"><a href="https://github.com/rear/rear/issues/700">#700 Issue</a> <code>closed</code>: make rear working with "set -ue -o pipefail"<a class="headerlink" href="#700_issue_closed_make_rear_working_with_set_-ue_-o_pipefail" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>won't fix / can't fix / obsolete</code></p>
<h4 id="jsmeix_opened_issue_at_2015-11-18_1615"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/700">2015-11-18 16:15</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2015-11-18_1615" title="Permanent link">&para;</a></h4>
<p>In the future rear should work with ''set -ue -o pipefail".</p>
<p>See<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
that reads (excerpt):</p>
<pre>
TODO Use set -eu to die from unset variables and unhandled errors
</pre>

<p>See also<br />
<a href="https://github.com/rear/rear/pull/699">https://github.com/rear/rear/pull/699</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/688">https://github.com/rear/rear/issues/688</a></p>
<h4 id="gdha_commented_at_2015-11-19_1335"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-158058361">2015-11-19 13:35</a>:<a class="headerlink" href="#gdha_commented_at_2015-11-19_1335" title="Permanent link">&para;</a></h4>
<p>@jsmeix just merged the pull request. OK - it is testing time...</p>
<h4 id="jsmeix_commented_at_2015-11-20_0914"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-158332829">2015-11-20 09:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-20_0914" title="Permanent link">&para;</a></h4>
<p>To avoid exaggerated expectations:<br />
Currently only the 'help' workflow should work with 'set -ue'<br />
all other workflows do not yet work with 'set -ue'<br />
(cf.
<a href="https://github.com/rear/rear/pull/699">https://github.com/rear/rear/pull/699</a>).</p>
<h4 id="gdha_commented_at_2015-11-20_0942"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-158338328">2015-11-20 09:42</a>:<a class="headerlink" href="#gdha_commented_at_2015-11-20_0942" title="Permanent link">&para;</a></h4>
<p>@jsmeix do not forget to update the man page as well with the updated
arguments. Thank you for the hard work. Gratien</p>
<h4 id="jsmeix_commented_at_2015-11-20_1353"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-158408247">2015-11-20 13:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-20_1353" title="Permanent link">&para;</a></h4>
<p>Updating the man page (and other documentation as needed) regarding
'--debugscripts' belongs to
<a href="https://github.com/rear/rear/issues/688">https://github.com/rear/rear/issues/688</a>
that I reopened because of that missing documentation.</p>
<h4 id="jsmeix_commented_at_2015-11-27_1446"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160153205">2015-11-27 14:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-27_1446" title="Permanent link">&para;</a></h4>
<p>I have an idea how I could make rear working with ''set -ue -o
pipefail"<br />
step by step:</p>
<p>I can do it script by script.</p>
<p>For each script I can add at the beginning a line</p>
<pre>
set -ue -o pipefail
</pre>

<p>and at the end a line</p>
<pre>
set +ue +o pipefail
</pre>

<p>to make that one working with 'set -ue -o pipefail'.</p>
<p>The advantage of having 'set -ue -o pipefail' hardcoded in the<br />
scripts is that it ensures that subsequent changes are also<br />
implemented so that it still works with 'set -ue -o pipefail'.</p>
<p>And scripts where I cannot test them (e.g. scripts for using<br />
third-party backup tools that I do not have) can be left as is.</p>
<p>I will start with "my" scripts for btrfs support to make them<br />
working with 'set -ue -o pipefail'.</p>
<h4 id="schlomo_commented_at_2015-11-28_1718"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160321769">2015-11-28 17:18</a>:<a class="headerlink" href="#schlomo_commented_at_2015-11-28_1718" title="Permanent link">&para;</a></h4>
<p>@jsmeix great idea! That way it is also visible in that script that
those settings are active. Maybe less of a surprise for the next
developer to work on a script.</p>
<h4 id="schlomo_commented_at_2015-11-28_1721"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160321924">2015-11-28 17:21</a>:<a class="headerlink" href="#schlomo_commented_at_2015-11-28_1721" title="Permanent link">&para;</a></h4>
<p>One other thought. By disabling those settings at the end of a script
you will also disable them if they are enabled globally. Maybe you write
a function to remember the settings and to return them to the remembered
state?</p>
<p>In general it might be useful to have functions for those settings so
that we can change them centrally or extend them with tracking code and
other stuff.</p>
<h4 id="jsmeix_commented_at_2015-11-30_0938"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160574263">2015-11-30 09:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-30_0938" title="Permanent link">&para;</a></h4>
<p>I agree.</p>
<p>I found<br />
<a href="http://unix.stackexchange.com/questions/210158/how-can-i-list-bashs-options-for-the-current-shell">http://unix.stackexchange.com/questions/210158/how-can-i-list-bashs-options-for-the-current-shell</a></p>
<p>Accordingly it seems the right way to save and restore bash flags and
options is</p>
<pre>
# Save current flags and option settings as bash commands:
bash_flags_and_option_settings=$( set +o | tr '\n' ';' ; shopt -p | tr '\n' ';' )
# Change flags and options as one likes:
...
# Restore bash flags and option settings:
eval $bash_flags_and_option_settings
</pre>

<p>I have tested it a little bit and it seems to work (at least for me).</p>
<p>To provide that via generic functions</p>
<pre>
function save_bash_flags_and_option_settings () { ... }
function restore_bash_flags_and_option_settings () { ... }
</pre>

<p>it must be save against nested function calls which means<br />
I need to implement a stack of bash_flags_and_option_settings<br />
variables where the states are stored.</p>
<h4 id="jsmeix_commented_at_2015-11-30_0957"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160581315">2015-11-30 09:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-30_0957" title="Permanent link">&para;</a></h4>
<p>It seems Rear does not yet have a stack implemented.</p>
<p>Via<br />
<a href="http://brizzled.clapper.org/blog/2011/10/28/a-bash-stack/">http://brizzled.clapper.org/blog/2011/10/28/a-bash-stack/</a><br />
I found<br />
<a href="https://github.com/bmc/lib-sh">https://github.com/bmc/lib-sh</a><br />
where<br />
<a href="https://github.com/bmc/lib-sh/blob/master/LICENSE.md">https://github.com/bmc/lib-sh/blob/master/LICENSE.md</a><br />
reads that it is "under a BSD license".</p>
<p>@schlomo<br />
could you check if their license is o.k. so that it could be used in
rear?</p>
<h4 id="jsmeix_commented_at_2015-11-30_1009"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160585165">2015-11-30 10:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-30_1009" title="Permanent link">&para;</a></h4>
<p>Or avoid the stack and use local variables in place like</p>
<pre>
# Save current flags and option settings:
flags_and_options=$( get_bash_flags_and options )
# Change flags and options as one likes:
...
# Restore bash flags and option settings:
set_bash_flags_and options "$flags_and_options"
</pre>

<p>that call complementary global stateless functions</p>
<pre>
function get_bash_flags_and_options () { set +o | tr '\n' ';' ; shopt -p | tr '\n' ';' ; }
function set_bash_flags_and_options () { eval $1 ; }
</pre>

<h4 id="jsmeix_commented_at_2015-11-30_1052"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-160596216">2015-11-30 10:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-30_1052" title="Permanent link">&para;</a></h4>
<p>Or don't use a generic stack but a simple array that is sufficient<br />
only for this particular use case?</p>
<p>I mean a global array like bash_flags_and_options_array<br />
that contains bash_flags_and_options values<br />
plus complementary global stateful functions<br />
save_bash_flags_and_option_settings and<br />
restore_bash_flags_and_option_settings<br />
that operate on that global array.</p>
<p>I.e. like currently EXIT_TASKS, AddExitTask, RemoveExitTask.</p>
<h4 id="jsmeix_commented_at_2015-12-02_1026"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-161250208">2015-12-02 10:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-12-02_1026" title="Permanent link">&para;</a></h4>
<p>I experimented with using implicitly a stack (i.e. an array) of
saved_flags_options_cmds via save_flags_and_options and
restore_flags_and_options functions but its usage was not sufficient
for my needs.</p>
<p>In particular I like to be able to restore an explicity named state.</p>
<p>In the end in
<a href="https://github.com/rear/rear/pull/726">https://github.com/rear/rear/pull/726</a>
I implemented simple functions get_bash_flags_and_options_commands
and apply_bash_flags_and_options_commands that are used via an
explicit variable that stores the current bash flags and options
commands and using that explicit variable to re-apply them, i.e. like</p>
<pre>
      saved_flags_options_cmds="$( get_bash_flags_and_options_commands )"
      ... [change bash flags and options] ...
      ... [do something] ...
      apply_bash_flags_and_options_commands "$saved_flags_options_cmds"
</pre>

<h4 id="jsmeix_commented_at_2015-12-03_1002"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-161576272">2015-12-03 10:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-12-03_1002" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/726">https://github.com/rear/rear/pull/726</a>
the precondition for
<a href="https://github.com/rear/rear/issues/700#issuecomment-160153205">https://github.com/rear/rear/issues/700#issuecomment-160153205</a>
is implemented so that now one can make a particular piece of code (e.g
a script) working with ''set -ue -o pipefail" as follows:</p>
<pre>
local saved_bash_flags_and_options_commands="$( get_bash_flags_and_options_commands )"
set -ue -o pipefail
... [code that works with "set -ue -o pipefail"] ...
apply_bash_flags_and_options_commands "$saved_bash_flags_and_options_commands"
</pre>

<h4 id="gdha_commented_at_2016-02-09_1355"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-181873626">2016-02-09 13:55</a>:<a class="headerlink" href="#gdha_commented_at_2016-02-09_1355" title="Permanent link">&para;</a></h4>
<p>@jsmeix can this issue be closed?</p>
<h4 id="jsmeix_commented_at_2016-02-09_1410"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-181879488">2016-02-09 14:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-02-09_1410" title="Permanent link">&para;</a></h4>
<p>Current rear does not at all work with ''set -ue -o pipefail".</p>
<p>There are zillions of places where the code<br />
is not yet safe against "set -ue -o pipefail".</p>
<p>I assume this issue will stay open for a very long time.<br />
But on the other hand there is no time pressure.</p>
<p>I set the "Milestone" to "Rear future".</p>
<h4 id="jsmeix_commented_at_2017-04-28_0849"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297944196">2017-04-28 08:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-04-28_0849" title="Permanent link">&para;</a></h4>
<p>Only FYI<br />
see
<a href="https://github.com/rear/rear/pull/1334">https://github.com/rear/rear/pull/1334</a><br />
which is an interesting example how complicated things<br />
could get if one likes to use bash arrays with 'set -ue'.</p>
<p>Because of this I meanwhile wonder if 'set -ue' would be really<br />
a good thing for the future because it seems bash with 'set -ue'<br />
works very much against what is "usually expected to work" in bash.<br />
In other words:<br />
I wonder if bash code with 'set -ue' may abort too often<br />
not because of real issues but because of "false alarm"<br />
that result from nitpicking stuff in bash when 'set -ue' is set?</p>
<h4 id="gdha_commented_at_2017-04-28_0854"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297945316">2017-04-28 08:54</a>:<a class="headerlink" href="#gdha_commented_at_2017-04-28_0854" title="Permanent link">&para;</a></h4>
<p>@jsmeix I fully agree with you Johannes - less is sometimes better</p>
<h4 id="jsmeix_commented_at_2017-04-28_0938"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297954640">2017-04-28 09:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-04-28_0938" title="Permanent link">&para;</a></h4>
<p>At least for now (unless others object)<br />
I set the "won't fix" label to this issue<br />
but I will keep it open for some time<br />
so that others could provide more feedback.</p>
<p>Personally I am unsure:</p>
<p>Obviously 'set -ue' enforces programmers to write code<br />
that works more stable because they must care about errors.</p>
<p>On the other hand 'set -ue' may fail more often for users<br />
because bash (as any interpreted programming language)<br />
fails basically only during runtime ('bash -n script.sh' is<br />
insufficient, cf.
<a href="https://github.com/rear/rear/issues/1040">https://github.com/rear/rear/issues/1040</a>)<br />
and all cases where 'set -ue' did not fail for programmers<br />
causes additional failures for users.</p>
<p>On the third ;-) hand those additional failures for users<br />
with 'set -ue' would be reported to ReaR upstream<br />
so that in the end with 'set -ue' ReaR could work much<br />
better (mainly much more reliably) than it works now.</p>
<h4 id="schlomo_commented_at_2017-04-28_1003"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297960017">2017-04-28 10:03</a>:<a class="headerlink" href="#schlomo_commented_at_2017-04-28_1003" title="Permanent link">&para;</a></h4>
<p>IMHO ReaR reached a size and complexity where such strict coding styles
will really help us to maintain and maybe even increase our quality.</p>
<p>If we can't enable it globally we might add it as a development mode
where we maintainers run our tests with strict mode to harden ReaR.</p>
<h4 id="jsmeix_commented_at_2017-04-28_1017"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297962827">2017-04-28 10:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-04-28_1017" title="Permanent link">&para;</a></h4>
<p>My proposal was to use 'set -ue' in new scripts,<br />
cf. "Try to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>Probably also when scripts are so much overhauled<br />
that they got basically rewritten.</p>
<p>Regarding "maybe even increase quality":</p>
<p>I got used to use 'set -eu -o pipefail' when I made<br />
my own generic system installation scrits, see the section<br />
"Generic usage of the plain SUSE installation system ..."<br />
in
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>My own experience when I use 'set -eu' from the beginning<br />
is that I think my scripts become very much better<br />
because I am enforced to care all the time about<br />
any kind of possible errors (up to nitpicking stuff in bash)<br />
but - at least from my personal point of view - the result<br />
works so much better compared to "usual bash scripting".</p>
<h4 id="jsmeix_commented_at_2017-04-28_1033"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-297965594">2017-04-28 10:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-04-28_1033" title="Permanent link">&para;</a></h4>
<p>I think<br />
<a href="https://github.com/rear/rear/issues/1327#issuecomment-297964501">https://github.com/rear/rear/issues/1327#issuecomment-297964501</a><br />
is perhaps a good example how in practice 'set -ue' may work<br />
too much against what is "usually expected to work" in bash<br />
which may let ReaR fail later in perhaps very unexpected ways.</p>
<h4 id="jsmeix_commented_at_2017-09-07_1007"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-327755633">2017-09-07 10:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-07_1007" title="Permanent link">&para;</a></h4>
<p>Because some scripts already use "set -e -u -o pipefail"<br />
we need to implement some verbose error exit trap<br />
for cases where bash exits because of "set -e -u"<br />
so that the user is sufficiently informed what happened<br />
because by default bash exits silently in case of "set -e -u"<br />
and when the user does not actively check the exit code<br />
it would look like a regular finishing program.</p>
<h4 id="jsmeix_commented_at_2017-09-20_1615"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-330903718">2017-09-20 16:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-09-20_1615" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1507">https://github.com/rear/rear/pull/1507</a>
merged<br />
a failure message of the form "rear $WORKFLOW failed ..."<br />
is shown when it exits in any unintended way, in particular<br />
when it exits at an arbitrary command because of 'set -e'.</p>
<h4 id="jsmeix_commented_at_2018-03-07_1036"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-371096730">2018-03-07 10:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-07_1036" title="Permanent link">&para;</a></h4>
<p>Probably
<a href="https://github.com/rear/rear/issues/1747">https://github.com/rear/rear/issues/1747</a>
is another good example<br />
why "set -e -u -o pipefail" can result more problems in practice than it
solves.</p>
<p>Meanwhile I am thinking about a generic wrapper function<br />
for "set -e -u -o pipefail" that only sets it when in debugging mode<br />
cf.
<a href="https://github.com/rear/rear/issues/700#issuecomment-297960017">https://github.com/rear/rear/issues/700#issuecomment-297960017</a><br />
so that in practice for the users out there who do not run ReaR<br />
in debugging mode there are no such unexpected "sudden death"<br />
bash error exits because of any minor (perhaps even irrelevant) stuff<br />
cf.
<a href="https://github.com/rear/rear/issues/700#issuecomment-297944196">https://github.com/rear/rear/issues/700#issuecomment-297944196</a><br />
and
<a href="https://github.com/rear/rear/issues/700#issuecomment-297965594">https://github.com/rear/rear/issues/700#issuecomment-297965594</a></p>
<h4 id="jsmeix_commented_at_2018-03-08_1037"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-371449317">2018-03-08 10:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-03-08_1037" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/commit/32eafc491f793e5b8a510ff8f4219ff9be2a7edf">https://github.com/rear/rear/commit/32eafc491f793e5b8a510ff8f4219ff9be2a7edf</a><br />
is another case where an unconditioned "set -e -u -o pipefail"<br />
caused more problems in practice (i.e. problems for ReaR users)<br />
than it may solve in theory.</p>
<h4 id="jsmeix_commented_at_2022-10-05_1323"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/700#issuecomment-1268428565">2022-10-05 13:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-10-05_1323" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/issues/2871">https://github.com/rear/rear/issues/2871</a><br />
is a nice example where <code>set -eu -o pipefail</code><br />
(therein in particular the <code>set -e</code> part)<br />
would hinder the user to do some "dirty hacks"<br />
to make ReaR behave as he needs it in his specific case.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-11-18.700.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
