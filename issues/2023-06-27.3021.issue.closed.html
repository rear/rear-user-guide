<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3021 Issue closed: systemd private library libsystemd-shared-252.so not found by 'ldd' - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3021 Issue closed: systemd private library libsystemd-shared-252.so not found by \u0027ldd\u0027";
        var mkdocs_page_input_path = "issues/2023-06-27.3021.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3021 Issue closed: systemd private library libsystemd-shared-252.so not found by 'ldd'</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3021_issue_closed_systemd_private_library_libsystemd-shared-252so_not_found_by_ldd"><a href="https://github.com/rear/rear/issues/3021">#3021 Issue</a> <code>closed</code>: systemd private library libsystemd-shared-252.so not found by 'ldd'<a class="headerlink" href="#3021_issue_closed_systemd_private_library_libsystemd-shared-252so_not_found_by_ldd" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>,
<code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="liamfry_opened_issue_at_2023-06-27_0733"><img src="https://avatars.githubusercontent.com/u/2048029?u=bc72e01a4964ac382e1c83852c793b1690b9c957&v=4" width="50"><a href="https://github.com/LiamFry">LiamFry</a> opened issue at <a href="https://github.com/rear/rear/issues/3021">2023-06-27 07:33</a>:<a class="headerlink" href="#liamfry_opened_issue_at_2023-06-27_0733" title="Permanent link">&para;</a></h4>
<p>Backup (<code>rear -v mkbackup</code>) reports that a necessary file is missing. I
don't understand ...</p>
<ul>
<li>ReaR version: Relax-and-Recover 2.7 / Git</li>
<li>OS version: Debian GNU/Linux 12 (bookworm)</li>
<li>ReaR configuration files: (attached)</li>
<li>System architecture: x86_64</li>
<li>Storage layout: (attached)</li>
<li>Description of the issue:<br />
    I am not sure if this is a <code>rear</code> issue yet I cannot find any useful
    information elsewhere. (I've tried!) During backup, I get the
    following message ...</li>
</ul>
<!-- -->

<pre><code>Testing that the recovery system in /var/tmp/rear.PvzABq2iZtXbVTm/rootfs contains a usable system
/usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so requires additional libraries
        libsystemd-shared-252.so =&gt; not found
ReaR recovery system in '/var/tmp/rear.PvzABq2iZtXbVTm/rootfs' needs additional libraries, check /var/log/rear/rear-clara.log for details
</code></pre>
<p><code>dpkg --get-selections | grep libsystemd-shared</code> shows that it's
installed.<br />
<code>dpkg -L libsystemd-shared</code> gives me the following ...</p>
<pre><code>/.
/usr
/usr/lib
/usr/lib/x86_64-linux-gnu
/usr/lib/x86_64-linux-gnu/systemd
/usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so
/usr/lib/x86_64-linux-gnu/systemd/libsystemd-shared-252.so
/usr/share
/usr/share/doc
/usr/share/doc/libsystemd-shared
/usr/share/doc/libsystemd-shared/NEWS.Debian.gz
/usr/share/doc/libsystemd-shared/changelog.Debian.gz
/usr/share/doc/libsystemd-shared/copyright
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/libsystemd-shared
</code></pre>
<p>All that said, a quick <code>find / -name libsystemd-shared-252.so -ls</code>
reports this:</p>
<pre><code>22458549 3252 -rw-r--r-- 1 root root 3327624 Feb 28 06:15 /usr/lib/x86_64-linux-gnu/systemd/libsystemd-shared-252.so
</code></pre>
<p><a href="https://github.com/rear/rear/files/11878771/local.conf.txt">local.conf.txt</a><br />
<a href="https://github.com/rear/rear/files/11878819/storage-layout.txt">storage-layout.txt</a></p>
<h4 id="jsmeix_commented_at_2023-06-27_0906"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609096312">2023-06-27 09:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-27_0906" title="Permanent link">&para;</a></h4>
<p>I am not a Debian user<br />
so I cannot reproduce Debian specific issues.</p>
<p>In general when things are missing in the ReaR recovery system<br />
you could manually add what is needed via something like</p>
<pre><code>LIBS+=( /usr/lib/x86_64-linux-gnu/systemd/libsystemd-shared-252.so )
</code></pre>
<p>or</p>
<pre><code>LIBS+=( /usr/lib/x86_64-linux-gnu/systemd/*.so* )
</code></pre>
<p>in your etc/rear/local.conf file.</p>
<p>See the descriptions about LIBS and COPY_AS_IS<br />
in usr/share/rear/conf/default.conf</p>
<h4 id="pcahyna_commented_at_2023-06-27_0914"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609107548">2023-06-27 09:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-27_0914" title="Permanent link">&para;</a></h4>
<p>I see a similar message on Fedora 37:</p>
<pre><code>Testing that the recovery system in /tmp/rear.OBGH5kwM9RvJv5S/rootfs contains a usable system
There are binaries or libraries in the ReaR recovery system that need additional libraries
/usr/lib/systemd/libsystemd-core-251.14-2.fc37.so requires additional libraries
libsystemd-shared-251.14-2.fc37.so =&gt; not found
</code></pre>
<p>Weird.</p>
<h4 id="liamfry_commented_at_2023-06-27_1028"><img src="https://avatars.githubusercontent.com/u/2048029?u=bc72e01a4964ac382e1c83852c793b1690b9c957&v=4" width="50"><a href="https://github.com/LiamFry">LiamFry</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609228408">2023-06-27 10:28</a>:<a class="headerlink" href="#liamfry_commented_at_2023-06-27_1028" title="Permanent link">&para;</a></h4>
<p>A quick run of
<code>ldd /usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so</code> did
report that <code>libsystemd-shared-252.so</code> was missing. This is damned
odd.<br />
I took my question to the <a href="https://forums.debian.net/viewtopic.php?t=155102">Debian
forums</a>. I'll post
here what I discover.</p>
<h4 id="pcahyna_commented_at_2023-06-27_1054"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609266008">2023-06-27 10:54</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-06-27_1054" title="Permanent link">&para;</a></h4>
<p>Similar on Fedora 37:</p>
<pre><code># ldd /usr/lib/systemd/libsystemd-core-251.14-2.fc37.so 
        linux-vdso.so.1 (0x00007ffefb5d6000)
        libsystemd-shared-251.14-2.fc37.so =&gt; not found
</code></pre>
<p>libsystemd-shared-251.14-2.fc37.so is actually in /usr/lib/systemd .</p>
<h4 id="jsmeix_commented_at_2023-06-27_1056"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609268113">2023-06-27 10:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-27_1056" title="Permanent link">&para;</a></h4>
<p>I guess that the RequiredSharedObjects function in ReaR<br />
does not get called for libsystemd-core-252.so<br />
so libsystemd-shared-252.so is not automatically<br />
included into the ReaR recovery system.</p>
<p>RequiredSharedObjects is called in<br />
build/GNU/Linux/390_copy_binaries_libraries.sh<br />
for all existing programs in PROGS and REQUIRED_PROGS<br />
and for all libraries in LIBS via</p>
<pre><code>local all_libs=( "${LIBS[@]}" $( RequiredSharedObjects "${all_binaries[@]}" "${LIBS[@]}" ) )
</code></pre>
<p>and RequiredSharedObjects is called in<br />
build/GNU/Linux/100_copy_as_is.sh<br />
for all executable files in COPY_AS_IS via</p>
<pre><code>for required_library in $( RequiredSharedObjects "${copy_as_is_executables[@]}" ) ; do
</code></pre>
<p>So when libsystemd-core-252.so is not specified in LIBS<br />
but gets included into the recovery system via COPY_AS_IS<br />
and when libsystemd-core-252.so is not an executable file<br />
then RequiredSharedObjects is not called for libsystemd-core-252.so<br />
so libsystemd-shared-252.so gets not automatically included<br />
and when libsystemd-shared-252.so is not explicitly<br />
specified to be included into the recovery system<br />
then libsystemd-shared-252.so is missing in the recovery system.</p>
<h4 id="jsmeix_commented_at_2023-06-27_1058"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609271824">2023-06-27 10:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-27_1058" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
Ah!<br />
It seems the library configuration on the original system<br />
(i.e. things like <code>ldconfig</code> and so on)<br />
could be incomplete when <code>ldd</code> does not find it.</p>
<h4 id="jsmeix_commented_at_2023-06-27_1106"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609283508">2023-06-27 11:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-27_1106" title="Permanent link">&para;</a></h4>
<p>FYI:</p>
<p>On my current openSUSE Leap 15.4 system<br />
I have systemd-249.16 which contains only<br />
/usr/lib/systemd/libsystemd-shared-249.so<br />
and I noticed no issues with that in ReaR.</p>
<p>After "rear -D mkrescue" I get:</p>
<pre><code># find /var/tmp/rear.Dw2DUk0fyAfXiN6/rootfs | grep libsystemd

/var/tmp/rear.Dw2DUk0fyAfXiN6/rootfs/usr/lib64/libsystemd.so.0
/var/tmp/rear.Dw2DUk0fyAfXiN6/rootfs/usr/lib64/libsystemd.so.0.32.0
/var/tmp/rear.Dw2DUk0fyAfXiN6/rootfs/usr/lib/systemd/libsystemd-shared-249.so
</code></pre>
<p>and my var/log/rear/rear-HOSTNAME.log contains</p>
<pre><code>+ source /root/rear.github.master/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh
...
++ Log 'Adding required libraries of executables in all the copied files to LIBS'
...
2023-06-27 13:23:44.707937689 Adding required library '/usr/lib/systemd/libsystemd-shared-249.so' to LIBS
...
2023-06-27 13:23:45.113024540 Adding required library '/usr/lib64/libsystemd.so.0' to LIBS
.
.
.
+ source /root/rear.github.master/usr/share/rear/build/GNU/Linux/390_copy_binaries_libraries.sh
...
2023-06-27 13:23:53.056375594 Libraries being copied: ... /usr/lib/systemd/libsystemd-shared-249.so ... /usr/lib64/libsystemd.so.0 ...
</code></pre>
<p>As far as I see in particular in<br />
usr/share/rear/prep/GNU/Linux/280_include_systemd.sh<br />
and in usr/share/rear/conf/GNU/Linux.conf<br />
it seems that<br />
libsystemd-shared-249.so and libsystemd.so.0<br />
are not specified in LIBS<br />
but get included into the recovery system<br />
via executables in COPY_AS_IS or<br />
via programs in PROGS and REQUIRED_PROGS<br />
which should normally be the preferred way<br />
according to my reasoning in<br />
<a href="https://github.com/rear/rear/issues/2743">https://github.com/rear/rear/issues/2743</a></p>
<h4 id="liamfry_commented_at_2023-06-28_0853"><img src="https://avatars.githubusercontent.com/u/2048029?u=bc72e01a4964ac382e1c83852c793b1690b9c957&v=4" width="50"><a href="https://github.com/LiamFry">LiamFry</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1611023730">2023-06-28 08:53</a>:<a class="headerlink" href="#liamfry_commented_at_2023-06-28_0853" title="Permanent link">&para;</a></h4>
<p>I found <a href="https://answers.launchpad.net/ubuntu/+question/703825">this
post</a> that
offered some "solutions." Even though the question was asked for Ubuntu,
I found it helpful for Debian.</p>
<p>TL;DR</p>
<p>One-off solution:</p>
<p><code>sudo bash -c "LD_PRELOAD=/usr/lib/x86_64-linux-gnu/systemd/libsystemd-shared-252.so" rear -v mkbackup</code><br />
(untested)</p>
<p>... OR ...</p>
<p>create an file in <code>/etc/ld.so.conf.d</code><br />
(This is the method I chose.)</p>
<p>I created <code>/etc/ld.so.conf.d/libsystemd-core.conf</code><br />
... into which I put <code>/usr/lib/x86_64-linux-gnu/systemd</code><br />
I then ran <code>sudo ldconfig</code></p>
<p>A run of <code>ldd /usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so</code>
now resolves <code>libsystemd-shared-252.so</code></p>
<p>I rebooted for good measure and ran a straight <code>rear -v mkbackup</code> -- it
ran flawlessly.</p>
<p>I suppose why <code>libsystemd-core-252.so</code> has this issue is a question for
the distro and subsystem teams.</p>
<h4 id="ekool_commented_at_2023-08-08_0349"><img src="https://avatars.githubusercontent.com/u/198732?v=4" width="50"><a href="https://github.com/ekool">ekool</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1668863055">2023-08-08 03:49</a>:<a class="headerlink" href="#ekool_commented_at_2023-08-08_0349" title="Permanent link">&para;</a></h4>
<p>I just want to add that the above post from LiamFry fixed it for me as
well.</p>
<h4 id="sid-the-sloth_commented_at_2023-08-22_1931"><img src="https://avatars.githubusercontent.com/u/1720282?u=65c9ca83f806b1ed61bd91c8ea327aa32a988ce7&v=4" width="50"><a href="https://github.com/sid-the-sloth">sid-the-sloth</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1688809055">2023-08-22 19:31</a>:<a class="headerlink" href="#sid-the-sloth_commented_at_2023-08-22_1931" title="Permanent link">&para;</a></h4>
<blockquote>
<p>sudo ldconf</p>
</blockquote>
<p>This solution from @LiamFry worked -- but on Debian should do
<code>sudo ldconfig</code> instead.</p>
<h4 id="liamfry_commented_at_2023-09-12_0649"><img src="https://avatars.githubusercontent.com/u/2048029?u=bc72e01a4964ac382e1c83852c793b1690b9c957&v=4" width="50"><a href="https://github.com/LiamFry">LiamFry</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1715102208">2023-09-12 06:49</a>:<a class="headerlink" href="#liamfry_commented_at_2023-09-12_0649" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<p>sudo ldconf</p>
</blockquote>
<p>This solution from @LiamFry worked -- but on Debian should do
<code>sudo ldconfig</code> instead.</p>
</blockquote>
<p>Thanks for the correction! I updated my "potential solution," above.</p>
<h4 id="zdefz_commented_at_2023-10-05_1822"><img src="https://avatars.githubusercontent.com/u/24463722?v=4" width="50"><a href="https://github.com/zDEFz">zDEFz</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1749426357">2023-10-05 18:22</a>:<a class="headerlink" href="#zdefz_commented_at_2023-10-05_1822" title="Permanent link">&para;</a></h4>
<p>TLDR;</p>
<p>Had to edit /usr/sbin/rear and add</p>
<pre><code>export LD_PRELOAD=/usr/lib64/systemd/libsystemd-shared-253.10-1.fc38.so
</code></pre>
<p>as other solutions did NOT work.</p>
<p>This is a confusing thing.</p>
<p>Tried ... for Fedora 38:</p>
<pre><code>echo "/usr/lib/systemd" | sudo tee -a /etc/ld.so.conf.d/libsystemd-core.conf
sudo ldconfig
</code></pre>
<p>Then reboot.<br />
<strong>Issue still perists</strong><br />
<a href="http://ix.io/4IfE">http://ix.io/4IfE</a></p>
<pre><code>sudo dnf install systemd-libs-253.2-1.fc38.x86_64

 ldd /usr/lib64/systemd/libsystemd-core-253.2-1.fc38.so
    linux-vdso.so.1 (0x00007fff0f133000)
    libsystemd-shared-253.2-1.fc38.so =&gt; not found
    libseccomp.so.2 =&gt; /lib64/libseccomp.so.2 (0x00007fcde1524000)
    libpam.so.0 =&gt; /lib64/libpam.so.0 (0x00007fcde1512000)
    libaudit.so.1 =&gt; /lib64/libaudit.so.1 (0x00007fcde14e3000)
    libkmod.so.2 =&gt; /lib64/libkmod.so.2 (0x00007fcde14c7000)
    libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fcde149a000)
    libmount.so.1 =&gt; /lib64/libmount.so.1 (0x00007fcde1452000)
    libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fcde142e000)
    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fcde1022000)
    libeconf.so.0 =&gt; /lib64/libeconf.so.0 (0x00007fcde1421000)
    libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fcde0f41000)
    libcap-ng.so.0 =&gt; /lib64/libcap-ng.so.0 (0x00007fcde1418000)
    libzstd.so.1 =&gt; /lib64/libzstd.so.1 (0x00007fcde0e85000)
    liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007fcde0e52000)
    libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fcde0e38000)
    libcrypto.so.3 =&gt; /lib64/libcrypto.so.3 (0x00007fcde0a00000)
    libpcre2-8.so.0 =&gt; /lib64/libpcre2-8.so.0 (0x00007fcde0966000)
    /lib64/ld-linux-x86-64.so.2 (0x00007fcde1573000)
    libblkid.so.1 =&gt; /lib64/libblkid.so.1 (0x00007fcde092e000)
</code></pre>
<p>dnf provides
<a href="http://libsystemd-shared-253.2-1.fc38.so/">libsystemd-shared-253.2-1.fc38.so</a>
resolves to systemd-253.2-1.fc38.x86_64 but ldd
/usr/lib/systemd/libsystemd-core-253.2-1.fc38.so</p>
<pre><code>export LD_LIBRARY_PATH=/usr/lib/systemd
export LD_LIBRARY_PATH=/usr/lib64/systemd
</code></pre>
<p>still same issue.</p>
<h4 id="ufreier_commented_at_2023-11-15_1915"><img src="https://avatars.githubusercontent.com/u/20521957?v=4" width="50"><a href="https://github.com/ufreier">ufreier</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1813114101">2023-11-15 19:15</a>:<a class="headerlink" href="#ufreier_commented_at_2023-11-15_1915" title="Permanent link">&para;</a></h4>
<p>Yes, the solution from @LiamFry works in the sense of building a rescue
system without errors. BUT ... has anyone successfully booted the system
with another device than the original? I have 2 identical servers (one
as a cold stand-by) each only with one nvme-ssd and I'm not able to boot
'the other one' with the rescue system (simulating a ssd crash and its
replacement). Same env like LiamFry (Debian 12, ReaR 2.7) and same
settings for rescue medium like in its local.conf. I tried Debian
installations with Legacy and UEFI boot, OUTPUT=USB and OUTPUT=RAWDISK -
each try to boot the other one results in hanging after 'Booting rescue
system' (UEFI) resp. after 'Probing EDD (edd=off ..) ok'. (Legacy) with
no errors but only power reset helps. However, the server where the
rescue medium was created boots both (USB and dd'ed RAWDISK). So I
suspect there is something on the original device that is needed for
booting the rescue medium, that would be worse in case of a real crash.
I only have this problem in Debian 12, f.i. in Ubuntu 22.04 ReaR works
like expected but I don't want to switch ...</p>
<h4 id="jsmeix_commented_at_2023-11-16_0712"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1813901706">2023-11-16 07:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-11-16_0712" title="Permanent link">&para;</a></h4>
<p>@ufreier<br />
only as a side note FYI regarding</p>
<pre><code>hanging after 'Probing EDD (edd=off ..) ok'
</code></pre>
<p>see<br />
<a href="https://github.com/rear/rear/issues/2955#issuecomment-1465642166">https://github.com/rear/rear/issues/2955#issuecomment-1465642166</a></p>
<p>Check your ReaR recovery system kernel command line arguments<br />
with your Debian 12 versus with your Ubuntu 22.04<br />
and look for "console=..." settings.</p>
<p>E.g. for BIOS you can get the<br />
ReaR recovery system kernel command line arguments<br />
by selecting in the ReaR recovery system boot menue<br />
the topmost entry of the form "Recover HOSTNAME" and then<br />
pressing the [Tab] key which shows the kernel command line.</p>
<h4 id="pcahyna_commented_at_2023-11-16_1743"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1814932231">2023-11-16 17:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-16_1743" title="Permanent link">&para;</a></h4>
<p>@ufreier I suspect that the issue you are encountering is unrelated to
the warning message about libsystemd-shared-252.so not found. Can you
please open a separate report?</p>
<h4 id="ufreier_commented_at_2023-11-20_1525"><img src="https://avatars.githubusercontent.com/u/20521957?v=4" width="50"><a href="https://github.com/ufreier">ufreier</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1819280116">2023-11-20 15:25</a>:<a class="headerlink" href="#ufreier_commented_at_2023-11-20_1525" title="Permanent link">&para;</a></h4>
<p>@jsmeix : thanks a lot, USE_SERIAL_CONSOLE='no' was the solution!</p>
<h4 id="jsmeix_commented_at_2023-11-21_0757"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1820407336">2023-11-21 07:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-11-21_0757" title="Permanent link">&para;</a></h4>
<p>@ufreier<br />
you are welcome</p>
<h4 id="pcahyna_commented_at_2023-11-22_1048"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1822532382">2023-11-22 10:48</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-22_1048" title="Permanent link">&para;</a></h4>
<p>@ufreier how old is ReaR that you are using? Is it the released 2.7, or
current development code from GitHub? With the current code,
USE_SERIAL_CONSOLE='no' should not be needed in most cases (after
#2961 was merged).</p>
<h4 id="ufreier_commented_at_2023-11-22_1652"><img src="https://avatars.githubusercontent.com/u/20521957?v=4" width="50"><a href="https://github.com/ufreier">ufreier</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1823139774">2023-11-22 16:52</a>:<a class="headerlink" href="#ufreier_commented_at_2023-11-22_1652" title="Permanent link">&para;</a></h4>
<p>I use ReaR from the Debian repository (simply 'apt install rear') but
I'll check the latest version from here.</p>
<h4 id="pcahyna_commented_at_2023-11-22_1730"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1823198348">2023-11-22 17:30</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-22_1730" title="Permanent link">&para;</a></h4>
<p>@ufreier I believe this may explain it, please try the latest sources
without USE_SERIAL_CONSOLE='no' ( here's how to use ReaR from Git
sources instead from a package:
<a href="https://github.com/rear/rear/#quick-start-guide">https://github.com/rear/rear/#quick-start-guide</a>
)</p>
<h4 id="ufreier_commented_at_2023-11-25_1226"><img src="https://avatars.githubusercontent.com/u/20521957?v=4" width="50"><a href="https://github.com/ufreier">ufreier</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1826296686">2023-11-25 12:26</a>:<a class="headerlink" href="#ufreier_commented_at_2023-11-25_1226" title="Permanent link">&para;</a></h4>
<p>I can confirm using the latest version USE_SERIAL_CONSOLE='no' is not
necessary anymore.</p>
<h4 id="pcahyna_commented_at_2023-11-27_1032"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1827565743">2023-11-27 10:32</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-11-27_1032" title="Permanent link">&para;</a></h4>
<p>thank you @ufreier for the test, I am glad that we now understand the
problem and have a fix in the devel version.</p>
<h4 id="kronenpj_commented_at_2023-12-04_0315"><img src="https://avatars.githubusercontent.com/u/286689?v=4" width="50"><a href="https://github.com/kronenpj">kronenpj</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1837773233">2023-12-04 03:15</a>:<a class="headerlink" href="#kronenpj_commented_at_2023-12-04_0315" title="Permanent link">&para;</a></h4>
<p>I believe I was having the same problem and the code in git as of now
(rear-2.7-1.git.2.0fd8a77a.master) works far better than 2.6 on Fedora
39. I look forward to this being picked up by Fedora's repositories. :)</p>
<h4 id="tbsky_commented_at_2023-12-07_0900"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1844942366">2023-12-07 09:00</a>:<a class="headerlink" href="#tbsky_commented_at_2023-12-07_0900" title="Permanent link">&para;</a></h4>
<p>Hi:<br />
I was curious what need to be fixed to prevent the issue. so I ask at
systemd mail list. it seems rear itself need to handle the
situation...<br />
<a href="https://lists.freedesktop.org/archives/systemd-devel/2023-November/049676.html">https://lists.freedesktop.org/archives/systemd-devel/2023-November/049676.html</a></p>
<h4 id="jsmeix_commented_at_2023-12-07_1029"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1845086297">2023-12-07 10:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-07_1029" title="Permanent link">&para;</a></h4>
<p>Excerpts from<br />
<a href="https://lists.freedesktop.org/archives/systemd-devel/2023-November/049676.html">https://lists.freedesktop.org/archives/systemd-devel/2023-November/049676.html</a></p>
<pre><code>Those libraries are not found by ldd because
they are not in the public library search path.
...
Those libraries have an unstable ABI,
so they are tucked away in a separate directory
and are not intended to be found during a search
</code></pre>
<p>When intentionally libraries cannot be found by 'ldd'<br />
then such libraries must be explicitly specified<br />
via LIBS, see its description in default.conf<br />
e.g. for ReaR 2.7 online starting at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1517">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/conf/default.conf#L1517</a></p>
<h4 id="tbsky_commented_at_2023-12-08_0523"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1846565153">2023-12-08 05:23</a>:<a class="headerlink" href="#tbsky_commented_at_2023-12-08_0523" title="Permanent link">&para;</a></h4>
<p>Hi:<br />
I don't know if systemd is meant to be "Special library files" as
described in the default.conf. since systemd is used by most
distributions, every user will need to handle that. I just thought if
distribution packager or rear itself can do something so users won't
need to take care of systemd issues in the future.</p>
<h4 id="jsmeix_commented_at_2023-12-08_0745"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1846708829">2023-12-08 07:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-12-08_0745" title="Permanent link">&para;</a></h4>
<p>I meant that ReaR will have to be enhanced<br />
to somehow deal with newer systemd's "hidden" libraries.<br />
We have some code to include systemd into the ReaR recovery system<br />
and that code would have to be somehow enhanced because that code<br />
is meant to get some consistent systemd things (minimal as needed)<br />
into the ReaR recovery system.<br />
Currently with newer systemd things are inconsistent in the<br />
ReaR recovery system (some "hidden" libraries are missing)<br />
so the missing things must be added to the ReaR recovery system.</p>
<p>Until the ReaR upstream GitHub master code was enhanced<br />
to properly deal with newer systemd's "hidden" libraries<br />
all users with newer systemd and older or current ReaR<br />
need to manually specify the missing libraries via LIBS<br />
as I described above in<br />
<a href="https://github.com/rear/rear/issues/3021#issuecomment-1609096312">https://github.com/rear/rear/issues/3021#issuecomment-1609096312</a></p>
<p>FWIW:<br />
I think LD_PRELOAD stuff doesn't solve it because<br />
I don't see how that makes the missing libraries<br />
get included in the ReaR recovery system.<br />
I fear LD_PRELOAD stuff only makes "rear recover" don't fail<br />
but I don't see how that also makes "rear recover" work?<br />
I don't see "rear recover" mentioned in the comments above.<br />
But this is only what I think off the top of my head.<br />
I did not test with newer systemd.<br />
I only did<br />
<a href="https://github.com/rear/rear/issues/3021#issuecomment-1609283508">https://github.com/rear/rear/issues/3021#issuecomment-1609283508</a><br />
Even if LD_PRELOAD stuff solves it<br />
I think specifying the missing libraries via LIBS<br />
is the right method in ReaR that is meant for such things<br />
while LD_PRELOAD stuff would implement RFC1925 item (6a).</p>
<h4 id="zdefz_commented_at_2023-12-08_1041"><img src="https://avatars.githubusercontent.com/u/24463722?v=4" width="50"><a href="https://github.com/zDEFz">zDEFz</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1846941561">2023-12-08 10:41</a>:<a class="headerlink" href="#zdefz_commented_at_2023-12-08_1041" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I meant that ReaR will have to be enhanced to somehow deal with newer
systemd's "hidden" libraries. We have some code to include systemd
into the ReaR recovery system and that code would have to be somehow
enhanced because that code is meant to get some consistent systemd
things (minimal as needed) into the ReaR recovery system. Currently
with newer systemd things are inconsistent in the ReaR recovery system
(some "hidden" libraries are missing) so the missing things must be
added to the ReaR recovery system.</p>
<p>Until the ReaR upstream GitHub master code was enhanced to properly
deal with newer systemd's "hidden" libraries all users with newer
systemd and older or current ReaR need to manually specify the missing
libraries via LIBS as I described above in <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609096312">#3021
(comment)</a></p>
<p>FWIW: I think LD_PRELOAD stuff doesn't solve it because I don't see
how that makes the missing libraries get included in the ReaR recovery
system. I fear LD_PRELOAD stuff only makes "rear recover" don't fail
but I don't see how that also makes "rear recover" work? I don't see
"rear recover" mentioned in the comments above. But this is only what
I think off the top of my head. I did not test with newer systemd. I
only did <a href="https://github.com/rear/rear/issues/3021#issuecomment-1609283508">#3021
(comment)</a>
Even if LD_PRELOAD stuff solves it I think specifying the missing
libraries via LIBS is the right method in ReaR that is meant for such
things while LD_PRELOAD stuff would implement RFC1925 item (6a).</p>
</blockquote>
<p>As said, the only thing fixing it for me was to edit the rear script and
add<br />
<code>export LD_PRELOAD=/usr/lib64/systemd/libsystemd-shared-253.10-1.fc38.so</code></p>
<h4 id="kronenpj_commented_at_2023-12-08_1445"><img src="https://avatars.githubusercontent.com/u/286689?v=4" width="50"><a href="https://github.com/kronenpj">kronenpj</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1847305435">2023-12-08 14:45</a>:<a class="headerlink" href="#kronenpj_commented_at_2023-12-08_1445" title="Permanent link">&para;</a></h4>
<p>After playing around for a bit, the only way I was able to remove the
error was using a file in <code>/etc/ld.so.conf.d</code>. Adding entries to <code>LIBS</code>,
<code>COPY_AS_IS</code> and others didn't work. I believe that's because even when
the files exist in the correct path, the test and subsequent ISO-booted
system doesn't know to look there.</p>
<p>On my Fedora system, an <code>ldd /usr/lib/systemd/systemd</code> shows:</p>
<pre><code># ldd /usr/lib/systemd/systemd
    linux-vdso.so.1 (0x00007ffd42e1f000)
    libsystemd-core-254.7-1.fc39.so =&gt; /usr/lib64/systemd/libsystemd-core-254.7-1.fc39.so (0x00007f8e19600000)
    libsystemd-shared-254.7-1.fc39.so =&gt; /usr/lib64/systemd/libsystemd-shared-254.7-1.fc39.so (0x00007f8e19200000)
   ...
</code></pre>
<p>But the systemd executable is only added to the <code>initrd.cgz</code> file when
the file referencing <code>/usr/lib64/systemd</code> is present in
<code>/etc/ld.so.conf.d</code>.</p>
<p>I hope this helps.</p>
<h4 id="rasa_commented_at_2023-12-28_0007"><img src="https://avatars.githubusercontent.com/u/220772?u=b296a5d7e1ff29391430189c40855f1c75e1c3c3&v=4" width="50"><a href="https://github.com/rasa">rasa</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1870704187">2023-12-28 00:07</a>:<a class="headerlink" href="#rasa_commented_at_2023-12-28_0007" title="Permanent link">&para;</a></h4>
<p>To be clear, the command</p>
<pre><code>sudo tee &lt;&lt;&lt;'/usr/lib/x86_64-linux-gnu/systemd' /etc/ld.so.conf.d/x86_64-linux-gnu-systemd.conf
sudo ldconfig
</code></pre>
<p>removed the error message from the logs, on Ubuntu 23.10 (Mantic).</p>
<h4 id="schlomo_commented_at_2024-01-29_1745"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-1915254105">2024-01-29 17:45</a>:<a class="headerlink" href="#schlomo_commented_at_2024-01-29_1745" title="Permanent link">&para;</a></h4>
<p>It seems like a possible "root cause" could be the fact that our way of
checking for hidden library dependencies with <code>cd</code> and <code>ldd</code> doesn't
work in all cases<br />
<a href="https://github.com/rear/rear/blob/58d6ec23941557af097def87ea25b13d340f834a/usr/share/rear/build/default/990_verify_rootfs.sh#L179">https://github.com/rear/rear/blob/58d6ec23941557af097def87ea25b13d340f834a/usr/share/rear/build/default/990_verify_rootfs.sh#L179</a></p>
<p>Maybe a solution would be to search for all <code>lib*</code> directories in the
rescue system and use them as <code>LD_LIBRARY_PATH</code>? Or is that too extreme?</p>
<p>I think that there is value to removing such false warnings as they tend
to confuse or scare users. And they make it so much harder to pick up
real errors.</p>
<h4 id="github-actions_commented_at_2024-03-30_0159"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2027873740">2024-03-30 01:59</a>:<a class="headerlink" href="#github-actions_commented_at_2024-03-30_0159" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<h4 id="schlomo_commented_at_2024-04-12_1458"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2051927944">2024-04-12 14:58</a>:<a class="headerlink" href="#schlomo_commented_at_2024-04-12_1458" title="Permanent link">&para;</a></h4>
<p>@rear/contributors I think that this problem is somewhat specific to
Systemd after a certain version, at least 252 and later show this. The
general problem is "hidden" libraries and we won't be able to solve it
in a generic fashion.</p>
<p>For quite some proprietary backup software we already added support for
a "custom" <code>LD_LIBRARY_PATH</code> and I would suggest extending that
mechanism to also include a customer <code>LD_LIBRARY_PATH</code> for Systemd to
satisfy our <code>ldd</code> validation. It won't affect the rescue system if we do
it only in ReaR itself for the validation of libraries.</p>
<p>Maybe in the future we will meet more "special" standard software that
needs a custom library path, and then we should again accomodate it.</p>
<h4 id="greasymonkee_commented_at_2024-05-28_0328"><img src="https://avatars.githubusercontent.com/u/13631259?v=4" width="50"><a href="https://github.com/GreasyMonkee">GreasyMonkee</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2134285470">2024-05-28 03:28</a>:<a class="headerlink" href="#greasymonkee_commented_at_2024-05-28_0328" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I found <a href="https://answers.launchpad.net/ubuntu/+question/703825">this
post</a> that
offered some "solutions." Even though the question was asked for
Ubuntu, I found it helpful for Debian.</p>
<p>TL;DR</p>
<p>One-off solution:</p>
<p><code>sudo bash -c "LD_PRELOAD=/usr/lib/x86_64-linux-gnu/systemd/libsystemd-shared-252.so" rear -v mkbackup</code>
(untested)</p>
<p>... OR ...</p>
<p>create an file in <code>/etc/ld.so.conf.d</code> (This is the method I chose.)</p>
<p>I created <code>/etc/ld.so.conf.d/libsystemd-core.conf</code> ... into which I
put <code>/usr/lib/x86_64-linux-gnu/systemd</code> I then ran <code>sudo ldconfig</code></p>
<p>A run of
<code>ldd /usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so</code> now
resolves <code>libsystemd-shared-252.so</code></p>
<p>I rebooted for good measure and ran a straight <code>rear -v mkbackup</code> --
it ran flawlessly.</p>
<p>I suppose why <code>libsystemd-core-252.so</code> has this issue is a question
for the distro and subsystem teams.</p>
</blockquote>
<p>Fedora 41 (Rawhide) using libsystemd-256-rc2-1 has the same behaviour.</p>
<p>Applied Liam Fry's fix of creating
<code>/etc/ld.so.conf.d/libsystemd-core.conf</code> ... into which I put
<code>/usr/lib64/systemd</code> I then ran <code>sudo ldconfig</code> has given a clean
creation of the Backup image.</p>
<p>Many thanks for the whole team here for their contributions.</p>
<p>Cheers,<br />
Garth.</p>
<h4 id="schlomo_commented_at_2024-05-28_0753"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2134569245">2024-05-28 07:53</a>:<a class="headerlink" href="#schlomo_commented_at_2024-05-28_0753" title="Permanent link">&para;</a></h4>
<p>Thank you @GreasyMonkee for the test on Rawhide. I think that we should
note that the <code>libsystemd-shared</code> library is <em>private</em> to systemd and
therefore not part of the regular library search path. ReaR shows an
error because ReaR checks all binaries for library dependencies and we
need to extend that mechanism to also properly handle private libraries.</p>
<p>As a workaround I think it is OK to modify/hack ReaR - I'd caution
against modifying the system in a way that works against the systemd
design of keeping this library private. Maybe it has no negative side
effect, but maybe it can do more harm somewhere else where you didn't
expect it.</p>
<h4 id="greasymonkee_commented_at_2024-05-28_1025"><img src="https://avatars.githubusercontent.com/u/13631259?v=4" width="50"><a href="https://github.com/GreasyMonkee">GreasyMonkee</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2134874403">2024-05-28 10:25</a>:<a class="headerlink" href="#greasymonkee_commented_at_2024-05-28_1025" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Thank you @GreasyMonkee for the test on Rawhide. I think that we
should note that the <code>libsystemd-shared</code> library is <em>private</em> to
systemd and therefore not part of the regular library search path.
ReaR shows an error because ReaR checks all binaries for library
dependencies and we need to extend that mechanism to also properly
handle private libraries.</p>
<p>As a workaround I think it is OK to modify/hack ReaR - I'd caution
against modifying the system in a way that works against the systemd
design of keeping this library private. Maybe it has no negative side
effect, but maybe it can do more harm somewhere else where you didn't
expect it.</p>
</blockquote>
<p>Yes, agreed. I will be keeping an eye on how things behave over the
coming months, if any issues crop up, shall let you know.</p>
<h4 id="jsmeix_commented_at_2024-06-13_0838"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2165007163">2024-06-13 08:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-06-13_0838" title="Permanent link">&para;</a></h4>
<p>By chance I needed to try out ReaR on a Fedora 40 system, see<br />
<a href="https://github.com/rear/rear/pull/3175#issuecomment-2163116469">https://github.com/rear/rear/pull/3175#issuecomment-2163116469</a><br />
and subsequent comments therein and see also<br />
<a href="https://github.com/rear/rear/issues/3247">https://github.com/rear/rear/issues/3247</a></p>
<p>So I experienced this issue here myself.</p>
<p>What I found out:</p>
<p>With some recent systemd version<br />
'rear -D mkrescue' shows something like:</p>
<pre><code>Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
/usr/lib64/systemd/libsystemd-core-255.4-1.fc40.so requires additional libraries
    libsystemd-shared-255.4-1.fc40.so =&gt; not found
ReaR recovery system in '/var/tmp/rear.nHDN0gSTgC8zE80/rootfs' needs additional libraries, check /root/rear.github.master/var/log/rear/rear-linux.log for details
</code></pre>
<p>But</p>
<pre><code>COPY_AS_IS+=( /usr/lib64/systemd/ )
</code></pre>
<p>does not help because those libraries<br />
get already automatically included via<br />
('rear -D mkrescue' log file excerpts)</p>
<pre><code>+ source /root/rear.github.master/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh
...
... Adding required library '/usr/lib64/systemd/libsystemd-core-255.4-1.fc40.so' to LIBS
... Adding required library '/usr/lib64/systemd/libsystemd-shared-255.4-1.fc40.so' to LIBS
</code></pre>
<p>So one gets them in the ReaR recovery system</p>
<pre><code># find /var/tmp/rear.nHDN0gSTgC8zE80/rootfs/ -type f | grep libsystemd-

/var/tmp/rear.nHDN0gSTgC8zE80/rootfs/usr/lib64/systemd/libsystemd-core-255.4-1.fc40.so
/var/tmp/rear.nHDN0gSTgC8zE80/rootfs/usr/lib64/systemd/libsystemd-shared-255.4-1.fc40.so
</code></pre>
<p>Also something like</p>
<pre><code>NON_FATAL_BINARIES_WITH_MISSING_LIBRARY='systemd/libsystemd-core'
</code></pre>
<p>does not help to silence the message because<br />
usr/share/rear/build/default/990_verify_rootfs.sh<br />
has a comment that explains</p>
<pre><code># Only for programs (i.e. files in a .../bin/... or .../sbin/... directory) treat a missing library as fatal
</code></pre>
<p>So - at least for now - a message like</p>
<pre><code>/usr/lib64/systemd/libsystemd-core-255.4-1.fc40.so requires additional libraries
    libsystemd-shared-255.4-1.fc40.so =&gt; not found
</code></pre>
<p>can only be ignored.</p>
<p>It is some kind of "false positive" but currently<br />
I have no good idea how to avoid that without<br />
breaking the intent of that verification step<br />
i.e. without the risk of getting "false negatives"<br />
which would be worse that this "false positive".</p>
<p>Here "positive" and "negative" are meant<br />
regarding the test to report missing libraries, i.e.<br />
"positive" means it correctly reported a missing library<br />
"negative" means it correctly did not report a library<br />
that can be found in the ReaR recovery system.</p>
<h4 id="jsmeix_commented_at_2024-06-13_1200"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2165453757">2024-06-13 12:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-06-13_1200" title="Permanent link">&para;</a></h4>
<p>Only a totally untested offhanded idea<br />
how to possibly solve such issues generically:</p>
<p>The crucial part here is that<br />
libsystemd-shared is needed by libsystemd-core<br />
but libsystemd-shared cannot be found as usual (i.e. by 'ldd')<br />
regardless that libsystemd-shared exists in the<br />
ReaR recovery system.</p>
<p>So my basic idea is to add a verification step<br />
that tests whether or not a library that is needed<br />
but cannot be found by usual means (i.e. by 'ldd')<br />
exists nevertheless in the ReaR recovery system.</p>
<p>When it exists nevertheless in the ReaR recovery system<br />
we may sufficiently safely assume that things are OK<br />
and not report that library as missing.</p>
<h4 id="jsmeix_commented_at_2024-06-14_1340"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2168079897">2024-06-14 13:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-06-14_1340" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/3250">https://github.com/rear/rear/pull/3250</a><br />
implements<br />
<a href="https://github.com/rear/rear/issues/3021#issuecomment-2165453757">https://github.com/rear/rear/issues/3021#issuecomment-2165453757</a></p>
<h4 id="jsmeix_commented_at_2024-06-18_1149"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3021#issuecomment-2175910408">2024-06-18 11:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2024-06-18_1149" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/pull/3250">https://github.com/rear/rear/pull/3250</a><br />
merged this issue should be sufficiently solved.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-06-27.3021.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
