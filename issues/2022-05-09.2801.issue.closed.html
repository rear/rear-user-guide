<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2801 Issue closed: Broken 'part' entries in disklayout.conf in case of 'unknown' partition table - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2801 Issue closed: Broken \u0027part\u0027 entries in disklayout.conf in case of \u0027unknown\u0027 partition table";
        var mkdocs_page_input_path = "issues/2022-05-09.2801.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2801 Issue closed: Broken 'part' entries in disklayout.conf in case of 'unknown' partition table</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2801_issue_closed_broken_part_entries_in_disklayoutconf_in_case_of_unknown_partition_table"><a href="https://github.com/rear/rear/issues/2801">#2801 Issue</a> <code>closed</code>: Broken 'part' entries in disklayout.conf in case of 'unknown' partition table<a class="headerlink" href="#2801_issue_closed_broken_part_entries_in_disklayoutconf_in_case_of_unknown_partition_table" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="tpatel80_opened_issue_at_2022-05-09_1851"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> opened issue at <a href="https://github.com/rear/rear/issues/2801">2022-05-09 18:51</a>:<a class="headerlink" href="#tpatel80_opened_issue_at_2022-05-09_1851" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.6 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OS_VENDOR=RedHatEnterpriseServer
OS_VERSION=8.2
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>KEEP_BUILD_DIR=""
OUTPUT=ISO
BACKUP=NETFS
BACKUP_PROG=tar
BACKUP_TYPE=incremental
BACKUP_PROG_OPTIONS+=( --anchored --xattrs --xattrs-include=security.capability )
FULLBACKUPDAY="Mon"
BACKUP_PROG_EXCLUDE=('/var/log/*'  '/fs/site*' '/opt/IBM/zimon/data*' '/var/log/messages*' '/var/crash/*' '/var/tmp/*')
BACKUP_OPTIONS="nfsvers=4,nolock"
BACKUP_URL=nfs://192.168.1.101/backup/
USE_STATIC_NETWORKING=Y
REAR_INITRD_COMPRESSION="lzma"
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" parted sfdisk )
PROGS=( "${PROGS[@]}" partprobe fdisk cfdisk mkofboot ofpath ybin yabootconfig bootlist pseries_platform nvram ofpathname bc agetty )

test "${FIRMWARE_FILES[*]}" || FIRMWARE_FILES=( 'no' )
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    IBM</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    PPC64LE</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    Petitboot</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                               KNAME     PKNAME    TRAN TYPE FSTYPE      LABEL   SIZE MOUNTPOINT
/dev/sda                           /dev/sda                 disk                   893.8G 
|-/dev/sda1                        /dev/sda1 /dev/sda       part                       4M 
|-/dev/sda2                        /dev/sda2 /dev/sda       part ext4                500M /boot
`-/dev/sda3                        /dev/sda3 /dev/sda       part LVM2_member       893.3G 
  |-/dev/mapper/VolGroup00-lv_root /dev/dm-0 /dev/sda3      lvm  ext4                 50G /
  `-/dev/mapper/VolGroup00-lv_swap /dev/dm-1 /dev/sda3      lvm  swap                1.5G [SWAP]
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>REAR fails with following error:</p>
<pre><code>ERROR: 
====================
BUG in /usr/local/src/rear/usr/share/rear/layout/save/default/950_verify_disklayout_file.sh line 254:
'Entries in /usr/local/src/rear/var/lib/rear/layout/disklayout.conf are broken ('rear recover' would fail)'
--------------------
</code></pre>
<ul>
<li>
<p>Workaround, if any:</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<p>To paste verbatim text like command output or file content,<br />
include it between a leading and a closing line of three backticks like</p>
<pre><code>```
verbatim content
```
</code></pre>
<h4 id="tpatel80_commented_at_2022-05-09_1851"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1121457201">2022-05-09 18:51</a>:<a class="headerlink" href="#tpatel80_commented_at_2022-05-09_1851" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/8654468/rear.log">rear.log</a></p>
<h4 id="jsmeix_commented_at_2022-05-10_0712"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122015129">2022-05-10 07:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_0712" title="Permanent link">&para;</a></h4>
<p>@tpatel80<br />
your
<a href="https://github.com/rear/rear/files/8654468/rear.log">https://github.com/rear/rear/files/8654468/rear.log</a><br />
contains (excerpts):</p>
<pre><code>2022-05-09 18:31:50.466037669 Verifying that the 'part' entries for /dev/sda in /usr/local/src/rear/var/lib/rear/layout/disklayout.conf are correct
++ partitions=()
++ read keyword dummy part_size part_start part_name part_flags part_dev junk
+++ grep '^part /dev/sda ' /usr/local/src/rear/var/lib/rear/layout/disklayout.conf
++ test -b ''
++ broken_part_errors+=("$part_dev is not a block device")
...
++ read keyword dummy part_size part_start part_name part_flags part_dev junk
++ test -b ''
++ broken_part_errors+=("$part_dev is not a block device")
...
++ read keyword dummy part_size part_start part_name part_flags part_dev junk
++ test -b ''
++ broken_part_errors+=("$part_dev is not a block device")
</code></pre>
<p>The matching code in<br />
usr/share/rear/layout/save/default/950_verify_disklayout_file.sh<br />
is (excerpts):</p>
<pre><code>    while read keyword dummy part_size part_start part_name part_flags part_dev junk ; do
        test -b "$part_dev" || broken_part_errors+=( "$part_dev is not a block device" )
</code></pre>
<p>This shows that</p>
<pre><code>read keyword dummy part_size part_start part_name part_flags part_dev junk
</code></pre>
<p>does not get any value for <code>part_dev</code> from the</p>
<pre><code>grep '^part /dev/sda ' /usr/local/src/rear/var/lib/rear/layout/disklayout.conf
</code></pre>
<p>output.</p>
<p>So the error is right because according to the 'lsblk' output<br />
in your
<a href="https://github.com/rear/rear/issues/2801#issue-1230116754">https://github.com/rear/rear/issues/2801#issue-1230116754</a><br />
there should be</p>
<pre><code>part /dev/sda &lt;size&gt; &lt;start&gt; &lt;type|name&gt; &lt;flags&gt; /dev/sda1
part /dev/sda &lt;size&gt; &lt;start&gt; &lt;type|name&gt; &lt;flags&gt; /dev/sda2
part /dev/sda &lt;size&gt; &lt;start&gt; &lt;type|name&gt; &lt;flags&gt; /dev/sda3
</code></pre>
<p>entries in your<br />
/usr/local/src/rear/var/lib/rear/layout/disklayout.conf</p>
<p>Next step is to find out why <code>read</code> does not get <code>part_dev</code> values:</p>
<p>Your
<a href="https://github.com/rear/rear/files/8654468/rear.log">https://github.com/rear/rear/files/8654468/rear.log</a><br />
contains (excerpts):</p>
<pre><code>+ source /usr/local/src/rear/usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh
...
+++ parted -s /dev/sda print
...
Error: Can't have a partition outside the disk!
++ disktype=unknown
...
++ parted -m -s /dev/sda print
Error: Can't have a partition outside the disk!
...
++ echo 'part /dev/sda 4194304 1048576 none  /dev/sda1'
...
++ echo 'part /dev/sda 524288000 5242880 none  /dev/sda2'
...
++ echo 'part /dev/sda 959127224320 529530880 none  /dev/sda3'
.
.
.
+ source /usr/local/src/rear/usr/share/rear/layout/save/GNU/Linux/220_lvm_layout.sh
...
++ lvm pvdisplay -c
...
  WARNING: Device /dev/sda3 has size of 1873295360 sectors which is smaller than corresponding PV size of 1874350080 sectors. Was device resized?
  WARNING: One or more devices used as PVs in VG VolGroup00 have changed sizes.
</code></pre>
<p>The</p>
<pre><code>++ echo 'part /dev/sda 4194304 1048576 none  /dev/sda1'
++ echo 'part /dev/sda 524288000 5242880 none  /dev/sda2'
++ echo 'part /dev/sda 959127224320 529530880 none  /dev/sda3'
</code></pre>
<p>show what is wrong:<br />
A 'part' entry in disklayout.conf has the syntax</p>
<pre><code>part &lt;device&gt; &lt;size&gt; &lt;start&gt; &lt;type|name&gt; &lt;flags&gt; /dev/&lt;partition&gt;
</code></pre>
<p>see the section<br />
"Disk layout file syntax" in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a></p>
<p>For example on my homeoffice laptop I have</p>
<pre><code>part /dev/sda 8388608 1048576 rear-noname bios_grub /dev/sda1
part /dev/sda 4294967296 9437184 rear-noname swap /dev/sda2
part /dev/sda 214748364800 4304404480 rear-noname legacy_boot /dev/sda3
part /dev/sda 107374182400 219052769280 rear-noname none /dev/sda4
</code></pre>
<p>In contrast you have</p>
<pre><code>part /dev/sda 4194304 1048576 none  /dev/sda1
part /dev/sda 524288000 5242880 none  /dev/sda2
part /dev/sda 959127224320 529530880 none  /dev/sda3
</code></pre>
<p>so one of <code>&lt;type|name&gt;</code> or <code>&lt;flags&gt;</code> is missing.</p>
<p>Next step is why <code>&lt;type|name&gt;</code> or <code>&lt;flags&gt;</code> is missing:<br />
Your
<a href="https://github.com/rear/rear/files/8654468/rear.log">https://github.com/rear/rear/files/8654468/rear.log</a><br />
contains (excerpts):</p>
<pre><code>+ source /usr/local/src/rear/usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh
.
.
.
++ parted -m -s /dev/sda print
Error: Can't have a partition outside the disk!
+++ grep '^/' /var/tmp/rear.3lGTm845SuRAkd2/tmp/parted
+++ cut -d : -f 6
++ disk_label=unknown
++ cp /var/tmp/rear.3lGTm845SuRAkd2/tmp/partitions /var/tmp/rear.3lGTm845SuRAkd2/tmp/partitions-data
++ declare type
++ [[ unknown = \m\s\d\o\s ]]
++ [[ unknown = \g\p\t ]]
++ [[ unknown = \g\p\t\_\s\y\n\c\_\m\b\r ]]
++ [[ unknown = \d\a\s\d ]]
++ declare flags flaglist
</code></pre>
<p>The matching code in<br />
usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh<br />
is (excerpts)</p>
<pre><code>        parted -m -s $device print &gt; $TMP_DIR/parted
        disk_label=$(grep ^/ $TMP_DIR/parted | cut -d ":" -f "6")
...
    if [[ "$disk_label" = "msdos" ]] ; then
...
    if [[ "$disk_label" = "gpt" || "$disk_label" = "gpt_sync_mbr" || "$disk_label" = "dasd" ]] ; then
</code></pre>
<p>Your <code>disk_label=unknown</code> which does not match<br />
any of "msdos" "gpt" "gpt_sync_mbr" or "dasd"<br />
so the partition <code>type</code> is not set<br />
which leads to it be empty in disklayout.conf</p>
<p>I guess your disk label is actually one of<br />
"msdos" "gpt" "gpt_sync_mbr" or "dasd"<br />
but the current code in 200_partition_layout.sh<br />
does not work because it does not sufficiently<br />
"Try hard to care about possible errors", cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
because it blindly proceeds in case of errors like</p>
<pre><code>++ parted -m -s /dev/sda print
Error: Can't have a partition outside the disk!
</code></pre>
<p>and I assume in your case the</p>
<pre><code>parted -m -s /dev/sda print
</code></pre>
<p>output is not what the current code in 200_partition_layout.sh<br />
normally needs and then things arbitrarily fail in ReaR.</p>
<p>@tpatel80<br />
you should fix your partitioning so that <code>parted</code><br />
does not show errors.</p>
<p>I will have a look at<br />
usr/share/rear/layout/save/GNU/Linux/200_partition_layout.sh<br />
how to make it behave more reliably and failsafe,<br />
in particular error out directly therein when things failed<br />
instead of error out later in 950_verify_disklayout_file.sh<br />
(at least I had added 950_verify_disklayout_file.sh<br />
as generic safety net against our many old code places<br />
that blindly proceed instead of caring about errors).</p>
<h4 id="jsmeix_commented_at_2022-05-10_0806"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122064710">2022-05-10 08:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_0806" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/2802">https://github.com/rear/rear/pull/2802</a><br />
intended to avoid the difficulty to detect<br />
the root cause of an error like in this issue<br />
but my attempt made things even worse.</p>
<h4 id="jsmeix_commented_at_2022-05-10_0851"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122113713">2022-05-10 08:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_0851" title="Permanent link">&para;</a></h4>
<p>Now its successor
<a href="https://github.com/rear/rear/pull/2803">https://github.com/rear/rear/pull/2803</a><br />
tries to avoid the difficulty to detect the<br />
root cause of an error like in this issue here<br />
by ensuring a supported partition table is found<br />
and if not it errors out.</p>
<h4 id="jsmeix_commented_at_2022-05-10_1033"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122214293">2022-05-10 10:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_1033" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/2804">https://github.com/rear/rear/pull/2804</a><br />
tries to ensure syntactically correct 'disk' and 'part' entries<br />
which also intends to avoid the difficulty to detect<br />
the root cause of an error like in this issue here.</p>
<h4 id="pcahyna_commented_at_2022-05-10_1259"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122357510">2022-05-10 12:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-10_1259" title="Permanent link">&para;</a></h4>
<p>I believe it is needed to know how to reproduce the issue before merging
any fix (like #2804). @tpatel80 how is the disk partitioned? I suppose
your machine is PowerNV (BareMetal)?</p>
<h4 id="tpatel80_commented_at_2022-05-10_1310"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122369017">2022-05-10 13:10</a>:<a class="headerlink" href="#tpatel80_commented_at_2022-05-10_1310" title="Permanent link">&para;</a></h4>
<p>@pcahyna the machine is a baremetal IBM Power System IC922 (9183-22X)
factory installed with Redhat 8.2.</p>
<h4 id="pcahyna_commented_at_2022-05-10_1316"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122376874">2022-05-10 13:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-10_1316" title="Permanent link">&para;</a></h4>
<p>@tpatel80 I will try (I have used ReaR on POWER bare metal and I have
not seen this kind of issue, but it was the version shipped with RHEL,
not the development version from Git)</p>
<h4 id="jsmeix_commented_at_2022-05-10_1336"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122405762">2022-05-10 13:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_1336" title="Permanent link">&para;</a></h4>
<p>Neither
<a href="https://github.com/rear/rear/pull/2803">https://github.com/rear/rear/pull/2803</a><br />
nor
<a href="https://github.com/rear/rear/pull/2804">https://github.com/rear/rear/pull/2804</a><br />
intend to fix the initially reported issue here<br />
i.e. none makes correct entries in disklayout.conf.</p>
<p>Both are only meant to detect early i.e. directly<br />
in the code where the entries are genereated in<br />
layout/save/GNU/Linux/200_partition_layout.sh<br />
when invalid entries would be generated<br />
(regardless what the actual reason is).</p>
<p>I.e.
<a href="https://github.com/rear/rear/pull/2803">https://github.com/rear/rear/pull/2803</a><br />
and
<a href="https://github.com/rear/rear/pull/2804">https://github.com/rear/rear/pull/2804</a><br />
are only meant to better care about possible errors<br />
and exit directly where the error happened<br />
instead of blindly proceeding and let things fail<br />
at some later place (950_verify_disklayout_file.sh).</p>
<h4 id="pcahyna_commented_at_2022-05-10_1401"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122438874">2022-05-10 14:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-10_1401" title="Permanent link">&para;</a></h4>
<p>@tpatel80 I am not able to reproduce the issue on RHEL 8.2 / POWER bare
metal. What does</p>
<pre><code>parted -m -s /dev/sda print
</code></pre>
<p>and</p>
<pre><code>parted -s /dev/sda print
</code></pre>
<p>print for you?</p>
<p>The message
<code>WARNING: Device /dev/sda3 has size of 1873295360 sectors which is smaller than corresponding PV size of 1874350080 sectors. Was device resized?</code>
indicates that there is something wrong with partitioning on your
machine.</p>
<h4 id="pcahyna_commented_at_2022-05-10_1402"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122439788">2022-05-10 14:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-10_1402" title="Permanent link">&para;</a></h4>
<p>Also please add the output of <code>fdisk -l /dev/sda</code></p>
<h4 id="jsmeix_commented_at_2022-05-10_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122448448">2022-05-10 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-10_1408" title="Permanent link">&para;</a></h4>
<p>Only a side note FYI:<br />
When <code>rear</code> is run in debug mode KEEP_BUILD_DIR is true<br />
so that [/var]/tmp/rear.XXXXXX/tmp/parted should be kept<br />
that contains the <code>parted -m -s</code> output.</p>
<h4 id="tpatel80_commented_at_2022-05-10_1424"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122467954">2022-05-10 14:24</a>:<a class="headerlink" href="#tpatel80_commented_at_2022-05-10_1424" title="Permanent link">&para;</a></h4>
<p>I've attempted to correct the end value for sda3 to 1874329599. Will
report back if this helps in any manner.</p>
<pre><code>**sh-4.4# parted -m -s /dev/sda print**
Error: Can't have a partition outside the disk!
BYT;
/dev/sda:960GB:scsi:512:4096:unknown:AVAGO MR9361-8i:;

**sh-4.4# parted -s /dev/sda print**
Error: Can't have a partition outside the disk!
Model: AVAGO MR9361-8i (scsi)
Disk /dev/sda: 960GB
Sector size (logical/physical): 512B/4096B
Partition Table: unknown
Disk Flags:

**sh-4.4# fdisk -l /dev/sda**
Disk /dev/sda: 893.8 GiB, 959656755200 bytes, **1874329600** sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 262144 bytes / 262144 bytes
Disklabel type: dos
Disk identifier: 0x3db2a74e

Device     Boot   Start        End    Sectors   Size Id Type
/dev/sda1  *       2048      10239       8192     4M 41 PPC PReP Boot
/dev/sda2         10240    1034239    1024000   500M 83 Linux
/dev/sda3       1034240 1875384319 **1874350080** 893.8G 8e Linux LVM


**sh-4.4# fdisk -l -u /dev/sda**
Disk /dev/sda: 893.8 GiB, 959656755200 bytes, 1874329600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 262144 bytes / 262144 bytes
Disklabel type: dos
Disk identifier: 0x3db2a74e

Device     Boot   Start        End    Sectors   Size Id Type
/dev/sda1  *       2048      10239       8192     4M 41 PPC PReP Boot
/dev/sda2         10240    1034239    1024000   500M 83 Linux
/dev/sda3       1034240 1875384319 1874350080 893.8G 8e Linux LVM
</code></pre>
<h4 id="tpatel80_commented_at_2022-05-10_1429"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1122474838">2022-05-10 14:29</a>:<a class="headerlink" href="#tpatel80_commented_at_2022-05-10_1429" title="Permanent link">&para;</a></h4>
<p>Updating END value of sda3 seems to have done the trick. Running
mkbackup now.</p>
<pre><code>[Tue May 10 14:26:31 root@hpnls4vfs5:~ ] # parted -m -s /dev/sda print
BYT;
/dev/sda:960GB:scsi:512:4096:msdos:AVAGO MR9361-8i:;
1:1049kB:5243kB:4194kB:::boot, prep;
2:5243kB:530MB:524MB:ext4::;
3:530MB:960GB:959GB:::lvm;

[Tue May 10 14:26:40 root@hpnls4vfs5:~ ] # parted -s /dev/sda print
Model: AVAGO MR9361-8i (scsi)
Disk /dev/sda: 960GB
Sector size (logical/physical): 512B/4096B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  5243kB  4194kB  primary               boot, prep
 2      5243kB  530MB   524MB   primary  ext4
 3      530MB   960GB   959GB   primary               lvm
</code></pre>
<h4 id="pcahyna_commented_at_2022-05-11_0931"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1123430732">2022-05-11 09:31</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-11_0931" title="Permanent link">&para;</a></h4>
<p>@tpatel80 I believe you still have a problem with LVM, it thinks that
the PV is longer than the partition that it sits on. Not sure how
serious it is or how to correct it...</p>
<h4 id="jsmeix_commented_at_2022-05-11_1221"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1123685448">2022-05-11 12:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-11_1221" title="Permanent link">&para;</a></h4>
<p>@tpatel80<br />
only out of curiosity (I am not a Red Hat user) regarding your<br />
<a href="https://github.com/rear/rear/issues/2801#issuecomment-1122369017">https://github.com/rear/rear/issues/2801#issuecomment-1122369017</a></p>
<pre><code>the machine is a baremetal IBM Power System IC922 (9183-22X)
factory installed with Redhat 8.2.
</code></pre>
<p>Because you have parted errors and LVM warnings<br />
about partion sizes and PV sizes on your original system<br />
(so it cannot be ReaR that recreated something wrong)<br />
I wonder if your original system is really<br />
"factory installed with Redhat 8.2"?</p>
<p>I assume a Red Hat installation does not result<br />
wrong partitioning and/or wrong LVM PV setup<br />
(I think otherwise Red Hat would have already noticed)<br />
so I guess smoeone or something had somehow changed<br />
the pristine partitioning on your original system.</p>
<p>Alternatively a Red Hat installation may do<br />
something wrong only on special hardware like<br />
your baremetal IBM Power System IC922 (9183-22X).</p>
<p>FYI:<br />
This would not be the first case we had here at ReaR<br />
where disaster recovery setup with ReaR reveals<br />
a broken setup on the original system.<br />
In particular we had "fun" with certain special<br />
third-party software that a bit messed up things<br />
in the original system.</p>
<h4 id="tpatel80_commented_at_2022-05-11_1321"><img src="https://avatars.githubusercontent.com/u/34493359?v=4" width="50"><a href="https://github.com/tpatel80">tpatel80</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1123755598">2022-05-11 13:21</a>:<a class="headerlink" href="#tpatel80_commented_at_2022-05-11_1321" title="Permanent link">&para;</a></h4>
<p>@jsmeix I suspect the image used to clone these systems had different
disk size. We've contacted IBM for details.</p>
<h4 id="jsmeix_commented_at_2022-05-13_0635"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1125704964">2022-05-13 06:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-13_0635" title="Permanent link">&para;</a></h4>
<p>@tpatel80<br />
so the installation on this particular machine<br />
was not an actual Red Hat installation<br />
but an imaged clone of a Red Hat installation<br />
and ReaR revealed that the likely 100% clone<br />
(e.g. like a simple 'dd' whole disk clone)<br />
does not 100% match the clone's target machine hardware<br />
(e.g. the disk image is a bit bigger than the target disk).</p>
<p>In general regarding a bit different hardware disk sizes<br />
(in contrast virtual disk sizes can be made 100% same)<br />
you may have a look at the description about<br />
AUTORESIZE_PARTITIONS<br />
AUTORESIZE_EXCLUDE_PARTITIONS<br />
AUTOSHRINK_DISK_SIZE_LIMIT_PERCENTAGE<br />
AUTOINCREASE_DISK_SIZE_THRESHOLD_PERCENTAGE<br />
in usr/share/rear/conf/default.conf<br />
what ReaR would do during "rear recover" to deal with<br />
a bit different disk sizes on replacement hardware.</p>
<p>To keep issues because of a bit different disk sizes<br />
out of the way I would recommend to not use a disk<br />
up to its very end but leave some reasonable amount of<br />
disk space unused at the end so that the a bit smaller<br />
actually used disk space fits within the smallest existing<br />
hardware disk size among one kind of disks that one uses<br />
(e.g. among all 1TB disks that one uses).</p>
<p>This belongs to the general topic<br />
"Prepare for disaster recovery from the very beginning" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I think I add a subsection there about recommended disk usage.</p>
<h4 id="jsmeix_commented_at_2022-05-18_1227"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2801#issuecomment-1129944164">2022-05-18 12:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-18_1227" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2803">https://github.com/rear/rear/pull/2803</a><br />
and
<a href="https://github.com/rear/rear/pull/2804">https://github.com/rear/rear/pull/2804</a><br />
merged I think this issue is sufficiently solved.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2026 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-05-09.2801.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
