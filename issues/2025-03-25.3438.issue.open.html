<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#3438 Issue open: Overhaul simulation mode implementation - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#3438 Issue open: Overhaul simulation mode implementation";
        var mkdocs_page_input_path = "issues/2025-03-25.3438.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#3438 Issue open: Overhaul simulation mode implementation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3438_issue_open_overhaul_simulation_mode_implementation"><a href="https://github.com/rear/rear/issues/3438">#3438 Issue</a> <code>open</code>: Overhaul simulation mode implementation<a class="headerlink" href="#3438_issue_open_overhaul_simulation_mode_implementation" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code></p>
<h4 id="jsmeix_opened_issue_at_2025-03-25_1331"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/3438">2025-03-25 13:31</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2025-03-25_1331" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/pull/3436">https://github.com/rear/rear/pull/3436</a><br />
revealed that current simulation mode implementation<br />
has become somewhat messy over time<br />
so it needs to be overhauled.<br />
This is a bigger task for the future as time permits.</p>
<h4 id="pcahyna_commented_at_2025-03-25_1636"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2751867610">2025-03-25 16:36</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-03-25_1636" title="Permanent link">&para;</a></h4>
<p>We discovered one problem here:
<a href="https://github.com/rear/rear/pull/3436#issuecomment-2751858143">https://github.com/rear/rear/pull/3436#issuecomment-2751858143</a></p>
<p>Another possible improvement would be to source the <code>init</code> scripts even
in simulation mode, but that would make them a bit irregular.</p>
<h4 id="jsmeix_commented_at_2025-03-26_1450"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2754707821">2025-03-26 14:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-03-26_1450" title="Permanent link">&para;</a></h4>
<p>I think the real problem is:<br />
When we call that stuff "simulation mode"<br />
we should avoid as much as possible to execute code<br />
which is not actually needed for the simulation.</p>
<p>In particular we must not execute code<br />
that could (potentially) change the system,<br />
i.e. we must not execute code from the user<br />
but only code that we know inside ReaR.</p>
<p>But for a simulation we need to execute some code<br />
(e.g. the WORKFLOW_... functions definitions).</p>
<p>So the real problem is to carefully and thoroughly<br />
determine what code is actually needed for the simulation.</p>
<p>I think this is a bigger task because it requires<br />
to carefully and thoroughly inspect all code<br />
that is currently executed in simulation mode<br />
whether or not it is actually needed.</p>
<p>For example whether or not it is actually needed<br />
to execute user config files when for the simulation<br />
only a few user config variable values are needed<br />
like BACKUP and OUTPUT which we may only read<br />
from the config files without executing them?</p>
<p>Also it is questionable if we really need to execute<br />
the workflow scripts usr/share/rear/lib/[a-z]*-workflow.sh<br />
(see my exceptional code therein for simulation mode)<br />
when all we need is to know the names of the stages<br />
that a particular workflow runs which we may only read<br />
from the workflow scripts without executing them?</p>
<h4 id="pcahyna_commented_at_2025-03-26_1502"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2754746289">2025-03-26 15:02</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-03-26_1502" title="Permanent link">&para;</a></h4>
<blockquote>
<p>When we call that stuff "simulation mode"<br />
we should avoid as much as possible to execute code<br />
which is not actually needed for the simulation.</p>
<p>In particular we must not execute code<br />
that could (potentially) change the system,<br />
i.e. we must not execute code from the user<br />
but only code that we know inside ReaR.</p>
</blockquote>
<p>Is it feasible to run simulation mode as a non-root user in order to use
the OS-level protections against changing the system? Then if we happen
to execute something that should not be executed in simulation mode, we
will at worst see some "Permission denied" in the log.</p>
<h4 id="jsmeix_commented_at_2025-03-26_1505"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2754755493">2025-03-26 15:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-03-26_1505" title="Permanent link">&para;</a></h4>
<p>I think sbin/rear needs at least to start up as root user<br />
to have permissions to read /etc/rear/ config files<br />
and things like that.</p>
<p>But to run a workflow in simulation mode<br />
it may work to switch to a non-root user?</p>
<p>Provided that non-root user is in TRUSTED_OWNERS<br />
because otherwise the 'source' wrapper forbids it<br />
which leads to another question if it is really needed<br />
to 'source' scripts in simulation mode when all what<br />
the simulation mode actually does is to print the script name?</p>
<p>I start to like my 'source' wrapper more and more<br />
because it "by the way" even helps us<br />
to see where we may carelessly execute things<br />
which are not actually needed to be executed.</p>
<p>Correction:</p>
<p>In simulation mode we do not 'source' workflow scripts<br />
because in simulation mode the 'Source' function<br />
only prints the script name.</p>
<p>So to run a workflow in simulation mode<br />
it does not help to switch to a non-root user<br />
because no workflow script gets executed.</p>
<h4 id="pcahyna_commented_at_2025-03-26_1551"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2754913985">2025-03-26 15:51</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-03-26_1551" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think sbin/rear needs at least to start up as root user<br />
to have permissions to read /etc/rear/ config files<br />
and things like that.</p>
<p>But to run a workflow in simulation mode<br />
it may work to switch to a non-root user?</p>
</blockquote>
<p>I would say this is too complicated and if users want to run <code>rear</code> as
non-root, they are responsible for ensuring that the configuration files
are readable, for which there are many ways (adding ACLs to the files,
making them group-readable and adding the user to the <code>root</code> group, or
even making them world-readable if they don't contain secrets). We
should just not prevent it, which we currently do:<br />
<a href="https://github.com/rear/rear/blob/1128f1b616b370e49ac7be7f0ae0fa5ab04bc638/usr/sbin/rear#L378">https://github.com/rear/rear/blob/1128f1b616b370e49ac7be7f0ae0fa5ab04bc638/usr/sbin/rear#L378</a></p>
<blockquote>
<p>So to run a workflow in simulation mode<br />
it does not help to switch to a non-root user<br />
because no workflow script gets executed.</p>
</blockquote>
<p>non-root user would basically be an additional safeguard.</p>
<h4 id="jsmeix_commented_at_2025-03-26_1631"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2755035127">2025-03-26 16:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2025-03-26_1631" title="Permanent link">&para;</a></h4>
<p>@pcahyna FYI:<br />
This week and perhaps also next week<br />
(currently I cannot tell how long it takes)<br />
I can no longer work on ReaR because<br />
I have to fix several security bugs in other software...</p>
<h4 id="pcahyna_commented_at_2025-03-26_1725"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/3438#issuecomment-2755177971">2025-03-26 17:25</a>:<a class="headerlink" href="#pcahyna_commented_at_2025-03-26_1725" title="Permanent link">&para;</a></h4>
<p>@jsmeix sure, no problem and thanks for the info,<br />
simulation mode would not be my priority anyway (I am not using it), but
perhaps I will try to remove this check for root user and see how far
one can get with it.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2025-03-25.3438.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
