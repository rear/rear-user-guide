<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#851 Issue closed: First boot after restore on FC21 fails trying to find UUID originally generated by mkfs before tune2fs changes it - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#851 Issue closed: First boot after restore on FC21 fails trying to find UUID originally generated by mkfs before tune2fs changes it";
        var mkdocs_page_input_path = "issues/2016-05-27.851.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#851 Issue closed: First boot after restore on FC21 fails trying to find UUID originally generated by mkfs before tune2fs changes it</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="851_issue_closed_first_boot_after_restore_on_fc21_fails_trying_to_find_uuid_originally_generated_by_mkfs_before_tune2fs_changes_it"><a href="https://github.com/rear/rear/issues/851">#851 Issue</a> <code>closed</code>: First boot after restore on FC21 fails trying to find UUID originally generated by mkfs before tune2fs changes it<a class="headerlink" href="#851_issue_closed_first_boot_after_restore_on_fc21_fails_trying_to_find_uuid_originally_generated_by_mkfs_before_tune2fs_changes_it" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>waiting for info</code>,
<code>fixed / solved / done</code></p>
<h4 id="exedor_opened_issue_at_2016-05-27_2236"><img src="https://avatars.githubusercontent.com/u/6391864?u=f29593e509021c433bdf23c37efbe71f8ced8a6e&v=4" width="50"><a href="https://github.com/exedor">exedor</a> opened issue at <a href="https://github.com/rear/rear/issues/851">2016-05-27 22:36</a>:<a class="headerlink" href="#exedor_opened_issue_at_2016-05-27_2236" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): rear-1.18-1.git201605271003</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): Fedora 21</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
USB_RETAIN_BACKUP_NR=1
BACKUP_PROG_EXCLUDE=( "${BACKUP_PROG_EXCLUDE[@]}"
                      '/backup'
                      '/sys'
                      '/root/.ssh/known_hosts'
                      '/root/.ssh/known_hosts2'
                      '/root/.ccache'
                      '/root/.gem'
                      '/selinux'
                      '/var/cache/ccache'
                      '/var/cache/yum'
                      '/var/cache/man'
                      '/usr/local/src'
                      '/usr/share/doc'
                      '/usr/share/man'
                      '/usr/share/gtk-doc'
                      '/usr/share/info'
                      '/usr/src/*'
                      '/usr/lib/modules/3.8.13-ds'
                      '/var/log/messages'
                      '/var/log/maillog'
                      '/var/log/Xorg.0.log'
                      '/var/log/Xorg.0.log.old'
                      '/var/log/secure'
                      '/var/log/journal'
                      '/var/log/audit'
                      '/var/log/wtmp'
                      '/var/log/lastlog'
                      '/dev'
                      '/proc'
                      '/var/lib/rear/output' )
COPY_AS_IS_EXCLUDE=( ${copy_as_is_exclude[@]}
                      '/backup'
                      '/sys'
                      '/root/.ssh/known_hosts'
                      '/root/.ssh/known_hosts2'
                      '/root/.ccache'
                      '/root/.gem'
                      '/selinux'
                      '/var/cache/ccache'
                      '/var/cache/yum'
                      '/var/cache/man'
                      '/usr/local/src'
                      '/usr/share/doc'
                      '/usr/share/man'
                      '/usr/share/gtk-doc'
                      '/usr/share/info'
                      '/usr/src/*'
                      '/var/log/messages'
                      '/var/log/maillog'
                      '/var/log/Xorg.0.log'
                      '/var/log/Xorg.0.log.old'
                      '/var/log/secure'
                      '/var/log/journal'
                      '/var/log/audit'
                      '/var/log/wtmp'
                      '/var/log/lastlog'
                      '/dev'
                      '/proc'
                      '/var/lib/rear/output' )
USE_DHCLIENT=No
USE_STATIC_NETWORKING=Yes
TMPDIR="/home/sim/release-1-9-40/devel/install/images/temp"
</code></pre>
<ul>
<li>Brief description of the issue:</li>
</ul>
<p>This is only a problem on a system with an identical disk drive. The
initrd image of the restored system fails to boot after completing
restore because it is still looking for the UUID's that were allocated
when the filesystem was created and used prior to the call to tune2fs to
change them back to what they were on the backed up system. This makes
no sense unless something is monitoring the disk for changes and then
automatically updating initrd but therein lies the mystery.</p>
<ul>
<li>Work-around, if any:</li>
</ul>
<p>1: Let dracut go to its emergency shell (takes around 5 minutes)<br />
2: Mount root file system somewhere<br />
3: chroot to mounted root file system<br />
4: mount /boot at its respective mount point<br />
5: run dracut -f /boot/initrd_image_filename<br />
6: reboot</p>
<h4 id="exedor_commented_at_2016-05-28_1135"><img src="https://avatars.githubusercontent.com/u/6391864?u=f29593e509021c433bdf23c37efbe71f8ced8a6e&v=4" width="50"><a href="https://github.com/exedor">exedor</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222304072">2016-05-28 11:35</a>:<a class="headerlink" href="#exedor_commented_at_2016-05-28_1135" title="Permanent link">&para;</a></h4>
<p>I found a fix for this in the code. There is clearly something very
wrong with first calling mkfs and then afterwards calling tune2fs, at
least on Fedora there is something wrong with it. Trying to figure out
how to create a pull request now...<br />
Tried to submit pull request, permission denied. Tried to upload patch
file, file type not supported, attempted to zip it first, still get "we
don't support that file type," so I posted the patch to the mailing
list.</p>
<h4 id="gdha_commented_at_2016-05-30_0745"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222432463">2016-05-30 07:45</a>:<a class="headerlink" href="#gdha_commented_at_2016-05-30_0745" title="Permanent link">&para;</a></h4>
<p>See small tutorial at
<a href="https://yangsu.github.io/pull-request-tutorial/">https://yangsu.github.io/pull-request-tutorial/</a></p>
<p>On Sat, May 28, 2016 at 1:35 PM, jb <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>I found a fix for this in the code. There is clearly something very
wrong<br />
with first calling mkfs and then afterwards calling tune2fs, at least
on<br />
Fedora there is something wrong with it. Trying to figure out how to
create<br />
a pull request now...</p>
<p>—<br />
You are receiving this because you are subscribed to this thread.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/851#issuecomment-222304072">https://github.com/rear/rear/issues/851#issuecomment-222304072</a>,
or mute<br />
the thread<br />
<a href="https://github.com/notifications/unsubscribe/AA2POXOwu0dZhvkdRhZlRTuiX2EnG6XUks5qGCiEgaJpZM4Io6ft">https://github.com/notifications/unsubscribe/AA2POXOwu0dZhvkdRhZlRTuiX2EnG6XUks5qGCiEgaJpZM4Io6ft</a><br />
.</p>
</blockquote>
<h4 id="exedor_commented_at_2016-05-30_0749"><img src="https://avatars.githubusercontent.com/u/6391864?u=f29593e509021c433bdf23c37efbe71f8ced8a6e&v=4" width="50"><a href="https://github.com/exedor">exedor</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222433362">2016-05-30 07:49</a>:<a class="headerlink" href="#exedor_commented_at_2016-05-30_0749" title="Permanent link">&para;</a></h4>
<p>I read docs and looked up a different tutorial URL but git tells me I<br />
have no permission to push my branch with the changes in it.</p>
<p>On 5/30/2016 1:45 AM, gdha wrote:</p>
<blockquote>
<p>See small tutorial at
<a href="https://yangsu.github.io/pull-request-tutorial/">https://yangsu.github.io/pull-request-tutorial/</a></p>
<p>On Sat, May 28, 2016 at 1:35 PM, jb <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a> wrote:</p>
<blockquote>
<p>I found a fix for this in the code. There is clearly something
very<br />
wrong<br />
with first calling mkfs and then afterwards calling tune2fs, at
least on<br />
Fedora there is something wrong with it. Trying to figure out how
to<br />
create<br />
a pull request now...</p>
<p>—<br />
You are receiving this because you are subscribed to this thread.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/851#issuecomment-222304072">https://github.com/rear/rear/issues/851#issuecomment-222304072</a>,
or<br />
mute<br />
the thread</p>
<p><a href="https://github.com/notifications/unsubscribe/AA2POXOwu0dZhvkdRhZlRTuiX2EnG6XUks5qGCiEgaJpZM4Io6ft">https://github.com/notifications/unsubscribe/AA2POXOwu0dZhvkdRhZlRTuiX2EnG6XUks5qGCiEgaJpZM4Io6ft</a><br />
.</p>
</blockquote>
<p>—<br />
You are receiving this because you authored the thread.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/851#issuecomment-222432463">https://github.com/rear/rear/issues/851#issuecomment-222432463</a>,
or<br />
mute the thread<br />
<a href="https://github.com/notifications/unsubscribe/AGGIOGhTlhujlQcqDX6xP_izzgBqzxntks5qGpWIgaJpZM4Io6ft">https://github.com/notifications/unsubscribe/AGGIOGhTlhujlQcqDX6xP_izzgBqzxntks5qGpWIgaJpZM4Io6ft</a>.</p>
</blockquote>
<h4 id="gdha_commented_at_2016-05-30_1517"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222513215">2016-05-30 15:17</a>:<a class="headerlink" href="#gdha_commented_at_2016-05-30_1517" title="Permanent link">&para;</a></h4>
<p>@exedor you first need to fork rear to your own github account and do
your modification on your fork. When done you can request a pull
request.</p>
<h4 id="exedor_commented_at_2016-05-30_1917"><img src="https://avatars.githubusercontent.com/u/6391864?u=f29593e509021c433bdf23c37efbe71f8ced8a6e&v=4" width="50"><a href="https://github.com/exedor">exedor</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222543279">2016-05-30 19:17</a>:<a class="headerlink" href="#exedor_commented_at_2016-05-30_1917" title="Permanent link">&para;</a></h4>
<p>Ahhh, that was the missing link. Thank you!</p>
<p>On 5/30/2016 9:17 AM, gdha wrote:</p>
<blockquote>
<p>@exedor <a href="https://github.com/exedor">https://github.com/exedor</a> you
first need to fork rear to<br />
your own github account and do your modification on your fork. When<br />
done you can request a pull request.</p>
<p>—<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/851#issuecomment-222513215">https://github.com/rear/rear/issues/851#issuecomment-222513215</a>,
or<br />
mute the thread<br />
<a href="https://github.com/notifications/unsubscribe/AGGIOMnvtYGRUbKKy335sIQN4aG55QvGks5qGv-mgaJpZM4Io6ft">https://github.com/notifications/unsubscribe/AGGIOMnvtYGRUbKKy335sIQN4aG55QvGks5qGv-mgaJpZM4Io6ft</a>.</p>
</blockquote>
<h4 id="gdha_commented_at_2016-06-01_0954"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-222946598">2016-06-01 09:54</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-01_0954" title="Permanent link">&para;</a></h4>
<p>@exedor just applied your pull request - please try it out - let me know
if it works well?</p>
<h4 id="jsmeix_commented_at_2016-06-22_1504"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-227773388">2016-06-22 15:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-22_1504" title="Permanent link">&para;</a></h4>
<p>It seems now it does no longer work on RHEL 5.10<br />
see
<a href="https://github.com/rear/rear/issues/890">https://github.com/rear/rear/issues/890</a></p>
<h4 id="gdha_commented_at_2016-06-22_1541"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-227785052">2016-06-22 15:41</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-22_1541" title="Permanent link">&para;</a></h4>
<p>@jsmeix perhaps it is wiser to revert this pull request and investigate
why the <code>tune2fs</code> failed on F21?</p>
<h4 id="jsmeix_commented_at_2016-06-23_0901"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-227990748">2016-06-23 09:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-23_0901" title="Permanent link">&para;</a></h4>
<p>@exedor<br />
your change causes a regression on RHEL 5.10<br />
see
<a href="https://github.com/rear/rear/issues/890">https://github.com/rear/rear/issues/890</a></p>
<p>Therefore we need to find another way.</p>
<p>Regardless that I am not at all an expert in initrd issues<br />
I like to get some understanding in this issue.</p>
<p>First an unrelated side note regarding your</p>
<pre>
USE_DHCLIENT=No
</pre>

<p>means the same as if you set</p>
<pre>
USE_DHCLIENT=yes_please_really_use_it
</pre>

<p>because /usr/share/rear/conf/default.conf reads</p>
<pre>
# PLEASE NOTE:
...
# * Boolean variables can be set to anything as we only check wether the variable
#   is not empty.
</pre>

<p>which matches the code in<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/58-start-dhclient.sh</p>
<pre>
# check if we have USE_DHCLIENT=y, if not then we run 60/62 scripts
[[ -z "$USE_DHCLIENT"  ]] && return
</pre>

<p>If you do not want to USE_DHCLIENT<br />
you must set it to empty and not to "No".</p>
<p>Now to the actual issue:</p>
<p>I do not understand what you mean with</p>
<pre>
This is only a problem on a system with an identical disk drive.
</pre>

<p>I would assume (but I did not verify it) that<br />
if the disk is identical, then its UUID must be identical<br />
(otherwise the disk is not identical)<br />
and when the UUID did not change I do not understand<br />
how there could be an UUID issue.</p>
<p>In other words when the UUID is identical<br />
it should not matter if rear can set it to the same value<br />
or if that fails and the old UUID on the disk is left as is.</p>
<p>Could you explain in more detail how the issue happens.</p>
<p>In particular what is the UUID on the original system,<br />
what is the UUID in the recovery system before "rear recover" is run<br />
what is the UUID in the recovery system after "rear recover" had
finished.</p>
<h4 id="exedor_commented_at_2016-06-23_1458"><img src="https://avatars.githubusercontent.com/u/6391864?u=f29593e509021c433bdf23c37efbe71f8ced8a6e&v=4" width="50"><a href="https://github.com/exedor">exedor</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-228077360">2016-06-23 14:58</a>:<a class="headerlink" href="#exedor_commented_at_2016-06-23_1458" title="Permanent link">&para;</a></h4>
<p>On 6/23/2016 3:01 AM, Johannes Meixner wrote:</p>
<blockquote>
<p>@exedor <a href="https://github.com/exedor">https://github.com/exedor</a><br />
your change causes a regression on RHEL 5.10<br />
see #890
<a href="https://github.com/rear/rear/issues/890">https://github.com/rear/rear/issues/890</a></p>
<p>Therefore we need to find another way.</p>
<p>Agreed.</p>
<p>Regardless that I am not at all an expert in initrd issues<br />
I like to get some understanding in this issue.</p>
<p>Now to the actual issue:</p>
<p>I do not understand what you mean with</p>
<p>This is only a problem on a system with an identical disk drive.<br />
When doing an "AUTOMATIC" restore to a system with different drive<br />
geometry where the partitions must be proportionately rebuilt, I get<br />
extra prompts where I must use option 5 to proceed....twice. That's<br />
fine, and the restore proceeds and executes successfully, the system<br />
reboots, the partitions using their original UUID mount up just fine<br />
from the UUID references contained in the original restored fstab
file,<br />
and all is well.</p>
</blockquote>
<p>When doing an "AUTOMATIC" restore to a system that has a hard drive
with<br />
identical geometry to the backed up system, I run into problems.<br />
Everything is normal including the extra prompts disappearing, and
after<br />
selecting which backup to use (I only have one btw, so that menu, IMO
is<br />
superfluous) the system restores as expected. However upon reboot,<br />
intird is unable to read any data on any of the partitions because it
is<br />
attempting to access them using UUIDs that do not exist and never<br />
existed on the source system.</p>
<blockquote>
<p>I would assume (but I did not verify it) that</p>
<p>if the disk is identical, then its UUID must be identical<br />
(otherwise the disk is not identical)</p>
<p>By identical I mean restoring to a system with identical drive
geometry,<br />
manufacturer, model, etc..</p>
<p>and when the UUID did not change I do not understand<br />
how there could be an UUID issue.</p>
<p>Here is how. The system backups up fine. During restore, restoring
the<br />
filesystems including their respective UUIDs was a two step process.<br />
1: Call mkfs to create the file systems<br />
2: Check if there were originally UUIDs via the former if [ -n
"$uuid"<br />
]... and if so, use tune2fs to "fix" the UUID to it's original
value<br />
from the backed up system.</p>
</blockquote>
<p>The problem was that mkfs, when it creates the new filesystem
generates<br />
its own new random UUIDs for the file system, then tune2fs comes back<br />
around and "fixes them up" to be what they were previously. That step<br />
was not working or not syncing or something so that when initrd was<br />
created it grabbed the wrong UUIDs because the ones tune2fs should
have<br />
written apparently didn't. Using the shell when boot failed during the<br />
restore, I was having a heck of a time figuring out where those UUIDs<br />
were coming from in the error messages initrd was puking all over the<br />
screen until I found out they were the random ones generated by mkfs
call.</p>
<p>As I said, I didn't have the time to keep digging to determine why<br />
tune2fs was not doing it's job or if there was some other issue like<br />
maybe no sync to desk prior to initrd generation. But whenever a brand<br />
new drive, using identical geometry was used in the target system for<br />
restore, the boot immediately after restore would fail every single
time<br />
on failure to find filesystems with the original UUIDs since tune2fs<br />
call didn't seem to take effect when it should have.</p>
<p>I tested my revision so that instead of calling tune2fs after the file<br />
system was created, I instead check at the mkfs call and then use it's<br />
-U parameter so it just uses the correct UUID at filesystem creation<br />
time instead of first creating bogus UUIDs and then trying to fix them<br />
up later. Seemed like a cleaner approach until it broke older
versions.<br />
It is possible that doing something more, like tune2fs followed<br />
immediately by a sync call <em>could</em> also resolve the problem. I didn't<br />
have a week to climb into the guts of those utilities to find out why<br />
they weren't actually writing their changes to disk.</p>
<blockquote>
<p>In other words when the UUID is identical<br />
it should not matter if rear can set it to the same value<br />
or if that fails and the old UUID on the disk is left as is.</p>
<p>There is no UUID on the disk when doing a restore to a blank<br />
drive....that is until mkfs creates one....and then tune2fs
(pre-patch)<br />
tries to set it back to what it needs to be in order for originally<br />
backed up OS to find it after restore.</p>
<p>Could you explain in more detail how the issue happens.</p>
<p>Yep, see above.</p>
<p>In particular what is the UUID on the original system,</p>
<p>UUID on original system is arbitrary. I can put it in here if you
want,<br />
but it doesn't matter. It can just be the UUID on whatever system
was<br />
backed up.</p>
<p>what is the UUID in the recovery system before "rear recover" is run</p>
<p>There isn't one....brand new clean, unmolested, untouched, virgin
drive.</p>
<p>what is the UUID in the recovery system after "rear recover" had
finished.</p>
<p>They match, which is what made this issue so puzzling and took so
long<br />
to find, but initrd during boot was still failing because it was
looking<br />
for the UUIDs mkfs originally generated during restore....I'm still<br />
unsure exactly why. Like I said, I can only imagine it's because the
new<br />
UUIDs were not actually written to disk by the time the restore
process<br />
created the new initrd for the restored system. If you want, I can
go<br />
back to the original code and try adding a sync call or something to
the<br />
script immediately following the tune2fs call but it sure seemed
cleaner<br />
to just have mkfs use the right one (if it was needed) in the first
place.</p>
<p>—<br />
You are receiving this because you were mentioned.<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/851#issuecomment-227990748">https://github.com/rear/rear/issues/851#issuecomment-227990748</a>,
or<br />
mute the thread<br />
<a href="https://github.com/notifications/unsubscribe/AGGIOH13cnREq3Cf327-qFNXWSMS-Cbtks5qOkuCgaJpZM4Io6ft">https://github.com/notifications/unsubscribe/AGGIOH13cnREq3Cf327-qFNXWSMS-Cbtks5qOkuCgaJpZM4Io6ft</a>.</p>
</blockquote>
<h4 id="jsmeix_commented_at_2016-06-23_1622"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-228104162">2016-06-23 16:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-23_1622" title="Permanent link">&para;</a></h4>
<p>Many thanks for your explanation.</p>
<p>Curently I don't have a Fedora system for testing.</p>
<p>I will try to install one and see how it behaves.</p>
<p>But tomorrow I don't have time<br />
and next week is SUSE Hackweek (see
<a href="https://github.com/rear/rear/issues/841">https://github.com/rear/rear/issues/841</a>)<br />
which means you need to be patient...</p>
<h4 id="jsmeix_commented_at_2016-06-27_1229"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-228731714">2016-06-27 12:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-27_1229" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/894">https://github.com/rear/rear/pull/894</a><br />
it still uses "mkfs -U" by default but if that fails<br />
it falls back to the old behaviour<br />
using mkfs without -U plus "tune2fs/tune4fs -U".</p>
<p>I tested it on SLE11 with ext3 and SLE12 with ext4.<br />
On those systems "mkfs -U" works.</p>
<p>@exedor<br />
accordingly I assume current rear master<br />
also still works for you on FC21<br />
but to be on the safe side I would appreciate it<br />
if you could verify that current rear master<br />
still works for you on FC21.</p>
<h4 id="gdha_commented_at_2016-08-31_1205"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/851#issuecomment-243743686">2016-08-31 12:05</a>:<a class="headerlink" href="#gdha_commented_at_2016-08-31_1205" title="Permanent link">&para;</a></h4>
<p>related to issue #649 and #790</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-05-27.851.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
