<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1767 Issue closed: trying to exclude other mount points and swap from rear recovery - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1767 Issue closed: trying to exclude other mount points and swap from rear recovery";
        var mkdocs_page_input_path = "issues/2018-04-03.1767.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1767 Issue closed: trying to exclude other mount points and swap from rear recovery</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1767_issue_closed_trying_to_exclude_other_mount_points_and_swap_from_rear_recovery"><a href="https://github.com/rear/rear/issues/1767">#1767 Issue</a> <code>closed</code>: trying to exclude other mount points and swap from rear recovery<a class="headerlink" href="#1767_issue_closed_trying_to_exclude_other_mount_points_and_swap_from_rear_recovery" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="pspatola101_opened_issue_at_2018-04-03_1850"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> opened issue at <a href="https://github.com/rear/rear/issues/1767">2018-04-03 18:50</a>:<a class="headerlink" href="#pspatola101_opened_issue_at_2018-04-03_1850" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>rear version (/usr/sbin/rear -V):<br />
    Relax-and-Recover 2.3-git.2932.d6865ed.master.changed / 2018-03-23</p>
</li>
<li>
<p>OS version (cat /etc/rear/os.conf or lsb_release -a):<br />
    LSB Version: :core-4.1-noarch:core-4.1-ppc64le<br />
    Distributor ID: RedHatEnterpriseServer<br />
    Description: Red Hat Enterprise Linux Server release 7.3 (Maipo)<br />
    Release: 7.3<br />
    Codename: Maipo</p>
</li>
<li>
<p>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</p>
</li>
</ul>
<pre>
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://172.19.5.99/stuff/unix/iowa"
SSH_ROOT_PASSWORD="reardemo"
BOOT_FROM_SAN=y
AUTOEXCLUDE_MULTIPATH=n
REAR_INITRD_COMPRESSION=lzma
USE_STATIC_NETWORKING=y
ONLY_INCLUDE_VG=( "rhel_ssstfs03" )
</pre>

<ul>
<li>
<p>Are you using legacy BIOS or UEFI boot?<br />
    PPC PRep Boot</p>
</li>
<li>
<p>Brief description of the issue:<br />
    Even though Im using the ONLY_INCLUDE_VG option the
    disklayout.conf is included the swap lvol on another vg. Im also
    looking to exclude any disks managed by gpfs software.</p>
</li>
</ul>
<pre>
[root@ssstfs03 layout]# cat disklayout.conf
#lvmdev /dev/datavg /dev/mapper/mpathbe Kbe3rY-2Lhl-IYYm-IsKP-grv8-GMQB-UUV41T 209715200
lvmdev /dev/rhel_ssstfs03 /dev/mapper/mpatha3 aTXusm-kzGQ-14r7-myOi-mNsj-Iar7-pxVHKj 41959424
#lvmdev /dev/vgswap /dev/mapper/mpathbd AcAIgK-g0S4-wEav-bbQB-KLka-q0z1-FENNKb 52428800
#lvmgrp /dev/datavg 4096 25599 104853504
lvmgrp /dev/rhel_ssstfs03 4096 5121 20975616
#lvmgrp /dev/vgswap 4096 6399 26210304
#lvmvol /dev/datavg lvzimon 24320 199229440
lvmvol /dev/rhel_ssstfs03 root 256 2097152
lvmvol /dev/rhel_ssstfs03 usr 1024 8388608
lvmvol /dev/rhel_ssstfs03 opt 1024 8388608
lvmvol /dev/rhel_ssstfs03 home 512 4194304
lvmvol /dev/rhel_ssstfs03 tmp 512 4194304
lvmvol /dev/rhel_ssstfs03 var 512 4194304
lvmvol /dev/rhel_ssstfs03 var_log 768 6291456
lvmvol /dev/rhel_ssstfs03 swap 512 4194304
#lvmvol /dev/vgswap swapvol02 512 4194304
# Filesystems (only ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs are supported).
# Format: fs &lt;device> &lt;mountpoint> &lt;fstype> [uuid=&lt;uuid>] [label=&lt;label>] [&lt;attributes>]
#fs /dev/mapper/datavg-lvzimon /opt/IBM/zimon/data xfs uuid=68029364-d304-4a2e-b994-44213dc7bc0d label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/mpatha2 /boot xfs uuid=3df7e785-acac-42b4-b35b-73568426ad4e label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-home /home xfs uuid=5af3aaa8-7cfd-448b-a112-2ac933f93347 label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-opt /opt xfs uuid=e6ca811a-f69c-45b3-b99c-3c814d1c8b28 label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-root / xfs uuid=665632df-0cc4-46d6-9fea-a0d05a81aa7a label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-tmp /tmp xfs uuid=5e7f9312-de14-4319-be49-35c34a0b2830 label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-usr /usr xfs uuid=f082af39-e5eb-4df4-bd60-8f3288650fc7 label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-var /var xfs uuid=54085803-3e12-4d97-87e3-77acf0ecc85f label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/mapper/rhel_ssstfs03-var_log /var/log xfs uuid=b040c636-c008-43d1-bd37-d023c096f19a label=  options=rw,relatime,attr2,inode64,noquota
# Swap partitions or swap files
# Format: swap &lt;filename> uuid=&lt;uuid> label=&lt;label>
swap /dev/mapper/rhel_ssstfs03-swap uuid=6fe88eca-5b91-4d38-b7e7-3c85c5d15536 label=
**swap /dev/mapper/vgswap-swapvol02 uuid=ab161f52-9488-4b07-a25a-7d89dadd48b8 label=**
**multipath /dev/mapper/mpathbp 42949672960 /dev/sdbp,/dev/sdem
part /dev/mapper/mpathbp 42949623808 24576 GPFS none /dev/mapper/mpathbp1**
#multipath /dev/mapper/mpathak 10737418240 /dev/sdap,/dev/sddm
multipath /dev/mapper/mpathr 32212254720 /dev/sdaa,/dev/sdcx
part /dev/mapper/mpathr 32212205568 24576 GPFS none /dev/mapper/mpathr1
multipath /dev/mapper/mpathbc 10737418240 /dev/sdbb,/dev/sddy
part /dev/mapper/mpathbc 10737369088 24576 GPFS none /dev/mapper/mpathbc1
multipath /dev/mapper/mpathe 10737418240 /dev/sdck,/dev/sdn
part /dev/mapper/mpathe 10737369088 24576 GPFS none /dev/mapper/mpathe1
multipath /dev/mapper/mpathaw 75161927680 /dev/sdcd,/dev/sdg
part /dev/mapper/mpathaw 75161878528 24576 GPFS none /dev/mapper/mpathaw1
multipath /dev/mapper/mpathbo 42949672960 /dev/sdbq,/dev/sden
part /dev/mapper/mpathbo 42949623808 24576 GPFS none /dev/mapper/mpathbo1
multipath /dev/mapper/mpathaj 42949672960 /dev/sdak,/dev/sddh
part /dev/mapper/mpathaj 42949623808 24576 GPFS none /dev/mapper/mpathaj1
</pre>

<ul>
<li>Work-around, if any:</li>
</ul>
<h4 id="gozora_commented_at_2018-04-04_1439"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378623619">2018-04-04 14:39</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-04_1439" title="Permanent link">&para;</a></h4>
<p>Your <code>vgswap</code> is on <code>/dev/mapper/mpathbd</code> which is multipath device,
hence applies <code>AUTOEXCLUDE_MULTIPATH=n</code> which is IMHO correct.<br />
I can't tell you from top of my head what is the best/correct way to get
rid of unwanted multipath devices, but my best guess would be
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2102">EXCLUDE_COMPONENTS=()</a>,
maybe ?</p>
<p>V.</p>
<h4 id="gozora_commented_at_2018-04-04_1442"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378624793">2018-04-04 14:42</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-04_1442" title="Permanent link">&para;</a></h4>
<p>I'm not sure if</p>
<blockquote>
<p>#lvmdev /dev/vgswap /dev/mapper/mpathbd
AcAIgK-g0S4-wEav-bbQB-KLka-q0z1-FENNKb 52428800</p>
</blockquote>
<p>was modified by you, or is it original copy of your <em>disklayout.conf</em>,
so just a site note:<br />
<em>disklayout.conf</em> entries starting by '#' are ignored by ReaR ...</p>
<p>V.</p>
<h4 id="pspatola101_commented_at_2018-04-04_1752"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378688190">2018-04-04 17:52</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1752" title="Permanent link">&para;</a></h4>
<p>In the script , I see the follwoing entry:<br />
<strong>parted -s /dev/mapper/mpathf mkpart "'GPFS'" 24576B 10737393663B
&gt;&amp;2</strong></p>
<p>I'm concerned that this could over-write data on that gpfs disk. How can
that be excluded in the local.conf?<br />
What I'm really trying to do here is just try and create a recovery of
the root vg in case it gets corrupted. All my other data is on the san
and would be imported in when I recover the rootvg.</p>
<h4 id="gozora_commented_at_2018-04-04_1807"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378692978">2018-04-04 18:07</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-04_1807" title="Permanent link">&para;</a></h4>
<p>That command you've posted would indeed re-partition your disk.<br />
I'm however missing context, as I don't see <em>mpathf</em> being mentioned in
<em>layout.conf</em> you've posted previously.</p>
<p>Maybe you could upload some more complex information (<em>disklayout.conf,
diskrestore.sh</em>, ..) so that people who understand this whole multipath
ppc64le thingy <s>much better that I do</s>, have better understanding
what is going on ...</p>
<p>V.</p>
<h4 id="pspatola101_commented_at_2018-04-04_1809"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378693617">2018-04-04 18:09</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1809" title="Permanent link">&para;</a></h4>
<p>I apologize for that. I'll upload a new set.</p>
<h4 id="pspatola101_commented_at_2018-04-04_1816"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378695878">2018-04-04 18:16</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1816" title="Permanent link">&para;</a></h4>
<p>My current local.conf:</p>
<pre>
[root@ssstfs03 rear]# cat local.conf
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://172.19.5.99/stuff/unix/iowa"
SSH_ROOT_PASSWORD="reardemo"
BOOT_FROM_SAN=y
AUTOEXCLUDE_MULTIPATH=n
REAR_INITRD_COMPRESSION=lzma
USE_STATIC_NETWORKING=y
ONLY_INCLUDE_VG=( "rhel_ssstfs03" )
EXCLUDE_RECREATE=( "swap:/dev/mapper/vgswap-swapvol02" "fs:/gpfs/*" )
EXCLUDE_COMPONENTS=( "swap:/dev/mapper/vgswap-swapvol02" "fs:/gpfs/*")
BACKUP_PROG_EXCLUDE=( "${BACKUP_PROG_EXCLUDE[@]}" '/usr/lpp/mmfs/4.2.3.1' '/usr/lpp/mmfs/4.2.3.2' )
AUTOEXCLUDE_DISKS=y
</pre>

<h4 id="pspatola101_commented_at_2018-04-04_1838"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378702687">2018-04-04 18:38</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1838" title="Permanent link">&para;</a></h4>
<p>Even though I'm excluding the swap on vgswap, I see it being excluded in
the disklayout.conf except for the last line. When I'm in the rear
recover, it goes into the "Confirm or edit the disk layout file" and I
have to manually comment out that last line for it to continue.</p>
<pre>
[root@ssstfs03 layout]# cat disklayout.conf |grep vgswap
#lvmdev /dev/vgswap /dev/mapper/mpathbd AcAIgK-g0S4-wEav-bbQB-KLka-q0z1-FENNKb 52428800
#lvmgrp /dev/vgswap 4096 6399 26210304
#lvmvol /dev/vgswap swapvol02 512 4194304
swap /dev/mapper/vgswap-swapvol02 uuid=ab161f52-9488-4b07-a25a-7d89dadd48b8 label=
</pre>

<p>In the disklayout.conf: I commented out the second line myself. What
else do I need to add to my local.conf to exclude that?</p>
<pre>
# Swap partitions or swap files
# Format: swap <filename> uuid=<uuid> label=<label>
swap /dev/mapper/rhel_ssstfs03-swap uuid=6fe88eca-5b91-4d38-b7e7-3c85c5d15536 label=
##swap /dev/mapper/vgswap-swapvol02 uuid=ab161f52-9488-4b07-a25a-7d89dadd48b8 label=
</pre>

<h4 id="pspatola101_commented_at_2018-04-04_1939"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378720524">2018-04-04 19:39</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1939" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/1877370/disklayout.txt">disklayout.txt</a></p>
<h4 id="pspatola101_commented_at_2018-04-04_1952"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378724325">2018-04-04 19:52</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-04_1952" title="Permanent link">&para;</a></h4>
<p>It looks as if I'm having 2 different issues. One is the additional swap
space it looks as if its trying to format under the "#Swap partitions
or swap file" stanza. The second is it appears that its trying to
reformat the disks that GPFS maintains. That would wipe all of my data.</p>
<h4 id="jsmeix_commented_at_2018-04-05_1229"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378919232">2018-04-05 12:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-05_1229" title="Permanent link">&para;</a></h4>
<p>Since<br />
<a href="https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749">https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749</a><br />
there is a bug in
usr/share/rear/layout/save/default/330_remove_exclusions.sh<br />
so that since that commit excluded <code>swap</code> entries are no longer
disabled<br />
in disklayout.conf because since that commit <code>swap</code> entries get
disabled<br />
by <code>remove_second_component</code> which does not work for <code>swap</code> entries<br />
because <code>swap</code> entries need to get disabled with <code>remove_component</code><br />
as it was before.</p>
<h4 id="jsmeix_commented_at_2018-04-05_1243"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378922843">2018-04-05 12:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-05_1243" title="Permanent link">&para;</a></h4>
<p>Fixed the issue in the above<br />
<a href="https://github.com/rear/rear/issues/1767#issuecomment-378919232">https://github.com/rear/rear/issues/1767#issuecomment-378919232</a><br />
via<br />
<a href="https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf">https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf</a></p>
<h4 id="jsmeix_commented_at_2018-04-05_1252"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-378925290">2018-04-05 12:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-05_1252" title="Permanent link">&para;</a></h4>
<p>@pspatola101<br />
with the recent fix<br />
<a href="https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf">https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf</a><br />
in current ReaR upstream GitHub master code EXCLUDE_COMPONENTS<br />
works well for me. Regarding EXCLUDE_COMPONENTS syntax see<br />
usr/share/rear/conf/default.conf</p>
<p>For example I have in my etc/rear/local.conf</p>
<pre>
EXCLUDE_COMPONENTS+=( "fs:/sdb3" "swap:/dev/sdb1" )
</pre>

<p>and during "rear -D mkrescue" I see (excerpt):</p>
<pre>
Creating disk layout
Excluding component fs:/sdb3.
Excluding component swap:/dev/sdb1.
</pre>

<p>and afterwards I got those results (excerpts):</p>
<pre>
# egrep '^swap |^fs |#swap |#fs ' var/lib/rear/layout/disklayout.conf

fs /dev/sda2 / btrfs uuid=83a3ba1c-7c87-4249-a0cd-a60c3e41ac8a label= options=rw,relatime,space_cache,subvolid=259,subvol=/@/.snapshots/1/snapshot
fs /dev/sdb2 /sdb2 xfs uuid=778a49a1-7f11-4a95-a19b-da6e504f2f5b label=  options=rw,relatime,attr2,inode64,noquota
#fs /dev/sdb3 /sdb3 btrfs uuid=8fc4c3e0-533f-4c54-b5bc-c32daec41015 label= options=rw,relatime,space_cache,subvolid=5,subvol=/
swap /dev/sda1 uuid=b754c8dc-cd7d-42fa-8edc-a69c02c54f68 label=
#swap /dev/sdb1 uuid=d6500016-41c3-48e0-9846-914ba6cc43b3 label=
</pre>

<p>and</p>
<pre>
# egrep 'fs:|swap:' var/lib/rear/layout/disktodo.conf

todo fs:/ fs
todo fs:/sdb2 fs
done fs:/sdb3 fs
todo swap:/dev/sda1 swap
done swap:/dev/sdb1 swap
</pre>

<h4 id="jsmeix_commented_at_2018-04-06_0946"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379204450">2018-04-06 09:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-06_0946" title="Permanent link">&para;</a></h4>
<p>@pspatola101<br />
does EXCLUDE_COMPONENTS together with<br />
<a href="https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf">https://github.com/rear/rear/commit/89a53792e0dc9cb3f20d36719203e89b2e1823cf</a><br />
also work for your use case?</p>
<h4 id="jsmeix_commented_at_2018-04-09_1315"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379747700">2018-04-09 13:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-09_1315" title="Permanent link">&para;</a></h4>
<p>According to<br />
<a href="https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749#commitcomment-28455084">https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749#commitcomment-28455084</a><br />
it works now again to exclude swap partitions.</p>
<p>According to<br />
<a href="https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749#commitcomment-28455118">https://github.com/rear/rear/commit/72810e9594d121ee12b5d8394c9fc9daa31ce749#commitcomment-28455118</a><br />
a remaining question is how to exclude partitions like</p>
<pre>
part /dev/mapper/mpathr 32212205568 24576 GPFS none /dev/mapper/mpathr1
part /dev/mapper/mpathbc 10737369088 24576 GPFS none /dev/mapper/mpathbc1
</pre>

<h4 id="jsmeix_commented_at_2018-04-09_1349"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379758551">2018-04-09 13:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-09_1349" title="Permanent link">&para;</a></h4>
<p>One can exlude a partition like "/dev/sdb2" via</p>
<pre>
EXCLUDE_COMPONENTS=( "${EXCLUDE_COMPONENTS[@]}" "/dev/sdb2" )
</pre>

<p>and during "rear -D mkrescue" one can see</p>
<pre>
Excluding component /dev/sdb2.
</pre>

<p>but then all other partitions on the parent device "/dev/sdb"<br />
will be also automatically excluded because of that code in<br />
usr/share/rear/layout/save/default/330_remove_exclusions.sh</p>
<pre>
        part)
            ### find the immediate parent
            name=$(grep "^$name " "$LAYOUT_DEPS" | cut -d " " -f 2)
            remove_component "$type" "$name"
            ;;
</pre>

<p>so that one gets in disklayout.conf</p>
<pre>
root@host# grep dev/sdb var/lib/rear/layout/disklayout.conf

# Disk /dev/sdb
disk /dev/sdb 2147483648 msdos
# Partitions on /dev/sdb
#part /dev/sdb 103809024 1048576 primary none /dev/sdb1
#part /dev/sdb 104857600 209715200 primary none /dev/sdb2
#part /dev/sdb 1728053248 419430400 primary none /dev/sdb3
#fs /dev/sdb2 /sdb2 xfs uuid=778a49a1-7f11-4a95-a19b-da6e504f2f5b label=  options=rw,relatime,attr2,inode64,noquota
fs /dev/sdb3 /sdb3 btrfs uuid=8fc4c3e0-533f-4c54-b5bc-c32daec41015 label= options=rw,relatime,space_cache,subvolid=5,subvol=/
# Btrfs default subvolume for /dev/sdb3 at /sdb3
btrfsdefaultsubvol /dev/sdb3 /sdb3 5 /
btrfsmountedsubvol /dev/sdb3 /sdb3 rw,relatime,space_cache,subvolid=5,subvol=/ /
swap /dev/sdb1 uuid=d6500016-41c3-48e0-9846-914ba6cc43b3 label=
</pre>

<p>which shows a bug because only all other partitions<br />
on the parent device will be also automatically excluded<br />
but neither their affected filesystems nor swap entries.</p>
<p>I assume it is no bug but exactly right to also automatically all other
partitions<br />
on the parent device "/dev/sdb" because I assume somehow "rear
recover"<br />
may fail when it should skip an excluded partition "in between" other
partitions.</p>
<p>I guess the reason behind is how the create_partitions() function in<br />
usr/share/rear/layout/prepare/GNU/Linux/100_include_partition_code.sh<br />
works but I don't know the actual reason behind because according to the
output of</p>
<pre>
git log -p --follow usr/share/rear/layout/save/default/330_remove_exclusions.sh
</pre>

<p>the initial commit where the whole parent device gets exluded<br />
when one of its partitions was exluded is<br />
<a href="https://github.com/rear/rear/commit/6a502f6190e1cd04ce7b9b21658452ee489c41bb">https://github.com/rear/rear/commit/6a502f6190e1cd04ce7b9b21658452ee489c41bb</a><br />
where the code was</p>
<pre>
        part)
            name=$( echo "$name" | sed -r 's/(.*)[0-9]$/\1/')
            if [ "${name/cciss/}" != "$name" ] ; then
                name=${name%p}
            fi
            remove_component $type $name
            ;;
</pre>

<p>with an evil <code>echo "$name" | sed -r 's/(.*)[0-9]$/\1/'</code> that just
breaks<br />
when there are more than 9 partitions:</p>
<pre>
# name=/dev/sdb2
# echo "$name" | sed -r 's/(.*)[0-9]$/\1/'
/dev/sdb

# name=/dev/sdb12
# echo "$name" | sed -r 's/(.*)[0-9]$/\1/'
/dev/sdb1
</pre>

<p>which was (hopefully) fixed by that commit<br />
<a href="https://github.com/rear/rear/commit/3101421f66d2be65d20f6304a3359944afbe2fdf">https://github.com/rear/rear/commit/3101421f66d2be65d20f6304a3359944afbe2fdf</a><br />
to the current code</p>
<pre>
         part)
            ### find the immediate parent
            name=$(grep "^$name " $LAYOUT_DEPS | cut -d " " -f 2)
             remove_component $type $name
             ;;
</pre>

<h4 id="jsmeix_commented_at_2018-04-09_1414"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379766752">2018-04-09 14:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-09_1414" title="Permanent link">&para;</a></h4>
<p>@schabrolles @gozora<br />
do you perhaps have an idea how to exclude specifically partitions like</p>
<pre>
part /dev/mapper/mpathr 32212205568 24576 GPFS none /dev/mapper/mpathr1
part /dev/mapper/mpathbc 10737369088 24576 GPFS none /dev/mapper/mpathbc1
</pre>

<p>without also automatically exclude all other partitions on the same
disk?</p>
<p>I do not use multipath so that I cannot reproduce<br />
how ReaR actually behaves in this case.</p>
<p>Perhaps in case of multipath things are different to that it may not
matter<br />
when also automatically all other partitions on the same disk get
excluded?</p>
<h4 id="pspatola101_commented_at_2018-04-09_1452"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379779908">2018-04-09 14:52</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-09_1452" title="Permanent link">&para;</a></h4>
<p>I would be ok with a global exclude of any disk that has a "GPFS" label
on it. Those disks are managed exclusively by the cluster application
and wouldn't have any other partitions on them.</p>
<h4 id="pspatola101_commented_at_2018-04-09_1539"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379796454">2018-04-09 15:39</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-09_1539" title="Permanent link">&para;</a></h4>
<p>I did try a few things with the local.conf. I removed every exclude and
went with the 'ONLY_INCLUDE_VG' and added the name of my rootvg. That
works with the fix you gave me and only includes the partitions on my
rootvg. The swap on the other vg is commented out on the
disklayout.conf.</p>
<pre>
[root@ssstfs03 rear]# cat local.conf
OUTPUT=ISO
BACKUP=NETFS
BACKUP_URL="nfs://172.19.5.99/stuff/unix/iowa"
SSH_ROOT_PASSWORD="reardemo"
BOOT_FROM_SAN=y
AUTOEXCLUDE_MULTIPATH=n
REAR_INITRD_COMPRESSION=lzma
USE_STATIC_NETWORKING=y
**ONLY_INCLUDE_VG=( "${ONLY_INCLUDE_VG[@]}" "rhel_ssstfs03" )**

[root@ssstfs03 layout]# cat disklayout.conf |grep swap
#lvmdev /dev/vgswap /dev/mapper/mpathbd AcAIgK-g0S4-wEav-bbQB-KLka-q0z1-FENNKb 52428800
#lvmgrp /dev/vgswap 4096 6399 26210304
lvmvol /dev/rhel_ssstfs03 swap 512 4194304
#lvmvol /dev/vgswap swapvol02 512 4194304
# Swap partitions or swap files
# Format: swap <filename> uuid=<uuid> label=<label>
swap /dev/mapper/rhel_ssstfs03-swap uuid=6fe88eca-5b91-4d38-b7e7-3c85c5d15536 label=
**#swap /dev/mapper/vgswap-swapvol02 uuid=ab161f52-9488-4b07-a25a-7d89dadd48b8 label=**
</pre>

<p>Unfortunately, the GPFS disks are still being included.<br />
If I change the multipath flag to yes, it excludes the gpfs disks but
also excludes my boot drive as well which is npiv attached. The
disklayout.conf has everything excluded.</p>
<h4 id="pspatola101_commented_at_2018-04-09_1631"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-379813210">2018-04-09 16:31</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-04-09_1631" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/1890765/rear-ssstfs03.log">rear-ssstfs03.log</a><br />
I see at 335_remove_excluded_multipath_vgs.sh that its excluding the
multpath disks that belong to the other volume groups and a few that are
not being used.</p>
<h4 id="schabrolles_commented_at_2018-05-07_1310"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387059291">2018-05-07 13:10</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-07_1310" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>As GPFS is a very specific filesystem, I think we should exclude it by
default.<br />
What about defining an <code>AUTOEXCLUDE_GPFS=y</code>variable in default.conf</p>
<h4 id="pspatola101_commented_at_2018-05-07_2034"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387196969">2018-05-07 20:34</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-07_2034" title="Permanent link">&para;</a></h4>
<p>That would be great!</p>
<h4 id="pspatola101_commented_at_2018-05-07_2101"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387205197">2018-05-07 21:01</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-07_2101" title="Permanent link">&para;</a></h4>
<p>How would I go about doing that?</p>
<h4 id="jsmeix_commented_at_2018-05-08_0942"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387346382">2018-05-08 09:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-08_0942" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
in usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh there
is</p>
<pre>
supported_filesystems="ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs"
</pre>

<p>so that the GPFS filesystem is not supported by ReaR.</p>
<p>@pspatola101<br />
when a filesystem is not supported by ReaR it means<br />
ReaR has no code to recreate such filesystems.</p>
<p>Accordingly it does not make sense to have any <code>fs</code> entries<br />
for GPFS filesystems in disklayout.conf (which do not happen)<br />
BUT<br />
it does make sense to have <code>part</code> entries for partitions<br />
that have a <code>GPFS</code> partition type/name in disklayout.conf</p>
<p>Reason:<br />
On one same disk there can be <code>part</code> entries for partitions<br />
that have a filesystem that is supported by ReaR<br />
plus (on the same disk) there can be <code>part</code> entries for partitions<br />
that have a filesystem that is not supported by ReaR e.g. like:</p>
<pre>
part /dev/sda ... ... ext2 none /dev/sda1
part /dev/sda ... ... GPFS none /dev/sda2
part /dev/sda ... ... XFS none /dev/sda3
</pre>

<p>During "rear recover" all three partitions must be recreated<br />
because otherwise the XFS partition would become /dev/sda2<br />
cf.
<a href="https://github.com/rear/rear/issues/1793">https://github.com/rear/rear/issues/1793</a></p>
<p>Even if in parctice a partition with a <code>GPFS</code> partition type/name<br />
cannot be on the same disk together with partitions<br />
that have a filesystem that is supported by ReaR<br />
my gut feeling is that <code>AUTOEXCLUDE_GPFS=y</code><br />
looks like a quick and dirty hack that may cause<br />
other issues in the future.</p>
<p>I fear the actual solution is to overhaul the current
EXCLUDE_COMPONENTS<br />
implementation to make it usable even for special needs like this one.<br />
I think the current EXCLUDE_COMPONENTS implementation needs to be<br />
enhanced so that user can specify more exactly what he wants to get
excluded.</p>
<p>@pspatola101<br />
Note that usually things will go wrong during "rear recover"<br />
when you exclude to recreate one particular partition<br />
that is between other partitions on a disk (see my reason above).<br />
I think it should work to only exclude one or more last partitions<br />
on a disk but I think this is currently not implemented in ReaR.</p>
<h4 id="schabrolles_commented_at_2018-05-08_1242"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387389332">2018-05-08 12:42</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-08_1242" title="Permanent link">&para;</a></h4>
<p>The PR #1801 could help here.<br />
As no fs: GPFS are stored in the disklayout.conf, all GPFS multipath
devices and partitions should be commented.</p>
<h4 id="pspatola101_commented_at_2018-05-08_1509"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387435831">2018-05-08 15:09</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-08_1509" title="Permanent link">&para;</a></h4>
<p>Thank you all for all your work.<br />
@schabrolles<br />
When would I be able to access the new build?<br />
@jsmeix<br />
I understand what you mean. The gpfs exclusion would fix my issue it may
open up the group to other single fix issues.</p>
<p>I do have one more question. I'm looking at this as using a mksysb for
aix. If I have the following statement in my local.conf.<br />
ONLY_INCLUDE_VG=( "${ONLY_INCLUDE_VG[@]}" "rhel_ssstfs03" )<br />
Why would it be trying to do anything else with the gpfs disks or any of
the other vg? Shouldn't it be excluding everything but the included vg?</p>
<h4 id="schabrolles_commented_at_2018-05-08_1524"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387441423">2018-05-08 15:24</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-08_1524" title="Permanent link">&para;</a></h4>
<p>@pspatola101,</p>
<p>I prefer to have a review from @jsmeix and @gozora before merging it
into master branch.<br />
If you can't wait, you can evaluate it from here:</p>
<pre><code>git clone http://github.com/schabrolles/rear -b exclude_mpath_no_fs
mv rear rear.github.exclude_mpath_no_fs
cd rear.github.exclude_mpath_no_fs
vi etc/rear/local.conf
usr/sbin/rear -D mkbackup
</code></pre>
<h4 id="schabrolles_commented_at_2018-05-08_1554"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387451517">2018-05-08 15:54</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-08_1554" title="Permanent link">&para;</a></h4>
<p>@pspatola101,<br />
ONLY_INCLUDE_VG=( "rootvg" ) means exclude ALL the other VGs ... But
you can have FS directly on disks.<br />
Normally, all non-monted or unsupported FS are excluded by default. ReaR
should exclude GPFS disks as it already exclude the fs (it is not in
disklayout.conf). But you need the fix #1801 in order to have it work
properly with multipath and not only pure disk.</p>
<h4 id="pspatola101_commented_at_2018-05-08_1720"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387477215">2018-05-08 17:20</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-08_1720" title="Permanent link">&para;</a></h4>
<p>Thank you for the response. I will be patient and wait.</p>
<h4 id="jsmeix_commented_at_2018-05-09_0950"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387685874">2018-05-09 09:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-05-09_0950" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
regarding your
<a href="https://github.com/rear/rear/issues/1767#issuecomment-387389332">https://github.com/rear/rear/issues/1767#issuecomment-387389332</a></p>
<pre>
As no fs: GPFS are stored in the disklayout.conf, all GPFS multipath devices
and partitions should be commented.
</pre>

<p>I think this is not right in general.</p>
<p>I think the opposite is true:<br />
When there is a <code>part</code> entry without a matching <code>fs</code> entry in
disklayout.conf<br />
the <code>part</code> entry cannot be commented in general because that may lead<br />
to a wrong recreated partitioning, see my "Reason" in<br />
<a href="https://github.com/rear/rear/issues/1767#issuecomment-387346382">https://github.com/rear/rear/issues/1767#issuecomment-387346382</a></p>
<h4 id="schabrolles_commented_at_2018-05-09_1026"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387695000">2018-05-09 10:26</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-09_1026" title="Permanent link">&para;</a></h4>
<p>@jsmeix,</p>
<p>So, I maybe miss something... if <code>AUTOEXCLUDE_DISKS=y</code> (which is the
default) all disks (and multipath if #1801 is applied) should be
excluded if they are not a parent of a mounted fs:<br />
This should prevent RAW devices disk to be recreated (partition etc ...
) and other non-supported FS (like GPFS)</p>
<p><em>extract from default.conf</em></p>
<pre><code># Automatically exclude disks that are not used by mounted filesystems
# Explicitly excluding/including devices is generally a safer option.
# (layout code)
AUTOEXCLUDE_DISKS=y
</code></pre>
<p>Please, correct me if I'm wrong.</p>
<h4 id="schabrolles_commented_at_2018-05-09_1028"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-387695640">2018-05-09 10:28</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-09_1028" title="Permanent link">&para;</a></h4>
<p>@jsmeix , forget my last comment... I just get your point (with multiple
partitions) ...</p>
<h4 id="schabrolles_commented_at_2018-05-10_1500"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388080157">2018-05-10 15:00</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-10_1500" title="Permanent link">&para;</a></h4>
<p>@pspatola101<br />
#1801 is now merged into rear master branch. Could you make a test and
tell us if it solves you issue?<br />
Thanks.</p>
<h4 id="pspatola101_commented_at_2018-05-14_1521"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388856387">2018-05-14 15:21</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-14_1521" title="Permanent link">&para;</a></h4>
<p>Hey guys... I ran it this morning and I received the following error
message.<br />
[root@ssstfs03 ~]# rear -D mkrescue<br />
Relax-and-Recover 2.3-git.2991.e4eb0e1.master.changed / 2018-05-14<br />
Using log file: /var/log/rear/rear-ssstfs03.log<br />
Using backup archive
'/tmp/rear.fNJ8lRBPtGLi2Sh/outputfs/ssstfs03/backup.tar.gz'<br />
Creating disk layout<br />
ERROR: Partition number '' of partition datavg-lvzimon is not a valid
number.<br />
ERROR: Partition datavg-lvzimon is numbered ''. More than 128 partitions
is not supported.</p>
<h4 id="pspatola101_commented_at_2018-05-14_1522"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388856506">2018-05-14 15:21</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-14_1522" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2001429/rear-ssstfs03.log">rear-ssstfs03.log</a></p>
<h4 id="pspatola101_commented_at_2018-05-14_1528"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388859068">2018-05-14 15:28</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-14_1528" title="Permanent link">&para;</a></h4>
<p>looks like someone had a similar issue with Oracle ASM disks before.<br />
<a href="https://github.com/rear/rear/issues/373">https://github.com/rear/rear/issues/373</a></p>
<h4 id="schabrolles_commented_at_2018-05-14_1554"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388867774">2018-05-14 15:54</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-14_1554" title="Permanent link">&para;</a></h4>
<p>@pspatola101 my PR #1802 introduces a new BUG when you create LVM
physical Volume directly on the disk (without any partition). I'm gonna
look at it.</p>
<h4 id="schabrolles_commented_at_2018-05-14_1719"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-388895347">2018-05-14 17:19</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-14_1719" title="Permanent link">&para;</a></h4>
<p>@pspatola101, I've isolated the issue. It is now working for me with a
Redhat and VG created directly on the disk (like you).<br />
I would like to perform some additional test with other distribution
(Suse/Ubuntu) before creating a new PR.<br />
If you have time and want to test the fix, it is here:</p>
<pre><code>git clone http://github.com/schabrolles/rear -b get_only_partition_from_holders
</code></pre>
<h4 id="pspatola101_commented_at_2018-05-15_1629"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-389230237">2018-05-15 16:29</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-15_1629" title="Permanent link">&para;</a></h4>
<p>It worked beautifully!!!!! I really appreciate your work on this. The
mkrescue finished successfully. This is the layout of the the todo file.
The GPFS multipath disks are commented out in the disklayout.conf!
Please let me know when it merges into the master branch.<br />
[root@ssstfs03 layout]# cat disktodo.conf<br />
done pv:/dev/mapper/mpathbe lvmdev<br />
todo pv:/dev/mapper/mpatha3 lvmdev<br />
done pv:/dev/mapper/mpathbd lvmdev<br />
done /dev/datavg lvmgrp<br />
todo /dev/rhel_ssstfs03 lvmgrp<br />
done /dev/vgswap lvmgrp<br />
done /dev/mapper/datavg-lvzimon lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-root lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-usr lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-opt lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-home lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-tmp lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-var lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-var_log lvmvol<br />
todo /dev/mapper/rhel_ssstfs03-swap lvmvol<br />
done /dev/mapper/vgswap-swapvol02 lvmvol<br />
done fs:/opt/IBM/zimon/data fs<br />
todo fs:/boot fs<br />
todo fs:/home fs<br />
todo fs:/opt fs<br />
todo fs:/ fs<br />
todo fs:/tmp fs<br />
todo fs:/usr fs<br />
todo fs:/var fs<br />
todo fs:/var/log fs<br />
todo swap:/dev/mapper/rhel_ssstfs03-swap swap<br />
done swap:/dev/mapper/vgswap-swapvol02 swap<br />
done /dev/mapper/mpathbp multipath<br />
done /dev/mapper/mpathbp1 part<br />
done /dev/mapper/mpathak multipath<br />
done /dev/mapper/mpathr multipath<br />
done /dev/mapper/mpathr1 part<br />
done /dev/mapper/mpathbc multipath<br />
done /dev/mapper/mpathbc1 part<br />
done /dev/mapper/mpathe multipath<br />
done /dev/mapper/mpathe1 part<br />
done /dev/mapper/mpathaw multipath<br />
done /dev/mapper/mpathaw1 part<br />
done /dev/mapper/mpathbo multipath<br />
done /dev/mapper/mpathbo1 part<br />
done /dev/mapper/mpathaj multipath<br />
done /dev/mapper/mpathaj1 part<br />
done /dev/mapper/mpathq multipath<br />
done /dev/mapper/mpathq1 part<br />
done /dev/mapper/mpathd multipath<br />
done /dev/mapper/mpathd1 part<br />
done /dev/mapper/mpathbb multipath<br />
done /dev/mapper/mpathbb1 part<br />
done /dev/mapper/mpathav multipath<br />
done /dev/mapper/mpathav1 part<br />
done /dev/mapper/mpathbn multipath<br />
done /dev/mapper/mpathbn1 part<br />
done /dev/mapper/mpathai multipath<br />
done /dev/mapper/mpathai1 part<br />
done /dev/mapper/mpathp multipath<br />
done /dev/mapper/mpathp1 part<br />
done /dev/mapper/mpathba multipath<br />
done /dev/mapper/mpathba1 part<br />
done /dev/mapper/mpathc multipath<br />
done /dev/mapper/mpathc1 part<br />
done /dev/mapper/mpathbz multipath<br />
done /dev/mapper/mpathau multipath<br />
done /dev/mapper/mpathau1 part<br />
done /dev/mapper/mpathbm multipath<br />
done /dev/mapper/mpathbm1 part<br />
done /dev/mapper/mpathah multipath<br />
done /dev/mapper/mpatho multipath<br />
done /dev/mapper/mpatho1 part<br />
done /dev/mapper/mpathb multipath<br />
done /dev/mapper/mpathb1 part<br />
done /dev/mapper/mpathby multipath<br />
done /dev/mapper/mpathat multipath<br />
done /dev/mapper/mpathat1 part<br />
done /dev/mapper/mpathbl multipath<br />
done /dev/mapper/mpathbl1 part<br />
done /dev/mapper/mpathag multipath<br />
done /dev/mapper/mpathag1 part<br />
done /dev/mapper/mpathn multipath<br />
done /dev/mapper/mpathn1 part<br />
todo /dev/mapper/mpatha multipath<br />
todo /dev/mapper/mpatha1 part<br />
todo /dev/mapper/mpatha2 part<br />
todo /dev/mapper/mpatha3 part<br />
done /dev/mapper/mpathbx multipath<br />
done /dev/mapper/mpathas multipath<br />
done /dev/mapper/mpathas1 part<br />
done /dev/mapper/mpathz multipath<br />
done /dev/mapper/mpathz1 part<br />
done /dev/mapper/mpathbk multipath<br />
done /dev/mapper/mpathbk1 part<br />
done /dev/mapper/mpathaf multipath<br />
done /dev/mapper/mpathm multipath<br />
done /dev/mapper/mpathm1 part<br />
done /dev/mapper/mpathbw multipath<br />
done /dev/mapper/mpathbw1 part<br />
done /dev/mapper/mpathar multipath<br />
done /dev/mapper/mpathar1 part<br />
done /dev/mapper/mpathy multipath<br />
done /dev/mapper/mpathy1 part<br />
done /dev/mapper/mpathbj multipath<br />
done /dev/mapper/mpathbj1 part<br />
done /dev/mapper/mpathae multipath<br />
done /dev/mapper/mpathl multipath<br />
done /dev/mapper/mpathl1 part<br />
done /dev/mapper/mpathbv multipath<br />
done /dev/mapper/mpathbv1 part<br />
done /dev/mapper/mpathaq multipath<br />
done /dev/mapper/mpathaq1 part<br />
done /dev/mapper/mpathx multipath<br />
done /dev/mapper/mpathx1 part<br />
done /dev/mapper/mpathbi multipath<br />
done /dev/mapper/mpathbi1 part<br />
done /dev/mapper/mpathad multipath<br />
done /dev/mapper/mpathk multipath<br />
done /dev/mapper/mpathk1 part<br />
done /dev/mapper/mpathbu multipath<br />
done /dev/mapper/mpathbu1 part<br />
done /dev/mapper/mpathap multipath<br />
done /dev/mapper/mpathap1 part<br />
done /dev/mapper/mpathw multipath<br />
done /dev/mapper/mpathw1 part<br />
done /dev/mapper/mpathbh multipath<br />
done /dev/mapper/mpathbh1 part<br />
done /dev/mapper/mpathac multipath<br />
done /dev/mapper/mpathj multipath<br />
done /dev/mapper/mpathj1 part<br />
done /dev/mapper/mpathbt multipath<br />
done /dev/mapper/mpathbt1 part<br />
done /dev/mapper/mpathao multipath<br />
done /dev/mapper/mpathao1 part<br />
done /dev/mapper/mpathv multipath<br />
done /dev/mapper/mpathv1 part<br />
done /dev/mapper/mpathbg multipath<br />
done /dev/mapper/mpathbg1 part<br />
done /dev/mapper/mpathab multipath<br />
done /dev/mapper/mpathab1 part<br />
done /dev/mapper/mpathi multipath<br />
done /dev/mapper/mpathi1 part<br />
done /dev/mapper/mpathbs multipath<br />
done /dev/mapper/mpathbs1 part<br />
done /dev/mapper/mpathan multipath<br />
done /dev/mapper/mpathan1 part<br />
done /dev/mapper/mpathu multipath<br />
done /dev/mapper/mpathu1 part<br />
done /dev/mapper/mpathbf multipath<br />
done /dev/mapper/mpathbf1 part<br />
done /dev/mapper/mpathaa multipath<br />
done /dev/mapper/mpathaa1 part<br />
done /dev/mapper/mpathh multipath<br />
done /dev/mapper/mpathh1 part<br />
done /dev/mapper/mpathaz multipath<br />
done /dev/mapper/mpathaz1 part<br />
done /dev/mapper/mpathbr multipath<br />
done /dev/mapper/mpathbr1 part<br />
done /dev/mapper/mpatham multipath<br />
done /dev/mapper/mpatham1 part<br />
done /dev/mapper/mpatht multipath<br />
done /dev/mapper/mpatht1 part<br />
done /dev/mapper/mpathbe multipath<br />
done /dev/mapper/mpathg multipath<br />
done /dev/mapper/mpathg1 part<br />
done /dev/mapper/mpathay multipath<br />
done /dev/mapper/mpathay1 part<br />
done /dev/mapper/mpathbq multipath<br />
done /dev/mapper/mpathbq1 part<br />
done /dev/mapper/mpathal multipath<br />
done /dev/mapper/mpathal1 part<br />
done /dev/mapper/mpaths multipath<br />
done /dev/mapper/mpaths1 part<br />
done /dev/mapper/mpathbd multipath<br />
done /dev/mapper/mpathf multipath<br />
done /dev/mapper/mpathf1 part<br />
done /dev/mapper/mpathax multipath<br />
done /dev/mapper/mpathax1 part</p>
<h4 id="schabrolles_commented_at_2018-05-15_1705"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-389241506">2018-05-15 17:05</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-15_1705" title="Permanent link">&para;</a></h4>
<p>@pspatola101 thanks for the prompt feedback, it really help us.<br />
PR #1805 is already created. I'm just waiting for other member to have
a quick review on it before merging.... (hopfully tomorrow).</p>
<h4 id="schabrolles_commented_at_2018-05-18_0726"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-390119761">2018-05-18 07:26</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-18_0726" title="Permanent link">&para;</a></h4>
<p>@pspatola101, #1805 is now merged into master branch.</p>
<p>Please confirm everything is working now to close this issue.</p>
<p>Thanks.</p>
<h4 id="schabrolles_commented_at_2018-05-23_0814"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-391260774">2018-05-23 08:14</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-23_0814" title="Permanent link">&para;</a></h4>
<p>@pspatola101, any news ?</p>
<h4 id="pspatola101_commented_at_2018-05-29_1517"><img src="https://avatars.githubusercontent.com/u/37379705?v=4" width="50"><a href="https://github.com/pspatola101">pspatola101</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-392815723">2018-05-29 15:17</a>:<a class="headerlink" href="#pspatola101_commented_at_2018-05-29_1517" title="Permanent link">&para;</a></h4>
<p>Apologize for the delay Sebastien. The new package worked like a charm!.
Everything is commented out as it should be. I really appreciate all
your hard work with this. If you ever need a tester for redhat power
linux please do not hesitate to contact me. I would be happy to help.</p>
<h4 id="schabrolles_commented_at_2018-05-29_1728"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-392865992">2018-05-29 17:28</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-05-29_1728" title="Permanent link">&para;</a></h4>
<p>@pspatola101 You're welcome.<br />
could you please drop me a mail at <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#46;&#99;&#104;&#97;&#98;&#114;&#111;&#108;&#108;&#101;&#115;&#64;&#102;&#114;&#46;&#105;&#98;&#109;&#46;&#99;&#111;&#109;">&#115;&#46;&#99;&#104;&#97;&#98;&#114;&#111;&#108;&#108;&#101;&#115;&#64;&#102;&#114;&#46;&#105;&#98;&#109;&#46;&#99;&#111;&#109;</a>. As I would
like to discuss more with you offline about your activity around linux,
redhat, power and rear. ... Thanks if you have time to do that.</p>
<h4 id="jsmeix_commented_at_2018-08-01_0730"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1767#issuecomment-409478245">2018-08-01 07:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-08-01_0730" title="Permanent link">&para;</a></h4>
<p>I fixed an evil logical typo in my<br />
<a href="https://github.com/rear/rear/issues/1767#issuecomment-387346382">https://github.com/rear/rear/issues/1767#issuecomment-387346382</a></p>
<p>Before it was (wrong):</p>
<pre>
... it does not make sense to have any fs entries
for GPFS filesystems in disklayout.conf (which do not happen)
BUT
it does not make sense to have part entries for partitions
that have a GPFS partition type/name in disklayout.conf
</pre>

<p>Now it is (right):</p>
<pre>
... it does not make sense to have any fs entries
for GPFS filesystems in disklayout.conf (which do not happen)
BUT
it does make sense to have part entries for partitions
that have a GPFS partition type/name in disklayout.conf
</pre>

<p>i.e. for <code>fs entries</code> it still <code>does not make sense</code><br />
but for <code>part entries</code> it must be <code>it does make sense</code></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-04-03.1767.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
