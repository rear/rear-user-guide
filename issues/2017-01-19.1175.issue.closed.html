<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1175 Issue closed: tar in ReaR didn't recover ACL and capabilities attributes of files - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1175 Issue closed: tar in ReaR didn\u0027t recover ACL and capabilities attributes of files";
        var mkdocs_page_input_path = "issues/2017-01-19.1175.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1175 Issue closed: tar in ReaR didn't recover ACL and capabilities attributes of files</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1175_issue_closed_tar_in_rear_didnt_recover_acl_and_capabilities_attributes_of_files"><a href="https://github.com/rear/rear/issues/1175">#1175 Issue</a> <code>closed</code>: tar in ReaR didn't recover ACL and capabilities attributes of files<a class="headerlink" href="#1175_issue_closed_tar_in_rear_didnt_recover_acl_and_capabilities_attributes_of_files" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>, <code>fixed / solved / done</code>,
<code>not ReaR / invalid</code></p>
<h4 id="gdha_opened_issue_at_2017-01-19_1027"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> opened issue at <a href="https://github.com/rear/rear/issues/1175">2017-01-19 10:27</a>:<a class="headerlink" href="#gdha_opened_issue_at_2017-01-19_1027" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version (/usr/sbin/rear -V): 1.17.2</li>
<li>OS version (cat /etc/rear/os.conf or lsb_release -a): RHEL 7.2</li>
<li>rear configuration files (cat /etc/rear/site.conf or cat
    /etc/rear/local.conf):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup
BACKUP=NETFS
BACKUP_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup
BACKUP_PROG=tar
BACKUP_PROG_OPTIONS="--anchored --acls --xattrs"
BACKUP_TYPE=incremental
FULLBACKUPDAY="Mon"
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media' '/var/tmp' '/var/crash' '/var/mqm' '/applog' '/oraclient' '/appsw' '/infsw' '/infha4' '/appcore' '/appbin' '/appwrk' '/inftmp' '/appshr' '/applog')
</code></pre>
<ul>
<li>Are you using legacy BIOS of UEFI boot? BIOS</li>
<li>Brief description of the issue:<br />
    Although applying the following backup options so that ACL could be
    backed up and recovered<br />
    for the certain files when backing filesystem up, ACL could not be
    applied after recovering.</li>
</ul>
<h4 id="gdha_commented_at_2017-01-19_1028"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-273737147">2017-01-19 10:28</a>:<a class="headerlink" href="#gdha_commented_at_2017-01-19_1028" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Description of problem:<br />
    Although applying the following backup options so that ACL could be
    backed up and recovered<br />
    for the certain files when backing filesystem up, ACL could not be
    applied after recovering.</p>
</li>
<li>
<p>Version-Release number of selected component (if applicable):<br />
    RHEL 7.2<br />
    rear-1.17.2-1.el7.noarch</p>
</li>
<li>
<p>How reproducible:<br />
    Always</p>
</li>
<li>
<p>Steps to Reproduce:</p>
</li>
<li>
<p>Created VM</p>
</li>
<li>
<p>Installed RHEL 7.2</p>
</li>
<li>
<p>Configured local repository after mount ISO installation image.</p>
</li>
<li>
<p>Install rear package<br />
    $ yum install rear</p>
</li>
<li>
<p>Configure /etc/reare/local.conf</p>
</li>
</ul>
<p>OUTPUT=ISO<br />
OUTPUT_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup<br />
BACKUP=NETFS<br />
BACKUP_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup<br />
BACKUP_PROG=tar<br />
BACKUP_PROG_OPTIONS="--anchored --acls --xattrs"<br />
BACKUP_TYPE=incremental<br />
FULLBACKUPDAY="Mon"<br />
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media'
'/var/tmp' '/var/crash' '/var/mqm' '/applog' '/oraclient' '/appsw'
'/infsw' '/infha4' '/appcore' '/appbin' '/appwrk' '/inftmp' '/appshr'
'/applog')</p>
<ol>
<li>
<p>Run the following command.<br />
    @ setfacl -m u:<user>:r /var/log/messages</p>
</li>
<li>
<p>Create backup<br />
    $ rear -d -D mkbackup</p>
</li>
<li>
<p>Confirm if backup is created.<br />
    We confirmed if backup data and ISO image are created in local
    /backup directory and backup directory in NFS Server.</p>
</li>
<li>
<p>Perform recovery with rear ISO created.</p>
</li>
<li>
<p>Recover from rear ISO and the reboot.</p>
</li>
<li>
<p>Confirm if ACL is properly applied with the following command.<br />
    $ getfacl /var/log/messages</p>
</li>
<li>
<p>You could see that ACL before backup is not applied.</p>
</li>
<li>
<p>Actual results:<br />
    ACL changed is not applied after recovery via rear ISO.</p>
</li>
<li>
<p>Expected results:<br />
    ACL changed should be applied after recovery via rear ISO.</p>
</li>
<li>
<p>Additional info:<br />
    Here are the configuration and log file that we'd seen</p>
</li>
</ol>
<p>/etc/rear/local.conf</p>
<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup
BACKUP=NETFS
BACKUP_URL=nfs://xxx.xxx.xxx.xxx/sswp_appshr/backup
BACKUP_PROG=tar
BACKUP_PROG_OPTIONS="--anchored --acls --xattrs"
BACKUP_TYPE=incremental
FULLBACKUPDAY="Mon"
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/media' '/var/tmp' '/var/crash' '/var/mqm' '/applog' '/oraclient' '/appsw' '/infsw' '/infha4' '/appcore' '/appbin' '/appwrk' '/inftmp' '/appshr' '/applog')
</code></pre>
<p>We see the following "Warning" messages when checking log files
regarding recover.</p>
<pre><code>Warning: Cannot acl_from_text


2016-11-10 08:58:21 Including restore/NETFS/default/38_prepare_multiple_isos.sh
2016-11-10 08:58:21 Including restore/NETFS/default/40_restore_backup.sh
2016-11-10 08:58:21 Decrypting disabled
2016-11-10 08:58:21 Restoring tar archive '/tmp/rear.yRb6VE9IiDq3wUW/outputfs/skt-sswpbt04/2016-11-10-1743-I.tar.gz'
2016-11-10 08:58:21 dd if=/tmp/rear.yRb6VE9IiDq3wUW/outputfs/skt-sswpbt04/2016-11-10-1736-F.tar.gz | cat | tar --block-number --totals --verbose --anchored --acls --xattrs --gzip -C /mnt/local/ -x -f -
tar: var/log/messages: Warning: Cannot acl_from_text
10003278+1 records in
10003278+1 records out
5121678690 bytes (5.1 GB) copied, 65.728 s, 77.9 MB/s
Total bytes read: 11235604480 (11GiB, 164MiB/s)
2016-11-10 08:59:31 dd if=/tmp/rear.yRb6VE9IiDq3wUW/outputfs/skt-sswpbt04/2016-11-10-1743-I.tar.gz | cat | tar --block-number --totals --verbose --anchored --acls --xattrs --gzip -C /mnt/local/ -x -f -
tar: var/log/messages: Warning: Cannot acl_from_text
10003847+1 records in
10003847+1 records out
5121969805 bytes (5.1 GB) copied, 92.0977 s, 55.6 MB/s
</code></pre>
<p>We see this issue when checking if ACL is properly applied or not at the
filesystem recovered as running "rear recover" after entering Recovery
menu since booting with "Rear ISO" media.<br />
Initial logged as RHBZ#
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1398082">https://bugzilla.redhat.com/show_bug.cgi?id=1398082</a></p>
<h4 id="andral_commented_at_2017-01-26_1524"><img src="https://avatars.githubusercontent.com/u/5513756?v=4" width="50"><a href="https://github.com/andral">andral</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-275416121">2017-01-26 15:24</a>:<a class="headerlink" href="#andral_commented_at_2017-01-26_1524" title="Permanent link">&para;</a></h4>
<p>I think we are having the same issue, although not with ACLs but with
the sticky bit not being recovered.<br />
We discovered this when running ping as a non-root user after a
otherwise successful restore.</p>
<pre><code> $ ping ntp
ping: icmp open socket: Operation not permitted
</code></pre>
<p>Further inspection showed that other files are also affected.</p>
<p>Before restore:</p>
<pre><code> $ sudo ls -al /usr/bin/a*
-rwxr-xr-x  1 root root 107824 Jul  7  2015 /usr/bin/a2p
-rwxr-xr-x  1 root root   1661 Jul  2  2015 /usr/bin/abs2rel
-rwxr-xr-x  1 root root  29032 Oct 13  2015 /usr/bin/addr2line
-rwxr-xr-x  1 root root  66928 Jul  3  2014 /usr/bin/afio
-rwxr-xr-x  1 root root  19616 Mar 18  2016 /usr/bin/agentxtrap
-rwxr-xr-x  1 root root     29 Jul 12  2016 /usr/bin/alias
-rwxr-xr-x  1 root root   2668 Jan 26  2014 /usr/bin/amuFormat.sh
lrwxrwxrwx. 1 root root      6 Sep  7  2015 /usr/bin/apropos -&gt; whatis
-rwxr-xr-x  1 root root  62576 Oct 13  2015 /usr/bin/ar
-rwxr-xr-x  1 root root  33048 Nov 25  2015 /usr/bin/arch
-rwxr-xr-x  1 root root 365208 Oct 13  2015 /usr/bin/as
-rwxr-xr-x. 1 root root  28800 Sep 16  2014 /usr/bin/aserver
-rwsr-xr-x  1 root root  52944 Jun 22  2015 /usr/bin/at
lrwxrwxrwx  1 root root      2 Apr 18  2016 /usr/bin/atq -&gt; at
lrwxrwxrwx  1 root root      2 Apr 18  2016 /usr/bin/atrm -&gt; at
-rwxr-xr-x  1 root root  11416 Jan 29  2014 /usr/bin/attr
-rwxr-xr-x. 1 root root  19872 Jan 14  2015 /usr/bin/aulast
-rwxr-xr-x. 1 root root  11544 Jan 14  2015 /usr/bin/aulastlog
-rwxr-xr-x. 1 root root  11360 Jan 14  2015 /usr/bin/ausyscall
-rwxr-xr-x. 1 root root  32672 Jan 14  2015 /usr/bin/auvirt
lrwxrwxrwx. 1 root root      4 Sep  7  2015 /usr/bin/awk -&gt; gawk
</code></pre>
<p>After restore:</p>
<pre><code> $ sudo ls -al /usr/bin/a*
-rwxr-xr-x 1 root root 107824 Jul  7  2015 /usr/bin/a2p
-rwxr-xr-x 1 root root   1661 Jul  2  2015 /usr/bin/abs2rel
-rwxr-xr-x 1 root root  29032 Oct 13  2015 /usr/bin/addr2line
-rwxr-xr-x 1 root root  66928 Jul  3  2014 /usr/bin/afio
-rwxr-xr-x 1 root root  19616 Mar 18  2016 /usr/bin/agentxtrap
-rwxr-xr-x 1 root root     29 Jul 12  2016 /usr/bin/alias
-rwxr-xr-x 1 root root   2668 Jan 26  2014 /usr/bin/amuFormat.sh
lrwxrwxrwx 1 root root      6 Sep  4  2015 /usr/bin/apropos -&gt; whatis
-rwxr-xr-x 1 root root  62576 Oct 13  2015 /usr/bin/ar
-rwxr-xr-x 1 root root  33048 Nov 25  2015 /usr/bin/arch
-rwxr-xr-x 1 root root 365208 Oct 13  2015 /usr/bin/as
-rwxr-xr-x 1 root root  28800 Sep 16  2014 /usr/bin/aserver
-rwsr-xr-x 1 root root  52944 Jun 22  2015 /usr/bin/at
lrwxrwxrwx 1 root root      2 Apr 18  2016 /usr/bin/atq -&gt; at
lrwxrwxrwx 1 root root      2 Apr 18  2016 /usr/bin/atrm -&gt; at
-rwxr-xr-x 1 root root  11416 Jan 29  2014 /usr/bin/attr
-rwxr-xr-x 1 root root  19872 Jan 14  2015 /usr/bin/aulast
-rwxr-xr-x 1 root root  11544 Jan 14  2015 /usr/bin/aulastlog
-rwxr-xr-x 1 root root  11360 Jan 14  2015 /usr/bin/ausyscall
-rwxr-xr-x 1 root root  32672 Jan 14  2015 /usr/bin/auvirt
lrwxrwxrwx 1 root root      4 Sep  4  2015 /usr/bin/awk -&gt; gawk
</code></pre>
<p>But rpm only complains about these files, which have 'capabilities'
changed.</p>
<pre><code> $ sudo rpm -Va
[snip]
........P    /usr/bin/ping
........P    /usr/bin/ping6
........P    /usr/sbin/arping
........P    /usr/sbin/clockdiff
[snip]
</code></pre>
<p>Versions:</p>
<pre><code> $ lsb_release -d
Description:    Red Hat Enterprise Linux Server release 7.2 (Maipo)
 $ rear -V
Relax-and-Recover 1.18 / Git
</code></pre>
<p>Rear config:</p>
<pre><code>OUTPUT=ISO
BACKUP_URL=nfs://xxx/rear
BACKUP=NETFS
</code></pre>
<p>A reinstall of the iputils package fixes the issue.<br />
Does anyone have an idea what went wrong during the restore?</p>
<p>Cheers</p>
<h4 id="jsmeix_commented_at_2017-01-26_1551"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-275424367">2017-01-26 15:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-26_1551" title="Permanent link">&para;</a></h4>
<p>@andral<br />
you need to run rear with debugging and<br />
then inspect the log file, cf.<br />
"Debugging issues with Relax-and-Recover" at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Excerpt from<br />
<a href="https://github.com/rear/rear/issues/1175#issuecomment-273737147">https://github.com/rear/rear/issues/1175#issuecomment-273737147</a></p>
<pre>
dd if=/tmp/rear.yRb6VE9IiDq3wUW/outputfs/skt-sswpbt04/2016-11-10-1736-F.tar.gz | cat | tar --block-number --totals --verbose --anchored --acls --xattrs --gzip -C /mnt/local/ -x -f -
tar: var/log/messages: Warning: Cannot acl_from_text
</pre>

<p>At first glance this looks more like an issue in tar<br />
and not like an issue in ReaR itself, cf.<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2017-01-26_1813"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-275465415">2017-01-26 18:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-26_1813" title="Permanent link">&para;</a></h4>
<p>Google finds only ancient issues at Red Hat about<br />
"tar Cannot acl_from_text" like<br />
<a href="https://rhn.redhat.com/errata/RHBA-2010-0224.html">https://rhn.redhat.com/errata/RHBA-2010-0224.html</a><br />
that reads (excerpt)</p>
<pre>
Last updated on: 2010-03-30
Affected Products: Red Hat Enterprise Linux (v. 5 server)
...
This updated tar package provides fixes for the following bugs:
...
extracting a tar archive that had been created
using the "--xattrs" flag, which saves extended
attribute information to the file, resulted in tar displaying
"Warning: Cannot acl_from_text: Invalid argument"
error messages for many extracted files. This was caused
by an off-by-one coding error, and has been fixed in this
update so that extended attributes are restored correctly
from archive files. (BZ#472553)
</pre>

<p>Regardless that this one is old and that the error message<br />
is a bit different, it indicates that the root cause is more<br />
likely in tar and not in ReaR.</p>
<h4 id="gdha_commented_at_2017-02-24_1457"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-282311384">2017-02-24 14:57</a>:<a class="headerlink" href="#gdha_commented_at_2017-02-24_1457" title="Permanent link">&para;</a></h4>
<p>@andral According your <code>rpm -Va</code> output some executables like <strong>ping</strong>
have a changed (or missing) <em>capabilities</em>? Can you confirm?<br />
The title of this topic is IMHO wrong - it is not <strong>ACL</strong>, but
<strong>capabilities</strong>.<br />
Capabilities are saved by <code>tar</code> with the <code>--xattrs</code> flag, which was set
in your rear configuration file. Therefore, it might be a bug in your
<code>tar</code> executable...</p>
<h4 id="gdha_commented_at_2017-02-24_1625"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-282334872">2017-02-24 16:25</a>:<a class="headerlink" href="#gdha_commented_at_2017-02-24_1625" title="Permanent link">&para;</a></h4>
<p>@andral @jsmeix @gozora @schlomo Nice story:</p>
<h3 id="test_1_on_rhel_72_with_--xattrs">Test 1 on RHEL 7.2 with <code>--xattrs</code><a class="headerlink" href="#test_1_on_rhel_72_with_--xattrs" title="Permanent link">&para;</a></h3>
<pre><code># tar --version
tar (GNU tar) 1.26
# rpm -qf $(which tar)
tar-1.26-29.el7.x86_64

# ls -l /bin/ping
-rwxr-xr-x. 1 root root 44896 Jun  5  2015 /bin/ping

# getcap /bin/ping
/bin/ping = cap_net_admin,cap_net_raw+p

# tar --xattrs -cpvf /tmp/ping.tar /bin/ping
# tar --xattrs -xpvf /tmp/ping.tar
# getcap bin/ping
# ls -l bin/ping
-rwxr-xr-x 1 root root 44896 Jun  5  2015 bin/ping
</code></pre>
<h3 id="test_2_with_--formatpax_according_httpswwwgnuorgsoftwaretarmanualhtml_nodeextended-file-attributeshtml">Test 2 with <code>--format=pax</code> (according <a href="https://www.gnu.org/software/tar/manual/html_node/Extended-File-Attributes.html">https://www.gnu.org/software/tar/manual/html_node/Extended-File-Attributes.html</a>)<a class="headerlink" href="#test_2_with_--formatpax_according_httpswwwgnuorgsoftwaretarmanualhtml_nodeextended-file-attributeshtml" title="Permanent link">&para;</a></h3>
<pre><code># tar --xattrs --format=pax -cpvf /tmp/ping.tar /bin/ping
# tar --xattrs --format=pax -xpvf /tmp/ping.tar
bin/ping
# getcap bin/ping
#
</code></pre>
<h3 id="test_3_with_--selinux">Test 3 with <code>--selinux</code><a class="headerlink" href="#test_3_with_--selinux" title="Permanent link">&para;</a></h3>
<pre><code># tar --xattrs --format=pax --selinux -cpvf /tmp/ping.tar /bin/ping
# tar --xattrs --format=pax --selinux -xpvf /tmp/ping.tar
# getcap bin/ping
#
</code></pre>
<p>=&gt;
<a href="https://rhn.redhat.com/errata/RHBA-2016-2681.html">https://rhn.redhat.com/errata/RHBA-2016-2681.html</a><br />
Previously, using the tar command with the --selinux option failed, as
the tar<br />
utility freed memory incorrectly. With this update, the memory is
freed<br />
correctly, and tar works as expected with the --selinux option.
(BZ#1365645)<br />
New version: tar-1.26-30.el7_2.x86_64.rpm</p>
<h3 id="test_4_with_--acls">Test 4 with <code>--acls</code>:<a class="headerlink" href="#test_4_with_--acls" title="Permanent link">&para;</a></h3>
<pre><code># tar --xattrs --format=pax --selinux --acls -cpvf /tmp/ping.tar /bin/ping
# tar --xattrs --format=pax --selinux --acls -xpvf /tmp/ping.tar
# getcap bin/ping
#
</code></pre>
<p>According
<a href="https://www.lesbonscomptes.com/pages/extattrs.html">https://www.lesbonscomptes.com/pages/extattrs.html</a>
<code>xattrs</code> are visible with:</p>
<pre><code># getfattr /bin/ping
# getfattr bin/ping
</code></pre>
<h3 id="test_5_with_star">Test 5 with <code>star</code>:<a class="headerlink" href="#test_5_with_star" title="Permanent link">&para;</a></h3>
<pre><code># star -artype=exustar -xattr-linux -c -f archive.star /bin/ping
star: 7 blocks + 0 bytes (total of 71680 bytes = 70.00k).
# star -artype=exustar -xattr-linux -x -f ./archive.star
#
</code></pre>
<p>Unfortunately, my knowledge of <code>star</code> is limited...</p>
<h2 id="conclusions">Conclusions<a class="headerlink" href="#conclusions" title="Permanent link">&para;</a></h2>
<p><strong>tar-1.26-29.el7.x86_64</strong> does not save the capabilities (extend
attributes) as describe in the man pages. This should be reported
upstream (or via RH).</p>
<p><strong>star</strong> hits the same bug, or I used the wrong options? To be
investigated by ??</p>
<h4 id="praiskup_commented_at_2017-03-01_1227"><img src="https://avatars.githubusercontent.com/u/3277839?v=4" width="50"><a href="https://github.com/praiskup">praiskup</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-283327310">2017-03-01 12:27</a>:<a class="headerlink" href="#praiskup_commented_at_2017-03-01_1227" title="Permanent link">&para;</a></h4>
<blockquote>
<p>tar-1.26-29.el7.x86_64 does not save the capabilities</p>
</blockquote>
<p>When you do 'tar -c --xattrs', capabilities (== extended attributes in
security.capability namespace) is stored in archive, but it is not
automatically restored with --xattrs (only 'user.*' namespace is
restored). Have a look ate '--xattrs-include' option for more info. But
note that security.capability namespace is stored in pax archive in
<em>binary</em> form (more info in rhbz 771927)</p>
<h4 id="gdha_commented_at_2017-03-01_1228"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-283327355">2017-03-01 12:28</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-01_1228" title="Permanent link">&para;</a></h4>
<p>@andral I can only suggest to open a bugzilla with redhat to tackle the
<code>tar</code> issue</p>
<h4 id="gdha_commented_at_2017-03-01_1247"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-283330961">2017-03-01 12:47</a>:<a class="headerlink" href="#gdha_commented_at_2017-03-01_1247" title="Permanent link">&para;</a></h4>
<p>@praiskup Thank you for your valuable comment and the interesting link
to the tar rhbz 771927.</p>
<p>According
<a href="http://git.savannah.gnu.org/cgit/tar.git/plain/NEWS?id=release_1_27">http://git.savannah.gnu.org/cgit/tar.git/plain/NEWS?id=release_1_27</a>
:</p>
<ul>
<li>Support for POSIX ACLs, extended attributes and SELinux context.</li>
</ul>
<p>Starting with this version tar is able to store, extract and list<br />
extended file attributes, POSIX.1e ACLs and SELinux context. This is<br />
controlled by the command line options --xattrs, --acls and --selinux,<br />
correspondingly. Each of these options has a `--no-' counterpart<br />
(e.g. --no-xattrs), which disables the corresponding feature.<br />
Additionally, the options --xattrs-include and --xattrs-exclude allow<br />
you to selectively control for which files to store (or extract) the<br />
extended attributes.<br />
==&gt; however, I think rh added this also in the tar rpm, no?</p>
<p>However, no trace yet of adding capabilities (as in rh patch
<a href="https://bugzilla.redhat.com/attachment.cgi?id=849830">https://bugzilla.redhat.com/attachment.cgi?id=849830</a>)</p>
<h4 id="praiskup_commented_at_2017-03-01_1255"><img src="https://avatars.githubusercontent.com/u/3277839?v=4" width="50"><a href="https://github.com/praiskup">praiskup</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-283332551">2017-03-01 12:55</a>:<a class="headerlink" href="#praiskup_commented_at_2017-03-01_1255" title="Permanent link">&para;</a></h4>
<blockquote>
<p>however, I think rh added this also in the tar rpm, no?</p>
</blockquote>
<p>I believe --xattrs-include is in RHEL 7 already.</p>
<blockquote>
<p>However, no trace yet of adding capabilities</p>
</blockquote>
<p>That's to be discussed upstream.</p>
<h4 id="eblazquez_commented_at_2017-07-12_1114"><img src="https://avatars.githubusercontent.com/u/11347436?u=bf623f586d807d4e7cc53ea4b1577e14183b12e1&v=4" width="50"><a href="https://github.com/eblazquez">eblazquez</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-314738721">2017-07-12 11:14</a>:<a class="headerlink" href="#eblazquez_commented_at_2017-07-12_1114" title="Permanent link">&para;</a></h4>
<p>Hi, it seems that the capabilities, same as with the SELinux and ACLs
extended attributes, are not included on the xattrs filters used by tar.
We've solved this issue using the following BACKUP_PROG_OPTIONS:</p>
<pre>
BACKUP_PROG_OPTIONS="--anchored --xattrs --xattrs-include='*.*'"
</pre>

<p>This way you're modifying the xattrs filter of tar, and telling it to
store every extended attribute, including ACLs, SELinux context and
capabilities.</p>
<p>This seems to be a similar behaviour than when you execute</p>
<pre>
getfattr -d &lt;file&gt;
</pre>

<p>because with that command you don't get neither ACLs nor SELinux
contexts, but if you change the filter to match everything with</p>
<pre>
getfattr -d -m '.*' &lt;file&gt;
</pre>

<p>you see all this information.</p>
<h4 id="jsmeix_commented_at_2017-07-13_0807"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-315004132">2017-07-13 08:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-07-13_0807" title="Permanent link">&para;</a></h4>
<p>@Eblazquez<br />
many thanks for your analysis.<br />
It helps a lot to better understand the issue!</p>
<p>In ReaR we already use --anchored by default,<br />
see usr/share/rear/conf/default.conf that contains</p>
<pre>
BACKUP_PROG_OPTIONS="--anchored"
</pre>

<p>Accordingly only additionally the options</p>
<pre>
--xattrs --xattrs-include='*.*'
</pre>

<p>are needed to get full xattrs support via 'tar' backup<br />
(if I understand it correctly)<br />
e.g in etc/rear/local.conf via something like</p>
<pre>
BACKUP_PROG_OPTIONS="$BACKUP_PROG_OPTIONS --xattrs-include='*.*' --xattrs"
</pre>

<p>FYI:</p>
<p>We cannot just have in default.conf</p>
<pre>
BACKUP_PROG_OPTIONS="--anchored --xattrs --xattrs-include='*.*'"
</pre>

<p>because it seems older tar versions do not support<br />
the --xattrs and --xattrs-include options because<br />
at least on my SLES11 system with GNU tar 1.26<br />
"man tar" shows nothing about xattrs or xattrs-include<br />
but on my openSUSE Leap 42.1 system with GNU tar 1.27<br />
"man tar" shows both xattrs and xattrs-include.</p>
<p>Therefore some magic would be needed to let ReaR<br />
use the --xattrs and --xattrs-include options automatically<br />
if the tar program that is currently installed on the system<br />
where ReaR runs provides --xattrs and --xattrs-include.</p>
<p>But I still think any special backup stuff<br />
does not really belong to ReaR itself, cf.<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I think BACKUP_PROG_OPTIONS could be<br />
in general better described in ReaR.</p>
<p>But I think the ReaR documentation is the wrong place<br />
how to use special 'tar' options because ReaR is not<br />
meant to document how to use 'tar'.</p>
<h4 id="schlomo_commented_at_2017-07-13_1015"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-315036281">2017-07-13 10:15</a>:<a class="headerlink" href="#schlomo_commented_at_2017-07-13_1015" title="Permanent link">&para;</a></h4>
<p>IMHO we should do our best to support standard setups. As many distros
now enable xattr and acl by default we should make an effort to support
that as well.</p>
<p>To support older and newer tar versions I suggest dynamically check for
the capabilities of tar and to add more options based on that. The code
for syslinux is already doing something similar.</p>
<h4 id="jsmeix_commented_at_2017-07-14_1038"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-315329161">2017-07-14 10:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-07-14_1038" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I agree - but such things are enhancements for the future:<br />
<a href="https://github.com/rear/rear/issues/1411">https://github.com/rear/rear/issues/1411</a></p>
<h4 id="eblazquez_commented_at_2017-07-19_1222"><img src="https://avatars.githubusercontent.com/u/11347436?u=bf623f586d807d4e7cc53ea4b1577e14183b12e1&v=4" width="50"><a href="https://github.com/eblazquez">eblazquez</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-316368544">2017-07-19 12:22</a>:<a class="headerlink" href="#eblazquez_commented_at_2017-07-19_1222" title="Permanent link">&para;</a></h4>
<p>Hi, I've seen that on the script located on
/usr/share/rear/restore/NETFS/default/40_restore_backup.sh, the first
action taken if the backup program is tar, is to include the --selinux
flag in case it's supported:</p>
<pre>
case "$BACKUP_PROG" in
    # tar compatible programs here
    (tar)
        # Add the --selinux option to be safe with SELinux context restoration
        if [[ ! $BACKUP_SELINUX_DISABLE =~ ^[yY1] ]]; then
            if tar --usage | grep -q selinux;  then
                BACKUP_PROG_OPTIONS="$BACKUP_PROG_OPTIONS --selinux"
            fi
        fi
</pre>

<p>Maybe the option to store/restore the xattrs can be included on the
scripts on a similar way.</p>
<p>Another issue that I've encountered is that the option
--xattrs-include='*.*' works creating the backup, but for some reason
is ignored on the restore (it has to do with the * symbols), at least
on RHEL7 which is the OS we are using. If you want this to work with
capabilities you should include the specific attribute:</p>
<pre>
BACKUP_PROG_OPTIONS="--anchored --xattrs --xattrs-include=security.capability"
</pre>

<p>On our case we used that options since we don't use SELinux, but if you
do you should also include its xattr, since if you add a xattrs-include
mask it ignores the rest, even if you use the --selinux option. Therefor
if you use SELinux your options should look like this:</p>
<pre>
BACKUP_PROG_OPTIONS="--anchored --xattrs --xattrs-include=security.capability --xattrs-include=security.selinux"
</pre>

<p>Since this issue causes ping not to work on RHEL7 systems, I think it's
important enough to at least include this information on the
documentation.</p>
<h4 id="gdha_commented_at_2018-02-23_1727"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-368079120">2018-02-23 17:27</a>:<a class="headerlink" href="#gdha_commented_at_2018-02-23_1727" title="Permanent link">&para;</a></h4>
<p>I believe issue is fixed in the meantime:
<a href="https://gist.github.com/fce4dabba6719a3f615cb8dc02a4c913">https://gist.github.com/fce4dabba6719a3f615cb8dc02a4c913</a></p>
<h4 id="jsmeix_commented_at_2018-02-27_0937"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1175#issuecomment-368808825">2018-02-27 09:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-02-27_0937" title="Permanent link">&para;</a></h4>
<p>I close the issue because it is considered to be fixed.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2026 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-01-19.1175.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
