<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2519 Issue closed: Misleading warnings about keyboard mappings (LogPrintError) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2519 Issue closed: Misleading warnings about keyboard mappings (LogPrintError)";
        var mkdocs_page_input_path = "issues/2020-11-16.2519.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2519 Issue closed: Misleading warnings about keyboard mappings (LogPrintError)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2519_issue_closed_misleading_warnings_about_keyboard_mappings_logprinterror"><a href="https://github.com/rear/rear/issues/2519">#2519 Issue</a> <code>closed</code>: Misleading warnings about keyboard mappings (LogPrintError)<a class="headerlink" href="#2519_issue_closed_misleading_warnings_about_keyboard_mappings_logprinterror" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="olivero2_opened_issue_at_2020-11-16_1800"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> opened issue at <a href="https://github.com/rear/rear/issues/2519">2020-11-16 18:00</a>:<a class="headerlink" href="#olivero2_opened_issue_at_2020-11-16_1800" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): 2.6 / Git</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
<p>Each <code>rear mkrescue</code> invocation (<code>mkopalpba</code> as well) prints:</p>
<pre><code>Cannot include default keyboard mapping (no KEYMAPS_DEFAULT_DIRECTORY specified)
Cannot include keyboard mappings (neither KEYMAPS_DEFAULT_DIRECTORY nor KEYMAPS_DIRECTORIES specified)
</code></pre>
<p>This is misleading: Users may get the impression that something is
wrong and the rescue system's keyboard will not operate correctly.
However, everything is just fine, probably because
<code>dumpkeys</code>/<code>loadkeys</code> is sufficient.</p>
<p>I'd suggest to delete these messages (or at least restrict them to
the log file and not show them to the user).</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2020-11-17_0719"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-728738157">2020-11-17 07:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-17_0719" title="Permanent link">&para;</a></h4>
<p>The reason for the code in
rescue/GNU/Linux/500_clone_keyboard_mappings.sh<br />
had been various really bad user experience when the keyboard in the
recovery system<br />
does not work as intended, cf.<br />
<a href="https://github.com/rear/rear/pull/1781">https://github.com/rear/rear/pull/1781</a></p>
<p>Those messages are intentionally no warnings.<br />
In particular there is no word "warning", cf.<br />
<a href="https://schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">https://schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a></p>
<p>The messages are intentional plain info messages<br />
because only dumpkeys/loadkeys is often not sufficient,<br />
in particular not when you run the recovery system on another<br />
machine where another keyboard mapping is needed, cf.<br />
<a href="https://github.com/rear/rear/pull/1781#issuecomment-384232695">https://github.com/rear/rear/pull/1781#issuecomment-384232695</a></p>
<p>When then the recovery system does not contain the needed<br />
keyboard mapping for your particular case you are out of the game<br />
in practice - in particular in case of a real disaster recovery when<br />
there is time pressure and then things do not just work and you need
to<br />
type a lot in the recovery system to do some workarounds or adaptions<br />
(not so much fun when editing e.g. disklayout.conf or some ReaR
scripts<br />
but your keyboard mapping is wrong) - I know it because I was hit by it.</p>
<p>I do not get any of those LogPrintError messages on my systems<br />
(with neither KEYMAPS_DEFAULT_DIRECTORY nor KEYMAPS_DIRECTORIES
specified).</p>
<p>The code in rescue/GNU/Linux/500_clone_keyboard_mappings.sh<br />
shows what keymaps should be by default copied into the recovery
system<br />
and if those default keymaps are not found the code tries to use<br />
KEYMAPS_DEFAULT_DIRECTORY and KEYMAPS_DIRECTORIES<br />
and if that also do not result something to copy it shows those
messages<br />
in any case to the user to tell him he may better have a closer look at
his<br />
keymap things.</p>
<p>I assume the code in
rescue/GNU/Linux/500_clone_keyboard_mappings.sh<br />
may need to be enhanced so that the intent behind<br />
<a href="https://github.com/rear/rear/pull/1781">https://github.com/rear/rear/pull/1781</a><br />
also works on your systems when neither KEYMAPS_DEFAULT_DIRECTORY<br />
nor KEYMAPS_DIRECTORIES is specified?</p>
<h4 id="olivero2_commented_at_2020-11-17_2258"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-729264699">2020-11-17 22:58</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-17_2258" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thanks for the detailed explanation.</p>
<p>It is true that using a different keyboard during recovery can be
annoying. It is also true that recovery should always be fully tested
before use. So many things can go wrong otherwise.</p>
<p>As it seems, Debian-based systems (including Ubuntu) no longer contain
any <code>keymaps</code> directory as part of the base system. Optionally
installing one (under <code>/usr/share/keymaps</code>) is possible via the
<code>console-data</code> package.</p>
<p>ReaR already does the best it can: It tries all known <code>keymaps</code>
directories and makes these available on the recovery system. If these
files don't exist, there is simply no support for alternative keyboards
installed.</p>
<p>What could we do in that case?</p>
<ul>
<li>We do not know whether different keyboard layouts might be an issue.</li>
<li>We do not know what is available.</li>
<li>We do not know how to install the required files (they might be
    packaged differently on different distributions).</li>
</ul>
<p>The current messages sound alarming, yet do not provide any real help in
this case. Just setting the <code>KEYMAPS_*</code> variables would not be
sufficient. So my ideas are:</p>
<ul>
<li>Drop the two messages above.</li>
<li>Then either<ul>
<li>do not issue any message as ReaR has already done the best it
    can, or</li>
<li>add a generic recommendation instead:
        TIP: To support different keyboard layouts, see 'KEYMAPS_DEFAULT_DIRECTORY' in `default.conf'.</li>
</ul>
</li>
</ul>
<h4 id="jsmeix_commented_at_2020-11-18_0736"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-729495425">2020-11-18 07:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-18_0736" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for your reply - very helpful - as always!</p>
<p>I don't like to drop the message because I made the code<br />
with its messages intentionally to have the user at least informed.</p>
<p>I see now that because of the wording <code>cannot</code><br />
the message can be misunderstood as if something went actually wrong.<br />
But it is only meant as user information message that is important<br />
(so I like to show the message in any case on the user's terminal)<br />
but its meaning is not that things went actually wrong.<br />
In the end the wording <code>cannot</code> can trigger same reactions as <code>warning</code>
does<br />
and I agree with @schlomo that <code>warning</code> messages should be avoided,<br />
cf.
<a href="https://github.com/rear/rear/issues/564">https://github.com/rear/rear/issues/564</a>
starting at<br />
<a href="https://github.com/rear/rear/issues/564#issuecomment-86188528">https://github.com/rear/rear/issues/564#issuecomment-86188528</a><br />
and the subsequent comments up to<br />
<a href="https://github.com/rear/rear/issues/564#issuecomment-86462584">https://github.com/rear/rear/issues/564#issuecomment-86462584</a></p>
<p>So I will change the wording to be more neutral.</p>
<h4 id="jsmeix_commented_at_2020-11-18_0832"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-729522558">2020-11-18 08:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-18_0832" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
please have a look at
<a href="https://github.com/rear/rear/pull/2520">https://github.com/rear/rear/pull/2520</a></p>
<h4 id="jsmeix_commented_at_2020-11-19_1104"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730297820">2020-11-19 11:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-19_1104" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2520">https://github.com/rear/rear/pull/2520</a>
merged<br />
this issue should be fixed.</p>
<h4 id="jsmeix_commented_at_2020-11-19_1108"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730299857">2020-11-19 11:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-19_1108" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
again thank you for you further helpful explanations, in particular<br />
<a href="https://github.com/rear/rear/pull/2520#issuecomment-729681053">https://github.com/rear/rear/pull/2520#issuecomment-729681053</a><br />
that helped me to finally see and understand the actual reason behind<br />
why the changes in
<a href="https://github.com/rear/rear/pull/2520">https://github.com/rear/rear/pull/2520</a>
are needed<br />
because it seems newer Debian-based systems (including Ubuntu)<br />
no longer contain any keymaps directory as part of the base system<br />
so those distros no longer provide console-multi-keyboard support by
default.<br />
In such cases ReaR aligns with what there is without being needlessly
verbose, cf.<br />
<a href="https://github.com/rear/rear/pull/2520/commits/5559b6edbba5e02f62122fc731f87281c4430e87">https://github.com/rear/rear/pull/2520/commits/5559b6edbba5e02f62122fc731f87281c4430e87</a></p>
<h4 id="olivero2_commented_at_2020-11-19_1307"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730363161">2020-11-19 13:07</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-19_1307" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thank you for taking care of this!</p>
<p>I have updated my local repository and ran tests with <code>mkrescue</code> and
<code>mkopalpba</code>. If ReaR is owned by <code>root</code>, it runs cleanly on Ubuntu
except for this one:</p>
<pre><code>Symlink '/lib/modules/5.4.0-54-generic/build' -&gt; '/usr/src/linux-headers-5.4.0-54-generic' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/src/linux-headers-5.4.0-54-generic' via the 'COPY_AS_IS' configuration variable.
</code></pre>
<p>I had looked at the code copying the <code>build</code> symlink, and I do think
getting rid of this is a bit tricky and in the end probably not worth
the effort.</p>
<p>When running it from my repo directory with files owned by me I get the
usual <code>Skipped ldd test</code> messages:</p>
<pre><code>Skipped ldd test for '/bin/rear' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/bin/dhcpcd.sh' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/bin/ifup' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/bin/login' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/bin/dhclient-script' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/do-shutdown' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/run-serial' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/run-syslog' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/system-status.sh' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/boot' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/run-sshd' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/system-setup' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/etc/scripts/unlock-opal-disks' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
</code></pre>
<p>I managed to drop these by excluding ReaR from the symlink test:<br />
<a href="https://github.com/rear/rear/blob/185d32a4de5acb222fa9567dd5d6d68ee8f00bf0/usr/share/rear/build/default/990_verify_rootfs.sh#L110">https://github.com/rear/rear/blob/185d32a4de5acb222fa9567dd5d6d68ee8f00bf0/usr/share/rear/build/default/990_verify_rootfs.sh#L110</a></p>
<p>Changing this to</p>
<pre><code>    egrep -q "/lib/modules/|/lib.*/firmware/|$SHARE_DIR|$SCRIPT_FILE" &lt;&lt;&lt;"$binary" &amp;&amp; continue
</code></pre>
<p>made the above messages go away, but I did not dare to create a PR
messing with your code ;-).</p>
<h4 id="olivero2_commented_at_2020-11-19_1423"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730408239">2020-11-19 14:23</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-19_1423" title="Permanent link">&para;</a></h4>
<p>I did not look closely enough. The line<br />
<a href="https://github.com/rear/rear/blob/185d32a4de5acb222fa9567dd5d6d68ee8f00bf0/usr/share/rear/build/default/990_verify_rootfs.sh#L110">https://github.com/rear/rear/blob/185d32a4de5acb222fa9567dd5d6d68ee8f00bf0/usr/share/rear/build/default/990_verify_rootfs.sh#L110</a></p>
<p>Needs to change to</p>
<pre><code>    egrep -q "/lib/modules/|/lib.*/firmware/|$SHARE_DIR|/bin/rear$" &lt;&lt;&lt;"$binary" &amp;&amp; continue
</code></pre>
<p>to make the "Skipped ldd test" messages go away. The <code>rear</code> script seems
to always end up in <code>/bin</code>.</p>
<h4 id="jsmeix_commented_at_2020-11-19_1437"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730417033">2020-11-19 14:37</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-19_1437" title="Permanent link">&para;</a></h4>
<p>I will have a closer look tomorrow.</p>
<p>To use ReaR from a git clone<br />
I do <code>git clone https://github.com/rear/rear.git</code> always as root<br />
because I will run it only as root anyway.</p>
<p>Programs in the recovery system get all copied into <code>/bin/</code>, for example</p>
<pre><code># type -a parted
parted is /usr/sbin/parted

# find  /tmp/rear.ey5jCWA5XmCRvY5/rootfs/ -type f | grep parted
/tmp/rear.ey5jCWA5XmCRvY5/rootfs/bin/parted
</code></pre>
<h4 id="jsmeix_commented_at_2020-11-19_1445"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730422092">2020-11-19 14:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-19_1445" title="Permanent link">&para;</a></h4>
<p>Did you add 'oliver' to TRUSTED_FILE_OWNERS?<br />
I.e. in your local.conf via</p>
<pre><code>TRUSTED_FILE_OWNERS+=( 'oliver' )
</code></pre>
<p>I mean if you did not add 'oliver' to TRUSTED_FILE_OWNERS<br />
then the message is right - or do I misunderstand something?</p>
<h4 id="olivero2_commented_at_2020-11-19_1449"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-730425079">2020-11-19 14:49</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-19_1449" title="Permanent link">&para;</a></h4>
<p>No, I did not add anything to <code>TRUSTED_FILE_OWNERS</code>. Technically, the
message is not completely wrong. It just makes no sense to scan shell
scripts via <code>ldd</code> and ReaR cannot contain compiled code. So if a user
downloads ReaR into a user directory (with user-owned files) and uses
<code>sudo</code> only when necessary, these messages can be avoided. Better
experience -&gt; happier user.</p>
<h4 id="jsmeix_commented_at_2020-11-20_1238"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731146610">2020-11-20 12:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1238" title="Permanent link">&para;</a></h4>
<p>From my point of view that would go too far beyond what I think<br />
that should be implemented in ReaR to happen automatically.</p>
<p>If a user downloads ReaR into a user directory for the first time he
gets that</p>
<pre><code>Skipped ldd test for '...' (owner '...' not in TRUSTED_FILE_OWNERS)
</code></pre>
<p>messages (the comment in build/default/990_verify_rootfs.sh explains<br />
why those messages appear on his terminal in any case to have him
informed)<br />
and then he knows what he could do to get rid of those messages.</p>
<p>What I could think about is to add one more user config variable like</p>
<pre><code>SKIP_LDD_TEST="/lib/modules/|/lib.*/firmware/"
</code></pre>
<p>to default.conf so that users can specify the 'egrep' pattern<br />
as they need it for what is currently a hardcoded value in</p>
<pre><code>egrep -q '/lib/modules/|/lib.*/firmware/' &lt;&lt;&lt;"$binary" &amp;&amp; continue
</code></pre>
<p>in build/default/990_verify_rootfs.sh<br />
because in general I am against hardcoded values in ReaR.</p>
<p>But in your particular use case I think</p>
<pre><code>TRUSTED_FILE_OWNERS+=( 'oliver' )
</code></pre>
<p>is the cleaner way to tell ReaR what is special in your particular case.</p>
<p>In general:</p>
<p>ReaR never was and for the foreseeable future<br />
it will neither intend to be nor become some kind of</p>
<pre><code>fully-automated-make-everyone-happy-out-of-the-box
</code></pre>
<p>tool.</p>
<p>ReaR always was and for the foreseeable future will stay to be a tool<br />
that is made to a major extent by its users which are mainly system
admins<br />
so ReaR primarily works as they need it for their (business)
environments.</p>
<p>In particular as SUSE employee I cannot spend too much of my<br />
worktime that is paid exclusively by SUSE Linux Enterprise customers<br />
on issues that are not primarily needed by SUSE Linux Enterprise
customers.<br />
And outside of my worktime I have two kids :-)</p>
<p>Of course things would change as soon as a SUSE Linux Enterprise
customer<br />
pays SUSE sufficiently to implement something what he specifically needs
;-)</p>
<h4 id="olivero2_commented_at_2020-11-20_1332"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731171906">2020-11-20 13:32</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1332" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
I use the user-owned repository for testing and development. There I
always try not to change the configuration at all, as I want to test
things close to production use. I also use safe practices on my
development system. The principle of least privilege requires gaining
root privileges only if absolutely necessary. My IDE (IntelliJ IDEA)
never runs with root privileges.</p>
<p>I just wonder why there should be something configurable when ReaR
already knows what is right: Scanning its own shell scripts with <code>ldd</code>
makes no sense. ReaR knows exactly where they are so "hardcoding" its
own paths is just the right way to do it. Limiting <code>ldd</code> to the minimum
set of reasonable files is safer anyway: Maybe one time <code>ldd</code> will trip
over such a shell script and crash on SLES...</p>
<p>I was just trying to pick this up for future users which might try a
fresh ReaR version from the repository and would enjoy it more if it
would not be unnecessarily verbose.</p>
<p>In the end, of course, it's your decision.</p>
<h4 id="olivero2_commented_at_2020-11-20_1343"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731177838">2020-11-20 13:43</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1343" title="Permanent link">&para;</a></h4>
<p>Just for reference – things have happened in the past: Cf. #2177,
#2179</p>
<h4 id="jsmeix_commented_at_2020-11-20_1413"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731193912">2020-11-20 14:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1413" title="Permanent link">&para;</a></h4>
<p>Could you do a pull request or just a <code>diff -u</code> posted here<br />
so I could have a look what you think how you could make<br />
ReaR do the right thing in an automated way in this case?</p>
<p>It seems that is easy for you - probably I just don't see it.<br />
If a simple enhancement makes things work well I am all for it.</p>
<p>I only don't want more and more complicated 'if then else' constructs<br />
for more and more special case handling in the ReaR code because<br />
all that has to be maintained for a long long time in the future.</p>
<p>I was hit too many times by "just one more nice to have thingy" here<br />
and "yet another nice to have thingy" there in the ReaR code<br />
that are used by ReaR users (in particular SUSE customers)<br />
a long time after the one who implemented it had gone and<br />
then I get bug reports about weird exotic use cases in ReaR<br />
where I am each time shocked what the heck that stuff is at all.<br />
But since it exists in ReaR it is me who has to fix that obscure stuff.</p>
<h4 id="olivero2_commented_at_2020-11-20_1418"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731196820">2020-11-20 14:18</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1418" title="Permanent link">&para;</a></h4>
<p>Sure, this is what I had tested to prevent <code>ldd</code> excursions into the
<code>rear</code> main script and into ReaR's shared script directory:</p>
<pre><code>Index: usr/share/rear/build/default/990_verify_rootfs.sh
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
--- usr/share/rear/build/default/990_verify_rootfs.sh   (revision 2376a6c1b89a1a0ddf5f5bd2f40d100e2aeb902d)
+++ usr/share/rear/build/default/990_verify_rootfs.sh   (date 1605795600021)
@@ -106,8 +106,8 @@
     # cf. https://github.com/rear/rear/issues/2177 which also shows that sometimes kernel modules could be
     # not only in the usual directory /lib/modules/ but also e.g. in /usr/lib/modules/
     # so we 'grep' for '/lib/modules/' anywhere in the full path of the binary.
-    # Also skip the ldd test for firmware files where it also does not make sense:
-    egrep -q '/lib/modules/|/lib.*/firmware/' &lt;&lt;&lt;"$binary" &amp;&amp; continue
+    # Also skip the ldd test for firmware and ReaR files where it also does not make sense:
+    egrep -q "/lib/modules/|/lib.*/firmware/|$SHARE_DIR|/bin/rear$" &lt;&lt;&lt;"$binary" &amp;&amp; continue
     # Skip the ldd test for files that are not owned by a trusted user to mitigate possible ldd security issues
     # because some versions of ldd may directly execute the file (see "man ldd") as user 'root' here
     # cf. the RequiredSharedObjects code in usr/share/rear/lib/linux-functions.sh
</code></pre>
<h4 id="olivero2_commented_at_2020-11-20_1420"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731197596">2020-11-20 14:20</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1420" title="Permanent link">&para;</a></h4>
<p>If that patch format does not work sufficiently for you, I could also
create a PR.</p>
<h4 id="jsmeix_commented_at_2020-11-20_1422"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731198704">2020-11-20 14:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1422" title="Permanent link">&para;</a></h4>
<p>Regarding
<a href="https://github.com/rear/rear/issues/2519#issuecomment-731177838">https://github.com/rear/rear/issues/2519#issuecomment-731177838</a><br />
Do you really like to say when a program that is called by ReaR
segfaults<br />
it is a bug in ReaR that it had called the program?<br />
Of course I avoided that ldd segfault in ReaR once I knew it<br />
but running ldd on arbitrary executable files had never segfaulted
before<br />
so why should I have implemented sophisticated tests in ReaR<br />
to filter out executables that are usually not meant to be run with
ldd<br />
when ldd itself had worked so well to skip what is not meant for it?</p>
<h4 id="olivero2_commented_at_2020-11-20_1432"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731204490">2020-11-20 14:32</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1432" title="Permanent link">&para;</a></h4>
<p>I absolutely agree that <code>ldd</code> should never segfault in the first place.
It should always check magic numbers and other stuff even before going
into details of a file.</p>
<p>On the other hand, we all build our code on the shoulders of giants (the
vast existing code base out there). An in the end, whenever we use
stuff, we are responsible as aggregators (just as a car maker takes
responsibility for the car's components). We can try to make upstream
fix things, but in the end, if our product fails because it uses
defective components created by others, we have to find a way. Even the
Linux kernel frequently includes fixes for broken hardware.</p>
<h4 id="jsmeix_commented_at_2020-11-20_1435"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731205929">2020-11-20 14:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1435" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for the <code>diff</code>.<br />
That helped me a lot to understand what you actually mean.</p>
<p>Done via<br />
<a href="https://github.com/rear/rear/commit/3e31b01fc074c9e81cb479cfbe146ef24132e7ef">https://github.com/rear/rear/commit/3e31b01fc074c9e81cb479cfbe146ef24132e7ef</a></p>
<p>I had thought it is about something much more complicated.<br />
I.e. some generic filtering method for what 'ldd' gets<br />
to avoid e.g. any bash scripts and things like that.</p>
<h4 id="jsmeix_commented_at_2020-11-20_1438"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731207964">2020-11-20 14:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1438" title="Permanent link">&para;</a></h4>
<p>Of couse I totally agree that if needed ReaR must work around issues,<br />
cf. "Dirty hacks welcome" in
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>The reason behind is that ReaR is meant to work for what system admins
need<br />
cf. my above
<a href="https://github.com/rear/rear/issues/2519#issuecomment-731146610">https://github.com/rear/rear/issues/2519#issuecomment-731146610</a></p>
<h4 id="olivero2_commented_at_2020-11-20_1450"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731214279">2020-11-20 14:50</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1450" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>I had thought it is about something much more complicated.<br />
I.e. some generic filtering method for what 'ldd' gets<br />
to avoid e.g. any bash scripts and things like that.</p>
</blockquote>
<p>Oh no, beware!</p>
<p>Actually, I had posted the source line and suggested change in
<a href="https://github.com/rear/rear/issues/2519#issuecomment-730363161">https://github.com/rear/rear/issues/2519#issuecomment-730363161</a>,
but unfortunately, GitHub does not seem to offer a real diff display in
issues. I have tried to find one, but did not succeed.</p>
<p>And I also agree, one must weigh carefully what to include in a product.
That's why I found this Ubuntu message not worth putting extra effort
into it:</p>
<pre><code>Symlink '/lib/modules/5.4.0-54-generic/build' -&gt; '/usr/src/linux-headers-5.4.0-54-generic' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/src/linux-headers-5.4.0-54-generic' via the 'COPY_AS_IS' configuration variable.
</code></pre>
<p>So we're actually pretty much on the same page here it seems. Thanks for
picking this up and have a very relaxed weekend!</p>
<h4 id="jsmeix_commented_at_2020-11-20_1452"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731215294">2020-11-20 14:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1452" title="Permanent link">&para;</a></h4>
<p>Thank you too for again helping me to understand things.<br />
I also wish you a relaxed and recovering weekend!</p>
<h4 id="jsmeix_commented_at_2020-11-20_1614"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731261796">2020-11-20 16:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1614" title="Permanent link">&para;</a></h4>
<p>Meanwhile I even understand what I did not understand:</p>
<p>I had focussed too much on the messages</p>
<pre><code>When running it from my repo directory with files owned by me
...
Skipped ldd test for '/bin/rear' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
Skipped ldd test for '/home/oliver/Repositories/open-source/rear/usr/share/rear/skel/default/bin/dhcpcd.sh' (owner 'oliver' not in TRUSTED_FILE_OWNERS)
...
</code></pre>
<p>in
<a href="https://github.com/rear/rear/issues/2519#issuecomment-730363161">https://github.com/rear/rear/issues/2519#issuecomment-730363161</a><br />
so I assumed you are asking for additional special case handling code in
ReaR<br />
when you run it from your repo directory with files owned by your normal
user<br />
regardless that <code>TRUSTED_FILE_OWNERS+=( 'oliver' )</code> would have solved
it.</p>
<p>What I didn't see was that the generically right thing to exclude ReaR's
files from the ldd test<br />
would also - as a positive side effect - make things work right for the
special case<br />
when running it from a repo directory with files owned by a non-root
user.</p>
<p>The <code>diff</code> showed me all what is needed is a "generically right thing"<br />
so I am really happy now because doing things generically right also
leads<br />
to the right behaviour in special cases (at least for this special case
here).</p>
<h4 id="olivero2_commented_at_2020-11-20_1637"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731273990">2020-11-20 16:37</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1637" title="Permanent link">&para;</a></h4>
<p>Ah, I see. Yes, the code actually examines files below <code>$ROOTFS_DIR</code> but
reports paths as they are on the original system. This makes sense for
the user but can irritate when checking the code.</p>
<p>I have updated my repository and have tested the final change. Works as
expected. I found that in addition to the new code, there is still one
old line present which should be deleted:<br />
<a href="https://github.com/rear/rear/blob/3e31b01fc074c9e81cb479cfbe146ef24132e7ef/usr/share/rear/build/default/990_verify_rootfs.sh#L114">https://github.com/rear/rear/blob/3e31b01fc074c9e81cb479cfbe146ef24132e7ef/usr/share/rear/build/default/990_verify_rootfs.sh#L114</a></p>
<p>Interesting side note: Now that there are fewer messages in total (just
those about Ubuntu's kernel build source symlink), suddenly this one
caught my attention during testing of <code>rear mkrescue</code>:</p>
<pre><code>Ignoring non-existing btrfs subvolume listed as mounted: /home
</code></pre>
<p>It also occurred with an older rear version. This message is important
as the recovery system will not work as expected.</p>
<p>After some more testing, the message just went away without me actually
changing anything. So maybe sometimes Btrfs fails to report things as we
expect them (maybe due to ongoing snapshot activity, but I do not know).
For now, I just repeated <code>rear mkrescue</code> and all was fine.</p>
<p>Now that ReaR is pretty silent in normal operations, I am convinced that
situations like this would not go unnoticed.</p>
<h4 id="jsmeix_commented_at_2020-11-20_1652"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731281789">2020-11-20 16:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-11-20_1652" title="Permanent link">&para;</a></h4>
<p>Thank you for your careful review (seems I was already in weekend mode
;-)<br />
Fixed via<br />
<a href="https://github.com/rear/rear/commit/d220fa301d0b1dd9c7dba6460cdc045a8d0a1a61">https://github.com/rear/rear/commit/d220fa301d0b1dd9c7dba6460cdc045a8d0a1a61</a></p>
<p>Possible btrfs race condition issues investigations at the earliest next
Monday ;-)</p>
<p>Now is really weekend!</p>
<h4 id="olivero2_commented_at_2020-11-20_1654"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2519#issuecomment-731283238">2020-11-20 16:54</a>:<a class="headerlink" href="#olivero2_commented_at_2020-11-20_1654" title="Permanent link">&para;</a></h4>
<p>Do not research Btrfs stuff, not even on Monday. For now, this is just a
one-off event, so let's relax! :-)</p>
<p>EDIT: FYI – this might be really hard to reproduce as this was the
sequence of events as I remember them:</p>
<ol>
<li>ran <code>rear mkrescue</code> (current GitHub version) -&gt; message
    <code>Ignoring non-existing btrfs subvolume listed as mounted: /home</code>
    appeared</li>
<li>about one minute later: ran the installed version (2.6 commit
    44f85531) of <code>rear mkrescue</code> -&gt; message appeared</li>
<li>did some local testing (a couple of minutes)</li>
<li>added extra debug output to ReaR</li>
<li>ran <code>rear mkrescue</code> (current GitHub version) -&gt; message did not
    appear (and never came back)</li>
</ol>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-11-16.2519.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
