<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#146 Issue closed: Default NFS option (root_squash) causes problems, we should detect/report - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#146 Issue closed: Default NFS option (root_squash) causes problems, we should detect/report";
        var mkdocs_page_input_path = "issues/2012-08-17.146.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#146 Issue closed: Default NFS option (root_squash) causes problems, we should detect/report</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="146_issue_closed_default_nfs_option_root_squash_causes_problems_we_should_detectreport"><a href="https://github.com/rear/rear/issues/146">#146 Issue</a> <code>closed</code>: Default NFS option (root_squash) causes problems, we should detect/report<a class="headerlink" href="#146_issue_closed_default_nfs_option_root_squash_causes_problems_we_should_detectreport" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code></p>
<h4 id="mcamero_opened_issue_at_2012-08-17_1812"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> opened issue at <a href="https://github.com/rear/rear/issues/146">2012-08-17 18:12</a>:<a class="headerlink" href="#mcamero_opened_issue_at_2012-08-17_1812" title="Permanent link">&para;</a></h4>
<p>Following Error while trying to create build dir</p>
<p><code>ERROR: Could not mkdir '/tmp/rear.fQgYU7zNLwwKWYJ/outputfs/rear'</code></p>
<p>Following is output of rear log</p>
<pre><code>2012-08-17 14:11:44 Relax and Recover 1.13.0 / $Date$
2012-08-17 14:11:44 Command line options: /usr/sbin/rear -v mkbackuponly
2012-08-17 14:11:44 Including conf/Linux-i386.conf
2012-08-17 14:11:44 Including conf/GNU/Linux.conf
2012-08-17 14:11:44 Including conf/SUSE_LINUX.conf
2012-08-17 14:11:44 Including /etc/rear/local.conf
2012-08-17 14:11:44 Using build area '/tmp/rear.JmxRUMCdqcvOtqA'
mkdir: created directory `/tmp/rear.JmxRUMCdqcvOtqA/rootfs'
mkdir: created directory `/tmp/rear.JmxRUMCdqcvOtqA/tmp'
2012-08-17 14:11:44 Running mkbackuponly workflow
2012-08-17 14:11:44 Running 'prep' stage
2012-08-17 14:11:44 Including prep/default/00_remove_workflow_conf.sh
mkdir: created directory `/tmp/rear.JmxRUMCdqcvOtqA/rootfs/etc'
mkdir: created directory `/tmp/rear.JmxRUMCdqcvOtqA/rootfs/etc/rear'
2012-08-17 14:11:44 Including prep/default/02_translate_url.sh
2012-08-17 14:11:44 Including prep/NETFS/default/05_check_NETFS_requirements.sh
2012-08-17 14:11:44 Skipping ping test
2012-08-17 14:11:44 Including prep/NETFS/default/15_save_rsync_version.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/20_include_agetty.sh
2012-08-17 14:11:44 Including prep/NETFS/GNU/Linux/20_selinux_in_use.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/21_include_dhclient.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/22_include_lvm_tools.sh
2012-08-17 14:11:44 Device mapper found enabled. Including LVM tools.
2012-08-17 14:11:44 Including prep/GNU/Linux/23_include_md_tools.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/28_include_systemd.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/28_include_vmware_tools.sh
2012-08-17 14:11:44 Including '/usr/lib*/vmware-tools'
2012-08-17 14:11:44 Including prep/GNU/Linux/29_include_drbd.sh
2012-08-17 14:11:44 Including prep/ISO/default/30_check_iso_dir.sh
2012-08-17 14:11:44 Including prep/GNU/Linux/30_include_grub_tools.sh
2012-08-17 14:11:44 Including prep/ISO/default/32_check_cdrom_size.sh
2012-08-17 14:11:44 ISO Directory '/var/tmp' [/dev/mapper/system-root] has 4933 MB free space
2012-08-17 14:11:44 Including prep/ISO/GNU/Linux/32_verify_mkisofs.sh
2012-08-17 14:11:44 Using '/usr/bin/mkisofs' to create ISO images
2012-08-17 14:11:44 Including prep/ISO/Linux-i386/33_find_isolinux.sh
2012-08-17 14:11:44 Including prep/NETFS/default/40_automatic_exclude_recreate.sh
2012-08-17 14:11:44 Finished running 'prep' stage in 0 seconds
2012-08-17 14:11:44 Running 'layout/save' stage
2012-08-17 14:11:44 Including layout/save/GNU/Linux/10_create_layout_file.sh
2012-08-17 14:11:44 Creating disk layout
2012-08-17 14:11:44 Preparing layout directory.
2012-08-17 14:11:44 Including layout/save/GNU/Linux/20_partition_layout.sh
2012-08-17 14:11:44 Saving disk partitions.
2012-08-17 14:11:44 Including layout/save/GNU/Linux/21_raid_layout.sh
2012-08-17 14:11:44 Including layout/save/GNU/Linux/22_lvm_layout.sh
2012-08-17 14:11:44 Saving LVM layout.
2012-08-17 14:11:44 Including layout/save/GNU/Linux/23_filesystem_layout.sh
2012-08-17 14:11:44 Saving Filesystem layout.
2012-08-17 14:11:45 Including layout/save/GNU/Linux/24_swaps_layout.sh
2012-08-17 14:11:45 Saving Swap information.
2012-08-17 14:11:45 Including layout/save/GNU/Linux/25_drbd_layout.sh
2012-08-17 14:11:45 Including layout/save/GNU/Linux/26_crypt_layout.sh
2012-08-17 14:11:45 Saving Encrypted volumes.
2012-08-17 14:11:45 Including layout/save/GNU/Linux/27_hpraid_layout.sh
2012-08-17 14:11:45 Including layout/save/GNU/Linux/28_multipath_layout.sh
2012-08-17 14:11:45 Including layout/save/default/30_list_dependencies.sh
2012-08-17 14:11:45 Including layout/save/default/31_include_exclude.sh
2012-08-17 14:11:45 Including layout/save/default/32_autoexclude.sh
2012-08-17 14:11:45 Including layout/save/default/33_remove_exclusions.sh
2012-08-17 14:11:45 Including layout/save/default/34_generate_mountpoint_device.sh
2012-08-17 14:11:45 Including layout/save/GNU/Linux/35_copy_drbdtab.sh
2012-08-17 14:11:45 Including layout/save/GNU/Linux/50_extract_vgcfg.sh
2012-08-17 14:11:45 Including layout/save/GNU/Linux/51_current_disk_usage.sh
2012-08-17 14:11:45 Including layout/save/SUSE_LINUX/60_create_mkbootloader.sh
2012-08-17 14:11:45 Using boot loader GRUB
2012-08-17 14:11:45 Including layout/save/default/60_snapshot_files.sh
2012-08-17 14:11:45 Finished running 'layout/save' stage in 1 seconds
2012-08-17 14:11:45 Running 'backup' stage
2012-08-17 14:11:45 Including backup/NETFS/default/10_mount_NETFS_path.sh
mkdir: created directory `/tmp/rear.JmxRUMCdqcvOtqA/outputfs'
2012-08-17 14:11:45 Mounting with 'mount -v -t nfs -o rw,noatime acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ /tmp/rear.JmxRUMCdqcvOtqA/outputfs'
mount.nfs: trying 192.168.35.9 prog 100003 vers 3 prot TCP port 2049
mount.nfs: trying 192.168.35.9 prog 100005 vers 3 prot UDP port 950
mount.nfs: timeout set for Fri Aug 17 14:13:45 2012
mount.nfs: trying text-based options 'addr=192.168.35.9'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: prog 100005, trying vers=3, prot=17
acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ on /tmp/rear.JmxRUMCdqcvOtqA/outputfs type nfs (rw,noatime)
2012-08-17 14:11:45 Including backup/NETFS/default/15_save_copy_of_prefix_dir.sh
2012-08-17 14:11:45 Including backup/NETFS/default/20_make_prefix_dir.sh
mkdir: cannot create directory `/tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear': Permission denied
Trace: 122 StopIfError /usr/share/rear/lib/_input-output-functions.sh
Trace: 14 source /usr/share/rear/backup/NETFS/default/20_make_prefix_dir.sh
Trace: 40 Source /usr/share/rear/lib/framework-functions.sh
Trace: 79 SourceStage /usr/share/rear/lib/framework-functions.sh
Trace: 19 WORKFLOW_mkbackuponly /usr/share/rear/lib/mkbackuponly-workflow.sh
Trace: 238 main /usr/sbin/rear
2012-08-17 14:11:45 ERROR: Could not mkdir '/tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear'
2012-08-17 14:11:45 Running exit tasks.
Legacy NFS mount point detected
umount.nfs: trying 192.168.35.9 prog 100005 vers 3 prot UDP port 950
umount.nfs: prog 100005, trying vers=3, prot=17
acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ umounted
rmdir: removing directory, `/tmp/rear.JmxRUMCdqcvOtqA/outputfs'
2012-08-17 14:11:45 Finished in 1 seconds
2012-08-17 14:11:45 Removing build area /tmp/rear.JmxRUMCdqcvOtqA
rmdir: removing directory, `/tmp/rear.JmxRUMCdqcvOtqA'
2012-08-17 14:11:45 End of program reached
</code></pre>
<h4 id="dagwieers_commented_at_2012-08-20_1311"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7868501">2012-08-20 13:11</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-20_1311" title="Permanent link">&para;</a></h4>
<p>Can this error be caused by NFS mount permissions ?</p>
<pre><code>mkdir: cannot create directory `/tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear': Permission denied
</code></pre>
<p>If you are root and root has no permissions it reminds me of
<strong>root_squash</strong> problems.</p>
<h4 id="mcamero_commented_at_2012-08-20_1335"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7869179">2012-08-20 13:35</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-20_1335" title="Permanent link">&para;</a></h4>
<p>Root cannot create a subdir prior to create parent dir. See below:<br />
mkdir errors on creating directory with -p option.<br />
With -p option works.<br />
when running rear mkbackuponly it 'StopifError' on the attempt to create
whole directory.</p>
<pre><code>rear:/usr/share/rear/prep/NETFS/default # mkdir /tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear
mkdir: cannot create directory `/tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear': No such file or directory
rear:/usr/share/rear/prep/NETFS/default # mkdir -p /tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear
</code></pre>
<h4 id="mcamero_commented_at_2012-08-20_1336"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7869217">2012-08-20 13:36</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-20_1336" title="Permanent link">&para;</a></h4>
<p>Sorry..Was not intention to close this issue. Please see comment above</p>
<h4 id="dagwieers_commented_at_2012-08-20_1347"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7869516">2012-08-20 13:47</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-20_1347" title="Permanent link">&para;</a></h4>
<p>The parent dir is your mountpoint so it should exist (since it didn't
bail out when mounting, see below).</p>
<pre><code>2012-08-17 14:11:45 Mounting with 'mount -v -t nfs -o rw,noatime acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ /tmp/rear.JmxRUMCdqcvOtqA/outputfs'
mount.nfs: trying 192.168.35.9 prog 100003 vers 3 prot TCP port 2049
mount.nfs: trying 192.168.35.9 prog 100005 vers 3 prot UDP port 950
mount.nfs: timeout set for Fri Aug 17 14:13:45 2012
mount.nfs: trying text-based options 'addr=192.168.35.9'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: prog 100005, trying vers=3, prot=17
acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ on /tmp/rear.JmxRUMCdqcvOtqA/outputfs type nfs (rw,noatime)
</code></pre>
<p>The problem is a permission denied creating a subdirectory inside the
NFS mount, which I think is because of permissions issues. The reason
you can create the directory afterwards is because at that point it had
been unmounted (and removed). Please try mounting the NFS mount
yourself, and creating a directory inside the NFS mount to verify that
this is indeed the problem.</p>
<h4 id="mcamero_commented_at_2012-08-20_1647"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7875489">2012-08-20 16:47</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-20_1647" title="Permanent link">&para;</a></h4>
<p>From the client side the script 'rear mkbackuponly' is trying to create
<em>/tmp/rear.JmxRUMCdqcvOtqA/outputfs</em> in order to use it as the mount
point to the indicated nfs server. Below is the permissions of <em>/tmp</em>.</p>
<p>When I manually create the nfs mount:</p>
<pre><code>acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR 103212320 91064640   7953376  92% /tmp/rear.JmxRUMCdqcvOtqA/outputfs
</code></pre>
<p>And then try to create the 'rear' subdir under it:</p>
<pre><code>rear:/tmp # mkdir rear /tmp/rear.JmxRUMCdqcvOtqA/outputfs
mkdir: cannot create directory `/tmp/rear.JmxRUMCdqcvOtqA/outputfs': File exists
rear:/tmp # mkdir -p rear /tmp/rear.JmxRUMCdqcvOtqA/outputfs
</code></pre>
<p>Only works with -p option</p>
<pre><code>drwxrwxrwt  42 root root  4096 Aug 20 12:38 tmp
</code></pre>
<p>Thanks for help, appreciated.</p>
<h4 id="mcamero_commented_at_2012-08-20_1653"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7875662">2012-08-20 16:53</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-20_1653" title="Permanent link">&para;</a></h4>
<p><code>drwxr-xr-x  2 root root 4096 Aug 15 13:29 outputfs</code></p>
<pre><code>mkdir: created directory `/tmp/rear.LYNrvU9i66M123V/outputfs'
2012-08-20 12:51:58 Mounting with 'mount -v -t nfs -o rw,noatime acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ /tmp/rear.LYNrvU9i66M123V/outputfs'
mount.nfs: trying 192.168.35.9 prog 100003 vers 3 prot TCP port 2049
mount.nfs: trying 192.168.35.9 prog 100005 vers 3 prot UDP port 950
mount.nfs: timeout set for Mon Aug 20 12:53:58 2012
mount.nfs: trying text-based options 'addr=192.168.35.9'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: prog 100005, trying vers=3, prot=17
acpic-s711.rcmp-grc.gc.ca:/global/data/images/ReaR/ on /tmp/rear.LYNrvU9i66M123V/outputfs type nfs (rw,noatime)
2012-08-20 12:51:58 Including backup/NETFS/default/15_save_copy_of_prefix_dir.sh
2012-08-20 12:51:58 Including backup/NETFS/default/20_make_prefix_dir.sh
mkdir: cannot create directory `/tmp/rear.LYNrvU9i66M123V/outputfs/rear': Permission denied
Trace: 122 StopIfError /usr/share/rear/lib/_input-output-functions.sh
</code></pre>
<h4 id="mcamero_commented_at_2012-08-20_1722"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7876521">2012-08-20 17:22</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-20_1722" title="Permanent link">&para;</a></h4>
<p>Would a strace help?</p>
<p>Strace grep error only</p>
<pre><code>read(255, "exec 2&gt;\"$LOGFILE\" || echo \"ERROR"..., 6828) = 2681
read(255, "StopIfError \"Could not create bu"..., 6828) = 634
read(255, "StopIfError \"Could not create $R"..., 6828) = 410
read(255, "StopIfError \"Could not create $T"..., 6828) = 341
write(1, "2012-08-20 13:14:05 ERROR: Could"..., 85) = 85
write(1, "ERROR: Could not mkdir '/tmp/rea"..., 65ERROR: Could not mkdir '/tmp/rear.yBf6xK3q7KcibqQ/outputfs/rear'
write(1, "Aborting due to an error, check "..., 63Aborting due to an error, check /tmp/rear-rear.log for details
</code></pre>
<h4 id="dagwieers_commented_at_2012-08-21_1255"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7899966">2012-08-21 12:55</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-21_1255" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Only works with -p option</p>
</blockquote>
<p>The command <code>mkdir -p</code> doesn't do anything if the directory already
exists. Just do the test:</p>
<pre><code>[dag@moria unoconv]$ mkdir /usr/bin
mkdir: cannot create directory `/usr/bin': File exists
[dag@moria unoconv]$ mkdir -p /usr/bin
[dag@moria unoconv]$
</code></pre>
<p>Also remark the error <strong>File exists</strong> which is not as the original
report <strong>Permission denied</strong>.</p>
<p>So please try the same by doing
<code>mkdir /tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear</code> and
<code>mkdir -p /tmp/rear.JmxRUMCdqcvOtqA/outputfs/rear</code> instead (mind the
appended <em>/rear</em>).</p>
<h4 id="mcamero_commented_at_2012-08-21_1316"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7900461">2012-08-21 13:16</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-21_1316" title="Permanent link">&para;</a></h4>
<p>Fixed. Thanks.</p>
<p>Mark Cameron<br />
613 868 2773</p>
<h4 id="dagwieers_commented_at_2012-08-21_2156"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7917836">2012-08-21 21:56</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-21_2156" title="Permanent link">&para;</a></h4>
<p>@mcamero What exactly is fixed ? Can you provide us with an update to
this ticket ?</p>
<h4 id="mcamero_commented_at_2012-08-21_2358"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7920577">2012-08-21 23:58</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-21_2358" title="Permanent link">&para;</a></h4>
<p>Sorry. I was being a moron. Permissions on the directory of the Nfs
server. Thanks for your assistance.</p>
<p>Mark Cameron<br />
613 868 2773</p>
<h4 id="jetwes_commented_at_2012-08-22_0730"><img src="https://avatars.githubusercontent.com/u/1346373?v=4" width="50"><a href="https://github.com/jetwes">jetwes</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7926649">2012-08-22 07:30</a>:<a class="headerlink" href="#jetwes_commented_at_2012-08-22_0730" title="Permanent link">&para;</a></h4>
<p>I have the same error.</p>
<pre><code>sudo rear mkbackup -v
Relax-and-Recover 1.13.0-git201208040834 / 2012-08-04
Using log file: /var/log/rear/rear-sm-star1.log
Creating disk layout
Creating root filesystem layout
TIP: To login as root via ssh you need to set up /root/.ssh/authorized_keys
Copying files and directories
Copying binaries and libraries
Copying kernel modules
Creating initramfs
ERROR: Could not mkdir '/tmp/rear.wIK3JYJPpgs2r8j/outputfs/sm-star1'
Aborting due to an error, check /var/log/rear/rear-sm-star1.log for details*
</code></pre>
<p>Logfile:</p>
<pre><code>mkdir: created directory `/tmp/rear.wIK3JYJPpgs2r8j/tmp/boot'
2012-08-22 09:24:17 Including output/NETFS/default/20_make_prefix_dir.sh
mkdir: cannot create directory `/tmp/rear.wIK3JYJPpgs2r8j/outputfs/sm-star1': Permission denied
Trace: 122 StopIfError /usr/share/rear/lib/_input-output-functions.sh
Trace: 14 source /usr/share/rear/output/NETFS/default/20_make_prefix_dir.sh
Trace: 40 Source /usr/share/rear/lib/framework-functions.sh
Trace: 79 SourceStage /usr/share/rear/lib/framework-functions.sh
Trace: 24 WORKFLOW_mkbackup /usr/share/rear/lib/mkbackup-workflow.sh
Trace: 245 main /usr/sbin/rear
2012-08-22 09:24:17 ERROR: Could not mkdir '/tmp/rear.wIK3JYJPpgs2r8j/outputfs/sm-star1'
2012-08-22 09:24:17 Running exit tasks.
NFSv4 mount point detected
sm-star1.soest-hosting.de:/var/backup umounted
rmdir: removing directory, `/tmp/rear.wIK3JYJPpgs2r8j/outputfs'
2012-08-22 09:24:17 Finished in 16 seconds
2012-08-22 09:24:17 Removing build area /tmp/rear.wIK3JYJPpgs2r8j
rmdir: removing directory, `/tmp/rear.wIK3JYJPpgs2r8j'
2012-08-22 09:24:17 End of program reached*
</code></pre>
<p>config:</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
NETFS_URL="nfs://sm-star1.soest-hosting.de/var/backup"*
</code></pre>
<p>my NFS ist working:</p>
<pre><code> sudo showmount -e sm-star1.soest-hosting.de
Export list for sm-star1.soest-hosting.de:
/var/backup sm-star1.soest-hosting.de* and has write permissions
</code></pre>
<h4 id="dagwieers_commented_at_2012-08-22_1228"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7932488">2012-08-22 12:28</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-22_1228" title="Permanent link">&para;</a></h4>
<p>@mcamero Thanks for the update. Having a resolution is important for
users and future troubleshooting.</p>
<p>@jetwes Can you verify this is not caused by the same problem reported
by @mcamero ? If your NFS share is exported as <strong>root_squash</strong>, the
root user on the NFS client will not have the proper rights on the
mounted NFS share (as root). All access will be reduced to anonymous
access (nobody) on the NFS server (even when, or rather, <em>specifically
because</em> you are root). You can test this by mounting the NFS share and
then trying to create a directory and/or file inside the mounted share.</p>
<h4 id="dagwieers_commented_at_2012-08-22_1230"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7932516">2012-08-22 12:30</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-22_1230" title="Permanent link">&para;</a></h4>
<p>BTW We may have to make this more obvious from the documentation and/or
modify the error message specifically when NFS is used and a
<strong>Permission denied</strong> error is returned. Before closing this ticket I
will create a feature request for this. I first like to see if this is
the same cause for @jetwes !</p>
<h4 id="mcamero_commented_at_2012-08-22_1929"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7946147">2012-08-22 19:29</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-22_1929" title="Permanent link">&para;</a></h4>
<p>What are the permissions of nfs share ?</p>
<p>Mark Cameron<br />
613 868 2773</p>
<h4 id="mcamero_commented_at_2012-08-22_1932"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-7946228">2012-08-22 19:32</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-22_1932" title="Permanent link">&para;</a></h4>
<p>That sounds like a good plan. Enabling all the permissions on the subdir
rear of the nfs share eg /global/data/rear, was what fixed it for me.</p>
<p>Mark Cameron<br />
613 868 2773</p>
<h4 id="dagwieers_commented_at_2012-08-28_2153"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8108594">2012-08-28 21:53</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-08-28_2153" title="Permanent link">&para;</a></h4>
<p>@jetwes Do you still have this issue ?</p>
<h4 id="mcamero_commented_at_2012-08-28_2322"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8110645">2012-08-28 23:22</a>:<a class="headerlink" href="#mcamero_commented_at_2012-08-28_2322" title="Permanent link">&para;</a></h4>
<p>No. It has been resolved.</p>
<p>Thanks</p>
<p>Mark Cameron<br />
613 868 2773</p>
<h4 id="jetwes_commented_at_2012-08-29_0658"><img src="https://avatars.githubusercontent.com/u/1346373?v=4" width="50"><a href="https://github.com/jetwes">jetwes</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8116851">2012-08-29 06:58</a>:<a class="headerlink" href="#jetwes_commented_at_2012-08-29_0658" title="Permanent link">&para;</a></h4>
<p>Sorry for the late answer. I didn't try it again, because it reinstalled
the system and didn't had the time to check it again. I will get to this
as soon as i tried again.</p>
<p>Thx<br />
Jens</p>
<h4 id="cal-s_commented_at_2012-09-05_1628"><img src="https://avatars.githubusercontent.com/u/2027029?v=4" width="50"><a href="https://github.com/cal-s">cal-s</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8304836">2012-09-05 16:28</a>:<a class="headerlink" href="#cal-s_commented_at_2012-09-05_1628" title="Permanent link">&para;</a></h4>
<p>Yes, this happens when the remote filesystem is exported with
"root_squash", so root on the local system is unable to create dirs
below the /tmp/rear.[blah]/outputfs mountpoint. The workarouind is to
create a world-writeable subdir manually and register its location in
local.conf. Alternately, create a "no_root_squash" filesystem/export
for ReaR's use. At the risk of overcomplicating matters, perhaps ReaR
could offer to spawn a shell so that the user can ssh to the remote and
create the directory, then retry the mount/mkdir without being bounced
out of ReaR?</p>
<h4 id="schlomo_commented_at_2012-09-05_1946"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8311485">2012-09-05 19:46</a>:<a class="headerlink" href="#schlomo_commented_at_2012-09-05_1946" title="Permanent link">&para;</a></h4>
<p>Just wanted to note that ReaR is intended to run unattended, e.g. from
a<br />
cron job. So spawning shell is for most use cases not a good idea.</p>
<p>Usually people set up ReaR to work properly and let it run by itself
after<br />
the initial setup.</p>
<h4 id="cal-s_commented_at_2012-09-05_2005"><img src="https://avatars.githubusercontent.com/u/2027029?v=4" width="50"><a href="https://github.com/cal-s">cal-s</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8312082">2012-09-05 20:05</a>:<a class="headerlink" href="#cal-s_commented_at_2012-09-05_2005" title="Permanent link">&para;</a></h4>
<p>So i hear. However, root_squash'd nfs exports and lack of distincitve
(ie: date-appaended) save targets/dirs do make unattended operation kind
of unwieldy. I'd imagine that many people pull mkbackups selectively by
hand as systems undergo known changes - i know i do.</p>
<p>regards,</p>
<ul>
<li>cal</li>
</ul>
<h4 id="dagwieers_commented_at_2012-09-05_2154"><img src="https://avatars.githubusercontent.com/u/388198?u=0732dee3fe5002278cfbf40359ec431bdcf5f06c&v=4" width="50"><a href="https://github.com/dagwieers">dagwieers</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8315403">2012-09-05 21:54</a>:<a class="headerlink" href="#dagwieers_commented_at_2012-09-05_2154" title="Permanent link">&para;</a></h4>
<p>@cal-s Even if one does occasional backups using Relax-and-Recover,
setting up NFS correctly in advance is not an unreasonable expectation.
We should report to the user that root_squash is the cause (and add it
as a tip in the documentation), but that's as far as our responsibility
goes. If permissions are the problem a different error could indicate
this, but remember selinux could also be causing us problems... To me
this is a support issue, rather than a technical issue to solve and so
we should make it easier for users to understand the problem. That's why
I do not consider it a bug.</p>
<p><strong>TODO:</strong> Escalate better to the user</p>
<h4 id="cal-s_commented_at_2012-09-06_0807"><img src="https://avatars.githubusercontent.com/u/2027029?v=4" width="50"><a href="https://github.com/cal-s">cal-s</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8325382">2012-09-06 08:07</a>:<a class="headerlink" href="#cal-s_commented_at_2012-09-06_0807" title="Permanent link">&para;</a></h4>
<p>Fully agree. Thank you!</p>
<ul>
<li>cal</li>
</ul>
<h4 id="mcamero_commented_at_2012-09-06_2224"><img src="https://avatars.githubusercontent.com/u/1566548?u=df28c965d0f8b3879910b119889e178f468a69ca&v=4" width="50"><a href="https://github.com/mcamero">mcamero</a> commented at <a href="https://github.com/rear/rear/issues/146#issuecomment-8349831">2012-09-06 22:24</a>:<a class="headerlink" href="#mcamero_commented_at_2012-09-06_2224" title="Permanent link">&para;</a></h4>
<p>Definitely not a bug.</p>
<p>Mark Cameron<br />
613 868 2773</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2012-08-17.146.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
