<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2377 Issue closed: Remove duplicates in COPY_AS_IS PROGS REQUIRED_PROGS LIBS before processing? - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2377 Issue closed: Remove duplicates in COPY_AS_IS PROGS REQUIRED_PROGS LIBS before processing?";
        var mkdocs_page_input_path = "issues/2020-04-22.2377.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2377 Issue closed: Remove duplicates in COPY_AS_IS PROGS REQUIRED_PROGS LIBS before processing?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2377_issue_closed_remove_duplicates_in_copy_as_is_progs_required_progs_libs_before_processing"><a href="https://github.com/rear/rear/issues/2377">#2377 Issue</a> <code>closed</code>: Remove duplicates in COPY_AS_IS PROGS REQUIRED_PROGS LIBS before processing?<a class="headerlink" href="#2377_issue_closed_remove_duplicates_in_copy_as_is_progs_required_progs_libs_before_processing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2020-04-22_0656"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2377">2020-04-22 06:56</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2020-04-22_0656" title="Permanent link">&para;</a></h4>
<p>Currently the elements in the arrays<br />
COPY_AS_IS PROGS REQUIRED_PROGS LIBS<br />
are processed one by one "as is" by scripts like<br />
build/GNU/Linux/100_copy_as_is.sh<br />
build/GNU/Linux/390_copy_binaries_libraries.sh<br />
so that duplicate array elements are processed as often as they appear.</p>
<p>This way nothing goes wrong, it only takes more time if there are
duplicates.<br />
In particular the ordering of the elements in the arrays is kept.<br />
Perhaps the ordering in COPY_AS_IS might be important.</p>
<p>I wonder if it is worth the effort to remove duplicates<br />
in particular to filter out duplicates that keeps the ordering of the
elements.</p>
<p>I will experiment a bit with that...</p>
<h4 id="jsmeix_commented_at_2020-04-22_0927"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-617663569">2020-04-22 09:27</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-22_0927" title="Permanent link">&para;</a></h4>
<p>At least for my test case the COPY_AS_IS array<br />
results only a few duplicates:</p>
<pre><code># sort /tmp/rear.RX0ACBwlXC2bRiS/tmp/copy-as-is-filelist | uniq -cd
      2 /etc/localtime
      2 /etc/modules-load.d/
      2 /usr/share/kbd/keymaps/legacy/i386/qwerty/defkeymap.map.gz
</code></pre>
<h4 id="jsmeix_commented_at_2020-04-22_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-617759345">2020-04-22 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-22_1250" title="Permanent link">&para;</a></h4>
<p>For PROGS and REQUIRED_PROGS duplicates are already removed<br />
in build/GNU/Linux/390_copy_binaries_libraries.sh<br />
via the <code>sort -u</code> in this code</p>
<pre><code>local all_binaries=( $( for bin in "${PROGS[@]}" "${REQUIRED_PROGS[@]}" ; do
                            bin_path="$( get_path "$bin" )"
                            if test -x "$bin_path" ; then
                                echo $bin_path
                                Log "Found binary $bin_path"
                            fi
                        done 2&gt;&gt;/dev/$DISPENSABLE_OUTPUT_DEV | sort -u ) )
</code></pre>
<h4 id="jsmeix_commented_at_2020-04-22_1257"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-617762660">2020-04-22 12:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-22_1257" title="Permanent link">&para;</a></h4>
<p>For LIBS duplicates are already removed in the following way:</p>
<p>In build/GNU/Linux/390_copy_binaries_libraries.sh there is</p>
<pre><code>local all_libs=( "${LIBS[@]}" $( RequiredSharedObjects "${all_binaries[@]}" "${LIBS[@]}" ) )
</code></pre>
<p>and the <code>RequiredSharedObjects</code> function in lib/linux-functions.sh</p>
<pre><code>function RequiredSharedObjects () {
    ...
    for file_for_ldd in $@ ; do
        ...
        ldd $file_for_ldd
        ...
    done 2&gt;&gt;/dev/$DISPENSABLE_OUTPUT_DEV | awk ' /^\t.+ =&gt; not found/ { print "Shared object " $1 " not found" &gt; "/dev/stderr" }
                                                 /^\t.+ =&gt; \// { print $3 }
                                                 /^\t\// &amp;&amp; !/ =&gt; / { print $1 } ' | sort -u
}
</code></pre>
<p>has a <code>sort -u</code></p>
<h4 id="jsmeix_commented_at_2020-04-23_0948"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-618301702">2020-04-23 09:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-23_0948" title="Permanent link">&para;</a></h4>
<p>Filtering out duplicates and keeping the ordering via</p>
<pre><code>printf '%s\n' "${ARRAY[@]}" | awk '!seen[$0]++'
</code></pre>
<p>seems to run rather fast even for huge arrays:</p>
<pre><code># unset arr

# for i in $( seq 1000 9999 ) ; do arr+=( "element $i with \ * ' ? special chars" ) ; done

# for i in $( seq 9999 -1 1000 ) ; do arr+=( "element $i with \ * ' ? special chars" ) ; done

# printf '%s\n' "${arr[@]}" | wc -l
18000

# printf '%s\n' "${arr[@]}" | head -n3
element 1000 with \ * ' ? special chars
element 1001 with \ * ' ? special chars
element 1002 with \ * ' ? special chars

# printf '%s\n' "${arr[@]}" | tail -n3
element 1002 with \ * ' ? special chars
element 1001 with \ * ' ? special chars
element 1000 with \ * ' ? special chars

# time printf '%s\n' "${arr[@]}" | awk '!seen[$0]++' | wc -l
9000

real    0m0.160s
user    0m0.167s
sys     0m0.028s

# printf '%s\n' "${arr[@]}" | awk '!seen[$0]++' | head -n3
element 1000 with \ * ' ? special chars
element 1001 with \ * ' ? special chars
element 1002 with \ * ' ? special chars

# printf '%s\n' "${arr[@]}" | awk '!seen[$0]++' | tail -n3
element 9997 with \ * ' ? special chars
element 9998 with \ * ' ? special chars
element 9999 with \ * ' ? special chars
</code></pre>
<p>For me COPS_AS_IS has about 130 elements<br />
so a more realistic test with an array that has 200 duplicate elements:</p>
<pre><code># unset arr

# for i in $( seq 100 299 ) ; do arr+=( "element $i with \ * ' ? special chars" ) ; done
# for i in $( seq 299 -1 100 ) ; do arr+=( "element $i with \ * ' ? special chars" ) ; done

# printf '%s\n' "${arr[@]}" | wc -l
400

# time printf '%s\n' "${arr[@]}" | awk '!seen[$0]++' | wc -l
200

real    0m0.012s
user    0m0.011s
sys     0m0.007s
</code></pre>
<p>I used a not so fast Intel Core i3-4000M CPU @ 2.40GHz for that tests<br />
cf.
<a href="https://github.com/rear/rear/issues/2364#issuecomment-616567193">https://github.com/rear/rear/issues/2364#issuecomment-616567193</a></p>
<p>So filtering out duplicates and keeping the ordering in COPY_AS_IS<br />
that needs to run only once in build/GNU/Linux/100_copy_as_is.sh<br />
could be a reasonable thing to have cleaner working code there.<br />
From my personal point of view our code looks sloppy and careless<br />
when we let <code>tar</code> needlessly copy duplicated things several times.</p>
<h4 id="jsmeix_commented_at_2020-04-23_1548"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-618476943">2020-04-23 15:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-23_1548" title="Permanent link">&para;</a></h4>
<p>Via
<a href="https://github.com/rear/rear/pull/2378">https://github.com/rear/rear/pull/2378</a><br />
I implemented filtering out duplicates in <code>COPY_AS_IS</code><br />
and also removing duplicates in the <code>copy_as_is_filelist_file</code></p>
<h4 id="jsmeix_commented_at_2020-04-27_1329"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2377#issuecomment-619986511">2020-04-27 13:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-04-27_1329" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2378">https://github.com/rear/rear/pull/2378</a>
merged<br />
this issue is done.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-04-22.2377.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
