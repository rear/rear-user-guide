<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2338 Issue closed: Testing only /usr/lib/grub*/x86_64-efi/moddep.lst is insufficient - could be also in /boot/grub*/ or in /usr/share/grub*/ - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2338 Issue closed: Testing only /usr/lib/grub*/x86_64-efi/moddep.lst is insufficient - could be also in /boot/grub*/ or in /usr/share/grub*/";
        var mkdocs_page_input_path = "issues/2020-03-04.2338.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2338 Issue closed: Testing only /usr/lib/grub*/x86_64-efi/moddep.lst is insufficient - could be also in /boot/grub*/ or in /usr/share/grub*/</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2338_issue_closed_testing_only_usrlibgrubx86_64-efimoddeplst_is_insufficient_-_could_be_also_in_bootgrub_or_in_usrsharegrub"><a href="https://github.com/rear/rear/issues/2338">#2338 Issue</a> <code>closed</code>: Testing only /usr/lib/grub*/x86_64-efi/moddep.lst is insufficient - could be also in /boot/grub*/ or in /usr/share/grub*/<a class="headerlink" href="#2338_issue_closed_testing_only_usrlibgrubx86_64-efimoddeplst_is_insufficient_-_could_be_also_in_bootgrub_or_in_usrsharegrub" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2020-03-04_0958"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2338">2020-03-04 09:58</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2020-03-04_0958" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    current master code</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    openSUSE Leap 15.1</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://192.168.122.1/nfs
SSH_ROOT_PASSWORD="rear"
USE_DHCLIENT="yes"
PROGRESS_MODE=plain
PROGRESS_WAIT_SECONDS=3
KEEP_BUILD_DIR="yes"
FIRMWARE_FILES=( no )
COPY_AS_IS+=( /home/JohnDoe )
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PC real hardware</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86-64</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME        KNAME     PKNAME   TRAN   TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           sata   disk        931.5G 
|-/dev/sda1 /dev/sda1 /dev/sda        part vfat     500M /boot/efi
|-/dev/sda2 /dev/sda2 /dev/sda        part ext4   915.5G /
`-/dev/sda3 /dev/sda3 /dev/sda        part swap    15.6G [SWAP]
/dev/sdb    /dev/sdb           sata   disk        238.5G 
|-/dev/sdb1 /dev/sdb1 /dev/sdb        part         1000M 
|-/dev/sdb2 /dev/sdb2 /dev/sdb        part         1000M 
|-/dev/sdb3 /dev/sdb3 /dev/sdb        part            1K 
|-/dev/sdb5 /dev/sdb5 /dev/sdb        part ext2    1000M 
|-/dev/sdb6 /dev/sdb6 /dev/sdb        part         1000M 
`-/dev/sdb7 /dev/sdb7 /dev/sdb        part         1000M 
/dev/sr0    /dev/sr0           sata   rom           3.8G
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<!-- -->

<pre><code># usr/sbin/rear -D mkbackup
Relax-and-Recover 2.5 / Git
Using log file: /root/rear.github.master/var/log/rear/rear-g243.log
...
Created initrd.cgz with gzip default compression (136958432 bytes) in 18 seconds
ERROR: grub2-mkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst file)
Some latest log messages since the last called script 250_populate_efibootimg.sh:
  mkdir: created directory '/tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/locale'
  '/boot/efi/EFI/opensuse/grubx64.efi' -&gt; '/tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/BOOTX64.efi'
  /root/rear.github.master/usr/share/rear/lib/_input-output-functions.sh: line 476: type: grub-mkstandalone: not found
  /root/rear.github.master/usr/share/rear/lib/_input-output-functions.sh: line 476: type: grub-probe: not found
                               $gprobe --target=fs "$p"
                               $gprobe --target=partmap "$p" | sed -e 's/^/part_/'
                               $gprobe --target=abstraction "$p"
                           done | sort -u ))
Aborting due to an error, check /root/rear.github.master/var/log/rear/rear-g243.log for details
Exiting rear mkbackup (PID 22270) and its descendant processes ...
Running exit tasks
You should also rm -Rf /tmp/rear.BVHpAOPVK4xhxfw
Terminated
</code></pre>
<p>That Error exit happens in the <code>build_bootx86_efi</code> function<br />
in lib/uefi-functions.sh and the log excerpt is</p>
<pre><code>++ build_bootx86_efi /tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/BOOTX64.efi /tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/grub.cfg /boot /boot/efi/EFI/opensuse/grubx64.efi
++ local outfile=/tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/BOOTX64.efi
++ local embedded_config=
++ local gmkstandalone=
++ local gprobe=
++ dirs=()
++ local dirs
++ modules=(${GRUB2_MODULES_LOAD:+"${GRUB2_MODULES_LOAD[@]}"})
++ local modules
++ shift
++ [[ -n /tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/grub.cfg ]]
++ embedded_config=/boot/grub/grub.cfg=/tmp/rear.BVHpAOPVK4xhxfw/tmp/mnt/EFI/BOOT/grub.cfg
++ shift
++ dirs=(${@:+"$@"})
++ has_binary grub-mkstandalone
++ for bin in $@
++ type grub-mkstandalone
/root/rear.github.master/usr/share/rear/lib/_input-output-functions.sh: line 476: type: grub-mkstandalone: not found
++ return 1
++ has_binary grub2-mkstandalone
++ for bin in $@
++ type grub2-mkstandalone
++ return 0
++ gmkstandalone=grub2-mkstandalone
++ ((  2  ))
++ ((  0  ))
++ has_binary grub-probe
++ for bin in $@
++ type grub-probe
/root/rear.github.master/usr/share/rear/lib/_input-output-functions.sh: line 476: type: grub-probe: not found
++ return 1
++ has_binary grub2-probe
++ for bin in $@
++ type grub2-probe
++ return 0
++ gprobe=grub2-probe
++ '[' -n grub2-probe ']'
++ modules=($( for p in "${dirs[@]}" ; do
                             $gprobe --target=fs "$p"
                             $gprobe --target=partmap "$p" | sed -e 's/^/part_/'
                             $gprobe --target=abstraction "$p"
                         done | sort -u ))
+++ for p in "${dirs[@]}"
+++ grub2-probe --target=fs /boot
+++ sort -u
+++ grub2-probe --target=partmap /boot
+++ sed -e 's/^/part_/'
+++ grub2-probe --target=abstraction /boot
+++ for p in "${dirs[@]}"
+++ grub2-probe --target=fs /boot/efi/EFI/opensuse/grubx64.efi
+++ grub2-probe --target=partmap /boot/efi/EFI/opensuse/grubx64.efi
+++ sed -e 's/^/part_/'
+++ grub2-probe --target=abstraction /boot/efi/EFI/opensuse/grubx64.efi
++ test
++ Error 'grub2-mkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst file)'
</code></pre>
<p>"rear mkbackup" had worked before with some non-current master code<br />
on that system so I guess the recent changes in UEFI area cause it.</p>
<p>The strage thing is that - as far as I can see - the Error exit test<br />
in the <code>build_bootx86_efi</code> function</p>
<pre><code>test /usr/lib/grub*/x86_64-efi/moddep.lst || Error ...
</code></pre>
<p>was not changed by a recent change in the UEFI area<br />
so currently I wonder how that has ever worked before for me?</p>
<p>On my openSUSE Leap 15.1 system I have</p>
<pre><code># find /usr/lib/grub* | grep moddep
[no output]

# find /boot | grep moddep
/boot/grub2/x86_64-efi/moddep.lst

# find /usr | grep moddep
/usr/share/grub2/i386-pc/moddep.lst
/usr/share/grub2/x86_64-efi/moddep.lst
</code></pre>
<p>Accordingly the following hack makes "rear mkbackup" work again for me:</p>
<pre><code>--- a/usr/share/rear/lib/uefi-functions.sh
+++ b/usr/share/rear/lib/uefi-functions.sh
@@ -99,10 +99,12 @@ function build_bootx86_efi {
-    test /usr/lib/grub*/x86_64-efi/moddep.lst || Error "$gmkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst file)"
+    test /usr/lib/grub*/x86_64-efi/moddep.lst || test /boot/grub*/x86_64-efi/moddep.lst || Error "$gmkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst or /boot/grub*/x86_64-efi/moddep.lst file)"
</code></pre>
<p>but I did not try if also "rear recover" works.</p>
<p>I will further investigate as time permits...</p>
<h4 id="pcahyna_commented_at_2020-03-04_1004"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594430656">2020-03-04 10:04</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1004" title="Permanent link">&para;</a></h4>
<p>@jsmeix this test was added in #2013 a year ago - is it possible that
the version which worked was older than that?</p>
<h4 id="jsmeix_commented_at_2020-03-04_1009"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594432946">2020-03-04 10:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1009" title="Permanent link">&para;</a></h4>
<p>I guess I found the reason on openSUSE Leap 15.1:</p>
<pre><code># rpm -qf /usr/share/grub2/x86_64-efi/moddep.lst
grub2-x86_64-efi-2.02-lp151.21.9.1.noarch

# rpm -q --changelog grub2-x86_64-efi-2.02-lp151.21.9.1.noarch
...
* Wed Jan 23 2019 rw@suse.com
- Build platform-packages 'noarch' and move to '/usr/share/efi'
  for SUSE Manager.  (FATE#326960)
  * grub2-efi-xen-chainload.patch (bsc#1122563)
  * grub2-efi-xen-removable.patch (refresh)
...
</code></pre>
<p><code>FATE</code> is the SUSE internal feature tracking tool<br />
so it looks like a SUSE specific packaging change<br />
for a SUSE specific feature for SUSE's <code>SUSE Manager</code> product.<br />
Sigh!</p>
<p>Before I had used openSUSE Leap 15.0 and I guess<br />
there it was in /usr/lib/grub2/x86_64-efi/moddep.lst</p>
<h4 id="jsmeix_commented_at_2020-03-04_1016"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594436110">2020-03-04 10:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1016" title="Permanent link">&para;</a></h4>
<p>@pcahyna @gozora<br />
do you know if "all the other GRUB2 UEFI stuff" in ReaR could be
expected<br />
to "automatically do the right thing" when <code>x86_64-efi/moddep.lst</code><br />
is in an arbitrary directory that belongs to GRUB2 i.e. so that one<br />
can assume GRUB2 "magically knows" where to find its<br />
<code>x86_64-efi/moddep.lst</code> file when GRUB2 needs it?</p>
<p>Or in other words:<br />
Do you think it should be sufficient for such a test<br />
to find a <code>x86_64-efi/moddep.lst</code> file anywhere on the system<br />
and if yes things look sufficiently OK to assume GRUB2 will work?</p>
<h4 id="jsmeix_commented_at_2020-03-04_1020"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594438025">2020-03-04 10:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1020" title="Permanent link">&para;</a></h4>
<p>In our current<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/uefi-functions.sh#L99">https://github.com/rear/rear/blob/master/usr/share/rear/lib/uefi-functions.sh#L99</a><br />
the comment does no longer match the code<br />
because the comment talks about <code>grub-mkimage</code><br />
while the code is about <code>$gmkstandalone</code> i.e. <code>grub2-mkstandalone</code><br />
or <code>grub-mkstandalone</code>.</p>
<h4 id="pcahyna_commented_at_2020-03-04_1029"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594442267">2020-03-04 10:29</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1029" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In our current<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/uefi-functions.sh#L99">https://github.com/rear/rear/blob/master/usr/share/rear/lib/uefi-functions.sh#L99</a><br />
the comment does no longer match the code<br />
because the comment talks about <code>grub-mkimage</code><br />
while the code is about <code>$gmkstandalone</code> i.e. <code>grub2-mkstandalone</code><br />
or <code>grub-mkstandalone</code>.</p>
</blockquote>
<p>Sorry, I probably missed this comment when updating this code.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1033"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594443642">2020-03-04 10:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1033" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
no worries - I will fix it by the way...</p>
<h4 id="pcahyna_commented_at_2020-03-04_1037"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594445369">2020-03-04 10:37</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1037" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna @gozora<br />
do you know if "all the other GRUB2 UEFI stuff" in ReaR could be
expected<br />
to "automatically do the right thing" when <code>x86_64-efi/moddep.lst</code><br />
is in an arbitrary directory that belongs to GRUB2 i.e. so that one<br />
can assume GRUB2 "magically knows" where to find its<br />
<code>x86_64-efi/moddep.lst</code> file when GRUB2 needs it?</p>
<p>Or in other words:<br />
Do you think it should be sufficient for such a test<br />
to find a <code>x86_64-efi/moddep.lst</code> file anywhere on the system<br />
and if yes things look sufficiently OK to assume GRUB2 will work?</p>
</blockquote>
<p>@jhlavac any idea on that? By the way, related Red Hat bug reports are
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1492177">https://bugzilla.redhat.com/show_bug.cgi?id=1492177</a>
and
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1512493">https://bugzilla.redhat.com/show_bug.cgi?id=1512493</a>
- the same problem in Fedora
(<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1419521">https://bugzilla.redhat.com/show_bug.cgi?id=1419521</a>)
has led to #2013 and the test which seems to be the culprit here. I
personally would prefer to fix the problem in Fedora Grub packages to
DTRT and avoid the test completely.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1047"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594450110">2020-03-04 10:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1047" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
fixing GRUB issues in GRUB or in its RPM packages<br />
is the right solution for the future but ReaR must work<br />
with what there is on the various Linux systems so<br />
in ReaR theer are "Dirty hacks welcome", cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>I will change that <code>Error</code> into <code>LogPrintError</code> like</p>
<pre><code>    # grub-mkstandalone needs a .../grub*/x86_64-efi/moddep.lst file (cf. https://github.com/rear/rear/issues/1193)
    # At least on SUSE systems that is in different 'grub2' directories (cf. https://github.com/rear/rear/issues/2338)
    # e.g. on openSUSE Leap 15.0 it is in /usr/lib/grub2/x86_64-efi/moddep.lst
    # but on openSUSE Leap 15.1 that was moved to /usr/share/grub2/x86_64-efi/moddep.lst
    # and the one in /boot/grub2/x86_64-efi/moddep.lst is a copy of the one in /usr/*/grub2/x86_64-efi/moddep.lst
    # so we do not error out if we do not find a /x86_64-efi/moddep.lst file because it could be "anywhere else" in the future
    # but we inform the user here in advance about possible problems when there is no /x86_64-efi/moddep.lst file.
    # Careful: usr/sbin/rear sets nullglob so that /usr/*/grub*/x86_64-efi/moddep.lst gets empty if nothing matches
    # and 'test -f' succeeds with empty argument so that we cannot use 'test -f /usr/*/grub*/x86_64-efi/moddep.lst'
    # also 'test -n' succeeds with empty argument but (fortunately/intentionally?) plain 'test' fails with empty argument:
    test /usr/*/grub*/x86_64-efi/moddep.lst || LogPrintError "$gmkstandalone may fail to make a bootable EFI image of GRUB2 (no /usr/*/grub*/x86_64-efi/moddep.lst file)"
</code></pre>
<p>which also makes "rear mkbackup" work for me on openSUSE Leap 15.1.</p>
<h4 id="gozora_commented_at_2020-03-04_1052"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594451960">2020-03-04 10:52</a>:<a class="headerlink" href="#gozora_commented_at_2020-03-04_1052" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix,</p>
<p>Followig commit excluded <em>/boot</em> from search party, could it be related?</p>
<p><a href="https://github.com/rear/rear/commit/946580c40b0e7025e0a4e4ecd93c5ae6b191b2c7">https://github.com/rear/rear/commit/946580c40b0e7025e0a4e4ecd93c5ae6b191b2c7</a></p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2020-03-04_1056"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594453989">2020-03-04 10:56</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1056" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Hello @jsmeix,</p>
<p>Followig commit excluded <em>/boot</em> from search party, could it be
related?</p>
<p><a href="https://github.com/rear/rear/commit/946580c40b0e7025e0a4e4ecd93c5ae6b191b2c7">946580c</a></p>
</blockquote>
<p>It is a similar idea - look into known Grub directories to check whether
what we need is there. I removed that code in the meantime because
searching at those ever-changing hardcoded paths is not right, and this
issues shows why.</p>
<h4 id="pcahyna_commented_at_2020-03-04_1100"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594456142">2020-03-04 11:00</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1100" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna<br />
fixing GRUB issues in GRUB or in its RPM packages<br />
is the right solution for the future but ReaR must work<br />
with what there is on the various Linux systems so<br />
in ReaR theer are "Dirty hacks welcome", cf.<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>I will change that <code>Error</code> into <code>LogPrintError</code> like</p>
<pre><code>    # grub-mkstandalone needs a .../grub*/x86_64-efi/moddep.lst file (cf. https://github.com/rear/rear/issues/1193)
    # At least on SUSE systems that is in different 'grub2' directories (cf. https://github.com/rear/rear/issues/2338)
    # e.g. on openSUSE Leap 15.0 it is in /usr/lib/grub2/x86_64-efi/moddep.lst
    # but on openSUSE Leap 15.1 that was moved to /usr/share/grub2/x86_64-efi/moddep.lst
    # and the one in /boot/grub2/x86_64-efi/moddep.lst is a copy of the one in /usr/*/grub2/x86_64-efi/moddep.lst
    # so we do not error out if we do not find a /x86_64-efi/moddep.lst file because it could be "anywhere else" in the future
    # but we inform the user here in advance about possible problems when there is no /x86_64-efi/moddep.lst file.
    # Careful: usr/sbin/rear sets nullglob so that /usr/*/grub*/x86_64-efi/moddep.lst gets empty if nothing matches
    # and 'test -f' succeeds with empty argument so that we cannot use 'test -f /usr/*/grub*/x86_64-efi/moddep.lst'
    # also 'test -n' succeeds with empty argument but (fortunately/intentionally?) plain 'test' fails with empty argument:
    test /usr/*/grub*/x86_64-efi/moddep.lst || LogPrintError "$gmkstandalone may fail to make a bootable EFI image of GRUB2 (no /usr/*/grub*/x86_64-efi/moddep.lst file)"
</code></pre>
<p>which also makes "rear mkbackup" work for me on openSUSE Leap 15.1.</p>
</blockquote>
<p>I will submit to you the downstream patch that the RHEL packages have
been carrying and we can discuss it, ok? You can see it here:
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13">https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13</a>
- it replaces the test added in #2013</p>
<h4 id="pcahyna_commented_at_2020-03-04_1102"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594457165">2020-03-04 11:02</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1102" title="Permanent link">&para;</a></h4>
<p>here's the sample output:</p>
<pre><code>WARNING: /usr/lib/grub/x86_64-efi/moddep.lst not found, grub2-mkimage will likely fail. Please install the grub2-efi-x64-modules package to fix this.
ERROR: Error occurred during grub2-mkimage of BOOTX64.efi
Aborting due to an error, check /var/log/rear/rear-localhost.log for details
</code></pre>
<p>(grub2-mkimage should be replaced by grub2-mkstandalone. Note the
WARNING is output by the downstream-added code, but the subsequent ERROR
is from the original code when it actually fails to invoke
grub2-mkimage. So in your case there would be a WARNING but no error.
That's why the error message says "likely fail".)</p>
<h4 id="jsmeix_commented_at_2020-03-04_1111"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594461047">2020-03-04 11:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1111" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
thank you for your<br />
<a href="https://github.com/rear/rear/issues/2338#issuecomment-594451960">https://github.com/rear/rear/issues/2338#issuecomment-594451960</a></p>
<p>You are right, on openSUSE Leap 15.1 I have</p>
<pre><code># find /usr/lib/grub*/x86_64-efi | grep part_gpt
find: ‘/usr/lib/grub*/x86_64-efi’: No such file or directory

# find /usr/*/grub*/x86_64-efi | grep part_gpt
/usr/share/grub2/x86_64-efi/part_gpt.mod
/usr/share/grub2/x86_64-efi/part_gpt.module
</code></pre>
<h4 id="gozora_commented_at_2020-03-04_1122"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594465632">2020-03-04 11:22</a>:<a class="headerlink" href="#gozora_commented_at_2020-03-04_1122" title="Permanent link">&para;</a></h4>
<p>So following change:</p>
<pre><code>-     test /usr/lib/grub*/x86_64-efi/moddep.lst || Error "$gmkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst file)"
+     test /usr/*/grub*/x86_64-efi/moddep.lst || Error "$gmkstandalone would not make bootable EFI image of GRUB2 (no /usr/lib/grub*/x86_64-efi/moddep.lst file)"
</code></pre>
<p>Should be <s>temporarily</s> sufficient ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1125"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594466597">2020-03-04 11:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1125" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
in general in ReaR we like to avoid the word <code>WARNING</code>, cf.<br />
<a href="https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a><br />
which originated here in ReaR at<br />
<a href="https://github.com/rear/rear/issues/564#issuecomment-86418677">https://github.com/rear/rear/issues/564#issuecomment-86418677</a><br />
and subsequent comments there.</p>
<p>In<br />
<a href="https://github.com/rear/rear/issues/1193#issuecomment-452617591">https://github.com/rear/rear/issues/1193#issuecomment-452617591</a><br />
I wrote why I don't like explicit RPM package names.</p>
<p>So better sample output could be something like</p>
<pre><code>Found no /usr/*/grub*/x86_64-efi/moddep.lst file so grub2-mkimage may fail.
ERROR: grub2-mkimage of BOOTX64.efi failed
</code></pre>
<p>or perhaps even better</p>
<pre><code>grub2-mkimage may fail (found no /usr/*/grub*/x86_64-efi/moddep.lst)
ERROR: grub2-mkimage of BOOTX64.efi failed
</code></pre>
<p>to have the most interesting part <code>grub2-mkimage may fail</code><br />
at the beginning of the line (and not as "some trailing technical
detail").</p>
<p>Furthermore regarding things like <code>PrintIfError</code> in<br />
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13">https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13</a><br />
see<br />
<a href="https://github.com/rear/rear/pull/2013#discussion_r245909346">https://github.com/rear/rear/pull/2013#discussion_r245909346</a></p>
<h4 id="jsmeix_commented_at_2020-03-04_1132"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594469353">2020-03-04 11:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1132" title="Permanent link">&para;</a></h4>
<p>As a quick first step for now I did<br />
<a href="https://github.com/rear/rear/commit/d7729b0baba907a66ccfd976ab133964ae4effbe">https://github.com/rear/rear/commit/d7729b0baba907a66ccfd976ab133964ae4effbe</a></p>
<p>But the GRUB2 modules directory part still needs to be fixed, cf.<br />
<a href="https://github.com/rear/rear/issues/2338#issuecomment-594461047">https://github.com/rear/rear/issues/2338#issuecomment-594461047</a></p>
<h4 id="jsmeix_commented_at_2020-03-04_1134"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594469968">2020-03-04 11:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1134" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
only as a nitpicking side note (not meant seriously) in your<br />
<a href="https://github.com/rear/rear/issues/2338#issuecomment-594465632">https://github.com/rear/rear/issues/2338#issuecomment-594465632</a><br />
the error message does not fully match the code ;-)</p>
<h4 id="gozora_commented_at_2020-03-04_1149"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594475755">2020-03-04 11:49</a>:<a class="headerlink" href="#gozora_commented_at_2020-03-04_1149" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix</p>
<p>Might be ;-), i didn't read the part after pipe ;-).</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1152"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594476751">2020-03-04 11:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1152" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
you meant that double pipe <code>||</code> ( has much more throughput ;-)</p>
<h4 id="jsmeix_commented_at_2020-03-04_1153"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594477428">2020-03-04 11:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1153" title="Permanent link">&para;</a></h4>
<p>Where <code>lib/grub</code> is used in ReaR scripts:</p>
<pre><code># find usr/sbin/rear usr/share/rear/ -type f | xargs grep 'lib/grub'
usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh:COPY_AS_IS_EXCLUDE+=( /boot /etc/grub.d /etc/default/grub /usr/lib/grub /usr/share/grub )
usr/share/rear/prep/GNU/Linux/300_include_grub_tools.sh:             /usr/lib/grub* /usr/share/grub* /etc/tuned/* )
usr/share/rear/output/RAWDISK/Linux-i386/270_create_grub2_efi_bootloader.sh:[[ -d /usr/lib/grub/x86_64-efi ]] || return 0
usr/share/rear/lib/uefi-functions.sh:            if test /usr/lib/grub*/x86_64-efi/partmap.lst ; then
usr/share/rear/lib/uefi-functions.sh:                modules=( $(cat /usr/lib/grub*/x86_64-efi/partmap.lst) )
usr/share/rear/lib/uefi-functions.sh:    # e.g. on openSUSE Leap 15.0 it is in /usr/lib/grub2/x86_64-efi/moddep.lst
</code></pre>
<h4 id="gozora_commented_at_2020-03-04_1156"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594478647">2020-03-04 11:56</a>:<a class="headerlink" href="#gozora_commented_at_2020-03-04_1156" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>See? That's what I'm saying. To notice double pipe, I'd need to read
behind first pipe :-).</p>
<p>V.</p>
<h4 id="pcahyna_commented_at_2020-03-04_1312"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594513389">2020-03-04 13:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1312" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna<br />
in general in ReaR we like to avoid the word <code>WARNING</code>, cf.<br />
<a href="https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a><br />
which originated here in ReaR at<br />
<a href="https://github.com/rear/rear/issues/564#issuecomment-86418677">#564
(comment)</a><br />
and subsequent comments there.</p>
</blockquote>
<p>I understand the reasoning behind it, but here the WARNING provides just
an explanation of the following error, so I don't think the reasoning
exactly applies.</p>
<blockquote>
<p>In<br />
<a href="https://github.com/rear/rear/issues/1193#issuecomment-452617591">#1193
(comment)</a><br />
I wrote why I don't like explicit RPM package names.</p>
</blockquote>
<p>Our patch was a downstream-specific patch to help with a Fedora and
RHEL-specific issues, so it mentions the package name exactly. If we
merge it upstream, I understand that you want to make the message more
generic according to your reasoning, but the problem is, it is now not
much less clear to the user what they should do, in my version it was
obvious.</p>
<blockquote>
<p>So better sample output could be something like</p>
<pre><code>Found no /usr/*/grub*/x86_64-efi/moddep.lst file so grub2-mkimage may fail.
ERROR: grub2-mkimage of BOOTX64.efi failed
</code></pre>
<p>or perhaps even better</p>
<pre><code>grub2-mkimage may fail (found no /usr/*/grub*/x86_64-efi/moddep.lst)
ERROR: grub2-mkimage of BOOTX64.efi failed
</code></pre>
<p>to have the most interesting part <code>grub2-mkimage may fail</code><br />
at the beginning of the line (and not as "some trailing technical
detail").</p>
</blockquote>
<p>Before #2013 was merged, the error message was:</p>
<pre><code>grub2-mkimage: error: cannot open `/usr/lib/grub/x86_64-efi/moddep.lst': No
such file or directory.
2017-02-06 01:36:32 ERROR: Error occurred during grub2-mkimage of BOOTX64.efi
</code></pre>
<p>(issue #1193). I don't see much added value in the message that you
propose relative to the original message. Is the issue just that the
original message goes only to the log, while the added message gets
printed to the terminal?</p>
<blockquote>
<p>Furthermore regarding things like <code>PrintIfError</code> in<br />
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13">https://bugzilla.redhat.com/show_bug.cgi?id=1492177#c13</a><br />
see<br />
<a href="https://github.com/rear/rear/pull/2013#discussion_r245909346">#2013
(comment)</a></p>
</blockquote>
<p>Good point, I'll keep that in mind.</p>
<h4 id="pcahyna_commented_at_2020-03-04_1319"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594517375">2020-03-04 13:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-03-04_1319" title="Permanent link">&para;</a></h4>
<p>Shouldn't there be a way to print stderr from a command in case the
command fails, in addition to just redirecting it to the log? It would
make debugging such failures much easier, without such custom tests that
we are discussing here - because often the failed command provides the
most accurate information on what went wrong.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1336"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594526151">2020-03-04 13:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1336" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
in general see "What to do with stdin, stdout, and stderr" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>I will think about how to show stderr from a command to the user<br />
plus having that same stderr from the command also in the log.<br />
My offhanded idea is to try out using the <code>tee</code> command<br />
together with some appropriate redirections<br />
e.g. something as in the section<br />
"Generic disaster recovery with the plain SUSE installation system" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<pre><code># Start logging:
my_name=${0##*/}
starting_timestamp=$( date +%Y%m%d%H%M%S )
log_file=$my_name.$starting_timestamp.log
# Have a new file descriptor 3 which is a copy of the stdout file descriptor:
exec 3&gt;&amp;1
# Have a new file descriptor 4 which is a copy of the stderr file descriptor:
exec 4&gt;&amp;2
# Have stdout on the terminal and also in the log file:
exec 1&gt; &gt;( exec -a $my_name:tee tee -a $log_file )
logging_tee_pid=$!
# Make stderr what stdout already is (i.e. terminal and also in the log file):
exec 2&gt;&amp;1
</code></pre>
<p>of course that must be done different in ReaR to work<br />
with the existing default stdout/stderr redirections in ReaR.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594544062">2020-03-04 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1408" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I think what is shown in<br />
<a href="https://github.com/rear/rear/issues/1193#issue-205881890">https://github.com/rear/rear/issues/1193#issue-205881890</a></p>
<pre><code>2017-02-06 01:36:32 Including output/ISO/Linux-i386/250_populate_efibootimg.sh
grub2-mkimage: error: cannot open `/usr/lib/grub/x86_64-efi/moddep.lst': No such file or directory.
2017-02-06 01:36:32 ERROR: Error occurred during grub2-mkimage of BOOTX64.efi
</code></pre>
<p>is from ReaR's log file and not what there is on the user's terminal<br />
(I think on the termial there are no "date time" prefixed messages).</p>
<p>My primary intent is to show the user on his terminal<br />
when there are errors instead of let things fail silently<br />
and let the user search through the log file.</p>
<p>My intent is not to show explanations and reasons<br />
or even tell what the user should do.</p>
<p>My intent is to only show the real hard facts<br />
and leave it to the user what to do because</p>
<ul>
<li>ReaR (at least in its current form) is only for experienced users
    (in particular for system admins)</li>
<li>personally I really hate it when computers tell me what I should do
    (i.e. I hate it when computers appear to behave patronizing) - a
    side-topic is that computers should not beg the user (i.e. no
    <code>please</code>) or talk to the user personally (e.g. no <code>sorry</code> and no
    <code>congratulations</code>) - just like technical documentation style that
    should not be in a personal tone (and never ever private:
    <code>when you are desperate call our friendly hotline for help</code> ;-)</li>
</ul>
<p>For example I would do</p>
<pre><code>type -a parted || Error "No parted command found ('type -a parted' failed)"
</code></pre>
<p>instead of</p>
<pre><code>type -a parted || Error "Cannot setup disk partitions ('parted' needs to be installed)"
</code></pre>
<p>because the former code works correctly in all cases<br />
while in the latter case there are zillions of possible weird reasons<br />
why the error message text is wrong (e.g. when parted is installed<br />
but for whatever awkward reasons <code>type -a parted</code> does not "find" it).<br />
Or in other words:<br />
In the latter case there are implicit hidden assumptions behind<br />
the error message text - i.e. the error message text is the result of
an<br />
imagined interpretation by the programmer who wrote the code<br />
at the time when he wrote the code that is limited by his imagination<br />
what all the possible reasons could be why <code>type -a parted</code> failed.</p>
<h4 id="jsmeix_commented_at_2020-03-04_1531"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594603776">2020-03-04 15:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1531" title="Permanent link">&para;</a></h4>
<p>Hopefully the GRUB2 modules directory part<br />
in lib/uefi-functions.sh is now fixed via<br />
<a href="https://github.com/rear/rear/commit/de9391c01e9492144d50d0c4c8b60db36f653007">https://github.com/rear/rear/commit/de9391c01e9492144d50d0c4c8b60db36f653007</a></p>
<h4 id="jsmeix_commented_at_2020-03-04_1542"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594611779">2020-03-04 15:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1542" title="Permanent link">&para;</a></h4>
<p>Hopefully the GRUB2 directories part in<br />
output/RAWDISK/Linux-i386/270_create_grub2_efi_bootloader.sh<br />
is now sufficiently fixed via<br />
<a href="https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c">https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c</a></p>
<h4 id="jsmeix_commented_at_2020-03-04_1547"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594615926">2020-03-04 15:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1547" title="Permanent link">&para;</a></h4>
<p>Hopefully the GRUB2 directories part in<br />
build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh<br />
is now sufficiently fixed via<br />
<a href="https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727">https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727</a></p>
<h4 id="jsmeix_commented_at_2020-03-04_1550"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594618777">2020-03-04 15:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1550" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
FYI see<br />
<a href="https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c">https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c</a><br />
and<br />
<a href="https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727">https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727</a><br />
what I changed in your code to hopefully fix GRUB2 directories stuff<br />
(at least for now until GRUB2 things move elsewhere again ;-)</p>
<h4 id="jsmeix_commented_at_2020-03-04_1600"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-594626227">2020-03-04 16:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-04_1600" title="Permanent link">&para;</a></h4>
<p>With my quick fixes here<br />
<a href="https://github.com/rear/rear/commit/d7729b0baba907a66ccfd976ab133964ae4effbe">https://github.com/rear/rear/commit/d7729b0baba907a66ccfd976ab133964ae4effbe</a><br />
<a href="https://github.com/rear/rear/commit/de9391c01e9492144d50d0c4c8b60db36f653007">https://github.com/rear/rear/commit/de9391c01e9492144d50d0c4c8b60db36f653007</a><br />
<a href="https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c">https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c</a><br />
<a href="https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727">https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727</a><br />
I hope the GRUB2 directories stuff is sufficiently fixed for now.</p>
<p>Of course for the future - as time permits - a more generic<br />
and more fail-safe solution would be appreciated, cf.<br />
<a href="https://github.com/rear/rear/commit/fe159d11493f447eda8a8feccf050f7f46ad4b84">https://github.com/rear/rear/commit/fe159d11493f447eda8a8feccf050f7f46ad4b84</a></p>
<p>For the fun of it regadring "as time permits":<br />
I stumbled across this mess today by accident<br />
while I was working on something totally different<br />
so I will try to do that tomorrow - as time permits ;-)</p>
<h4 id="olivero2_commented_at_2020-03-05_1611"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-595311372">2020-03-05 16:11</a>:<a class="headerlink" href="#olivero2_commented_at_2020-03-05_1611" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>FYI see<br />
<a href="https://github.com/rear/rear/commit/5c1e4f19e6cc78de6743289f82c0ae8076a1188c">5c1e4f1</a><br />
and<br />
<a href="https://github.com/rear/rear/commit/dff3f6a4c06dc7a75d5ef67ce9aa5fc978828727">dff3f6a</a><br />
what I changed in your code to hopefully fix GRUB2 directories stuff<br />
(at least for now until GRUB2 things move elsewhere again ;-)</p>
</blockquote>
<p>Thanks for keeping me posted, your changes look reasonable to me.</p>
<p>I'm a bit puzzled what happend: According to the FHS <code>/usr/share</code> is
supposed to contain architecture-independent (shared) data only.
<code>x86_64-efi</code> sounds rather architecture-dependent. What's the reasoning
in relocating that stuff in openSUSE Leap 15.1?</p>
<h4 id="jsmeix_commented_at_2020-03-06_1043"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-595710882">2020-03-06 10:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-06_1043" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
I am afraid I don't know the actual reason behind why on SUSE<br />
GRUB2 is built 'noarch' with things moved to '/usr/share'.</p>
<p>All what I know is basically<br />
<a href="https://github.com/rear/rear/issues/2338#issuecomment-594432946">https://github.com/rear/rear/issues/2338#issuecomment-594432946</a></p>
<p>See also<br />
<a href="https://build.opensuse.org/package/view_file/openSUSE:Factory/grub2/grub2.changes?expand=1">https://build.opensuse.org/package/view_file/openSUSE:Factory/grub2/grub2.changes?expand=1</a></p>
<p>I had a look at the entries of our <code>FATE#326960</code><br />
(FATE is the SUSE internal feature tracking tool)<br />
but those entries do not show a reason behind.<br />
This is because usually FATE is not used to discuss<br />
features - this happens usually by the involved parties<br />
outside of FATE - so FATE shows usually only administrative<br />
steps like who must do what until when and things like that.</p>
<p>In the end it does not matter for ReaR if such things make sense.<br />
In the end what matters is that the Relax-and-Recover code works<br />
cf. "Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a><br />
and see RFC 1925 item 1<br />
<a href="https://tools.ietf.org/html/rfc1925">https://tools.ietf.org/html/rfc1925</a></p>
<h4 id="jsmeix_commented_at_2020-03-06_1410"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-595783987">2020-03-06 14:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-03-06_1410" title="Permanent link">&para;</a></h4>
<p>I consider it sufficiently "fixed" for now via my above listed commits.</p>
<p>For the future a more generic and more fail-safe solution would be
appreciated.</p>
<h4 id="olivero2_commented_at_2020-03-06_1415"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2338#issuecomment-595786188">2020-03-06 14:15</a>:<a class="headerlink" href="#olivero2_commented_at_2020-03-06_1415" title="Permanent link">&para;</a></h4>
<p>@jsmeix Thanks for taking care of it and for looking behind the scenes!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-03-04.2338.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
