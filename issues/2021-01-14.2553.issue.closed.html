<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2553 Issue closed: Support for Recovering A Partition From The Same Partition With No External Source - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2553 Issue closed: Support for Recovering A Partition From The Same Partition With No External Source";
        var mkdocs_page_input_path = "issues/2021-01-14.2553.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">Internal Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2553 Issue closed: Support for Recovering A Partition From The Same Partition With No External Source</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2553_issue_closed_support_for_recovering_a_partition_from_the_same_partition_with_no_external_source"><a href="https://github.com/rear/rear/issues/2553">#2553 Issue</a> <code>closed</code>: Support for Recovering A Partition From The Same Partition With No External Source<a class="headerlink" href="#2553_issue_closed_support_for_recovering_a_partition_from_the_same_partition_with_no_external_source" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code>,
<code>special hardware or VM</code></p>
<h4 id="sissieadmin_opened_issue_at_2021-01-14_0452"><img src="https://avatars.githubusercontent.com/u/57243069?v=4" width="50"><a href="https://github.com/sissieadmin">sissieadmin</a> opened issue at <a href="https://github.com/rear/rear/issues/2553">2021-01-14 04:52</a>:<a class="headerlink" href="#sissieadmin_opened_issue_at_2021-01-14_0452" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version: Relax-and-Recover 2.3 Git</p>
</li>
<li>
<p>OS version: Ubuntu 18.04.05 LTS Bionic</p>
</li>
<li>
<p>Hardware: KVM Guest</p>
</li>
<li>
<p>System architecture: x86_64</p>
</li>
<li>
<p>Firmware: GRUB</p>
</li>
<li>
<p>Storage: Virtual Disk under KVM</p>
</li>
<li>
<p>Storage layout:</p>
</li>
</ul>
<!-- -->

<pre><code>vda                           30G     disk
|-vda1                        1024M   part
|-vda2                        1M      part
|_vda3                        1G      part   /boot
   |_ubuntu--vg-ubuntu--lv    20G     lvm    /
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>I expect this to be a "no" considering how ReaR tends to work, but I'm
stuck in a situation where I have no control over the network (no PXE
booting), and no ability to add a secondary partition or USB device.
This is a VPS that provides no backups or any support for snapshotting
that would normally allow me to achieve this easily.</p>
<p>But I have to come up with a way to back up and restore a full image of
a system with no extra storage, no network source like PXE, other than
the partition I am supposed to restore.</p>
<p>Is this even possible?</p>
<h4 id="gdha_commented_at_2021-01-15_1504"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2553#issuecomment-760994038">2021-01-15 15:04</a>:<a class="headerlink" href="#gdha_commented_at_2021-01-15_1504" title="Permanent link">&para;</a></h4>
<p>@sissieadmin If your cloud provider allows nothing then it becomes very
difficult. At least they should foresee some kind of snapshotting. If
nothing is possible I would start looking for another VPS provider.</p>
<h4 id="sissieadmin_commented_at_2021-01-16_0237"><img src="https://avatars.githubusercontent.com/u/57243069?v=4" width="50"><a href="https://github.com/sissieadmin">sissieadmin</a> commented at <a href="https://github.com/rear/rear/issues/2553#issuecomment-761297752">2021-01-16 02:37</a>:<a class="headerlink" href="#sissieadmin_commented_at_2021-01-16_0237" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@sissieadmin If your cloud provider allows nothing then it becomes
very difficult. At least they should foresee some kind of
snapshotting. If nothing is possible I would start looking for another
VPS provider.</p>
</blockquote>
<p>That's what I was afraid of.</p>
<p>Unfortunately this is a situation I have inherited, but I have ruled out
a couple dozen options for accomplishing what I need to do, and perhaps
this may be enough to drive a change.</p>
<h4 id="sissieadmin_commented_at_2021-01-16_0238"><img src="https://avatars.githubusercontent.com/u/57243069?v=4" width="50"><a href="https://github.com/sissieadmin">sissieadmin</a> commented at <a href="https://github.com/rear/rear/issues/2553#issuecomment-761297949">2021-01-16 02:38</a>:<a class="headerlink" href="#sissieadmin_commented_at_2021-01-16_0238" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@sissieadmin If your cloud provider allows nothing then it becomes
very difficult. At least they should foresee some kind of
snapshotting. If nothing is possible I would start looking for another
VPS provider.</p>
</blockquote>
<p>Thank you anyway. I know this is a very unusual situation, I had already
concluded that it was unlikely to be doable but needed to confirm that
the few solutions I have found are not applicable.</p>
<h4 id="jsmeix_commented_at_2021-02-23_1518"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2553#issuecomment-784276218">2021-02-23 15:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-02-23_1518" title="Permanent link">&para;</a></h4>
<p>@sissieadmin<br />
you need at least one separated whole disk where the ReaR stuff<br />
(ReaR recovery system plus the backup) can be stored<br />
and wherefrom the ReaR recovery system can be booted<br />
and wherefrom the backup can be restored.</p>
<p>You cannot do that with one the same disk via separated partitions.</p>
<p>Reason:<br />
During "rear recover" the target system disk(s) get completely<br />
recreated from scratch starting with <code>parted mklabel</code> command(s)<br />
followed by <code>parted mkpart</code> commands that completely destroy<br />
all existing partitioning information on the disk.</p>
<p>So you need at least two disks:<br />
The system's normal operating disk and a second disk for ReaR.</p>
<p>Because that second disk is usually a USB disk<br />
the matching method in ReaR is called "USB"<br />
which is set up in etc/rear/local.conf like</p>
<pre><code>OUTPUT=USB
BACKUP=NETFS
BACKUP_URL=usb:///dev/disk/by-label/REAR-000
</code></pre>
<p>as described in<br />
<a href="http://relax-and-recover.org/documentation/getting-started">http://relax-and-recover.org/documentation/getting-started</a></p>
<p>The exact same "USB" method also works with a second built-in disk.</p>
<p>So your VPS provider would have to provide you<br />
a VPS with two separated virtual disks.</p>
<p>FYI:<br />
I used ReaR on QEMU/KVM virtual machines with two virtual disks<br />
to simulate a USB disk when there are issues with ReaR's "USB" method.</p>
<h4 id="jsmeix_commented_at_2021-02-24_1320"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2553#issuecomment-785069808">2021-02-24 13:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-02-24_1320" title="Permanent link">&para;</a></h4>
<p>@sissieadmin<br />
as always sleeping over an issue helps me to better see how things
actually are.</p>
<p>In short:<br />
It is possible to use ReaR only on a single system disk with limited
functionality<br />
according to what one can reasonably expect in such a limited
environment.</p>
<p>What is possible in such a limited environment is basically only<br />
a plain restore of a backup that is stored on a separated partition<br />
on that single system disk.</p>
<p>Obviously when that single system disk gets damaged<br />
(in particular when the partition table gets damaged<br />
or when bootloader things get corrupted) all is lost.</p>
<p>But what can be recovered are so called "soft errors" in the operating
sytem<br />
like deleted or corrupted essential files - i.e. all where a plain
restore of a<br />
backup of the files helps where the restore is run from "outside" i.e.
from<br />
within the booted ReaR recovery system so that the backup restore does
not<br />
depend on some files (programs libraries whatever) of the operating
sytem.</p>
<p>I used a KVM/QEMU virtual machine with this disk layout:</p>
<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT

NAME        KNAME     PKNAME   TRAN TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           ata  disk           10G 
|-/dev/sda1 /dev/sda1 /dev/sda      part            8M 
|-/dev/sda2 /dev/sda2 /dev/sda      part ext4     3.6G /
|-/dev/sda3 /dev/sda3 /dev/sda      part ext3     5.4G /other
`-/dev/sda4 /dev/sda4 /dev/sda      part swap     1.1G [SWAP]
</code></pre>
<p>Intentionally I did not use the complicated openSUSE btrfs structure,<br />
cf. "btrfs" in
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I used current ReaR upstream GitHub master code as described in<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>You use ReaR version 2.3 which is too old for that<br />
because the new "mountonly" workflow is nice to have here.<br />
You could mount things manually and then things could<br />
also work with ReaR 2.3 but I did not (and will not) test that.</p>
<p>I use this etc/rear/local.conf</p>
<pre><code>localhost:~/rear.github.master # grep -v '^#' etc/rear/local.conf

OUTPUT=ISO
OUTPUT_URL=null
BACKUP=NETFS
BACKUP_URL=file:///other/rear
SSH_ROOT_PASSWORD='rear'
USE_DHCLIENT="yes"
PROGRESS_MODE="plain"
PROGRESS_WAIT_SECONDS="3"
FIRMWARE_FILES=( 'no' )
MODULES=( 'loaded_modules' )
GRUB_RESCUE=y
</code></pre>
<p>I use <code>FIRMWARE_FILES=( 'no' )</code> and <code>MODULES=( 'loaded_modules' )</code><br />
to get a small ReaR recovery system and I don't need more for<br />
recovery on the exact same (virtual) machine.</p>
<p>The crucial part is <code>GRUB_RESCUE=y</code><br />
see usr/share/rear/conf/default.conf what it does (excerpt)</p>
<pre><code>Note that GRUB_RESCUE is the only functionality
where "rear mkbackup" or "rear mkrescue"
changes the currently running system.
It changes the currently running system even
in a critical way because it changes the bootloader
of the currently running system.
The main reason for the GRUB_RESCUE functionality
is to be quickly able to recover a system from soft errors
(like deleting all of /lib/)
</code></pre>
<p>After <code>mkdir /other/rear</code> I did</p>
<pre><code>localhost:~/rear.github.master # usr/sbin/rear -D mkbackup

Relax-and-Recover 2.6 / Git
Running rear mkbackup (PID 7882 date 2021-02-24 13:46:20)
Using log file: /root/rear.github.master/var/log/rear/rear-localhost.log
Running workflow mkbackup on the normal/original system
Using backup archive '/other/rear/localhost/backup.tar.gz'
Using '/usr/bin/mkisofs' to create ISO filesystem images
Adding backup directory mountpoint 'fs:/other' to EXCLUDE_RECREATE
Using autodetected kernel '/boot/vmlinuz-5.3.18-46-default' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Excluding component fs:/other in EXCLUDE_RECREATE
Marking component 'fs:/other' as done in /root/rear.github.master/var/lib/rear/layout/disktodo.conf
Disabling excluded components in /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Disabling component 'fs ... /other' in /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Using sysconfig bootloader 'grub2'
Verifying that the entries in /root/rear.github.master/var/lib/rear/layout/disklayout.conf are correct
Created disk layout (check the results in /root/rear.github.master/var/lib/rear/layout/disklayout.conf)
Creating recovery system root filesystem skeleton layout
Handling network interface 'eth0'
eth0 is a physical device
Handled network interface 'eth0'
Included current keyboard mapping (via 'dumpkeys -f')
Included default US keyboard mapping /usr/share/kbd/keymaps/legacy/i386/qwerty/defkeymap.map.gz
Included other keyboard mappings in /usr/share/kbd/keymaps
Copying logfile /root/rear.github.master/var/log/rear/rear-localhost.log into initramfs as '/tmp/rear-localhost-partial-2021-02-24T13:46:24+01:00.log'
Copying files and directories
Copying binaries and libraries
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules')
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/resolv.conf' target '/run/netconfig/resolv.conf' on /proc/ /sys/ /dev/ or /run/
Skip copying broken symlink '/etc/mtab' target '/proc/19035/mounts' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.Mg6xH5guyYRQS8M/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (60288965 bytes) in 11 seconds
Making ISO image
Wrote ISO image: /root/rear.github.master/var/lib/rear/output/rear-localhost.iso (69M)
Setting up GRUB_RESCUE: Adding Relax-and-Recover rescue system to the local GRUB 2 configuration.
Finished GRUB_RESCUE setup: Added 'Relax-and-Recover' GRUB 2 menu entry.
Making backup (using backup method NETFS)
Creating tar archive '/other/rear/localhost/backup.tar.gz'
Preparing archive operation
Archived 39 MiB [avg 10152 KiB/sec] 
...
Archived 1034 MiB [avg 4271 KiB/sec] 
OK
WARNING: tar ended with return code 1 and below output (last 5 lines):
  ---snip---
  tar: /sys: file changed as we read it
  ----------
This means that files have been modified during the archiving
process. As a result the backup may not be completely consistent
or may not be a perfect copy of the system. Relax-and-Recover
will continue, however it is highly advisable to verify the
backup in order to be sure to safely recover this system.

Archived 1034 MiB in 251 seconds [avg 4220 KiB/sec]
Exiting rear mkbackup (PID 7882) and its descendant processes ...
Running exit tasks
You should also rm -Rf /tmp/rear.Mg6xH5guyYRQS8M
</code></pre>
<p>Now making a "soft error":</p>
<pre><code>localhost:~/rear.github.master # rm -r /lib*

localhost:~/rear.github.master # ls
-bash: /usr/bin/ls: No such file or directory

localhost:~/rear.github.master # cat /etc/fstab
-bash: /usr/bin/cat: No such file or directory

localhost:~/rear.github.master # reboot
-bash: /sbin/reboot: No such file or directory
</code></pre>
<p>pretty broken system so recovery is needed.</p>
<p>Rebooting the system via hard power off<br />
shows the new GRUB boot menue entry:</p>
<pre><code>Relax-and-Recover
</code></pre>
<p>This boots the ReaR recovery system.</p>
<p>The ReaR recovery system bootloader files are in particular</p>
<pre><code>/boot/rear-initrd.cgz
/boot/rear-kernel
</code></pre>
<p>When those files get deleted or damaged<br />
the ReaR recovery system cannot be booted.</p>
<p>I logged in via ssh into the booted ReaR recovery system<br />
(one can do things also directly on the ReaR recovery system console<br />
but I prefer working from remote via my usual <code>xterm</code> terminal program).</p>
<p>In the ReaR recovery system I did:</p>
<pre><code>Welcome to Relax-and-Recover. Run "rear recover" to restore your system !

RESCUE localhost:~ # lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME        KNAME     PKNAME   TRAN TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           ata  disk           10G 
|-/dev/sda1 /dev/sda1 /dev/sda      part            8M 
|-/dev/sda2 /dev/sda2 /dev/sda      part ext4     3.6G 
|-/dev/sda3 /dev/sda3 /dev/sda      part ext3     5.4G 
`-/dev/sda4 /dev/sda4 /dev/sda      part swap     1.1G

RESCUE localhost:~ # mkdir /other
RESCUE localhost:~ # mount /dev/sda3 /other
RESCUE localhost:~ # find /other
/other
/other/lost+found
/other/rear
/other/rear/localhost
/other/rear/localhost/backup.log
/other/rear/localhost/backup.tar.gz

RESCUE localhost:~ # rear -h
...
List of commands:
 recover         recover the system
 restoreonly     only restore the backup
 mountonly       use ReaR as live media to mount and repair the system
 ...

RESCUE localhost:~ # rear -D mountonly
Relax-and-Recover 2.6 / Git
Running rear mountonly (PID 789 date 2021-02-24 14:08:31)
Using log file: /var/log/rear/rear-localhost.log
Running workflow mountonly within the ReaR rescue/recovery system
Comparing disks
Device sda has expected (same) size 10737418240 bytes (will be used for 'mountonly')
Disk configuration looks identical
UserInput -I DISK_LAYOUT_PROCEED_RECOVERY needed in /usr/share/rear/layout/prep-for-mount/default/250_compare_disks.sh line 148
Proceed with 'mountonly' (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)

UserInput: No real user input (empty or only spaces) - using default input
UserInput: No choices - result is 'yes'
User confirmed to proceed with 'mountonly'
Marking component '/dev/sda' as done in /var/lib/rear/layout/disktodo.conf
Marking component '/dev/sda1' as done in /var/lib/rear/layout/disktodo.conf
Marking component '/dev/sda2' as done in /var/lib/rear/layout/disktodo.conf
Marking component '/dev/sda3' as done in /var/lib/rear/layout/disktodo.conf
Marking component '/dev/sda4' as done in /var/lib/rear/layout/disktodo.conf
Marking component 'fs:/' as done in /var/lib/rear/layout/disktodo.conf
Marking component 'swap:/dev/sda4' as done in /var/lib/rear/layout/disktodo.conf
Start target system mount.
Mounting filesystem /
Disk layout processed.
Finished 'mountonly'. The target system is mounted at '/mnt/local'.
Exiting rear mountonly (PID 789) and its descendant processes ...
Running exit tasks
You should also rm -Rf /tmp/rear.4bBQ4Pgj0Yrb79k

# lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME        KNAME     PKNAME   TRAN TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           ata  disk           10G 
|-/dev/sda1 /dev/sda1 /dev/sda      part            8M 
|-/dev/sda2 /dev/sda2 /dev/sda      part ext4     3.6G /mnt/local
|-/dev/sda3 /dev/sda3 /dev/sda      part ext3     5.4G /other
`-/dev/sda4 /dev/sda4 /dev/sda      part swap     1.1G

RESCUE localhost:~ # rear -D restoreonly
Relax-and-Recover 2.6 / Git
Running rear restoreonly (PID 1991 date 2021-02-24 14:10:00)
Using log file: /var/log/rear/rear-localhost.1991.log
Running workflow restoreonly within the ReaR rescue/recovery system
Using backup archive '/other/rear/localhost/backup.tar.gz'
Calculating backup archive size
Backup archive size is 1.1G     /other/rear/localhost/backup.tar.gz (compressed)
Restoring from '/other/rear/localhost/backup.tar.gz' (restore log in /var/lib/rear/restore/restoreonly.backup.tar.gz.1991.restore.log) ...
Backup restore program 'tar' started in subshell (PID=2665)
Restored 160 MiB [avg. 54699 KiB/sec] 
...
Restored 2580 MiB [avg. 23592 KiB/sec] 
OK
Restored 2606 MiB in 115 seconds [avg. 23211 KiB/sec]
Restoring finished (verify backup restore log messages in /var/lib/rear/restore/restoreonly.backup.tar.gz.1991.restore.log)
Created SELinux /mnt/local/.autorelabel file : after reboot SELinux will relabel all files
Recreating directories (with permissions) from /var/lib/rear/recovery/directories_permissions_owner_group
Finished 'restoreonly'. The target system is mounted at '/mnt/local'.
Saving /var/log/rear/rear-localhost.1991.log as /var/log/rear/rear-localhost.log
Exiting rear restoreonly (PID 1991) and its descendant processes ...
Running exit tasks
You should also rm -Rf /tmp/rear.bUKCW0XuvmAx9rD

RESCUE localhost:~ # chroot /mnt/local

localhost:/ # ls
.autorelabel  bin  boot  dev  etc  home  lib  lib64  lost+found  mnt  opt  other  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var

localhost:/ # cat /etc/fstab
UUID=980f784c-d80f-49c4-9f05-1fd06058057b  /       ext4  defaults      0  1
UUID=c4468e8c-99df-4a9b-868b-f19ef9a6d59d  /other  ext3  data=ordered  0  2
UUID=e7ba193b-b702-4250-8b39-c6c1c9d1ccd1  swap    swap  defaults      0  0

localhost:/ # exit
exit

RESCUE localhost:~ # reboot
umounting all filesystems
...
syncing disks... waiting 3 seconds before reboot
</code></pre>
<p>The rebooted restored system works again normally<br />
(at least for me in my quick above test).</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-01-14.2553.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
