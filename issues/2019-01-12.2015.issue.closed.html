<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2015 Issue closed: No DNS Lookups possible in rescue system when systemd-resolved is used - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2015 Issue closed: No DNS Lookups possible in rescue system when systemd-resolved is used";
        var mkdocs_page_input_path = "issues/2019-01-12.2015.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2015 Issue closed: No DNS Lookups possible in rescue system when systemd-resolved is used</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2015_issue_closed_no_dns_lookups_possible_in_rescue_system_when_systemd-resolved_is_used"><a href="https://github.com/rear/rear/issues/2015">#2015 Issue</a> <code>closed</code>: No DNS Lookups possible in rescue system when systemd-resolved is used<a class="headerlink" href="#2015_issue_closed_no_dns_lookups_possible_in_rescue_system_when_systemd-resolved_is_used" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="nniehoff_opened_issue_at_2019-01-12_1813"><img src="https://avatars.githubusercontent.com/u/14947575?v=4" width="50"><a href="https://github.com/nniehoff">nniehoff</a> opened issue at <a href="https://github.com/rear/rear/issues/2015">2019-01-12 18:13</a>:<a class="headerlink" href="#nniehoff_opened_issue_at_2019-01-12_1813" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): 2.4 / 2018-06-21</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"): Ubuntu 18.04</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"): NA</p>
</li>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR): KVM guest</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): amd64</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): NA</p>
</li>
<li>
<p>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): local disk</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):
    Ubuntu 18.04 uses systemd-resolved for DNS resolution therefore the
    entry in /etc/resolv.conf is 127.0.0.53. When the rescue media is
    created this fails to resolve DNS and therefore also fails to
    resolve hostnames for remote backups. Current DNS servers can be
    retrieved by <code>systemd-resolve --status</code>, there are probably other
    methods to get DNS.</p>
</li>
<li>
<p>Workaround, if any: after booting into recovery media set DNS
    servers by hand</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2019-01-14_1158"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-453981364">2019-01-14 11:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-14_1158" title="Permanent link">&para;</a></h4>
<p>I do not use systemd-resolved and I don't know<br />
whether or not there is specific support needed for it in ReaR.</p>
<p>I simply use <code>USE_DHCLIENT="yes"</code> because I have a DHCP server<br />
in my network so that this alone is sufficient in my use case to get<br />
networking set up in the ReaR recovery system.</p>
<p>@nniehoff<br />
if you do not have a DHCP server in your network<br />
you may use NETWORKING_PREPARATION_COMMANDS<br />
to specify the needed commands to set up networking<br />
in the ReaR recovery system, see its description in<br />
default.conf e.g. online at<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/default.conf">https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/default.conf</a></p>
<p>Because you did not provide us your ReaR configuration files<br />
(why did you decide your ReaR configuration is not needed?)<br />
I don't know why you need networking in the ReaR recovery system.<br />
Usually networking in the ReaR recovery system is only needed<br />
to access the backup on a remote location to be able to restore it<br />
so that usually you only need a minimal networking setup<br />
that is sufficient to get the backup from another host.<br />
E.g. when you specify the IP address as in</p>
<pre><code>BACKUP_URL=nfs://your.NFS.server.IP/path/to/your/rear/backup
</code></pre>
<p>no DNS is needed to access the backup on the NFS server, cf.<br />
<a href="https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/examples/SLE11-ext3-example.conf">https://raw.githubusercontent.com/rear/rear/master/usr/share/rear/conf/examples/SLE11-ext3-example.conf</a></p>
<p>If you must use systemd-resolved to set up networking<br />
in the ReaR recovery system check first of all that all needed<br />
files to run systemd-resolved within the ReaR recovery system<br />
are included in the ReaR recovery system. You may use<br />
<code>KEEP_BUILD_DIR="yes"</code> (see its description in default.conf)<br />
to check more easily what is included in the ReaR recovery system.<br />
Then boot the ReaR recovery system and try to manually launch<br />
systemd-resolved from within the ReaR recovery system<br />
if it is not already somehow magically running.</p>
<h4 id="nniehoff_commented_at_2019-01-14_1351"><img src="https://avatars.githubusercontent.com/u/14947575?v=4" width="50"><a href="https://github.com/nniehoff">nniehoff</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454011192">2019-01-14 13:51</a>:<a class="headerlink" href="#nniehoff_commented_at_2019-01-14_1351" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Sorry I didn't leave my config:</p>
<pre><code>OUTPUT=RAWDISK
OUTPUT_URL=nfs://fs1.somedomain.com/volume1/rear
BACKUP=BORG

BORGBACKUP_HOST="freenas.somedomain.com"
BORGBACKUP_USERNAME="backup.svc"
BORGBACKUP_REPO="/mnt/data/backups/borg/$(hostname -s)"
BORGBACKUP_REMOTE_PATH="/usr/local/bin/borg"

BORGBACKUP_PRUNE_DAILY=7
BORGBACKUP_PRUNE_WEEKLY=4
BORGBACKUP_PRUNE_MONTHLY=6
BORGBACKUP_PRUNE_YEARLY=2

BORGBACKUP_COMPRESSION="lzma,9"     # Slowest backup, best compression

BORGBACKUP_ENC_TYPE="keyfile"
export BORG_PASSPHRASE="XXXXX"
COPY_AS_IS_BORG=( "/root/.config/borg/keys/" )

export BORG_RELOCATED_REPO_ACCESS_IS_OK="yes"
</code></pre>
<p>I will look into using the NETWORKING_PREPARATION_COMMANDS to see if I
can come up with a workaround. You are correct a potential workaround
would be to use an IP however, I typically avoid using IPs as DNS is
usually a better practice (an argument could be made in a disaster
recovery situation it may not be a good idea to rely on DNS either).</p>
<p>I reported this bug as the default in Ubuntu Bionic (18.04) and later is
to use systemd-resolved.</p>
<h4 id="gdha_commented_at_2019-01-14_1706"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454082087">2019-01-14 17:06</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-14_1706" title="Permanent link">&para;</a></h4>
<pre><code># cat /lib/systemd/resolv.conf 
# This file belongs to man:systemd-resolved(8). Do not edit.
#
# This is a static resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists no search
# domains.
#
# Run "systemd-resolve --status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs must not access this file directly, but only through the
# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
# replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
</code></pre>
<p>If I understand it well - if the <code>/etc/resolv.conf</code> symlink is replaced
with a real file then DNS lookup should work as well. Could you try this
as it would make it easier for us then supported yet another systemd
sub-service</p>
<h4 id="jsmeix_commented_at_2019-01-15_0854"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454313695">2019-01-15 08:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-15_0854" title="Permanent link">&para;</a></h4>
<p>@nniehoff<br />
I forgot to say that I am not a Ubuntu user (I am from SUSE)<br />
and in openSUSE Leap we do not use systemd-resolved<br />
and I have no personal experience with systemd-resolved<br />
so that I cannot provide informed help in this area.</p>
<p>I guess an alternative (untested) workaround could be<br />
to provide an <code>/etc/hosts</code> entry for your NFS server name<br />
e.g. via something like</p>
<pre><code>NETWORKING_PREPARATION_COMMANDS=( "echo 'NFS.server.IP.address fs1.somedomain.com' &gt;&gt;/etc/hosts" )
</code></pre>
<p>or via</p>
<pre><code>PRE_RECOVERY_SCRIPT="echo 'NFS.server.IP.address fs1.somedomain.com' &gt;&gt;/etc/hosts"
</code></pre>
<p>(see default.conf for PRE_RECOVERY_SCRIPT).<br />
This changes only the <code>/etc/hosts</code> file in the ReaR recovery system.<br />
Your actual system gets its <code>/etc/hosts</code> file restored from your backup.</p>
<h4 id="jsmeix_commented_at_2019-01-15_0921"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454321918">2019-01-15 09:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-15_0921" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
this is an issue about ReaR and systemd-resolved in Ubuntu.</p>
<p>As far as I know you use ReaR on Ubuntu<br />
and according to your code in<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L10">https://github.com/rear/rear/blob/master/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L10</a></p>
<pre><code>COPY_AS_IS_EXCLUDE+=( /lib/systemd/systemd-{cryptsetup,logind,networkd*,resolved} )
</code></pre>
<p>it seems you may have even used ReaR on Ubuntu with systemd-resolved<br />
(because you excluded systemd-resolved in case of OPALPBA).</p>
<p>My question is now if you could provide us information<br />
if and how ReaR works on Ubuntu with systemd-resolved?</p>
<h4 id="olivero2_commented_at_2019-01-15_1051"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454349979">2019-01-15 10:51</a>:<a class="headerlink" href="#olivero2_commented_at_2019-01-15_1051" title="Permanent link">&para;</a></h4>
<p>It is true, I am using Ubuntu, 16.04, 18.04 and 18.10. Unfortunately, I
have not yet tested the 18.x versions with ReaR yet. But this is
scheduled to change soon (in a matter of weeks).</p>
<p>What I can say is that Ubuntu 16.04.x DNS clients actually run
systemd-resolved.service (with <code>/etc/resolv.conf</code> being a symlink to
<code>../run/resolvconf/resolv.conf</code>). However, that does not mean
systemd-resolved is actually used for DNS lookups (see below). On 16.04,
everything always worked out of the box on the original system, on the
rescue system and on ReaR-recovered systems. At some point (not
ReaR-related) I had issues with unwanted DNS client caching, which I was
unable to resolve, because I found the DNS client documentation on
Ubuntu really lacking. I did not invest enough time to find out which
DNS client service is actually used on 16.04.</p>
<p>Now this issue is about 18.04, and from what I've found in <a href="https://www.techrepublic.com/article/how-to-set-dns-nameservers-in-ubuntu-server-18-04/">this
article</a>
everything changes with that version. The old configuration files are
still around (huh!) but the relevant stuff seems to sit in
<code>/etc/netplan</code>. Maybe that helps. If not, I might have more information
in the weeks to come.</p>
<h4 id="jsmeix_commented_at_2019-01-15_1517"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454428452">2019-01-15 15:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-15_1517" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
thank you for this valuable information!</p>
<p>It seems that thingy is so red hot exciting new<br />
that Wikipedia does not yet know about it<br />
but Wikipedia knows at least about<br />
<a href="https://en.wikipedia.org/wiki/Rantanplan">https://en.wikipedia.org/wiki/Rantanplan</a><br />
;-)</p>
<p>For more info about it see<br />
<a href="https://netplan.io/">https://netplan.io/</a><br />
and<br />
<a href="https://github.com/CanonicalLtd/netplan">https://github.com/CanonicalLtd/netplan</a></p>
<h4 id="schlomo_commented_at_2019-01-15_2050"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454545981">2019-01-15 20:50</a>:<a class="headerlink" href="#schlomo_commented_at_2019-01-15_2050" title="Permanent link">&para;</a></h4>
<p>@OliverO2 thanks for pointing out this fundamental change. I guess
somebody will have to provide or sponsor some coding to support Ubuntu
18.04 properly.</p>
<h4 id="jsmeix_commented_at_2019-01-16_1143"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454749972">2019-01-16 11:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-16_1143" title="Permanent link">&para;</a></h4>
<p>Offhandedly (without any look at the DNS related code in ReaR):</p>
<p>I think we do not need to replicate in the ReaR recovery system<br />
whatever complicated DNS setup there is on the original system.</p>
<p>I think in the ReaR recovery system a plain traditional<br />
<code>/etc/resolv.conf</code> file with real content should be sufficient.</p>
<p>As far as I see (at least on my openSUSE Leap 15.0 system)<br />
the <code>/etc/resolv.conf</code> in the ReaR recovery system is an exact<br />
copy of the <code>/etc/resolv.conf</code> on the original system:</p>
<pre><code># md5sum /tmp/rear.NqjFe7FOfLJuJ6O/rootfs/etc/resolv.conf
105142156fd4d6b0d755c2c6aa6de6c0  /tmp/rear.NqjFe7FOfLJuJ6O/rootfs/etc/resolv.conf

# md5sum /etc/resolv.conf
105142156fd4d6b0d755c2c6aa6de6c0  /etc/resolv.conf
</code></pre>
<p>Because I like it so much when the user has the final power<br />
where he can specify all what ReaR should do if needed<br />
I suggest to provide a config variable where the user can<br />
specify the nameserver(s) that should be used within the<br />
ReaR recovery system like</p>
<pre><code>USE_RESOLV_CONF=( "search my.domain" "nameserver 192.168.100.53" "nameserver 8.8.8.8" )
</code></pre>
<p>and then it results /etc/resolv.conf in the recovery system<br />
with the specified content</p>
<pre><code>search my.domain
nameserver 192.168.100.53
nameserver 8.8.8.8
</code></pre>
<h4 id="jsmeix_commented_at_2019-01-16_1335"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454780835">2019-01-16 13:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-16_1335" title="Permanent link">&para;</a></h4>
<p>@nniehoff<br />
you wrote that your workaround is:<br />
<code>after booting into recovery media set DNS servers by hand</code></p>
<p>How exactly did you do it?<br />
Was it sufficient to manually enter a DNS server into<br />
the /etc/resolv.conf file in the running recovery system<br />
or did you do something more and/or something different?</p>
<h4 id="nniehoff_commented_at_2019-01-16_1348"><img src="https://avatars.githubusercontent.com/u/14947575?v=4" width="50"><a href="https://github.com/nniehoff">nniehoff</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454784557">2019-01-16 13:48</a>:<a class="headerlink" href="#nniehoff_commented_at_2019-01-16_1348" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Yes, adding a nameserver to /etc/resolv.conf in the recovery system
worked.</p>
<h4 id="jsmeix_commented_at_2019-01-16_1359"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454788052">2019-01-16 13:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-16_1359" title="Permanent link">&para;</a></h4>
<p>Interestingly that Ubuntu way of DNS setup<br />
had hit us already several times in the past, cf.<br />
<a href="https://github.com/rear/rear/issues/520">https://github.com/rear/rear/issues/520</a><br />
<a href="https://github.com/rear/rear/issues/1200">https://github.com/rear/rear/issues/1200</a><br />
<a href="https://github.com/rear/rear/commit/5390105de046ef4cf861265c10955d803999e008">https://github.com/rear/rear/commit/5390105de046ef4cf861265c10955d803999e008</a></p>
<p>I guess I can further enhance
build/GNU/Linux/630_verify_resolv_conf_file.sh<br />
to make ReaR behave more clearly for the user on Ubuntu<br />
(note that I carefully avoided to write about a "fix for Ubuntu" ;-)<br />
...</p>
<h4 id="gdha_commented_at_2019-01-16_1400"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454788446">2019-01-16 14:00</a>:<a class="headerlink" href="#gdha_commented_at_2019-01-16_1400" title="Permanent link">&para;</a></h4>
<p>@jsmeix from text in
<a href="https://github.com/rear/rear/issues/2015#issuecomment-454082087">https://github.com/rear/rear/issues/2015#issuecomment-454082087</a>
I believe a resolv.conf file is available (albeit via a symlink). Would
it not be enough to detect this and make sure we copy the real file (and
not just the symlink). I believe we already have such code in place?</p>
<h4 id="jsmeix_commented_at_2019-01-16_1552"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454829795">2019-01-16 15:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-16_1552" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
it is not sufficient to copy the content of the the real file because it
seems<br />
on Ubuntu 18.x versions /etc/resol.conf is linked to
/lib/systemd/resolv.conf<br />
where its actual content is only the following single line</p>
<pre><code>nameserver 127.0.0.53
</code></pre>
<p>as far as I understand your<br />
<a href="https://github.com/rear/rear/issues/2015#issuecomment-454082087">https://github.com/rear/rear/issues/2015#issuecomment-454082087</a></p>
<p>But a loopback IP address for the DNS nameserver cannot work within<br />
the recovery system because there is no DNS server listening at
127.0.0.53<br />
because systemd-resolved is not running within the recovery system.</p>
<p>Accordingly I did<br />
<a href="https://github.com/rear/rear/pull/2018">https://github.com/rear/rear/pull/2018</a><br />
which works fine for me on my openSUSE Leap 15.0 system<br />
but testing on Ubuntu systems is needed.</p>
<h4 id="jsmeix_commented_at_2019-01-16_1557"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-454831893">2019-01-16 15:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-16_1557" title="Permanent link">&para;</a></h4>
<p>@nniehoff @OliverO2<br />
I would very much appreciate it if you could test on your Ubuntu
systems<br />
how my enhanced
usr/share/rear/build/GNU/Linux/630_verify_resolv_conf_file.sh<br />
actually works on your particular Ubuntu systems.</p>
<p>To test it copy my new one e.g. from</p>
<p><a href="https://raw.githubusercontent.com/rear/rear/f7120cea293ba7712be7560ad38cb6f25f79fb3e/usr/share/rear/build/GNU/Linux/630_verify_resolv_conf_file.sh">https://raw.githubusercontent.com/rear/rear/f7120cea293ba7712be7560ad38cb6f25f79fb3e/usr/share/rear/build/GNU/Linux/630_verify_resolv_conf_file.sh</a></p>
<p>onto your
usr/share/rear/build/GNU/Linux/630_verify_resolv_conf_file.sh</p>
<h4 id="jsmeix_commented_at_2019-01-21_1232"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-456058659">2019-01-21 12:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-01-21_1232" title="Permanent link">&para;</a></h4>
<p>No news is good news so that I merged
<a href="https://github.com/rear/rear/pull/2018">https://github.com/rear/rear/pull/2018</a></p>
<p>By default /etc/resolv.conf in the recovery system is a copy<br />
of /etc/resolv.conf (or its symlink target) on the original system.<br />
It cannot work when /etc/resolv.conf contains only loopback IP
addresses<br />
(which happens when the stub resolver systemd-resolved is used)<br />
or when there is no nameserver entry so that "rear mkrescue/mkbackup"<br />
errors out in this case with an error message like</p>
<pre><code>No nameserver or only loopback addresses in
/tmp/rear.8OotHqKXNrolR0K/rootfs/etc/resolv.conf,
specify a real nameserver via USE_RESOLV_CONF
</code></pre>
<p>For non-default cases the user must specify what he wants via the<br />
new USE_RESOLV_CONF variable that is described in default.conf.</p>
<p>Adding support in ReaR when systemd-resolved is used needs<br />
code contribution from ReaR users who use systemd-resolved.</p>
<h4 id="olivero2_commented_at_2019-01-22_1541"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-456446200">2019-01-22 15:41</a>:<a class="headerlink" href="#olivero2_commented_at_2019-01-22_1541" title="Permanent link">&para;</a></h4>
<blockquote>
<p>No news is good news</p>
</blockquote>
<p>Not necessarily. ;)</p>
<p>I'll test it anyway on Ubuntu 18.04 once I'll be using ReaR on that
version. As I've said, in a matter of weeks. If any issues come up, I'll
report, of course.</p>
<h4 id="olivero2_commented_at_2019-03-08_1207"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-470906958">2019-03-08 12:07</a>:<a class="headerlink" href="#olivero2_commented_at_2019-03-08_1207" title="Permanent link">&para;</a></h4>
<p>For initial test results, see
<a href="https://github.com/rear/rear/pull/2018#issuecomment-470906450">https://github.com/rear/rear/pull/2018#issuecomment-470906450</a>.</p>
<h4 id="jsmeix_commented_at_2019-03-11_1526"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2015#issuecomment-471586472">2019-03-11 15:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-03-11_1526" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2076">https://github.com/rear/rear/pull/2076</a>
merged<br />
build/GNU/Linux/630_verify_resolv_conf_file.sh does no longer error
out<br />
when etc/resolv.conf has no nameserver or only loopback addresses<br />
and USE_DHCLIENT is true (and USE_STATIC_NETWORKING is not true)<br />
because then etc/resolv.conf in the recovery system is generated anew<br />
by /bin/dhclient-script so that its content before does not matter.</p>
<p>This way it should in particular no longer falsely error out on
systems<br />
that use systemd-resolved (like Ubuntu 18.04) and do their networking<br />
setup via DHCP (probably pretty standard on usual desktop systems),<br />
cf.
<a href="https://github.com/rear/rear/pull/2018#issuecomment-470906450">https://github.com/rear/rear/pull/2018#issuecomment-470906450</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-01-12.2015.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
