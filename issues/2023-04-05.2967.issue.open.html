<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2967 Issue open: Confidential values leaked into log file in debug mode - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2967 Issue open: Confidential values leaked into log file in debug mode";
        var mkdocs_page_input_path = "issues/2023-04-05.2967.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2967 Issue open: Confidential values leaked into log file in debug mode</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2967_issue_open_confidential_values_leaked_into_log_file_in_debug_mode"><a href="https://github.com/rear/rear/issues/2967">#2967 Issue</a> <code>open</code>: Confidential values leaked into log file in debug mode<a class="headerlink" href="#2967_issue_open_confidential_values_leaked_into_log_file_in_debug_mode" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>,
<code>critical / security / legal</code></p>
<h4 id="jsmeix_opened_issue_at_2023-04-05_0943"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2967">2023-04-05 09:43</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2023-04-05_0943" title="Permanent link">&para;</a></h4>
<ul>
<li>ReaR version ("/usr/sbin/rear -V"):</li>
</ul>
<p>current GitHub master code</p>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<p>excerpt:</p>
<pre><code>SSH_ROOT_PASSWORD="rear"

BACKUP_PROG_CRYPT_ENABLED="yes"
{ BACKUP_PROG_CRYPT_KEY='my_secret_passphrase' ; } 2&gt;/dev/null
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>Since<br />
<a href="https://github.com/rear/rear/commit/b83059a72d2ea8735719cf415c6cafd5f43312f0">https://github.com/rear/rear/commit/b83059a72d2ea8735719cf415c6cafd5f43312f0</a><br />
there is - by the way - a new<br />
init/default/998_dump_variables.sh<br />
which is unrelated to what the commit message describes.</p>
<p>The new script does currently only</p>
<pre><code>Debug "Runtime Configuration:$LF$(declare -p)"
</code></pre>
<p>which outputs in debug modes also confidential<br />
variable values into the ReaR log file like</p>
<pre><code># usr/sbin/rear -d help
Running 'init' stage ======================
Running workflow help on the normal/original system
...

# egrep -i 'password|key' var/log/rear/rear-linux-h9wr.log.lockless
...
declare -- BACKUP_PROG_CRYPT_KEY="my_secret_passphrase"
declare -- GALAXY11_PASSWORD=""
declare -- OPAL_PBA_DEBUG_PASSWORD=""
declare -- SSH_ROOT_PASSWORD="rear"
declare -- TTY_ROOT_PASSWORD=""
declare -- YUM_ROOT_PASSWORD="root"
declare -- ZYPPER_ROOT_PASSWORD="root"
</code></pre>
<p>In particular BACKUP_PROG_CRYPT_KEY is critical<br />
because that new script foils my security/privacy<br />
code enhancements that I did for BACKUP_PROG_CRYPT_KEY<br />
see
<a href="https://github.com/rear/rear/issues/2155">https://github.com/rear/rear/issues/2155</a><br />
and
<a href="https://github.com/rear/rear/pull/2156">https://github.com/rear/rear/pull/2156</a></p>
<h4 id="jsmeix_commented_at_2023-04-05_1018"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1497251105">2023-04-05 10:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-05_1018" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/commit/95f30827c3b51992c9b41aef9b3cf718c82eb58c">https://github.com/rear/rear/commit/95f30827c3b51992c9b41aef9b3cf718c82eb58c</a><br />
is a quick initial attempt to mitigate this issue.</p>
<h4 id="schlomo_commented_at_2023-04-05_1201"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1497372237">2023-04-05 12:01</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-05_1201" title="Permanent link">&para;</a></h4>
<p>I have two conflicting thoughts about this:</p>
<ol>
<li>in debug mode we should dump all variables and also give a hint that
    the dump can contain secrets - this helps with debugging</li>
<li>in debug mode we should mask/hide secrets (as your suggestion does)
    and give a hint that secrets are skipped - and debug mode won't help
    with secrets related problems</li>
</ol>
<p>Personally, I'd prefer option 1) (full dump) and expect users to check
the output they send us. We could also add another warning to our GitHub
issue template to remind users to scrape secrets from the debug log, if
they set any.</p>
<p>For reference, other tools like for example the <code>aws</code> CLI also dump all
secrets in debug mode and expect the user to be circumspect.</p>
<p>@rear/contributors other opinions?</p>
<h4 id="jsmeix_commented_at_2023-04-05_1209"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1497382823">2023-04-05 12:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-05_1209" title="Permanent link">&para;</a></h4>
<ol>
<li></li>
</ol>
<p>maintain a list of variables that contain confidential values<br />
(e.g. a new array in default.conf that contains such variable names)<br />
and hide/skip/suppress the values of those variables in the output<br />
(we at ReaR usptream should never need secret values from a user<br />
to debug an issue).</p>
<h4 id="jsmeix_commented_at_2023-04-06_0742"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1498627825">2023-04-06 07:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-06_0742" title="Permanent link">&para;</a></h4>
<p>Sleeping on it made it even more critical at least for me:</p>
<p>Now I have legal liability worries about it, at least<br />
as far as I understand general principles of German law:</p>
<p>I think in general when someone does something<br />
one has generally some reasonable amount of<br />
legal liability for what one does.</p>
<p>I think in particular when making software this means<br />
that one's program must not knowingly do something bad<br />
except the user had explicity requested to do it.</p>
<p>In this case init/default/998_dump_variables.sh<br />
leaks user's confidential values into the log file<br />
without the user's explicit request to do exactly this.<br />
Running a program in debug mode is no explicit request<br />
to get (arbitrary) confidential values shown.</p>
<p>Furthermore - and this is the crucial point for me<br />
why I have now legal liability worries:<br />
It is now know to all of us ReaR upstream developers<br />
that init/default/998_dump_variables.sh<br />
does bad things for the user without explicit request.</p>
<p>I think - at least as far as I understand general principles<br />
of German law - when one knows about something bad,<br />
then one becomes to some reasonable extent responsible<br />
to (try to) do something against that bad<br />
as far as possible within reason.</p>
<h4 id="jsmeix_commented_at_2023-04-06_0754"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1498640284">2023-04-06 07:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-06_0754" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/commit/65f0ad5729ce32eff0d07f4da44e93504a46d277">https://github.com/rear/rear/commit/65f0ad5729ce32eff0d07f4da44e93504a46d277</a><br />
I feel better now (so I can have a relaxed Easter public holiday)<br />
because now I did something against that (possibly) bad<br />
as far as possible for me right now within reason.</p>
<h4 id="jsmeix_commented_at_2023-04-06_0800"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1498648025">2023-04-06 08:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-06_0800" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
I think there is no longer urgency / time pressure here<br />
so we can take our time to develop step by step<br />
how to solve the generic problem properly.</p>
<p>The generic problem is that debug information may in general<br />
reveal data that is confidential for the user, not only<br />
obviously confidential data like secrets (e.g. passwords or keys)<br />
but also non-obvious confidential data that could be misused<br />
by others e.g. for spear phishing attacks or things like that.</p>
<h4 id="schlomo_commented_at_2023-04-09_0650"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1501056549">2023-04-09 06:50</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-09_0650" title="Permanent link">&para;</a></h4>
<p>@jsmeix I strongly disagree with this approach.</p>
<p>At some level ReaR debugging must be "complete", that is normal for
every software. <code>DEBUGSCRIPTS</code> is actually our "strongest" debug mode so
for me this is where full variable disclosure belongs. I'm happy to add
extra warnings to it and also to the help message or manpage, but in the
end full debug-level variable disclosure must be possible.</p>
<p>In any case, we won't be able to find a 100% "safe" solution here, as
users can add additional variables with potential secrets.</p>
<p>About your worries under German law: That is why ReaR is shipped under
the GPL where we explicitly shed responsiilities for what ReaR does
after a user installs and uses it, like any other Open Source software.
As long as there is no obvious malicious intent we are safe. Malicious
intent could be a piece of code that uploads all users' secrets to a
website while obfuscating what it does.</p>
<p>If it helps I'm happy to expand the variable dump feature to mask out
all <code>KEY|SECRET|PASSWORD</code> type variables unless the user explicitly
disables this behaviour.</p>
<p>BTW, your check for variable naming should probably be expanded to only
match on the variable names and not content.</p>
<h4 id="pcahyna_commented_at_2023-04-13_2013"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1507557009">2023-04-13 20:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-13_2013" title="Permanent link">&para;</a></h4>
<p>For inspiration, I checked what Ansible does - there are similar
concerns, because it is easy to show all Ansible module call parameters
(including values) during playbook execution (merely by requesting
verbose output), and secrets are passed to modules using parameters, so
they would leak quite often. Ansible allows marking some module
parameters as <code>no_log</code> and they are then omitted from the log output. If
a parameter name seems to indicate that it is a secret and is not marked
as <code>no_log</code>, Ansible shows the value, but emits a warning. This allows
the module developer to catch the problem before the module gets to
production.<br />
I think we could reuse the heuristic that determines whether the
parameter is a secret (apply it to shell variables). The regular
expression used in Ansible is</p>
<pre><code>^(.+[-_\s])?pass([-_\s]?(word|phrase|wrd|wd)?)([-_\s].+)?
</code></pre>
<p>We would use upper case of course, and we should add <code>KEY</code> to the
possibilities (not sure about <code>SECRET</code>). I already see one false
positive : <code>BACKUP_DUPLICITY_ASK_PASSPHRASE</code>.<br />
The regex would be used to mask variables in variable dump (not just for
warning, unlike in Ansible).</p>
<p>The question about debugscript/-D/set -x is a more difficult one: I see
@jsmeix changed code to protect against that in #2156, but doing it for
all such variables will be difficult.<br />
By the way, is assigning such variables in local.conf dangerous ? I see
the comment in default.conf:</p>
<pre><code># ... insert it between the single quotes of the following line:
#        { TTY_ROOT_PASSWORD=''; } 2&gt;/dev/null
#    NOTE: stderr is redirected in the above line to avoid exposing the password hash
#          in the log file when ReaR runs in debugscript mode.
</code></pre>
<p>but there is also this comment</p>
<pre><code># In debugscript mode only scripts sourced by the Source function in lib/framework-functions.sh
# are run with 'set -x' but default.conf is sourced by usr/sbin/rear directly.
# See the comment of the UserInput function in lib/_input-output-functions.sh
# how to keep things confidential when usr/sbin/rear is run in debugscript mode
</code></pre>
<p>which seem contradictory.</p>
<p>Regarding</p>
<blockquote>
<p>At some level ReaR debugging must be "complete", that is normal for
every software. DEBUGSCRIPTS is actually our "strongest" debug mode so
for me this is where full variable disclosure belongs.</p>
</blockquote>
<p>this makes some sense, as an example Ansible also shows all values when
you debug it itself by setting <code>ANSIBLE_DEBUG=1</code> (even the <code>no_log</code>
variables). But note that our issue template asks the user to submit
logs generated using <code>-D</code>. So it would actually encourage users who
report issues to leak confidential data, if this logging is "complete"
in this sense, and I see why this is not desirable. Not sure what to do
here - perhaps another debug level that would show really everything,
but we would normally not request its output?</p>
<h4 id="schlomo_commented_at_2023-04-14_1219"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1508418115">2023-04-14 12:19</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-14_1219" title="Permanent link">&para;</a></h4>
<p>OK, how about we add a new option <code>--debug-complete</code> or
<code>--expose-secrets</code> that enables the full variable dump?</p>
<h4 id="jsmeix_commented_at_2023-04-17_0740"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1510856524">2023-04-17 07:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-17_0740" title="Permanent link">&para;</a></h4>
<p>In general individual agreements (like GPL)<br />
do not take precedence over general law.</p>
<p>In a specific case one needs to get a legal judgement<br />
to find out how general law and individual agreements<br />
apply (i.e. one has to actually take a court action).</p>
<p>Without a court decision about this particular case<br />
there is the risk of legal issues.</p>
<h4 id="jsmeix_commented_at_2023-04-17_0750"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1510868018">2023-04-17 07:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-17_0750" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
I strongly disagree with your approach.</p>
<p>In the past I never needed all variables values<br />
to find the root cause of an issue in ReaR.</p>
<p>In the past the 'set -x' debugscript mode output<br />
was sufficient for me to find the root cause.</p>
<p>If I needed even more details I could easily add<br />
a script like yours or add commands for debugging<br />
to existing scripts as needed in the specific case.<br />
I vaguely remember there was one single case where<br />
the latter was needed (i.e. I told the user to add some<br />
specific commands for debugging into an existing script).</p>
<h4 id="schlomo_commented_at_2023-04-17_1453"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1511523516">2023-04-17 14:53</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-17_1453" title="Permanent link">&para;</a></h4>
<p>If I'm the only one who would like to see all variables in debug logs
then I'm fine with removing that script altogether and relying on
on-demand hacks if needed.</p>
<h4 id="pcahyna_commented_at_2023-04-17_1601"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1511655161">2023-04-17 16:01</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-17_1601" title="Permanent link">&para;</a></h4>
<p>I have felt a need for such a script myself some time ago (and not for
debugging, so I would even introduce a separate workflow), so I would
keep it, if the secrets issue can be addressed sufficiently.</p>
<h4 id="schlomo_commented_at_2023-04-17_2040"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1512057393">2023-04-17 20:40</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-17_2040" title="Permanent link">&para;</a></h4>
<p>@jsmeix @pcahyna how about we extract the script from the current place
into a dedicated <code>show-all-variables</code> workflow that will then, as
advertised, dump all variables, including secrets - of course with a
suitable warning?</p>
<h4 id="jsmeix_commented_at_2023-04-18_0810"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1512648910">2023-04-18 08:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-18_0810" title="Permanent link">&para;</a></h4>
<p>I asked colleagues about their general thoughts regarding<br />
"show also secrets in debug mode":</p>
<p>A colleague told me about this</p>
<pre><code># wpa_supplicant -h
...
 -K = include keys (passwords, etc.) in debug output
</code></pre>
<p>which matches what @schlomo suggests in<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1508418115">https://github.com/rear/rear/issues/2967#issuecomment-1508418115</a></p>
<p>Currently I think a command line option is the best way<br />
to solve the conflict that @schlomo described in<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1497372237">https://github.com/rear/rear/issues/2967#issuecomment-1497372237</a></p>
<p>My reasoning:</p>
<p>My reasoning is primarily about legal things and usability:</p>
<p>A command line option must be explicitly typed in by the user.<br />
When the command line option name tells what it means for the user<br />
typing in that command line option name is an explicit request<br />
by the user to let ReaR do exactly this.<br />
Because running a program in whatever debug mode<br />
is no explicit request to (also) get secret values shown<br />
(if at all debug mode might be an implicit request),<br />
the command line option name '--debug-complete'<br />
is no explicit request to get secret values shown.<br />
But the command line option name '--expose-secrets'<br />
is an explicit request to get secret values shown.</p>
<p>A command line option provides better usability<br />
(compared to a separated new workflow)<br />
because it works for any workflow so that the user<br />
can easily increase debug info step by step<br />
for the workflow that fails for him like</p>
<pre><code># rear WORKFLOW
[fails]

# rear -d WORKFLOW
[insufficient info why it fails]

# rear -d --expose-secrets WORKFLOW
[indicates a possible reason of the failure]

# rear -D WORKFLOW
[not clear how exactly it fails]

# rear -D --expose-secrets WORKFLOW
[now it is clear how exactly it fails]
</code></pre>
<p>Finally with a generic command line option<br />
we can implement what is right in each specific code place.<br />
For example there might be very specific use cases where</p>
<pre><code># rear --expose-secrets WORKFLOW
</code></pre>
<p>could make sense even in normal (non-debug) node<br />
e.g. to show some specific secrets on the user's terminal.</p>
<h4 id="jsmeix_commented_at_2023-04-20_1317"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1516313190">2023-04-20 13:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-20_1317" title="Permanent link">&para;</a></h4>
<p>@schlomo @pcahyna @gdha<br />
if you agree with my above reasoning in my<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1512648910">https://github.com/rear/rear/issues/2967#issuecomment-1512648910</a><br />
I would try to implement what @schlomo suggests in his<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1508418115">https://github.com/rear/rear/issues/2967#issuecomment-1508418115</a><br />
i.e. implement a new command line option '--expose-secrets'.</p>
<h4 id="jsmeix_commented_at_2023-04-27_1052"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1525466048">2023-04-27 10:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-27_1052" title="Permanent link">&para;</a></h4>
<p>Regarding documentation:</p>
<p>By chance I noticed what I wrote in<br />
<a href="https://github.com/rear/rear/issues/2917#issuecomment-1423967071">https://github.com/rear/rear/issues/2917#issuecomment-1423967071</a><br />
at "Caution with possible secrets in a full debug log file: ..."</p>
<h4 id="jsmeix_commented_at_2023-04-27_1125"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1525523376">2023-04-27 11:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-27_1125" title="Permanent link">&para;</a></h4>
<p>A side note FYI:</p>
<p>As shown by @pcahyna in his above<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1507557009">https://github.com/rear/rear/issues/2967#issuecomment-1507557009</a><br />
leaking confidential values can also happen<br />
in verbose mode of certain commands.</p>
<p>But - as far as I see - since<br />
<a href="https://github.com/rear/rear/issues/2416">https://github.com/rear/rear/issues/2416</a><br />
and<br />
<a href="https://github.com/rear/rear/pull/2633">https://github.com/rear/rear/pull/2633</a><br />
ReaR is no longer affected by this when ReaR is run in verbose mode<br />
because we call commands in verbose mode via '-v' or '--verbose'<br />
only when ReaR is run in debug mode, see usr/sbin/rear at<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/sbin/rear#L272">https://github.com/rear/rear/blob/rear-2.7/usr/sbin/rear#L272</a><br />
and see also<br />
<a href="https://github.com/rear/rear/issues/2416#issuecomment-855960979">https://github.com/rear/rear/issues/2416#issuecomment-855960979</a></p>
<h4 id="jsmeix_commented_at_2023-05-09_1405"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1540193825">2023-05-09 14:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-09_1405" title="Permanent link">&para;</a></h4>
<p>Mainly for my own information:</p>
<p>In<br />
<a href="https://github.com/rear/rear/pull/2982#issuecomment-1540097471">https://github.com/rear/rear/pull/2982#issuecomment-1540097471</a><br />
I wrote (excerpt):</p>
<pre><code>Perhaps I can solve the whole thing reasonably well via
https://github.com/rear/rear/issues/2967
by using 'source' for config files
to get things more secure for the user
plus
a sufficiently proper implementation that shows
all (non-secret) config variable values
in debug or debugscript mode.
My current offhanded idea is to maintain a list of
config variable names that can contain a secret value
(e.g. an array of variable names in default.conf
so the user can specify confidential config variable names
as needed to provide "final power to the user")
where it is only reported whether or not such variables have
a non-empty value but the actual secret value is not shown
unless usr/sbin/rear is run with the new command line option
'--expose-secrets'.
</code></pre>
<h4 id="jsmeix_commented_at_2023-05-12_1123"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1545591727">2023-05-12 11:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_1123" title="Permanent link">&para;</a></h4>
<p>Since
<a href="https://github.com/rear/rear/pull/2982">https://github.com/rear/rear/pull/2982</a><br />
those are the config variables that could have secret values:</p>
<pre><code># grep '{ .* ; } 2&gt;/dev/null' usr/share/rear/conf/default.conf  | grep -v '^#'

{ OPAL_PBA_DEBUG_PASSWORD='' ; } 2&gt;/dev/null
{ OPAL_PBA_TKNKEY='tpm:opalauthtoken:7' ; } 2&gt;/dev/null
{ BACKUP_PROG_CRYPT_KEY="${BACKUP_PROG_CRYPT_KEY:-}" ; } 2&gt;/dev/null
{ TTY_ROOT_PASSWORD='' ; } 2&gt;/dev/null
{ SSH_ROOT_PASSWORD='' ; } 2&gt;/dev/null
{ GALAXY11_PASSWORD=${GALAXY11_PASSWORD:-} ; } 2&gt;/dev/null
{ ZYPPER_ROOT_PASSWORD='root' ; } 2&gt;/dev/null
{ YUM_ROOT_PASSWORD='root' ; } 2&gt;/dev/null
</code></pre>
<p>For each of them I will check our code that<br />
we do not leak their values into the log file.</p>
<p>For BACKUP_PROG_CRYPT_KEY this was already done via<br />
<a href="https://github.com/rear/rear/pull/2156">https://github.com/rear/rear/pull/2156</a></p>
<p>For GALAXY11_PASSWORD this is done right now via<br />
<a href="https://github.com/rear/rear/pull/2985">https://github.com/rear/rear/pull/2985</a></p>
<h4 id="jsmeix_commented_at_2023-05-12_1125"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1545593787">2023-05-12 11:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_1125" title="Permanent link">&para;</a></h4>
<p>SSH_ROOT_PASSWORD:</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$SSH_ROOT_PASSWORD' | grep -v ': *#'

usr/share/rear/build/default/500_ssh_setup.sh:    [[ -n "$SSH_ROOT_PASSWORD" ]] &amp;&amp; password_authentication_value=yes
usr/share/rear/rescue/default/500_ssh.sh:    test "$SSH_ROOT_PASSWORD" &amp;&amp; LogPrintError "SSH_ROOT_PASSWORD cannot work when SSH_FILES is set to a 'false' value"
usr/share/rear/rescue/default/500_ssh.sh:if ! test -f "$ROOT_HOME_DIR/.ssh/authorized_keys" -o "$SSH_ROOT_PASSWORD" ; then
usr/share/rear/rescue/default/500_ssh.sh:if test "$SSH_ROOT_PASSWORD" ; then
usr/share/rear/rescue/default/500_ssh.sh:    case "$SSH_ROOT_PASSWORD" in
usr/share/rear/rescue/default/500_ssh.sh:            echo "root:$SSH_ROOT_PASSWORD:::::::" &gt; $ROOTFS_DIR/etc/shadow
usr/share/rear/rescue/default/500_ssh.sh:            echo "root:$( echo $SSH_ROOT_PASSWORD | openssl passwd -1 -stdin ):::::::" &gt; $ROOTFS_DIR/etc/shadow
usr/share/rear/restore/YUM/default/970_set_root_password.sh:test "$SSH_ROOT_PASSWORD" &amp;&amp; root_password="$SSH_ROOT_PASSWORD"
usr/share/rear/restore/ZYPPER/default/970_set_root_password.sh:test "$SSH_ROOT_PASSWORD" &amp;&amp; root_password="$SSH_ROOT_PASSWORD"
</code></pre>
<p>SSH_ROOT_PASSWORD should be fixed via<br />
<a href="https://github.com/rear/rear/pull/2986">https://github.com/rear/rear/pull/2986</a><br />
which by the way also fixes<br />
ZYPPER_ROOT_PASSWORD in current master code</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$ZYPPER_ROOT_PASSWORD' | grep -v ': *#'

usr/share/rear/restore/ZYPPER/default/970_set_root_password.sh:test "$ZYPPER_ROOT_PASSWORD" &amp;&amp; root_password="$ZYPPER_ROOT_PASSWORD"
`
</code></pre>
<p>and YUM_ROOT_PASSWORD in current master code</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$YUM_ROOT_PASSWORD' | grep -v ': *#'

usr/share/rear/restore/YUM/default/970_set_root_password.sh:test "$YUM_ROOT_PASSWORD" &amp;&amp; root_password="$YUM_ROOT_PASSWORD"
</code></pre>
<h4 id="jsmeix_commented_at_2023-05-12_1205"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1545639563">2023-05-12 12:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_1205" title="Permanent link">&para;</a></h4>
<p>TTY_ROOT_PASSWORD:</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$TTY_ROOT_PASSWORD' | grep -v ': *#'

usr/share/rear/build/default/503_store_tty_root_password.sh:{ [[ -n "$TTY_ROOT_PASSWORD" ]] &amp;&amp; echo "$TTY_ROOT_PASSWORD" &gt; "$ROOTFS_DIR/.TTY_ROOT_PASSWORD"; } 2&gt;/dev/null
usr/share/rear/skel/default/bin/login:            if [[ "$password_signature" == "$TTY_ROOT_PASSWORD" ]]; then  # Password matches: Success!
usr/share/rear/prep/default/340_include_password_tools.sh:{ [[ -n "$TTY_ROOT_PASSWORD" ]] &amp;&amp; REQUIRED_PROGS+=( openssl ); } 2&gt;/dev/null
</code></pre>
<p>Things were already done for<br />
usr/share/rear/build/default/503_store_tty_root_password.sh<br />
and<br />
usr/share/rear/prep/default/340_include_password_tools.sh<br />
via<br />
<a href="https://github.com/rear/rear/pull/2539/commits/8bc2b1cccccbd4806feb0bfa5fdcc41d0ca47942">https://github.com/rear/rear/pull/2539/commits/8bc2b1cccccbd4806feb0bfa5fdcc41d0ca47942</a><br />
and the subsequent merge commit<br />
<a href="https://github.com/rear/rear/commit/54b81fffa0ffec75e43daddefb7b1a1a58100ff9">https://github.com/rear/rear/commit/54b81fffa0ffec75e43daddefb7b1a1a58100ff9</a></p>
<p>In<br />
<a href="https://github.com/rear/rear/pull/2539">https://github.com/rear/rear/pull/2539</a><br />
I found<br />
<a href="https://github.com/rear/rear/pull/2539#discussion_r540783195">https://github.com/rear/rear/pull/2539#discussion_r540783195</a><br />
and<br />
<a href="https://github.com/rear/rear/issues/2540">https://github.com/rear/rear/issues/2540</a><br />
which got lost at that time (between Dec. 2020 and Feb. 2021)</p>
<p>Regarding<br />
usr/share/rear/skel/default/bin/login<br />
I noticed no comment that tells that also all is OK in this case.<br />
I guess all is OK in this case because I assume this script<br />
is never run with 'set -x' (in the ReaR recovery system).</p>
<h4 id="jsmeix_commented_at_2023-05-12_1233"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1545674020">2023-05-12 12:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_1233" title="Permanent link">&para;</a></h4>
<p>OPAL_PBA_DEBUG_PASSWORD:</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$OPAL_PBA_DEBUG_PASSWORD' | grep -v ': *#'

usr/share/rear/build/OPALPBA/Linux-i386/820_store_settings.sh:OPAL_PBA_DEBUG_PASSWORD='$OPAL_PBA_DEBUG_PASSWORD'
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks:    [[ -z "$OPAL_PBA_DEBUG_PASSWORD" ]] &amp;&amp; return 1  # debug password not configured
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks:    IFS='\$' read -r _ method salt _ &lt;&lt;&lt;"$OPAL_PBA_DEBUG_PASSWORD"
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks:    [[ "$password_signature" == "$OPAL_PBA_DEBUG_PASSWORD" ]]
usr/share/rear/prep/OPALPBA/Linux-i386/001_configure_workflow.sh:[[ -n "$OPAL_PBA_DEBUG_PASSWORD" ]] &amp;&amp; REQUIRED_PROGS+=( openssl )
</code></pre>
<p>As far as I see it seems<br />
usr/share/rear/build/OPALPBA/Linux-i386/820_store_settings.sh<br />
is OK because</p>
<pre><code>cat &gt; FILE &lt;&lt; EOF
secret value
EOF
</code></pre>
<p>does not show 'secret value' when that is run with 'set -x'<br />
because in this case 'set -x' only shows '+ cat'<br />
at least for me with GNU bash version 4.4.23</p>
<pre><code># OPAL_PBA_DEBUG_PASSWORD=mypassword

# set -x

# cat &gt; OPAL_PBA_SETTINGS.sh &lt;&lt; -EOF-
&gt; OPAL_PBA_DEBUG_PASSWORD='$OPAL_PBA_DEBUG_PASSWORD'
&gt; -EOF-
+ cat

# set +x

# cat OPAL_PBA_SETTINGS.sh
OPAL_PBA_DEBUG_PASSWORD='mypassword'
</code></pre>
<p>As far as I see it seems also<br />
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks<br />
is OK because it seems this is run via</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'unlock-opal-disks' | grep -v ': *#'

usr/share/rear/skel/default/usr/lib/systemd/system/sysinit-opalpba.service:ExecStart=/etc/scripts/unlock-opal-disks

usr/share/rear/skel/OPALPBA/etc/inittab:ss::bootwait:/etc/scripts/unlock-opal-disks
</code></pre>
<p>and I assume what is run this way<br />
is never run with 'set -x' (in the ReaR recovery system).</p>
<p>So the only remaining part is<br />
usr/share/rear/prep/OPALPBA/Linux-i386/001_configure_workflow.sh<br />
which should be fixed via<br />
<a href="https://github.com/rear/rear/commit/64dd3ba9bd3ca7b6bf335a534bb5af5a71532d8e">https://github.com/rear/rear/commit/64dd3ba9bd3ca7b6bf335a534bb5af5a71532d8e</a></p>
<h4 id="jsmeix_commented_at_2023-05-12_1304"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1545714426">2023-05-12 13:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_1304" title="Permanent link">&para;</a></h4>
<p>OPAL_PBA_TKNKEY:</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep '$OPAL_PBA_TKNKEY' | grep -v ': *#'

usr/share/rear/build/OPALPBA/Linux-i386/820_store_settings.sh:OPAL_PBA_TKNKEY='$OPAL_PBA_TKNKEY'
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks:            at_password=$(authtkn_load "$authtkn_path" "$OPAL_PBA_TKNOFFSET" "$OPAL_PBA_TKNKEY" "$authtkn_bind2dev" 2&gt;&gt;$authtkn_stderr)
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks:                    if authtkn_store "$authtkn_path" "$OPAL_PBA_TKNOFFSET" "$at_password" "$OPAL_PBA_TKNKEY" "$authtkn_bind2dev" &gt;&gt;$authtkn_stderr 2&gt;&amp;1; then
</code></pre>
<p>usr/share/rear/build/OPALPBA/Linux-i386/820_store_settings.sh<br />
and<br />
usr/share/rear/skel/default/etc/scripts/unlock-opal-disks<br />
were already considered to look OK right before in<br />
<a href="https://github.com/rear/rear/issues/2967#issuecomment-1545674020">https://github.com/rear/rear/issues/2967#issuecomment-1545674020</a></p>
<h4 id="codefritzel_commented_at_2023-05-24_2005"><img src="https://avatars.githubusercontent.com/u/118316875?v=4" width="50"><a href="https://github.com/codefritzel">codefritzel</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1561858597">2023-05-24 20:05</a>:<a class="headerlink" href="#codefritzel_commented_at_2023-05-24_2005" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
How about moving something like that into functions like
<code>LogSecret "$secret_string"</code> or <code>SecretCommand "$cmd"</code> which is only
displayed when the <code>--expose-secrets</code> is activated?<br />
Especially in development and debugging can this be very useful.<br />
To test #2991, I had to remove <code>2&gt;/dev/null</code> to see if the right
parameters were passed to lftp.</p>
<h4 id="jsmeix_commented_at_2023-05-25_1109"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1562717878">2023-05-25 11:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-25_1109" title="Permanent link">&para;</a></h4>
<p>@codefritzel<br />
I assume you mean something like</p>
<pre><code>if { COMMAND $SECRET_ARGUMENT ; } 2&gt;/dev/null ; then
    Log "COMMAND succeeded"
else
    { LogSecret "'COMMAND $SECRET_ARGUMENT' failed with exit code $?" ; } 2&gt;/dev/null
    Error "COMMAND failed"
fi
</code></pre>
<p>I like the idea and as far as I see I think it can be implemented.<br />
The LogSecret command itself must be within '{ ... ; } 2&gt;/dev/null'<br />
because otherwise $SECRET_ARGUMENT in the LogSecret command<br />
would leak into the log file in debuscript mode via 'set -x'.</p>
<h4 id="jsmeix_commented_at_2023-05-25_1122"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1562732484">2023-05-25 11:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-25_1122" title="Permanent link">&para;</a></h4>
<p>Only an offhanded idea:</p>
<p>Alternatively we may introduce in usr/sbin/rear by default</p>
<pre><code>SECRET_OUTPUT_DEV="null"
</code></pre>
<p>and set it to</p>
<pre><code>SECRET_OUTPUT_DEV="stderr"
</code></pre>
<p>only if '--expose-secrets' is set<br />
in a similar way as we currently use<br />
DEBUG_OUTPUT_DEV and DISPENSABLE_OUTPUT_DEV</p>
<p>For example like</p>
<pre><code>if { COMMAND $SECRET_ARGUMENT ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV ; then
    Log "COMMAND succeeded"
else
    { Log "'COMMAND $SECRET_ARGUMENT' failed with exit code $?" ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV
    Error "COMMAND failed"
fi
</code></pre>
<p>No special LogSecret function is needed and now<br />
also the command call itself can appear in the<br />
log file in debuscript mode via 'set -x'<br />
when additionally --expose-secrets is set.</p>
<p>Additionally the</p>
<pre><code>{ ... ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV
</code></pre>
<p>syntax makes it clear which redirections are<br />
explicitly meant to hide secrets to distinguish them<br />
from usual unwanted output discard via '2&gt;/dev/null'</p>
<p>By the way:<br />
The</p>
<pre><code>Log "COMMAND succeeded"
</code></pre>
<p>is needed to have something in the log because<br />
the command call itself is normally invisible.</p>
<h4 id="codefritzel_commented_at_2023-05-25_2046"><img src="https://avatars.githubusercontent.com/u/118316875?v=4" width="50"><a href="https://github.com/codefritzel">codefritzel</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1563487288">2023-05-25 20:46</a>:<a class="headerlink" href="#codefritzel_commented_at_2023-05-25_2046" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Only an offhanded idea:</p>
<p>Alternatively we may introduce in usr/sbin/rear by default</p>
<pre><code>SECRET_OUTPUT_DEV="null"
</code></pre>
<p>and set it to</p>
<pre><code>SECRET_OUTPUT_DEV="stderr"
</code></pre>
<p>only if '--expose-secrets' is set in a similar way as we currently use
DEBUG_OUTPUT_DEV and DISPENSABLE_OUTPUT_DEV</p>
<p>For example like</p>
<pre><code>if { COMMAND $SECRET_ARGUMENT ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV ; then
    Log "COMMAND succeeded"
else
    { Log "'COMMAND $SECRET_ARGUMENT' failed with exit code $?" ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV
    Error "COMMAND failed"
fi
</code></pre>
<p>No special LogSecret function is needed and now also the command call
itself can appear in the log file in debuscript mode via 'set -x' when
additionally --expose-secrets is set.</p>
<p>Additionally the</p>
<pre><code>{ ... ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV
</code></pre>
<p>syntax makes it clear which redirections are explicitly meant to hide
secrets to distinguish them from usual unwanted output discard via
'2&gt;/dev/null'</p>
<p>By the way: The</p>
<pre><code>Log "COMMAND succeeded"
</code></pre>
<p>is needed to have something in the log because the command call itself
is normally invisible.</p>
</blockquote>
<p>I think the idea is very good. For debugging purposes, the user or
developer can see the executed command, if activated.</p>
<p>@jsmeix<br />
Do you want to implement this and create a WIP RP?</p>
<h4 id="jsmeix_commented_at_2023-05-26_0634"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1563876355">2023-05-26 06:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-26_0634" title="Permanent link">&para;</a></h4>
<p>@codefritzel<br />
I will try it out - likely next week (as time permits)<br />
and if it works OK for me I will make a pull request.</p>
<h4 id="jsmeix_commented_at_2023-06-05_1243"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1576722509">2023-06-05 12:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-05_1243" title="Permanent link">&para;</a></h4>
<p>Ouch!<br />
One must be super careful to not leak secrets by accident:</p>
<pre><code>if { COMMAND $SECRET_ARGUMENT ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV ; then
    Log "COMMAND succeeded"
else
    { Log "'COMMAND $SECRET_ARGUMENT' failed with exit code $?" ; } 2&gt;&gt;/dev/$SECRET_OUTPUT_DEV
    Error "COMMAND failed"
fi
</code></pre>
<p>leaks $SCRET_ARGUMENT when COMMAND failed because</p>
<pre><code>{ Log "'COMMAND $SECRET_ARGUMENT' ... " ; } 2&gt;&gt;/dev/null
</code></pre>
<p>outputs into the log file in any case because<br />
in lib/_input-output-functions.sh there is</p>
<pre><code>function Log () {
    ...
    echo "$log_message" &gt;&gt;"$RUNTIME_LOGFILE" || true
}
</code></pre>
<p>So we also need the 'LogSecret' function.</p>
<h4 id="jsmeix_commented_at_2023-06-06_1220"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2967#issuecomment-1578659515">2023-06-06 12:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-06-06_1220" title="Permanent link">&para;</a></h4>
<p>In
<a href="https://github.com/rear/rear/pull/3006">https://github.com/rear/rear/pull/3006</a><br />
I implemented the basics of the new</p>
<ul>
<li>-e / --expose-secrets option for sbin/rear</li>
<li>SECRET_OUTPUT_DEV</li>
<li>LogSecret function</li>
</ul>
<p>Nothing is documented yet in "rear help" or "man rear"<br />
until I did some more tests and until I got some feedback<br />
what others think about it and how it behaves for them.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-04-05.2967.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
