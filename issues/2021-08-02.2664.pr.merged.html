<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2664 PR merged: Default TMPDIR should be /var/tmp - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2664 PR merged: Default TMPDIR should be /var/tmp";
        var mkdocs_page_input_path = "issues/2021-08-02.2664.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2664 PR merged: Default TMPDIR should be /var/tmp</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2664_pr_merged_default_tmpdir_should_be_vartmp"><a href="https://github.com/rear/rear/pull/2664">#2664 PR</a> <code>merged</code>: Default TMPDIR should be /var/tmp<a class="headerlink" href="#2664_pr_merged_default_tmpdir_should_be_vartmp" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>documentation</code>, <code>cleanup</code>,
<code>fixed / solved / done</code></p>
<h4 id="pcahyna_opened_issue_at_2021-08-02_1639"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> opened issue at <a href="https://github.com/rear/rear/pull/2664">2021-08-02 16:39</a>:<a class="headerlink" href="#pcahyna_opened_issue_at_2021-08-02_1639" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):
    <a href="https://github.com/rear/rear/issues/2654#issuecomment-881609874">https://github.com/rear/rear/issues/2654#issuecomment-881609874</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Running <code>rear mkrescue</code> on a system with /tmp on tmpfs. Before, it
    has failed with the message
    <code>cp: error copying '/tmp/rear.ZLTj0NcVqlr4fiH/tmp/initrd.cgz' to '/tmp/rear.ZLTj0NcVqlr4fiH/tmp/isofs/isolinux/initrd.cgz': No space left on device</code>.
    After the change it succeeds.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>The default temporary directory ( /tmp ) is not suited for ReaR, because
ReaR needs lots of space. file-hierarchy(7) recommends to use /var/tmp
as default for such programs.</p>
<p>If the user sets TMPDIR explicitly, it still takes precedence.</p>
<p>See the discussion in issue #2654 .</p>
<h4 id="hpannenb_commented_at_2021-08-03_0724"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891604186">2021-08-03 07:24</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-03_0724" title="Permanent link">&para;</a></h4>
<p>@pcahyna Would it make sense to prevent overwriting the TMPDIR if set
elsewhere already? I therefore would propose a line like this
<code>test "$TMPDIR" || export TMPDIR="${TMPDIR-/var/tmp}"</code> in
<code>default.conf</code>.</p>
<h4 id="pcahyna_commented_at_2021-08-03_0757"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891624592">2021-08-03 07:57</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-08-03_0757" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna Would it make sense to prevent overwriting the TMPDIR if set
elsewhere already? I therefore would propose a line like this
<code>test "$TMPDIR" || export TMPDIR="${TMPDIR-/var/tmp}"</code> in
<code>default.conf</code>.</p>
</blockquote>
<p>@hpannenb that's what my line is doing. If TMPDIR is set, it overwrites
it with the same value, which should be a no-op (and .there are many
other instances of this idiom in the code).<br />
Note that I respect TMPDIR even if it is set to an empty value (maybe I
should set it to <code>/var/tmp</code> in this case, too).</p>
<h4 id="hpannenb_commented_at_2021-08-03_0811"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891634636">2021-08-03 08:11</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-03_0811" title="Permanent link">&para;</a></h4>
<p>@pcahyna I see. I am not aware of all those bash "specialties". Thanks
for Your explanation.</p>
<h4 id="jsmeix_commented_at_2021-08-03_0854"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891664732">2021-08-03 08:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-03_0854" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you for this pull request!</p>
<p>Did you test that "rear recover" works with<br />
the new TMPDIR=/var/tmp in default.conf<br />
and also with some predefined <code>TMPDIR=/very/special/path/tmp</code><br />
for the user 'root' on the original system where "rear mkrescue" runs?</p>
<p>I wonder if removing
rescue/GNU/Linux/600_unset_TMPDIR_in_rescue_conf.sh<br />
is always fully safe because the comment in that file indicates that
something like<br />
TMPDIR=/var/tmp may not work during "rear recover":</p>
<pre><code># e.g. by defining TMPDIR=/var we would get our BUILD_DIR=/var/tmp/rear.XXXXXXXXXXXX
# However, in rescue we want our BUILD_DIR=/tmp/rear.XXXXXXX ...
</code></pre>
<p>But as far as I see from plain looking at the code<br />
we should have /var/tmp in the recovery system in any case<br />
because the skel/default/var/tmp directory (with its contents)<br />
gets included by rescue/default/010_merge_skeletons.sh<br />
so "rear recover" should work with the TMPDIR=/var/tmp default<br />
and<br />
I think the user 'root' in the recovery system cannot inherit<br />
some <code>TMPDIR=/very/special/path/tmp</code> setting<br />
from the user 'root' on the original system<br />
so "rear recover" should work with our TMPDIR=/var/tmp default even<br />
if there is <code>TMPDIR=/very/special/path/tmp</code> for 'root' on the original
system<br />
but I am not 100% sure.</p>
<h4 id="pcahyna_commented_at_2021-08-03_0903"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891670934">2021-08-03 09:03</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-08-03_0903" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Did you test that "rear recover" works with<br />
the new TMPDIR=/var/tmp in default.conf<br />
and also with some predefined <code>TMPDIR=/very/special/path/tmp</code><br />
for the user 'root' on the original system where "rear mkrescue" runs?</p>
</blockquote>
<p>No, I will test this.</p>
<pre><code>e.g. by defining TMPDIR=/var we would get our BUILD_DIR=/var/tmp/rear.XXXXXXXXXXXX
</code></pre>
<p>This code comment looks wrong. If you define <code>TMPDIR=/var</code>, then
<code>BUILD_DIR</code> should be <code>/var/rear.XXXXXXXXXXXX</code>.</p>
<blockquote>
<p>I think the user 'root' in the recovery system cannot inherit<br />
some TMPDIR=/very/special/path/tmp setting<br />
from the user 'root' on the original system<br />
so "rear recover" should work with our TMPDIR=/var/tmp default even<br />
if there is TMPDIR=/very/special/path/tmp for 'root' on the original
system<br />
but I am not 100% sure.</p>
</blockquote>
<p>You mean if it is set in the root's dotfiles? Not sure whether ReaR can
inherit them in some way, but if it does, the former code is broken
anyway (the <code>unset</code> is too late).</p>
<h4 id="jsmeix_commented_at_2021-08-03_0946"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891701526">2021-08-03 09:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-03_0946" title="Permanent link">&para;</a></h4>
<p>I also think that code comment is a typo. It originated from<br />
<a href="https://github.com/rear/rear/commit/179fd6493883ddbba740fd64e4851ab322bc39ca">https://github.com/rear/rear/commit/179fd6493883ddbba740fd64e4851ab322bc39ca</a></p>
<p>For me the user 'root' in the recovery system has only</p>
<pre><code>/tmp/rear.XXX/rootfs/root/.ssh
/tmp/rear.XXX/rootfs/root/.ssh/known_hosts
/tmp/rear.XXX/rootfs/root/.ssh/authorized_keys
/tmp/rear.XXX/rootfs/root/.gitignore
/tmp/rear.XXX/rootfs/root/.bash_history
</code></pre>
<p>with those contents</p>
<pre><code># diff -s ~/.ssh/known_hosts /tmp/rear.XXX/rootfs/root/.ssh/known_hosts
Files /root/.ssh/known_hosts and /tmp/rear.XXX/rootfs/root/.ssh/known_hosts are identical

# diff -s ~/.ssh/authorized_keys /tmp/rear.XXX/rootfs/root/.ssh/authorized_keys 
Files /root/.ssh/authorized_keys and /tmp/rear.XXX/rootfs/root/.ssh/authorized_keys are identical

# cat /tmp/rear.XXX/rootfs/root/.bash_history
: # no more predefined ReaR entries in the bash history
systemctl start sshd.service              # start SSH daemon
ip -4 addr                                # get IPv4 address
dhcpcd eth0                               # start DHCP client
nano /var/lib/rear/layout/diskrestore.sh  # disk restore
nano /var/lib/rear/layout/disklayout.conf # disk layout
vi /var/lib/rear/layout/diskrestore.sh    # disk restore
vi /var/lib/rear/layout/disklayout.conf   # disk layout
less /var/log/rear/*                      # log file(s)
loadkeys -d                               # default keyboard
rear recover                              # recover system
: # there are some predefined entries in the bash history
</code></pre>
<p>so for me nothing from 'root' on the original system<br />
gets copied into the recovery system except<br />
/root/.ssh/known_hosts and /root/.ssh/authorized_keys<br />
(I have <code>SSH_ROOT_PASSWORD="rear"</code> in my etc/rear/local.conf)<br />
cf. rescue/default/500_ssh.sh</p>
<p>Of course the user could copy anything via COPY_AS_IS<br />
but then he is responsible what he gets in his recovery system.</p>
<h4 id="jsmeix_commented_at_2021-08-03_0951"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891704969">2021-08-03 09:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-03_0951" title="Permanent link">&para;</a></h4>
<p>@hpannenb<br />
could you test if things work OK for your use case<br />
with this changes here?</p>
<h4 id="hpannenb_commented_at_2021-08-03_0958"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891709852">2021-08-03 09:58</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-03_0958" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@hpannenb<br />
could you test if things work OK for your use case<br />
with this changes here?</p>
</blockquote>
<p>I will need to check here on a CentOS7 VM. But I guess it will fit.</p>
<p>Update for @jsmeix : I could successfully clone my Centos7 VM with means
of the current ReaR git version plus the changes made by @pcahyna. My
test setup is NETFS backup included into bootable ISO as follows:</p>
<pre><code># ReaR - site.conf

BACKUP=NETFS
BACKUP_URL=iso://backup

BACKUP_PROG_EXCLUDE=( $BACKUP_PROG_EXCLUDE[@] '/var/tmp/*' '/var/backup/*' '/backup/*' )
OUTPUT=ISO
OUTPUT_URL=null

ISO_MAX_SIZE=2100

USE_STATIC_NETWORKING=yes
USE_RESOLV_CONF=no

SSH_ROOT_PASSWORD='root'
</code></pre>
<p>P.S.: The /tmp directory is mounted <code>noexec,nodev,nosuid</code>.</p>
<h4 id="jsmeix_commented_at_2021-08-03_1055"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-891747411">2021-08-03 10:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-03_1055" title="Permanent link">&para;</a></h4>
<p>FYI by the way regarding<br />
"inherited stuff from 'root' on the original system could let things in
'rear recover' fail":</p>
<p>Now I remember where that happened:<br />
It happened during "rear recover" 'finalize' stage (i.e. after the
backup was restored)<br />
where certain things are run inside the restored system via
<code>chroot /mnt/local</code><br />
(in particular recreating the initrd and reinstalling the bootloader),<br />
see
<a href="https://github.com/rear/rear/issues/862">https://github.com/rear/rear/issues/862</a><br />
and
<a href="https://github.com/rear/rear/pull/1345">https://github.com/rear/rear/pull/1345</a></p>
<p>The unfortunate consequence in current ReaR code is that<br />
we run a COMMAND within <code>chroot /mnt/local</code> differently:</p>
<p>With a login shell<br />
e.g. in finalize/Linux-i386/660_install_grub2.sh</p>
<pre><code>chroot $TARGET_FS_ROOT /bin/bash --login -c "COMMAND"
</code></pre>
<p>With a shell that is no login shell<br />
e.g. in finalize/SUSE_LINUX/i386/550_rebuild_initramfs.sh</p>
<pre><code>chroot $TARGET_FS_ROOT /bin/bash -c "COMMAND"
</code></pre>
<p>Without a shell<br />
e.g. in finalize/Fedora/i386/550_rebuild_initramfs.sh</p>
<pre><code>chroot $TARGET_FS_ROOT COMMAND
</code></pre>
<p>Seems to be something more to clean up in the future...</p>
<h4 id="jsmeix_commented_at_2021-08-05_0738"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893237533">2021-08-05 07:38</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-05_0738" title="Permanent link">&para;</a></h4>
<p>@rear/contributors<br />
I would like to merge it tomorrow morning<br />
unless there are objections.</p>
<h4 id="jsmeix_commented_at_2021-08-05_0740"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893238742">2021-08-05 07:40</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-05_0740" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
could you or did you already test that "rear recover"<br />
works with the new TMPDIR=/var/tmp in default.conf<br />
and also with some predefined TMPDIR=/very/special/path/tmp<br />
for the user 'root' on the original system where "rear mkrescue" runs?</p>
<h4 id="hpannenb_commented_at_2021-08-05_0953"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893324479">2021-08-05 09:53</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-05_0953" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna<br />
could you or did you already test that "rear recover"<br />
works with the new TMPDIR=/var/tmp in default.conf<br />
and also with some predefined TMPDIR=/very/special/path/tmp<br />
for the user 'root' on the original system where "rear mkrescue" runs?</p>
</blockquote>
<p>@jsmeix As mentioned in my
<a href="https://github.com/rear/rear/pull/2664#issuecomment-891709852">update</a>
a recovery works for one of my use cases. No objections in that area.</p>
<h4 id="pcahyna_commented_at_2021-08-05_0959"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893328197">2021-08-05 09:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-08-05_0959" title="Permanent link">&para;</a></h4>
<blockquote>
<blockquote>
<p>could you or did you already test that "rear recover"<br />
works with the new TMPDIR=/var/tmp in default.conf<br />
and also with some predefined TMPDIR=/very/special/path/tmp<br />
for the user 'root' on the original system where "rear mkrescue"
runs?</p>
</blockquote>
<p>@jsmeix As mentioned in my
<a href="https://github.com/rear/rear/pull/2664#issuecomment-891709852">update</a>
a recovery works for one of my use cases. No objections in that area.</p>
</blockquote>
<p>@hpannenb have you also tested setting a custom <code>TMPDIR</code> in the program
environment, or just the default setting?</p>
<h4 id="hpannenb_commented_at_2021-08-05_1010"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893336523">2021-08-05 10:10</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-05_1010" title="Permanent link">&para;</a></h4>
<p>[...]</p>
<blockquote>
<p>@hpannenb have you also tested setting a custom <code>TMPDIR</code> in the
program environment, or just the default setting?</p>
</blockquote>
<p>I am currently testing with <code>export TMPDIR="/home/hpannenb/megarear/"</code>.</p>
<h4 id="jsmeix_commented_at_2021-08-05_1029"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893348367">2021-08-05 10:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-05_1029" title="Permanent link">&para;</a></h4>
<p>I am currently testing as well...</p>
<h4 id="jsmeix_commented_at_2021-08-05_1109"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893371701">2021-08-05 11:09</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-05_1109" title="Permanent link">&para;</a></h4>
<p>"rear mkbackup" and "rear recover" work well for me both<br />
with the default with no TMPDIR set by root<br />
where /var/tmp/rear.XXX is used both for "rear mkbackup" and "rear
recover"<br />
and also<br />
with TMPDIR set by root on the original system as</p>
<pre><code># mkdir -p /opt/QQQ/rear/tmp
# export TMPDIR="/opt/QQQ/rear/tmp"
</code></pre>
<p>where /opt/QQQ/rear/tmp/rear.XXX is used for "rear mkbackup"<br />
and the default /var/tmp/rear.XXX is used for "rear recover"<br />
(i.e. no TMPDIR is set by root in the recovery system).</p>
<h4 id="hpannenb_commented_at_2021-08-05_1340"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893469116">2021-08-05 13:40</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-05_1340" title="Permanent link">&para;</a></h4>
<p><code>rear mkbackup</code> and <code>rear recover</code> and either default or
<code>export TMPDIR="/home/hpannenb/megarear/"</code> work for me as well in my
Centos7 based VM.</p>
<h4 id="pcahyna_commented_at_2021-08-05_1355"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-893480241">2021-08-05 13:55</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-08-05_1355" title="Permanent link">&para;</a></h4>
<p>thank you @jsmeix and @hpannenb for those tests and sorry for not having
tested it myself.</p>
<h4 id="jsmeix_commented_at_2021-08-06_0536"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-894013967">2021-08-06 05:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-06_0536" title="Permanent link">&para;</a></h4>
<p>@hpannenb<br />
thank you for also testing it.<br />
It helps a lot to avoid unexpected regressions<br />
when more than one independent tests are done.</p>
<p>@pcahyna<br />
thank you for finally solving this long lasting case<br />
what the right way is to set ReaR's temporary directory<br />
that goes back at least to the year 2013<br />
(as far as I found out by looking for TMPDIR in <code>git log</code>).</p>
<h4 id="jsmeix_commented_at_2021-08-06_0610"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-894027189">2021-08-06 06:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-06_0610" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
I have a question about the exact intention of the command</p>
<pre><code>export TMPDIR="${TMPDIR-/var/tmp}"
</code></pre>
<p>where you wrote above in<br />
<a href="https://github.com/rear/rear/pull/2664#issuecomment-891624592">https://github.com/rear/rear/pull/2664#issuecomment-891624592</a><br />
"... should be a no-op ..."</p>
<p>According to how I understand "man bash" that command<br />
exports TMPDIR in any case (so it is not a no-op because it exports
it)<br />
and the value of TMPDIR is set to /var/tmp only if TMPDIR is unset<br />
but not if TMPDIR is null/empty so if TMPDIR is empty it results</p>
<pre><code>export TMPDIR=""
</code></pre>
<p>Is my understanding right?</p>
<p>If yes, I wonder what the intent is to export an empty TMPDIR
variable?<br />
Is the export in any case perhaps meant to ensure that any TMPDIR
value<br />
(also when it is the empty value which means "use the system default")<br />
will be in the environment for all <code>exec</code>-ed (and possibly <code>fork</code>-ed)
programs?<br />
I.e. if somehow TMPDIR was set but not yet exported it is then exported?</p>
<p>If this is the intent behind I think it is good to do it this way<br />
to ensure a set TMPDIR is used by all subsequent programs.</p>
<h4 id="hpannenb_commented_at_2021-08-06_0835"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-894101060">2021-08-06 08:35</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-06_0835" title="Permanent link">&para;</a></h4>
<p>@jsmeix As recognised from
<a href="https://tldp.org/LDP/abs/html/parameter-substitution.html">here</a> and
man bash there are many ways to substitute. That is what @pcahyna also
mentions in his comment " Note that I respect TMPDIR even if it is set
to an empty value (<strong>maybe I should set it to /var/tmp in this case,
too</strong>)."</p>
<p>It might be useful to always overwrite with a default <code>/var/tmp</code> in any
case but the user explicitly decides to use a different path:</p>
<p>I did a small check on this (though I am not a bash expert):</p>
<pre><code>[root@centos7 ~]# unset TMPDIR
[root@centos7 ~]# echo "${TMPDIR-/var/tmp}","${TMPDIR:-/var/tmp}","${TMPDIR:=/var/tmp}"
/var/tmp,/var/tmp,/var/tmp
[root@centos7 ~]# TMPDIR=
[root@centos7 ~]# echo "${TMPDIR-/var/tmp}","${TMPDIR:-/var/tmp}","${TMPDIR:=/var/tmp}"
,/var/tmp,/var/tmp
[root@centos7 ~]# TMPDIR=aaaaa
[root@centos7 ~]# echo "${TMPDIR-/var/tmp}","${TMPDIR:-/var/tmp}","${TMPDIR:=/var/tmp}"
aaaaa,aaaaa,aaaaa
</code></pre>
<p>A general decision to be made what will be the better approach to use.</p>
<h4 id="jsmeix_commented_at_2021-08-06_0903"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-894117682">2021-08-06 09:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-06_0903" title="Permanent link">&para;</a></h4>
<p>The "respect TMPDIR even if it is set to an empty value" is my point.</p>
<p>My general "mantra" in particular for ReaR is</p>
<pre><code>Final power to the user!
</code></pre>
<p>In this case "final power to the user" means:<br />
When TMPDIR is set we assume it is set by the user so ReaR has to obey<br />
and ReaR must error out if it cannot work with what is set (by its
user)<br />
but ReaR must not make a final decision against what is set (by its
user).<br />
In contrast when TMPDIR is not set then ReaR is free to decide.</p>
<h4 id="hpannenb_commented_at_2021-08-06_0942"><img src="https://avatars.githubusercontent.com/u/13567759?u=b037e492e58a5f63f35277b3606d500cd622c8ed&v=4" width="50"><a href="https://github.com/hpannenb">hpannenb</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-894140186">2021-08-06 09:42</a>:<a class="headerlink" href="#hpannenb_commented_at_2021-08-06_0942" title="Permanent link">&para;</a></h4>
<p>Acceptable "red line"/mantra for the use of ReaR. So the solution is
kept "as is". 👍</p>
<h4 id="pcahyna_commented_at_2021-08-19_1159"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-901854920">2021-08-19 11:59</a>:<a class="headerlink" href="#pcahyna_commented_at_2021-08-19_1159" title="Permanent link">&para;</a></h4>
<p>@jsmeix sorry for not having noticed your question earlier. Indeed,
TMPDIR being empty is a corner case and the code does not touch the
value of the variable in this case but merely exports it. But I think
that in practice it does not matter, because the variable can't be set
without being exported - if it is not exported, how would ReaR have
inherited it? The only possibility is that someone has set it in a
configuration file, without exporting it, but I don't think we should
consider this really supported.<br />
Concerning</p>
<blockquote>
<p>the value of TMPDIR is set to /var/tmp only if TMPDIR is unset but not
if TMPDIR is null/empty</p>
</blockquote>
<p>maybe I should change it to <code>:-</code> to set the variable to a default value
both if it is unset or empty. I am not at all sure what is the intended
semantics of TMPDIR set to an empty string, if any.</p>
<h4 id="jsmeix_commented_at_2021-08-31_1143"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2664#issuecomment-909159017">2021-08-31 11:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-08-31_1143" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
see my
<a href="https://github.com/rear/rear/pull/2664#issuecomment-894117682">https://github.com/rear/rear/pull/2664#issuecomment-894117682</a></p>
<p>I.e. I think when TMPDIR is set (i.e. also when it is set to an empty
value)<br />
we assume it is set intentionally by the user (also if it is set to an
empty value<br />
we assume the user wants the semantics of that setting) and ReaR has to
obey<br />
so I think it is exactly right to let ReaR set TMPDIR only if TMPDIR is
unset.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-08-02.2664.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
