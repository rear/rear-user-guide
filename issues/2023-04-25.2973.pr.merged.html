<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2973 PR merged: nfs_server as new restore method - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2973 PR merged: nfs_server as new restore method";
        var mkdocs_page_input_path = "issues/2023-04-25.2973.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2973 PR merged: nfs_server as new restore method</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2973_pr_merged_nfs_server_as_new_restore_method"><a href="https://github.com/rear/rear/pull/2973">#2973 PR</a> <code>merged</code>: nfs_server as new restore method<a class="headerlink" href="#2973_pr_merged_nfs_server_as_new_restore_method" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>sponsored</code></p>
<h4 id="codefritzel_opened_issue_at_2023-04-25_1100"><img src="https://avatars.githubusercontent.com/u/118316875?v=4" width="50"><a href="https://github.com/codefritzel">codefritzel</a> opened issue at <a href="https://github.com/rear/rear/pull/2973">2023-04-25 11:00</a>:<a class="headerlink" href="#codefritzel_opened_issue_at_2023-04-25_1100" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>New Feature</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL):</p>
</li>
<li>
<p>How was this pull request tested?<br />
    Manually on Ubu22.04 and OL8.7</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    This pull request adds NFS_SERVER as a new restore method. In the
    rescue stage rear starts an NFS server and exports all mount points.
    With NFS version 4 the rootfs to be restored can be mounted with the
    following command:<br />
<code>mount -t nfs -o nfsvers=4 &lt;ip&gt;:/ /mnt</code><br />
    Another server with working backup software can mount this share and
    restore all data to it.<br />
    Rear waits until the file 'rear_finished.txt' is created and all
    connections to the nfs server are disconnected. After that Rear
    continues with the restore process</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2023-04-25_1133"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1521636080">2023-04-25 11:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-25_1133" title="Permanent link">&para;</a></h4>
<p>@codefritzel<br />
thank you for your contribution to enhance ReaR!</p>
<h4 id="jsmeix_commented_at_2023-04-25_1144"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1521648590">2023-04-25 11:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-04-25_1144" title="Permanent link">&para;</a></h4>
<p>All new added files are shown in<br />
<a href="https://github.com/rear/rear/pull/2973/files">https://github.com/rear/rear/pull/2973/files</a><br />
with a "No newline at end of file" mark<br />
which means the last line does not end with a newline character.<br />
As far as I know a newline character at the end of every line<br />
(including the last line) is required at least by some programs<br />
that read input line by line where only the newline character<br />
marks the end of a line so that a line without terminating<br />
newline character will not be read by such programs.</p>
<h4 id="gdha_commented_at_2023-04-26_1033"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1523194991">2023-04-26 10:33</a>:<a class="headerlink" href="#gdha_commented_at_2023-04-26_1033" title="Permanent link">&para;</a></h4>
<p>@codefritzel Could you please add some clear clarification why you need
a NFS_SERVER workflow? Is NFS client not enough?</p>
<h4 id="schlomo_commented_at_2023-04-26_1047"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1523211327">2023-04-26 10:47</a>:<a class="headerlink" href="#schlomo_commented_at_2023-04-26_1047" title="Permanent link">&para;</a></h4>
<p>I can add some more context for this, I see three main scenarios for
restore via NFS server:</p>
<ol>
<li>In some cases there is a problem running the backup client in our
    rescue system, and then it might be "cheaper" to use an indirect
    restore scheme instead of spending more hours on enabling our rescue
    system to support that piece of commercial software</li>
<li>From a security perspective, it is always better to connect from a
    high-security ("bastion") system to the periphery. For backups this
    means that one could implement an NFS-based backup solution with
    <strong>pulling</strong> the date onto a central server. For restore we then need
    to start an NFS server in ReaR to <strong>push</strong> the data back. This could
    be part of a self-written solution or even use a commercial backup
    tool that is installed only on the central backup server for
    licensing or other reasons.</li>
<li>Implement asymmetric solutions, using one tool for backup and
    another tool for restore, in this case via NFS</li>
</ol>
<p>In all those cases adding NFS server capabilities to the ReaR rescue
system is IMHO a useful addition. I'd also consider modifying it to be
an optional add-on feature instead of a stand-alone backup method. I
also envision introducing a general split of <code>BACKUP</code> and <code>RESTORE</code>, if
somebody needs this.</p>
<h4 id="gdha_commented_at_2023-04-26_1158"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1523295046">2023-04-26 11:58</a>:<a class="headerlink" href="#gdha_commented_at_2023-04-26_1158" title="Permanent link">&para;</a></h4>
<p>@schlomo Thanks for the heads up as it makes it clear to me why it might
be useful.<br />
@codefritzel That being said please add some more comments from your
side of the need of this new workflow, not just that it could be useful.
And, above all, without proper documentation it will be a workflow only
used by a happy few (amongst yourself I'm afraid).</p>
<h4 id="schlomo_commented_at_2023-05-02_2016"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1532091568">2023-05-02 20:16</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-02_2016" title="Permanent link">&para;</a></h4>
<p>Thanks a lot @codefritzel for the rework, I added you a bunch of minor
fixes/changes and then I think we are good to go.</p>
<h4 id="pcahyna_commented_at_2023-05-03_1026"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1532787004">2023-05-03 10:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-03_1026" title="Permanent link">&para;</a></h4>
<p>Hi, looks useful, but I have a question: will the various extended
attributes/ACLs get restored properly? SELinux contexts are probably
handled in <code>usr/share/rear/restore/default/500_selinux_autorelabel.sh</code>,
but there are other extended attributes that matter. See:</p>
<pre><code>$ getfattr -m- -nsecurity.capability - /usr/sbin/* /usr/bin/* 2&gt;/dev/null
# file: usr/sbin/arping
security.capability=0sAAAAAgAgAAAAAAAAAAAAAAAAAAA=

# file: usr/sbin/clockdiff
security.capability=0sAAAAAgAgAAAAAAAAAAAAAAAAAAA=

# file: usr/bin/newgidmap
security.capability=0sAQAAAkAAAAAAAAAAAAAAAAAAAAA=

# file: usr/bin/newuidmap
security.capability=0sAQAAAoAAAAAAAAAAAAAAAAAAAAA=
</code></pre>
<p>AFAIK if one uses NFSv4.2, then one is able to use such attributes over
the NFS mount, but I have not tried it. <code>-V 4.2</code> needs to be passed to
<code>rpc.nfsd</code> and mount option <code>v4.2</code> (or <code>nfsvers=4.2</code>?) should be
specified.</p>
<h4 id="pcahyna_commented_at_2023-05-03_1438"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1533143851">2023-05-03 14:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-05-03_1438" title="Permanent link">&para;</a></h4>
<p>Another question about NFS. Is NFSv4 required because of its ability to
automatically export and access filesystems mounted under the exported
filesystem, i.e. to cross mountpoints? Seems pretty crucial for use in
ReaR.</p>
<h4 id="codefritzel_commented_at_2023-05-03_1543"><img src="https://avatars.githubusercontent.com/u/118316875?v=4" width="50"><a href="https://github.com/codefritzel">codefritzel</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1533273560">2023-05-03 15:43</a>:<a class="headerlink" href="#codefritzel_commented_at_2023-05-03_1543" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Another question about NFS. Is NFSv4 required because of its ability
to automatically export and access filesystems mounted under the
exported filesystem, i.e. to cross mountpoints? Seems pretty crucial
for use in ReaR.</p>
</blockquote>
<p>@pcahyna that is one reason and it is much easier to support only v4
than v2, v3 and v4 together.</p>
<h4 id="schlomo_commented_at_2023-05-03_1554"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/pull/2973#issuecomment-1533290830">2023-05-03 15:54</a>:<a class="headerlink" href="#schlomo_commented_at_2023-05-03_1554" title="Permanent link">&para;</a></h4>
<p>Thank you everybody for reviewing this. I'm going forward and merging it
now, we'll continue to improve this code as it undergoes more testing in
production.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-04-25.2973.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
