<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2016 07 06.904.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2016 07 06.904.issue.closed";
        var mkdocs_page_input_path = "issues/2016-07-06.904.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2016 07 06.904.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="904_issue_closed_speedup_rear_by_changing_compression_level"><a href="https://github.com/rear/rear/issues/904">#904 Issue</a> <code>closed</code>: Speedup REAR by changing compression level?<a class="headerlink" href="#904_issue_closed_speedup_rear_by_changing_compression_level" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="stoxxys_opened_issue_at_2016-07-06_1428"><img src="https://avatars.githubusercontent.com/u/20321580?v=4" width="50"><a href="https://github.com/stoxxys">stoxxys</a> opened issue at <a href="https://github.com/rear/rear/issues/904">2016-07-06 14:28</a>:<a class="headerlink" href="#stoxxys_opened_issue_at_2016-07-06_1428" title="Permanent link">&para;</a></h4>
<p>I am looking for a possibility to speedup the backup process by changing
the compression level of gzip. It works fine but it is really slow
caused by the usage of only one CPU.</p>
<p>I tried to use only tar. It works fine with an acceptable speed but I
want to use a low compression to save diskspace.The default
compressionlevel is 6. I think compressionlevel 4 would be a good deal.</p>
<p>Does anyone know how I can edit these compression settings in REAR?</p>
<p>OS= openSUSE 42.1<br />
REAR-Version= 1.18</p>
<h4 id="jsmeix_commented_at_2016-07-06_1514"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-230803746">2016-07-06 15:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-06_1514" title="Permanent link">&para;</a></h4>
<p>SUSE issues belog to me.<br />
I will have a look...</p>
<h4 id="gdha_commented_at_2016-07-07_1604"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-231126185">2016-07-07 16:04</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-07_1604" title="Permanent link">&para;</a></h4>
<p>@jsmeix Have a look at
<a href="http://www.it3.be/2013/09/16/NETFS-compression-tests/">http://www.it3.be/2013/09/16/NETFS-compression-tests/</a></p>
<h4 id="stoxxys_commented_at_2016-07-08_0617"><img src="https://avatars.githubusercontent.com/u/20321580?v=4" width="50"><a href="https://github.com/stoxxys">stoxxys</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-231283844">2016-07-08 06:17</a>:<a class="headerlink" href="#stoxxys_commented_at_2016-07-08_0617" title="Permanent link">&para;</a></h4>
<p>Thanks for the information gdha. I already know that information. Other
formats like bzip and xz are much slower than gzip.<br />
I am looking for a way to change the gzip compression level. I want to
use gzip.</p>
<h4 id="jsmeix_commented_at_2016-07-12_1423"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232063150">2016-07-12 14:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-12_1423" title="Permanent link">&para;</a></h4>
<p>According to<br />
<a href="https://www.gnu.org/software/tar/manual/html_node/gzip.html#SEC134">https://www.gnu.org/software/tar/manual/html_node/gzip.html#SEC134</a><br />
the tar -I option can override the defaults like</p>
<pre>
tar -c -I 'gzip -9 -n -c' -f archive.tar.gz directory
</pre>

<p>but in /etc/rear/local.conf</p>
<pre>
BACKUP_PROG_COMPRESS_OPTIONS="-I 'gzip -9 -n -c'"
</pre>

<p>does not work because in<br />
usr/share/rear/backup/NETFS/default/50_make_backup.sh<br />
it is used as</p>
<pre>
case "$(basename ${BACKUP_PROG})" in
    # tar compatible programs here
    (tar)
    ...
        $BACKUP_PROG $TAR_OPTIONS ...  \
        ...
        ... $BACKUP_PROG_COMPRESS_OPTIONS \
</pre>

<p>which leads to a quoting hell where I failed to escape<br />
from it with reasonable effort.</p>
<p>According to<br />
<a href="http://superuser.com/questions/360966/how-do-i-use-a-bash-variable-string-containing-quotes-in-a-command">http://superuser.com/questions/360966/how-do-i-use-a-bash-variable-string-containing-quotes-in-a-command</a><br />
and other such postings the best way out of quoting hell is</p>
<pre>
Putting commands (or parts of commands) into variables
and then getting them back out intact is complicated.
...
Usually, the best way to do this sort of thing is using
an array instead of a simple text variable:
FLAGS=(--archive --exclude="foo bar.txt")
rsync "${FLAGS[@]}" dir1 dir2
</pre>

<p>Example:</p>
<pre>
# BACKUP_PROG_COMPRESS_OPTIONS=(-I 'gzip -9 -n -c')
# set -x
# tar -c -v "${BACKUP_PROG_COMPRESS_OPTIONS[@]}" -f archive.tar.gz directory
+ tar -c -v -I 'gzip -9 -n -c' -f archive.tar.gz directory
</pre>

<p>As time permits I will play around with it...</p>
<h4 id="jsmeix_commented_at_2016-07-12_1431"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232065858">2016-07-12 14:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-12_1431" title="Permanent link">&para;</a></h4>
<p>Wow!</p>
<p>It seems (at least on SLE11 and SLE12) that bash is<br />
tolerant regarding array versus simple text variable.</p>
<p>In particular one can generally use ${VAR[@]}<br />
also to get the value of a simple text variable:</p>
<pre>
# BACKUP_PROG_COMPRESS_OPTIONS=foo
# echo "'$BACKUP_PROG_COMPRESS_OPTIONS'"
'foo'
# echo "'${BACKUP_PROG_COMPRESS_OPTIONS[@]}'"
'foo'
</pre>

<p>This way it seems I can change<br />
usr/share/rear/backup/NETFS/default/50_make_backup.sh<br />
in a backward compatible way so that it still works when<br />
BACKUP_PROG_COMPRESS_OPTIONS is defined<br />
as a simple text variable but also when it is defined as<br />
an array.</p>
<h4 id="jsmeix_commented_at_2016-07-12_1508"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232077910">2016-07-12 15:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-12_1508" title="Permanent link">&para;</a></h4>
<p>It seems basically with simple replacing of all</p>
<pre>
$BACKUP_PROG_COMPRESS_OPTIONS
</pre>

<p>with</p>
<pre>
"${BACKUP_PROG_COMPRESS_OPTIONS[@]}"
</pre>

<p>in usr/share/rear/backup/NETFS/default/50_make_backup.sh<br />
and usr/share/rear/restore/NETFS/default/40_restore_backup.sh<br />
makes it work for me with things like</p>
<pre>
BACKUP_PROG_COMPRESS_OPTIONS=(-I 'gzip -9 -n -c')
</pre>

<p>in /etc/rear/local.conf</p>
<p>@stoxxys<br />
please test if it also works for you this way<br />
and provide feedback.</p>
<h4 id="schlomo_commented_at_2016-07-12_1746"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232123585">2016-07-12 17:46</a>:<a class="headerlink" href="#schlomo_commented_at_2016-07-12_1746" title="Permanent link">&para;</a></h4>
<p>@jsmeix this is actually standard behavior for Bash and the reason why I
recommend to implement all variables like this as an array. It doesn't
cost us anything and it enables the users to provide more complex
values.</p>
<h4 id="jsmeix_commented_at_2016-07-13_0858"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232297896">2016-07-13 08:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-13_0858" title="Permanent link">&para;</a></h4>
<p>@schlomo<br />
many thanks for your information!</p>
<p>It means that I can implement it in this way<br />
without fear of backward incompatible regressions.</p>
<h4 id="jsmeix_commented_at_2016-07-13_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232310386">2016-07-13 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-13_0954" title="Permanent link">&para;</a></h4>
<p>I verified that
<a href="https://github.com/rear/rear/issues/904#issuecomment-232065858">https://github.com/rear/rear/issues/904#issuecomment-232065858</a><br />
also works on SLE10 which has bash version 3.1.17<br />
(SLE11 has bash version 3.2.51 and SLE12 has 4.2.47).</p>
<h4 id="jsmeix_commented_at_2016-07-13_1351"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232361151">2016-07-13 13:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-13_1351" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/912">https://github.com/rear/rear/pull/912</a><br />
this enhancement should be implemented.</p>
<p>Note that tar version &gt;= 1.27 is required for<br />
using it with command options (like 'gzip -9') in</p>
<pre>
BACKUP_PROG_COMPRESS_OPTIONS=( -I 'gzip -9 -n -c' )
</pre>

<p>because only<br />
since tar version 1.27 tar supports passing command<br />
line arguments to external commands, see<br />
/usr/share/rear/conf/default.conf</p>
<h4 id="jsmeix_commented_at_2016-07-14_1442"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-232685958">2016-07-14 14:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-07-14_1442" title="Permanent link">&para;</a></h4>
<p>FYI<br />
some statistics how the gzip compression level from 1 to 9<br />
makes a difference on my particular SLES12-SP1 test system:</p>
<p>I specified in etc/rear/local.conf from</p>
<pre>
BACKUP_PROG_COMPRESS_OPTIONS=( -I 'gzip -1 -n -c' )
</pre>

<p>to</p>
<pre>
BACKUP_PROG_COMPRESS_OPTIONS=( -I 'gzip -9 -n -c' )
</pre>

<p>and got for the gzip compression level from 1 to 9<br />
those backup.tar.gz sizes and the time and speed<br />
to make each (according to the last line in backup.log):</p>
<pre>
-1 : 1286M backup.tar.gz in 129.191 s at 10.4 MB/s
-2 : 1270M backup.tar.gz in 131.495 s at 10.1 MB/s
-3 : 1256M backup.tar.gz in 139.401 s at 9.4 MB/s
-4 : 1232M backup.tar.gz in 140.011 s at 9.2 MB/s
-5 : 1217M backup.tar.gz in 165.636 s at 7.7 MB/s
-6 : 1210M backup.tar.gz in 174.397 s at 7.3 MB/s
-7 : 1208M backup.tar.gz in 194.586 s at 6.5 MB/s
-8 : 1206M backup.tar.gz in 271.525 s at 4.7 MB/s
-9 : 1205M backup.tar.gz in 383.796 s at 3.3 MB/s
</pre>

<p>Interestingly for me gzip compression level 9<br />
needs almost three times more time but results<br />
only about 7% less backup.tar.gz size<br />
compared to gzip compression level 1.</p>
<p>@stoxxys<br />
what are your results with that new feature?</p>
<h4 id="stoxxys_commented_at_2016-07-26_1157"><img src="https://avatars.githubusercontent.com/u/20321580?v=4" width="50"><a href="https://github.com/stoxxys">stoxxys</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-235246564">2016-07-26 11:57</a>:<a class="headerlink" href="#stoxxys_commented_at_2016-07-26_1157" title="Permanent link">&para;</a></h4>
<p>I have tested the new feature an it works great!</p>
<p>Thanks a lot</p>
<h4 id="jsmeix_commented_at_2023-01-19_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/904#issuecomment-1396936615">2023-01-19 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-19_1258" title="Permanent link">&para;</a></h4>
<p>Changing a string variable into an array<br />
works usually backward compatible as in<br />
<a href="https://github.com/rear/rear/issues/904#issuecomment-232065858">https://github.com/rear/rear/issues/904#issuecomment-232065858</a><br />
but in special cases it is not backward compatible:</p>
<p>In particular one cannot simply use</p>
<pre><code>BACKUP_PROG_COMPRESS_OPTIONS=""
</code></pre>
<p>instead of the right</p>
<pre><code>BACKUP_PROG_COMPRESS_OPTIONS=()
</code></pre>
<p>because during "rear recover" (with BACKUP=NETFS with usual 'tar')<br />
the former (i.e. BACKUP_PROG_COMPRESS_OPTIONS="")<br />
makes <code>tar ... -C /mnt/local/</code> untar the whole backup.tar<br />
into the '/root' directory inside the ReaR recovery system, see<br />
<a href="https://github.com/rear/rear/issues/2911#issuecomment-1387056556">https://github.com/rear/rear/issues/2911#issuecomment-1387056556</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-07-06.904.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
