<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1774 Issue closed: RHEL 6 & 7 utility tmpwatch deletes backups (e.g. in case of BACKUP=SSHFS) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1774 Issue closed: RHEL 6 \u0026 7 utility tmpwatch deletes backups (e.g. in case of BACKUP=SSHFS)";
        var mkdocs_page_input_path = "issues/2018-04-12.1774.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#1774 Issue closed: RHEL 6 & 7 utility tmpwatch deletes backups (e.g. in case of BACKUP=SSHFS)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1774_issue_closed_rhel_6_7_utility_tmpwatch_deletes_backups_eg_in_case_of_backupsshfs"><a href="https://github.com/rear/rear/issues/1774">#1774 Issue</a> <code>closed</code>: RHEL 6 &amp; 7 utility tmpwatch deletes backups (e.g. in case of BACKUP=SSHFS)<a class="headerlink" href="#1774_issue_closed_rhel_6_7_utility_tmpwatch_deletes_backups_eg_in_case_of_backupsshfs" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>not ReaR / invalid</code></p>
<h4 id="john-leone_opened_issue_at_2018-04-12_1337"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> opened issue at <a href="https://github.com/rear/rear/issues/1774">2018-04-12 13:37</a>:<a class="headerlink" href="#john-leone_opened_issue_at_2018-04-12_1337" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Relax-and-Recover 2.00 / Git</p>
<pre><code>[root@xrearm2d rear]# cat /etc/rear/os.conf
OS_VENDOR=RedHatEnterpriseServer
OS_VERSION=6

# This file (local.conf) is intended for manual configuration. For configuration
# through packages and other automated means we recommend creating a new
# file named site.conf next to this file and to leave the local.conf as it is.
# Our packages will never ship with a site.conf.
#
export TMPDIR="/mnt/rear/"
OUTPUT=ISO
BACKUP=NETFS
OUTPUT_URL=sshfs://root@xxx.xxx.xxx.xxx/dbar/
BACKUP_URL=sshfs://root@xxx.xxx.xxx.xxx/dbar/
KEEP_OLD_OUTPUT_COPY=1
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/var/cache/yum')
</code></pre>
<p>x86</p>
<p>Hello,<br />
This is informational only, we use SSHFS to run ReaR for backups. During
a backup, SSHFS creates a working area mount point in /tmp. The mount is
/tmp/rear.xxxxxxxx/outputfs.<br />
We always run backups during the overnight hours, and noticed files were
being deleted from our backup servers. After searching for three months
on why our backups were deleted we found the issue.<br />
Redhat 6 &amp; 7 has utilities called <strong>tmpwatch</strong> and <strong>tmpfiles</strong> that run
daily. These utilities delete files greater than 10 days old from <code>/tmp</code>
and <code>/var/tmp</code>. So during the night when ReaR was backing up a server
and if <strong>tmpwatch</strong> started at the same time, <strong>tmpwatch</strong> would
traverse <code>/tmp</code> and delete backups greater that 10 days old on our
backup server.<br />
The resolution was to change the location of <em>TMPDIR</em> in the local.conf.</p>
<p>Thanks,<br />
John</p>
<h4 id="gozora_commented_at_2018-04-12_1451"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/1774#issuecomment-380833396">2018-04-12 14:51</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-12_1451" title="Permanent link">&para;</a></h4>
<p>This is exact reason why I'm not a fan of automatic cleanup scripts.
There is always that "little something" that should not pass the cleanup
filter, but it does (for whatever reason).<br />
BTW <em>/var/tmp</em> could be subject for cleanup as well, I'd even say that
is is option # 2 for cleanup right after <em>/tmp</em>, so I'd not consider
this final solution either, but that is just matter of taste.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2018-04-13_0653"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1774#issuecomment-381041813">2018-04-13 06:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-13_0653" title="Permanent link">&para;</a></h4>
<p>@John-Leone<br />
many thanks for your information and in particular<br />
for your explanatory description what goes on<br />
so that even I - as non Red Hat user - can easily<br />
understand what goes on on your system.</p>
<p>As far as I understand it it looks as if there is a severe bug<br />
in that tmpfiles cleaning utility because it seems it does not limit<br />
its work on the one filesystem where /tmp directly belongs to<br />
(i.e. that cleaning utility is cossing filesystem boundaries).</p>
<p>As a test on a testing virtual machine where it does not matter<br />
when it gets destroyed I would mount e.g. /usr/ at /tmp/usrmountpoint<br />
and watch what that tmpfiles cleaning utility does with files in /usr<br />
that are older than 10 days ...</p>
<h4 id="john-leone_commented_at_2018-04-13_1134"><img src="https://avatars.githubusercontent.com/u/18706709?v=4" width="50"><a href="https://github.com/John-Leone">John-Leone</a> commented at <a href="https://github.com/rear/rear/issues/1774#issuecomment-381108285">2018-04-13 11:34</a>:<a class="headerlink" href="#john-leone_commented_at_2018-04-13_1134" title="Permanent link">&para;</a></h4>
<p>I'm in agreement with you, we think this is a Redhat bug.<br />
I did open a case with Redhat to report this problem.<br />
Adding the TMPDIR variable will solve this problem for us but I know
anyone using CentOS or Fedora can encounter this problem too.</p>
<h4 id="jsmeix_commented_at_2018-04-13_1213"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1774#issuecomment-381116595">2018-04-13 12:13</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-13_1213" title="Permanent link">&para;</a></h4>
<p>Only FYI regarding <code>/tmp</code> and <code>/var/tmp</code> cleanup<br />
see in general e.g.<br />
<a href="https://unix.stackexchange.com/questions/30489/what-is-the-difference-between-tmp-and-var-tmp">https://unix.stackexchange.com/questions/30489/what-is-the-difference-between-tmp-and-var-tmp</a><br />
and<br />
<a href="https://en.opensuse.org/openSUSE:Tmp_on_tmpfs#.2Ftmp.2F_versus_.2Fvar.2Ftmp.2F">https://en.opensuse.org/openSUSE:Tmp_on_tmpfs#.2Ftmp.2F_versus_.2Fvar.2Ftmp.2F</a><br />
and<br />
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard</a><br />
and in particular regarding FHS see<br />
<a href="http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch03s18.html">http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch03s18.html</a></p>
<pre>
3.18. /tmp : Temporary files

3.18.1. Purpose
The /tmp directory must be made available for programs
that require temporary files.

Programs must not assume that any files or directories
in /tmp are preserved between invocations of the program.
Rationale

IEEE standard POSIX.1-2008 lists requirements similar
to the above section.

Although data stored in /tmp may be deleted
in a site-specific manner, it is recommended
that files and directories located in /tmp
be deleted whenever the system is booted.

FHS added this recommendation on the basis
of historical precedent and common practice,
but did not make it a requirement because
system administration is not within the scope of this standard.
</pre>

<p><a href="http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s15.html">http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch05s15.html</a></p>
<pre>
5.15. /var/tmp : Temporary files preserved between system reboots

5.15.1. Purpose

The /var/tmp directory is made available for programs
that require temporary files or directories that are
preserved between system reboots.
Therefore, data stored in /var/tmp is more persistent
than data in /tmp.

Files and directories located in /var/tmp must not be deleted
when the system is booted. Although data stored in /var/tmp
is typically deleted in a site-specific manner, it is recommended
that deletions occur at a less frequent interval than /tmp.
</pre>

<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-04-12.1774.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
