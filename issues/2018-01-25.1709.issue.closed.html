<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1709 Issue closed: Default setting of USE_SERIAL_CONSOLE considered dangerous in migration mode - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1709 Issue closed: Default setting of USE_SERIAL_CONSOLE considered dangerous in migration mode";
        var mkdocs_page_input_path = "issues/2018-01-25.1709.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1709 Issue closed: Default setting of USE_SERIAL_CONSOLE considered dangerous in migration mode</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1709_issue_closed_default_setting_of_use_serial_console_considered_dangerous_in_migration_mode"><a href="https://github.com/rear/rear/issues/1709">#1709 Issue</a> <code>closed</code>: Default setting of USE_SERIAL_CONSOLE considered dangerous in migration mode<a class="headerlink" href="#1709_issue_closed_default_setting_of_use_serial_console_considered_dangerous_in_migration_mode" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>documentation</code>, <code>discuss / RFC</code></p>
<h4 id="olivero2_opened_issue_at_2018-01-25_1331"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> opened issue at <a href="https://github.com/rear/rear/issues/1709">2018-01-25 13:31</a>:<a class="headerlink" href="#olivero2_opened_issue_at_2018-01-25_1331" title="Permanent link">&para;</a></h4>
<p>In ReaR 2.3, the default of <code>USE_SERIAL_CONSOLE</code> is determined by
checking for at least one of <code>/dev/ttyS[0-9]*</code> being operational
(<code>200_include_serial_console.sh</code>). This leads to an incomplete boot on a
rescue system if none of <code>/dev/ttyS[0-9]*</code> is connected to an actual
console.</p>
<p>I have seen the following behavior with rescue images generated on a
bare metal server with <code>ttyS[012]</code>:</p>
<h4 id="boot_appears_to_hang_devttys0_operational_on_the_recovery_system_but_not_connected_to_an_actual_console">Boot appears to hang (<code>/dev/ttyS0</code> operational on the recovery system but not connected to an actual console)<a class="headerlink" href="#boot_appears_to_hang_devttys0_operational_on_the_recovery_system_but_not_connected_to_an_actual_console" title="Permanent link">&para;</a></h4>
<p>Only kernel messages were appearing on the virtual console device:</p>
<pre><code>[   19.918450] EDD information not available.
[   20.099473] Freeing unused kernel memory: 1548K (ffffffff83b6a000 - ffffffff83ced000)
[   20.508457] Write protecting the kernel read-only data: 14336k
[   20.738752] Freeing unused kernel memory: 1396K (ffff8d09640a3000 - ffff8d0964200000)
[   21.078851] Freeing unused kernel memory: 260K (ffff8d09645bf000 - ffff8d0964600000)
[   21.433765] x86/mm: Checked W+X mappings: passed, no W+X pages found.
[   21.681982] random: systemd: uninitialized urandom read (16 bytes read)
[   22.018999] random: systemd: uninitialized urandom read (16 bytes read)
[   22.368529] random: systemd: uninitialized urandom read (16 bytes read)
[   22.640103] random: systemd: uninitialized urandom read (16 bytes read)
[   22.709686] random: systemd: uninitialized urandom read (16 bytes read)
[   22.714752] random: systemd: uninitialized urandom read (16 bytes read)
[   23.110639] random: systemd: uninitialized urandom read (16 bytes read)
[   23.408483] random: systemd: uninitialized urandom read (16 bytes read)
[   23.708502] random: systemd: uninitialized urandom read (16 bytes read)
[   24.029080] random: systemd: uninitialized urandom read (16 bytes read)
</code></pre>
<p>...and the system appeared to hang...</p>
<p>...while the important stuff was hidden from view (only showing up on
the serial port <code>/dev/ttyS0</code> which was not connected to an actual
console):</p>
<pre><code>Running 42-engage-scsi.sh...
Running 45-serial-console.sh...
Serial console support enabled for ttyS0 at speed 9600
Serial console support enabled for ttyS1 at speed 9600
Serial console support enabled for ttyS2 at speed 9600
Running 55-migrate-network-devices.sh...
No network interface mapping is specified in /etc/rear/mappings/mac
The original network interface em1 00:25:90:d5:50:be is not available
1) eth0 08:00:27:92:4e:ea e1000
2) Skip replacing em1 00:25:90:d5:50:be
Choose replacement for em1 00:25:90:d5:50:be
</code></pre>
<h4 id="boot_is_incomplete_because_etcscriptssystem-setup_fails_devttys0_is_operational_on_the_recovery_system_but_not_connected_to_an_actual_console">Boot is incomplete because <code>/etc/scripts/system-setup</code> fails (<code>/dev/ttyS0</code> is operational on the recovery system but not connected to an actual console)<a class="headerlink" href="#boot_is_incomplete_because_etcscriptssystem-setup_fails_devttys0_is_operational_on_the_recovery_system_but_not_connected_to_an_actual_console" title="Permanent link">&para;</a></h4>
<pre><code>sysinit.service: Failed at step STDIN spawning /etc/scripts/system-setup: Inappropriate ioctl for device
</code></pre>
<p>In my view it would be safer to set <code>USE_SERIAL_CONSOLE='n'</code> in
<code>default.conf</code>. Then, if serial console auto-detection was desired, it
would have to be stated explicitly (maybe even use an <code>auto</code> term for
that instead of the current empty setting). What do you think?</p>
<h4 id="jsmeix_commented_at_2018-01-25_1430"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-360482562">2018-01-25 14:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-25_1430" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
this issue is perhaps of interest for you<br />
because you implemented recently something<br />
related to serial console setup in the recovery system<br />
<a href="https://github.com/rear/rear/pull/1649">https://github.com/rear/rear/pull/1649</a></p>
<p>@gdha<br />
perhaps this issue is also of interest for you because of your<br />
<a href="https://github.com/rear/rear/issues/1644">https://github.com/rear/rear/issues/1644</a></p>
<h4 id="jsmeix_commented_at_2018-01-25_1435"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-360484227">2018-01-25 14:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-25_1435" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
in general regarding debugging issues with the start up scripts<br />
that are run initially in the ReaR recovery system have a look at<br />
<a href="https://github.com/rear/rear/issues/1703#issuecomment-360398508">https://github.com/rear/rear/issues/1703#issuecomment-360398508</a></p>
<h4 id="didacog_commented_at_2018-01-26_0900"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-360721836">2018-01-26 09:00</a>:<a class="headerlink" href="#didacog_commented_at_2018-01-26_0900" title="Permanent link">&para;</a></h4>
<p>@OliverO2 what OS versions are you using?<br />
We tested this with Centos/RHEL 7 and Debian/Ubuntu (systemd) booting
rescue with and without serial devices attached and/or in use, also with
Physical and Virtual systems, and booted as expected after the last
changes were applied.</p>
<p>Regards,<br />
Didac</p>
<h4 id="jsmeix_commented_at_2018-01-26_1332"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-360785296">2018-01-26 13:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-01-26_1332" title="Permanent link">&para;</a></h4>
<p>@OliverO2<br />
in general we cannot "just change" a ReaR default behaviour<br />
because that would be perceived as a regression by this or that users<br />
who use ReaR under the assumption that the default behaviour<br />
is a reliable behaviour (i.e. the old problem when some default<br />
of whatever software is actually required by some users).</p>
<p>In particular if we set USE_SERIAL_CONSOLE='n' in default.conf<br />
it would be perceived as a regression by those users who currently use
ReaR<br />
under the assumption that ReaR "just reliably supports" their serial
console.</p>
<p>Ideally we could avoid this issue here by making the scripts<br />
and the systemd unit files that set up serial console in the<br />
recovery system behave more robust against possible failure.</p>
<p>Simply put:<br />
When only serial console setup fails in the recovery system<br />
this is no reason to let the whole recovery system setup fail.</p>
<h4 id="olivero2_commented_at_2018-01-29_2109"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-361387260">2018-01-29 21:09</a>:<a class="headerlink" href="#olivero2_commented_at_2018-01-29_2109" title="Permanent link">&para;</a></h4>
<p>@didacog I tested on Ubuntu 16.04.3 LTS server. The issues came up when
restoring a rescue system built on a production bare metal server
(Supermicro X10SLH-F mainboard with IPMI support). I've tried but was
unable to reproduce those on a minimal Ubuntu server running as a
VirtualBox guest.</p>
<p>@jsmeix I am aware that addressing this would be a backward-incompatible
change. Failing gracefully on startup would be an alternative but might
not be that easy to implement. Anyway, if this feature is kept as is,
hopefully users could at least consult this issue when they experience
seemingly hanging or incomplete boots of their rescue system.</p>
<h4 id="gdha_commented_at_2018-11-04_0954"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-435656132">2018-11-04 09:54</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-04_0954" title="Permanent link">&para;</a></h4>
<p>@OliverO2 Do you experience this also with a recent Ubuntu version?</p>
<h4 id="olivero2_commented_at_2018-11-04_1535"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-435679455">2018-11-04 15:35</a>:<a class="headerlink" href="#olivero2_commented_at_2018-11-04_1535" title="Permanent link">&para;</a></h4>
<p>@gdha I haven't had the chance to test this as the (only) affected
system over here has not been migrated to a newer Ubuntu version yet.</p>
<h4 id="gdha_commented_at_2019-03-22_0856"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-475540955">2019-03-22 08:56</a>:<a class="headerlink" href="#gdha_commented_at_2019-03-22_0856" title="Permanent link">&para;</a></h4>
<p>@OliverO2 any idea if this issue is still relevant to keep it open?</p>
<h4 id="olivero2_commented_at_2019-03-23_1625"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-475883429">2019-03-23 16:25</a>:<a class="headerlink" href="#olivero2_commented_at_2019-03-23_1625" title="Permanent link">&para;</a></h4>
<p>@gdha I'll probably try this one again in April on Ubuntu 18.04. If I
get results, I'll post them here. If you wish, you can as well close it
for now, since it seems to depend on rare circumstances, so the issue is
mostly for documentation.</p>
<h4 id="olivero2_commented_at_2019-04-30_1451"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-487983433">2019-04-30 14:51</a>:<a class="headerlink" href="#olivero2_commented_at_2019-04-30_1451" title="Permanent link">&para;</a></h4>
<p>Last day of April, so here we go:</p>
<p>I have tested this again with a current rear snapshot (f3157906) on
Ubuntu 18.04.2 LTS:</p>
<ul>
<li>I have used the same bare metal server to create the rescue system
    on which the problem initially appeared.</li>
<li>I have started the rescue system on<ul>
<li>a bare metal restoration system as well as</li>
<li>VirtualBox VMs with and without hardware serial ports
    configured.</li>
</ul>
</li>
<li>Migration mode was always active with network interface questions
    being asked during startup.</li>
<li><code>USE_SERIAL_CONSOLE</code> was always left at its default setting.</li>
</ul>
<p><strong>The problem did not reappear in any scenario.</strong></p>
<p>So maybe it would be worth re-trying the other case (#2102) with ReaR
2.5 once that version is released. If that one would be also resoved,
the issue has probably been fixed in the mean time.</p>
<h4 id="geksi_commented_at_2019-05-02_1221"><img src="https://avatars.githubusercontent.com/u/48321425?v=4" width="50"><a href="https://github.com/geksi">geksi</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-488651325">2019-05-02 12:21</a>:<a class="headerlink" href="#geksi_commented_at_2019-05-02_1221" title="Permanent link">&para;</a></h4>
<p>This issue appear only with virsh console on kvm. Everytime in migration
mode.</p>
<h4 id="olivero2_commented_at_2019-05-02_1224"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/1709#issuecomment-488652121">2019-05-02 12:24</a>:<a class="headerlink" href="#olivero2_commented_at_2019-05-02_1224" title="Permanent link">&para;</a></h4>
<p>In #2102 you have stated the ReaR version to be 2.4.3. Have you ever
tried a current Git snapshot of ReaR?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2026 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-01-25.1709.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
