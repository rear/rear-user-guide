<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1407 Issue closed: Master: SLES11 SP4 on Power: unable to boot generated iso image, yaboot missing on iso image - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1407 Issue closed: Master: SLES11 SP4 on Power: unable to boot generated iso image, yaboot missing on iso image";
        var mkdocs_page_input_path = "issues/2017-07-13.1407.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#1407 Issue closed: Master: SLES11 SP4 on Power: unable to boot generated iso image, yaboot missing on iso image</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1407_issue_closed_master_sles11_sp4_on_power_unable_to_boot_generated_iso_image_yaboot_missing_on_iso_image"><a href="https://github.com/rear/rear/issues/1407">#1407 Issue</a> <code>closed</code>: Master: SLES11 SP4 on Power: unable to boot generated iso image, yaboot missing on iso image<a class="headerlink" href="#1407_issue_closed_master_sles11_sp4_on_power_unable_to_boot_generated_iso_image_yaboot_missing_on_iso_image" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="abbbi_opened_issue_at_2017-07-13_0941"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> opened issue at <a href="https://github.com/rear/rear/issues/1407">2017-07-13 09:41</a>:<a class="headerlink" href="#abbbi_opened_issue_at_2017-07-13_0941" title="Permanent link">&para;</a></h4>
<p>hi there,</p>
<p>as our internal Power8 System has now some spare LPAR i can use, so i
have the chance<br />
to do some testing with REAR on Power.</p>
<p>Im using the latest head git checkout.<br />
Installed is a SLES11 SP4 for Power.</p>
<p>REAR creates the ISO Image using mkisofs like the following:</p>
<pre><code>[..]
Warning: creating filesystem that does not conform to ISO-9660.
genisoimage 1.1.8 (Linux)
Scanning etc
Scanning ppc
Scanning ppc/chrp
  28   706
  29   332 etc
  30   448 ppc
  31   204 chrp
Cache hit for '/..'
      37    19010 initrd.cgz
   19011    29170 /tmp/rear.wBJNqEyYRNSbHYB/tmp/kernel
   29171    29171 etc/yaboot.conf
   29172    29172 ppc/bootinfo.txt
Cache hit for 'chrp/.'
Creating 1 PReP boot partition(s)
CHRP boot partition 1
Writing:   HFS volume header                       Start Block 0
Done with: HFS volume header                       Block(s)    4
Writing:   Initial Padblock                        Start Block 4
Done with: Initial Padblock                        Block(s)    12
Writing:   Primary Volume Descriptor               Start Block 16
Done with: Primary Volume Descriptor               Block(s)    1
Writing:   Joliet Volume Descriptor                Start Block 17
Done with: Joliet Volume Descriptor                Block(s)    1
Writing:   End Volume Descriptor                   Start Block 18
Done with: End Volume Descriptor                   Block(s)    1
Writing:   Version block                           Start Block 19
Done with: Version block                           Block(s)    1
Writing:   Path table                              Start Block 20
Done with: Path table                              Block(s)    4
Writing:   Joliet path table                       Start Block 24
Done with: Joliet path table                       Block(s)    4
Writing:   Directory tree                          Start Block 28
Done with: Directory tree                          Block(s)    4
Writing:   Joliet directory tree                   Start Block 32
Done with: Joliet directory tree                   Block(s)    4
Writing:   Directory tree cleanup                  Start Block 36
Done with: Directory tree cleanup                  Block(s)    0
Writing:   Extension record                        Start Block 36
Done with: Extension record                        Block(s)    1
Writing:   The File(s)                             Start Block 37
Total extents scheduled to be written = 29323
 17.10% done, estimate finish Thu Jul 13 05:36:24 2017
 34.12% done, estimate finish Thu Jul 13 05:36:24 2017
 51.20% done, estimate finish Thu Jul 13 05:36:24 2017
 68.22% done, estimate finish Thu Jul 13 05:36:24 2017
 85.29% done, estimate finish Thu Jul 13 05:36:24 2017
Total translation table size: 0
Total rockridge attributes bytes: 1124
Total directory bytes: 6144
Path table size(bytes): 46
Done with: The File(s)                             Block(s)    29136
Writing:   Ending Padblock                         Start Block 29173
Done with: Ending Padblock                         Block(s)    150
Max brk space used 0
29323 extents written (57 MB)
~/rear/usr/sbin
2017-07-13 05:36:24.792446132 Wrote ISO image: /root/rear/var/lib/rear/output/rear-sles11ppc64fix.iso (58M)
[..]
</code></pre>
<p>but the resulting iso image is neither bootable in qemu-system-ppc64 OR
on the real lpar itself.<br />
Investigation shows that yaboot is missing in the iso image entirely:</p>
<pre><code>sles11ppc64fix:~/rear/usr/sbin # mount -o loop /root/rear/var/lib/rear/output/rear-sles11ppc64fix.iso /tmp/mnt/
mount: block device /root/rear/var/lib/rear/output/rear-sles11ppc64fix.iso is write-protected, mounting read-only
sles11ppc64fix:~/rear/usr/sbin # tree /tmp/mnt/
/tmp/mnt/
|-- etc
|   `-- yaboot.conf
|-- initrd.cgz
|-- kernel
`-- ppc
    |-- bootinfo.txt
    `-- chrp
</code></pre>
<p>As far as i understand the chrp boot process the power system in a first
step looks at a created<br />
file ppc/bootinfo.txt which is correctly created in the filesystem
layout of the REAR build directory:</p>
<pre><code> cat /tmp/rear.Pya6Ddji9I2bcRb/tmp/ppc/bootinfo.txt 
&lt;chrp-boot&gt;
&lt;description&gt;Relax-and-Recover&lt;/description&gt;
&lt;os-name&gt;Linux&lt;/os-name&gt;
&lt;boot-script&gt;boot &amp;device;:\yaboot&lt;/boot-script&gt;
&lt;/chrp-boot&gt;
</code></pre>
<p>however, the referenced bootloader yaboot is not placed anywhere on the
created iso image.<br />
As such the power system is not finding any valid bootloader and fails
with no operating sytem found.</p>
<p>I was able to make the iso file bootable by doing the following:</p>
<ol>
<li>copy kernel, yaboot and initrd.cgz to the build directorys ppc
    folder:</li>
</ol>
<!-- -->

<pre><code>/tmp/rear.Pya6Ddji9I2bcRb/tmp/ppc/
|-- bootinfo.txt
|-- chrp
|-- initrd.cgz
|-- kernel
`-- yaboot
</code></pre>
<ol>
<li>change bootinfo.txt to append \ppc\ to the path:</li>
</ol>
<!-- -->

<pre><code>&lt;chrp-boot&gt;
&lt;description&gt;Relax-and-Recover&lt;/description&gt;
&lt;os-name&gt;Linux&lt;/os-name&gt;
&lt;boot-script&gt;boot &amp;device;:\ppc\yaboot&lt;/boot-script&gt;
&lt;/chrp-boot&gt;
</code></pre>
<ol>
<li>create iso image by using:</li>
</ol>
<p>/usr/bin/mkisofs -v -o /tmp/test.iso -U -chrp-boot -R -J -volid
RELAXRECOVER -v -graft-points etc=etc ppc=ppc
/tmp/rear.Pya6Ddji9I2bcRb/tmp/ppc/kernel ppc/initrd.cgz</p>
<p>then the resulting ISO image can be booted both on the real LPAR and in
qemu-system-ppc64</p>
<p>So basically what i did not yet discover is:</p>
<ol>
<li>why is yaboot missing in the created iso image (probably ppc=
    specified the folder to look in)</li>
<li>why is it not happening on other systems? (other genisoimage
    verison?)</li>
</ol>
<p>I guess mkisofs is simply ignoring the yaboot executable in the build
dirs tmp directory ..<br />
Yaboot is within the rear build directory but is not put on the iso
image for some reason:</p>
<pre><code>sles11ppc64fix:/tmp/rear.wBJNqEyYRNSbHYB # tree tmp/
tmp/
|-- boot
|-- copy-as-is-exclude
|-- copy-as-is-filelist
|-- etc
|   `-- yaboot.conf
|-- initrd.cgz
|-- kernel
|-- mappings
|   `-- routes
|-- parted
|-- partitions
|-- partitions-data
|-- partitions_unsorted
|-- ppc
|   |-- bootinfo.txt
|   `-- chrp
`-- yaboot
</code></pre>
<h4 id="abbbi_commented_at_2017-07-13_1001"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315032993">2017-07-13 10:01</a>:<a class="headerlink" href="#abbbi_commented_at_2017-07-13_1001" title="Permanent link">&para;</a></h4>
<p>changing default.conf to:</p>
<pre><code> # which files to include in the ISO image
-ISO_FILES=()
+ISO_FILES=(yaboot)
</code></pre>
<p>makes the iso image bootable by default. But i think yaboot must be a
default setting<br />
in case of PPC.</p>
<p>I think the relevant part here is:</p>
<p>/usr/share/rear/output/ISO/Linux-ppc64/300_create_yaboot.sh</p>
<p>it can be seen that on RHEL Systems yaboot is copied to:<br />
\ppc\chrp\yaboot<br />
on SLES systems, it is copied to<br />
\yaboot</p>
<p>the ISO_FILES variable is set to:</p>
<p>ISO_FILES=( "${ISO_FILES[@]}" etc=etc ppc=ppc )</p>
<p>these options end up in the -graft-points options to mkisofs, which
defines what files should be<br />
added to the iso image.</p>
<p>this will work on RHEL systems, but not on SLES Systems.<br />
So in case Of SLES the ISO_FILES variable must be changed accordingly
otherwise yaboot will be missing from the iso image.</p>
<p>Btw, im not sure why RHEL uses another path on the iso image for the
yaboot loader than SLES does. It should be no matter for both
distributions if yaboot is placed in \yaboot or \ppc\chrp\yaboot if
bootinfo.txt is created accordingly.</p>
<h4 id="abbbi_commented_at_2017-07-13_1258"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315070006">2017-07-13 12:58</a>:<a class="headerlink" href="#abbbi_commented_at_2017-07-13_1258" title="Permanent link">&para;</a></h4>
<p>As a side note: i have now also a running SLES 4 SAP instance on this
Power System and it shows the same problem. As it works with version 2.1
i guess the issue was introduced by the following commit in the current
master version:</p>
<p><a href="https://github.com/rear/rear/commit/7124c122f855d83f0e7d373416ed95bc3d9e0cbb">https://github.com/rear/rear/commit/7124c122f855d83f0e7d373416ed95bc3d9e0cbb</a></p>
<h4 id="schabrolles_commented_at_2017-07-14_1329"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315359731">2017-07-14 13:29</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-07-14_1329" title="Permanent link">&para;</a></h4>
<p>@abbbi</p>
<p>You are right, <code>/yaboot</code> is not part of the ISO anymore (may be a side
effect of some big cleaning made for ppc64/ppc64le platform).<br />
I propose a patch (#1414) which is now working for me (sles11sp4 on
PowerVM &amp; KVM). Waiting for approval from ReaR team.</p>
<h4 id="abbbi_commented_at_2017-07-14_1332"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315360292">2017-07-14 13:32</a>:<a class="headerlink" href="#abbbi_commented_at_2017-07-14_1332" title="Permanent link">&para;</a></h4>
<p>@schabrolles</p>
<p>thanks! Is there a particular reason why RHEL yaboot is placed on a
different folder than the suse yaboot?<br />
Shouldnt it work for both RHEL and SUSE style systems if bootinfo.txt +
place of yaboot are at the same directory?</p>
<h4 id="schabrolles_commented_at_2017-07-14_1435"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315375635">2017-07-14 14:35</a>:<a class="headerlink" href="#schabrolles_commented_at_2017-07-14_1435" title="Permanent link">&para;</a></h4>
<p>@abbbi</p>
<p>I think it is to "replicate" the real system.<br />
SUSE stores yaboot at the root of the PReP partition while RedHat is
should store it inside /ppc in PReP.</p>
<p>You proposition should work as well, but because ReaR rescue media is
just build from the OS (getting kernel, rebuiding initramfs from the
current OS etc ...) I think that using the same philosophy for yaboot
(replicating the original OS behaviour) is may be better. People who
know Suse or Redhat will find the things where they are use to be...<br />
(it is just a personal view ... feel free to comment feedback)</p>
<p>Thanks to @schlomo, the patch is now merged... @abbbi, tell us if
everything works now fine on your side.</p>
<h4 id="jsmeix_commented_at_2017-07-17_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1407#issuecomment-315719698">2017-07-17 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-07-17_1032" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/1414">https://github.com/rear/rear/pull/1414</a>
merged<br />
this issue should be fixed.</p>
<p>@schabrolles<br />
as always many thanks for all your work and contributions<br />
that make ReaR working better and better on POWER!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-07-13.1407.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
