<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#551 Issue closed: Bareos bconsole mandatory for mkrescue - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#551 Issue closed: Bareos bconsole mandatory for mkrescue";
        var mkdocs_page_input_path = "issues/2015-02-17.551.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#551 Issue closed: Bareos bconsole mandatory for mkrescue</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="551_issue_closed_bareos_bconsole_mandatory_for_mkrescue"><a href="https://github.com/rear/rear/issues/551">#551 Issue</a> <code>closed</code>: Bareos bconsole mandatory for mkrescue<a class="headerlink" href="#551_issue_closed_bareos_bconsole_mandatory_for_mkrescue" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="leonkramer_opened_issue_at_2015-02-17_1508"><img src="https://avatars.githubusercontent.com/u/5389163?v=4" width="50"><a href="https://github.com/leonkramer">leonkramer</a> opened issue at <a href="https://github.com/rear/rear/issues/551">2015-02-17 15:08</a>:<a class="headerlink" href="#leonkramer_opened_issue_at_2015-02-17_1508" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>when trying to create a rescue image with <code>rear -vD mkrescue</code> I receive
the following ouput:</p>
<pre>root@lk-toolbox /etc/bareos $ rear -vD mkrescue
Relax-and-Recover 1.16.1-git201502120920 / 2015-02-12
Using log file: /var/log/rear/rear-lk-toolbox.log
ERROR: Bareos console executable is missing
Aborting due to an error, check /var/log/rear/rear-lk-toolbox.log for details
Terminated</pre>

<p>While the error is clear to me that the binary <code>bconsole</code> is missing, I
do not really understand why it is even mandatory.<br />
In order to make backups and restore them with Bareos all you need is
the package bareos-fd. Why does ReaR also need the package
bareos-bconsole for the rescue?</p>
<h4 id="gdha_commented_at_2015-02-17_1514"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-74683008">2015-02-17 15:14</a>:<a class="headerlink" href="#gdha_commented_at_2015-02-17_1514" title="Permanent link">&para;</a></h4>
<p>Because @sebastianlederer added it in the code:</p>
<pre><code>restore/BAREOS/default/40_restore_backup.sh:  echo "status client=$BAREOS_CLIENT" | bconsole | egrep "^JobId
</code></pre>
<h4 id="leonkramer_commented_at_2015-02-18_0150"><img src="https://avatars.githubusercontent.com/u/5389163?v=4" width="50"><a href="https://github.com/leonkramer">leonkramer</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-74796061">2015-02-18 01:50</a>:<a class="headerlink" href="#leonkramer_commented_at_2015-02-18_0150" title="Permanent link">&para;</a></h4>
<p>I have got it now.<br />
Before I was kinda distracted by the requirement of <code>bconsole</code> and the
fact that only one Director can be set up for the backup server.
Therefore I falsely assumed that you more or less have to give lots of
power to the servers for which you want to create rescue images.</p>
<p>Just figured out how to do the kinda tricky configuration to limit the
access. Maybe this will be of help in future for someone.</p>
<p>While you cannot add a second Director or directly limit access in the
<code>Director</code> resource of <code>bareos-dir.conf</code> you are able to add several
<code>Console</code> resources and define ACLs for them.</p>
<p>The minimum ACL requirements you need to define in <code>bareos-dir.conf</code> for
ReaR are:</p>
<pre>
Console {
  Name = status-mon
  Password = "macMP5TYGYaBCDaGLAj7o54KYERbEBQQs+bsh/E0LrPn"
  CommandACL = status           # if you want automatic restores, then you also need to grant 'restore'
  ClientACL = *all*                      # or Client name of host, ReaR will fail to retrieve status without it
}
</pre>

<p>At the system, which you want to prepare a rescue image for, you need
the given <code>Console</code> resource and a <code>Director</code> resource in
<code>bconsole.conf</code>, even though the <code>Director</code> resource is only good for
telling bconsole the direction to the server. The password is mandatory,
but can be set arbitrarily.</p>
<pre>
Director {
  Name = backups-dir
  DIRport = 9101
  address = 123.45.67.89
  Password = "does not matter, rly! but better dont omit it!"
}
Console {
    Name = status-mon
    Password = "macMP5TYGYaBCDaGLAj7o54KYERbEBQQs+bsh/E0LrPn"
}
</pre>

<h4 id="tigerfoot_commented_at_2015-08-25_0737"><img src="https://avatars.githubusercontent.com/u/788864?u=5d18f61bda7603d29de3301e56ba0281e5919b2c&v=4" width="50"><a href="https://github.com/tigerfoot">tigerfoot</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-134511415">2015-08-25 07:37</a>:<a class="headerlink" href="#tigerfoot_commented_at_2015-08-25_0737" title="Permanent link">&para;</a></h4>
<p>Having bconsole as requirement, just to pick the bareos dir ip address
is kinda overkill.<br />
(Add binaries to systems, + specific configuration on dir and fd)</p>
<p>Why not just a REAR config line replacing<br />
is the director server present? Fetch from /etc/bareos/bconsole.conf
file<br />
BAREOS_DIRECTOR=$(grep -i address /etc/bareos/bconsole.conf | awk '{
print $3 }')</p>
<p>Moreover the bareos_director address capture receipt is wrong it could
return "" if the valid syntax<br />
address=director.domain is used.</p>
<h4 id="gdha_commented_at_2015-08-25_0834"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-134523457">2015-08-25 08:34</a>:<a class="headerlink" href="#gdha_commented_at_2015-08-25_0834" title="Permanent link">&para;</a></h4>
<p>@tigerfoot why not preparing a pull request for it? It seems to make
sense to me (however, I cannot test it out)</p>
<h4 id="schlomo_commented_at_2015-08-26_1805"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-135126040">2015-08-26 18:05</a>:<a class="headerlink" href="#schlomo_commented_at_2015-08-26_1805" title="Permanent link">&para;</a></h4>
<p>Yes, this sounds like a good point. Do you need help to create a pull
request?</p>
<h4 id="gdha_commented_at_2015-08-26_1901"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-135140337">2015-08-26 19:01</a>:<a class="headerlink" href="#gdha_commented_at_2015-08-26_1901" title="Permanent link">&para;</a></h4>
<p>@tigerfoot I re-open the issue for better visibility</p>
<h4 id="tigerfoot_commented_at_2015-08-27_0559"><img src="https://avatars.githubusercontent.com/u/788864?u=5d18f61bda7603d29de3301e56ba0281e5919b2c&v=4" width="50"><a href="https://github.com/tigerfoot">tigerfoot</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-135302907">2015-08-27 05:59</a>:<a class="headerlink" href="#tigerfoot_commented_at_2015-08-27_0559" title="Permanent link">&para;</a></h4>
<p>Well it need a deep analysis, but from what I've quickly inspect, was
that a global variable would be better than anything else.<br />
Now about removing bconsole as dep, concern a number of script and
process. (Most of them out of my actual knowledge. I've not been using
rear yet :-)), the restore.<br />
I'm afraid to not have enough free time to dig into this right now.</p>
<h4 id="sebastianlederer_commented_at_2015-08-28_1236"><img src="https://avatars.githubusercontent.com/u/3583086?v=4" width="50"><a href="https://github.com/sebastianlederer">sebastianlederer</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-135763807">2015-08-28 12:36</a>:<a class="headerlink" href="#sebastianlederer_commented_at_2015-08-28_1236" title="Permanent link">&para;</a></h4>
<p>The bconsole program is included for several reasons:</p>
<ul>
<li>automatically check the connection to the bareos director</li>
<li>check if the restore is complete when using fully automatic restore</li>
<li>make it possible to do the restore manually from the console of the
    machine to be restored</li>
</ul>
<p>Arguably, all those are not strictly necessary, but I think they will
make things a lot easier and less error-prone for most users.</p>
<p>If you absolutely don't want the bconsole program on your systems, it
should be possible to make it optional, which would also bypass the
checks and disable automatic restore and manual local restore.</p>
<h4 id="tigerfoot_commented_at_2015-08-28_1243"><img src="https://avatars.githubusercontent.com/u/788864?u=5d18f61bda7603d29de3301e56ba0281e5919b2c&v=4" width="50"><a href="https://github.com/tigerfoot">tigerfoot</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-135765579">2015-08-28 12:43</a>:<a class="headerlink" href="#tigerfoot_commented_at_2015-08-28_1243" title="Permanent link">&para;</a></h4>
<p>Absolutely true @sebastianlederer this is what I've seen in the restore
script.<br />
I will have to check how I can in my workflow bypass those. And then
perhaps being able to make everything optionnal. But this will not
happen before 1 or 2 months.</p>
<p>I'm still convinced that the way the bareos-director address is checked
need improvement<br />
like at least checking you've got something not empty and if it's the
case try to check if a global<br />
BAREOS_DIRECTOR exist. If none = error.<br />
What's your throught about this ?</p>
<h4 id="unknown_commented_at_2016-07-26_1439"><img src="(unknown)" width="50"><a href="(unknown)">(unknown)</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-235288667">2016-07-26 14:39</a>:<a class="headerlink" href="#unknown_commented_at_2016-07-26_1439" title="Permanent link">&para;</a></h4>
<p>Hello, i want to mention that you need to add<br />
<code>ClientACL = *all*</code><br />
to the bareos-dir.conf to be able to get the clients status :)</p>
<h4 id="gdha_commented_at_2016-07-31_1147"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/551#issuecomment-236425694">2016-07-31 11:47</a>:<a class="headerlink" href="#gdha_commented_at_2016-07-31_1147" title="Permanent link">&para;</a></h4>
<p>Script
<code>usr/share/rear/prep/BAREOS/default/50_check_BAREOS_bconsole_results.sh</code>
contains the requested addition - seems we can close this issue</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-02-17.551.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
