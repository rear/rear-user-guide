<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1952 Issue closed: Rear recovery does not start due to "No code has been generated to recreate pv:/dev/sda2 (lvmdev)." - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1952 Issue closed: Rear recovery does not start due to \"No code has been generated to recreate pv:/dev/sda2 (lvmdev).\"";
        var mkdocs_page_input_path = "issues/2018-11-05.1952.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1952 Issue closed: Rear recovery does not start due to "No code has been generated to recreate pv:/dev/sda2 (lvmdev)."</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1952_issue_closed_rear_recovery_does_not_start_due_to_no_code_has_been_generated_to_recreate_pvdevsda2_lvmdev"><a href="https://github.com/rear/rear/issues/1952">#1952 Issue</a> <code>closed</code>: Rear recovery does not start due to "No code has been generated to recreate pv:/dev/sda2 (lvmdev)."<a class="headerlink" href="#1952_issue_closed_rear_recovery_does_not_start_due_to_no_code_has_been_generated_to_recreate_pvdevsda2_lvmdev" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="chrismorgan240_opened_issue_at_2018-11-05_1417"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> opened issue at <a href="https://github.com/rear/rear/issues/1952">2018-11-05 14:17</a>:<a class="headerlink" href="#chrismorgan240_opened_issue_at_2018-11-05_1417" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.3-git.3007.056bfdb.master.changed / 2018-06-05</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):</p>
</li>
</ul>
<pre>
OS_VENDOR=RedHatEnterpriseServer
OS_VERSION=7

ARCH='Linux-i386'
OS='GNU/Linux'
OS_VERSION='7'
OS_VENDOR='RedHatEnterpriseServer'
OS_VENDOR_VERSION='RedHatEnterpriseServer/7'
OS_VENDOR_ARCH='RedHatEnterpriseServer/i386'
</pre>

<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<pre>
RESCUE dc1dsydb106:~ # cat /etc/rear/site.conf
ONLY_INCLUDE_VG=( "vg_root" )


GRUB_RESCUE=
OUTPUT=ISO
AUTOEXCLUDE_MULTIPATH=y
BACKUP=NETFS
BACKUP_URL=nfs://10.100.11.61/backups
BACKUP_PROG=tar
BACKUP_OPTIONS="nfsvers=3,nolock"
ONLY_INCLUDE_VG=( "vg_root" )
#BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/u01*' '/oraexp/*' '/oralogs/*' '/opt/oem/*' '/syncscp/*' )
</pre>

<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    PC</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    BIOS / GRUB</p>
</li>
<li>
<p>Storage (lokal disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    root VG is local disk</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce
    it):<br />
    rear recover doesn't start with no code message.<br />
    Selecting option 4. to continue then displays</p>
</li>
</ul>
<pre>
No code has been generated to recreate /dev/vg_root (lvmgrp).
    To recreate it manually add code to /var/lib/rear/layout/diskrestore.sh or abort.
Manually add code that recreates /dev/vg_root (lvmgrp)
</pre>

<p>Selecting 4 then shows the same message for vg_root LVs.</p>
<p>disklayout.conf does have entries for above.</p>
<ul>
<li>
<p>Workaround, if any:<br />
    None - we have had a fatal root filesystem failure on this host and
    are trying to recover it using rear.</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<pre>
RESCUE dc1dsydb106:~ # rear -D recover
Relax-and-Recover 2.3-git.3007.056bfdb.master.changed / 2018-06-05
Using log file: /var/log/rear/rear-dc1dsydb106.log
Running workflow recover within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
RPC status rpc.statd available.
Started rpc.idmapd.
Using backup archive '/tmp/rear.0pJQ4ASaV5jqpO6/outputfs/dc1dsydb106/backup.tar.gz'
Will do driver migration (recreating initramfs/initrd)
Calculating backup archive size
Backup archive size is 3.4G     /tmp/rear.0pJQ4ASaV5jqpO6/outputfs/dc1dsydb106/backup.tar.gz (compressed)
Comparing disks
Disk configuration looks identical
UserInput -I DISK_LAYOUT_PROCEED_RECOVERY needed in /usr/share/rear/layout/prepare/default/250_compare_disks.sh line 146
Proceed with recovery (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)
yes
UserInput: No choices - result is 'yes'
User confirmed to proceed with recovery
No code has been generated to recreate pv:/dev/sda2 (lvmdev).
    To recreate it manually add code to /var/lib/rear/layout/diskrestore.sh or abort.
UserInput -I ADD_CODE_TO_RECREATE_MISSING_PVDEVSDA2LVMDEV needed in /usr/share/rear/layout/prepare/default/600_show_unprocessed.sh line 33
Manually add code that recreates pv:/dev/sda2 (lvmdev)
1) View /var/lib/rear/layout/diskrestore.sh
2) Edit /var/lib/rear/layout/diskrestore.sh
3) Go to Relax-and-Recover shell
4) Continue 'rear recover'
5) Abort 'rear recover'
(default '4' timeout 300 seconds)
5
UserInput: Valid choice number result 'Abort 'rear recover''
ERROR: User chose to abort 'rear recover' in /usr/share/rear/layout/prepare/default/600_show_unprocessed.sh
Aborting due to an error, check /var/log/rear/rear-dc1dsydb106.log for details
Exiting rear recover (PID 6209) and its descendant processes
Running exit tasks
You should also rm -Rf /tmp/rear.0pJQ4ASaV5jqpO6
Terminated
</pre>

<h4 id="jsmeix_commented_at_2018-11-05_1439"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-435898035">2018-11-05 14:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-05_1439" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240<br />
please attach your original disklayout.conf<br />
(I mean the one before you run <code>rear -D recover</code>)<br />
and the created var/lib/rear/layout/diskrestore.sh<br />
after <code>rear -D recover</code> aborted<br />
and your whole debug log file for <code>rear -D recover</code>,<br />
cf. the section "Debugging issues with Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="gdha_commented_at_2018-11-05_1442"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-435899185">2018-11-05 14:42</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-05_1442" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240 perhaps also add the output of <code>df</code></p>
<h4 id="chrismorgan240_commented_at_2018-11-05_1623"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-435937332">2018-11-05 16:23</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-05_1623" title="Permanent link">&para;</a></h4>
<p>This is a ndf from a very similar machine (just ip / hostname
differences)</p>
<pre>
[root@dc1dsydb206 ~]# df
Filesystem                          1K-blocks      Used  Available Use% Mounted on
/dev/mapper/vg_root-lv_root          10225664   3796740    6428924  38% /
devtmpfs                            264025896       156  264025740   1% /dev
tmpfs                               264036996   1302528  262734468   1% /dev/shm
tmpfs                               264036996      2096  264034900   1% /run
tmpfs                               264036996         0  264036996   0% /sys/fs/cgroup
/dev/sda1                              503040    421928      81112  84% /boot
/dev/mapper/vg_ora-lv_adm            19912448  17478176    2434272  88% /syncscp
/dev/mapper/vg_ora-lv_exp            52402944   5370688   47032256  11% /oraexp
/dev/mapper/vg_ora-lv_log            31441664   4771876   26669788  16% /oralogs
/dev/mapper/vg_ora-lv_u01           157235200 127819172   29416028  82% /u01
/dev/mapper/vg_root-lv_usrlocal       1015040     49876     965164   5% /usr/local
/dev/mapper/vg_root-lv_home           1015040    117740     897300  12% /home
/dev/mapper/vg_root-lv_opt            1015040    498632     516408  50% /opt
/dev/mapper/vg_root-lv_tmp           10471424     57972   10413452   1% /tmp
/dev/mapper/vg_root-lv_var            5134336   1023916    4110420  20% /var
/dev/mapper/vg_root-lv_varcrash      62879744     33328   62846416   1% /var/crash
/dev/mapper/vg_ora-lv_oem            26201344   1980064   24221280   8% /opt/oem
/dev/mapper/vg_root-lv_varlog         6259968   1127840    5132128  19% /var/log
/dev/mapper/vg_root-lv_varlogaudit    1560576    884308     676268  57% /var/log/audit
/dev/asm/mysqldev-459                10485760    721720    9764040   7% /mysqldev
/dev/asm/backup_test-459             68157440  52844856   15312584  78% /backup_test
/dev/asm/mysqltest-459               10485760    728324    9757436   7% /mysqltest
/dev/asm/mysqluat-459                10485760    722000    9763760   7% /mysqluat
/dev/asm/syncd01-459                209715200 188641768   21073432  90% /syncd01
/dev/asm/synct01-459                367001600 136423028  230578572  38% /synct01
dc1dsydbcl-tacfs-vip:/synct01       367001600 136422400  230579200  38% /synctnfs01
dc1dsydbcl-dacfs-vip:/syncd01       209715200 188641280   21073920  90% /syncdnfs01
/dev/asm/acfsreptest-79             157286400   4535864  152750536   3% /acfsreptest
/dev/asm/syncu01-289               1022361600   2278556 1020083044   1% /syncu01
</pre>

<h4 id="chrismorgan240_commented_at_2018-11-05_1624"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-435937861">2018-11-05 16:24</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-05_1624" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2549534/rear-dc1dsydb106.log">rear-dc1dsydb106.log</a></p>
<p><a href="https://github.com/rear/rear/files/2549539/disklayout.conf.txt">disklayout.conf.txt</a></p>
<h4 id="jsmeix_commented_at_2018-11-05_1657"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-435950318">2018-11-05 16:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-05_1657" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240<br />
your rear-dc1dsydb106.log was made with <code>/bin/rear -d recover</code><br />
but <code>-d</code> is not <code>-D</code> - the latter is the needed full debugging mode<br />
(the so called debugscript mode).</p>
<p>Your disklayout.conf.txt contains for <code>sda</code> only</p>
<pre>
lvmdev /dev/vg_root /dev/sda2 tqugIk-a3nI-mS8g-mz8P-JJ4X-CMT8-0Buqe3 584843860
fs /dev/sda1 /boot xfs uuid=cd3460e8-d7fb-4a3c-a993-aafe3ae91860 label=  options=rw,relatime,attr2,inode64,logbsize=256k,sunit=512,swidth=512,noquota
logicaldrive /dev/sda 0|A|1 raid=1 drives=1I:1:1,1I:1:2, spares= sectors=32 stripesize=256
</pre>

<p>where a XFS filesystem should be created on '/dev/sda1'<br />
but there is no entry how to create '/dev/sda1' - usually such an
entry<br />
would be a 'part' entry that describes the '/dev/sda1' partition on
'/dev/sda'.<br />
And there is also nothing that describes how to create '/dev/sda2' -
usually<br />
such an entry would be another 'part' entry that describes the
'/dev/sda2' partition<br />
on '/dev/sda'.</p>
<p>Because you use HP SmartArray and multipath<br />
I am afraid I cannot really help further here because<br />
I have no experience with HP SmartArray or multipath<br />
(I use use neither of them).</p>
<p>In particular regarding <code>AUTOEXCLUDE_MULTIPATH=y</code><br />
you may have a look at<br />
<a href="https://github.com/rear/rear/issues/1925#issuecomment-428463362">https://github.com/rear/rear/issues/1925#issuecomment-428463362</a><br />
which might be somehow related.</p>
<p>In your initial description<br />
<a href="https://github.com/rear/rear/issues/1952#issue-377419158">https://github.com/rear/rear/issues/1952#issue-377419158</a><br />
you wrote</p>
<pre>
root VG is local disk
</pre>

<p>but your disklayout.conf.txt looks as if your root VG is perhaps<br />
not on a usual local disk (but I am no expert here)?</p>
<p>See<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/06-layout-configuration.adoc</a><br />
how disklayout.conf looks like when LVM is used on usual local disks.</p>
<h4 id="gdha_commented_at_2018-11-06_0824"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436168935">2018-11-06 08:24</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-06_0824" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240 You should check which HP RAID tool you are using</p>
<pre><code>2018-11-05 16:12:52.917074921 Including layout/prepare/GNU/Linux/170_include_hpraid_code.sh
/usr/share/rear/lib/_input-output-functions.sh: line 328: type: hpacucli: not found
</code></pre>
<p>You need to dig into that script to find out what could have went wrong
(use debug mode) to have a clear view.</p>
<h4 id="jsmeix_commented_at_2018-11-06_1434"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436273107">2018-11-06 14:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-06_1434" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I think <code>hpacucli: not found</code> alone does not indicate a real problem<br />
because I think that happens as a result of the function call</p>
<pre>
define_HPSSACLI
</pre>

<p>at the beginning of
layout/prepare/GNU/Linux/170_include_hpraid_code.sh<br />
where <code>define_HPSSACLI</code> is in lib/hp_raid-functions.sh</p>
<pre>
function define_HPSSACLI() {
    # HP Smart Storage Administrator CLI is either hpacucli, hpssacli or ssacli
    if has_binary hpacucli ; then
        HPSSACLI=hpacucli
    elif has_binary hpssacli ; then
        HPSSACLI=hpssacli
    elif has_binary ssacli ; then
        HPSSACLI=ssacli
    fi
}
</pre>

<p>where the <code>type: hpacucli: not found</code> comes from <code>has_binary hpacucli</code><br />
but because there is no subsequent <code>type: hpssacli: not found</code> from<br />
the subsequent <code>has_binary hpssacli</code> I conclude that the result is<br />
<code>HPSSACLI=hpssacli</code> and that <code>hpssacli</code> is the right HP RAID tool<br />
that @chrismorgan240 actually uses.</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1352"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436629198">2018-11-07 13:52</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1352" title="Permanent link">&para;</a></h4>
<p>I added entries for /dev/sda from another similar server :</p>
<pre>
disk /dev/sda 299966445568 msdos
part /dev/sda 524288000 2097152 primary boot /dev/sda1
part /dev/sda 299440056320 526389248 primary lvm /dev/sda2
</pre>

<p>This allows restore to proceed :</p>
<pre>
RESCUE dc1dsydb106:/var/lib/rear/layout # rear -D recover
Relax-and-Recover 2.3-git.3007.056bfdb.master.changed / 2018-06-05
Using log file: /var/log/rear/rear-dc1dsydb106.log
Running workflow recover within the ReaR rescue/recovery system
Starting required daemons for NFS: RPC portmapper (portmap or rpcbind) and rpc.statd if available.
Started RPC portmapper 'rpcbind'.
RPC portmapper 'rpcbind' available.
RPC status rpc.statd available.
Started rpc.idmapd.
Using backup archive '/tmp/rear.yWwNxSWLLaYl7K0/outputfs/dc1dsydb106/backup.tar.gz'
Will do driver migration (recreating initramfs/initrd)
Calculating backup archive size
Backup archive size is 3.4G     /tmp/rear.yWwNxSWLLaYl7K0/outputfs/dc1dsydb106/backup.tar.gz (compressed)
Comparing disks
Device sda has expected (same) size 299966445568 (will be used for recovery)
Disk configuration looks identical
UserInput -I DISK_LAYOUT_PROCEED_RECOVERY needed in /usr/share/rear/layout/prepare/default/250_compare_disks.sh line 146
Proceed with recovery (yes) otherwise manual disk layout configuration is enforced
(default 'yes' timeout 30 seconds)
yes
UserInput: No choices - result is 'yes'
User confirmed to proceed with recovery
Start system layout restoration.
Creating partitions for disk /dev/sda (msdos)
Creating LVM PV /dev/sda2
Restoring LVM VG 'vg_root'
Sleeping 3 seconds to let udev or systemd-udevd create their devices...
Creating filesystem of type xfs with mount point / on /dev/mapper/vg_root-lv_root.
Mounting filesystem /
Creating filesystem of type xfs with mount point /home on /dev/mapper/vg_root-lv_home.
Mounting filesystem /home
Creating filesystem of type xfs with mount point /opt on /dev/mapper/vg_root-lv_opt.
Mounting filesystem /opt
Creating filesystem of type xfs with mount point /tmp on /dev/mapper/vg_root-lv_tmp.
Mounting filesystem /tmp
Creating filesystem of type xfs with mount point /usr/local on /dev/mapper/vg_root-lv_usrlocal.
Mounting filesystem /usr/local
Creating filesystem of type xfs with mount point /var on /dev/mapper/vg_root-lv_var.
Mounting filesystem /var
Creating filesystem of type xfs with mount point /var/crash on /dev/mapper/vg_root-lv_varcrash.
Mounting filesystem /var/crash
Creating filesystem of type xfs with mount point /var/log on /dev/mapper/vg_root-lv_varlog.
Mounting filesystem /var/log
Creating filesystem of type xfs with mount point /var/log/audit on /dev/mapper/vg_root-lv_varlogaudit.
Mounting filesystem /var/log/audit
Creating filesystem of type xfs with mount point /boot on /dev/sda1.
Mounting filesystem /boot
Creating swap on /dev/mapper/vg_root-lv_swap
Disk layout created.
Restoring from '/tmp/rear.yWwNxSWLLaYl7K0/outputfs/dc1dsydb106/backup.tar.gz' (restore log in /var/lib/rear/restore/recover.backup.tar.gz.9126.restore.log) ...
Restored 9106 MiB [avg. 158059 KiB/sec] OK
Restored 9243 MiB in 60 seconds [avg. 157757 KiB/sec]
Restoring finished (verify backup restore log messages in /var/lib/rear/restore/recover.backup.tar.gz.9126.restore.log)
Recreating directories (with permissions) from /var/lib/rear/recovery/directories_permissions_owner_group
Running mkinitrd...
Updated initrd with new drivers for kernel 3.10.0-123.el7.x86_64.
Running mkinitrd...
Updated initrd with new drivers for kernel 3.10.0-514.26.2.el7.x86_64.
Skip installing GRUB Legacy boot loader because GRUB 2 is installed (grub-probe or grub2-probe exist).
Installing GRUB2 boot loader
Finished recovering your system. You can explore it under '/mnt/local'.
Exiting rear recover (PID 9126) and its descendant processes
Running exit tasks
You should also rm -Rf /tmp/rear.yWwNxSWLLaYl7K0
</pre>

<p>Exploring /mnt/local shows all lvs / filesystems in vg_root.</p>
<p>/dev/mapper looks ok</p>
<pre>
RESCUE dc1dsydb106:/mnt/local # ls -l /dev/mapper
total 0
crw------- 1 root root 10, 236 Nov  7 13:30 control
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_home -> ../dm-1
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_opt -> ../dm-6
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_root -> ../dm-0
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_swap -> ../dm-2
lrwxrwxrwx 1 root root       8 Nov  7 13:30 vg_root-lv_temp -> ../dm-10
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_tmp -> ../dm-5
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_usrlocal -> ../dm-3
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_var -> ../dm-4
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_varcrash -> ../dm-9
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_varlog -> ../dm-7
lrwxrwxrwx 1 root root       7 Nov  7 13:30 vg_root-lv_varlogaudit -> ../dm-8
</pre>

<p>Reboot and server goes to rescue mode.<br />
No vg_root visible by vgs / lsblk<br />
/dev entries missing<br />
pvscan / partprobe doesn't help.</p>
<h4 id="jsmeix_commented_at_2018-11-07_1617"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436681214">2018-11-07 16:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-11-07_1617" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240<br />
what exactly do you mean with "Reboot and server goes to rescue mode."?</p>
<p>Do you mean you end up in GRUB rescue mode<br />
or did GRUB succeed to load kernel and initrd and the kernel started<br />
but then the booting system goes into some "rescue mode"<br />
e.g. the systemd rescue mode (i.e. systemd's rescue.target)<br />
or runlevel 1 with SysVinit or anything else like that?</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1632"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436687120">2018-11-07 16:32</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1632" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
It is the systemd rescue mode.</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1716"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436703536">2018-11-07 17:16</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1716" title="Permanent link">&para;</a></h4>
<p>Here is a df after the restore :</p>
<p>RESCUE dc1dsydb106:/var/lib/rear/layout # df -h<br />
Filesystem Size Used Avail Use% Mounted on<br />
devtmpfs 252G 0 252G 0% /dev<br />
tmpfs 252G 0 252G 0% /dev/shm<br />
tmpfs 252G 9.5M 252G 1% /run<br />
tmpfs 252G 0 252G 0% /sys/fs/cgroup<br />
/dev/mapper/vg_root-lv_root 9.8G 4.4G 5.4G 45% /mnt/local<br />
/dev/mapper/vg_root-lv_home 994M 116M 878M 12% /mnt/local/home<br />
/dev/mapper/vg_root-lv_opt 994M 499M 495M 51% /mnt/local/opt<br />
/dev/mapper/vg_root-lv_tmp 10G 33M 10G 1% /mnt/local/tmp<br />
/dev/mapper/vg_root-lv_usrlocal 994M 49M 945M 5%
/mnt/local/usr/local<br />
/dev/mapper/vg_root-lv_var 4.9G 2.0G 3.0G 39% /mnt/local/var<br />
/dev/mapper/vg_root-lv_varcrash 60G 33M 60G 1% /mnt/local/var/crash<br />
/dev/mapper/vg_root-lv_varlog 6.0G 1.2G 4.9G 20% /mnt/local/var/log<br />
/dev/mapper/vg_root-lv_varlogaudit 1.5G 919M 608M 61%
/mnt/local/var/log/audit<br />
/dev/sda1 494M 413M 81M 84% /mnt/local/boot</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1720"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436705149">2018-11-07 17:20</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1720" title="Permanent link">&para;</a></h4>
<p>RESCUE dc1dsydb106:/mnt/local/dev/vg_root # find
/mnt/local/dev/vg_root<br />
/mnt/local/dev/vg_root<br />
/mnt/local/dev/vg_root/lv_temp<br />
/mnt/local/dev/vg_root/lv_varcrash<br />
/mnt/local/dev/vg_root/lv_tmp<br />
/mnt/local/dev/vg_root/lv_opt<br />
/mnt/local/dev/vg_root/lv_varlogaudit<br />
/mnt/local/dev/vg_root/lv_varlog<br />
/mnt/local/dev/vg_root/lv_home<br />
/mnt/local/dev/vg_root/lv_usrlocal<br />
/mnt/local/dev/vg_root/lv_var<br />
/mnt/local/dev/vg_root/lv_root<br />
/mnt/local/dev/vg_root/lv_swap</p>
<p>VG #PV #LV #SN Attr VSize VFree<br />
vg_ora 1 5 0 wz--n- 324.98g 50.98g<br />
vg_reptest 1 2 0 wzx-n- 1008.00m 8.00m<br />
vg_root 1 11 0 wz--n- 278.87g 32.82g<br />
vg_swap 1 1 0 wz--n- 99.98g 1008.00m</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1741"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436712091">2018-11-07 17:41</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1741" title="Permanent link">&para;</a></h4>
<p>rear -D recover :</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1742"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436712182">2018-11-07 17:41</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1742" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/files/2558538/rear-dc1dsydb106.log">rear-dc1dsydb106.log</a></p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1825"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436727496">2018-11-07 18:25</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1825" title="Permanent link">&para;</a></h4>
<p><img alt="image001" src="https://user-images.githubusercontent.com/30433662/48151961-8cdeb480-e2ba-11e8-975b-89b537ac3f2a.png" /></p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1826"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436727836">2018-11-07 18:26</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1826" title="Permanent link">&para;</a></h4>
<p>Above are boot messages - this looks like it could be the issue to me ?
I would appreciate advice.</p>
<h4 id="chrismorgan240_commented_at_2018-11-07_1838"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436731566">2018-11-07 18:38</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-07_1838" title="Permanent link">&para;</a></h4>
<p><img alt="image001" src="https://user-images.githubusercontent.com/30433662/48152635-4ee29000-e2bc-11e8-9125-bdb76f85007f.png" /></p>
<h4 id="gdha_commented_at_2018-11-08_0812"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-436908369">2018-11-08 08:12</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-08_0812" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240 try a manual relabel?</p>
<pre><code>++ touch /mnt/local/.autorelabel
++ Log 'Created /.autorelabel file : after reboot SELinux will relabel all files'
</code></pre>
<p>It seems that the SELinux relabel was not performed for one of other
reason?<br />
I've seen something similar on CentOS 7
(<a href="https://github.com/gdha/rear-automated-testing/issues/72">https://github.com/gdha/rear-automated-testing/issues/72</a>)</p>
<h4 id="gdha_commented_at_2018-11-14_1010"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-438608917">2018-11-14 10:10</a>:<a class="headerlink" href="#gdha_commented_at_2018-11-14_1010" title="Permanent link">&para;</a></h4>
<p>@chrismorgan240 Have a look at
<a href="https://access.redhat.com/solutions/24845">https://access.redhat.com/solutions/24845</a>
to fix your situation.</p>
<h4 id="chrismorgan240_commented_at_2018-11-19_1404"><img src="https://avatars.githubusercontent.com/u/30433662?u=35cff2c21f3a42d2bea0d0697ec289845c2891dd&v=4" width="50"><a href="https://github.com/chrismorgan240">chrismorgan240</a> commented at <a href="https://github.com/rear/rear/issues/1952#issuecomment-439903060">2018-11-19 14:04</a>:<a class="headerlink" href="#chrismorgan240_commented_at_2018-11-19_1404" title="Permanent link">&para;</a></h4>
<p>Thanks for your help.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-11-05.1952.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
