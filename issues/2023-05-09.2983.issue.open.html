<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2983 Issue open: remote webdav cloud storage not applicable for TMPDIR on low HD space? - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2983 Issue open: remote webdav cloud storage not applicable for TMPDIR on low HD space?";
        var mkdocs_page_input_path = "issues/2023-05-09.2983.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">#2983 Issue open: remote webdav cloud storage not applicable for TMPDIR on low HD space?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2983_issue_open_remote_webdav_cloud_storage_not_applicable_for_tmpdir_on_low_hd_space"><a href="https://github.com/rear/rear/issues/2983">#2983 Issue</a> <code>open</code>: remote webdav cloud storage not applicable for TMPDIR on low HD space?<a class="headerlink" href="#2983_issue_open_remote_webdav_cloud_storage_not_applicable_for_tmpdir_on_low_hd_space" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>special hardware or VM</code></p>
<h4 id="andreasberner_opened_issue_at_2023-05-09_0749"><img src="https://avatars.githubusercontent.com/u/16906358?v=4" width="50"><a href="https://github.com/andreasberner">andreasberner</a> opened issue at <a href="https://github.com/rear/rear/issues/2983">2023-05-09 07:49</a>:<a class="headerlink" href="#andreasberner_opened_issue_at_2023-05-09_0749" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    2.7</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    Debian 11.13</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>TMPDIR=/mnt/hidrive/tmp
OUTPUT=ISO
BACKUP=NETFS
// OUTPUT_URL=sshfs://andreas@berner-telecom.de/home/andreas/share/
OUTPUT_URL=file:///mnt/hidrive/primus0
# Integrate Backup into the ISO
BACKUP_URL=iso:///backup/
# Wegen Restore Problem auf Virtueller Maschine bei Netcup
AUTOEXCLUDE_MULTIPATH=n
# BOOT_OVER_SAN=y
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    VM from netcup, germany</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    I guess BIOS</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local HD and remote webdav-Drive from IONOS, Germany, supposed for
    TMPFILE and</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME        KNAME     PKNAME   TRAN TYPE FSTYPE LABEL  SIZE MOUNTPOINT
/dev/sr0    /dev/sr0           ata  rom               1024M
/dev/vda    /dev/vda                disk                39G
|-/dev/vda1 /dev/vda1 /dev/vda      part ext4         38.6G /
`-/dev/vda2 /dev/vda2 /dev/vda      part swap          467M [SWAP]
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>I would like to make an ISO file with a complete backup over the net to
a remote clould storage.<br />
The cloud is accessable via webdav protocoll.<br />
During the backup process the internal HD runs out of space because the
iso file is created locally and subsequently copied to the backup
target.<br />
I tried to overcome this shortage by changing the TMPDIR to the webdav
drive by using<br />
<code>TMPDIR=/mnt/hidrive/tmp</code><br />
but<br />
<code># rear -v mkbackup</code><br />
leads to errors like</p>
<pre><code>Script 'default/005_verify_os_conf.sh' without leading 3-digit number 'NNN_' is                                                                                           likely run in wrong order
Script 'default/010_EFISTUB_check.sh' without leading 3-digit number 'NNN_' is l                                                                                          ikely run in wrong order
Script 'default/010_set_drlm_env.sh' without leading 3-digit number 'NNN_' is li                                                                                          kely run in wrong order
</code></pre>
<p>and then the backup aborts.</p>
<p>What can I do to solve this problem of low local HD-space?</p>
<ul>
<li>Workaround, if any:</li>
</ul>
<h4 id="jsmeix_commented_at_2023-05-11_1032"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1543746833">2023-05-11 10:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-11_1032" title="Permanent link">&para;</a></h4>
<p>@andreasberner</p>
<pre><code>TMPDIR=/mnt/hidrive/tmp
</code></pre>
<p>and also</p>
<pre><code>export TMPDIR=/mnt/hidrive/tmp
</code></pre>
<p>in etc/rear/local.conf do not work because usr/sbin/rear<br />
creates its temporary working area (BUILD_DIR) at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L505">https://github.com/rear/rear/blob/master/usr/sbin/rear#L505</a><br />
before the config files get sourced later at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L598">https://github.com/rear/rear/blob/master/usr/sbin/rear#L598</a></p>
<p>How to set TMPDIR properly see the description in<br />
usr/share/rear/conf/default.conf<br />
(excerpts)</p>
<pre><code># TMPDIR
#
# Relax-and-Recover needs a (temporary) working area where it builds in particular
# the rescue/recovery system ISO image (and perhaps even stores the backup archive).
...
# To have a specific working area directory prefix for Relax-and-Recover call
#   export TMPDIR="/prefix/for/rear/working/directory"
# before calling 'rear' (/prefix/for/rear/working/directory must already exist).
</code></pre>
<p>For me it works as described:</p>
<pre><code># mount -v /dev/sda6 /other

# mkdir /other/tmp

# export TMPDIR=/other/tmp

# usr/sbin/rear -D mkrescue
Relax-and-Recover 2.7 / Git
Running rear mkrescue (PID 26919 date 2023-05-11 12:19:23)
Command line options: usr/sbin/rear -D mkrescue
Using log file: /root/rear.github.master/var/log/rear/rear-linux-h9wr.log
Using build area: /other/tmp/rear.TxZuJW4iSV3Cwpd
...
</code></pre>
<p>But I do not have a "remote webdav-Drive from IONOS"<br />
to test how ReaR behaves with that.</p>
<p>The error messages you get like</p>
<pre><code>Script 'default/005_verify_os_conf.sh' without leading 3-digit number 'NNN_' ...
</code></pre>
<p>do not make sense because the script '005_verify_os_conf.sh'<br />
has a leading 3-digit number 'NNN_'.</p>
<p>The code that does this is in
usr/share/rear/lib/framework-functions.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128">https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128</a></p>
<p>For me this code works in ReaR and also on command line</p>
<pre><code># script='default/005_verify_os_conf.sh'

# grep -q '^[0-9][0-9][0-9]_' &lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without leading 3-digit number 'NNN_'"
[no output]

# script='default/05_verify_os_conf.sh'

# grep -q '^[0-9][0-9][0-9]_' &lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without leading 3-digit number 'NNN_'"
Script 'default/05_verify_os_conf.sh' without leading 3-digit number 'NNN_'

# script='default/0500_verify_os_conf.sh'

# grep -q '^[0-9][0-9][0-9]_' &lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without leading 3-digit number 'NNN_'"
Script 'default/0500_verify_os_conf.sh' without leading 3-digit number 'NNN_'
</code></pre>
<p>Usually such inexplicable error messages indicate<br />
that the ReaR installation might be somehow messed up<br />
or that the environment where ReaR is run<br />
is not sufficiently standards compliant.</p>
<p>You may try out the current ReaR upstream GitHub master code<br />
from within a separated directory as a test to find out<br />
if things work better then, see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="andreasberner_commented_at_2023-05-11_1655"><img src="https://avatars.githubusercontent.com/u/16906358?v=4" width="50"><a href="https://github.com/andreasberner">andreasberner</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1544341479">2023-05-11 16:55</a>:<a class="headerlink" href="#andreasberner_commented_at_2023-05-11_1655" title="Permanent link">&para;</a></h4>
<p>@Johannes</p>
<p>In general, the workaround to set the TMPDIR outside the rear<br />
configuration seems to work.</p>
<p>I also tried to use the most updated code from GITHIB for rear with
the<br />
following results:</p>
<ul>
<li>
<p>Without changing the TMPDIR to the mounted partiton, the system
    begins<br />
    to run (and later on runs out of disk space as expected)</p>
</li>
<li>
<p>With the TMPDIR pointing to the mounted partition, all kinds of
    errors<br />
    occur and the system aborts</p>
</li>
</ul>
<p>I do suspect that the webdav mounting is not compatible with the rear<br />
software - if any remote mounted at all.</p>
<p>I guess I need to change at least the protocoll to SSHFS but this is
no<br />
current option of the mounted partition.</p>
<p>Thanks at this time for your really professional answer.</p>
<p>Best</p>
<p>Andreas</p>
<p>Am 11.05.2023 um 12:32 schrieb Johannes Meixner:</p>
<blockquote>
<p>@andreasberner
<a href="https://github.com/andreasberner">https://github.com/andreasberner</a></p>
<p>|TMPDIR=/mnt/hidrive/tmp |</p>
<p>and also</p>
<p>|export TMPDIR=/mnt/hidrive/tmp |</p>
<p>in etc/rear/local.conf do not work because usr/sbin/rear<br />
creates its temporary working area (BUILD_DIR) at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L505">https://github.com/rear/rear/blob/master/usr/sbin/rear#L505</a><br />
before the config files get sourced later at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L598">https://github.com/rear/rear/blob/master/usr/sbin/rear#L598</a></p>
<p>How to set TMPDIR properly see the description in<br />
usr/share/rear/conf/default.conf<br />
(excerpts)</p>
<p>|# TMPDIR # # Relax-and-Recover needs a (temporary) working area
where<br />
it builds in particular # the rescue/recovery system ISO image (and<br />
perhaps even stores the backup archive). ... # To have a specific<br />
working area directory prefix for Relax-and-Recover call # export<br />
TMPDIR="/prefix/for/rear/working/directory" # before calling 'rear'<br />
(/prefix/for/rear/working/directory must already exist). |</p>
<p>For me it works as described:</p>
<p>|# mount -v /dev/sda6 /other # mkdir /other/tmp # export<br />
TMPDIR=/other/tmp # usr/sbin/rear -D mkrescue Relax-and-Recover 2.7
/<br />
Git Running rear mkrescue (PID 26919 date 2023-05-11 12:19:23)
Command<br />
line options: usr/sbin/rear -D mkrescue Using log file:<br />
/root/rear.github.master/var/log/rear/rear-linux-h9wr.log Using
build<br />
area: /other/tmp/rear.TxZuJW4iSV3Cwpd ... |</p>
<p>But I do not have a "remote webdav-Drive from IONOS"<br />
to test how ReaR behaves with that.</p>
<p>The error messages you get like</p>
<p>|Script 'default/005_verify_os_conf.sh' without leading 3-digit
number<br />
'NNN_' ... |</p>
<p>do not make sense because the script '005_verify_os_conf.sh'<br />
has a leading 3-digit number 'NNN_'.</p>
<p>The code that does this is in
usr/share/rear/lib/framework-functions.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128">https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128</a></p>
<p>For me this code works in ReaR and also on command line</p>
<p>|# script='default/005_verify_os_conf.sh' # grep -q<br />
'^[0-9][0-9][0-9]<em>' &lt;&lt;&lt; $( basename $script ) || echo
"Script<br />
'$script' without leading 3-digit number 'NNN</em>'" [no output] #<br />
script='default/05_verify_os_conf.sh' # grep -q
'^[0-9][0-9][0-9]<em>'<br />
&lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without
leading<br />
3-digit number 'NNN</em>'" Script 'default/05_verify_os_conf.sh'
without<br />
leading 3-digit number 'NNN_' #<br />
script='default/0500_verify_os_conf.sh' # grep -q
'^[0-9][0-9][0-9]<em>'<br />
&lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without
leading<br />
3-digit number 'NNN</em>'" Script 'default/0500_verify_os_conf.sh'
without<br />
leading 3-digit number 'NNN_' |</p>
<p>Usually such inexplicable error messages indicate<br />
that the ReaR installation might be somehow messed up<br />
or that the environment where ReaR is run<br />
is not sufficiently standards compliant.</p>
<p>You may try out the current ReaR upstream GitHub master code<br />
from within a separated directory as a test to find out<br />
if things work better then, see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>—<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/2983#issuecomment-1543746833">https://github.com/rear/rear/issues/2983#issuecomment-1543746833</a>,
or<br />
unsubscribe<br />
<a href="https://github.com/notifications/unsubscribe-auth/AEA7Q5WFSXKWZPNN4POZNQLXFS53ZANCNFSM6AAAAAAX3AKDUA">https://github.com/notifications/unsubscribe-auth/AEA7Q5WFSXKWZPNN4POZNQLXFS53ZANCNFSM6AAAAAAX3AKDUA</a>.<br />
You are receiving this because you were mentioned.Message ID:<br />
***@***.***&gt;</p>
</blockquote>
<h4 id="jsmeix_commented_at_2023-05-12_0649"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1545259057">2023-05-12 06:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-12_0649" title="Permanent link">&para;</a></h4>
<p>@andreasberner<br />
because you wrote<br />
"the webdav mounting is not compatible with the rear software"<br />
I think there could be a misunderstanding what I meant with<br />
"the environment where ReaR is run<br />
is not sufficiently standards compliant".</p>
<p>The ReaR software is only bash scripts (and documentation)<br />
so what ReaR (i.e. usr/sbin/rear) does is to run bash.<br />
What bash that is run by ReaR does is to call various<br />
GNU/Linux standard programs as specified in ReaR's bash scripts.<br />
In the end what is done is that various GNU/Linux standard<br />
programs are called (in particular with BACKUP=NETFS where<br />
GNU/Linux standard programs are used for backup and restore<br />
and no special third party backup software is involved).</p>
<p>So when things work without errors (up to "out of space")<br />
with the default TMPDIR '/tmp'<br />
but with the "webdav TMPDIR" all kinds of errors occur,<br />
then it means that with the "webdav TMPDIR"<br />
various GNU/Linux standard programs (including bash)<br />
fail with "all kinds of errors".<br />
You should get the same failures when you call those programs<br />
manually on bash command line when you use the "webdav TMPDIR".</p>
<p>So - as far as I understand it - it is the "webdav TMPDIR"<br />
which is not sufficiently GNU/Linux standards compliant.</p>
<p>Perhaps you can change something how that "remote webdav-Drive"<br />
is mounted (i.e. use some appropriate 'mount' options) to make<br />
the mounted thing sufficiently GNU/Linux standards compliant<br />
to be used as TMPDIR?</p>
<p>A different idea:</p>
<p>What exactly did run out of space with the default TMPDIR?</p>
<p>Relly out of disk space (i.e. physical or virtual harddisk)?<br />
I.e. in your case really out of space on '/dev/vda1'?</p>
<p>Or is it perhaps actually out of memory (RAM plus swap)?<br />
Because nowadays /tmp is often mounted as 'tmpfs'<br />
so /tmp is in RAM (plus swap - '/dev/vda2' in your case).</p>
<p>Check the output of 'df' and 'free' what actually runs out of space.</p>
<p>Because ReaR 2.7 uses by default /var/tmp for its<br />
temporary working area (BUILD_DIR) and because /var/tmp<br />
is normally on the harddisk, it is expected<br />
that really '/dev/vda1' runs out of space.<br />
But if one of the programs that are called by ReaR<br />
uses the default TMPDIR /tmp it may run "out of memory".</p>
<p>When you run ReaR in debug modes (via -d or -D)<br />
then KEEP_BUILD_DIR is automatically set to true,<br />
(see its description in usr/share/rear/conf/default.conf)<br />
which means old ReaR working areas /var/tmp/rear.*<br />
are not removed so you have to manually clean it up.</p>
<h4 id="andreasberner_commented_at_2023-05-24_0533"><img src="https://avatars.githubusercontent.com/u/16906358?v=4" width="50"><a href="https://github.com/andreasberner">andreasberner</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1560481377">2023-05-24 05:33</a>:<a class="headerlink" href="#andreasberner_commented_at_2023-05-24_0533" title="Permanent link">&para;</a></h4>
<p>Hi Johannes,</p>
<p>thanks for your response. There seems to be still a problem in using<br />
remote filesystems for the TMPDIR.<br />
While the webdav protocoll sucks with the below given error messages,
a<br />
sshfs-mounted TMPDIR fails with other error messages like described in</p>
<p><a href="https://debianforum.de/forum/viewtopic.php?t=182913#:~:text=ALLES%20AUSW%C3%84HLEN-,Creating%20recovery%20system%20root%20filesystem%20skeleton%20layout%0AERROR%3A%20Failed%20to%20copy,an%20error%2C%20check%20/var/log/rear/rear%2Ddebian.log%20for%20details,-Das%20o.g">https://debianforum.de/forum/viewtopic.php?t=182913#:~:text=ALLES%20AUSW%C3%84HLEN-,Creating%20recovery%20system%20root%20filesystem%20skeleton%20layout%0AERROR%3A%20Failed%20to%20copy,an%20error%2C%20check%20/var/log/rear/rear%2Ddebian.log%20for%20details,-Das%20o.g</a></p>
<p>When you mention your working example in your reply, can you please<br />
specify details about the mounted filesystem /other?</p>
<p>Especially, is it a local filesystem or a remote filesystem? If
remote,<br />
which protocoll is used for the mounting? NFS, SSHFS ?</p>
<p>Thanks in advance and best regards</p>
<p>Andreas</p>
<p>Am 11.05.2023 um 12:32 schrieb Johannes Meixner:</p>
<blockquote>
<p>@andreasberner
<a href="https://github.com/andreasberner">https://github.com/andreasberner</a></p>
<p>|TMPDIR=/mnt/hidrive/tmp |</p>
<p>and also</p>
<p>|export TMPDIR=/mnt/hidrive/tmp |</p>
<p>in etc/rear/local.conf do not work because usr/sbin/rear<br />
creates its temporary working area (BUILD_DIR) at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L505">https://github.com/rear/rear/blob/master/usr/sbin/rear#L505</a><br />
before the config files get sourced later at<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L598">https://github.com/rear/rear/blob/master/usr/sbin/rear#L598</a></p>
<p>How to set TMPDIR properly see the description in<br />
usr/share/rear/conf/default.conf<br />
(excerpts)</p>
<p>|# TMPDIR # # Relax-and-Recover needs a (temporary) working area
where<br />
it builds in particular # the rescue/recovery system ISO image (and<br />
perhaps even stores the backup archive). ... # To have a specific<br />
working area directory prefix for Relax-and-Recover call # export<br />
TMPDIR="/prefix/for/rear/working/directory" # before calling 'rear'<br />
(/prefix/for/rear/working/directory must already exist). |</p>
<p>For me it works as described:</p>
<p>|# mount -v /dev/sda6 /other # mkdir /other/tmp # export<br />
TMPDIR=/other/tmp # usr/sbin/rear -D mkrescue Relax-and-Recover 2.7
/<br />
Git Running rear mkrescue (PID 26919 date 2023-05-11 12:19:23)
Command<br />
line options: usr/sbin/rear -D mkrescue Using log file:<br />
/root/rear.github.master/var/log/rear/rear-linux-h9wr.log Using
build<br />
area: /other/tmp/rear.TxZuJW4iSV3Cwpd ... |</p>
<p>But I do not have a "remote webdav-Drive from IONOS"<br />
to test how ReaR behaves with that.</p>
<p>The error messages you get like</p>
<p>|Script 'default/005_verify_os_conf.sh' without leading 3-digit
number<br />
'NNN_' ... |</p>
<p>do not make sense because the script '005_verify_os_conf.sh'<br />
has a leading 3-digit number 'NNN_'.</p>
<p>The code that does this is in
usr/share/rear/lib/framework-functions.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128">https://github.com/rear/rear/blob/master/usr/share/rear/lib/framework-functions.sh#L128</a></p>
<p>For me this code works in ReaR and also on command line</p>
<p>|# script='default/005_verify_os_conf.sh' # grep -q<br />
'^[0-9][0-9][0-9]<em>' &lt;&lt;&lt; $( basename $script ) || echo
"Script<br />
'$script' without leading 3-digit number 'NNN</em>'" [no output] #<br />
script='default/05_verify_os_conf.sh' # grep -q
'^[0-9][0-9][0-9]<em>'<br />
&lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without
leading<br />
3-digit number 'NNN</em>'" Script 'default/05_verify_os_conf.sh'
without<br />
leading 3-digit number 'NNN_' #<br />
script='default/0500_verify_os_conf.sh' # grep -q
'^[0-9][0-9][0-9]<em>'<br />
&lt;&lt;&lt; $( basename $script ) || echo "Script '$script' without
leading<br />
3-digit number 'NNN</em>'" Script 'default/0500_verify_os_conf.sh'
without<br />
leading 3-digit number 'NNN_' |</p>
<p>Usually such inexplicable error messages indicate<br />
that the ReaR installation might be somehow messed up<br />
or that the environment where ReaR is run<br />
is not sufficiently standards compliant.</p>
<p>You may try out the current ReaR upstream GitHub master code<br />
from within a separated directory as a test to find out<br />
if things work better then, see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>—<br />
Reply to this email directly, view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/2983#issuecomment-1543746833">https://github.com/rear/rear/issues/2983#issuecomment-1543746833</a>,
or<br />
unsubscribe<br />
<a href="https://github.com/notifications/unsubscribe-auth/AEA7Q5WFSXKWZPNN4POZNQLXFS53ZANCNFSM6AAAAAAX3AKDUA">https://github.com/notifications/unsubscribe-auth/AEA7Q5WFSXKWZPNN4POZNQLXFS53ZANCNFSM6AAAAAAX3AKDUA</a>.<br />
You are receiving this because you were mentioned.Message ID:<br />
***@***.***&gt;</p>
</blockquote>
<h4 id="jsmeix_commented_at_2023-05-24_0643"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1560539542">2023-05-24 06:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-24_0643" title="Permanent link">&para;</a></h4>
<p>@andreasberner</p>
<p>what is mounted at /other is<br />
a normal local harddisk partition<br />
with an ext2 filesystem:</p>
<pre><code># lsblk -io NAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME    TRAN  TYPE  FSTYPE    SIZE MOUNTPOINT
sda     sata  disk          465.8G
...
|-sda6        part  ext2        8G /other
</code></pre>
<p>I never tried a remote filesystem for TMPDIR.<br />
In
<a href="https://github.com/rear/rear/issues/2983#issuecomment-1543746833">https://github.com/rear/rear/issues/2983#issuecomment-1543746833</a><br />
I only liked to show how ReaR works with a different TMPDIR.</p>
<h4 id="andreasberner_commented_at_2023-05-24_0648"><img src="https://avatars.githubusercontent.com/u/16906358?v=4" width="50"><a href="https://github.com/andreasberner">andreasberner</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1560545407">2023-05-24 06:48</a>:<a class="headerlink" href="#andreasberner_commented_at_2023-05-24_0648" title="Permanent link">&para;</a></h4>
<p>I see. My problem is that the server to be backed up is a hosted server
and the internal HDD is almost full or at least not sufficient remaining
capacity to back up the system before copying the result to an other
server.</p>
<p>That is why I am looking for an alternate solution to back up directly
on a remote HDD.</p>
<p>Any idea how to achieve that?</p>
<h4 id="jsmeix_commented_at_2023-05-24_0721"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2983#issuecomment-1560583007">2023-05-24 07:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-05-24_0721" title="Permanent link">&para;</a></h4>
<p>@andreasberner<br />
I know basically nothing about<br />
remote storage and remote filesystems<br />
so I cannot help in this area.</p>
<p>For my tests with ReaR I use almost always</p>
<pre><code>OUTPUT=ISO
BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
BACKUP_URL=nfs://NFS.server.IP.address/path/to/rear/backup
</code></pre>
<p>which results on 'NFS.server.IP.address'<br />
in a 'backup/HOSTNAME' directory a 'rear-HOSTNAME.iso'<br />
plus a separated 'backup.tar.gz' which has the advantage<br />
that the backup of the files is directly accessible<br />
and not somehow "hidden" inside the ISO image.<br />
In general I prefer to keep separated things separated,<br />
cf. RFC 1925 item (5).<br />
For ReaR this means I prefer to keep the ReaR recovery system<br />
(i.e. its ISO image) separated from the backup of the files,<br />
cf. "Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-05-09.2983.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
