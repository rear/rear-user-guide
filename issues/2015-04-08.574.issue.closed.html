<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#574 Issue closed: GPT: parted unable to inform kernel about partition changes - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#574 Issue closed: GPT: parted unable to inform kernel about partition changes";
        var mkdocs_page_input_path = "issues/2015-04-08.574.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#574 Issue closed: GPT: parted unable to inform kernel about partition changes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="574_issue_closed_gpt_parted_unable_to_inform_kernel_about_partition_changes"><a href="https://github.com/rear/rear/issues/574">#574 Issue</a> <code>closed</code>: GPT: parted unable to inform kernel about partition changes<a class="headerlink" href="#574_issue_closed_gpt_parted_unable_to_inform_kernel_about_partition_changes" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>waiting for info</code>, <code>support / question</code></p>
<h4 id="abbbi_opened_issue_at_2015-04-08_2045"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> opened issue at <a href="https://github.com/rear/rear/issues/574">2015-04-08 20:45</a>:<a class="headerlink" href="#abbbi_opened_issue_at_2015-04-08_2045" title="Permanent link">&para;</a></h4>
<p>hi,</p>
<p>on a recent system (ubuntu 14.04) we had troubles finishing the recovery
process with rear. The log showed that parted was unable to inform the
kernel about the changes (like partprobe -s does), the detailed error
message was the one from libparted/arch/linux.c:</p>
<p>("Partition(s) %s on %s have been written, but we have "<br />
"been unable to inform the kernel of the change, "<br />
"probably because it/they are in use. As a result, "<br />
"the old partition(s) will remain in use. You "<br />
"should reboot now before making further changes."</p>
<p>as i understand this error is shown as parted has tried to setup the GPT
information<br />
and fails to update the kernel tables.</p>
<p>So what happened on this system in detail is:</p>
<ol>
<li>rear recover errored out as parteds exit code changes, error message
    above was shown in the recovery log</li>
<li>i then tried to reboot the system (even tho i didnt think it to
    help)</li>
<li>after the reboot, rear recover managed to create the GPT tables and
    partitions, it then continued with the LVM volumes and errored out
    to setup some logical volumes as the device was still in use</li>
</ol>
<p>I did not have any more time left to analyze issue 3, but i went on and
executed the commands from diskrestore.sh by hand. In the end i was able
to create all partitions and LVM volumes without problem and also
formatted and mountet them to /mnt/local, without even using partprobe.</p>
<p>It may as well be some timing issue between creating the partitions and
running partprobe, or maybe<br />
even a problem with the kernel verison in use.</p>
<p>The question is: may it be appropriate to ignore the error from
libparted?</p>
<h4 id="gdha_commented_at_2015-04-09_0847"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-91153952">2015-04-09 08:47</a>:<a class="headerlink" href="#gdha_commented_at_2015-04-09_0847" title="Permanent link">&para;</a></h4>
<p>@abbbi is it possible to paste the <code>diskrestore.sh</code> script? I think it
might be a timing issue (as personally I never encountered this behavior
yet)</p>
<h4 id="abbbi_commented_at_2015-04-09_1001"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-91180481">2015-04-09 10:01</a>:<a class="headerlink" href="#abbbi_commented_at_2015-04-09_1001" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>its ok with creating the partitions for /dev/sda, /dev/sbd however
allways seems to error out with that<br />
message, no matter:</p>
<p>rear&gt; parted -s /dev/sdb mklabel msdos<br />
Error: Partition(s) 1 on /dev/sdb have been written, but we have been
unable to inform the kernel of the change, probably because it/they are
in use. As a result, the old partition(s) will remain in use. You should
reboot now before making further changes.</p>
<p>It does not help if i add a sleep statement of 5 seconds between the
parted calls. I continued<br />
executing the commands from the diskrestore.sh script by hand and it
<em>seems</em> to work, at least i got<br />
/dev/sdb setup with the volume group and LVMS desired. Im just not sure
if they will survive an<br />
reboot.</p>
<h4 id="abbbi_commented_at_2015-04-09_1350"><img src="https://avatars.githubusercontent.com/u/3919561?u=473291dd3dbd58fd0af45714935992a3d416aa6e&v=4" width="50"><a href="https://github.com/abbbi">abbbi</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-91237973">2015-04-09 13:50</a>:<a class="headerlink" href="#abbbi_commented_at_2015-04-09_1350" title="Permanent link">&para;</a></h4>
<p>Hi again,</p>
<p>we were able to recover the system with manual Steps. The issue was not
as simple as though: The error which was repoted from parted can be
ignored, but we ran into other troubles.</p>
<p>The customer had a system with GPT enabled and used GRUB2. As it is my
understanding<br />
if using GRUB2, on the boot disk there has to be a small partition with
the flag "bios_grub". This partition is then used for grub2 to install
its boot files.</p>
<p>This partition was not listed in disklayout or diskrestore files. From
the vcfgbackup we could see that before the restpore on /dev/sda1 there
was an LVM volume. I could not identify any volume with the bios_grub
flag set from the files we had.</p>
<p>We created the needed partition for grub, switched the lvm to another
partition and could then succesfully re-install the bootloader and boot
the system. I think the system was either migrated<br />
from MBR -&gt; GPT at one time or there is some special setup (ubuntu
has a no_bios_grub install<br />
option) were grub2 is used with GPT without having a seperate Grub BIOS
partition.</p>
<p>Still the question if is rear should ignore the error from parted or at
least ask to continue despite the error.</p>
<h4 id="gdha_commented_at_2015-04-09_1507"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-91257897">2015-04-09 15:07</a>:<a class="headerlink" href="#gdha_commented_at_2015-04-09_1507" title="Permanent link">&para;</a></h4>
<p>@abbbi Concerning your question <em>Still the question if is rear should
ignore the error from parted or at least ask to continue despite the
error?</em><br />
If we decide to continue then we should ask the customer, however, the
customer will probably always say <strong>YES</strong>, and, we should not break
automated recover processes.<br />
@schlomo what are your thoughts on this topic?</p>
<h4 id="gdha_commented_at_2015-08-06_1251"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-128352725">2015-08-06 12:51</a>:<a class="headerlink" href="#gdha_commented_at_2015-08-06_1251" title="Permanent link">&para;</a></h4>
<p>@abbbi is this issue still valid with the latest rear snapshot?</p>
<h4 id="gdha_commented_at_2015-10-29_1910"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/574#issuecomment-152290420">2015-10-29 19:10</a>:<a class="headerlink" href="#gdha_commented_at_2015-10-29_1910" title="Permanent link">&para;</a></h4>
<p>no further input received, therefore, we close this issue. If needed it
can be re-opened</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-04-08.574.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
