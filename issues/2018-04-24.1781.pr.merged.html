<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1781 PR merged: Also include other keyboard mappings to support non-US keyboards - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1781 PR merged: Also include other keyboard mappings to support non-US keyboards";
        var mkdocs_page_input_path = "issues/2018-04-24.1781.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1781 PR merged: Also include other keyboard mappings to support non-US keyboards</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1781_pr_merged_also_include_other_keyboard_mappings_to_support_non-us_keyboards"><a href="https://github.com/rear/rear/pull/1781">#1781 PR</a> <code>merged</code>: Also include other keyboard mappings to support non-US keyboards<a class="headerlink" href="#1781_pr_merged_also_include_other_keyboard_mappings_to_support_non-us_keyboards" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2018-04-24_1429"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/1781">2018-04-24 14:29</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2018-04-24_1429" title="Permanent link">&para;</a></h4>
<p>Also include other keyboard mappings to also support users with a non-US
keyboard<br />
because without the right keyboard mapping it could become an awful
annoyance<br />
to work in the recovery system.</p>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong> and <strong>Enhancement</strong><br />
    Actually this provides a workaround when in<br />
    etc/scripts/system-setup.d/10-console-setup.sh<br />
    the <code>loadkeys /etc/dumpkeys.out</code> fails.</p>
</li>
<li>
<p>Impact: <strong>Low</strong> and <strong>High</strong><br />
    For US-keyboard users the impact is at most low,<br />
    for non-US-keyboard users the impact could be even critical.</p>
</li>
<li>
<p>How was this pull request tested?<br />
    It works for me on a SUSE system.<br />
    I don't know where on other systems the other keyboard mapping files
    are stored.<br />
    But it is now at least a starting point that can be easily enhanced
    for other systems.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>By default the current keyboard mapping is dumped to etc/dumpkeys.out<br />
so that it can be set during recovery system startup by<br />
etc/scripts/system-setup.d/10-console-setup.sh<br />
via <code>loadkeys /etc/dumpkeys.out</code>.</p>
<p>But depending on the keyboard mapping<br />
the <code>loadkeys /etc/dumpkeys.out</code> command<br />
may not work in the recovery system<br />
so that some other keyboard mapping files<br />
are also included so that the user can manually set<br />
his keyboard mapping (e.g. via a command like <code>loadkeys de-latin1</code>).</p>
<p>This increases the recovery system size by about 1 MB<br />
(an usual recovery system size is about 500 MB uncompressed)<br />
but without the right keyboard mapping it could be an awful annoyance<br />
to work in the recovery system.</p>
<h4 id="jsmeix_commented_at_2018-04-24_1432"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-383954770">2018-04-24 14:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-24_1432" title="Permanent link">&para;</a></h4>
<p>@gdha @gozora @schabrolles<br />
because my knowledge about keyboard setup is basically zero<br />
(I did this pull request based on a lot of trial and error)<br />
I would very much appreciate it if you could have a look.<br />
Perhaps I did something stupid and the real solution is "just simple".</p>
<h4 id="jsmeix_commented_at_2018-04-25_0917"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384220171">2018-04-25 09:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_0917" title="Permanent link">&para;</a></h4>
<p>In my case the keyboad mapping on the original system<br />
fails to load in the recovery system via <code>loadkeys /etc/dumpkeys.out</code><br />
with this error message:</p>
<pre>
adding map 3 violates explicit keymaps line
</pre>

<p>and I get a keyboard with a default (presumably US) layout<br />
but actually I use a German qwertz keyboard.</p>
<p>On the original system I have a <code>/etc/vconsole.conf</code> file that contains</p>
<pre>
KEYMAP=de-latin1-nodeadkeys
FONT=eurlatgr.psfu
FONT_MAP=none
FONT_UNIMAP=
</pre>

<p>The unexpected thing is that in the recovery system<br />
I can run <code>loadkeys de-latin1-nodeadkeys</code><br />
which "just works" so that one could assume<br />
the dumped keyboad mapping on the original system<br />
is not de-latin1-nodeadkeys but something different<br />
but on the original system</p>
<pre>
# dumpkeys -f >/tmp/dumpkeys.out

# loadkeys de-latin1-nodeadkeys

# dumpkeys -f >/tmp/dumpkeys.de-latin1-nodeadkeys

# diff -s /tmp/dumpkeys.out /tmp/dumpkeys.de-latin1-nodeadkeys
Files /tmp/dumpkeys.out and /tmp/dumpkeys.de-latin1-nodeadkeys are identical

# loadkeys /tmp/dumpkeys.out

# loadkeys /tmp/dumpkeys.de-latin1-nodeadkeys 
</pre>

<p>so something subtle makes in the recovery system<br />
<code>loadkeys /etc/dumpkeys.out</code> fail...</p>
<h4 id="gdha_commented_at_2018-04-25_0951"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384230326">2018-04-25 09:51</a>:<a class="headerlink" href="#gdha_commented_at_2018-04-25_0951" title="Permanent link">&para;</a></h4>
<p>@jsmeix Perhaps it would be better we load all the keyboard keys like
the plain Linux OS? Is lot of overhead but this way we have all
keyboards. Just a though...</p>
<h4 id="jsmeix_commented_at_2018-04-25_0951"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384230363">2018-04-25 09:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_0951" title="Permanent link">&para;</a></h4>
<p>It is the <code>-f1</code> in <code>dumpkeys -f1 &gt;$ROOTFS_DIR/etc/dumpkeys.out</code><br />
in rescue/GNU/Linux/500_clone_keyboard_mappings.sh<br />
that makes things fail:</p>
<pre>
# dumpkeys -f1 >/tmp/dumpkeys.out2

# loadkeys /tmp/dumpkeys.out2
adding map 3 violates explicit keymaps line
</pre>

<p>On none of my systems down to SLE10 a <code>-f1</code><br />
is mentioned in <code>man dumpkeys</code>.<br />
It is always only plain <code>-f</code> and that works for me.</p>
<h4 id="jsmeix_commented_at_2018-04-25_0954"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384231113">2018-04-25 09:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_0954" title="Permanent link">&para;</a></h4>
<p><code>git log -p --follow usr/share/rear/rescue/GNU/Linux/500_clone_keyboard_mappings.sh</code><br />
shows that the non-working <code>-f1</code> was there since the beginning of git
history<br />
so that I have no idea if there was a reason or if it is just a typo.</p>
<h4 id="jsmeix_commented_at_2018-04-25_1000"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384232695">2018-04-25 10:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1000" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
including the whole keymaps default directory /usr/share/kbd/keymaps/<br />
increases the recovery system size by about 3 MB in my case</p>
<pre>
# du -hs /usr/share/kbd/keymaps
2.8M    /usr/share/kbd/keymaps
</pre>

<p>and I know that on POWER architecture the recovery system must be kept
very small<br />
(bigger recovery systems on POWER architecture can cause totally weird
failures).</p>
<p>But I agree that it can be crucial that the recovery system supports any
keyboad<br />
in particular for system migration when the keyboard of the new
hardware<br />
may not be known in advance when "rear mkrescue" is run.</p>
<p>So - as always - the right way out is to introduce config variables<br />
where the user can specify what he actually needs.<br />
I will implement that...</p>
<h4 id="gozora_commented_at_2018-04-25_1040"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384243140">2018-04-25 10:40</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-25_1040" title="Permanent link">&para;</a></h4>
<p>@jsmeix honestly, my knowledge in this area is equal to 0 :-(</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2018-04-25_1049"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384245464">2018-04-25 10:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1049" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
no worries!<br />
My knowledge in this area was equal to 0 but meanwhile it became a
little bit more ;-)</p>
<h4 id="jsmeix_commented_at_2018-04-25_1208"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384263627">2018-04-25 12:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1208" title="Permanent link">&para;</a></h4>
<p>An addedum to<br />
<a href="https://github.com/rear/rear/pull/1781#issuecomment-384230363">https://github.com/rear/rear/pull/1781#issuecomment-384230363</a></p>
<p>Interestingly on SLE10 things work with <code>dumpkeys -f1</code></p>
<pre>
# dumpkeys -f1 >/tmp/dumpkeys.out

# loadkeys /tmp/dumpkeys.out && echo OK
Loading /tmp/dumpkeys.out
OK
</pre>

<p>but also with plain <code>dumpkeys -f</code></p>
<pre>
# dumpkeys -f >/tmp/dumpkeys.out

# loadkeys /tmp/dumpkeys.out && echo OK
Loading /tmp/dumpkeys.out
OK
</pre>

<p>and there is no <code>-f1</code> described in <code>man dumpkeys</code> or via <code>dumpkeys -h</code>
on SLE10:</p>
<pre>
# man dumpkeys
...
SYNOPSIS
       dumpkeys [ -hilfn -ccharset --help --short-info --long-info --numeric --full-table --funcs-only --keys-only --compose-only --charset=charset ]
...
       -f --full-table
              This makes dumpkeys skip all the short-hand heuristics (see keymaps(5)) and output the key bindings in the canonical form. First a keymaps  line  describing
              the  currently defined modifier combinations is printed. Then for each key a row with a column for each modifier combination is printed. For example, if the
              current keymap in use uses seven modifiers, every row will have seven action code columns. This format can be useful for example to programs that  post-pro‐
              cess the output of dumpkeys.

# dumpkeys -h
dumpkeys version 1.12
...
       -f --full-table     don't use short-hand notations, one row per keycode
</pre>

<p>so that I will use plain <code>dumpkeys -f</code> in
/rescue/GNU/Linux/500_clone_keyboard_mappings.sh</p>
<h4 id="jsmeix_commented_at_2018-04-25_1249"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384274528">2018-04-25 12:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1249" title="Permanent link">&para;</a></h4>
<p>Since<br />
<a href="https://github.com/rear/rear/pull/1781/commits/e626787fa5e5a5293fdb2e9254953c5ddfb0f15f">https://github.com/rear/rear/pull/1781/commits/e626787fa5e5a5293fdb2e9254953c5ddfb0f15f</a><br />
including and setting keyboard mappings in the recovery system<br />
works well for me (and sufficiently fail-safe) for the first time.</p>
<p>Now there are the new (but intentionally not yet documented) config
variables</p>
<p>KEYMAPS_DEFAULT_DIRECTORY which specifies the default directory for
keymaps</p>
<p>KEYMAPS_DIRECTORIES which is a string of keymap directories that
should<br />
get included in the recovery system</p>
<p>KEYMAP which is a keymap file for <code>loadkeys</code> in the recovery system</p>
<p>e.g. what I used in local.conf</p>
<pre>
KEYMAPS_DEFAULT_DIRECTORY=""
KEYMAPS_DIRECTORIES="/usr/share/kbd/keymaps/legacy"
KEYMAP="de-latin1-nodeadkeys"
</pre>

<h4 id="jsmeix_commented_at_2018-04-25_1324"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384285219">2018-04-25 13:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1324" title="Permanent link">&para;</a></h4>
<p>@gdha @schabrolles<br />
if you do not object against the new KEYMAP* config variables<br />
I would document them tomorrow in default.conf<br />
and then I would like to merge this pull request.</p>
<p>I think with the new KEYMAP* config variables there cannot be<br />
a severe regression because if somehow the default behaviour<br />
does no longer work the user can now manually specify what<br />
is needed to make it work in his particular environment.</p>
<h4 id="jsmeix_commented_at_2018-04-25_1415"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384302384">2018-04-25 14:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1415" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/pull/1781/commits/4719c5ad14015bbe69018115137feb092e3dba98">https://github.com/rear/rear/pull/1781/commits/4719c5ad14015bbe69018115137feb092e3dba98</a><br />
I describe KEYMAPS_DEFAULT_DIRECTORY, KEYMAPS_DIRECTORIES, and
KEYMAP<br />
in default.conf so that you can have a look how I meant them to be used.</p>
<h4 id="jsmeix_commented_at_2018-04-25_1508"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384322051">2018-04-25 15:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-25_1508" title="Permanent link">&para;</a></h4>
<p>@gdha @schabrolles @gozora<br />
could you do me a favour and report here<br />
what the default directory for keymaps is<br />
on whatever non-SUSE systems you have.</p>
<p>On my SUSE systems I have in <code>man loadkeys</code></p>
<pre>
FILES
       /usr/share/kbd/keymaps
              default directory for keymaps
</pre>

<p>which is actually true because I get things like</p>
<pre>
# rpm -qa | grep -i kbd
kbd-...
kbd-legacy-...

# rpm -ql kbd kbd-legacy | grep de-latin1
/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1-nodeadkeys.map.gz
/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1.map.gz
/usr/share/kbd/keymaps/legacy/mac/all/mac-de-latin1-nodeadkeys.map.gz
/usr/share/kbd/keymaps/legacy/mac/all/mac-de-latin1.map.gz
/usr/share/kbd/keymaps/legacy/sun/sunt5-de-latin1.map.gz
</pre>

<p>I would like to know how those things look on non-SUSE systems.</p>
<h4 id="gozora_commented_at_2018-04-25_1535"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384331316">2018-04-25 15:35</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-25_1535" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix,</p>
<ul>
<li>Debian 9.2 (stretch)</li>
</ul>
<!-- -->

<pre><code>FILES
       /usr/share/keymaps
              default directory for keymaps

       /usr/src/linux/drivers/char/defkeymap.map
              default kernel keymap
</code></pre>
<ul>
<li>Centos 7.3.1611 (Core)</li>
</ul>
<!-- -->

<pre><code>FILES
       /lib/kbd/keymaps
              default directory for keymaps

       /usr/src/linux/drivers/char/defkeymap.map
              default kernel keymap
</code></pre>
<ul>
<li>Fedora release 26 (Twenty Six)</li>
</ul>
<!-- -->

<pre><code>FILES
       /lib/kbd/keymaps
              default directory for keymaps

       /usr/src/linux/drivers/char/defkeymap.map
              default kernel keymap
</code></pre>
<ul>
<li>Arch Linux</li>
</ul>
<!-- -->

<pre><code>FILES
       /usr/share/kbd/keymaps
              default directory for keymaps

       /usr/src/linux/drivers/char/defkeymap.map
              default kernel keymap
</code></pre>
<ul>
<li>Ubuntu 12.04.5 LTS (Precise)</li>
</ul>
<!-- -->

<pre><code>FILES
       /usr/share/keymaps
              default directory for keymaps

       /usr/src/linux/drivers/char/defkeymap.map
              default kernel keymap
</code></pre>
<p>Hope it helps.</p>
<p>V.</p>
<h4 id="schabrolles_commented_at_2018-04-25_1538"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384332401">2018-04-25 15:38</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-04-25_1538" title="Permanent link">&para;</a></h4>
<p>@gozora ... too quick for me ;-)</p>
<h4 id="gozora_commented_at_2018-04-25_1544"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384334494">2018-04-25 15:44</a>:<a class="headerlink" href="#gozora_commented_at_2018-04-25_1544" title="Permanent link">&para;</a></h4>
<p>Btw, to check whether defaults in man page are really used by <em>loadkeys</em>
binary, <code>strace -e open loadkeys any_non_existing_file</code> can be used ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2018-04-26_0659"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384534357">2018-04-26 06:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_0659" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
many thanks for your
<a href="https://github.com/rear/rear/pull/1781#issuecomment-384331316">https://github.com/rear/rear/pull/1781#issuecomment-384331316</a><br />
it helps a lot!<br />
I will enhance KEYMAPS_DEFAULT_DIRECTORY autodetection accordingly.</p>
<h4 id="jsmeix_commented_at_2018-04-26_0702"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384535021">2018-04-26 07:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_0702" title="Permanent link">&para;</a></h4>
<p>@schabrolles @gdha<br />
perhaps you can provide what the default directory for keymaps is<br />
on whatever RHEL systems you have (ideally also on older ones).</p>
<h4 id="jsmeix_commented_at_2018-04-26_0735"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384543416">2018-04-26 07:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_0735" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/pull/1781#issuecomment-384332401">https://github.com/rear/rear/pull/1781#issuecomment-384332401</a></p>
<p>This time @gozora won even with a lot of text!<br />
Cf.<br />
<a href="https://github.com/rear/rear/issues/1775#issuecomment-381120658">https://github.com/rear/rear/issues/1775#issuecomment-381120658</a><br />
;-)<br />
He is getting better with impressive speed!<br />
I get a bit anxious what may happen next.<br />
Perhaps an elaborated answer before the question?</p>
<h4 id="schabrolles_commented_at_2018-04-26_0840"><img src="https://avatars.githubusercontent.com/u/19491077?u=0021b16ab426902cbe676f6831f41607bbe4d441&v=4" width="50"><a href="https://github.com/schabrolles">schabrolles</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384560856">2018-04-26 08:40</a>:<a class="headerlink" href="#schabrolles_commented_at_2018-04-26_0840" title="Permanent link">&para;</a></h4>
<p>RHEL 6/7 are like CentOS/Fedora ones ... but I don't have anything into
<code>/usr/src/linux/</code> ...</p>
<pre><code>FILES
       /lib/kbd/keymaps
              default directory for keymaps
</code></pre>
<h4 id="jsmeix_commented_at_2018-04-26_0906"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384568679">2018-04-26 09:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_0906" title="Permanent link">&para;</a></h4>
<p>@schabrolles<br />
many thanks for your prompt reply!</p>
<h4 id="jsmeix_commented_at_2018-04-26_0924"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384574103">2018-04-26 09:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_0924" title="Permanent link">&para;</a></h4>
<p>FYI related to
<a href="https://github.com/rear/rear/pull/1781#issuecomment-384334494">https://github.com/rear/rear/pull/1781#issuecomment-384334494</a></p>
<p>I found out how one can determine what keymap files plus include files<br />
one particular keyboad mapping needs so that it can be loaded.</p>
<p>In my case for <code>loadkeys de-latin1-nodeadkeys</code> it is "just as simple as"
;-)</p>
<pre>
# for f in $( strace -f -e open loadkeys de-latin1-nodeadkeys 2>&1 | grep '/usr/share/kbd/keymaps/legacy/' | grep -v 'O_DIRECTORY' | grep -o 'open.*,' | cut -d '"' -f2 ) ; do readlink -e $f ; done

/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1-nodeadkeys.map.gz
/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1.map.gz
/usr/share/kbd/keymaps/legacy/i386/include/qwertz-layout.inc
/usr/share/kbd/keymaps/legacy/i386/include/compose.inc
/usr/share/kbd/keymaps/legacy/i386/include/linux-with-alt-and-altgr.inc
/usr/share/kbd/keymaps/legacy/i386/include/linux-keys-bare.inc
/usr/share/kbd/keymaps/legacy/i386/include/euro2.map.gz
/usr/share/kbd/keymaps/legacy/include/compose.latin1
</pre>

<p>Simplifying that command is left as an exercise to the reader ;-)</p>
<p>Accordingly with</p>
<pre>
KEYMAPS_DEFAULT_DIRECTORY="/usr/share/kbd/keymaps"
KEYMAPS_DIRECTORIES="/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1-nodeadkeys.map.gz /usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1.map.gz /usr/share/kbd/keymaps/legacy/i386/include/qwertz-layout.inc /usr/share/kbd/keymaps/legacy/i386/include/compose.inc /usr/share/kbd/keymaps/legacy/i386/include/linux-with-alt-and-altgr.inc /usr/share/kbd/keymaps/legacy/i386/include/linux-keys-bare.inc /usr/share/kbd/keymaps/legacy/i386/include/euro2.map.gz /usr/share/kbd/keymaps/legacy/include/compose.latin1"
KEYMAP="de-latin1-nodeadkeys"
</pre>

<p>(one can as well specify plain files as KEYMAPS_DIRECTORIES values)<br />
I get a minimal recovery system that contains only what is needed</p>
<pre>
# find /tmp/rear.owdPbH9RbpT2GqN/rootfs/ | grep keymaps
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/include
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/include/compose.latin1
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include/qwertz-layout.inc
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include/linux-keys-bare.inc
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include/linux-with-alt-and-altgr.inc
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include/compose.inc
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/include/euro2.map.gz
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/qwertz
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1-nodeadkeys.map.gz
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/qwertz/de-latin1.map.gz
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/qwerty
/tmp/rear.owdPbH9RbpT2GqN/rootfs/usr/share/kbd/keymaps/legacy/i386/qwerty/defkeymap.map.gz
</pre>

<p>(defkeymap.map.gz gets added in any case by
500_clone_keyboard_mappings.sh)<br />
to run <code>loadkeys de-latin1-nodeadkeys</code> successfully in the recovery
system<br />
by etc/scripts/system-setup.d/10-console-setup.sh</p>
<h4 id="jsmeix_commented_at_2018-04-26_1044"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1781#issuecomment-384595204">2018-04-26 10:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2018-04-26_1044" title="Permanent link">&para;</a></h4>
<p>My "latest greatest" current code here works so well for me<br />
so that I would like to merge it today soon<br />
unless there are objections.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2018-04-24.1781.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
