<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2429 Issue closed: Implement iSCSI support (currently iSCSI needs special manual setup) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2429 Issue closed: Implement iSCSI support (currently iSCSI needs special manual setup)";
        var mkdocs_page_input_path = "issues/2020-06-17.2429.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2429 Issue closed: Implement iSCSI support (currently iSCSI needs special manual setup)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2429_issue_closed_implement_iscsi_support_currently_iscsi_needs_special_manual_setup"><a href="https://github.com/rear/rear/issues/2429">#2429 Issue</a> <code>closed</code>: Implement iSCSI support (currently iSCSI needs special manual setup)<a class="headerlink" href="#2429_issue_closed_implement_iscsi_support_currently_iscsi_needs_special_manual_setup" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>, <code>no-issue-activity</code></p>
<h4 id="jsmeix_opened_issue_at_2020-06-17_0956"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2429">2020-06-17 09:56</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2020-06-17_0956" title="Permanent link">&para;</a></h4>
<p>For a first idea how to implement iSCSI support see below<br />
<a href="https://github.com/rear/rear/issues/2429#issuecomment-646500447">https://github.com/rear/rear/issues/2429#issuecomment-646500447</a></p>
<p>If that is not possible "rear mkrescue/mkbackup"<br />
should at least tell the user when an iSCSI device is used<br />
i.e. when that iSCSI device appears in disklayout.conf because then<br />
"rear recover" may not "just work" because iSCSI is not (yet) fully
supported<br />
but needs some manual setup, cf.<br />
<a href="https://github.com/rear/rear/issues/2429#issuecomment-645626221">https://github.com/rear/rear/issues/2429#issuecomment-645626221</a></p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): ReaR 2.6</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): iSCSI</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):<br />
    see
    <a href="https://github.com/rear/rear/issues/2428#issuecomment-645236747">https://github.com/rear/rear/issues/2428#issuecomment-645236747</a><br />
    (excerpt):</p>
</li>
</ul>
<!-- -->

<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                      KNAME     PKNAME    TRAN   TYPE  FSTYPE             SIZE MOUNTPOINT
/dev/sda                  /dev/sda            sata   disk                      50G 
|-/dev/sda1               /dev/sda1 /dev/sda         part  swap               995M [SWAP]
`-/dev/sda2               /dev/sda2 /dev/sda         part  btrfs               49G /
/dev/sdb                  /dev/sdb            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi1_lun1 /dev/dm-1 /dev/sdb         mpath linux_raid_member  512M 
/dev/sdc                  /dev/sdc            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi1_lun2 /dev/dm-0 /dev/sdc         mpath linux_raid_member  256M 
/dev/sdd                  /dev/sdd            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi1_lun1 /dev/dm-1 /dev/sdd         mpath linux_raid_member  512M 
/dev/sde                  /dev/sde            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi1_lun2 /dev/dm-0 /dev/sde         mpath linux_raid_member  256M 
/dev/sdf                  /dev/sdf            iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_A_1    /dev/dm-2 /dev/sdf         mpath linux_raid_member    5G 
/dev/sdg                  /dev/sdg            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi1_lun1 /dev/dm-1 /dev/sdg         mpath linux_raid_member  512M 
/dev/sdh                  /dev/sdh            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_2    /dev/dm-3 /dev/sdh         mpath linux_raid_member  512M 
/dev/sdi                  /dev/sdi            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_3    /dev/dm-4 /dev/sdi         mpath linux_raid_member  512M 
/dev/sdj                  /dev/sdj            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi1_lun2 /dev/dm-0 /dev/sdj         mpath linux_raid_member  256M 
/dev/sdk                  /dev/sdk            iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_A_1    /dev/dm-2 /dev/sdk         mpath linux_raid_member    5G 
/dev/sdl                  /dev/sdl            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_2    /dev/dm-3 /dev/sdl         mpath linux_raid_member  512M 
/dev/sdm                  /dev/sdm            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_3    /dev/dm-4 /dev/sdm         mpath linux_raid_member  512M 
/dev/sdn                  /dev/sdn            iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_A_1    /dev/dm-2 /dev/sdn         mpath linux_raid_member    5G 
/dev/sdo                  /dev/sdo            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_2    /dev/dm-3 /dev/sdo         mpath linux_raid_member  512M 
/dev/sdp                  /dev/sdp            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_A_3    /dev/dm-4 /dev/sdp         mpath linux_raid_member  512M 
/dev/sr0                  /dev/sr0            ata    rom                     1024M 
/dev/sdq                  /dev/sdq            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi2_lun1 /dev/dm-5 /dev/sdq         mpath linux_raid_member  512M 
/dev/sdr                  /dev/sdr            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi2_lun2 /dev/dm-6 /dev/sdr         mpath linux_raid_member  256M 
/dev/sds                  /dev/sds            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi2_lun1 /dev/dm-5 /dev/sds         mpath linux_raid_member  512M 
/dev/sdt                  /dev/sdt            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi2_lun2 /dev/dm-6 /dev/sdt         mpath linux_raid_member  256M 
/dev/sdu                  /dev/sdu            iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_B_1    /dev/dm-7 /dev/sdu         mpath linux_raid_member    5G 
/dev/sdv                  /dev/sdv            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_2    /dev/dm-8 /dev/sdv         mpath linux_raid_member  512M 
/dev/sdw                  /dev/sdw            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_3    /dev/dm-9 /dev/sdw         mpath linux_raid_member  512M 
/dev/sdx                  /dev/sdx            iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/iscsi2_lun1 /dev/dm-5 /dev/sdx         mpath linux_raid_member  512M 
/dev/sdy                  /dev/sdy            iscsi  disk  linux_raid_member  256M 
`-/dev/mapper/iscsi2_lun2 /dev/dm-6 /dev/sdy         mpath linux_raid_member  256M 
/dev/sdz                  /dev/sdz            iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_B_1    /dev/dm-7 /dev/sdz         mpath linux_raid_member    5G 
/dev/sdaa                 /dev/sdaa           iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_2    /dev/dm-8 /dev/sdaa        mpath linux_raid_member  512M 
/dev/sdab                 /dev/sdab           iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_3    /dev/dm-9 /dev/sdab        mpath linux_raid_member  512M 
/dev/sdac                 /dev/sdac           iscsi  disk  linux_raid_member    5G 
`-/dev/mapper/site_B_1    /dev/dm-7 /dev/sdac        mpath linux_raid_member    5G 
/dev/sdad                 /dev/sdad           iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_2    /dev/dm-8 /dev/sdad        mpath linux_raid_member  512M 
/dev/sdae                 /dev/sdae           iscsi  disk  linux_raid_member  512M 
`-/dev/mapper/site_B_3    /dev/dm-9 /dev/sdae        mpath linux_raid_member  512M
</code></pre>
<h4 id="jsmeix_commented_at_2020-06-17_1214"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645337113">2020-06-17 12:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-17_1214" title="Permanent link">&para;</a></h4>
<p>Because this issue is not about to add iSCSI support (which needs
sponsorship)<br />
but only to tell the user when an iSCSI device is in disklayout.conf<br />
I think I could implement relatively easily a test that checks<br />
if a device in disklayout.conf appears as <code>iscsi</code> TRAN in lsblk output<br />
and show a user information+confirmation dialog in that case,<br />
i.e. something similar as the 'BACKUP_URL_ISO_PROCEED_...'<br />
user information+confirmation dialog in<br />
prep/default/040_check_backup_and_output_scheme.sh<br />
cf. the comment in that script<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/prep/default/040_check_backup_and_output_scheme.sh#L12">https://github.com/rear/rear/blob/master/usr/share/rear/prep/default/040_check_backup_and_output_scheme.sh#L12</a></p>
<h4 id="gozora_commented_at_2020-06-17_2109"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645626221">2020-06-17 21:09</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-17_2109" title="Permanent link">&para;</a></h4>
<p>So I did some tests on same VM from
<a href="https://github.com/rear/rear/issues/2428">https://github.com/rear/rear/issues/2428</a>.
But this time I've added iSCSI LUN /dev/sdd, so the final setup looks
something like this:</p>
<pre><code>[root@centos7 ~]# lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                        KNAME     PKNAME    TRAN   TYPE  FSTYPE             SIZE MOUNTPOINT
/dev/sda                    /dev/sda            sata   disk                       8G 
|-/dev/sda1                 /dev/sda1 /dev/sda         part  vfat               200M /boot/efi
|-/dev/sda2                 /dev/sda2 /dev/sda         part  xfs                  1G /boot
`-/dev/sda3                 /dev/sda3 /dev/sda         part  LVM2_member        6.8G 
  |-/dev/mapper/centos-root /dev/dm-0 /dev/sda3        lvm   xfs                  6G /
  `-/dev/mapper/centos-swap /dev/dm-1 /dev/sda3        lvm   swap               820M [SWAP]
/dev/sdb                    /dev/sdb            sata   disk  mpath_member         8G 
`-/dev/mapper/disk_2        /dev/dm-2 /dev/sdb         mpath linux_raid_member    8G 
  `-/dev/md0                /dev/md0  /dev/dm-2        raid1 xfs                  8G /data
/dev/sdc                    /dev/sdc            sata   disk  mpath_member         8G 
`-/dev/mapper/disk_1        /dev/dm-3 /dev/sdc         mpath linux_raid_member    8G 
  `-/dev/md0                /dev/md0  /dev/dm-3        raid1 xfs                  8G /data
/dev/sdd                    /dev/sdd            iscsi  disk  xfs                  1G /bigdata
/dev/sr0                    /dev/sr0            ata    rom                     1024M
</code></pre>
<p>With following <em>local.conf</em></p>
<pre><code>BACKUP=NETFS
BACKUP_OPTIONS="nfsvers=3,nolock"
OUTPUT=ISO

BACKUP_URL=nfs://backup/mnt/rear
OUTPUT_URL=nfs://backup/mnt/rear/iso

BACKUP_PROG_EXCLUDE+=( /mnt )

SSH_FILES="yes"
SSH_UNPROTECTED_PRIVATE_KEYS="yes"

PROGS+=( /usr/libexec/openssh/sftp-server )
COPY_AS_IS+=( /usr/libexec/openssh/sftp-server /etc/iscsi /var/lib/iscsi )

USE_RESOLV_CONF="no"
USE_DHCLIENT="no"

NETWORKING_PREPARATION_COMMANDS=( 'ip addr add 192.168.56.200/24 dev enp0s8' 'ip link set dev enp0s8 up' 'return' )

BOOT_OVER_SAN="yes"
AUTOEXCLUDE_MULTIPATH="no"

REQUIRED_PROGS+=( iscsid iscsiadm )
</code></pre>
<p>I've successfully restored structure and data to <em>/bigdata</em> residing on
iSCSI LUN.<br />
Only modification comparing to non-iSCSI setup is to copy Iscsi daemon
configuration (/etc/iscsi) and LUN connection config files
(/var/lib/iscsi) + add iscsid and iscsiadm (open-iscsi administration
utility) into ReaR recovery system.</p>
<p>After boot into ReaR rescue system, one need to start iscsid, login to
iSCSI target and run <code>rear recover</code>.</p>
<pre><code>RESCUE centos7:~ # lsscsi
[3:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sda 
[4:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdb 
[7:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdc 
[8:0:0:0]    cd/dvd  VBOX     CD-ROM           1.0   /dev/sr0

RESCUE centos7:~ # iscsid

RESCUE centos7:~ # /sbin/iscsiadm -m node --loginall=automatic
Logging in to [iface: default, target: iqn.2020-06-sk.virtual:backup, portal: 192.168.56.7,3260] (multiple)
Login to [iface: default, target: iqn.2020-06-sk.virtual:backup, portal: 192.168.56.7,3260] successful.

RESCUE centos7:~ # lsscsi
[3:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sda 
[4:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdb 
[7:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdc 
[8:0:0:0]    cd/dvd  VBOX     CD-ROM           1.0   /dev/sr0 
[10:0:0:0]   storage IET      Controller       0001  -        
[10:0:0:1]   disk    IET      VIRTUAL-DISK     0001  /dev/sdd

RESCUE centos7:~ # rear recover
Relax-and-Recover 2.5 / Git
Running rear recover (PID 503)
...
</code></pre>
<p>Since this setup is quite straightforward and relatively easy, I'd keep
things as they currently are.<br />
Because only thing that ReaR needs to have full featured iSCSI support
is startup script for iSCSI daemon starting after network is setup
(<em>/etc/scripts/system-setup</em>), which is minor effort task ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-18_0617"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645803314">2020-06-18 06:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-18_0617" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
many thanks for your explanatory report about using ReaR with iSCSI!</p>
<p>It helps so much when someone who sits in front of such a "beast"<br />
provides a comprehensible report how ReaR behaves in this case,<br />
what exactly is needed to make it work, and how things look like.</p>
<h4 id="gdha_commented_at_2020-06-18_0711"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645826280">2020-06-18 07:11</a>:<a class="headerlink" href="#gdha_commented_at_2020-06-18_0711" title="Permanent link">&para;</a></h4>
<p>@gozora Great - nice test. It only requires a prep script to make it
really supported ;-)</p>
<h4 id="gozora_commented_at_2020-06-18_0757"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645849476">2020-06-18 07:57</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_0757" title="Permanent link">&para;</a></h4>
<p>@gdha I was thinking about something like introduce some variables into
default.conf.</p>
<p>maybe:</p>
<pre><code>ISCSI_DAEMON="iscsid -f"
ISCSI_LOGIN_COMMAND="iscsiadm -m node --loginall=automatic"
</code></pre>
<p>Which could be launched after successful network setup.<br />
Shouldn't be a big problem to get this done.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-18_0814"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645858253">2020-06-18 08:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-18_0814" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
perhaps as a first test something like</p>
<pre><code>NETWORKING_PREPARATION_COMMANDS=(
'ip addr add 192.168.56.200/24 dev enp0s8'
'ip link set dev enp0s8 up'
'sleep 1'
'iscsid -f'
'sleep 1'
'iscsiadm -m node --loginall=automatic'
'return'
)
</code></pre>
<p>may do it in your particular case.<br />
Those <code>sleep 1</code> are meant to give things some time to startup
completely.</p>
<h4 id="gozora_commented_at_2020-06-18_0831"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645867513">2020-06-18 08:31</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_0831" title="Permanent link">&para;</a></h4>
<p>Damn! I've spent an hour yesterday figuring out how to inject code that
would execute after network is setup and couldn't make up anything.<br />
I'll certainly test it today afternoon.</p>
<p>Thanks!</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-18_0841"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645872696">2020-06-18 08:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-18_0841" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
there is also PRE_RECOVERY_SCRIPT that gets evaluated by<br />
usr/share/rear/setup/default/010_pre_recovery_script.sh<br />
so that PRE_RECOVERY_SCRIPT is run each time "rear recover" is run<br />
which could make a difference when one re-runs "rear recover" if it
failed<br />
in contrast to NETWORKING_PREPARATION_COMMANDS<br />
that are run only once during recovery system startup via<br />
/etc/scripts/system-setup.d/60-network-devices.sh</p>
<h4 id="gozora_commented_at_2020-06-18_0847"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-645875739">2020-06-18 08:47</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_0847" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Will try that out too.</p>
<p>Thanks!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-06-18_1752"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646216100">2020-06-18 17:52</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_1752" title="Permanent link">&para;</a></h4>
<p>Adding:</p>
<pre><code>NETWORKING_PREPARATION_COMMANDS=( 'ip addr add 192.168.56.200/24 dev enp0s8'
'ip link set dev enp0s8 up' 
'sleep 1'
'iscsid'
'sleep 1'
'iscsiadm -m node --loginall=automatic'
'return' )
</code></pre>
<p>into <em>local.conf</em> works as charm.<br />
After ReaR recovery system boot, I have iSCSI LUN present without
further configuration.</p>
<pre><code>$ ssh restore
Warning: Permanently added 'restore,192.168.56.200' (ECDSA) to the list of known hosts.

Welcome to Relax-and-Recover. Run "rear recover" to restore your system !

RESCUE centos7:~ # lsscsi
[3:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sda 
[4:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdb 
[7:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sdc 
[8:0:0:0]    cd/dvd  VBOX     CD-ROM           1.0   /dev/sr0 
[10:0:0:0]   storage IET      Controller       0001  -        
[10:0:0:1]   disk    IET      VIRTUAL-DISK     0001  /dev/sdd
</code></pre>
<h4 id="gozora_commented_at_2020-06-18_1812"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646225993">2020-06-18 18:12</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_1812" title="Permanent link">&para;</a></h4>
<p>Since iSCSI can be configured using standard ReaR channels and one don't
need to do any additional hacking after ReaR recovery system boot. I'd
say that should not even warn user and let him just Relax-and-Recover
;-)</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-06-18_1814"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646226667">2020-06-18 18:14</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-18_1814" title="Permanent link">&para;</a></h4>
<p>Do you think that iSCSI setup in ReaR is worth to document?</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0719"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646481050">2020-06-19 07:19</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0719" title="Permanent link">&para;</a></h4>
<p>I replaced the word "warn" by "tell" in the title and in my above
entries.<br />
I was uncomfortable with the word "warn" when I used it because I agree
with<br />
<a href="https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html">https://blog.schlomo.schapiro.org/2015/04/warning-is-waste-of-my-time.html</a><br />
but I had no better idea what other word I could use here.</p>
<p>I think as long as "rear recover" does not "just work" with iSCSI<br />
ReaR should tell the user during "rear mkrescue/mkbackup"<br />
when an iSCSI device appears in disklayout.conf because then<br />
the user must manually setup some (simple) additional things.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0722"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646482387">2020-06-19 07:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0722" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
perhaps we are lucky and there appears a ReaR user with iSCSI<br />
who is faster in implementing automagic iSCSI support in ReaR<br />
than we need do document how to setup things manually?<br />
;-)</p>
<h4 id="gozora_commented_at_2020-06-19_0730"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646485820">2020-06-19 07:30</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-19_0730" title="Permanent link">&para;</a></h4>
<p>From error-&gt;warnign-&gt;tell that is nice deescalation, but I like
the final version.<br />
Over the years here, I think there was no one with iSCSI, so doing
automatic iSCSI setup in ReaR look kind of waste of time especially if
you can do manual setup relatively easy.</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0804"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646500447">2020-06-19 08:04</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0804" title="Permanent link">&para;</a></h4>
<p>What I have in mind with "automagic iSCSI support in ReaR" is that<br />
when an iSCSI device appears in disklayout.conf<br />
then</p>
<pre><code>COPY_AS_IS+=( "${ISCSI_COPY_AS_IS[@]}" )
REQUIRED_PROGS+=( "${ISCSI_REQUIRED_PROGS[@]}" )
</code></pre>
<p>happens automatically with new config variables in default.conf</p>
<pre><code>ISCSI_COPY_AS_IS=( /etc/iscsi /var/lib/iscsi )
ISCSI_REQUIRED_PROGS=( iscsid iscsiadm )
</code></pre>
<p>and<br />
there is a new recovery system startup script like<br />
usr/share/rear/skel/default/etc/scripts/system-setup.d/63-iscsi.sh<br />
(that runs after /etc/scripts/system-setup.d/60-network-devices.sh<br />
and etc/scripts/system-setup.d/62-routing.sh)<br />
which should start iscsid and login to iSCSI target<br />
by using new config variables in default.conf<br />
(default.conf is sourced by skel/default/etc/scripts/system-setup)<br />
like</p>
<pre><code>ISCSI_DAEMON_COMMANDS=( 'sleep 1' 'iscsid -f' )
ISCSI_LOGIN_COMMANDS=( 'sleep 1' 'iscsiadm -m node --loginall=automatic' )
</code></pre>
<p>so that the user has the final power to specify what he needs<br />
for his particular iSCSI system.</p>
<p>Because I read 'login' I assume some extra care is needed<br />
how ReaR deals with possibly confidential login data<br />
(are passwords used for login to iSCSI target?)<br />
to avoid that secrets are included in the recovery system<br />
(by default the recovery system must be free of secrets)<br />
and to check if perhaps an interactive login to iSCSI target works<br />
(can iscsiadm do an interactive login via user password prompt?)</p>
<h4 id="gozora_commented_at_2020-06-19_0813"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646504855">2020-06-19 08:13</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-19_0813" title="Permanent link">&para;</a></h4>
<p>@jsmeix agree on your implementation idea, I had similar idea too.</p>
<p>With the login you are right, I normally don't setup login passwords on
iSCSI LUNs but the option is there. I'm not sure now but it is possible
that things like Kerberos are even possible :-).<br />
Connection information at least on my Centos7 are stored in
<em>/var/lib/iscsi</em> (some versions ago it was <em>/etc/iscsi</em> so yet another
random location fun to solve).</p>
<blockquote>
<p>can iscsiadm do an interactive login via user password prompt</p>
</blockquote>
<p>Yes it can, but it is also designed to work right from the boot ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0816"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646506295">2020-06-19 08:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0816" title="Permanent link">&para;</a></h4>
<p>As far as I see there is one part of the manual iSCSI setup<br />
that can get tricky for the user when he wants iSCSI setup<br />
happen automatically right in his recovery system so that<br />
only calling plain "rear recover" would be sufficient.</p>
<p>When the user has a more complicated networking setup<br />
where he needs to use ReaR's generated<br />
/etc/scripts/system-setup.d/60-network-devices.sh<br />
then he cannot use NETWORKING_PREPARATION_COMMANDS<br />
to start iscsid and login to iSCSI target.<br />
Perhaps PRE_RECOVERY_SCRIPT can be used for that<br />
but that looks all more like a workaround than an intended way<br />
how such things should be done in ReaR.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0823"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646509656">2020-06-19 08:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0823" title="Permanent link">&para;</a></h4>
<p>After the ReaR 2.6 release was completely done<br />
(i.e. when we can do ReaR 2.7 development)<br />
I will implement some initial iSCSI support<br />
(i.e. hopefully I can start next week with that)<br />
so that you @gozora could test and play around with it.</p>
<h4 id="gozora_commented_at_2020-06-19_0833"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646513819">2020-06-19 08:33</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-19_0833" title="Permanent link">&para;</a></h4>
<p>@jsmeix you look to be interested in iSCSI topic ;-).<br />
Btw. iSCSI is cheap way how you can simulate complex disk layouts (which
are normally done over Fibre Channel). All you need to do is to preset
from iSCSI server LUN over multiple network interfaces and you can join
them using <code>multipathd</code> on client site and treat them like standard
disks...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0847"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646518433">2020-06-19 08:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0847" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
I am afraid I am not so much interested in iSCSI<br />
as in not getting issues from certain kind of people about<br />
"unacceptable poor performance of ReaR on iSCSI systems"<br />
or how else those kind of people may describe it when something<br />
does not meet their "just works perfectly out of the box" expectations.</p>
<h4 id="gozora_commented_at_2020-06-19_0854"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646520427">2020-06-19 08:54</a>:<a class="headerlink" href="#gozora_commented_at_2020-06-19_0854" title="Permanent link">&para;</a></h4>
<p>@jsmeix :-) OK that explains a lot :-)</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-06-19_0926"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-646534353">2020-06-19 09:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-06-19_0926" title="Permanent link">&para;</a></h4>
<p>With such explicit <code>ISCSI_...</code> config variables iSCSI related things<br />
are made clear to the user (the user is excpected to read
default.conf)<br />
and the user gets a predefined way in ReaR how to deal with iSCSI<br />
that he can adapt and enhance as needed for his particular use case.</p>
<h4 id="github-actions_commented_at_2020-10-14_0149"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2429#issuecomment-708104290">2020-10-14 01:49</a>:<a class="headerlink" href="#github-actions_commented_at_2020-10-14_0149" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-06-17.2429.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
