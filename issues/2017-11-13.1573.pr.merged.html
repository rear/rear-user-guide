<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#1573 PR merged: Use UserInput in some more usual places - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#1573 PR merged: Use UserInput in some more usual places";
        var mkdocs_page_input_path = "issues/2017-11-13.1573.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#1573 PR merged: Use UserInput in some more usual places</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1573_pr_merged_use_userinput_in_some_more_usual_places"><a href="https://github.com/rear/rear/pull/1573">#1573 PR</a> <code>merged</code>: Use UserInput in some more usual places<a class="headerlink" href="#1573_pr_merged_use_userinput_in_some_more_usual_places" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>documentation</code>, <code>cleanup</code>,
<code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2017-11-13_1314"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/1573">2017-11-13 13:14</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2017-11-13_1314" title="Permanent link">&para;</a></h4>
<p>Use UserInput in 500_confirm_layout_file.sh<br />
(renamed from 500_confirm_layout.sh)<br />
and in 100_confirm_layout_code.sh<br />
(renamed from 100_ask_confirmation.sh)<br />
to improve that 'rear recover' can run<br />
unattended in migration mode, cf.<br />
<a href="https://github.com/rear/rear/issues/1399">https://github.com/rear/rear/issues/1399</a></p>
<h4 id="jsmeix_commented_at_2017-11-13_1320"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-343916528">2017-11-13 13:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-13_1320" title="Permanent link">&para;</a></h4>
<p>Now for me "rear recover" in migration mode<br />
looks like (excerpts):</p>
<pre>
RESCUE e205:~ # rear recover
...
Current disk mapping table (source -> target):
    /dev/sda /dev/sda
Confirm or edit the disk mapping
1) Confirm disk mapping and continue 'rear recover'
2) Edit disk mapping (/var/lib/rear/layout/disk_mappings)
3) Use Relax-and-Recover shell and return back to here
4) Abort 'rear recover'
(default '1' timeout 300 seconds)

User confirmed disk mapping
Confirm or edit the disk layout file
1) Confirm disk layout and continue 'rear recover'
2) Edit disk layout (/var/lib/rear/layout/disklayout.conf)
3) View disk layout (/var/lib/rear/layout/disklayout.conf)
4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
5) Use Relax-and-Recover shell and return back to here
6) Abort 'rear recover'
(default '1' timeout 300 seconds)

User confirmed disk layout file
Partition primary on /dev/sda: size reduced to fit on disk.
Confirm or edit the disk recreation script
1) Confirm disk recreation script and continue 'rear recover'
2) Edit disk recreation script (/var/lib/rear/layout/diskrestore.sh)
3) View disk recreation script (/var/lib/rear/layout/diskrestore.sh)
4) View original disk space usage (/var/lib/rear/layout/config/df.txt)
5) Use Relax-and-Recover shell and return back to here
6) Abort 'rear recover'
(default '1' timeout 300 seconds)

User confirmed disk recreation script
Start system layout restoration.
...
</pre>

<h4 id="jsmeix_commented_at_2017-11-14_1457"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344284401">2017-11-14 14:57</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-14_1457" title="Permanent link">&para;</a></h4>
<p>I have a question to all ReaR maintainers:</p>
<p>Can one of you perhaps explain to me what<br />
the reason is for the unexpected behaviour in<br />
<a href="https://github.com/jsmeix/rear/blob/e5d7f694212912d958168ec1238ed1bae25a50d2/usr/share/rear/layout/recreate/default/200_run_layout_code.sh">https://github.com/jsmeix/rear/blob/e5d7f694212912d958168ec1238ed1bae25a50d2/usr/share/rear/layout/recreate/default/200_run_layout_code.sh</a><br />
why code like</p>
<pre>
( source $LAYOUT_CODE ) && break
</pre>

<p>does not work because it seems this way<br />
the 'set -e' inside LAYOUT_CODE does no longer work<br />
so that then LAYOUT_CODE would no longer exit<br />
if a command therein exits with non-zero status.<br />
In ReaR I must explicitly test $? as follows</p>
<pre>
( source $LAYOUT_CODE )
(( $? == 0 )) && break
</pre>

<p>so that the 'set -e' inside LAYOUT_CODE still makes it<br />
exit if a command therein exits with non-zero status.</p>
<p>On plain command line such code works for me</p>
<pre>
# echo 'set -e ; cat qqq ; echo hello' >script.sh

# ( source script.sh ) && echo ok || echo failed
cat: qqq: No such file or directory
failed

# echo QQQ >qqq

# ( source script.sh ) && echo ok || echo failed
QQQ
hello
ok
</pre>

<p>but it seems same kind of code does not work within ReaR.</p>
<h4 id="jsmeix_commented_at_2017-11-14_1555"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344303590">2017-11-14 15:55</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-14_1555" title="Permanent link">&para;</a></h4>
<p>I found the root cause of my question in<br />
<a href="https://github.com/rear/rear/pull/1573#issuecomment-344284401">https://github.com/rear/rear/pull/1573#issuecomment-344284401</a></p>
<p>In ReaR it does not work because on my SLES12 test system<br />
where I run ReaR there is "GNU bash, version 4.3.42"<br />
while on my SLE11 workstation where I usually try out<br />
commands there is "GNU bash, version 3.2.51" and in<br />
<a href="https://github.com/rear/rear/pull/1573#issuecomment-344284401">https://github.com/rear/rear/pull/1573#issuecomment-344284401</a><br />
I did the plain command line test with bash 3.x.</p>
<p>The bash version makes the difference here:</p>
<p>With bash 4.x it also does not work on plain command line:</p>
<pre>
# echo 'set -e ; cat qqq ; echo hello' >script.sh

# ( source script.sh ) && echo ok || echo failed
cat: qqq: No such file or directory
hello
ok

# ( source script.sh ) ; (( $? == 0 )) && echo ok || echo failed
cat: qqq: No such file or directory
failed
</pre>

<h4 id="jsmeix_commented_at_2017-11-15_1330"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344592420">2017-11-15 13:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-15_1330" title="Permanent link">&para;</a></h4>
<p>@gozora via<br />
<a href="https://github.com/rear/rear/pull/1573/commits/7b15e5c3783c41d41dbf3c9fb735351633d51a6d">https://github.com/rear/rear/pull/1573/commits/7b15e5c3783c41d41dbf3c9fb735351633d51a6d</a><br />
I completely overhauled the<br />
layout/prepare/default/200_recreate_hpraid.sh<br />
script and I would very much appreciate it<br />
if you could have a general look at it<br />
<a href="https://github.com/jsmeix/rear/blob/7b15e5c3783c41d41dbf3c9fb735351633d51a6d/usr/share/rear/layout/prepare/default/200_recreate_hpraid.sh">https://github.com/jsmeix/rear/blob/7b15e5c3783c41d41dbf3c9fb735351633d51a6d/usr/share/rear/layout/prepare/default/200_recreate_hpraid.sh</a><br />
whether or not you see perhaps immediate mistakes.<br />
Many thanks in advance!</p>
<h4 id="gozora_commented_at_2017-11-15_1610"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344641955">2017-11-15 16:10</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-15_1610" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix</p>
<p>What I can tell you from top of my head.</p>
<pre><code>grep -q '^cciss ' /proc/modules || return 0
</code></pre>
<p><strong>cciss</strong> is no longer module to be used, HP(E) switched to <strong>hpsa</strong>
some time ago.<br />
<strong>hpsa</strong> uses standard SCSI disk names for SmarArray logical disks
(/dev/sd[a-z] instead of /dev/cciss/...) so I'm not sure if whole code
in <em>200_recreate_hpraid.sh</em> will work on modern systems ...</p>
<p>Unfortunately I don't have access to any HPE test HW right now, so I
can't really tell you whether recreation of SmartArray works or not
:-(<br />
I'll however keep this in mind and as soon as I have an opportunity to
test it, I'll do so.</p>
<p>V.</p>
<h4 id="gozora_commented_at_2017-11-15_1623"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344646239">2017-11-15 16:23</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-15_1623" title="Permanent link">&para;</a></h4>
<p>Topic of creating SmarArray (SA) from OS can be even more complicated
due special branch of SA called HPE Dynamic Smart Array (cf.
<a href="https://support.hpe.com/hpsc/doc/public/display?docId=emr_na-c04406959">specification
link</a>)
which is "kind of" smart array but can be used only in UEFI mode and
uses different Linux driver <em>hpdsa</em> dependent on <em>hpsa</em>.</p>
<p>I actually never used ReaR feature for creating logical volumes during
restore process, but rather created them manually prior <code>rear recover</code></p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2017-11-15_1629"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344648140">2017-11-15 16:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-15_1629" title="Permanent link">&para;</a></h4>
<p>I tried hard to not change what the code<br />
in 200_recreate_hpraid.sh actually does.<br />
I do not have such hardware so that I cannot<br />
change what that code actually does.</p>
<p>I only changed (i.e. cleaned up) the syntax and<br />
replaced the 'read' and 'select' calls by UserInput()<br />
so that the new 200_recreate_hpraid.sh again<br />
matches the new 200_run_layout_code.sh.</p>
<h4 id="jsmeix_commented_at_2017-11-15_1634"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344649858">2017-11-15 16:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-15_1634" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
"cciss is no longer module to be used, HP(E) switched to hpsa"<br />
I had noticed that in<br />
<a href="http://cciss.sourceforge.net/">http://cciss.sourceforge.net/</a><br />
which reads</p>
<pre>
The cciss driver has been removed from RHEL7 and SLES12.
If you really want cciss on RHEL7 checkout the elrepo directory.
A new Smart Array driver called "hpsa" has been accepted into
the main line linux kernel as of Dec 18, 2009, in linux-2.6.33-rc1.
This new driver will support new Smart Array products going
forward, and the cciss driver will eventually be deprecated. 
</pre>

<p>Accordingly my hopefully non-behavioural changes<br />
in 200_recreate_hpraid.sh are not of real importance<br />
nowadays so that I can more easily merge it without<br />
too much fear about possible regressions related to<br />
CCISS HP Smart Array setups.</p>
<h4 id="jsmeix_commented_at_2017-11-15_1650"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344654929">2017-11-15 16:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-15_1650" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
many thanks for your prompt review!</p>
<h4 id="gozora_commented_at_2017-11-15_1651"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344655511">2017-11-15 16:51</a>:<a class="headerlink" href="#gozora_commented_at_2017-11-15_1651" title="Permanent link">&para;</a></h4>
<p>@jsmeix anytime ;-)</p>
<h4 id="jsmeix_commented_at_2017-11-15_1717"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/1573#issuecomment-344663237">2017-11-15 17:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-11-15_1717" title="Permanent link">&para;</a></h4>
<p>FWIW:<br />
For me on my SLES12 test system the new stuff works really well.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2017-11-13.1573.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
