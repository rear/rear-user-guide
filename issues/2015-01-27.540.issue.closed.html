<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#540 Issue closed: Implement a generic "cleanupdisk" function. - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#540 Issue closed: Implement a generic \"cleanupdisk\" function.";
        var mkdocs_page_input_path = "issues/2015-01-27.540.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#540 Issue closed: Implement a generic "cleanupdisk" function.</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="540_issue_closed_implement_a_generic_cleanupdisk_function"><a href="https://github.com/rear/rear/issues/540">#540 Issue</a> <code>closed</code>: Implement a generic "cleanupdisk" function.<a class="headerlink" href="#540_issue_closed_implement_a_generic_cleanupdisk_function" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2015-01-27_1255"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/540">2015-01-27 12:55</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2015-01-27_1255" title="Permanent link">&para;</a></h4>
<p>I think rear needs a generic "cleanupdisk" function that basically makes
an already used harddisk behave as if it was a new harddisk.</p>
<p>When recovery is done on an already used harddisk, the still existing
old data on the disk cause varius kind of unexpected weird failures
where each kind is difficult to reproduce (because it depends on what
exact old data there is).</p>
<p>For some example see
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
(therein the issue that on RHEL6 on a used disk mdadm interferes with
parted) and
<a href="https://github.com/rear/rear/issues/415">https://github.com/rear/rear/issues/415</a>
("mkfs -t btrfs" needs option "-f" to enfore making a btrfs on a disk
when there is already a btrfs).</p>
<p>Implementing it might become complicated in practice. (I have new
harddisks in mind that might have ex factory a somewhat hidden special
partition which must not be wiped or something like this - isn't there
something like this for UEFI boot, see
<a href="http://en.wikipedia.org/wiki/EFI_System_partition">http://en.wikipedia.org/wiki/EFI_System_partition</a>
).</p>
<p>A starting point could be "wipefs" a tool that wipes filesystem
signatures from a device, see<br />
<a href="http://karelzak.blogspot.de/2009/11/wipefs8.html">http://karelzak.blogspot.de/2009/11/wipefs8.html</a></p>
<p>Regardless how complicated it is in practice, one dedicated function
that cleans up the disk before anything else is done makes it much
cleaner how rear works (instead of various workarounds here and there as
needed).</p>
<h4 id="tbsky_commented_at_2015-01-28_0308"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71773772">2015-01-28 03:08</a>:<a class="headerlink" href="#tbsky_commented_at_2015-01-28_0308" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>in my opinion, it is much easier to use specific right tools to do the
job. it is very hard to have a generic cleanupdisk function. it is
because linux support so many different storage objects. and these
objects can be dependent to each other. if the basement object is
missed, then you can not reach upper object easily without scanning the
whole disk. take one machine in my environment for example:</p>
<p>it has two hard disk: sda,sdb<br />
partition is: sda1,sda2,sdb1,sdb2<br />
make software raid above partition: md0 (sda1+sdb1), md1 (sda2+sdb2)<br />
make lvm above software raid: rootvg-&gt; my-lv1,my-lv2 (above md1)<br />
make drbd above lvm: drbd1 (above my-lv1)<br />
make file system above drbd: xfs (above drbd1)</p>
<p>each storage object has it's own metadata structure, at
beginning/end/middle(lvm lv) of the object.<br />
if the harddisk partition table is corrupted, all the upper layer
information is missed, so the cleanup disk tools can not reach these
layers to do clean job.</p>
<p>and there are several metadata revisions of each storage object.it is
hard for a general tool to track all the changes. but the job is easy
for specific right tools (mdadm,lvcreate,mkfs.xfs...). and all these
tools has parameters or workarround to overwrite existing metadata.</p>
<p>so maybe we just need to make sure the specific tools to deal with the
storage object can overwrite existing data correctly, then we are safe.</p>
<p>or we can full erase all the disks. but as you said, it will spend too
many hours/days to do the job.</p>
<h4 id="jsmeix_commented_at_2015-01-28_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71811519">2015-01-28 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-28_1024" title="Permanent link">&para;</a></h4>
<p>@tbsky,<br />
again many thanks for your valuable descriptive information!</p>
<p>For me it is perfectly o.k. to have for each kind of storage object a
separated generic cleanup function.</p>
<p>In particluar because I do prefer very much to Keep Separated Stuff
Separated ( "KSSS" ;-) cf. what I wrote "on 11 Dec 2014" in
<a href="https://github.com/rear/rear/issues/497">https://github.com/rear/rear/issues/497</a></p>
<h4 id="tbsky_commented_at_2015-01-28_1038"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71813315">2015-01-28 10:38</a>:<a class="headerlink" href="#tbsky_commented_at_2015-01-28_1038" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I know I will enjoy by your hard work when RHEL officially support btrfs
someday. I hope it can be there this year :)</p>
<h4 id="jsmeix_commented_at_2015-01-28_1049"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71814659">2015-01-28 10:49</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-28_1049" title="Permanent link">&para;</a></h4>
<p>@tbsky</p>
<p>I forgot to reply to your "maybe we just need to make sure the specific
tools to deal with the storage object can overwrite existing data
correctly":</p>
<p>From what I learned during
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
it is not possible that the specific tools overwrite existing data
because when the specific tool runs it can be already too late.</p>
<p>In
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
it failed for RHEL6 at the partitioning level because of old data of the
MD level so that before partitioning the MD tool would have to be run to
clean up old MD data.</p>
<p>This is exactly the reason why I think we need a generic way how to
clean up old data.</p>
<p>Perhaps your information may lead to the conclusion that such a generic
way is not possible.</p>
<p>This would be also a perfectly valid result because then no installer
can reliably install on an already used disk with arbitrary old data on
it.</p>
<p>In this case the solution is to document this and then it is left to the
user to make sure in advance that his disks are sufficiently clean and
if anything goes wrong because of old data on the disk it is no longer
an issue for an installer (in particular rear).</p>
<h4 id="jsmeix_commented_at_2015-01-28_1056"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71815554">2015-01-28 10:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-28_1056" title="Permanent link">&para;</a></h4>
<p>Only for fun:</p>
<p>I predict when RHEL officially supports btrfs, they will devise another
special way how one can set up btrfs where my current implementation
fails ;-)</p>
<p>@tbsky<br />
I rely on you to report issues with btrfs on RHEL early!</p>
<h4 id="jsmeix_commented_at_2015-01-28_1134"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71819883">2015-01-28 11:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-01-28_1134" title="Permanent link">&para;</a></h4>
<p>Regarding clean up DRBD I found in<br />
<a href="https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_drbd_overview.html">https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_drbd_overview.html</a></p>
<pre>
DRBD uses the last 128 MB of the raw device for metadata
</pre>

<p>This means what @schlomo wrote in
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
"maybe just delete the first and last couple of MB on each previously
existing partition?" does not work - specifically I mean "just a couple
of MB" is not sufficient (if 128 MB is not "just a couple of MB").</p>
<h4 id="schlomo_commented_at_2015-01-28_1214"><img src="https://avatars.githubusercontent.com/u/101384?v=4" width="50"><a href="https://github.com/schlomo">schlomo</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71825898">2015-01-28 12:14</a>:<a class="headerlink" href="#schlomo_commented_at_2015-01-28_1214" title="Permanent link">&para;</a></h4>
<p>I update my suggestion: Wipe the first 256MB, the last 256MB and the<br />
<em>middle</em> 256 MB of each disk / device :-)</p>
<p>On 28 January 2015 at 12:34, Johannes Meixner
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#110;&#111;&#116;&#105;&#102;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#115;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a><br />
wrote:</p>
<blockquote>
<p>Regarding clean up DRBD I found in</p>
<p><a href="https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_drbd_overview.html">https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_drbd_overview.html</a></p>
<p>DRBD uses the last 128 MB of the raw device for metadata</p>
<p>This means what @schlomo
<a href="https://github.com/schlomo">https://github.com/schlomo</a> wrote in
#533<br />
<a href="https://github.com/rear/rear/issues/533">https://github.com/rear/rear/issues/533</a>
"maybe just delete the first<br />
and last couple of MB on each previously existing partition?" does not
work</p>
<ul>
<li>specifically I mean "just a couple of MB" is not sufficient (if
    128 MB is<br />
    not "just a couple of MB").</li>
</ul>
<p>â€”<br />
Reply to this email directly or view it on GitHub<br />
<a href="https://github.com/rear/rear/issues/540#issuecomment-71819883">https://github.com/rear/rear/issues/540#issuecomment-71819883</a>.</p>
</blockquote>
<h4 id="tbsky_commented_at_2015-01-28_1331"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-71834704">2015-01-28 13:31</a>:<a class="headerlink" href="#tbsky_commented_at_2015-01-28_1331" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
the suse drbd document seems not quite correct. drbd with fixed external
metadata has limit with 128MB. with internal metadata it may over 128MB.
please check below if you are interested :)<br />
<a href="http://lists.linbit.com/pipermail/drbd-user/2008-June/009628.html">http://lists.linbit.com/pipermail/drbd-user/2008-June/009628.html</a></p>
<p>the external metadata may make the clean-up more crazy. but I think they
still fit schlomo's 256MB plan :-D</p>
<h4 id="jsmeix_commented_at_2015-11-06_1250"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-154402240">2015-11-06 12:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-06_1250" title="Permanent link">&para;</a></h4>
<p>Regarding "wipefs" see also
<a href="https://github.com/rear/rear/issues/649">https://github.com/rear/rear/issues/649</a></p>
<p>In particular therein see<br />
<a href="https://github.com/rear/rear/issues/649#issuecomment-148725865">https://github.com/rear/rear/issues/649#issuecomment-148725865</a><br />
how wipefs could be used by deault in rear - regardless that wipefs<br />
did not help in that particular case it could be nevertheless used<br />
by default in rear to avoid possible issues.</p>
<h4 id="gdha_commented_at_2015-11-17_1356"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-157375980">2015-11-17 13:56</a>:<a class="headerlink" href="#gdha_commented_at_2015-11-17_1356" title="Permanent link">&para;</a></h4>
<p>@jsmeix wipefs function could be useful indeed. However, we should
foresee a fall-back when wipefs is not available, e.g. use dd instead.</p>
<h4 id="jsmeix_commented_at_2015-11-19_1339"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-158059104">2015-11-19 13:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-11-19_1339" title="Permanent link">&para;</a></h4>
<p>As a first step I implemented in
<a href="https://github.com/rear/rear/pull/704">https://github.com/rear/rear/pull/704</a><br />
using wipefs when available</p>
<p>Currently "when available" means that on has to manually add it<br />
to the rear recovery system in in /etc/rear/local.conf via</p>
<pre>
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" wipefs )
</pre>

<p>cf.
<a href="https://github.com/rear/rear/issues/649#issuecomment-148725865">https://github.com/rear/rear/issues/649#issuecomment-148725865</a></p>
<p>Making wipefs automatically available to the rear recovery system<br />
when it is available in the original system is the next step that I
will<br />
implement.</p>
<p>Using another program (e.g. dd) as fallback if wipefs is not available<br />
is something for the future.</p>
<h4 id="jsmeix_commented_at_2015-12-02_1554"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-161342375">2015-12-02 15:54</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-12-02_1554" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/728">https://github.com/rear/rear/pull/728</a>
I think this issue is sufficiently fixed.</p>
<p>Using another program (e.g. dd) as fallback if wipefs is not available<br />
is something for the future - perhaps best via a separated follow-up
issue - provided such a fallback is really needed on nowadays systems:
wipefs is available on SLE11 and SLE12 (wipefs was added on Apr 13 2011
in the SUSE's util-linux RPM (therefore wipefs is not available on
SLE10-SP4 where the util-linux RPM changelog ends on Feb 03 2011) and I
guess wipefs is also available on recent Red Hat systems.</p>
<h4 id="jsmeix_commented_at_2015-12-03_0947"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-161570319">2015-12-03 09:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-12-03_0947" title="Permanent link">&para;</a></h4>
<p>With #728 this issue is sufficiently fixed.</p>
<h4 id="jsmeix_commented_at_2015-12-09_1348"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-163241543">2015-12-09 13:48</a>:<a class="headerlink" href="#jsmeix_commented_at_2015-12-09_1348" title="Permanent link">&para;</a></h4>
<p>Right now (during
<a href="https://github.com/rear/rear/issues/732">https://github.com/rear/rear/issues/732</a>)
I detected that in some cases one must use</p>
<pre>
wipefs -a -f /dev/sdXn
</pre>

<p>because without '-f' (--force) wipefs will not erase a partition table<br />
on a block device that is a partition (e.g. /dev/sda1).</p>
<p>I had the strange case that wipefs detected a DOS partition table<br />
on the partition /dev/sda2 (note that it is not the whole disk
/dev/sda<br />
where a partition table must exist - but here it is a partition table<br />
at the beginning of a partition).</p>
<p>With the DOS partition table at the beginning of /dev/sda2<br />
the subsequent "mkfs -t ext4 /dev/sda2" stopped with<br />
a yes/no question whether or not to proceed.</p>
<p>Probably it is even a bug when "rear recover" hangs<br />
because of such an issue?</p>
<p>Perhaps an alternative to "wipefs -a -f /dev/sdXn" is</p>
<pre>
mkfs.ext4 -F /dev/sdXn
</pre>

<p>I will think a bit about it what is better.</p>
<p>Currently I perefer the generic way via "wipefs -a -f..."<br />
over adding specific "force" options to each mkfs call.</p>
<p>I only need to ensure to never do "wipefs -a -f /dev/sda"<br />
because that would erase the partition table on the disk<br />
that was just before created by parted (see diskrestore.sh).</p>
<h4 id="tbsky_commented_at_2015-12-09_2351"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-163440110">2015-12-09 23:51</a>:<a class="headerlink" href="#tbsky_commented_at_2015-12-09_2351" title="Permanent link">&para;</a></h4>
<p>hi jsmeix:</p>
<p>I don't use ext4 so I am surprised about your finding. as I said I don't
think wipefs can detect/clean complicated storage object (like stacking
of mdadm/drbd/lvm), so the correct behavior of specific storage tools is
the last rescue. all the tools I need in rear now has correct behavior
like below:</p>
<pre><code>mkfs.xfs -f
mdadm --create --force
lvm lvcreate &lt;&lt;&lt;y
drbdadm -- --force create-md
</code></pre>
<p>so I think no matter what wipefs can do, "mkfs.ext4 -F" is must to be
last rescue.</p>
<h4 id="tbsky_commented_at_2015-12-10_0306"><img src="https://avatars.githubusercontent.com/u/9283275?v=4" width="50"><a href="https://github.com/tbsky">tbsky</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-163471447">2015-12-10 03:06</a>:<a class="headerlink" href="#tbsky_commented_at_2015-12-10_0306" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>it's maybe off topic. as you mentioned, the original problem wipefs want
to solve is like issue #533.<br />
the root cause of these issues is the "automatic behavior" of linux
environment. if linux didn't have these "automatic behavior" rear would
be much more easier to do its job.</p>
<p>in my case I found two kinds of "automatic behavior":</p>
<p>the first is from boot module loading, which cause issues like #480 and
#626. we can blacklist useless modules, or maybe whitelist useful
modules after booting. I don't know if there are general ways to do this
for every distribution. maybe hide the modules at the beginning and
unhide them after booting?</p>
<p>the second comes from udev event, which cause issues like #518. at
first I think solve the issue via udevadm is a great idea. but
unfortunately SuSE also try to solve the same problem so the two patches
conflict hence issue #533.</p>
<p>I don't know if hide/unhide the modules will help stopping these kind of
"automatic behavior". but as there will more storage modules in the
future, if we can find a general way to handle the "automatic behavior"
then rear will be much easier to re-create these storage object.</p>
<h4 id="jsmeix_commented_at_2016-03-15_1520"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/540#issuecomment-196873429">2016-03-15 15:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-03-15_1520" title="Permanent link">&para;</a></h4>
<p>I close this one because it is "somewhat done" for version 1.18 and
probably it will become "mostly obsoleted" by
<a href="https://github.com/rear/rear/issues/799">https://github.com/rear/rear/issues/799</a>
which might even (hopefully) really fix those issues.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2015-01-27.540.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
