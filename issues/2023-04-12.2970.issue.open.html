<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2023 04 12.2970.issue.open - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2023 04 12.2970.issue.open";
        var mkdocs_page_input_path = "issues/2023-04-12.2970.issue.open.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2023 04 12.2970.issue.open</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2970_issue_open_automate_rear_with_grub_wo_user_intervention_iso_default_not_supported_for_grub"><a href="https://github.com/rear/rear/issues/2970">#2970 Issue</a> <code>open</code>: Automate ReaR with GRUB w/o user intervention (ISO_DEFAULT not supported for GRUB)<a class="headerlink" href="#2970_issue_open_automate_rear_with_grub_wo_user_intervention_iso_default_not_supported_for_grub" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code></p>
<h4 id="keredf_opened_issue_at_2023-04-12_1855"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> opened issue at <a href="https://github.com/rear/rear/issues/2970">2023-04-12 18:55</a>:<a class="headerlink" href="#keredf_opened_issue_at_2023-04-12_1855" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version:<br />
    2.6 / 2020-06-17</p>
</li>
<li>
<p>OS version:<br />
    RHEL 8.6</p>
</li>
<li>
<p>ReaR configuration files (/etc/rear/local.conf):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=null
BACKUP=NETFS
BACKUP_URL=iso:///BACKUP/
ISO_MAX_SIZE=4400
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}"'/media''/var/tmp''/var/crash''/mnt')
USER_INPUT_TIMEOUT=0
USER_INPUT_INTERRUPT_TIMEOUT=1
ISO_DEFAULT="automatic"
ISO_RECOVER_MODE="unattended"
USER_INPUT_DISK_LAYOUT_PROCEED_RECOVERY="yes"
USE_RESOLV_CONF=("search x" "name server 0.0.0.0")
</code></pre>
<ul>
<li>
<p>Hardware vendor/product:<br />
    Laptop</p>
</li>
<li>
<p>System architecture:<br />
    x86</p>
</li>
<li>
<p>Firmware and bootloader:<br />
    BIOS R2.0, EC Version 0.00.09, UEFI Firmware 2.7, GRUB2 bootloader
    (BIOS of this laptop is a custom UEFI BIOS)</p>
</li>
<li>
<p>Storage:<br />
    ISO image saved locally onto laptop SSD, then image copied to a DVD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                              KNAME                        PKNAME              TRAN TYPE    FSTYPE             SIZE      MOUNTPOINT
/dev/sr0                              /dev/sr0                                                     sata  rom                        2.6G    
/dev/nvme0n1              /dev/nvme0n1                                   nvme    disk                               477G    
/dev/nvme0n1p1            /dev/nvme0n1p1        /dev/nvme0n1        nvme     part   vfat                    600M          /boot/efi
/dev/nvme0n1p2            /dev/nvme0n1p2        /dev/nvme0n1        nvme     part   xfs                 1G        /boot/efi
/dev/nvme0n1p3            /dev/nvme0n1p3        /dev/nvme0n1        nvme     part   LVM2_member    475G 
/dev/mapper/rhel-root     /dev/dm-0                  /dev/nvme0n1p3              lvm            xfs                  70G           /
/dev/mapper/rhel-swap     /dev/dm-1                  /dev/nvme0n1p3              lvm            swap             7.7G          [SWAP]
/dev/mapper/rhel-home     /dev/dm-2                  /dev/nvme0n1p3              lvm            xfs                  397G          /home
</code></pre>
<ul>
<li>Description of the issue:</li>
</ul>
<p>I am attempting to fully automate ReaR with little to no user
intervention.<br />
I have created a ReaR ISO, copied the ISO to a DVD using 'wodim'.<br />
I attempt to restore the image by booting off the DVD.<br />
The ReaR process begins but brings me to the ReaR cmd prompt.<br />
See picture below.</p>
<p><img alt="OIP" src="https://user-images.githubusercontent.com/119457265/231555162-8b28b591-9e06-418c-a17b-92e0f1fe4fac.jpg" /></p>
<p>I then have to enter "root" as the login and then type "rear recover".<br />
I want to fully automate this process.<br />
See picture below.</p>
<p><img alt="OIP" src="https://user-images.githubusercontent.com/119457265/231554838-4b0ef127-a44e-4fa8-b408-de39fed663ba.jpg" /></p>
<p>I was able to fully automate this process on a completely different
machine (a PC).<br />
I was using the same ReaR version, same local.conf, and same OS.<br />
One key difference is the BIOS was set to Legacy;<br />
Current machine is a custom UEFI BIOS.</p>
<p>For reference, I opened up Issue #2891 .<br />
This is a different configuration/situation.</p>
<ul>
<li>
<p>Workaround:<br />
    Boot off of DVD containing ISO, enter command prompt as root, type
    rear recover</p>
</li>
<li>
<p>Attachments ("rear -D mkrescue/mkbackup/recover"):<br />
    None</p>
</li>
</ul>
<h4 id="pcahyna_commented_at_2023-04-12_1938"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1505821708">2023-04-12 19:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-12_1938" title="Permanent link">&para;</a></h4>
<blockquote>
<ul>
<li>
<p>ReaR version: 2.6 / 2020-06-17</p>
<ul>
<li>OS version: RHEL 8.6</li>
</ul>
</li>
</ul>
<p>Something is wrong with your screenshots then, they show ReaR 2.00 and
CentOS 7.</p>
</blockquote>
<h4 id="keredf_commented_at_2023-04-12_1945"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1505830229">2023-04-12 19:45</a>:<a class="headerlink" href="#keredf_commented_at_2023-04-12_1945" title="Permanent link">&para;</a></h4>
<p>@pcahyna The screenshots are an example from the internet. Sorry for the
confusion.</p>
<p>The versions that I am using are:</p>
<ul>
<li>ReaR version: 2.6 / 2020-06-17</li>
<li>OS version: RHEL 8.6</li>
</ul>
<h4 id="pcahyna_commented_at_2023-04-12_2049"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1505918148">2023-04-12 20:49</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-12_2049" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Current machine is a custom UEFI BIOS.</p>
</blockquote>
<p>I suspect that's the issue then,</p>
<pre><code>ISO_DEFAULT="automatic"
ISO_RECOVER_MODE="unattended"
</code></pre>
<p>work only with legacy BIOS and not UEFI (or with GRUB booting in
general) as far as I know.<br />
(is the rescue DVD using GRUB for booting? The "example from the
internet" shows SYSLINUX. That's why it is a bad example.)</p>
<h4 id="keredf_commented_at_2023-04-13_1114"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1506784472">2023-04-13 11:14</a>:<a class="headerlink" href="#keredf_commented_at_2023-04-13_1114" title="Permanent link">&para;</a></h4>
<p>Is there anything I could check in the BIOS that could be affecting
this? (e.g. Secure Boot).</p>
<p>During my initial attempt to create the ReaR ISO (rear -d -v mkbackup),
I was getting an error, "Error: Failed to make bootable EFI image of
GRUB2 (error during grub2-mkstandalone of
/temp/rear.wuVja96Ac9KGtCC/tmp/mnt/EFI/BOOT/BOOTX64.efi).</p>
<p>I had to install the 'grub2-efi-x64-modules' package to remove the error
and create the ISO.</p>
<p>I believe the rescue DVD is using GRUB for booting. Is there a specific
check I can do to confirm this? On the Rescue DVD, there are 4 folders:
BACKUP, boot, EFI, and isolinux.</p>
<h4 id="pcahyna_commented_at_2023-04-13_1122"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1506794010">2023-04-13 11:22</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-13_1122" title="Permanent link">&para;</a></h4>
<p>I believe there is a bootloader menu shown before boot where you can see
whether it is GRUB, isn't it? For example, the screenshot hou have shown
is from SYSLINUX.</p>
<h4 id="keredf_commented_at_2023-04-13_1211"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1506858514">2023-04-13 12:11</a>:<a class="headerlink" href="#keredf_commented_at_2023-04-13_1211" title="Permanent link">&para;</a></h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/119457265/231753615-9e40f316-3df6-4618-a80f-cb29712b81bc.png" /></p>
<p>Here is another example screenshot that looks similar to what I am
seeing.</p>
<p>On my machine, I see the same 5 options and a similar comment at the
bottom but the machine does not have a menu title at the top.</p>
<h4 id="keredf_commented_at_2023-04-13_1646"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1507279276">2023-04-13 16:46</a>:<a class="headerlink" href="#keredf_commented_at_2023-04-13_1646" title="Permanent link">&para;</a></h4>
<p>@pcahyna I have confirmed that the bootloader is GRUB2</p>
<h4 id="pcahyna_commented_at_2023-04-13_1658"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1507296126">2023-04-13 16:58</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-13_1658" title="Permanent link">&para;</a></h4>
<p>Yes so unfortunately the problem is that <code>ISO_DEFAULT</code> is not supported
for GRUB, so one option would be to boot in legacy BIOS mode, if that's
feasible (uses SYSLINUX), another option is to modify the GRUB
configuration in the ISO image a bit before burning the DVD (here's an
example how to add the <code>unattended</code> kernel option this way:
<a href="https://github.com/lzaoral/rear-testing/blob/main/Sanity/make-backup-and-restore-powervm/runtest.sh#L140">https://github.com/lzaoral/rear-testing/blob/main/Sanity/make-backup-and-restore-powervm/runtest.sh#L140</a>).</p>
<h4 id="keredf_commented_at_2023-04-18_1523"><img src="https://avatars.githubusercontent.com/u/119457265?v=4" width="50"><a href="https://github.com/keredf">keredf</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1513355142">2023-04-18 15:23</a>:<a class="headerlink" href="#keredf_commented_at_2023-04-18_1523" title="Permanent link">&para;</a></h4>
<p>I ran the following commands:</p>
<p>• xorriso -dev '/var/lib/rear/output/rear-localhost.iso' -osirrox on
-cpx /boot/grub/grub.cfg $PWD/grub.cfg<br />
• sed -i '/^[[:blank:]]*linux/s/$/ unattended/' grub.cfg<br />
• xorriso -indev '/var/lib/rear/output/rear-localhost.iso' -update
$PWD/grub.cfg /boot/grub/grub.cfg -outdev
‘/var/lib/rear/output/test.iso'<br />
• sync<br />
• wodim -v dev=/dev/sr0 speed=4 -eject test.iso</p>
<p>I created the ISO and confirmed that the grub.cfg was updated with
"unattended". I wrote the ISO to a DVD but I cannot boot off of the DVD.
It looks like this occurred after updating grub.cfg.</p>
<p>Do you know why this could be? Is there a way to update the bootable
flag on the ISO? Any other suggestions or ideas?</p>
<p>Thank you for your help and guidance.<br />
@pcahyna</p>
<h4 id="pcahyna_commented_at_2023-04-21_1724"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2970#issuecomment-1518130010">2023-04-21 17:24</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-04-21_1724" title="Permanent link">&para;</a></h4>
<p>Sorry @keredf for my untested and nonfunctional suggestion. This code
works for modifying the ISO image that is bootable on another platform
(POWER with OpenFirmware), but apparently this is not correct for
updating a UEFI bootable ISO. I think some variation of thereof could
work, maybe one should add the same options to the second xorriso
command as were used when creating rear-localhost.iso the first time?
Also, can you please verify that the <code>/boot/grub/grub.cfg</code> path is
indeed the correct path to the GRUB configuration file in your ISO and
that the <code>sed</code> command has updated the file correctly? (diff of the file
before and after the sed command would be useful.)</p>
<p>Also, what does "I cannot boot off of the DVD" mean? Does GRUB at least
get loaded and then can not boot the kernel, or you don't even see the
GRUB menu or prompt?</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-04-12.2970.issue.open.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
