<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2642 Issue closed: No /usr/share/rear when booting rescue system - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2642 Issue closed: No /usr/share/rear when booting rescue system";
        var mkdocs_page_input_path = "issues/2021-07-01.2642.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2642 Issue closed: No /usr/share/rear when booting rescue system</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2642_issue_closed_no_usrsharerear_when_booting_rescue_system"><a href="https://github.com/rear/rear/issues/2642">#2642 Issue</a> <code>closed</code>: No /usr/share/rear when booting rescue system<a class="headerlink" href="#2642_issue_closed_no_usrsharerear_when_booting_rescue_system" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="tigaente_opened_issue_at_2021-07-01_1146"><img src="https://avatars.githubusercontent.com/u/41113817?v=4" width="50"><a href="https://github.com/tigaente">tigaente</a> opened issue at <a href="https://github.com/rear/rear/issues/2642">2021-07-01 11:46</a>:<a class="headerlink" href="#tigaente_opened_issue_at_2021-07-01_1146" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.6 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>LSB Version:    n/a
Distributor ID: ManjaroLinux
Description:    Manjaro Linux
Release:        21.0.7
Codename:       Ornara
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=RAWDISK
OUTPUT_URL="file:///var/lib/rear/output"
KERNEL_FILE="/boot/vmlinuz-5.12-x86_64"
COPY_AS_IS="/usr/lib/modules/extramodules-5.12-MANJARO"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    Hardware PC</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86-64</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    Firmware: UEFI<br />
    Bootload: GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): SSD</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME        KNAME     PKNAME   TRAN   TYPE FSTYPE   SIZE MOUNTPOINT
/dev/sda    /dev/sda           sata   disk        238,5G
|-/dev/sda1 /dev/sda1 /dev/sda        part vfat     550M /boot/efi
|-/dev/sda2 /dev/sda2 /dev/sda        part swap       4G [SWAP]
`-/dev/sda3 /dev/sda3 /dev/sda        part ext4   233,9G /
/dev/sdb    /dev/sdb           sata   disk        232,9G
`-/dev/sdb1 /dev/sdb1 /dev/sdb        part ext4   232,9G /home
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    I used the documentation from this URL
    <a href="https://github.com/rear/rear/blob/master/doc/user-guide/13-tcg-opal-support.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/13-tcg-opal-support.adoc</a>
    to create a rescue USB stick with PBA environment for OPAL 2 SEDs.<br />
    The commands</li>
</ul>
<!-- -->

<pre><code>rear mkopalpba
rear mkrescue
</code></pre>
<p>work fine and do not show errors. Also dd-ing the raw image to a USB
drive works, but when booting from the USB I see some errors about files
not found. However, those fly by so fast I cannot really read them.
After logging in, the command rear does not work. Instead, it gives an
error that /usr/share/rear/default.conf cannot be found and some other
source errors where files seem to be missing.<br />
Upon checking, there simply is no /usr/share/rear-directory on the USB
drive. It does exist on my main OS, though that I use to create the
rescue image.<br />
I'm currently using the pkgbuild from ARCH AUR, but I also tried cloning
the git repo manually and used that version. But the outcome stays the
same. When using the git version in the local dir, I sometimes see this
error:</p>
<pre><code>Broken symlink '/usr/share/rear' in recovery system because 'readlink' cannot determine its link target
</code></pre>
<p>Any help here is highly appreciated.<br />
Andi</p>
<h4 id="jsmeix_commented_at_2021-07-05_1147"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874049983">2021-07-05 11:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-05_1147" title="Permanent link">&para;</a></h4>
<p>I am not a OPAL user and I do not have a TCG Opal 2-compliant
self-encrypting disk<br />
so I cannot reproduce issues related to self-encrypting disks.</p>
<p>What I tried on a QEMU/KVM x86_64 virtual test machine with
SLES15-SP3<br />
with latest ReaR upstream master code, see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>I did (my very first experiment with OPAL stuff):</p>
<pre><code># wget -O sedutil_LINUX.tar.gz https://github.com/Drive-Trust-Alliance/exec/blob/master/sedutil_LINUX.tgz?raw=true
...
2021-07-05 13:05:45 (4.95 MB/s) - ‘sedutil_LINUX.tar.gz’ saved [249464/249464]

# tar -xf sedutil_LINUX.tar.gz

# cp sedutil/Release_x86_64/GNU-Linux/sedutil-cli /usr/local/bin


# git clone https://github.com/rear/rear.git

# mv rear rear.github.master

# cd rear.github.master

# vi etc/rear/local.conf
...

# cat etc/rear/local.conf
FIRMWARE_FILES=( 'no' )
MODULES=( 'loaded_modules' )
PROGRESS_MODE="plain"
PROGRESS_WAIT_SECONDS="3"
USE_DHCLIENT="yes"
SSH_ROOT_PASSWORD="rear"
OUTPUT=RAWDISK
OUTPUT_URL="file:///var/lib/rear/output"


# usr/sbin/rear -D mkopalpba
Relax-and-Recover 2.6 / Git
Running rear mkopalpba (PID 3337 date 2021-07-05 12:59:47)
Command line options: usr/sbin/rear -D mkopalpba
Using log file: /root/rear.github.master/var/log/rear/rear-localhost.log
Using build area: /tmp/rear.JeqjpKW3aQQoNjD
Running workflow mkopalpba on the normal/original system
Re-configuring Relax-and-Recover to create a TCG Opal pre-boot authentication (PBA) image
TIP: Your system seems to include a Plymouth graphical boot animation. You can achieve a nicer user
     interface for the PBA by setting OPAL_PBA_{PROGS,COPY_AS_IS,LIBS} to include Plymouth components.
Using autodetected kernel '/boot/vmlinuz-5.3.18-57-default' as kernel in the recovery system
Creating recovery system root filesystem skeleton layout
Handling network interface 'eth0'
eth0 is a physical device
Handled network interface 'eth0'
Included current keyboard mapping (via 'dumpkeys -f')
Included default US keyboard mapping /usr/share/kbd/keymaps/legacy/i386/qwerty/defkeymap.map.gz
Included other keyboard mappings in /usr/share/kbd/keymaps
Copying files and directories
Copying binaries and libraries
A list of executables with their dependencies has been stored in /tmp/rear.JeqjpKW3aQQoNjD/tmp/executable-dependencies
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules') and those in MODULES_LOAD
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/mtab' target '/proc/22963/mounts' on /proc/ /sys/ /dev/ or /run/
Skip copying broken symlink '/etc/resolv.conf' target '/run/netconfig/resolv.conf' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.JeqjpKW3aQQoNjD/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Testing that the existing programs in the PROGS array can be found as executable command within the recovery system
Testing that each program in the REQUIRED_PROGS array can be found as executable command within the recovery system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (37717853 bytes) in 7 seconds
Using Grub 2 to create an EFI bootloader
Creating 51 MiB raw disk image "TCG-Opal-PBA-localhost.raw"
Using syslinux to install a Legacy BIOS bootloader
Copying resulting files to file location
Saving /root/rear.github.master/var/log/rear/rear-localhost.log as rear-localhost.log to file location
Copying result files '/tmp/rear.JeqjpKW3aQQoNjD/tmp/TCG-Opal-PBA-localhost.raw /tmp/rear.JeqjpKW3aQQoNjD/tmp/VERSION /tmp/rear.JeqjpKW3aQQoNjD/tmp/README /tmp/rear.JeqjpKW3aQQoNjD/tmp/rear-localhost.log' to /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost at file location
Exiting rear mkopalpba (PID 3337) and its descendant processes ...
Running exit tasks
To remove the build area use (with caution): rm -Rf --one-file-system /tmp/rear.JeqjpKW3aQQoNjD

# find /tmp/rear.JeqjpKW3aQQoNjD/rootfs/ | grep 'usr/share/rear' | wc -l
23

# find /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost -ls
     2173      0 drwxr-x---   1 root     root          114 Jul  5 13:00 /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost
     2175  52224 -rw-------   1 root     root     53477376 Jul  5 13:00 /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost/TCG-Opal-PBA-localhost.raw
     2176      4 -rw-------   1 root     root          279 Jul  5 13:00 /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost/VERSION
     2177      4 -rw-------   1 root     root          505 Jul  5 13:00 /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost/README
     2178   1844 -rw-------   1 root     root      1886762 Jul  5 13:00 /root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost/rear-localhost.log


# usr/sbin/rear -D mkrescue
Relax-and-Recover 2.6 / Git
Running rear mkrescue (PID 31087 date 2021-07-05 13:02:13)
Command line options: usr/sbin/rear -D mkrescue
Using log file: /root/rear.github.master/var/log/rear/rear-localhost.log
Using build area: /tmp/rear.20JBtUGj4EFKEv3
Running workflow mkrescue on the normal/original system
Using local PBA image file '/root/rear.github.master/var/lib/rear/TCG-Opal-PBA/localhost/TCG-Opal-PBA-localhost.raw'
Using autodetected kernel '/boot/vmlinuz-5.3.18-57-default' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /root/rear.github.master/var/lib/rear/layout/disklayout.conf
SLES12-SP1 (and later) btrfs subvolumes setup needed for /dev/mapper/system-root (default subvolume path contains '@/.snapshots/')
Added  /dev/mapper/system-root to BTRFS_SUBVOLUME_SLES_SETUP in /tmp/rear.20JBtUGj4EFKEv3/rootfs/etc/rear/rescue.conf
Disabling excluded components in /root/rear.github.master/var/lib/rear/layout/disklayout.conf
Using sysconfig bootloader 'grub2'
Verifying that the entries in /root/rear.github.master/var/lib/rear/layout/disklayout.conf are correct
Created disk layout (check the results in /root/rear.github.master/var/lib/rear/layout/disklayout.conf)
Creating recovery system root filesystem skeleton layout
Handling network interface 'eth0'
eth0 is a physical device
Handled network interface 'eth0'
Included current keyboard mapping (via 'dumpkeys -f')
Included default US keyboard mapping /usr/share/kbd/keymaps/legacy/i386/qwerty/defkeymap.map.gz
Included other keyboard mappings in /usr/share/kbd/keymaps
Copying logfile /root/rear.github.master/var/log/rear/rear-localhost.log into initramfs as '/tmp/rear-localhost-partial-2021-07-05T13:02:20+02:00.log'
Copying files and directories
Copying binaries and libraries
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules') and those in MODULES_LOAD
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/mtab' target '/proc/11678/mounts' on /proc/ /sys/ /dev/ or /run/
Skip copying broken symlink '/etc/resolv.conf' target '/run/netconfig/resolv.conf' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.20JBtUGj4EFKEv3/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Testing that the existing programs in the PROGS array can be found as executable command within the recovery system
Testing that each program in the REQUIRED_PROGS array can be found as executable command within the recovery system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (108225402 bytes) in 14 seconds
Using Grub 2 to create an EFI bootloader
Creating 122 MiB raw disk image "rear-localhost.raw"
Using syslinux to install a Legacy BIOS bootloader
Copying resulting files to file location
Saving /root/rear.github.master/var/log/rear/rear-localhost.log as rear-localhost.log to file location
Copying result files '/tmp/rear.20JBtUGj4EFKEv3/tmp/rear-localhost.raw.gz /tmp/rear.20JBtUGj4EFKEv3/tmp/VERSION /tmp/rear.20JBtUGj4EFKEv3/tmp/README /tmp/rear.20JBtUGj4EFKEv3/tmp/rear-localhost.log' to /var/lib/rear/output/localhost at file location
Exiting rear mkrescue (PID 31087) and its descendant processes ...
Running exit tasks
To remove the build area use (with caution): rm -Rf --one-file-system /tmp/rear.20JBtUGj4EFKEv3

# find /tmp/rear.20JBtUGj4EFKEv3/rootfs/ | grep 'usr/share/rear' | wc -l
1521

# find /var/lib/rear/output/localhost -ls
    14494      0 drwxr-x---   1 root     root          104 Jul  5 13:03 /var/lib/rear/output/localhost
    14496 114144 -rw-------   1 root     root     116879576 Jul  5 13:03 /var/lib/rear/output/localhost/rear-localhost.raw.gz
    14497      4 -rw-------   1 root     root           279 Jul  5 13:03 /var/lib/rear/output/localhost/VERSION
    14498      4 -rw-------   1 root     root           505 Jul  5 13:03 /var/lib/rear/output/localhost/README
    14499   1708 -rw-------   1 root     root       1745275 Jul  5 13:03 /var/lib/rear/output/localhost/rear-localhost.log
</code></pre>
<p>So "rear mkopalpba" made a TCG-Opal-PBA-localhost.raw<br />
that seems to contain only 23 files of usr/share/rear<br />
(only some usr/share/rear/lib/*functions.sh files)<br />
while "rear mkrescue" made a rear-localhost.raw.gz<br />
that contains all of usr/share/rear (1521 files of usr/share/rear in my
case).</p>
<p>Because I am not a OPAL user and I do not have a self-encrypting disk<br />
I cannot tell if the above made TCG-Opal-PBA-localhost.raw is right<br />
i.e. I cannot verify if it works as described in the section</p>
<pre><code>Administering Self-Encrypting Disks
  Creating a Pre-Boot Authentication (PBA) System
</code></pre>
<p>in<br />
<a href="https://github.com/rear/rear/blob/master/doc/user-guide/13-tcg-opal-support.adoc">https://github.com/rear/rear/blob/master/doc/user-guide/13-tcg-opal-support.adoc</a></p>
<h4 id="tigaente_commented_at_2021-07-05_1402"><img src="https://avatars.githubusercontent.com/u/41113817?v=4" width="50"><a href="https://github.com/tigaente">tigaente</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874137690">2021-07-05 14:02</a>:<a class="headerlink" href="#tigaente_commented_at_2021-07-05_1402" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
thanks a lot for your reply. My problem, however, is not with the SEDs.
It is with the rescue system. Let me explain:</p>
<p>My plan is as follows:</p>
<ol>
<li>Create a REAR rescue image with OPAL PBA support</li>
<li>Put the rescue image on a USB disk and boot from it. This way I can
    make sure I have a recovery system to disable drive encryption if
    anything breaks.</li>
<li>Enable drive encryption (or to be more precise: enable drive
    locking) to enforce the encryption</li>
<li>Install the PBA into the ShadowMBR on the Boot drive</li>
<li>Power-down, reboot and hope for the best :)</li>
</ol>
<p>Right now, I fail at point 2. I can create the rescue image and boot
from it. However, in the rescue system the 'rear' command does not work
because it wants to source some files from /usr/share/rear which simply
are not present in the rescue system.</p>
<p>For what it's worth though, here is what I did right now, to create the
rescue image:</p>
<ol>
<li>Clone github-repo to local disk:
    <code>git clone https://github.com/rear/rear</code></li>
<li>Run rear command from local git repo to create the PBA:
    <code>usr/sbin/rear -D mkopalpba</code></li>
</ol>
<!-- -->

<pre><code>Relax-and-Recover 2.6 / Git
Running rear mkopalpba (PID 144340 date 2021-07-05 15:46:37)
Command line options: usr/sbin/rear -D mkopalpba
Using log file: /root/rear/var/log/rear/rear-Andi-PC.log
Using build area: /tmp/rear.usWP6A4ijL9HUAZ
Running workflow mkopalpba on the normal/original system
Re-configuring Relax-and-Recover to create a TCG Opal pre-boot authentication (PBA) image
Found EFI system partition /dev/sda1 on /boot/efi type vfat
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using specified KERNEL_FILE '/boot/vmlinuz-5.12-x86_64' as kernel in the recovery system
Creating recovery system root filesystem skeleton layout
Handling network interface 'enp3s0'
enp3s0 is a physical device
Handled network interface 'enp3s0'
Included current keyboard mapping (via 'dumpkeys -f')
Included default US keyboard mapping /usr/share/kbd/keymaps/i386/qwerty/defkeymap.map.gz
Included other keyboard mappings in /usr/share/kbd/keymaps
Trying to find what to use as UEFI bootloader...
Trying to find a 'well known file' to be used as UEFI bootloader...
Using '/boot/efi/EFI/Manjaro/grubx64.efi' as UEFI bootloader file
Copying files and directories
Copying binaries and libraries
A list of executables with their dependencies has been stored in /tmp/rear.usWP6A4ijL9HUAZ/tmp/executable-dependencies
Copying only currently loaded kernel modules (MODULES contains 'loaded_modules') and those in MODULES_LOAD
Omit copying files in /lib*/firmware/ (FIRMWARE_FILES='no')
Skip copying broken symlink '/etc/mtab' target '/proc/158648/mounts' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.usWP6A4ijL9HUAZ/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Testing that the existing programs in the PROGS array can be found as executable command within the recovery system
Testing that each program in the REQUIRED_PROGS array can be found as executable command within the recovery system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (47872007 bytes) in 5 seconds
Using Grub 2 to create an EFI bootloader
TIP: You can achieve a faster EFI boot by installing syslinux for EFI on this system
Creating 60 MiB raw disk image "TCG-Opal-PBA-Andi-PC.raw"
Copying resulting files to file location
Saving /root/rear/var/log/rear/rear-Andi-PC.log as rear-Andi-PC.log to file location
Copying result files '/tmp/rear.usWP6A4ijL9HUAZ/tmp/TCG-Opal-PBA-Andi-PC.raw /tmp/rear.usWP6A4ijL9HUAZ/tmp/VERSION /tmp/rear.usWP6A4ijL9HUAZ/tmp/README /tmp/rear.usWP6A4ijL9HUAZ/tmp/rear-Andi-PC.log' to /root/rear/var/lib/rear/TCG-Opal-PBA/Andi-PC at file location
Exiting rear mkopalpba (PID 144340) and its descendant processes ...
Running exit tasks
To remove the build area use (with caution): rm -Rf --one-file-system /tmp/rear.usWP6A4ijL9HUAZ
</code></pre>
<ol>
<li>Run rear command from local git repo to create the rescue image:
    <code>usr/sbin/rear -D mkrescue</code></li>
</ol>
<!-- -->

<pre><code>Relax-and-Recover 2.6 / Git
Running rear mkrescue (PID 164282 date 2021-07-05 15:49:16)
Command line options: usr/sbin/rear -D mkrescue
Using log file: /root/rear/var/log/rear/rear-Andi-PC.log
Using build area: /tmp/rear.CE8YrMBCmLDpY7U
Running workflow mkrescue on the normal/original system
Found EFI system partition /dev/sda1 on /boot/efi type vfat
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using local PBA image file '/root/rear/var/lib/rear/TCG-Opal-PBA/Andi-PC/TCG-Opal-PBA-Andi-PC.raw'
Using specified KERNEL_FILE '/boot/vmlinuz-5.12-x86_64' as kernel in the recovery system
Creating disk layout
Automatically excluding disk /dev/sdc (not used by any mounted filesystem)
Marking component '/dev/sdc' as done in /root/rear/var/lib/rear/layout/disktodo.conf
Dependant component /dev/sdc1 is a child of component /dev/sdc
Marking component '/dev/sdc1' as done in /root/rear/var/lib/rear/layout/disktodo.conf
Automatically excluding disk /dev/sdd (not used by any mounted filesystem)
Marking component '/dev/sdd' as done in /root/rear/var/lib/rear/layout/disktodo.conf
Dependant component /dev/sdd1 is a child of component /dev/sdd
Marking component '/dev/sdd1' as done in /root/rear/var/lib/rear/layout/disktodo.conf
Disabling excluded components in /root/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'disk /dev/sdc' in /root/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'part /dev/sdc' in /root/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'disk /dev/sdd' in /root/rear/var/lib/rear/layout/disklayout.conf
Disabling component 'part /dev/sdd' in /root/rear/var/lib/rear/layout/disklayout.conf
Using guessed bootloader 'EFI' (found in first bytes on /dev/sda)
Verifying that the entries in /root/rear/var/lib/rear/layout/disklayout.conf are correct
Created disk layout (check the results in /root/rear/var/lib/rear/layout/disklayout.conf)
Creating recovery system root filesystem skeleton layout
Handling network interface 'enp3s0'
enp3s0 is a physical device
Handled network interface 'enp3s0'
Included current keyboard mapping (via 'dumpkeys -f')
Included default US keyboard mapping /usr/share/kbd/keymaps/i386/qwerty/defkeymap.map.gz
Included other keyboard mappings in /usr/share/kbd/keymaps
To log into the recovery system via ssh set up /root/.ssh/authorized_keys or specify SSH_ROOT_PASSWORD
Trying to find what to use as UEFI bootloader...
Trying to find a 'well known file' to be used as UEFI bootloader...
Using '/boot/efi/EFI/Manjaro/grubx64.efi' as UEFI bootloader file
Copying logfile /root/rear/var/log/rear/rear-Andi-PC.log into initramfs as '/tmp/rear-Andi-PC-partial-2021-07-05T15:49:22+02:00.log'
Copying files and directories
Copying binaries and libraries
Copying all kernel modules in /lib/modules/5.12.9-1-MANJARO (MODULES contains 'all_modules')
Copying all files in /lib*/firmware/
**Symlink '/usr/share/rear' -&gt; '/usr/share/rear' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/share/rear' via the 'COPY_AS_IS' configuration variable.**
Skip copying broken symlink '/etc/mtab' target '/proc/175343/mounts' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.CE8YrMBCmLDpY7U/rootfs contains a usable system
Testing each binary with 'ldd' and look for 'not found' libraries within the recovery system
Testing that the existing programs in the PROGS array can be found as executable command within the recovery system
Testing that each program in the REQUIRED_PROGS array can be found as executable command within the recovery system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (609214371 bytes) in 42 seconds
Using Grub 2 to create an EFI bootloader
TIP: You can achieve a faster EFI boot by installing syslinux for EFI on this system
Creating 633 MiB raw disk image "rear-Andi-PC.raw"
Copying resulting files to file location
Saving /root/rear/var/log/rear/rear-Andi-PC.log as rear-Andi-PC.log to file location
Copying result files '/tmp/rear.CE8YrMBCmLDpY7U/tmp/rear-Andi-PC.raw.gz /tmp/rear.CE8YrMBCmLDpY7U/tmp/VERSION /tmp/rear.CE8YrMBCmLDpY7U/tmp/README /tmp/rear.CE8YrMBCmLDpY7U/tmp/rear-Andi-PC.log' to /var/lib/rear/output/Andi-PC at file location
Exiting rear mkrescue (PID 164282) and its descendant processes ...
Running exit tasks
To remove the build area use (with caution): rm -Rf --one-file-system /tmp/rear.CE8YrMBCmLDpY7U
</code></pre>
<p>Again, as you can see it mentions some symlink error to a non-existant
directory on the recovery system:</p>
<pre><code>Symlink '/usr/share/rear' -&gt; '/usr/share/rear' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/share/rear' via the 'COPY_AS_IS' configuration variable.
</code></pre>
<p>I mean, I can try to workaround with the COPY_AS_IS instruction and
see what it gives me. However, I do not understand the reason, though.
The files are there on the system that I use to create the rescue image.
Why do they not get copied? And why is it trying to copy from
/usr/share/rear and not usr/share/rear? ShouIdn't it take all the files
from the local github repo version?</p>
<p>Thanks,<br />
Andi</p>
<h4 id="tigaente_commented_at_2021-07-05_1558"><img src="https://avatars.githubusercontent.com/u/41113817?v=4" width="50"><a href="https://github.com/tigaente">tigaente</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874210341">2021-07-05 15:58</a>:<a class="headerlink" href="#tigaente_commented_at_2021-07-05_1558" title="Permanent link">&para;</a></h4>
<p>So.. using COPY_AS_IS solved it, but I do not really understand why
and what the difference is.</p>
<h4 id="jsmeix_commented_at_2021-07-06_1259"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874737793">2021-07-06 12:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-06_1259" title="Permanent link">&para;</a></h4>
<p>I never had a symlink <code>/usr/share/rear -&gt; /usr/share/rear</code><br />
so this seems to be the root cause in your particular case.</p>
<p>I have no idea why you have such a symlink.<br />
Normally you should not have such a symlink.</p>
<p>E.g. in my <code>git clone https://github.com/rear/rear.git</code> directory</p>
<pre><code>localhost:~/rear.github.master # find . -type l -ls | less
</code></pre>
<p>does not show such a symlink.</p>
<h4 id="jsmeix_commented_at_2021-07-06_1408"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874793205">2021-07-06 14:08</a>:<a class="headerlink" href="#jsmeix_commented_at_2021-07-06_1408" title="Permanent link">&para;</a></h4>
<p>FYI<br />
why symbolic links must be copied as symbolic links<br />
see the comment in build/GNU/Linux/100_copy_as_is.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh">https://github.com/rear/rear/blob/master/usr/share/rear/build/GNU/Linux/100_copy_as_is.sh</a></p>
<pre><code>Symbolic links must be copied as symbolic links ('tar -h' must not be used here)
because 'tar -h' does not finish and blows up the recovery system to Gigabytes,
see https://github.com/rear/rear/pull/1636
</code></pre>
<h4 id="tigaente_commented_at_2021-07-06_1538"><img src="https://avatars.githubusercontent.com/u/41113817?v=4" width="50"><a href="https://github.com/tigaente">tigaente</a> commented at <a href="https://github.com/rear/rear/issues/2642#issuecomment-874868293">2021-07-06 15:38</a>:<a class="headerlink" href="#tigaente_commented_at_2021-07-06_1538" title="Permanent link">&para;</a></h4>
<p>Hi,<br />
so I double-checked like four times. I also do not have a symlink to
/usr/share/rear nor is it one. That is the reason why I am so
dumbfounded by that message.</p>
<p>But anyway.. I managed to get the OPAL thing working. Both disks are now
locked. However, rear let me down with the OPAL enabling and locking
procedure as well and I also do not use the rear-created PBA because
that cannot unlock the disks for whatever reason. I use the one provided
by chubbyant. You can find it on
<a href="http://www.sedutil.com">www.sedutil.com</a> or
<a href="https://github.com/ChubbyAnt/sedutil/releases">https://github.com/ChubbyAnt/sedutil/releases</a>
if you are interested.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2021-07-01.2642.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
