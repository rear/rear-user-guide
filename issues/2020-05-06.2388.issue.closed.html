<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2388 Issue closed: "rear mkrescue" does not error out when required GRUB2 modules are missing - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2388 Issue closed: \"rear mkrescue\" does not error out when required GRUB2 modules are missing";
        var mkdocs_page_input_path = "issues/2020-05-06.2388.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../scenarios/netfs_rsync.md">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2388 Issue closed: "rear mkrescue" does not error out when required GRUB2 modules are missing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2388_issue_closed_rear_mkrescue_does_not_error_out_when_required_grub2_modules_are_missing"><a href="https://github.com/rear/rear/issues/2388">#2388 Issue</a> <code>closed</code>: "rear mkrescue" does not error out when required GRUB2 modules are missing<a class="headerlink" href="#2388_issue_closed_rear_mkrescue_does_not_error_out_when_required_grub2_modules_are_missing" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>bug</code>, <code>fixed / solved / done</code></p>
<h4 id="shaunsjm_opened_issue_at_2020-05-06_1427"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> opened issue at <a href="https://github.com/rear/rear/issues/2388">2020-05-06 14:27</a>:<a class="headerlink" href="#shaunsjm_opened_issue_at_2020-05-06_1427" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): Relax-and-Recover
    2.5-git.0.36106f4.unknown.changed / 2020-01-30</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    OS_VENDOR=SUSE_LINUX<br />
    OS_VERSION=15.1</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>HOSTNAME="$( uname -n | cut -d. -f1 )"
OUTPUT=ISO
BACKUP=NETFS
USING_UEFI_BOOTLOADER=1
BACKUP_OPTIONS="nolock,credentials=/etc/rear/cifs-rear"
BACKUP_URL=cifs://den-vmutility/Linux-Rear-Migrations
NETFS_KEEP_OLD_BACKUP_COPY=yes
REQUIRED_PROGS=( "${REQUIRED_PROGS[@]}" snapper chattr lsattr )
COPY_AS_IS=( "${COPY_AS_IS[@]}" /usr/lib/snapper/installation-helper /etc/snapper/config-templates/default /etc/rear/cifs-rear )
BACKUP_PROG_INCLUDE=( /var/cache /var/lib/mailman /var/tmp /var/lib/pgsql /usr/local /opt /var/lib/libvirt/images /boot/grub2/i386-pc /var/opt /srv /boot/grub2/x86_64-efi /var/lib/mariadb /var/spool /var/lib/mysql /tmp /home /var/log /var/lib/named /var/lib/machines )
POST_RECOVERY_SCRIPT=( 'if snapper --no-dbus -r $TARGET_FS_ROOT get-config | grep -q "^QGROUP.*[0-9]/[0-9]" ; then snapper --no-dbus -r $TARGET_FS_ROOT set-config QGROUP= ; snapper --no-dbus -r $TARGET_FS_ROOT setup-quota &amp;&amp; echo snapper setup-quota done || echo snapper setup-quota failed ; else echo snapper setup-quota not used ; fi' )
ONLY_INCLUDE_VG=( "system" )
AUTOEXCLUDE_MULTIPATH=n
ISO_MKISOFS_BIN=/usr/bin/ebiso
EXCLUDE_VG=( "vgapp" "vgarchlog" "vgu00-04" "vgu05-09" )
EXCLUDE_MOUNTPOINTS=('/app' '/archlog' '/u00' '/u01' '/u02' '/u03' '/u04' '/u05' '/u06' '/u07' '/u08' '/u09')
CLONE_ALL_USERS_GROUPS="true"
</code></pre>
<ul>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR):<br />
    Product Name: ThinkSystem SR650</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86.<br />
    This is a SUSE SLES 15 SP1 server running BTRFS on a Lenovo
    ThinkSystem SR650</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI with GRUB</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    Local disk</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT" or "lsblk" as
    makeshift):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                        KNAME     PKNAME    TRAN TYPE FSTYPE        SIZE MOUNTPOINT
/dev/sda                    /dev/sda                 disk             278.5G
|-/dev/sda1                 /dev/sda1 /dev/sda       part vfat          500M /boot/efi
`-/dev/sda2                 /dev/sda2 /dev/sda       part LVM2_member   278G
  |-/dev/mapper/system-root /dev/dm-0 /dev/sda2      lvm  btrfs          40G /
  |-/dev/mapper/system-swap /dev/dm-1 /dev/sda2      lvm  swap           15G [SWAP]
  `-/dev/mapper/system-home /dev/dm-2 /dev/sda2      lvm  ext4           10G /home
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    Rear backup works, but during restore this is shown:</li>
</ul>
<!-- -->

<pre><code>error: file '/boot/grub/x86_64-efi/video_bochs.mod' not found
error: file '/boot/grub/x86_64-efi/video_cirrus.mod' not found
</code></pre>
<ul>
<li>
<p>Workaround, if any:<br />
    I haven't found one</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<!-- -->

<pre><code>Relax-and-Recover 2.5-git.0.36106f4.unknown.changed / 2020-01-30
Running rear mkbackup (PID 17236)
Using log file: /var/log/rear/rear-slc-lxnbu1p.log
Using backup archive '/tmp/rear.go8q7sa6eQq3gwR/outputfs/slc-lxnbu1p/backup.tar.gz'
Found EFI system partition /dev/sda1 on /boot/efi type vfat
Using UEFI Boot Loader for Linux (USING_UEFI_BOOTLOADER=1)
Using autodetected kernel '/boot/vmlinuz-4.12.14-197.34-default' as kernel in the recovery system
Creating disk layout
Overwriting existing disk layout file /var/lib/rear/layout/disklayout.conf
SLES12-SP1 (and later) btrfs subvolumes setup needed for /dev/mapper/system-root (default subvolume path contains '@/.snapshots/')
Added  /dev/mapper/system-root to BTRFS_SUBVOLUME_SLES_SETUP in /tmp/rear.go8q7sa6eQq3gwR/rootfs/etc/rear/rescue.conf
Excluding Volume Group vgapp.
Excluding Volume Group vgarchlog.
Excluding Volume Group vgu00-04.
Excluding Volume Group vgu05-09.
Using sysconfig bootloader 'grub2-efi'
Verifying that the entries in /var/lib/rear/layout/disklayout.conf are correct ...
Creating recovery system root filesystem skeleton layout
Handling network interface 'eth3'
eth3 is a physical device
Handled network interface 'eth3'
Trying to find what to use as UEFI bootloader...
Trying to find a 'well known file' to be used as UEFI bootloader...
Using '/boot/efi/EFI/sles/grubx64.efi' as UEFI bootloader file
Copying logfile /var/log/rear/rear-slc-lxnbu1p.log into initramfs as '/tmp/rear-slc-lxnbu1p-partial-2020-05-05T15:11:00-06:00.log'
Copying files and directories
Copying binaries and libraries
Copying all kernel modules in /lib/modules/4.12.14-197.34-default (MODULES contains 'all_modules')
Copying all files in /lib*/firmware/
Skip copying broken symlink '/etc/mtab' target '/proc/29568/mounts' on /proc/ /sys/ /dev/ or /run/
Testing that the recovery system in /tmp/rear.go8q7sa6eQq3gwR/rootfs contains a usable system
Creating recovery/rescue system initramfs/initrd initrd.cgz with gzip default compression
Created initrd.cgz with gzip default compression (316919467 bytes) in 37 seconds
GRUB2 modules to load: btrfs fat lvm part_gpt
Making ISO image
Wrote ISO image: /var/lib/rear/output/rear-slc-lxnbu1p.iso (355M)
Copying resulting files to cifs location
Saving /var/log/rear/rear-slc-lxnbu1p.log as rear-slc-lxnbu1p.log to cifs location
Copying result files '/var/lib/rear/output/rear-slc-lxnbu1p.iso /tmp/rear.go8q7sa6eQq3gwR/tmp/VERSION /tmp/rear.go8q7sa6eQq3gwR/tmp/README /tmp/rear.go8q7sa6eQq3gwR/tmp/rear-slc-lxnbu1p.log' to /tmp/rear.go8q7sa6eQq3gwR/outputfs/slc-lxnbu1p at cifs location
Making backup (using backup method NETFS)
Creating tar archive '/tmp/rear.go8q7sa6eQq3gwR/outputfs/slc-lxnbu1p/backup.tar.gz'
Archived 1314 MiB [avg 7046 KiB/sec] OK
WARNING: tar ended with return code 1 and below output:
  ---snip---
  tar: /var/lib/named: Warning: Cannot stat: No such file or directory
  tar: /var/lib/machines: Warning: Cannot stat: No such file or directory
  tar: /sys: file changed as we read it
  ----------
This means that files have been modified during the archiving
process. As a result the backup may not be completely consistent
or may not be a perfect copy of the system. Relax-and-Recover
will continue, however it is highly advisable to verify the
backup in order to be sure to safely recover this system.

Archived 1314 MiB in 192 seconds [avg 7010 KiB/sec]
Exiting rear mkbackup (PID 17236) and its descendant processes ...
Running exit tasks
You should also rm -Rf /tmp/rear.go8q7sa6eQq3gwR
</code></pre>
<p><img alt="rear-failure2" src="https://user-images.githubusercontent.com/55768113/81188936-37e53280-8f73-11ea-954e-d9522da05eb6.png" /></p>
<h4 id="jsmeix_commented_at_2020-05-07_0733"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625083293">2020-05-07 07:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_0733" title="Permanent link">&para;</a></h4>
<p>In our current ReaR GitHub master code we have support for<br />
<code>GRUB2_MODULES</code> and <code>GRUB2_MODULES_LOAD</code><br />
see the description in default.conf<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2798">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L2798</a></p>
<p>If you do not have <code>GRUB2_MODULES</code> and <code>GRUB2_MODULES_LOAD</code><br />
in your locally installed usr/share/rear/conf/default.conf<br />
try out if it works with our current ReaR GitHub master code, see<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<p>Regarding how <code>GRUB2_MODULES</code> and <code>GRUB2_MODULES_LOAD</code><br />
actually work see the function <code>build_bootx86_efi</code><br />
in usr/share/rear/lib/uefi-functions.sh<br />
The function <code>build_bootx86_efi</code> is called in the scripts<br />
usr/share/rear/output/ISO/Linux-i386/250_populate_efibootimg.sh<br />
when you have <code>OUTPUT=ISO</code> or alternatively in<br />
usr/share/rear/output/USB/Linux-i386/100_create_efiboot.sh<br />
if you had <code>OUTPUT=USB</code> and/or additionally in<br />
usr/share/rear/output/default/940_grub2_rescue.sh<br />
if you dared to use <code>GRUB_RESCUE="yes"</code> (read default.conf about that).</p>
<h4 id="pcahyna_commented_at_2020-05-07_0819"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625105141">2020-05-07 08:19</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_0819" title="Permanent link">&para;</a></h4>
<p>I think the problem is in
<a href="https://github.com/rear/rear/blob/2037ebb20699bc5d4a1c87b0a81b8cbfc6c56454/usr/share/rear/lib/bootloader-functions.sh#L509">https://github.com/rear/rear/blob/2037ebb20699bc5d4a1c87b0a81b8cbfc6c56454/usr/share/rear/lib/bootloader-functions.sh#L509</a>
where some GRUB2 modules are loaded unconditionally from the generated
configuration file (i.e. <code>GRUB2_MODULES</code> and <code>GRUB2_MODULES_LOAD</code> most
likely will not help). I recently removed some hardcoded module stuff
from the GRUB2 code, but I have not touched that part. Yet another
reason for less hardcoded values.... Isn't the <code>insmod all_video</code>
enough?<br />
<a href="https://github.com/rear/rear/blob/2037ebb20699bc5d4a1c87b0a81b8cbfc6c56454/usr/share/rear/lib/bootloader-functions.sh#L511">https://github.com/rear/rear/blob/2037ebb20699bc5d4a1c87b0a81b8cbfc6c56454/usr/share/rear/lib/bootloader-functions.sh#L511</a></p>
<h4 id="pcahyna_commented_at_2020-05-07_0843"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625117048">2020-05-07 08:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_0843" title="Permanent link">&para;</a></h4>
<p>@shaunsJM are those modules absent also on the installed system, or only
in the rescue system? Maybe they got removed from recent GRUB2 packages
on SLES.</p>
<h4 id="pcahyna_commented_at_2020-05-07_0855"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625123537">2020-05-07 08:55</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_0855" title="Permanent link">&para;</a></h4>
<p>If the modules are actually present on the installed system, and just
not installed to the rescue image, then adding them to <code>GRUB2_MODULES</code>
could actually help, but this is weird, since the default is to include
all modules. If you remove</p>
<pre><code>insmod video_bochs
insmod video_cirrus
</code></pre>
<p>from <code>usr/share/rear/lib/bootloader-functions.sh</code> and recreate the
rescue image, will it work fine, or suffer from some other problem?</p>
<h4 id="shaunsjm_commented_at_2020-05-07_0944"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625147460">2020-05-07 09:44</a>:<a class="headerlink" href="#shaunsjm_commented_at_2020-05-07_0944" title="Permanent link">&para;</a></h4>
<p>@pcahyna you are correct, the video_bochs and video_cirrus are not on
the installed system.<br />
From the running system trying to insmod these files:</p>
<pre><code>insmod video_bochs
insmod: ERROR: could not load module video_bochs: No such file or directory
insmod video_cirrus
insmod: ERROR: could not load module video_cirrus: No such file or directory
</code></pre>
<p>I removed the insmod lines from the
usr/share/rear/lib/bootloader-functions.sh and this fixed the recovery
issue.<br />
You may be correct when you say "Maybe they got removed from recent
GRUB2 packages on SLES."</p>
<p>Thanks for the help!</p>
<h4 id="pcahyna_commented_at_2020-05-07_0953"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625152374">2020-05-07 09:53</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_0953" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@pcahyna you are correct, the video_bochs and video_cirrus are not
on the installed system.<br />
From the running system trying to insmod these files:</p>
<pre><code>insmod video_bochs
insmod: ERROR: could not load module video_bochs: No such file or directory
insmod video_cirrus
insmod: ERROR: could not load module video_cirrus: No such file or directory
</code></pre>
</blockquote>
<p>That's a misunderstanding - those are GRUB modules, not kernel modules,
but <code>insmod</code> in the running system works on kernel modules. So it could
not have found them in any case.</p>
<p>I think the GRUB modules are located under <code>/usr/lib/grub/x86_64-efi</code> or
under <code>/boot</code>. Could you please look there? @jsmeix where would one find
them on SLES?</p>
<blockquote>
<p>I removed the insmod lines from the
usr/share/rear/lib/bootloader-functions.sh and this fixed the recovery
issue.</p>
</blockquote>
<p>Thanks for testing!</p>
<p>I think this issue should stay open, this looks like an actual problem,
it should work out of the box.</p>
<h4 id="jsmeix_commented_at_2020-05-07_1006"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625159020">2020-05-07 10:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1006" title="Permanent link">&para;</a></h4>
<p>@shaunsJM<br />
regarding your
<a href="https://github.com/rear/rear/issues/2388#issuecomment-625147460">https://github.com/rear/rear/issues/2388#issuecomment-625147460</a><br />
"video_bochs and video_cirrus are not on the installed [SLES15-SP1]
system":</p>
<p>Om my current homeoffice laptop openSUSE Leap 15.1 system<br />
that should be same for the basic system packages<br />
as SLES15-SP1 is (except exceptions! ;-)<br />
I do have those GRUB2 modules installed</p>
<pre><code># rpm -ql grub2-i386-pc | grep video_

/usr/share/grub2/i386-pc/video_bochs.mod
/usr/share/grub2/i386-pc/video_bochs.module
/usr/share/grub2/i386-pc/video_cirrus.mod
/usr/share/grub2/i386-pc/video_cirrus.module
/usr/share/grub2/i386-pc/video_colors.mod
/usr/share/grub2/i386-pc/video_colors.module
/usr/share/grub2/i386-pc/video_fb.mod
/usr/share/grub2/i386-pc/video_fb.module
</code></pre>
<p>via the RPM package <code>grub2-i386-pc</code> that is required by GRUB2</p>
<pre><code># rpm -e --test grub2-i386-pc

error: Failed dependencies:
grub2-i386-pc = 2.02-lp151.21.15.1 is needed
by (installed) grub2-2.02-lp151.21.15.1.x86_64
</code></pre>
<p>so I would assume that also on SLES15-SP1<br />
you should have <code>grub2-i386-pc</code> installed and that<br />
should provide those GRUB2 modules.</p>
<h4 id="shaunsjm_commented_at_2020-05-07_1010"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625161016">2020-05-07 10:10</a>:<a class="headerlink" href="#shaunsjm_commented_at_2020-05-07_1010" title="Permanent link">&para;</a></h4>
<p>@pcahyna Thanks for the clarification about the GRUB vs. kernel
modules.<br />
@jsmeix From checking several of my other servers, I find the
video_bochs and video_cirrus under /boot/grub2/i386-pc/ for those
servers not running UEFI. Is your Leap 15.1 system running UEFI or
Legacy?</p>
<h4 id="pcahyna_commented_at_2020-05-07_1012"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625161752">2020-05-07 10:12</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_1012" title="Permanent link">&para;</a></h4>
<p>@jsmeix but this is not <code>i386-pc</code>, this is <code>x86_64-efi</code>. Do those
modules also exist in the appropriate subpackage for EFI?</p>
<h4 id="pcahyna_commented_at_2020-05-07_1013"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625162054">2020-05-07 10:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_1013" title="Permanent link">&para;</a></h4>
<p>(ReaR does not use GRUB at all for <code>i386-pc</code> right? It uses
SYSLINUX/ISOLINUX.)</p>
<h4 id="jsmeix_commented_at_2020-05-07_1016"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625163720">2020-05-07 10:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1016" title="Permanent link">&para;</a></h4>
<p>Ah!<br />
My current homeoffice laptop openSUSE Leap 15.1 system boots via legacy
boot.<br />
Currently I do not have a UEFI booting system at home.<br />
But I can check what files we provide in our GRUB2 RPMs...</p>
<h4 id="pcahyna_commented_at_2020-05-07_1016"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625163772">2020-05-07 10:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_1016" title="Permanent link">&para;</a></h4>
<p>@shaunsJM</p>
<blockquote>
<p>From checking several of my other servers, I find the video_bochs and
video_cirrus under /boot/grub2/i386-pc/ for those servers not running
UEFI.</p>
</blockquote>
<p>And have you found them in the appropriate directory for efi GRUB on
server that is running UEFI?</p>
<h4 id="jsmeix_commented_at_2020-05-07_1024"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625167827">2020-05-07 10:24</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1024" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
regarding your
<a href="https://github.com/rear/rear/issues/2388#issuecomment-625105141">https://github.com/rear/rear/issues/2388#issuecomment-625105141</a></p>
<p>I am not at all a sufficient bootloader expert to know whether or not<br />
it is needed or makes sense or whatever to enforce loading<br />
this or that GRUB2 modules.</p>
<p>In general we must much better care about possible errors in ReaR<br />
and error out early with a reasonable error message for the user<br />
during "rear mkbackup/mkrescue" when things cannot work later<br />
than to blindly proceed and let the user find out later when it is too
late<br />
that things fail when booting the recovery system or during "rear
recover".</p>
<p>So for each GRUB2 module that will be enforced loaded<br />
we must first and foremost at least check during "rear mkrescue"<br />
that the GRUB2 module is actually there and made available for<br />
the GRUB2 bootloader on the ReaR recovery system.</p>
<h4 id="shaunsjm_commented_at_2020-05-07_1026"><img src="https://avatars.githubusercontent.com/u/55768113?v=4" width="50"><a href="https://github.com/shaunsJM">shaunsJM</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625168649">2020-05-07 10:26</a>:<a class="headerlink" href="#shaunsjm_commented_at_2020-05-07_1026" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@shaunsJM</p>
<blockquote>
<p>From checking several of my other servers, I find the video_bochs
and video_cirrus under /boot/grub2/i386-pc/ for those servers not
running UEFI.</p>
</blockquote>
<p>And have you found them in the appropriate directory for efi GRUB on
server that is running UEFI?</p>
</blockquote>
<p>on my UEFI system the only "video" modules are these:</p>
<pre><code>all_video.mod
fixvideo.mod
video.lst
video.mod
video_colors.mod
video_fb.mod
videoinfo.mod
videotest.mod
videotest_checksum.mod
</code></pre>
<h4 id="pcahyna_commented_at_2020-05-07_1035"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625172747">2020-05-07 10:35</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_1035" title="Permanent link">&para;</a></h4>
<blockquote>
<p>So for each GRUB2 module that will be enforced loaded<br />
we must first and foremost at least check during "rear mkrescue"<br />
that the GRUB2 module is actually there and made available for<br />
the GRUB2 bootloader on the ReaR recovery system.</p>
</blockquote>
<p>Laudable but ambitious goal - @jhlavac do you know if there is a clean
way to do this, please?</p>
<p>In the short term, the fix could be to reduce the number of modules that
we <code>insmod</code> in the generated configuration file and try to restrict
ourselves to those that are in some sense "public" or "stable", if Grub
has such concepts. In this particular case, I suspect that loading
<code>all_video</code> should be enough and Grub knows better what modules it
actually loads (when I checked, on a system that has them, <code>video_bochs</code>
and <code>video_cirrus</code> is among them, so loading them explicitly seems
superfluous).</p>
<h4 id="jsmeix_commented_at_2020-05-07_1036"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625173046">2020-05-07 10:36</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1036" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
thank you so much for your analysis what the root cause is<br />
and your explanations that correct my misunderstanding!</p>
<p>FWIW: I would have never ever guessed that UEFI vs. BIOS could<br />
make a difference what video related GRUB2 modules are there<br />
so I din't pay attention on the booting method.</p>
<h4 id="pcahyna_commented_at_2020-05-07_1047"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625178094">2020-05-07 10:47</a>:<a class="headerlink" href="#pcahyna_commented_at_2020-05-07_1047" title="Permanent link">&para;</a></h4>
<blockquote>
<p>FWIW: I would have never ever guessed that UEFI vs. BIOS could<br />
make a difference what video related GRUB2 modules are there<br />
so I din't pay attention on the booting method.</p>
</blockquote>
<p>They definitely used to be available for both, I checked RHEL 8 on UEFI
and they are there. @jhlavac do you please know why they are
disappearing?</p>
<h4 id="jsmeix_commented_at_2020-05-07_1052"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625180406">2020-05-07 10:52</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1052" title="Permanent link">&para;</a></h4>
<p>Our usual sufficiently clean way in ReaR would be<br />
to have the list of enforced loaded GRUB2 modules<br />
in a user config variable which we have already<br />
as <code>GRUB2_MODULES_LOAD</code>.</p>
<p>So instead of hardcoded values in the scripts we have to set the<br />
default list of enforced loaded GRUB2 modules in default.conf<br />
so the user knows about it and can adapt it if needed.</p>
<p>We have way too many hardcoded values in our scripts<br />
that lead to a "works magically right in most cases" behaviour<br />
which leads to weird errors that our users do not understand which<br />
further leads to issue reports here that are hard to debug for us<br />
because at least one of us (I myself) does not understand it ;-)</p>
<p>Imagine what @shaunsJM may have reported to us<br />
if "rear mkbackup/mkrescue" would have failed for him<br />
with a helpful error message like</p>
<pre><code>Required GRUB2 modules 'video_bochs video_cirrus' not found in '/boot/grub/x86_64-efi/'
</code></pre>
<h4 id="jsmeix_commented_at_2020-05-07_1407"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625277576">2020-05-07 14:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1407" title="Permanent link">&para;</a></h4>
<p>What GRUB2 <code>video</code> modules SUSE provides for SLES15-SP1<br />
for <code>i386-pc</code></p>
<pre><code># rpm -qlp grub2-i386-pc-2.02-24.12.noarch.rpm | grep video

/usr/share/grub2/i386-pc/all_video.mod
/usr/share/grub2/i386-pc/all_video.module
/usr/share/grub2/i386-pc/video.lst
/usr/share/grub2/i386-pc/video.mod
/usr/share/grub2/i386-pc/video.module
/usr/share/grub2/i386-pc/video_bochs.mod
/usr/share/grub2/i386-pc/video_bochs.module
/usr/share/grub2/i386-pc/video_cirrus.mod
/usr/share/grub2/i386-pc/video_cirrus.module
/usr/share/grub2/i386-pc/video_colors.mod
/usr/share/grub2/i386-pc/video_colors.module
/usr/share/grub2/i386-pc/video_fb.mod
/usr/share/grub2/i386-pc/video_fb.module
/usr/share/grub2/i386-pc/videoinfo.mod
/usr/share/grub2/i386-pc/videoinfo.module
/usr/share/grub2/i386-pc/videotest.mod
/usr/share/grub2/i386-pc/videotest.module
/usr/share/grub2/i386-pc/videotest_checksum.mod
/usr/share/grub2/i386-pc/videotest_checksum.module
</code></pre>
<p>versus for <code>x86_64-efi</code></p>
<pre><code># rpm -qlp grub2-x86_64-efi-2.02-24.12.noarch.rpm | grep video
/usr/share/grub2/x86_64-efi/all_video.mod
/usr/share/grub2/x86_64-efi/all_video.module
/usr/share/grub2/x86_64-efi/fixvideo.mod
/usr/share/grub2/x86_64-efi/fixvideo.module
/usr/share/grub2/x86_64-efi/video.lst
/usr/share/grub2/x86_64-efi/video.mod
/usr/share/grub2/x86_64-efi/video.module
/usr/share/grub2/x86_64-efi/video_colors.mod
/usr/share/grub2/x86_64-efi/video_colors.module
/usr/share/grub2/x86_64-efi/video_fb.mod
/usr/share/grub2/x86_64-efi/video_fb.module
/usr/share/grub2/x86_64-efi/videoinfo.mod
/usr/share/grub2/x86_64-efi/videoinfo.module
/usr/share/grub2/x86_64-efi/videotest.mod
/usr/share/grub2/x86_64-efi/videotest.module
/usr/share/grub2/x86_64-efi/videotest_checksum.mod
/usr/share/grub2/x86_64-efi/videotest_checksum.module
</code></pre>
<h4 id="jsmeix_commented_at_2020-05-07_1425"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625288044">2020-05-07 14:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1425" title="Permanent link">&para;</a></h4>
<p>What GRUB2 modules that are enforced loaded<br />
by the <code>create_grub2_cfg</code> function<br />
in usr/share/rear/lib/bootloader-functions.sh</p>
<pre><code># grep '^insmod ' usr/share/rear/lib/bootloader-functions.sh

insmod efi_gop
insmod efi_uga
insmod video_bochs
insmod video_cirrus
insmod all_video
insmod gzio
insmod part_gpt
insmod ext2
</code></pre>
<p>do exist or are missing in the SLE15-SP1 RPM<br />
for <code>i386-pc</code></p>
<pre><code>found all_video in grub2-i386-pc-2.02-24.12.noarch.rpm
found ext2 in grub2-i386-pc-2.02-24.12.noarch.rpm
found gzio in grub2-i386-pc-2.02-24.12.noarch.rpm
found part_gpt in grub2-i386-pc-2.02-24.12.noarch.rpm
found video_bochs in grub2-i386-pc-2.02-24.12.noarch.rpm
found video_cirrus in grub2-i386-pc-2.02-24.12.noarch.rpm
missing efi_gop in grub2-i386-pc-2.02-24.12.noarch.rpm
missing efi_uga in grub2-i386-pc-2.02-24.12.noarch.rpm
</code></pre>
<p>versus for <code>x86_64-efi</code></p>
<pre><code>found all_video in grub2-x86_64-efi-2.02-24.12.noarch.rpm
found efi_gop in grub2-x86_64-efi-2.02-24.12.noarch.rpm
found efi_uga in grub2-x86_64-efi-2.02-24.12.noarch.rpm
found ext2 in grub2-x86_64-efi-2.02-24.12.noarch.rpm
found gzio in grub2-x86_64-efi-2.02-24.12.noarch.rpm
found part_gpt in grub2-x86_64-efi-2.02-24.12.noarch.rpm
missing video_bochs in grub2-x86_64-efi-2.02-24.12.noarch.rpm
missing video_cirrus in grub2-x86_64-efi-2.02-24.12.noarch.rpm
</code></pre>
<p>The</p>
<pre><code>missing efi_gop in grub2-i386-pc-2.02-24.12.noarch.rpm
missing efi_uga in grub2-i386-pc-2.02-24.12.noarch.rpm
</code></pre>
<p>are false positives because GRUB2 is used as bootloader<br />
for the ReaR recovery system only in case of UEFI.</p>
<p>So the only actually missing GRUB2 modules are</p>
<pre><code>missing video_bochs in grub2-x86_64-efi-2.02-24.12.noarch.rpm
missing video_cirrus in grub2-x86_64-efi-2.02-24.12.noarch.rpm
</code></pre>
<p>which should therefore not be enforced loaded<br />
by the <code>create_grub2_cfg</code> function<br />
in usr/share/rear/lib/bootloader-functions.sh</p>
<h4 id="jsmeix_commented_at_2020-05-07_1443"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625298430">2020-05-07 14:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-07_1443" title="Permanent link">&para;</a></h4>
<p>I submitted
<a href="https://github.com/rear/rear/pull/2390">https://github.com/rear/rear/pull/2390</a><br />
that should fix this particular issue.</p>
<p>It does not implement a generic enhancement to make the code<br />
that does "GRUB2 install as bootloader for the recovery system"<br />
behave more fail-safe.</p>
<h4 id="jsmeix_commented_at_2020-05-08_1002"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625741278">2020-05-08 10:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1002" title="Permanent link">&para;</a></h4>
<p>What GRUB2 video modules SUSE provides for SLES12-SP5<br />
for i386-pc in grub2-i386-pc-2.02-12.15.1.x86_64.rpm</p>
<pre><code>/usr/lib/grub2/i386-pc/all_video.mod
/usr/lib/grub2/i386-pc/all_video.module
/usr/lib/grub2/i386-pc/video.lst
/usr/lib/grub2/i386-pc/video.mod
/usr/lib/grub2/i386-pc/video.module
/usr/lib/grub2/i386-pc/video_bochs.mod
/usr/lib/grub2/i386-pc/video_bochs.module
/usr/lib/grub2/i386-pc/video_cirrus.mod
/usr/lib/grub2/i386-pc/video_cirrus.module
/usr/lib/grub2/i386-pc/video_colors.mod
/usr/lib/grub2/i386-pc/video_colors.module
/usr/lib/grub2/i386-pc/video_fb.mod
/usr/lib/grub2/i386-pc/video_fb.module
/usr/lib/grub2/i386-pc/videoinfo.mod
/usr/lib/grub2/i386-pc/videoinfo.module
/usr/lib/grub2/i386-pc/videotest.mod
/usr/lib/grub2/i386-pc/videotest.module
/usr/lib/grub2/i386-pc/videotest_checksum.mod
/usr/lib/grub2/i386-pc/videotest_checksum.module
</code></pre>
<p>versus for x86_64-efi in grub2-x86_64-efi-2.02-12.15.1.x86_64.rpm</p>
<pre><code>/usr/lib/grub2/x86_64-efi/all_video.mod
/usr/lib/grub2/x86_64-efi/all_video.module
/usr/lib/grub2/x86_64-efi/fixvideo.mod
/usr/lib/grub2/x86_64-efi/fixvideo.module
/usr/lib/grub2/x86_64-efi/video.lst
/usr/lib/grub2/x86_64-efi/video.mod
/usr/lib/grub2/x86_64-efi/video.module
/usr/lib/grub2/x86_64-efi/video_colors.mod
/usr/lib/grub2/x86_64-efi/video_colors.module
/usr/lib/grub2/x86_64-efi/video_fb.mod
/usr/lib/grub2/x86_64-efi/video_fb.module
/usr/lib/grub2/x86_64-efi/videoinfo.mod
/usr/lib/grub2/x86_64-efi/videoinfo.module
/usr/lib/grub2/x86_64-efi/videotest.mod
/usr/lib/grub2/x86_64-efi/videotest.module
/usr/lib/grub2/x86_64-efi/videotest_checksum.mod
/usr/lib/grub2/x86_64-efi/videotest_checksum.module
</code></pre>
<p>so there is an <code>all_video</code> GRUB2 module also for SLES12-SP5.</p>
<h4 id="jsmeix_commented_at_2020-05-08_1006"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625742886">2020-05-08 10:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1006" title="Permanent link">&para;</a></h4>
<p>What GRUB2 video modules SUSE provides for SLES11-SP4<br />
for x86_64-efi in grub2-x86_64-efi-2.00-0.50.34.x86_64.rpm</p>
<pre><code>/usr/lib/grub2/x86_64-efi/all_video.mod
/usr/lib/grub2/x86_64-efi/all_video.module
/usr/lib/grub2/x86_64-efi/fixvideo.mod
/usr/lib/grub2/x86_64-efi/fixvideo.module
/usr/lib/grub2/x86_64-efi/video.lst
/usr/lib/grub2/x86_64-efi/video.mod
/usr/lib/grub2/x86_64-efi/video.module
/usr/lib/grub2/x86_64-efi/video_bochs.mod
/usr/lib/grub2/x86_64-efi/video_bochs.module
/usr/lib/grub2/x86_64-efi/video_cirrus.mod
/usr/lib/grub2/x86_64-efi/video_cirrus.module
/usr/lib/grub2/x86_64-efi/video_fb.mod
/usr/lib/grub2/x86_64-efi/video_fb.module
/usr/lib/grub2/x86_64-efi/videoinfo.mod
/usr/lib/grub2/x86_64-efi/videoinfo.module
/usr/lib/grub2/x86_64-efi/videotest.mod
/usr/lib/grub2/x86_64-efi/videotest.module
</code></pre>
<p>so there is an <code>all_video</code> GRUB2 module also for SLES11-SP4.</p>
<p>As fas as I see for SLES11-SP4 there is no <code>grub2-i386-pc</code> RPM<br />
with GRUB2 modules.</p>
<h4 id="jsmeix_commented_at_2020-05-08_1031"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625751709">2020-05-08 10:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1031" title="Permanent link">&para;</a></h4>
<p>What GRUB2 <code>efi_</code> modules SUSE provides in grub2-x86_64-efi-*.rpm<br />
for SLES15-SP1</p>
<pre><code>/usr/share/grub2/x86_64-efi/efi_gop.mod
/usr/share/grub2/x86_64-efi/efi_gop.module
/usr/share/grub2/x86_64-efi/efi_netfs.mod
/usr/share/grub2/x86_64-efi/efi_netfs.module
/usr/share/grub2/x86_64-efi/efi_uga.mod
/usr/share/grub2/x86_64-efi/efi_uga.module
</code></pre>
<p>for SLES12-SP5</p>
<pre><code>/usr/lib/grub2/x86_64-efi/efi_gop.mod
/usr/lib/grub2/x86_64-efi/efi_gop.module
/usr/lib/grub2/x86_64-efi/efi_netfs.mod
/usr/lib/grub2/x86_64-efi/efi_netfs.module
/usr/lib/grub2/x86_64-efi/efi_uga.mod
/usr/lib/grub2/x86_64-efi/efi_uga.module
</code></pre>
<p>for SLES11-SP4</p>
<pre><code>/usr/lib/grub2/x86_64-efi/efi_gop.mod
/usr/lib/grub2/x86_64-efi/efi_gop.module
/usr/lib/grub2/x86_64-efi/efi_uga.mod
/usr/lib/grub2/x86_64-efi/efi_uga.module
</code></pre>
<p>so <code>efi_gop</code> and <code>efi_uga</code> are always there.</p>
<h4 id="jsmeix_commented_at_2020-05-08_1034"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625752647">2020-05-08 10:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1034" title="Permanent link">&para;</a></h4>
<p>Summary:<br />
For SLES15-SP1, SLES12-SP5, and SLES11-SP4<br />
the GRUB2 modules <code>all_video</code> <code>efi_gop</code> and <code>efi_uga</code><br />
are always there.</p>
<h4 id="jsmeix_commented_at_2020-05-08_1242"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625797027">2020-05-08 12:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1242" title="Permanent link">&para;</a></h4>
<p>For the cleanup and enhancement part I made this new issue<br />
<a href="https://github.com/rear/rear/issues/2391">https://github.com/rear/rear/issues/2391</a></p>
<h4 id="jsmeix_commented_at_2020-05-08_1421"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-625839329">2020-05-08 14:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-08_1421" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2390">https://github.com/rear/rear/pull/2390</a>
merged<br />
this particular issue should be sufficiently avoided for now<br />
so that this issue can be closed.</p>
<p>Futher cleanup and enhancements should happen via<br />
<a href="https://github.com/rear/rear/issues/2391">https://github.com/rear/rear/issues/2391</a></p>
<h4 id="jsmeix_commented_at_2020-05-13_1439"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-628035191">2020-05-13 14:39</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-13_1439" title="Permanent link">&para;</a></h4>
<p>For documentation regarding what GRUB2 <code>moddep.lst</code><br />
contains for <code>all_video:</code> in SUSE GRUB2 RPMS, cf.<br />
<a href="https://github.com/rear/rear/pull/2390#discussion_r422352690">https://github.com/rear/rear/pull/2390#discussion_r422352690</a></p>
<p>For SLE11-SP4 in grub2-x86_64-efi-2.00-0.50.34.x86_64.rpm<br />
/usr/lib/grub2/x86_64-efi/moddep.lst contains</p>
<pre><code>all_video: efi_gop efi_uga video_bochs video_cirrus
</code></pre>
<p>For SLE12-SP5 in grub2-x86_64-efi-2.02-12.15.1.x86_64.rpm<br />
/usr/lib/grub2/x86_64-efi/moddep.lst contains</p>
<pre><code>all_video: efi_gop efi_uga
</code></pre>
<p>For SLE15-SP1 grub2-x86_64-efi-2.02-24.12.noarch.rpm<br />
/usr/share/grub2/x86_64-efi/moddep.lst contains</p>
<pre><code>all_video: efi_gop efi_uga
</code></pre>
<p>So for SLES15-SP1, SLES12-SP5, and SLES11-SP4<br />
loading the GRUB2 module <code>all_video</code> is sufficient, cf.<br />
<a href="https://github.com/rear/rear/pull/2390#discussion_r421802979">https://github.com/rear/rear/pull/2390#discussion_r421802979</a></p>
<h4 id="jsmeix_commented_at_2020-05-13_1447"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2388#issuecomment-628040753">2020-05-13 14:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-13_1447" title="Permanent link">&para;</a></h4>
<p>Also the GRUB2 modules efi_gop and efi_uga are no longer loaded via<br />
<a href="https://github.com/rear/rear/commit/2470edf534bc836a3f13d8c48e3007a24bb63bf4">https://github.com/rear/rear/commit/2470edf534bc836a3f13d8c48e3007a24bb63bf4</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-06.2388.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
