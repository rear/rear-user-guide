<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#862 Issue closed: remove needless bash from chroot calls (simplification avoids initramfs isn't recreated during recovery) - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#862 Issue closed: remove needless bash from chroot calls (simplification avoids initramfs isn\u0027t recreated during recovery)";
        var mkdocs_page_input_path = "issues/2016-06-03.862.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#862 Issue closed: remove needless bash from chroot calls (simplification avoids initramfs isn't recreated during recovery)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="862_issue_closed_remove_needless_bash_from_chroot_calls_simplification_avoids_initramfs_isnt_recreated_during_recovery"><a href="https://github.com/rear/rear/issues/862">#862 Issue</a> <code>closed</code>: remove needless bash from chroot calls (simplification avoids initramfs isn't recreated during recovery)<a class="headerlink" href="#862_issue_closed_remove_needless_bash_from_chroot_calls_simplification_avoids_initramfs_isnt_recreated_during_recovery" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>cleanup</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="wsaibot_opened_issue_at_2016-06-03_2032"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> opened issue at <a href="https://github.com/rear/rear/issues/862">2016-06-03 20:32</a>:<a class="headerlink" href="#wsaibot_opened_issue_at_2016-06-03_2032" title="Permanent link">&para;</a></h4>
<ul>
<li>rear version :1.17.2</li>
<li>OS version: RHEL 7.2</li>
<li>After doing a "rear recover" from a rear-ISO initrd isn't recreated
    with needed storage driver. I can see the following problem in
    script "finalize/Fedora/i386/17_rebuild_initramfs.sh"</li>
</ul>
<p>++ chroot /mnt/local /bin/bash --login -c 'mkinitrd -v -f
--with=crc32c-intel --with=crct10dif-pclmul --with=crct10dif_common
--with=crct10dif_generic --with=ahci --with=ata_generic
--with=ata_piix --with=libahci --with=libata --with=pata_acpi
--with=floppy --with=virtio_blk --with=cdrom --with=virtio_console
--with=iscsi_ibft --with=cirrus --with=drm --with=drm_kms_helper
--with=ttm --with=i2c-core --with=serio_raw --with=dm-log
--with=dm-mirror --with=dm-mod --with=dm-region-hash --with=e1000
--with=8139cp --with=mii --with=virtio_net --with=iscsi_boot_sysfs
--with=sd_mod --with=sr_mod --with=virtio_scsi --with=syscopyarea
--with=sysfillrect --with=sysimgblt --with=virtio --with=virtio_pci
--with=virtio_ring --with=xfs --with=crc-t10dif --with=libcrc32c
--with=garp --with=mrp --with=stp --with=8021q --with=llc --with=sg
--with=vmw_pvscsi /boot/initramfs-3.10.0-229.7.2.el7.x86_64.img
3.10.0-229.7.2.el7.x86_64'<br />
fork: No such file or directory<br />
++ LogPrint 'WARNING !!!<br />
initramfs creation for Kernel 3.10.0-229.7.2.el7.x86_64 failed, please
check '''/var/log/rear/rear-server.log''' to see the error<br />
messages in detail and decide yourself, wether the system will boot or
not.<br />
'</p>
<ul>
<li>Work-around, if any: change chroot command to (for latest kernel):
    chroot /mnt/local/ /usr/bin/dracut --force<br />
    @</li>
</ul>
<h4 id="gdha_commented_at_2016-06-07_1225"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-224264528">2016-06-07 12:25</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-07_1225" title="Permanent link">&para;</a></h4>
<p>@Wsaibot Are you trying to explain that <code>mkinird</code> fails and <code>dracut</code>
should be used instead for RHEL 7.2?<br />
The man page tells me: mkinitrd - is a compat wrapper, which calls
dracut to generate an initramfs.</p>
<p>Could it be that one of the modules was not present (seems a very long
list to me)?</p>
<h4 id="wsaibot_commented_at_2016-06-07_1551"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-224324909">2016-06-07 15:51</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-06-07_1551" title="Permanent link">&para;</a></h4>
<p>@gdha You are correct about the man page. I tried a little bit more deep
analysing the problem. As you can see above, the
<code>chroot /mnt/local /bin/bash --login -c ...</code> command gives the
error:<code>fork: No such file or directory</code>. I found out, that has nothing
todo with the mkinit-command. I did the commands manually from the
revocery-ISO and the issue is:</p>
<ul>
<li><code>chroot /mnt/local</code> is working, I get a chroot-environment</li>
<li><code>chroot /mnt/local /bin/bash</code> is working, I get a chroot-environment</li>
<li><code>chroot /mnt/local /bin/bash --login</code> is not working, I get error
    "fork: No such file or directory"</li>
</ul>
<p>I tried then this:</p>
<ul>
<li>chroot /mnt/local mkinitrd -v -f --with=crc32c-intel
    --with=crct10dif-pclmul --with=crct10dif_common
    --with=crct10dif_generic --with=ahci --with=ata_generic
    --with=ata_piix --with=libahci --with=libata --with=pata_acpi
    --with=floppy --with=virtio_blk --with=cdrom --with=virtio_console
    --with=iscsi_ibft --with=cirrus --with=drm --with=drm_kms_helper
    --with=ttm --with=i2c-core --with=serio_raw --with=dm-log
    --with=dm-mirror --with=dm-mod --with=dm-region-hash --with=e1000
    --with=8139cp --with=mii --with=virtio_net
    --with=iscsi_boot_sysfs --with=sd_mod --with=sr_mod
    --with=virtio_scsi --with=syscopyarea --with=sysfillrect
    --with=sysimgblt --with=virtio --with=virtio_pci
    --with=virtio_ring --with=xfs --with=crc-t10dif --with=libcrc32c
    --with=garp --with=mrp --with=stp --with=8021q --with=llc --with=sg
    --with=vmw_pvscsi /boot/initramfs-3.10.0-229.7.2.el7.x86_64.img
    3.10.0-229.7.2.el7.x86_64</li>
</ul>
<p>This command is working fine. Also later in the automatic recovery
process the creation of grub2 is working. There is also a <code>chroot</code>
command without the part "<code>/bin/bash --login -c</code>".</p>
<p>Can you verify this issue?</p>
<h4 id="gdha_commented_at_2016-06-07_1732"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-224354694">2016-06-07 17:32</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-07_1732" title="Permanent link">&para;</a></h4>
<p>@Wsaibot Thank you for the detailed analysis! I'll verify it tomorrow.</p>
<h4 id="wsaibot_commented_at_2016-06-10_1417"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225193981">2016-06-10 14:17</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-06-10_1417" title="Permanent link">&para;</a></h4>
<p>@gdha: I did some more testing. In my environment I get the same failure
in RHEL6. After that, I thought it couldn't be a rear problem and I have
80% right ,-).</p>
<p>We have an entry in .bash_profile called "exec /usr/bin/rootsh". When I
remove this entry, mkinitrd works fine. Later in the rear recover
process, the chroot command for grub also don't uses the "/bin/bash
--loging -c" part. Do you know, why this is used for the mkinitrd
command? For minimize .bash_profile problems for a login shell, it
would be good, to change the chroot-command as I posted before (chroot
/mnt/local mkinitrd -v -f --with...). This is also working for
RHEL6/RHEL7 and would be more like also the grub-command.</p>
<h4 id="gdha_commented_at_2016-06-10_1431"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225197934">2016-06-10 14:31</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-10_1431" title="Permanent link">&para;</a></h4>
<p>@jsmeix could you verify if the behavior on SLES is the same?</p>
<h4 id="gdha_commented_at_2016-06-10_1433"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225198506">2016-06-10 14:33</a>:<a class="headerlink" href="#gdha_commented_at_2016-06-10_1433" title="Permanent link">&para;</a></h4>
<p>@Wsaibot if you add the <code>usr/bin/rootsh</code> script to the <code>COPY_AS_IS</code>
array then your problem should be fixed I hope</p>
<h4 id="wsaibot_commented_at_2016-06-10_1629"><img src="https://avatars.githubusercontent.com/u/19737030?v=4" width="50"><a href="https://github.com/Wsaibot">Wsaibot</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225230810">2016-06-10 16:29</a>:<a class="headerlink" href="#wsaibot_commented_at_2016-06-10_1629" title="Permanent link">&para;</a></h4>
<p>@gdha the <code>/usr/bin/rootsh</code> is an the server, which is backuped and
restored (in the chroot-environment). <code>COPY_AS_IS</code> would copy the file
to the recovery media. So the tool is on the place, the .bash_profile
(on server, not revocery media) needs it. I think, that the rootsh has a
problem, running in a chroot. So it's a problem from the tool.</p>
<p>For me the "only" question is, if we will change the chroot-command in
<code>finalize/Fedora/i386/17_rebuild_initramfs.sh</code> to not using a a login
shell for creating the initrd.</p>
<p>Thanks!</p>
<h4 id="jsmeix_commented_at_2016-06-13_0912"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225527901">2016-06-13 09:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-13_0912" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
regarding your
<a href="https://github.com/rear/rear/issues/862#issuecomment-225197934">https://github.com/rear/rear/issues/862#issuecomment-225197934</a><br />
(verify if the behavior on SLES is the same?):</p>
<p>On SUSE finalize/SUSE_LINUX/i386/17_rebuild_initramfs.sh is run.</p>
<p>Both in finalize/SUSE_LINUX/i386/17_rebuild_initramfs.sh<br />
and finalize/Fedora/i386/17_rebuild_initramfs.sh there is</p>
<pre>
chroot $TARGET_FS_ROOT /bin/bash --login -c "mkinitrd ...
</pre>

<p>is run.</p>
<p>In general I wonder why a login shell is needed to run in between<br />
(but I am not at all a mkinitrd expert).</p>
<p>In my personal direct install script at<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery#Generic_system_installation_with_the_plain_SUSE_installation_system">https://en.opensuse.org/SDB:Disaster_Recovery#Generic_system_installation_with_the_plain_SUSE_installation_system</a><br />
it worked for me without a shell in between:</p>
<pre>
# Mountpoint in the installation system of the target system filesystem root:
target_system_filesystem_root="/mnt"
...
# Make initrd verbosely in the target system:
if test -n "$make_initrd"
then chroot $target_system_filesystem_root /sbin/mkinitrd -v
fi
</pre>

<p>What is the reason that "mkinitrd" has to be run<br />
from a login shell?</p>
<h4 id="jsmeix_commented_at_2016-06-13_0930"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225532160">2016-06-13 09:30</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-13_0930" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
according to</p>
<pre>
$ git log -p usr/share/rear/finalize/Fedora/i386/17_rebuild_initramfs.sh
...
commit 38eaf8966850819b0acb8fd08c181a74a063793b
Author: Gratien D'haese <gratien.dhaese@gmail.com>
Date:   Wed Apr 4 16:40:06 2012 +0200
...
--- /dev/null
+++ b/usr/share/rear/finalize/Fedora/i386/17_rebuild_initramfs.sh
...
+       if chroot /mnt/local /bin/bash --login -c "mkinitrd ...
</pre>

<p>it was you who initially made the</p>
<pre>
chroot /mnt/local /bin/bash --login -c "mkinitrd ...
</pre>

<p>command with the longin shell in between.</p>
<p>Do you remember the reason why?</p>
<p>FYI:<br />
in the rear sources using</p>
<pre>
find . -name '*.sh' | xargs grep -2 ' chroot '
</pre>

<p>finds a lot of chroot with a login shell in between.</p>
<p>I wonder in general if chroot with a login shell in between<br />
is really a good idea or if perhaps keep things simpler<br />
and omit the login shell in general for chroot is better?</p>
<h4 id="jsmeix_commented_at_2016-06-13_1133"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225556483">2016-06-13 11:33</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-13_1133" title="Permanent link">&para;</a></h4>
<p>The oldest commits that contain 'chroot .*bash --login'<br />
are from @schlomo in 2009 and 2010.</p>
<p>I assume all other 'chroot .*bash --login' code<br />
is via copy and paste.</p>
<p>@schlomo<br />
do you know the reason behind why</p>
<pre>
chroot ... /bin/bash --login -c "mkinitrd ...
</pre>

<p>is used with the login shell in between<br />
instead of directly calling it via</p>
<pre>
chroot ... /sbin/mkinitrd ...
</pre>

<p>Details:</p>
<p>In the current rear sources I did</p>
<pre>
$ find . -name '*.sh' | xargs grep -l 'chroot .*bash --login'
./usr/share/rear/finalize/Debian/i386/17_rebuild_initramfs.sh
./usr/share/rear/finalize/Fedora/i386/17_rebuild_initramfs.sh
./usr/share/rear/finalize/Linux-ppc64/20_install_yaboot.sh
./usr/share/rear/finalize/Linux-ppc64/22_install_grub2.sh
./usr/share/rear/finalize/Linux-ppc64le/22_install_grub2.sh
./usr/share/rear/finalize/SUSE_LINUX/i386/17_rebuild_initramfs.sh
./usr/share/rear/finalize/SUSE_LINUX/ppc64/20_install_yaboot.sh
./usr/share/rear/finalize/default/89_finish_checks.sh
</pre>

<p>and then for each of those files I get the history using</p>
<pre>
git log -p filename
</pre>

<h4 id="jsmeix_commented_at_2016-06-13_1228"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-225567030">2016-06-13 12:28</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-06-13_1228" title="Permanent link">&para;</a></h4>
<p>I asked our (i.e. SUSE's) dracut package maintainer<br />
(our dracut package contains /sbin/mkinitrd)<br />
if he knows about a reason to run mkinitrd<br />
with a login shell in between as in</p>
<pre>
chroot ... /bin/bash --login -c "mkinitrd ...
</pre>

<p>and offhandedly he does not know a reason<br />
why there should be a login shell in between.</p>
<h4 id="gdha_commented_at_2016-12-31_1028"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-269859135">2016-12-31 10:28</a>:<a class="headerlink" href="#gdha_commented_at_2016-12-31_1028" title="Permanent link">&para;</a></h4>
<p>@jsmeix @schlomo Seems we lost track of this issue. We should pick this
one up after ReaR v2.0 release, no?</p>
<h4 id="jsmeix_commented_at_2017-01-02_0929"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-269949184">2017-01-02 09:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-02_0929" title="Permanent link">&para;</a></h4>
<p>After ReaR v2.0 release I will remove the login shell in between<br />
when it is not obviously needed.</p>
<h4 id="jsmeix_commented_at_2017-01-20_1312"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-274068914">2017-01-20 13:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-01-20_1312" title="Permanent link">&para;</a></h4>
<p>With<br />
<a href="https://github.com/rear/rear/pull/1171">https://github.com/rear/rear/pull/1171</a><br />
merged, this issue should (hopefully) be fixed.</p>
<p>FYI:<br />
It was much more complicated than I initially assumed.<br />
One cannot "simply remove" a login shell in between<br />
from a chroot call.<br />
Reason:<br />
With a login shell in between one has in the chrooted<br />
environment all the advantages of a "normal working shell"<br />
which means one can write the commands for 'chroot'<br />
as one would type them in a normal working shell.<br />
In particular one can call programs by their basename without path<br />
so that it usually "just works" independent where each particular<br />
Linux distribution installs programs as long as the program<br />
is in one of the directories in $PATH.<br />
With this experience I wonder now if it makes things really<br />
work better in 'chroot' without the login shell in between.<br />
When it does not work with a login shell in between<br />
one could also argue that then the login shell setup<br />
on that particular system is broken which is not an<br />
issue in ReaR because a login shell must "just work"<br />
so that the login shell setup must be fixed<br />
by the admin of that particular system.</p>
<h4 id="jsmeix_commented_at_2017-02-23_1616"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-282039428">2017-02-23 16:16</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-02-23_1616" title="Permanent link">&para;</a></h4>
<p>An example where a login shell in between is needed:</p>
<p>A login shell in between is needed in particular<br />
when shell scripts are called inside 'chroot'.</p>
<p>For example grub2-mkconfig is a shell script:</p>
<pre>
RESCUE e205:~ # chroot /mnt/local /bin/bash -c '/usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg'
Generating grub configuration file ...
/etc/grub.d/00_header: line 23: cut: command not found

RESCUE e205:~ # cat -n /mnt/local/etc/grub.d/00_header | grep '    23'
    23  grub_lang=`echo $LANG | cut -d . -f 1`

RESCUE e205:~ # chroot /mnt/local /bin/bash -c 'echo $LANG | cut -d . -f 1'
/bin/bash: cut: command not found

RESCUE e205:~ # chroot /mnt/local /bin/bash -c 'echo $LANG ; echo $PATH'
en_GB.iso885915
/bin

RESCUE e205:~ # chroot /mnt/local /bin/bash --login -c '/usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg'
Generating grub configuration file ...
Found theme: /boot/grub2/themes/SLE/theme.txt
Found linux image: /boot/vmlinuz-4.4.21-69-default
Found initrd image: /boot/initrd-4.4.21-69-default
done
</pre>

<h4 id="jsmeix_commented_at_2017-05-08_0758"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/862#issuecomment-299799009">2017-05-08 07:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2017-05-08_0758" title="Permanent link">&para;</a></h4>
<p>It seems using no login shell for chroot calls<br />
causes more issues that it solves, see<br />
<a href="https://github.com/rear/rear/pull/1345">https://github.com/rear/rear/pull/1345</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-06-03.862.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
