<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2794 PR closed: Clean up USB backups before creating a new one on the USB drive - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2794 PR closed: Clean up USB backups before creating a new one on the USB drive";
        var mkdocs_page_input_path = "issues/2022-04-21.2794.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2794 PR closed: Clean up USB backups before creating a new one on the USB drive</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2794_pr_closed_clean_up_usb_backups_before_creating_a_new_one_on_the_usb_drive"><a href="https://github.com/rear/rear/pull/2794">#2794 PR</a> <code>closed</code>: Clean up USB backups before creating a new one on the USB drive<a class="headerlink" href="#2794_pr_closed_clean_up_usb_backups_before_creating_a_new_one_on_the_usb_drive" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>won't fix / can't fix / obsolete</code></p>
<h4 id="ivarmu_opened_issue_at_2022-04-21_1526"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> opened issue at <a href="https://github.com/rear/rear/pull/2794">2022-04-21 15:26</a>:<a class="headerlink" href="#ivarmu_opened_issue_at_2022-04-21_1526" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Bug Fix</strong></p>
</li>
<li>
<p>Impact: <strong>High</strong></p>
</li>
<li>
<p>Reference to related issue (URL): No issue created yet</p>
</li>
<li>
<p>How was this pull request tested?: VM in a home lab</p>
</li>
<li>
<p>Brief description of the changes in this pull request: If you are
    working with an adjusted free space into your USB drive, creating
    any content prior to free space may fail, making the process to
    abort. This PR is changing the order of the cleanup, so it'll the
    first step to be executed.</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2022-04-22_0750"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2794#issuecomment-1106121781">2022-04-22 07:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_0750" title="Permanent link">&para;</a></h4>
<p>Without checking the details here<br />
I think this might cause a severe behavioural change<br />
because this pull request changes<br />
"first create new stuff, then remove old stuff"<br />
to<br />
"first remove old stuff, then create new stuff".</p>
<p>So it may happen that old stuff was already removed<br />
but then it fails to create new stuff so nothing is left.</p>
<p>I worry that with the change here one may have no backup left.</p>
<p>In general I am against functionality in ReaR that deals with backups<br />
(like USB_RETAIN_BACKUP_NR or NETFS_KEEP_OLD_BACKUP_COPY)<br />
because in general any user data is sacrosanct and<br />
in particular the user's backups are even more sacrosanct<br />
so ReaR should only call a tool to make or restore a backup<br />
but ReaR should not deal with backups.</p>
<p>Personally I would drop all functionality in ReaR that deals with
backups<br />
but I cannot do this because this would be backward incompatible<br />
so I leave such functionality as is and I try hard to not touch it.</p>
<p>See also the section<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2022-04-22_0756"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2794#issuecomment-1106128592">2022-04-22 07:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_0756" title="Permanent link">&para;</a></h4>
<p>Without checking the details here<br />
I think the current behaviour is no "bug" but intentional<br />
(but I am not at all an expert in this specific area of ReaR)<br />
while the impact of this change could be really a "high" risk.</p>
<h4 id="ivarmu_commented_at_2022-04-22_0905"><img src="https://avatars.githubusercontent.com/u/26822043?v=4" width="50"><a href="https://github.com/ivarmu">ivarmu</a> commented at <a href="https://github.com/rear/rear/pull/2794#issuecomment-1106217690">2022-04-22 09:05</a>:<a class="headerlink" href="#ivarmu_commented_at_2022-04-22_0905" title="Permanent link">&para;</a></h4>
<p>@jsmeix I agree with you, I didn't thought about loosing all the backups
in the USB drive, what can be undesirable at all... so... I'm retiring
that PR.</p>
<h4 id="jsmeix_commented_at_2022-04-22_0950"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2794#issuecomment-1106286485">2022-04-22 09:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-22_0950" title="Permanent link">&para;</a></h4>
<p>@ivarmu<br />
thank you for your prompt reply.</p>
<p>By the way:</p>
<p>I blindly guess (without checking the details here)<br />
that the current code does not sufficiently test<br />
whether or not it is actually safe to remove old stuff,<br />
cf. the section "Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>At least on first glance I don't see appropriate checks<br />
e.g. a check that tests that there actually is new stuff.<br />
On first glance it seems it works just because it keeps<br />
by default the two (by default USB_RETAIN_BACKUP_NR=2)<br />
topmost directories of the</p>
<pre><code>ls -dt $BUILD_DIR/outputfs/rear/$HOSTNAME/*
</code></pre>
<p>output regardless whether or not there is new stuff<br />
so when there is no new stuff it keeps the old stuff as is.</p>
<p>In general see the section<br />
"Relax-and-Recover versus backup and restore" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
therein in particular those excerpts</p>
<pre><code>ReaR only calls an external tool that does the backup of the files
during "rear mkbackup" ... (by default that tool is 'tar').
...
It is your task to ensure your backup is consistent ...
...
It is your task to ensure your backups are kept save
at a sufficiently secure place ...
...
There is basically nothing in ReaR that deals in any further way
with what to do with the backup
...
After a "rear mkbackup" run the user has to do on his own
whatever is appropriate in his particular environment
how to further deal with the backup
</code></pre>
<p>Bottom line:<br />
Don't blindly rely on ReaR to do "the right thing" with your backups.<br />
Better safe (your backups to a really safe place) than sorry.</p>
<p>In particular the place where ReaR writes to<br />
(e.g. a NFS share or a USB disk or anything else)<br />
is not a really safe place to keep old backups.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-04-21.2794.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
