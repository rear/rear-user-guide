<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#977 PR merged: Added PRE-POST backup scripts - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#977 PR merged: Added PRE-POST backup scripts";
        var mkdocs_page_input_path = "issues/2016-08-24.977.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#977 PR merged: Added PRE-POST backup scripts</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="977_pr_merged_added_pre-post_backup_scripts"><a href="https://github.com/rear/rear/pull/977">#977 PR</a> <code>merged</code>: Added PRE-POST backup scripts<a class="headerlink" href="#977_pr_merged_added_pre-post_backup_scripts" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="didacog_opened_issue_at_2016-08-24_1154"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> opened issue at <a href="https://github.com/rear/rear/pull/977">2016-08-24 11:54</a>:<a class="headerlink" href="#didacog_opened_issue_at_2016-08-24_1154" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>Those changes add the capacity in rear to stop/start some services or
run some required tasks previous to run backup (just like those exist
for recovery), this can be useful in some scenarios if, for example, a
small database that can be stopped and it's data will be consistent
after OS recovery without human intervention.</p>
<p>I've tested and forced error between pre and post to check correct
behaviour of Exit Tasks in case of any error during backup if, for
example, some service stopped in PRE can be started by Exit Tasks array.</p>
<p>Following changed:</p>
<p>new file: usr/share/rear/backup/default/01_pre_backup_script.sh</p>
<pre><code>if test "$PRE_BACKUP_SCRIPT" ; then
    Log "Running PRE_BACKUP_SCRIPT '${PRE_BACKUP_SCRIPT[@]}'"
    AddExitTask "${POST_BACKUP_SCRIPT[@]}"
    eval "${PRE_BACKUP_SCRIPT[@]}"
fi
</code></pre>
<p>new file: usr/share/rear/backup/default/99_post_backup_script.sh</p>
<pre><code>if test "$POST_BACKUP_SCRIPT" ; then
    Log "Running POST_BACKUP_SCRIPT '${POST_BACKUP_SCRIPT[@]}'"
    RemoveExitTask "${POST_BACKUP_SCRIPT[@]}"
    eval "${POST_BACKUP_SCRIPT[@]}"
fi
</code></pre>
<p>modified: usr/share/rear/conf/default.conf</p>
<pre><code># Call this after Relax-and-Recover finished to do anything in the mkbackup/mkbackuponly workflow.
POST_BACKUP_SCRIPT=

# Call this before Relax-and-Recover starts to do anything in the mkbackup/mkbackuponly workflow.
PRE_BACKUP_SCRIPT=
</code></pre>
<p>required configuration on /etc/rear/local.conf:</p>
<pre><code>PRE_BACKUP_SCRIPT="/path_to_scripts/pre_scr.sh"
POST_BACKUP_SCRIPT="/path_to_scripts/post_scr.sh"
</code></pre>
<p>Kind regards,</p>
<p>Didac</p>
<h4 id="jsmeix_commented_at_2016-08-24_1214"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242041391">2016-08-24 12:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-24_1214" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
I do not understand why you have the AddExitTask()<br />
and RemoveExitTask() calls, cf.<br />
"Code should be easy to understand"<br />
in
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>Such calls are not used in the implementation for<br />
PRE_RECOVERY_SCRIPT and POST_RECOVERY_SCRIPT<br />
in setup/default/01_pre_recovery_script.sh<br />
and wrapup/default/50_post_recovery_script.sh</p>
<p>In particular</p>
<pre>
if test "$PRE_BACKUP_SCRIPT" ; then
    ...
    AddExitTask "${POST_BACKUP_SCRIPT[@]}"
</pre>

<p>looks like a typo.</p>
<p>But I guess it is intentionally that POST_BACKUP_SCRIPT<br />
is added as exit task when PRE_BACKUP_SCRIPT is non-empty<br />
but I do not understand why - i.e. I do not understand how it is<br />
meant to work - i.e. why is not PRE_BACKUP_SCRIPT<br />
and POST_BACKUP_SCRIPT only called as in the<br />
implementation for PRE_RECOVERY_SCRIPT<br />
and POST_RECOVERY_SCRIPT?</p>
<h4 id="jsmeix_commented_at_2016-08-24_1217"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242042166">2016-08-24 12:17</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-24_1217" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
I assume when you add your usecase description here in your<br />
<a href="https://github.com/rear/rear/pull/977#issue-172932345">https://github.com/rear/rear/pull/977#issue-172932345</a><br />
in a bit more explanatory way to default.conf then I<br />
(and all other rear users) would understand how<br />
PRE_BACKUP_SCRIPT and POST_BACKUP_SCRIPT<br />
are meant to be used.</p>
<h4 id="didacog_commented_at_2016-08-24_1239"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242047875">2016-08-24 12:39</a>:<a class="headerlink" href="#didacog_commented_at_2016-08-24_1239" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>Is not a typo, for example:<br />
In case you are stopping a small mySQL database in order to maintain its
data consistency with rear backup, you want to re-start it again after
backup.<br />
It will be done in 99_post_backup_script.sh if all tasks between 01
and 99 of backup stage are ok, but if some error occur in the meantime,
ExitTasks will do it.</p>
<p>In case of no POST tasks, nothing will happen anyway.</p>
<p>I don't know if I explained well.</p>
<p>Regards,</p>
<h4 id="didacog_commented_at_2016-08-24_1340"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242067352">2016-08-24 13:40</a>:<a class="headerlink" href="#didacog_commented_at_2016-08-24_1340" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<p>I've updated default.conf with explanation about PRE POST backup.</p>
<p>Hope this will be ok. ;)</p>
<p>regards,</p>
<h4 id="jsmeix_commented_at_2016-08-24_1345"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242069092">2016-08-24 13:45</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-24_1345" title="Permanent link">&para;</a></h4>
<p>Hooray!<br />
Now even I understand it<br />
and - with pleasure - I can "just merge" it :-)</p>
<p>@didacog<br />
many thanks for your vaulable contribution!</p>
<h4 id="didacog_commented_at_2016-08-24_1347"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242069616">2016-08-24 13:47</a>:<a class="headerlink" href="#didacog_commented_at_2016-08-24_1347" title="Permanent link">&para;</a></h4>
<p>Cool!! thanks!!! ;)</p>
<h4 id="jsmeix_commented_at_2016-08-24_1401"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242075095">2016-08-24 14:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-24_1401" title="Permanent link">&para;</a></h4>
<p>@didacog<br />
I like all those various little helper functionality in
Relax-and-Recover<br />
very much. Usually it is not needed but when it is needed it is<br />
a priceless advantage to have them available, cf.<br />
NETWORKING_PREPARATION_COMMANDS<br />
RECOVERY_UPDATE_URL<br />
BACKUP_RESTORE_MOVE_AWAY<br />
they all do not make anything "just work out of the box"<br />
but in case of special issues they can (hopefully) help.</p>
<h4 id="jsmeix_commented_at_2016-08-24_1403"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242075826">2016-08-24 14:03</a>:<a class="headerlink" href="#jsmeix_commented_at_2016-08-24_1403" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
This one got merged into rear:dev.<br />
Now I wonder about the procedure<br />
how to decide if it also gets merged into rear:master and<br />
if yes, how to actually get it merged into rear:master?</p>
<h4 id="gdha_commented_at_2016-08-24_1508"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242098435">2016-08-24 15:08</a>:<a class="headerlink" href="#gdha_commented_at_2016-08-24_1508" title="Permanent link">&para;</a></h4>
<p>@didacog @jsmeix @schlomo Pull requests who made it in the <strong>dev</strong>
branch should first go through a QA test before we allow it in the
<strong>master</strong> branch. That is the idea behind it. I do not want to cripple
a release with untested commits.Otherwise, we will never come to a
stable release IMHO. If it doesn't make it for this release it will be
for another. However, do not yet panic.<br />
I'm trying to setup an automatic testing bed for rear (but it will take
time)</p>
<h4 id="didacog_commented_at_2016-08-24_1531"><img src="https://avatars.githubusercontent.com/u/5380209?u=163f1571e6b9c9c7df94e2c6ca152b0a7406b52d&v=4" width="50"><a href="https://github.com/didacog">didacog</a> commented at <a href="https://github.com/rear/rear/pull/977#issuecomment-242107906">2016-08-24 15:31</a>:<a class="headerlink" href="#didacog_commented_at_2016-08-24_1531" title="Permanent link">&para;</a></h4>
<p>@gdha sounds good for me. We are working in that way in DRLM also.</p>
<p>We use git-flow to manage: release tagging, hotfixes and features on
branches from dev until merged to master.</p>
<p>If we can help in some way we'll be pleased to do It.</p>
<p>Regards,</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2016-08-24.977.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
