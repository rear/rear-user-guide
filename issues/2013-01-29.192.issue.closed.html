<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#192 Issue closed: BACKUP=DP OUTPUT=PXE: PXE files are not copied to OUTPUT_URL - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#192 Issue closed: BACKUP=DP OUTPUT=PXE: PXE files are not copied to OUTPUT_URL";
        var mkdocs_page_input_path = "issues/2013-01-29.192.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#192 Issue closed: BACKUP=DP OUTPUT=PXE: PXE files are not copied to OUTPUT_URL</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="192_issue_closed_backupdp_outputpxe_pxe_files_are_not_copied_to_output_url"><a href="https://github.com/rear/rear/issues/192">#192 Issue</a> <code>closed</code>: BACKUP=DP OUTPUT=PXE: PXE files are not copied to OUTPUT_URL<a class="headerlink" href="#192_issue_closed_backupdp_outputpxe_pxe_files_are_not_copied_to_output_url" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>discuss / RFC</code></p>
<h4 id="pavoldomin_opened_issue_at_2013-01-29_1014"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> opened issue at <a href="https://github.com/rear/rear/issues/192">2013-01-29 10:14</a>:<a class="headerlink" href="#pavoldomin_opened_issue_at_2013-01-29_1014" title="Permanent link">&para;</a></h4>
<p>Hello,</p>
<p>my config sets OUTPUT=PXE and BACKUP=DP.<br />
PXE files (kernel, initrd, menu, message, MAC links) are placed to
/var/lib/rear/output, but not to a location defined by OUTPUT_URL.</p>
<h4 id="gdha_commented_at_2013-01-29_1526"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-12839746">2013-01-29 15:26</a>:<a class="headerlink" href="#gdha_commented_at_2013-01-29_1526" title="Permanent link">&para;</a></h4>
<p>I guess the problem is with the
<code>output/ISO/Linux-i386/90_transfer_image.sh</code> script where the
OUTPUT_URL is used to transfer the image (that's good), but we seem to
assume that the destination path exists (if we use BACKUP=NETFS scheme
then it is normally the case), but in case we use another BACKUP scheme
such as RBME or DP (or another external backup program) then we might
run into problems such as following error (non-fatal for rear?) saying
<code>cp: cannot create regular file /tmp/rear.XXX/outputfs/hostname: not a directory</code></p>
<h4 id="pavoldomin_commented_at_2013-01-29_1902"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-12851419">2013-01-29 19:02</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-01-29_1902" title="Permanent link">&para;</a></h4>
<p>This is indeed the case if BACKUP=DP, OUTPUT=ISO and there is no
${NETFS_PREFIX} directory under OUTPUT_URL ( part of log file:
<a href="https://gist.github.com/adbaca2ba03c4f9ae85e">https://gist.github.com/adbaca2ba03c4f9ae85e</a>
)</p>
<p>However, with the BACKUP=DP, OUTPUT=PXE, no routine tries to copy PXE
files to OUTPUT_URL at all.</p>
<p>With BACKUP=NETFS, OUTPUT_URL is honored with OUTPUT=PXE as well as
OUTPUT=ISO, controlled by output/NETFS/default/20_make_prefix_dir.sh
and output/NETFS/default/95_copy_result_files.sh</p>
<p>It would be more consistent, if OUTPUT_URL is honored same way,
regardless the BACKUP method used.</p>
<p>This seem to me now more enhancement request, than bug :)</p>
<p>Another possibility is to extend PXE_TFTP_PATH and PXE_CONFIG_PATH
to support url: I opened another issue #193</p>
<h4 id="pavoldomin_commented_at_2013-01-31_0920"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-12933925">2013-01-31 09:20</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-01-31_0920" title="Permanent link">&para;</a></h4>
<p>In order to be more constructive, i tried to patch the rear in order to
separate backup url and output url handling, for your consideration.</p>
<p>I introduced OUTPUT_PREFIX variable and cloned output_path function to
backup_path function.<br />
I removed output handling functions from NETFS output stage and moved to
default output stage.</p>
<p>Tested yet only with rear mkbackup, rear recover testing in progress.</p>
<p>Of course, the change is not only cosmetic and patch may break something
i have not considered; please just throw it away, if its non-sense ;)</p>
<p><a href="https://gist.github.com/82017c57797357fc2e35">https://gist.github.com/82017c57797357fc2e35</a></p>
<h4 id="gdha_commented_at_2013-02-01_0956"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-12987578">2013-02-01 09:56</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-01_0956" title="Permanent link">&para;</a></h4>
<p>@pavoldomin very interesting patch. Idea is good, but not sure if it is
bulletproof?? The <code>OUTPUT_PREFIX</code> variable is a good idea. Perhaps, we
should align this towards an <code>BACKUP_PREFIX</code> variable too? In general we
can just copy <code>NETFS_PREFIX</code> to <code>BACKUP_PREFIX</code>, but I think it is
better we make parallel ways (which are quite similar in naming
convention).<br />
Are you sure you didn't mix up <code>bpath</code> with <code>opath</code> in all cases? Please
do enough tests to be sure the paths can be different in all aspects.
Great job - I wish we got more of these inputs.<br />
When you proof that it works all the way why don't you make a "pull
request" for it?</p>
<h4 id="pavoldomin_commented_at_2013-02-05_0915"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-13120792">2013-02-05 09:15</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-02-05_0915" title="Permanent link">&para;</a></h4>
<p>Sorry for my slow latency; I have successfully tested on some setups
(ISO output and NETFS &amp; DP backup, old DL proliant with the OS on cciss
logical drives). We still need to test on another configurations.</p>
<p>Few more thoughts (I am not able to test these targets, so I'm not
providing patch)</p>
<ul>
<li>
<p>Perhaps it would make sense removing also output scripts for RSYNC?</p>
<pre><code>--- a/usr/share/rear/output/RSYNC/default/20_make_prefix_dir.sh
+++ /dev/null
</code></pre>
<p>and</p>
<pre><code>--- a/usr/share/rear/output/RSYNC/default/90_copy_result_files.sh
+++ /dev/null
</code></pre>
</li>
<li>
<p>Not quite sure, but i believe also part of
    <code>output/RAMDISK/Linux-i386/90_copy_ramdisk.sh</code> may now be cut below
    <code>RESULT_FILES=</code> block.</p>
</li>
<li>
<p>implement <code>OUTPUT_PREFIX</code> also for
    <code>fish|ftp|ftps|hftp|http|https|sftp|rsync</code> (it would however break
    target path for existing configurations)</p>
</li>
<li>
<p><code>NETFS_PREFIX</code> &lt;=&gt; <code>BACKUP_PREFIX</code> and implement also for
    <code>fish|ftp|ftps|hftp|http|https|sftp|rsync</code></p>
</li>
<li>
<p>But - as it can change behavior of existing configurations
    (<code>${RESULT_FILES[@]}</code> might be uploaded to different place) - it
    requires a discussion.</p>
</li>
</ul>
<h4 id="gdha_commented_at_2013-02-06_1521"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-13186763">2013-02-06 15:21</a>:<a class="headerlink" href="#gdha_commented_at_2013-02-06_1521" title="Permanent link">&para;</a></h4>
<p>I will check the RSYNC workflow...<br />
@dagwieers can you comment on the <code>OUTPUT_PREFIX</code> for
<code>fish|ftp|ftps|hftp|http|https|sftp|rsync</code> ?<br />
@jhoekx can you comment on
<code>output/RAMDISK/Linux-i386/90_copy_ramdisk.sh</code> ?</p>
<p>Indeed serious testing is still required.</p>
<h4 id="pavoldomin_commented_at_2013-02-07_2117"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-13260207">2013-02-07 21:17</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-02-07_2117" title="Permanent link">&para;</a></h4>
<p>Hi,</p>
<p>I have now tested this commit in the complete disaster recovery
scenarios, at various combinations of <code>BACKUP=DP</code>, <code>BACKUP=NETFS</code>, and
<code>OUTPUT=ISO</code>, <code>OUTPUT=PXE</code>, on couple of our enterprise linux setups,
SAN or cciss/hpsa logical drive booting. Works just fine. Also fiddled
with the <code>KEEP_OLD_NETFS_COPY/KEEP_OLD_OUTPUT_COPY</code> options.</p>
<p>Also managed to try <code>BACKUP=RSYNC</code> with the <code>BACKUP_URL=ssh://...</code>, no
problem. I just could not get working <code>OUTPUT_URL=rsync://...</code> - because
I got no rsync server running on other site - and it cannot be told to
use ssh connection at the moment.<br />
<em>Update</em>: just realized that this is already fixed by
a1ff4a89f61bfa6e1ef188b6408d3f48245f0152</p>
<h4 id="pavoldomin_commented_at_2013-05-16_1939"><img src="https://avatars.githubusercontent.com/u/1576908?v=4" width="50"><a href="https://github.com/pavoldomin">pavoldomin</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-18024136">2013-05-16 19:39</a>:<a class="headerlink" href="#pavoldomin_commented_at_2013-05-16_1939" title="Permanent link">&para;</a></h4>
<p>We detected minor bug introduced with the patch.<br />
If <code>OUTPUT_URL</code> is the same as <code>BACKUP_URL</code> and in the same time we
enable <code>KEEP_OLD_NETFS_COPY</code>, than resulting output files (pxe or iso
image) are moved to <code>.old</code> backup dir. I believe this happens in both
<code>mkbackup</code> and <code>mkbackuponly</code> modes.</p>
<p>This is because of the flaw</p>
<pre><code>Using log file: /var/log/rear/rear-srv.log
Simulation mode activated, Relax-and-Recover base directory: /usr/share/rear
…
Source output/default/15_save_copy_of_prefix_dir.sh
…
Source output/default/95_copy_result_files.sh
…
Source backup/NETFS/default/15_save_copy_of_prefix_dir.sh
…
Source backup/NETFS/default/50_make_backup.sh
…
</code></pre>
<p>i.e. the prefix dir is copied in the backup phase, after the output
result files are stored there in output phase.<br />
The solution I can think of, would be either to place both
<code>15_save_copy_of_prefix_dir.sh</code> scripts before backup and output are
sourced, or call <code>cp -a</code> instead of <code>mv</code> inside.</p>
<p>What do you think?</p>
<h4 id="gdha_commented_at_2013-07-03_1143"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-20410089">2013-07-03 11:43</a>:<a class="headerlink" href="#gdha_commented_at_2013-07-03_1143" title="Permanent link">&para;</a></h4>
<p>@pavoldomin I think as we have 2 variables now <code>KEEP_OLD_OUTPUT_COPY</code>
and <code>NETFS_KEEP_OLD_BACKUP_COPY</code> we can close this issue?</p>
<h4 id="gdha_commented_at_2013-09-03_1108"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/192#issuecomment-23704405">2013-09-03 11:08</a>:<a class="headerlink" href="#gdha_commented_at_2013-09-03_1108" title="Permanent link">&para;</a></h4>
<p>In my opinion it's safe to close this issue. If needed it can be
re-opened</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2013-01-29.192.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
