<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2408 PR merged: Work on selecting the Borg archive to restore from. - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2408 PR merged: Work on selecting the Borg archive to restore from.";
        var mkdocs_page_input_path = "issues/2020-05-25.2408.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2408 PR merged: Work on selecting the Borg archive to restore from.</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2408_pr_merged_work_on_selecting_the_borg_archive_to_restore_from"><a href="https://github.com/rear/rear/pull/2408">#2408 PR</a> <code>merged</code>: Work on selecting the Borg archive to restore from.<a class="headerlink" href="#2408_pr_merged_work_on_selecting_the_borg_archive_to_restore_from" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>cleanup</code>, <code>fixed / solved / done</code></p>
<h4 id="flyinggreenfrog_opened_issue_at_2020-05-25_1656"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> opened issue at <a href="https://github.com/rear/rear/pull/2408">2020-05-25 16:56</a>:<a class="headerlink" href="#flyinggreenfrog_opened_issue_at_2020-05-25_1656" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL): <strong>N/A</strong></p>
</li>
<li>
<p>How was this pull request tested? openSUSE Leap 15.1 Baremetal via
    USB rescue medium</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>Up until now while recover from Borg backup it shows all rear archives
to the user to select from. That can be a very long list with hundreds
of archives. Only the last items are visble.</p>
<p>With this PR a number (configurable, default is 10) of recent commits is
shown. A option is added for the user to set that a next set (default
10) of older archives is presented to the user. If all available
archives are shown, and the user didn't select anything valid, we cycle
through available archives again from the beginning.</p>
<p>More over output format was adjusted a little bit: before it was
something like <code>[&lt;NR&gt;] &lt;ARCHIVE_NAME&gt; &lt;DATE&gt; ...</code>, we change it to
<code>[&lt;NR&gt;] &lt;DATE&gt; &lt;ARCHIVE_NAME&gt;</code>, since archive names are not fixed with
their width, that was resulting in not aligned output. <code>&lt;DATE&gt;</code> has
fixed width, so last column with archive name takes then whatever space
the name needs.</p>
<h4 id="gozora_commented_at_2020-05-25_1948"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633698020">2020-05-25 19:48</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-25_1948" title="Permanent link">&para;</a></h4>
<p>Hello @jsmeix,<br />
I know that you are not Borg user (although one day you you will
certainly run out of disk space and start using it :-) ), but could you
please take a quick look here if you don't see anything obviously wrong?</p>
<p>Thanks</p>
<p>V.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-25_2227"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633731993">2020-05-25 22:27</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-25_2227" title="Permanent link">&para;</a></h4>
<blockquote>
<p>But since there might be people who don't like to "scroll" or need to
stick to current way for what ever reason, could you consider to
implement something like:</p>
<pre><code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER=-1
</code></pre>
<p>where pagination will not be applied?</p>
</blockquote>
<p>Good idea. However I used value <code>0</code> to disable pagination, because
showing zero entries doesn't make sense imho.</p>
<p>I also tested, that <code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER &gt;= 0</code> in
prep step.</p>
<p>My original attempt to change the order of shown entries (from newest to
oldest), I reverted back to from oldest to newest, so that in case
pagination is disabled, even with a lot of entries, the newest ones are
shown last and are visible to the user, as to resemble behaviour before
my PR.</p>
<p>If <code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER</code> is set to a positive
number, then show archives starting with
<code>&lt;NEWEST&gt; - BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER + 1</code> to <code>&lt;NEWEST&gt;</code>
with pagination enabled.</p>
<p>EDIT:<br />
In case <code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER</code> is set to a number
greater or equal to the number of available archives, pagination is
effectively also disabled. But for disabling pagination by the user,
setting to zero should be the way to go, since otherwise you have to
know the number of available archives before, and the number of archives
will also change over time, when backups are made.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-26_0413"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633797742">2020-05-26 04:13</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-26_0413" title="Permanent link">&para;</a></h4>
<p>Instead of the
<code>if [[ $BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER -eq 0 ]];</code> clause
setting
<code>$BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER=$(( archive_cache_lines ))</code> in
case <code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER=0</code> before the while
loop,should do the same, since the code in the current else clause
should handle properly that case then.</p>
<p>But either way there is a <code>if</code> construct, so I would just leave the PR
like it is now, if no other objections/opinions about that.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-26_0525"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633813956">2020-05-26 05:25</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-26_0525" title="Permanent link">&para;</a></h4>
<p>On a second thought, using same code, just resetting
<code>BORGBACKUP_RESTORE_ARCHIVES_SHOW_NUMBER</code> to the number of available
archives <code>$archive_cache_lines</code> seems cleaner and better imho.</p>
<p>Added commit 779ee6dfcf10b0e1d6a543fb0f5c9dbedd84bdb5.</p>
<p>Tested with pagination and without it (disabled: set to zero). Both
worked liked expected.</p>
<h4 id="jsmeix_commented_at_2020-05-26_0844"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633892763">2020-05-26 08:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-26_0844" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
don't worry because of my<br />
<a href="https://github.com/rear/rear/pull/2402#issuecomment-633508778">https://github.com/rear/rear/pull/2402#issuecomment-633508778</a></p>
<p>I will have a look here for generic "possibly suspicious code".</p>
<p>What I cannot review is whether or not Borg related code<br />
does actually do what is intended because as non-Borg user<br />
I do not understand how Borg behaves.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-26_0909"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633905643">2020-05-26 09:09</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-26_0909" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rear/rear/blob/6d6059abf9e676c5fba834ad10a7f5a5da26b0e8/usr/share/rear/restore/BORG/default/300_load_archives.sh#L78-L81">https://github.com/rear/rear/blob/6d6059abf9e676c5fba834ad10a7f5a5da26b0e8/usr/share/rear/restore/BORG/default/300_load_archives.sh#L78-L81</a></p>
<p>When this part of the code is already reviewed currently, just one
question. This particular <code>break</code> for the <code>while</code> loop after the <code>Error</code>
seems to me dead code? As it is never reached, because with the <code>Error</code>
it would leave with that <code>Error</code> already? Or it has to be there for some
reasons? @jsmeix @gozora</p>
<h4 id="gozora_commented_at_2020-05-26_0917"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-633909776">2020-05-26 09:17</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-26_0917" title="Permanent link">&para;</a></h4>
<p>@flyinggreenfrog</p>
<blockquote>
<p>As it is never reached, because with the Error it would leave with
that Error already</p>
</blockquote>
<p>Correct, I guess the <code>break</code> statement can be removed since <code>Error</code> will
exit the code either way.</p>
<p>V.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-26_1420"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-634055802">2020-05-26 14:20</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-26_1420" title="Permanent link">&para;</a></h4>
<blockquote>
<p>From plain looking at the code (as non-Borg user)<br />
I did not notice something that could not work<br />
so I approve it.</p>
</blockquote>
<p>Tried to work on all your suggestions.</p>
<h4 id="gozora_commented_at_2020-05-26_1744"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-634174302">2020-05-26 17:44</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-26_1744" title="Permanent link">&para;</a></h4>
<p>@jsmeix thanks for your review and inputs, as always it is much
appreciated!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-26_1745"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-634174624">2020-05-26 17:45</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-26_1745" title="Permanent link">&para;</a></h4>
<p>@flyinggreenfrog I'll not have time to do review today. I need to
postpone until tomorrow.</p>
<p>Sorry for that!</p>
<p>V.</p>
<h4 id="flyinggreenfrog_commented_at_2020-05-27_0431"><img src="https://avatars.githubusercontent.com/u/4796558?u=4d96cdb74efb96ca18f09f6b7e0f46849f40a056&v=4" width="50"><a href="https://github.com/flyinggreenfrog">flyinggreenfrog</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-634421545">2020-05-27 04:31</a>:<a class="headerlink" href="#flyinggreenfrog_commented_at_2020-05-27_0431" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@flyinggreenfrog I'll not have time to do review today. I need to
postpone until tomorrow.</p>
<p>Sorry for that!</p>
<p>V.</p>
</blockquote>
<p>No problem, take your time.</p>
<h4 id="gozora_commented_at_2020-05-27_0614"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2408#issuecomment-634451659">2020-05-27 06:14</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-27_0614" title="Permanent link">&para;</a></h4>
<p>Everything works fine for me.<br />
If there are no further objections I'll merge this PR later today.</p>
<p>V.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2023 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-25.2408.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
