<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2401 PR merged: Create destination directory schema when using lftp - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2401 PR merged: Create destination directory schema when using lftp";
        var mkdocs_page_input_path = "issues/2020-05-18.2401.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rsync.html">External Backup using BACKUP=RSYNC method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/duplicity.html">External Backup using duplicity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2401 PR merged: Create destination directory schema when using lftp</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2401_pr_merged_create_destination_directory_schema_when_using_lftp"><a href="https://github.com/rear/rear/pull/2401">#2401 PR</a> <code>merged</code>: Create destination directory schema when using lftp<a class="headerlink" href="#2401_pr_merged_create_destination_directory_schema_when_using_lftp" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="gozora_opened_issue_at_2020-05-18_1114"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> opened issue at <a href="https://github.com/rear/rear/pull/2401">2020-05-18 11:14</a>:<a class="headerlink" href="#gozora_opened_issue_at_2020-05-18_1114" title="Permanent link">&para;</a></h4>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Low</strong></p>
</li>
<li>
<p>Reference to related issue (URL): <strong>N/A</strong></p>
</li>
<li>
<p>How was this pull request tested?<br />
    Run <code>rear mkrescue</code> with and without destination directory schema
    created.</p>
</li>
<li>
<p>Brief description of the changes in this pull request:<br />
    When transferring ReaR recovery system ISO, create also destination
    directory structure (including parents). This is useful because when
    destination directory structure does not exist (or is incomplete),
    Lftp puts files into last available directory in OUTPUT_URL scheme.</p>
</li>
</ul>
<h4 id="jsmeix_commented_at_2020-05-18_1247"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630159786">2020-05-18 12:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1247" title="Permanent link">&para;</a></h4>
<p>In rear/output/PXE/default/820_copy_to_net.sh<br />
we also have a plain <code>lftp ...put</code></p>
<pre><code>lftp -c "open $OUTPUT_URL; mput $result_file"
</code></pre>
<p>Is there perhaps also a <code>mkdir -p</code> needed?</p>
<h4 id="gozora_commented_at_2020-05-18_1250"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630161239">2020-05-18 12:50</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-18_1250" title="Permanent link">&para;</a></h4>
<blockquote>
<p>In rear/output/PXE/default/820_copy_to_net.sh<br />
we also have a plain lftp ...put</p>
</blockquote>
<p>I did not specifically aimed for PXE code, but in general adding
<code>mkdir -pf ..</code> should not harm ...</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-05-18_1253"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630163035">2020-05-18 12:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1253" title="Permanent link">&para;</a></h4>
<p>By the way:<br />
Sometimes we use <code>mkdir $v -p</code> sometimes only <code>mkdir -p</code><br />
I don't know when <code>$v</code> should be added or not.</p>
<h4 id="gozora_commented_at_2020-05-18_1309"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630171753">2020-05-18 13:09</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-18_1309" title="Permanent link">&para;</a></h4>
<blockquote>
<p>mkdir -fp foo/bar<br />
mkdir: invalid option -- 'f'<br />
Try 'mkdir --help' for more information.</p>
</blockquote>
<p>This is not standard <code>mkdir</code> from bash, but rather <code>mkdir</code> from <code>lftp</code>
as internal command.</p>
<p>excerpt from <code>man lftp</code></p>
<pre><code>...
mkdir [-p] [-f] dir(s)

Make remote directories. If -p is used, make all components of paths.  The -f option makes mkdir quiet and suppresses messages.
...
</code></pre>
<h4 id="jsmeix_commented_at_2020-05-18_1401"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630203024">2020-05-18 14:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1401" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
thank you for your explanations.<br />
Now even I see that this <code>mkdir</code> is a special one :-)</p>
<h4 id="gozora_commented_at_2020-05-18_1419"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630214052">2020-05-18 14:19</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-18_1419" title="Permanent link">&para;</a></h4>
<p>@jsmeix many thanks for your review!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-19_0856"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630684877">2020-05-19 08:56</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_0856" title="Permanent link">&para;</a></h4>
<p>@jsmeix will do!</p>
<p>Thanks for heads up!</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-05-19_0905"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630690018">2020-05-19 09:05</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-19_0905" title="Permanent link">&para;</a></h4>
<p>A first test looks good to me:</p>
<pre><code># url_path "ftp://host_name/destination_directory"

/destination_directory
</code></pre>
<h4 id="gozora_commented_at_2020-05-19_0911"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630693190">2020-05-19 09:11</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_0911" title="Permanent link">&para;</a></h4>
<p>Yep, looks good.</p>
<pre><code>+++ url_path sftp://backup/mnt/rear/borg/iso/node1
+++ local url=sftp://backup/mnt/rear/borg/iso/node1
+++ local url_without_scheme=backup/mnt/rear/borg/iso/node1
+++ echo /mnt/rear/borg/iso/node1
++ local path=/mnt/rear/borg/iso/node1
++ lftp -c 'open sftp://backup/mnt/rear/borg/iso/node1; mkdir -fp /mnt/rear/borg/iso/node1'
cd: Access failed: No such file (/mnt/rear/borg/iso/node1)
++ lftp -c 'open sftp://backup/mnt/rear/borg/iso/node1;  mput /var/lib/rear/output/rear-node1.iso /tmp/rear.i6vmXjtPdArtp7S/tmp/VERSION /tmp/rear.i6vmXjtPdArtp7S/tmp/README /tmp/rear.i6vmXjtPdArtp7S/tmp/rear-node1.log'
</code></pre>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-19_0915"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630695692">2020-05-19 09:15</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_0915" title="Permanent link">&para;</a></h4>
<p>And also when directory is already there:</p>
<pre><code>+++ url_path sftp://backup/mnt/rear/borg/iso/node1
+++ local url=sftp://backup/mnt/rear/borg/iso/node1
+++ local url_without_scheme=backup/mnt/rear/borg/iso/node1
+++ echo /mnt/rear/borg/iso/node1
++ local path=/mnt/rear/borg/iso/node1
++ lftp -c 'open sftp://backup/mnt/rear/borg/iso/node1; mkdir -fp /mnt/rear/borg/iso/node1'
++ lftp -c 'open sftp://backup/mnt/rear/borg/iso/node1;  mput /var/lib/rear/output/rear-node1.iso /tmp/rear.pvWFPUSSvVmxuY0/tmp/VERSION /tmp/rear.pvWFPUSSvVmxuY0/tmp/README /tmp/rear.pvWFPUSSvVmxuY0/tmp/rear-node1.log'
</code></pre>
<h4 id="gozora_commented_at_2020-05-19_0929"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630704293">2020-05-19 09:29</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_0929" title="Permanent link">&para;</a></h4>
<p>Ok, I just found out that $path is already defined and used in
950_copy_result_files.sh :-)</p>
<p>Will fix that!</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-19_0944"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630711288">2020-05-19 09:44</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_0944" title="Permanent link">&para;</a></h4>
<p>Hope that 33bfbe17bec1efe44afe2a2235f864d39f8ce2a2 was the last one in
this PR! :-)</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-05-19_1000"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630719181">2020-05-19 10:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-19_1000" title="Permanent link">&para;</a></h4>
<p>I fear LFTP related issues may grow and grow<br />
and this one is still a lot smaller than<br />
<a href="https://github.com/rear/rear/pull/2384">https://github.com/rear/rear/pull/2384</a><br />
15 commits there versus 5 commits here<br />
;-)</p>
<h4 id="gozora_commented_at_2020-05-19_1009"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630723661">2020-05-19 10:09</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_1009" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I fear LFTP related issues may grow and grow<br />
and this one is still a lot smaller than</p>
</blockquote>
<p>It depends on how many people will use it ...</p>
<p>I personally went this way, to completely eliminate NFS (running with
BACKUP=BORG over ssh), because security people somehow dislike NFS ;-).</p>
<p>V.</p>
<h4 id="gozora_commented_at_2020-05-19_1432"><img src="https://avatars.githubusercontent.com/u/12116358?u=1c5ba9dcee5ca3082f03029a7fbe647efd30eb49&v=4" width="50"><a href="https://github.com/gozora">gozora</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630858912">2020-05-19 14:32</a>:<a class="headerlink" href="#gozora_commented_at_2020-05-19_1432" title="Permanent link">&para;</a></h4>
<p>@gdha, @jsmeix many thanks for your review!</p>
<p>V.</p>
<h4 id="jsmeix_commented_at_2020-05-19_1446"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2401#issuecomment-630868704">2020-05-19 14:46</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-19_1446" title="Permanent link">&para;</a></h4>
<p>@gozora<br />
thank you for your enhancement!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-18.2401.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
