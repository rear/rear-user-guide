<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2908 Issue closed: ReaR 2.7 on SLES15SP2: inexplicable regular umount failure - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2908 Issue closed: ReaR 2.7 on SLES15SP2: inexplicable regular umount failure";
        var mkdocs_page_input_path = "issues/2023-01-09.2908.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_rsync.html">Internal Backup with rsync to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2908 Issue closed: ReaR 2.7 on SLES15SP2: inexplicable regular umount failure</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2908_issue_closed_rear_27_on_sles15sp2_inexplicable_regular_umount_failure"><a href="https://github.com/rear/rear/issues/2908">#2908 Issue</a> <code>closed</code>: ReaR 2.7 on SLES15SP2: inexplicable regular umount failure<a class="headerlink" href="#2908_issue_closed_rear_27_on_sles15sp2_inexplicable_regular_umount_failure" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>support / question</code>,
<code>fixed / solved / done</code>, <code>special hardware or VM</code></p>
<h4 id="thomas-merz_opened_issue_at_2023-01-09_1802"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> opened issue at <a href="https://github.com/rear/rear/issues/2908">2023-01-09 18:02</a>:<a class="headerlink" href="#thomas-merz_opened_issue_at_2023-01-09_1802" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.7 / 2022-07-13</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):<br />
    NAME="SLES"<br />
    VERSION="15-SP2"<br />
    VERSION_ID="15.2"<br />
    PRETTY_NAME="SUSE Linux Enterprise Server 15 SP2"<br />
    ID="sles"<br />
    ID_LIKE="suse"<br />
    ANSI_COLOR="0;32"<br />
    CPE_NAME="cpe:/o:suse:sles:15:sp2"</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
BACKUP=CDM
OUTPUT_URL=file:///rear/iso
OUTPUT_PREFIX="hostname-f"
export TMPDIR="/tmp"
TIMESYNC=NTP
NETFS_KEEP_OLD_BACKUP_COPY=N
EXCLUDE_VG=()
ONLY_INCLUDE_VG=(systemvg binvg hanasharedvg)
WAIT_SECS=120
SKIP_CFG2HTML=Y
USE_CFG2HTML=N
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    VMware</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    EFI v2.40 by VMware, Inc.</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    more than one "VMware PVSCSI storage adapter rev 2" with a total of
    5 disks</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code>NAME                                    KNAME      PKNAME    TRAN TYPE FSTYPE      LABEL   SIZE MOUNTPOINT
/dev/loop0                              /dev/loop0                loop vfat                 96M /var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt
/dev/loop1                              /dev/loop1                loop vfat                 96M /var/tmp/rear.OVhhey7uK3taoxV/tmp/efi_virt
/dev/loop2                              /dev/loop2                loop vfat                 96M /var/tmp/rear.CJOWoaQvuMUvyDv/tmp/efi_virt
/dev/loop3                              /dev/loop3                loop vfat                 96M /var/tmp/rear.IIDh3emTJrYkDY4/tmp/efi_virt
/dev/loop4                              /dev/loop4                loop vfat                 96M /var/tmp/rear.PxS05QU0gUOharc/tmp/efi_virt
/dev/loop5                              /dev/loop5                loop vfat                 96M /var/tmp/rear.XnSh08Zi7LWWAAm/tmp/efi_virt
/dev/loop6                              /dev/loop6                loop vfat                 96M /var/tmp/rear.k4nw099Q7s9UiH6/tmp/efi_virt
/dev/loop7                              /dev/loop7                loop vfat                 96M /var/tmp/rear.l53DsAliWYCFV8c/tmp/efi_virt
/dev/sda                                /dev/sda                  disk                     170G
`-/dev/sda1                             /dev/sda1  /dev/sda       part LVM2_member         170G
  |-/dev/mapper/binvg-usrsap_lv         /dev/dm-6  /dev/sda1      lvm  xfs                  50G /usr/sap
  |-/dev/mapper/binvg-saphome_lv        /dev/dm-7  /dev/sda1      lvm  xfs                   2G /home/sap
  |-/dev/mapper/binvg-uc4home_lv        /dev/dm-8  /dev/sda1      lvm  xfs                   2G /home/uc4
  `-/dev/mapper/binvg-sapinst_lv        /dev/dm-10 /dev/sda1      lvm  xfs                 115G /sapinst
/dev/sdb                                /dev/sdb                  disk                     122G
|-/dev/sdb1                             /dev/sdb1  /dev/sdb       part                       8M
|-/dev/sdb2                             /dev/sdb2  /dev/sdb       part ext3              372.5M /boot
|-/dev/sdb3                             /dev/sdb3  /dev/sdb       part LVM2_member       119.5G
| |-/dev/mapper/systemvg-usr_lv         /dev/dm-0  /dev/sdb3      lvm  xfs                  15G /usr
| |-/dev/mapper/systemvg-swap_lv        /dev/dm-1  /dev/sdb3      lvm  swap                 16G [SWAP]
| |-/dev/mapper/systemvg-root_lv        /dev/dm-2  /dev/sdb3      lvm  xfs                  15G /
| |-/dev/mapper/systemvg-opt_lv         /dev/dm-9  /dev/sdb3      lvm  xfs                   5G /opt
| |-/dev/mapper/systemvg-var_lv         /dev/dm-11 /dev/sdb3      lvm  xfs                  10G /var
| |-/dev/mapper/systemvg-varlogaudit_lv /dev/dm-12 /dev/sdb3      lvm  xfs                  10G /var/log/audit
| |-/dev/mapper/systemvg-varlog_lv      /dev/dm-13 /dev/sdb3      lvm  xfs                  10G /var/log
| |-/dev/mapper/systemvg-vartmp_lv      /dev/dm-14 /dev/sdb3      lvm  xfs                  10G /var/tmp
| |-/dev/mapper/systemvg-tmp_lv         /dev/dm-15 /dev/sdb3      lvm  xfs                  10G /tmp
| `-/dev/mapper/systemvg-home_lv        /dev/dm-16 /dev/sdb3      lvm  xfs                  15G /home
`-/dev/sdb4                             /dev/sdb4  /dev/sdb       part vfat                139M /boot/efi
/dev/sdc                                /dev/sdc                  disk                     1.4T
`-/dev/sdc1                             /dev/sdc1  /dev/sdc       part LVM2_member         1.4T
  `-/dev/mapper/hanadatavg-hanadata_lv  /dev/dm-4  /dev/sdc1      lvm  xfs                 1.4T /hana/data
/dev/sdd                                /dev/sdd                  disk                      80G
`-/dev/sdd1                             /dev/sdd1  /dev/sdd       part LVM2_member          80G
  `-/dev/mapper/hanasharedvg-hanashared_lv
                                        /dev/dm-3  /dev/sdd1      lvm  xfs                  80G /hana/shared
/dev/sde                                /dev/sde                  disk                     700G
`-/dev/sde1                             /dev/sde1  /dev/sde       part LVM2_member         700G
  `-/dev/mapper/hanalogvg-hanalog_lv    /dev/dm-5  /dev/sde1      lvm  xfs                 700G /hana/log
/dev/sr0                                /dev/sr0             ata  rom                     1024M
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce it):</li>
</ul>
<p>When running Rear 2.7 on our EFI-boot-enabled VMs it says</p>
<pre><code>Could not remove build area /var/tmp/rear.k4nw099Q7s9UiH6 (something still exists therein)
</code></pre>
<p>and many "dead" mounts are there (one for each single run):</p>
<pre><code>/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/isofs/boot/efiboot.img (deleted) on /var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt type vfat
</code></pre>
<p>...(and so on)...</p>
<ul>
<li>
<p>Workaround, if any:<br />
    None; or manual unmount üòû</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<!-- -->

<pre><code>2023-01-09 17:51:36.478977061 Exiting rear mkrescue (PID 126650) and its descendant processes ...
2023-01-09 17:51:40.004244933 rear,126650 /usr/sbin/rear mkrescue -vvv
                                `-rear,154186 /usr/sbin/rear mkrescue -vvv
                                    `-pstree,154187 -Aplau 126650
2023-01-09 17:51:40.211717375 Running exit tasks
2023-01-09 17:51:40.236870986 Finished rear mkrescue in 165 seconds
2023-01-09 17:51:40.250497716 Removing build area /var/tmp/rear.k4nw099Q7s9UiH6
2023-01-09 17:51:40.346937030 Failed to 'rm -Rf --one-file-system /var/tmp/rear.k4nw099Q7s9UiH6/tmp'
2023-01-09 17:51:40.831854759 Could not remove build area /var/tmp/rear.k4nw099Q7s9UiH6 (something still exists therein)
2023-01-09 17:51:40.862120053 Something is still mounted within the build area
2023-01-09 17:51:40.878799867   /var/tmp/rear.k4nw099Q7s9UiH6/tmp/isofs/boot/efiboot.img (deleted) on /var/tmp/rear.k4nw099Q7s9UiH6/tmp/efi_virt type vfat (rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro)
2023-01-09 17:51:40.895534725 You must manually umount it, then you could manually remove the build area
2023-01-09 17:51:40.912931056 To manually remove the build area use (with caution): rm -Rf --one-file-system /var/tmp/rear.k4nw099Q7s9UiH6
2023-01-09 17:51:40.929027396 End of program 'rear' reached
</code></pre>
<p>‚ùì Or do you need the full detailled logfile with 166441 lines?</p>
<p>We found this by accident because our monitoring<br />
got so many new filesystems every day for these<br />
/var/tmp/rear.XXXXXX filesystems<br />
after each scheduled "rear mkrescue" run‚Ä¶ üò≤</p>
<h4 id="jsmeix_commented_at_2023-01-10_0743"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1376849700">2023-01-10 07:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-10_0743" title="Permanent link">&para;</a></h4>
<p>@thomas-merz<br />
yes, I need a full debug "rear -D mkrescue" logfile<br />
to be able to find out why something is still mounted<br />
within the build area in your particular case.<br />
If that kind of issue would happen in general<br />
we would have noticed it and fixed its root cause.</p>
<p>Additionally I need the information what files there are<br />
below the mountpoint directory that is still mounted<br />
within the build area in your particular case,<br />
i.e. what files and directories there are in<br />
/var/tmp/rear.*/tmp/efi_virt<br />
in your particular case.<br />
I assume something related to UEFI code does not<br />
sufficiently clean up its own temporary files<br />
or it fails to do so but "blindly proceeds" (see below).<br />
Because 'efi_virt' appears only in</p>
<pre><code>output/ISO/Linux-i386/700_create_efibootimg.sh
</code></pre>
<p>this script is the "prime suspect".</p>
<p>FYI:<br />
Be grateful that over the time we at ReaR upstream added<br />
many basic sanity checks and safeguards at many places<br />
to let ReaR less often blindly proceed regardless of issues<br />
according to "Try hard to care about possible errors" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<pre><code>By default bash proceeds with the next command when something failed.
Do not let your code blindly proceed in case of errors...
</code></pre>
<p>There are still many places in ReaR where it blindly proceeds<br />
and we fix them one by one and step by step as we notice them.</p>
<p>Regarding this particular case see the critical issue<br />
<a href="https://github.com/rear/rear/issues/2611">https://github.com/rear/rear/issues/2611</a><br />
in particular the initial description how the old blind<br />
"rm -Rf /.../outputfs" could cause a disaster by ReaR</p>
<pre><code>... removes ... backup directory ...
... destroy the backup directories for other machines ...
</code></pre>
<p>instead of let ReaR help the user to protect against disaster<br />
and see the rather tricky implementation of an appropriate fix<br />
<a href="https://github.com/rear/rear/pull/2625">https://github.com/rear/rear/pull/2625</a></p>
<p>In this particular case here it is not BACKUP=NETFS<br />
so no backup should be mounted below /var/tmp/rear...<br />
but at the point when /var/tmp/rear... is cleaned up<br />
it is unknown what there might be still left mounted below<br />
(normally all gets umounted and nothing is left mounted)<br />
so in general the new careful "rm -Rf --one-file-system"<br />
instead of the old just blindly "rm -Rf" helps to avoid<br />
possible disastrous outcomes - i.e. better safe than sorry.</p>
<h4 id="thomas-merz_commented_at_2023-01-11_1128"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378609224">2023-01-11 11:28</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-11_1128" title="Permanent link">&para;</a></h4>
<p>Can I send you "full debug "rear -D mkrescue" logfile" not via public
GitHub due to possible "sensitive" data that my company don't want to be
leaked public?</p>
<h4 id="thomas-merz_commented_at_2023-01-11_1129"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378609307">2023-01-11 11:28</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-11_1129" title="Permanent link">&para;</a></h4>
<blockquote>
<p>what files there are<br />
below the mountpoint directory that is still mounted</p>
</blockquote>
<p>For example for one single mounted filesystem out of many:</p>
<pre><code>find /var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/BOOTX64.efi
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/grub.cfg
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/fonts
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/fonts/unicode.pf2
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ast.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ca.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/da.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/de.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/de_CH.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/en@quot.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/eo.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/es.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/fi.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/fr.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/gl.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/hr.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/hu.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/id.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/it.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ja.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ko.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/lt.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/nb.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/nl.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/pa.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/pl.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/pt.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/pt_BR.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ro.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/ru.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/sl.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/sr.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/sv.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/tr.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/uk.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/vi.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/zh_CN.mo
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt/EFI/BOOT/locale/zh_TW.mo
</code></pre>
<h4 id="jsmeix_commented_at_2023-01-11_1202"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378646585">2023-01-11 12:02</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-11_1202" title="Permanent link">&para;</a></h4>
<p>@thomas-merz<br />
I think only the part when<br />
output/ISO/Linux-i386/700_create_efibootimg.sh<br />
runs is perhaps already sufficient to show why in<br />
output/ISO/Linux-i386/700_create_efibootimg.sh<br />
it fails to <code>umount $v $TMP_DIR/efiboot.img</code> cf.<br />
<a href="https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh#L47">https://github.com/rear/rear/blob/rear-2.7/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh#L47</a></p>
<p>So in the "rear -D mkrescue" log file from a line like</p>
<pre><code>+ source /usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh
</code></pre>
<p>all until the next script is sourced<br />
i.e. all until the next line that starts with</p>
<pre><code>+ source /usr/share/rear/...
</code></pre>
<p>which is likely a line like</p>
<pre><code>+ source /usr/share/rear/output/ISO/Linux-i386/800_create_isofs.sh
</code></pre>
<h4 id="thomas-merz_commented_at_2023-01-11_1349"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378780636">2023-01-11 13:49</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-11_1349" title="Permanent link">&para;</a></h4>
<blockquote>
<p>‚Ä¶ I think only the part ‚Ä¶</p>
</blockquote>
<p>Here we go:</p>
<details><pre>
2023-01-09 18:54:05.744086285 Including output/ISO/Linux-i386/700_create_efibootimg.sh
2023-01-09 18:54:05.758244199 Entering debugscript mode via 'set -x'.
+ source /usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh
++ is_true 1
++ case "$1" in
++ return 0
++ efi_img_sz=($( du --block-size=32M --summarize $TMP_DIR/mnt ))
+++ du --block-size=32M --summarize /var/tmp/rear.106OcLQpa6JeG10/tmp/mnt
++ ((  efi_img_sz += 2  ))
++ dd if=/dev/zero of=/var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img count=3 bs=32M
3+0 records in
3+0 records out
100663296 bytes (101 MB, 96 MiB) copied, 0.0787105 s, 1.3 GB/s
++ mkfs.vfat -v /var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img
mkfs.fat 4.1 (2017-01-24)
/var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img has 64 heads and 32 sectors per track,
hidden sectors 0x0000;
logical sector size is 512,
using 0xf8 media descriptor, with 196608 sectors;
drive number 0x80;
filesystem has 2 16-bit FATs and 4 sectors per cluster.
FAT size is 192 sectors, and provides 49047 clusters.
There are 4 reserved sectors.
Root directory contains 512 slots and uses 32 sectors.
Volume ID is 4bdd6f20, no volume label.
++ mkdir -p -v /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt
mkdir: created directory '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt'
++ mount -v -o loop -t vfat /var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt
mount: /dev/loop8 mounted on /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt.
++ cp -v -r /var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/. /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/BOOTX64.efi' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/BOOTX64.efi'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/grub.cfg' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/grub.cfg'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/fonts' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/fonts'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/fonts/unicode.pf2' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/fonts/unicode.pf2'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ast.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ast.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ca.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ca.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/da.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/da.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/de.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/de.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/de_CH.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/de_CH.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/en@quot.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/en@quot.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/eo.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/eo.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/es.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/es.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/fi.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/fi.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/fr.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/fr.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/gl.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/gl.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/hr.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/hr.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/hu.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/hu.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/id.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/id.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/it.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/it.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ja.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ja.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ko.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ko.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/lt.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/lt.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/nb.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/nb.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/nl.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/nl.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/pa.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/pa.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/pl.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/pl.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/pt.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/pt.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/pt_BR.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/pt_BR.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ro.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ro.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/ru.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/ru.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/sl.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/sl.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/sr.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/sr.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/sv.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/sv.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/tr.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/tr.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/uk.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/uk.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/vi.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/vi.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/zh_CN.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/zh_CN.mo'
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/zh_TW.mo' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/zh_TW.mo'
++ umount -v /var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img
umount: /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt: target is busy.
++ mv -v -f /var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img /var/tmp/rear.106OcLQpa6JeG10/tmp/isofs/boot/efiboot.img
renamed '/var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img' -> '/var/tmp/rear.106OcLQpa6JeG10/tmp/isofs/boot/efiboot.img'
+ source_return_code=0
+ test 0 -eq 0
+ cd /var/log/rear
+ test 1
+ Debug 'Leaving debugscript mode (back to previous bash flags and options settings).'
+ test 1
+ Log 'Leaving debugscript mode (back to previous bash flags and options settings).'
+ test -w /var/log/rear/rear-hostname.log
+ echo '2023-01-09 18:54:06.042704848 Leaving debugscript mode (back to previous bash flags and options settings).'
2023-01-09 18:54:06.042704848 Leaving debugscript mode (back to previous bash flags and options settings).
2023-01-09 18:54:06.070822282 Including output/ISO/Linux-i386/800_create_isofs.sh
</pre></details>

<h4 id="jsmeix_commented_at_2023-01-11_1411"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378811748">2023-01-11 14:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-11_1411" title="Permanent link">&para;</a></h4>
<p>So this is the crucial excerpt:</p>
<pre><code>mount: /dev/loop8 mounted on /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt.
++ cp -v -r /var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/. /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI' -&gt; '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI'
...
'/var/tmp/rear.106OcLQpa6JeG10/tmp/mnt/./EFI/BOOT/locale/zh_TW.mo' -&gt; '/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt/./EFI/BOOT/locale/zh_TW.mo'
++ umount -v /var/tmp/rear.106OcLQpa6JeG10/tmp/efiboot.img
umount: /var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt: target is busy.
</code></pre>
<p>I wonder why it is busy?<br />
I am not a sufficient expert to understand<br />
what goes on here behind the scenes.<br />
Does perhaps the 'cp' command return "too early"?<br />
I.e. 'cp' returns but the kernel is still busy with device IO?<br />
Does perhaps the 'umount' command require '--lazy' in practice<br />
to avoid that some IO command like 'cp' with subsequent 'umount'<br />
could let 'umount' (sometimes) fail with "target is busy"?</p>
<p>What "man 8 umount" tells about 'busy' and 'lazy'<br />
doesn't make it clear what one should normally do:</p>
<pre><code>Note that a filesystem cannot be unmounted
when it is 'busy' - for example,
when there are open files on it,
or when some process has its working directory there,
or when a swap file on it is in use.
The offending process could even be umount
itself - it opens libc, and libc in its turn
may open for example locale files.
A lazy unmount avoids this problem,
but it may introduce other issues.
See --lazy description
...
-l, --lazy
Lazy unmount.
Detach the filesystem from the file hierarchy now,
and clean up all references to this filesystem
as soon as it is not busy anymore.
A system reboot would be expected in near future
if you‚Äôre going to use this option for network filesystem
or local filesystem with submounts.
The recommended use-case for umount -l is to prevent hangs
on shutdown due to an unreachable network share where
a normal umount will hang due to a downed server
or a network partition.
Remounts of the share will not be possible.
</code></pre>
<p>@rear/contributors in particular @pcahyna<br />
does one of you perhaps know more details about how<br />
some IO command like 'cp' with subsequent 'umount'<br />
works behind the scenes?</p>
<h4 id="jsmeix_commented_at_2023-01-11_1418"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378822853">2023-01-11 14:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-11_1418" title="Permanent link">&para;</a></h4>
<p>@thomas-merz<br />
could you try out if things behave better in your case<br />
when you change in<br />
output/ISO/Linux-i386/700_create_efibootimg.sh<br />
the line</p>
<pre><code>umount $v $TMP_DIR/efiboot.img
</code></pre>
<p>to</p>
<pre><code>umount $v --lazy $TMP_DIR/efiboot.img
</code></pre>
<p>Alternatively or additionally when 'umount --lazy'<br />
does not help or does not work sufficiently well<br />
could you try out if things behave OK in your case<br />
when you insert a line with something like <code>sleep 3</code><br />
before the 'umount' line?</p>
<h4 id="thomas-merz_commented_at_2023-01-11_1449"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1378866451">2023-01-11 14:49</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-11_1449" title="Permanent link">&para;</a></h4>
<p>Adding <code>--lazy</code> solved my problem üëç</p>
<p>Before I had some mounts left:</p>
<pre><code>df|grep var.*rear| awk '{print $6}'
/var/tmp/rear.Dn01b2YPeaEY3jK/tmp/efi_virt
/var/tmp/rear.OVhhey7uK3taoxV/tmp/efi_virt
/var/tmp/rear.CJOWoaQvuMUvyDv/tmp/efi_virt
/var/tmp/rear.IIDh3emTJrYkDY4/tmp/efi_virt
/var/tmp/rear.PxS05QU0gUOharc/tmp/efi_virt
/var/tmp/rear.XnSh08Zi7LWWAAm/tmp/efi_virt
/var/tmp/rear.l53DsAliWYCFV8c/tmp/efi_virt
/var/tmp/rear.k4nw099Q7s9UiH6/tmp/efi_virt
/var/tmp/rear.106OcLQpa6JeG10/tmp/efi_virt
/var/tmp/rear.uU7oIrbAheXLldP/tmp/efi_virt
/var/tmp/rear.NqP94taUaVv35hW/tmp/efi_virt
/var/tmp/rear.a0aCW56IS2BeEZP/tmp/efi_virt
/var/tmp/rear.zfQsgOB2se46rFQ/tmp/efi_virt
</code></pre>
<p>After manual umount (<code>umount $(df|grep var.*rear| awk '{print $6}')</code>)
and running <code>rear mkrescue</code> no such mount was left üòÑ</p>
<h4 id="jsmeix_commented_at_2023-01-12_1235"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380264031">2023-01-12 12:35</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1235" title="Permanent link">&para;</a></h4>
<p>Ok.<br />
I will improve<br />
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a><br />
to use 'umount --lazy'.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1414"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380417619">2023-01-12 14:14</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1414" title="Permanent link">&para;</a></h4>
<blockquote>
<p>@rear/contributors in particular @pcahyna does one of you perhaps know
more details about how some IO command like 'cp' with subsequent
'umount' works behind the scenes?</p>
</blockquote>
<p>I believe that when <code>cp</code> completes, it should not cause umount failures.
If there are data to be flushed to the disk, umount should wait for the
write to complete even without <code>--lazy</code>.<br />
IOW, I don't understand what's going on. I suspect some process might be
using the mount (could be just by having its current working directory
in the mounted filesystem).<br />
Ideally, it would be good to debug and understand this (for example by
using <code>fuser -m</code>), but I understand that it could be difficult and that
using <code>--lazy</code> is an easier solution.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1421"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380425752">2023-01-12 14:21</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1421" title="Permanent link">&para;</a></h4>
<p>One could change the umount command to something like</p>
<pre><code>umount $v $TMP_DIR/efiboot.img || fuser -m -v  $TMP_DIR/efi_virt
</code></pre>
<p>to try to see the reason for umount problems.</p>
<h4 id="thomas-merz_commented_at_2023-01-12_1437"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380460754">2023-01-12 14:37</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-12_1437" title="Permanent link">&para;</a></h4>
<p>@pcahyna , "one"? You will do? Or do you want me testing this? üòâ</p>
<h4 id="jsmeix_commented_at_2023-01-12_1441"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380465394">2023-01-12 14:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1441" title="Permanent link">&para;</a></h4>
<p>Regarding 'fuser' I saw<br />
"Why fuser is inferior to lsof" in<br />
<a href="https://stackoverflow.com/questions/7878707/how-to-unmount-a-busy-device">https://stackoverflow.com/questions/7878707/how-to-unmount-a-busy-device</a></p>
<p>I am not at all an expert in this area.<br />
From what I read all that looks more like pile of long grown mess<br />
than something where things are working cleanly and consistently.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1443"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380467778">2023-01-12 14:43</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1443" title="Permanent link">&para;</a></h4>
<p>@thomas-merz I meant that we could change the released ReaR code this
way, so that any user facing the issue would get a more meaningful error
message.</p>
<p>But if you are able to reproduce the issue reliably, please try this and
report the results! I am curious.</p>
<h4 id="jsmeix_commented_at_2023-01-12_1443"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380468061">2023-01-12 14:43</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1443" title="Permanent link">&para;</a></h4>
<p>@thomas-merz<br />
I would much appreciate it if you could test things<br />
because it fails in your case so your system behaves<br />
as we need to test real failures.</p>
<p>The "one" who then implements it in ReaR is me via<br />
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a></p>
<h4 id="pcahyna_commented_at_2023-01-12_1449"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380478961">2023-01-12 14:49</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1449" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I am not at all an expert in this area. From what I read all that
looks more like pile of long grown mess than something where things
are working cleanly and consistently.</p>
</blockquote>
<p>I agree. The umount command uses the <code>umount(2)</code> or <code>umount2(2)</code> system
call behind the scenes. From the manual page you can see that the amount
of information the system call can accept (four boolean flags) and
return back (one of the few integer errno values without any additional
parameters that would allow to debug a problem) is really limited.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1450"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380481912">2023-01-12 14:50</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1450" title="Permanent link">&para;</a></h4>
<p>the latter point also applies to the <code>mount</code> syscall where you basically
only know that "something went wrong".</p>
<h4 id="jsmeix_commented_at_2023-01-12_1459"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380504561">2023-01-12 14:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1459" title="Permanent link">&para;</a></h4>
<p>In
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a>
via<br />
<a href="https://github.com/rear/rear/commit/25b532824b57d1e064bee179591c01f907478039">https://github.com/rear/rear/commit/25b532824b57d1e064bee179591c01f907478039</a><br />
I added 'fuser -v -m $TMP_DIR/efi_virt' output in the log file</p>
<h4 id="jsmeix_commented_at_2023-01-12_1507"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380526144">2023-01-12 15:07</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1507" title="Permanent link">&para;</a></h4>
<p>Yes,<br />
those funny 'mount' error message like:</p>
<pre><code>mount: /var/tmp/rear.../outputfs: wrong fs type, bad option,
 bad superblock on /dev/sd..., missing codepage or helper program,
 or other error.
</code></pre>
<p>that tells all and nothing.<br />
So nowadays a more modern state of the art</p>
<pre><code>mount: Oops - something went wrong - we apologize
</code></pre>
<p>that truly tells nothing would be "more correct" ;-)</p>
<h4 id="jsmeix_commented_at_2023-01-12_1534"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380572925">2023-01-12 15:34</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-12_1534" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
<a href="https://github.com/rear/rear/issues/2908#issuecomment-1380417619">https://github.com/rear/rear/issues/2908#issuecomment-1380417619</a></p>
<pre><code>If there are data to be flushed to the disk,
umount should wait for the write to complete
</code></pre>
<p>This is exactly what I had experienced some longer time ago.<br />
I did a 'dd' of a huge file into a mounted filesystem on a USB disk<br />
and 'dd' completed rather soon but my subsequent plain normal 'umount'<br />
took a rather long time while the USB disk (a real rotating disk)<br />
made its typical ongoing access noise until all had completed<br />
and finally 'umount' returned.<br />
I had even asked a colleague at that time and he had told me<br />
that 'umount' is the best way in practice to be sure that<br />
all what needs to be written on a filesystem will have been<br />
written by the kernel when 'umount' returns.<br />
The only thing what is left then is cache in the disk hardware.<br />
So after 'umount' returned one should still wait a bit before<br />
unplugging a USB disk (which does a hard power-off for the disk)<br />
so that possible dirty caches on the disk itself could clean up.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1541"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380583601">2023-01-12 15:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1541" title="Permanent link">&para;</a></h4>
<blockquote>
<p>"Why fuser is inferior to lsof" in<br />
<a href="https://stackoverflow.com/questions/7878707/how-to-unmount-a-busy-device">https://stackoverflow.com/questions/7878707/how-to-unmount-a-busy-device</a></p>
</blockquote>
<p>The reasoning there seems to be that you can't use <code>fuser</code> on a
lazy-unmounted filesystem (because the filesystem is detached, so no
path can point to any file on it), while <code>lsof</code> would still display the
path. As you are using <code>fuser</code> before trying <code>umount --lazy</code>, I think
this reasoning does not apply and <code>fuser</code> will do the right thing.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1544"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380588054">2023-01-12 15:44</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1544" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Yes, those funny 'mount' error message like:</p>
<pre><code>mount: /var/tmp/rear.../outputfs: wrong fs type, bad option,
 bad superblock on /dev/sd..., missing codepage or helper program,
 or other error.
</code></pre>
<p>that tells all and nothing. So nowadays a more modern state of the art</p>
<pre><code>mount: Oops - something went wrong - we apologize
</code></pre>
<p>that truly tells nothing would be "more correct" ;-)</p>
</blockquote>
<p>Indeed - have fun with user reports that took the error message at a
face value and complain they have a bad superblock.</p>
<h4 id="pcahyna_commented_at_2023-01-12_1547"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380592092">2023-01-12 15:47</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1547" title="Permanent link">&para;</a></h4>
<blockquote>
<p>did a 'dd' of a huge file into a mounted filesystem on a USB disk<br />
and 'dd' completed rather soon but my subsequent plain normal
'umount'<br />
took a rather long time while the USB disk (a real rotating disk)<br />
made its typical ongoing access noise until all had completed<br />
and finally 'umount' returned.</p>
</blockquote>
<p>Indeed, so <code>cp</code> should not be causing this (after all, <code>cp</code> should not
be doing anything special compared to <code>dd</code> to a file).</p>
<h4 id="thomas-merz_commented_at_2023-01-12_1615"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380651078">2023-01-12 16:15</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-12_1615" title="Permanent link">&para;</a></h4>
<p>@jsmeix</p>
<blockquote>
<p>I would much appreciate it if you could test things because it fails
in your case so your system behaves as we need to test real failures.</p>
<p>The "one" who then implements it in ReaR is me via #2909</p>
</blockquote>
<pre><code>++ umount -v /var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efiboot.img
umount: /var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efi_virt: target is busy.
++ fuser -m -v /var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efi_virt
                     USER        PID ACCESS COMMAND
/var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efi_virt:
                     root     kernel mount /var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efi_virt
</code></pre>
<p>Which is still mounted:</p>
<pre><code>Filesystem     1K-blocks  Used Available Use% Mounted on
/dev/loop3         98094 12618     85476  13% /var/tmp/rear.qhWQgnwk6DLWmgU/tmp/efi_virt
</code></pre>
<h4 id="pcahyna_commented_at_2023-01-12_1640"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1380699585">2023-01-12 16:40</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-12_1640" title="Permanent link">&para;</a></h4>
<p>@thomas-merz thanks. I experimented a bit and it seems that the "kernel
mount" entry is shown by fuser for any mounted filesystem. This
indicates that the filesystem is unused, if there are no other entries
in the output. Why the unmounting fails is then even more mysterious.
Could you please add one more "umount $TMP_DIR/efiboot.img" after the
<code>fuser</code> ? Maybe it is just some temporary glitch and a second umount
will succeed even without <code>--lazy</code>.</p>
<h4 id="thomas-merz_commented_at_2023-01-13_0837"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381481497">2023-01-13 08:37</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_0837" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
Adding a second <code>umount</code> (without <code>--lazy</code>) will also unmount
$TMP_DIR/efiboot.img üëç</p>
<p><em>Update @pcahyna - sorry, I did make a mistake:<br />
Adding a second <code>umount</code> (without <code>--lazy</code>) will </em>NOT<em> unmount
$TMP_DIR/efiboot.img üëé</em></p>
<h4 id="jsmeix_commented_at_2023-01-13_0844"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381487808">2023-01-13 08:44</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_0844" title="Permanent link">&para;</a></h4>
<p>I can confirm on my openSUSE Leap 15.4 system<br />
that the "kernel mount" is always there:</p>
<pre><code># mount -v /dev/sda6 /other ; fuser -v -m /other ; umount -v /other

mount: /dev/sda6 mounted on /other.

                     USER        PID ACCESS COMMAND
/other:              root     kernel mount /other

umount: /other unmounted
</code></pre>
<p>I also think it is a timing issue<br />
which is my reasoning behind why in<br />
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a><br />
I do first of all 'sleep 1' before normal 'umount'<br />
<a href="https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh#L53">https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh#L53</a></p>
<h4 id="jsmeix_commented_at_2023-01-13_0920"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381525096">2023-01-13 09:20</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_0920" title="Permanent link">&para;</a></h4>
<p>I tried to reproduce such a regular umount failure<br />
of a loop mounted file on my openSUSE Leap 15.4 system<br />
several times in an automated row (i.e. via a script)<br />
and for me it always works.</p>
<p>I have /var/tmp in the root filesystem which is</p>
<pre><code># lsblk -ipo NAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT
NAME                                                      TRAN   TYPE  FSTYPE        SIZE MOUNTPOINT
/dev/sda                                                  sata   disk              465.8G 
|-/dev/sda1                                                      part                  8M 
|-/dev/sda2                                                      part  crypto_LUKS     4G 
| `-/dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part2        crypt swap            4G [SWAP]
|-/dev/sda3                                                      part  crypto_LUKS   200G 
| `-/dev/mapper/cr_ata-TOSHIBA_MQ01ABF050_Y2PLP02CT-part3        crypt ext4          200G /
</code></pre>
<p>In contrast for @thomas-merz /var/tmp is on XFS on LVM<br />
(excerpt from his initial description here)</p>
<pre><code>NAME                                    KNAME      PKNAME    TRAN TYPE FSTYPE      LABEL   SIZE MOUNTPOINT
...
/dev/sdb                                /dev/sdb                  disk                     122G
|-/dev/sdb1                             /dev/sdb1  /dev/sdb       part                       8M
|-/dev/sdb2                             /dev/sdb2  /dev/sdb       part ext3              372.5M /boot
|-/dev/sdb3                             /dev/sdb3  /dev/sdb       part LVM2_member       119.5G
| |-/dev/mapper/systemvg-usr_lv         /dev/dm-0  /dev/sdb3      lvm  xfs                  15G /usr
| |-/dev/mapper/systemvg-swap_lv        /dev/dm-1  /dev/sdb3      lvm  swap                 16G [SWAP]
| |-/dev/mapper/systemvg-root_lv        /dev/dm-2  /dev/sdb3      lvm  xfs                  15G /
| |-/dev/mapper/systemvg-opt_lv         /dev/dm-9  /dev/sdb3      lvm  xfs                   5G /opt
| |-/dev/mapper/systemvg-var_lv         /dev/dm-11 /dev/sdb3      lvm  xfs                  10G /var
| |-/dev/mapper/systemvg-varlogaudit_lv /dev/dm-12 /dev/sdb3      lvm  xfs                  10G /var/log/audit
| |-/dev/mapper/systemvg-varlog_lv      /dev/dm-13 /dev/sdb3      lvm  xfs                  10G /var/log
| |-/dev/mapper/systemvg-vartmp_lv      /dev/dm-14 /dev/sdb3      lvm  xfs                  10G /var/tmp
| |-/dev/mapper/systemvg-tmp_lv         /dev/dm-15 /dev/sdb3      lvm  xfs                  10G /tmp
| `-/dev/mapper/systemvg-home_lv        /dev/dm-16 /dev/sdb3      lvm  xfs                  15G /home
</code></pre>
<p>So perhaps (only a blind guess) something in XFS or LVM<br />
causes some tiny delay somewhere so that a loop mounted file<br />
that actually is on XFS or LVM may sometimes show such an<br />
inexplicable regular umount failure?</p>
<p>My disk 'sda' is of lsblk TRAN 'sata'.<br />
In contrast for @thomas-merz 'sdb' there is no lsblk TRAN.<br />
So perhaps his sdb is somewhat "unusually" connected<br />
(his "hardware" is 'VMware')<br />
and that causes some tiny delay somewhere that may<br />
sometimes cause such an inexplicable regular umount failure?</p>
<h4 id="thomas-merz_commented_at_2023-01-13_1015"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381607910">2023-01-13 10:15</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_1015" title="Permanent link">&para;</a></h4>
<p>@jsmeix , our disks are VMware-VMDKs on an IBM-SAN-Storagebox in virtual
machines:</p>
<pre><code># dmesg -T|grep sdb
[Thu Jan  5 02:42:15 2023] sd 0:0:0:0: [sdb] 255852544 512-byte logical blocks: (131 GB/122 GiB)
[Thu Jan  5 02:42:15 2023] sd 0:0:0:0: [sdb] Write Protect is off
[Thu Jan  5 02:42:15 2023] sd 0:0:0:0: [sdb] Mode Sense: 3b 00 00 00
[Thu Jan  5 02:42:15 2023] sd 0:0:0:0: [sdb] Write cache: disabled, read cache: disabled, doesn't support DPO or FUA
[Thu Jan  5 02:42:15 2023]  sdb: sdb1 sdb2 sdb3 sdb4
[Thu Jan  5 02:42:15 2023] sd 0:0:0:0: [sdb] Attached SCSI disk
[Thu Jan  5 02:42:19 2023] EXT4-fs (sdb2): mounting ext3 file system using the ext4 subsystem
[Thu Jan  5 02:42:20 2023] EXT4-fs (sdb2): mounted filesystem with ordered data mode. Opts: acl,user_xattr
</code></pre>
<p>Full <code>lsblk</code>:</p>
<pre><code># lsblk -ipo NAME,TRAN,TYPE,FSTYPE,SIZE,MOUNTPOINT /dev/sdb
NAME                                    TRAN TYPE FSTYPE        SIZE MOUNTPOINT
/dev/sdb                                     disk               122G
|-/dev/sdb1                                  part                 8M
|-/dev/sdb2                                  part ext3        372.5M /boot
|-/dev/sdb3                                  part LVM2_member 119.5G
| |-/dev/mapper/systemvg-usr_lv              lvm  xfs            15G /usr
| |-/dev/mapper/systemvg-swap_lv             lvm  swap           16G [SWAP]
| |-/dev/mapper/systemvg-root_lv             lvm  xfs            15G /
| |-/dev/mapper/systemvg-opt_lv              lvm  xfs             5G /opt
| |-/dev/mapper/systemvg-var_lv              lvm  xfs            10G /var
| |-/dev/mapper/systemvg-varlogaudit_lv      lvm  xfs            10G /var/log/audit
| |-/dev/mapper/systemvg-varlog_lv           lvm  xfs            10G /var/log
| |-/dev/mapper/systemvg-vartmp_lv           lvm  xfs            10G /var/tmp
| |-/dev/mapper/systemvg-tmp_lv              lvm  xfs            10G /tmp
| `-/dev/mapper/systemvg-home_lv             lvm  xfs            15G /home
`-/dev/sdb4                                  part vfat          139M /boot/efi
</code></pre>
<p>Is there anything "unusual" for you? ü§î</p>
<h4 id="pcahyna_commented_at_2023-01-13_1038"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381636131">2023-01-13 10:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-13_1038" title="Permanent link">&para;</a></h4>
<p>@jsmeix I don't think the file system type of <code>/var/tmp</code> matters
(although I am not 100% sure), I believe the mounted file system type is
more relevant. And that is <code>vfat</code>.</p>
<h4 id="jsmeix_commented_at_2023-01-13_1042"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381640096">2023-01-13 10:42</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_1042" title="Permanent link">&para;</a></h4>
<p>All what is not usual end-user hardware is "unusual" for me<br />
because I only have usual end-user hardware in my homeoffice.<br />
And I have only very limited "usual end-user hardware"<br />
(i.e. only what I actually have in my homeoffice).</p>
<p>"Unusual" does not mean something is wrong or broken.<br />
But it means it is something where others cannot reproduce<br />
how unusual (or special) hardware (or software) behaves.</p>
<p>Same with virtualization software:<br />
I only use KVM/QEMU.<br />
In particular I don't use any proprietary software.</p>
<p>So "VMware-VMDKs on an IBM-SAN-Storagebox"<br />
is "very unusual" for me personally.</p>
<p>Things may change when you have a vaild support contract<br />
with SUSE for ReaR in a SUSE Linux Enterprise product<br />
because for SUSE special enterprise hardware and software<br />
is less "unusual" (but of course SUSE cannot have<br />
each and every enterprise hardware and software).</p>
<p>For more information see the section<br />
"SUSE support for Relax-and-Recover" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<h4 id="jsmeix_commented_at_2023-01-13_1053"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381653727">2023-01-13 10:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_1053" title="Permanent link">&para;</a></h4>
<p>I had tested with VFAT and<br />
it all works for me (100 times in a row):</p>
<pre><code># dd if=/dev/zero of=/var/tmp/test.img count=64 bs=1M
64+0 records in
64+0 records out
67108864 bytes (67 MB, 64 MiB) copied, 0.0453405 s, 1.5 GB/s

# mkfs.vfat /var/tmp/test.img
mkfs.fat 4.1 (2017-01-24)

# mkdir /var/tmp/test.mnt

# for i in $( seq 100 ) ; \
  do echo test $i ; \
     mount -v -o loop -t vfat /var/tmp/test.img /var/tmp/test.mnt ; \
     rm -f /var/tmp/test.mnt/* ; \
     dd if=/dev/urandom of=/var/tmp/test.mnt/urandom.data count=60 bs=1M ; \
     umount -v /var/tmp/test.mnt || break ; \
  done

test 1
mount: /dev/loop0 mounted on /var/tmp/test.mnt.
60+0 records in
60+0 records out
62914560 bytes (63 MB, 60 MiB) copied, 0.9974 s, 63.1 MB/s
umount: /var/tmp/test.mnt unmounted
test 2
mount: /dev/loop0 mounted on /var/tmp/test.mnt.
60+0 records in
60+0 records out
62914560 bytes (63 MB, 60 MiB) copied, 1.04459 s, 60.2 MB/s
umount: /var/tmp/test.mnt unmounted
.
.
.
test 100
mount: /dev/loop0 mounted on /var/tmp/test.mnt.
60+0 records in
60+0 records out
62914560 bytes (63 MB, 60 MiB) copied, 1.02499 s, 61.4 MB/s
umount: /var/tmp/test.mnt unmounted
</code></pre>
<h4 id="thomas-merz_commented_at_2023-01-13_1110"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381694580">2023-01-13 11:10</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_1110" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Things may change when you have a vaild support contract<br />
with SUSE for ReaR in a SUSE Linux Enterprise product<br />
because for SUSE special enterprise hardware and software<br />
is less "unusual" (but of course SUSE cannot have<br />
each and every enterprise hardware and software).</p>
</blockquote>
<p>We "have a vaild support contract with SUSE for ReaR in a SUSE Linux
Enterprise product", but we are using Rear 2.7 from Upstream because the
one provided by SUSE (2.3) is far toooooo old because we need a more
current version with Rubrik-Integration.</p>
<p>@roseswe already asked a SUSE representive and you @jsmeix on Nov. 29th
to adapt Rear 2.7 into official SUSE repos.</p>
<p>So are we stuck now or can we proceed? ü§∑‚Äç‚ôÇÔ∏è</p>
<h4 id="thomas-merz_commented_at_2023-01-13_1112"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381697437">2023-01-13 11:12</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_1112" title="Permanent link">&para;</a></h4>
<p>With "unusual to you" I ment "disabled" or "unsupport" features or Opts.</p>
<h4 id="pcahyna_commented_at_2023-01-13_1213"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381771395">2023-01-13 12:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-13_1213" title="Permanent link">&para;</a></h4>
<p>So, if it fails only at the first attempt, I would advise to add
<code>fuser -m -v  $TMP_DIR/efi_virt</code> <strong>before</strong> the first (failing) umount.
I agree it is a timing issue and it would be good to know if it is
purely in the kernel or if there is some userspace process involved (in
the latter case, <code>fuser</code> before failing umount should reveal it). Could
you please do this test, @thomas-merz ?</p>
<h4 id="pcahyna_commented_at_2023-01-13_1216"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381774300">2023-01-13 12:16</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-13_1216" title="Permanent link">&para;</a></h4>
<p>sorry, now I saw the update:</p>
<blockquote>
<p>I did make a mistake:<br />
Adding a second umount (without --lazy) will NOT unmount
$TMP_DIR/efiboot.img</p>
</blockquote>
<p>so, maybe it is not a timing issue after all.</p>
<h4 id="jsmeix_commented_at_2023-01-13_1226"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381784203">2023-01-13 12:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_1226" title="Permanent link">&para;</a></h4>
<p>@thomas-merz</p>
<p>providing ReaR 2.7 as new RPM package 'rear27a' for SLE-HA-15<br />
("SUSE Linux Enterprise High Availability Extension version 15")<br />
is already done by me (as the RPM package maintainer at SUSE)<br />
which means currently it is work in progress by others at SUSE<br />
to get that new RPM package rear27a into the SLE-HA-15 product<br />
so that finally it becomes officially available for SUSE customers.</p>
<p>That you use ReaR 2.7 from ReaR upstream is much appreciated and<br />
recommended by me and I support you with that here at ReaR upstream<br />
because this way we can right now proceed to get it working for you<br />
as you need it in your specific case (e.g. fixing issues like this
one)<br />
and we at ReaR upstream can learn new (special) things how we could<br />
further improve ReaR so that it works in even more special cases<br />
(there are already lots of things in ReaR to deal with special cases).</p>
<p>Because you reported your issue publicly at ReaR upstream<br />
all ReaR upstream developers can work together on a proper fix.<br />
In particular @pcahyna helps me so much with ReaR issues.</p>
<p>To be able to improve ReaR (in particular for special cases)<br />
we at ReaR upstream depend very much on contributions by users.</p>
<p>What I appreciate most of all is that you @thomas-merz<br />
as an actual user of ReaR (i.e. someone who sits in front<br />
of a system where ReaR is used and who is 'root' there)<br />
directly works together with us at ReaR upstream.<br />
This helps you to get your specific issue fixed<br />
as good as possible and as fast as possible<br />
"nothing is better and faster than ReaR upstream" ;-)<br />
and it helps us at ReaR upstream to understand<br />
a special case to be able to deal with it properly<br />
"nothing is better than direct collaboration with users" :-)</p>
<p>So nothing is stuck.<br />
Let us just proceed here as we currently do.<br />
From my point of view all works perfectly well here.</p>
<p>In the end all will benefit from how we do things here:<br />
First of all you because your specific issue gets fixed right now.<br />
Later when it is fixed generically in ReaR also other users who use<br />
ReaR upstream benefit because they will not be hit by this issue.<br />
Finally Linux distributions benefit when they provide a newer ReaR<br />
version to their users who will benefit last.</p>
<h4 id="jsmeix_commented_at_2023-01-13_1231"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381789234">2023-01-13 12:31</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_1231" title="Permanent link">&para;</a></h4>
<p>Oops!<br />
I also did not notice the update in<br />
<a href="https://github.com/rear/rear/issues/2908#issuecomment-1381481497">https://github.com/rear/rear/issues/2908#issuecomment-1381481497</a></p>
<p>I assume this happened because GitHub does not send<br />
its usual notification e-mail when a comment was updated<br />
and at least I depend on GitHub's notification e-mails.</p>
<h4 id="thomas-merz_commented_at_2023-01-13_1323"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381846190">2023-01-13 13:23</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_1323" title="Permanent link">&para;</a></h4>
<p>@pcahyna</p>
<blockquote>
<p>add <code>fuser -m -v $TMP_DIR/efi_virt</code> <strong>before</strong> the first (failing)
umount.</p>
</blockquote>
<p>This little "slow down" by <code>fuser</code> seems to be sufficient to make
<code>umount</code> successfully unmount the filesystem:</p>
<pre><code>++ fuser -m -v /var/tmp/rear.dm7v6Gulm4z7wnA/tmp/efi_virt
                     USER        PID ACCESS COMMAND
/var/tmp/rear.dm7v6Gulm4z7wnA/tmp/efi_virt:
                     root     kernel mount /var/tmp/rear.dm7v6Gulm4z7wnA/tmp/efi_virt
++ umount -v /var/tmp/rear.dm7v6Gulm4z7wnA/tmp/efiboot.img
umount: /var/tmp/rear.dm7v6Gulm4z7wnA/tmp/efi_virt (/dev/loop0) unmounted
</code></pre>
<h4 id="jsmeix_commented_at_2023-01-13_1358"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1381896718">2023-01-13 13:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-13_1358" title="Permanent link">&para;</a></h4>
<p>So it looks again as if some simple<br />
artificial 'sleep 1' delay before 'umount'<br />
should sufficiently avoid such issues<br />
which I do currently in<br />
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a><br />
in the</p>
<pre><code># Umounting the EFI virtual image:
...
</code></pre>
<p>code section in<br />
<a href="https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh">https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh</a></p>
<p>@thomas-merz<br />
could you try out if using<br />
/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh<br />
as in<br />
<a href="https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh">https://github.com/rear/rear/blob/25b532824b57d1e064bee179591c01f907478039/usr/share/rear/output/ISO/Linux-i386/700_create_efibootimg.sh</a><br />
makes that umount working sufficienly reliable for you?</p>
<p>You can see the actual code change in<br />
<a href="https://github.com/rear/rear/pull/2909/files">https://github.com/rear/rear/pull/2909/files</a><br />
(long lines may be shown wrapped in the browser).</p>
<p>You only need the change for<br />
output/ISO/Linux-i386/700_create_efibootimg.sh</p>
<h4 id="thomas-merz_commented_at_2023-01-13_1513"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1382000811">2023-01-13 15:13</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_1513" title="Permanent link">&para;</a></h4>
<p>@jsmeix , <code>sleep 1</code> also works fine:</p>
<pre><code>++ sleep 1
++ umount -v /var/tmp/rear.6CEkscr2qDP8VI5/tmp/efiboot.img
umount: /var/tmp/rear.6CEkscr2qDP8VI5/tmp/efi_virt (/dev/loop0) unmounted
</code></pre>
<h4 id="pcahyna_commented_at_2023-01-13_1926"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1382292712">2023-01-13 19:26</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-13_1926" title="Permanent link">&para;</a></h4>
<p>since there does not seem to be a process blocking it (although we are
not 100% sure), maybe the filesystem just needs syncing?<br />
Could you please try adding <code>sync --file-system $TMP_DIR/efi_virt</code>
before the first <code>umount</code> attempt (without the <code>sleep</code> and the <code>fuser</code>)?</p>
<h4 id="thomas-merz_commented_at_2023-01-13_2032"><img src="https://avatars.githubusercontent.com/u/22958542?u=ef394073fa448d2d48bf182c654698f7c94cc714&v=4" width="50"><a href="https://github.com/thomas-merz">thomas-merz</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1382357406">2023-01-13 20:32</a>:<a class="headerlink" href="#thomas-merz_commented_at_2023-01-13_2032" title="Permanent link">&para;</a></h4>
<p>I did:</p>
<pre><code>++ sync --file-system /var/tmp/rear.9nhtp3oeToiJMS5/tmp/efi_virt
++ umount -v /var/tmp/rear.9nhtp3oeToiJMS5/tmp/efiboot.img
umount: /var/tmp/rear.9nhtp3oeToiJMS5/tmp/efi_virt: target is busy.
</code></pre>
<p>And voila - it's still mounted:</p>
<pre><code>Filesystem      Size  Used Avail Use% Mounted on
/dev/loop0       96M   13M   84M  13% /var/tmp/rear.9nhtp3oeToiJMS5/tmp/efi_virt
</code></pre>
<p>üëé</p>
<h4 id="pcahyna_commented_at_2023-01-13_2048"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1382370020">2023-01-13 20:48</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-01-13_2048" title="Permanent link">&para;</a></h4>
<p>@thomas-merz thanks for trying...</p>
<h4 id="jsmeix_commented_at_2023-01-26_1418"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1405070332">2023-01-26 14:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-01-26_1418" title="Permanent link">&para;</a></h4>
<p>An addedum regarding <code>fuser -v -m /path/to/something</code><br />
see in
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a><br />
my recent commit<br />
<a href="https://github.com/rear/rear/pull/2909/commits/f770c69ee7e2fadc7137a37b3c5596da0b62aedb">https://github.com/rear/rear/pull/2909/commits/f770c69ee7e2fadc7137a37b3c5596da0b62aedb</a><br />
why one should use fuser with its '-M' option</p>
<pre><code>fuser -v -M -m /path/to/something
</code></pre>
<p>instead of plain <code>fuser -v -m /path/to/something</code></p>
<p>For example (on my openSUSE Leap 15.4 system):</p>
<pre><code># mount -v /dev/sda6 /other
mount: /dev/sda6 mounted on /other.

# fuser -v -m /other
                     USER        PID ACCESS COMMAND
/other:              root     kernel mount /other

# fuser -v -M -m /other
                     USER        PID ACCESS COMMAND
/other:              root     kernel mount /other

# umount -v /other
umount: /other unmounted

# fuser -v -m /other
                     USER        PID ACCESS COMMAND
/other:              root     kernel mount /
                     root          1 .rce. systemd
                     root          2 .rc.. kthreadd
...
[about 300 more lines]
...
                     root      31953 .rc.. kvm-pit/31921
                     johannes  32016 .rce. ssh
                     johannes  32018 .rce. ssh-agent

# fuser -v -M -m /other
Specified filename /other is not a mountpoint.
</code></pre>
<h4 id="pcahyna_commented_at_2023-02-14_1145"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1429605894">2023-02-14 11:45</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1145" title="Permanent link">&para;</a></h4>
<p>Hi @jsmeix , good catch with <code>-M</code>, indeed, if the filesystem is not
mounted at this point, the output would be very misleading.</p>
<p>Unfortunately, RHEL 6 does not yet have the fuser <code>-M</code> flag, so I
suspect some of the SLES or openSUSE variants that you care about will
have the same problem.</p>
<h4 id="jsmeix_commented_at_2023-02-14_1201"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1429629517">2023-02-14 12:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-02-14_1201" title="Permanent link">&para;</a></h4>
<p>Hello @pcahyna</p>
<p>if you have a system where 'fuser' does not support '-M'<br />
could you show me what 'fuser -v -M -m /dir' results?<br />
Does it perhaps just ignore '-M' or does it error out?</p>
<h4 id="pcahyna_commented_at_2023-02-14_1227"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1429670188">2023-02-14 12:27</a>:<a class="headerlink" href="#pcahyna_commented_at_2023-02-14_1227" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Hello @pcahyna</p>
<p>if you have a system where 'fuser' does not support '-M' could you
show me what 'fuser -v -M -m /dir' results? Does it perhaps just
ignore '-M' or does it error out?</p>
</blockquote>
<pre><code># mount
/dev/mapper/vg_ciscoc240m301-lv_root on / type ext4 (rw)
(...)
/dev/sda1 on /boot type ext4 (rw)
# fuser -v -M -m /boot
M: unknown signal; fuser -l lists signals.
# echo $?
1
</code></pre>
<p>Weird, huh? That's on RHEL 6.<br />
The manual page says:</p>
<pre><code>fuser [-a|-s|-c] [-4|-6] [-n  space ] [-k [-i] [-signal ] ] [-muvf] name ...
</code></pre>
<p>and we get bitten by the <code>-signal</code> part.</p>
<h4 id="jsmeix_commented_at_2023-03-20_1218"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1476124509">2023-03-20 12:18</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-20_1218" title="Permanent link">&para;</a></h4>
<p>Regarding in<br />
<a href="https://github.com/rear/rear/issues/2908#issuecomment-1429605894">https://github.com/rear/rear/issues/2908#issuecomment-1429605894</a><br />
what SLES versions support 'fuser ... -M ...':</p>
<p>SLES11 does not support 'fuser ... -M ...'</p>
<p>SLES12 and later support 'fuser ... -M ...'</p>
<p>Since ReaR 2.7 is released I do no longer care about SLES11, cf.<br />
<a href="https://github.com/rear/rear/pull/2949#discussion_r1124225289">https://github.com/rear/rear/pull/2949#discussion_r1124225289</a></p>
<h4 id="jsmeix_commented_at_2023-03-22_1225"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2908#issuecomment-1479483688">2023-03-22 12:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2023-03-22_1225" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2909">https://github.com/rear/rear/pull/2909</a>
merged<br />
this issue should be sufficiently avoided.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2023-01-09.2908.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
