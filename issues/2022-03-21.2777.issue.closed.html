<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2777 Issue closed: XFS: diskrestore.sh failed at 'mount: /mnt/local: ...' because of wrong mount options - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2777 Issue closed: XFS: diskrestore.sh failed at \u0027mount: /mnt/local: ...\u0027 because of wrong mount options";
        var mkdocs_page_input_path = "issues/2022-03-21.2777.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2777 Issue closed: XFS: diskrestore.sh failed at 'mount: /mnt/local: ...' because of wrong mount options</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2777_issue_closed_xfs_diskrestoresh_failed_at_mount_mntlocal_because_of_wrong_mount_options"><a href="https://github.com/rear/rear/issues/2777">#2777 Issue</a> <code>closed</code>: XFS: diskrestore.sh failed at 'mount: /mnt/local: ...' because of wrong mount options<a class="headerlink" href="#2777_issue_closed_xfs_diskrestoresh_failed_at_mount_mntlocal_because_of_wrong_mount_options" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>no-issue-activity</code></p>
<h4 id="jkuhns5739_opened_issue_at_2022-03-21_1956"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> opened issue at <a href="https://github.com/rear/rear/issues/2777">2022-03-21 19:56</a>:<a class="headerlink" href="#jkuhns5739_opened_issue_at_2022-03-21_1956" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.4 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/os-release" or "lsb_release -a" or "cat
    /etc/rear/os.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OS_VENDOR=RedHatEnterpriseServer
OS_VERSION=8
</code></pre>
<ul>
<li>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
OUTPUT_URL=nfs://172.29.73.228/backups/rearMateBackup/
BACKUP=NETFS
BACKUP_URL=iso:///backup/
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/backups/tmp/*' '/backups/rearMateBackup/*' '/backups/rearLocalBackup/*' '/var/log/*' '/var/lib/libvirt/images/*' '/home/storage/loads/*' '/home/storage/patches/*' '/home/storage/backups/*')
export TMPDIR=/backups/tmp
TMPDIR=/backups/tmp
KEEP_BUILD_DIR=
KEEP_OLD_OUTPUT_COPY=y
ISO_DIR=/backups/rearLocalBackup
</code></pre>
<ul>
<li>
<p>Hardware vendor/product (PC or PowerNV BareMetal or ARM) or VM (KVM
    guest or PowerVM LPAR):<br />
    PC</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device):<br />
    x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot):<br />
    UEFI</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe):<br />
    local disk</p>
</li>
<li>
<p>Storage layout ("lsblk -ipo
    NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT"):</p>
</li>
</ul>
<!-- -->

<pre><code># lsblk -ipo NAME,KNAME,PKNAME,TRAN,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT
NAME                                        KNAME      PKNAME    TRAN TYPE FSTYPE      LABEL  SIZE MOUNTPOINT
/dev/sda                                    /dev/sda                  disk                    2.2T
|-/dev/sda1                                 /dev/sda1  /dev/sda       part vfat               512M /boot/efi
|-/dev/sda2                                 /dev/sda2  /dev/sda       part xfs                  1G /boot
`-/dev/sda3                                 /dev/sda3  /dev/sda       part LVM2_member        2.2T
  |-/dev/mapper/vg00-root                   /dev/dm-0  /dev/sda3      lvm  xfs                 20G /
  |-/dev/mapper/vg00-opt                    /dev/dm-1  /dev/sda3      lvm  xfs                 10G /opt
  |-/dev/mapper/vg00-var_log_audit          /dev/dm-2  /dev/sda3      lvm  xfs                  4G /var/log/audit
  |-/dev/mapper/vg00-var_log                /dev/dm-3  /dev/sda3      lvm  xfs                 10G /var/log
  |-/dev/mapper/vg00-var_tmp                /dev/dm-4  /dev/sda3      lvm  xfs                 10G /var/tmp
  |-/dev/mapper/vg00-var_lib_libvirt_images /dev/dm-5  /dev/sda3      lvm  xfs                1.8T /var/lib/libvirt/images
  |-/dev/mapper/vg00-var                    /dev/dm-6  /dev/sda3      lvm  xfs                 10G /var
  |-/dev/mapper/vg00-home                   /dev/dm-7  /dev/sda3      lvm  xfs                 50G /home
  |-/dev/mapper/vg00-tmp                    /dev/dm-8  /dev/sda3      lvm  xfs                 10G /tmp
  |-/dev/mapper/vg00-backups                /dev/dm-9  /dev/sda3      lvm  xfs                 50G /backups
  `-/dev/mapper/vg00-upgrades               /dev/dm-10 /dev/sda3      lvm  xfs                200G /upgrades
</code></pre>
<ul>
<li>Description of the issue (ideally so that others can reproduce
    it):<br />
    rear recover fails with the following error:</li>
</ul>
<!-- -->

<pre><code>+++ echo -e 'Mounting filesystem /'
+++ mkdir -p /mnt/local/
+++ mount -o rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota /dev/mapper/vg00-root /mnt/local/
mount: /mnt/local: wrong fs type, bad option, bad superblock on /dev/mapper/vg00-root, missing codepage or helper program, or other error.
++ ((  32 == 0  ))
</code></pre>
<ul>
<li>
<p>Workaround, if any:<br />
    None</p>
</li>
<li>
<p>Attachments, as applicable ("rear -D mkrescue/mkbackup/recover"
    debug log files):</p>
</li>
</ul>
<p>rear-OTT50-Host-1B-mkbackup.log (log of mkbackup used for recovery)<br />
rear-OTT50-Host-1B-recover.log (recovery log with failure)</p>
<p><a href="https://github.com/rear/rear/files/8318869/rear-OTT50-Host-1B-mkbackup.log">rear-OTT50-Host-1B-mkbackup.log</a><br />
<a href="https://github.com/rear/rear/files/8318871/rear-OTT50-Host-1B-recover.log">rear-OTT50-Host-1B-recover.log</a></p>
<h4 id="jsmeix_commented_at_2022-03-22_0815"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1074861999">2022-03-22 08:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-22_0815" title="Permanent link">&para;</a></h4>
<p>ReaR version 2.4 is rather old.<br />
It was released in June 2018, see<br />
<a href="https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt">https://github.com/rear/rear/blob/master/doc/rear-release-notes.txt</a></p>
<p>@JKuhns5739<br />
please test if it works for you when you use<br />
our current ReaR GitHub master code.<br />
See the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a><br />
how you can try out our current ReaR GitHub master code<br />
without conflicts with your already installed ReaR version.</p>
<p>In general I recommend to try out our latest GitHub master code<br />
because the GitHub master code is the only place where we fix things<br />
and if there are issues it helps when you use exactly the code<br />
where we could fix things.</p>
<p>In general we at ReaR upstream do not support older ReaR versions.<br />
We at ReaR upstream do not plain reject issues with older ReaR
versions<br />
(e.g. we may answer easy to solve questions also for older ReaR
versions)<br />
but we do not spend much time on issues with older ReaR versions
because<br />
we do not (and cannot) fix issues in released ReaR versions.<br />
Issues in released ReaR versions are not fixed by us (by ReaR
upstream).<br />
Issues in released ReaR versions that got fixed in current ReaR
upstream<br />
GitHub master code might be fixed (if the fix can be backported with<br />
reasonable effort) by the Linux distributor wherefrom you got ReaR.</p>
<p>In case of RHEL you may contact Red Hat directly<br />
provided you have an appropriate support contract.</p>
<p>The disk layout recreation script "diskrestore.sh" failed at<br />
creating filesystem of type xfs with mount point / on
/dev/mapper/vg00-root<br />
according to the following excerpt from<br />
<a href="https://github.com/rear/rear/files/8318871/rear-OTT50-Host-1B-recover.log">https://github.com/rear/rear/files/8318871/rear-OTT50-Host-1B-recover.log</a></p>
<pre><code>+++ echo -e 'Creating filesystem of type xfs with mount point / on /dev/mapper/vg00-root.'
+++ wipefs --all --force /dev/mapper/vg00-root
/dev/mapper/vg00-root: 4 bytes were erased at offset 0x00000000 (xfs): 58 46 53 42
+++ mkfs.xfs -f -m uuid=07cb88d0-a9af-4bef-8114-f493be852c76 -i size=512 -d agcount=32 -s size=512 -i attr=2 -i projid32bit=1 -m crc=1 -m finobt=1 -b size=4096 -i maxpct=25 -d sunit=512 -d swidth=512 -l version=2 -l lazy-count=1 -n size=4096 -n version=2 -r extsize=4096 /dev/mapper/vg00-root
meta-data=/dev/mapper/vg00-root  isize=512    agcount=32, agsize=163840 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=5242880, imaxpct=25
         =                       sunit=64     swidth=64 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=5184, version=2
         =                       sectsz=512   sunit=64 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
+++ LogPrint 'Mounting filesystem /'
+++ Log 'Mounting filesystem /'
++++ date '+%Y-%m-%d %H:%M:%S.%N '
+++ local 'timestamp=2022-03-21 18:40:50.013377686 '
+++ test 1 -gt 0
+++ echo '2022-03-21 18:40:50.013377686 Mounting filesystem /'
2022-03-21 18:40:50.013377686 Mounting filesystem /
+++ Print 'Mounting filesystem /'
+++ test 1
+++ echo -e 'Mounting filesystem /'
+++ mkdir -p /mnt/local/
+++ mount -o rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota /dev/mapper/vg00-root /mnt/local/
mount: /mnt/local: wrong fs type, bad option, bad superblock on /dev/mapper/vg00-root, missing codepage or helper program, or other error.
++ ((  32 == 0  ))
++ true
+++ UserInput -I LAYOUT_CODE_RUN -p 'The disk layout recreation script failed' ...
</code></pre>
<p>So <code>mkfs.xfs</code> finished with exit code 0 so the created XFS should be
OK<br />
but then mounting it failed so I guess <code>mount</code> fails because of some
"bad option".</p>
<p>I am not at all a sufficient XFS expert to understand the XFS specific
mount options.<br />
Perhaps those mount options do not match how the XFS filesystem was
created?</p>
<h4 id="jsmeix_commented_at_2022-03-22_0821"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1074867777">2022-03-22 08:21</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-22_0821" title="Permanent link">&para;</a></h4>
<p>Since ReaR 2.5 we have MKFS_XFS_OPTIONS config<br />
variables which could help in special cases,<br />
see
<a href="https://github.com/rear/rear/pull/2005">https://github.com/rear/rear/pull/2005</a><br />
and
<a href="https://github.com/rear/rear/issues/1998">https://github.com/rear/rear/issues/1998</a><br />
and the issues mentioned therein for some<br />
"not so funny fun with XFS" that we had in the past.</p>
<p>Regarding this issue here see in particuIar<br />
<a href="https://github.com/rear/rear/issues/1998#issuecomment-857622163">https://github.com/rear/rear/issues/1998#issuecomment-857622163</a></p>
<h4 id="jkuhns5739_commented_at_2022-03-22_1734"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075428019">2022-03-22 17:34</a>:<a class="headerlink" href="#jkuhns5739_commented_at_2022-03-22_1734" title="Permanent link">&para;</a></h4>
<p>I was able to recover the system by editing the disklayout.conf file and
removing most of the xfs options. I first tried removing just the
'noquota' option as that is the only option not listed in the mount man
page for xfs; however, the restore failed for the same reason. I went
back to the original system and found that the RAID stripe unit and
width were 64, not 512 as specified in the disklayout.conf file. After
removing the stripe values the xfs was successfully created.</p>
<p>The suggestion to move to a new version could help since we could
specify a limited set of XFS options. I would still like to understand
why ReaR would create options in the disklayout.conf file that do align
with the original system.</p>
<p>Failed options:</p>
<pre><code>mount -o rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
</code></pre>
<p>Successful options:</p>
<pre><code>mount -o rw,relatime,attr2,inode64
</code></pre>
<h4 id="pcahyna_commented_at_2022-03-22_1913"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075532334">2022-03-22 19:13</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-22_1913" title="Permanent link">&para;</a></h4>
<blockquote>
<ul>
<li>rear recover fails with the following error:</li>
</ul>
<!-- -->
<pre><code>+++ echo -e 'Mounting filesystem /'
+++ mkdir -p /mnt/local/
+++ mount -o rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota /dev/mapper/vg00-root /mnt/local/
mount: /mnt/local: wrong fs type, bad option, bad superblock on /dev/mapper/vg00-root, missing codepage or helper program, or other error.
</code></pre>
</blockquote>
<p>Unfortunately, the error message from mount is not very informative, but
when this happens, the kernel sometimes prints a more specific error
message to the log. Is there anything xfs-related in dmesg after this
happens?</p>
<blockquote>
<p>I went back to the original system and found that the RAID stripe unit
and width were 64, not 512 as specified in the disklayout.conf file.</p>
</blockquote>
<p>I suspect this is a misunderstanding. I tried creating a filesystem with</p>
<pre><code>mkfs.xfs -d sunit=512 -d swidth=512 /dev/vdb
</code></pre>
<p>and it printed:</p>
<pre><code>meta-data=/dev/vdb               isize=512    agcount=16, agsize=163840 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=0 inobtcount=0
data     =                       bsize=4096   blocks=2621440, imaxpct=25
         =                       sunit=64     swidth=64 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=5184, version=2
         =                       sectsz=512   sunit=64 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<p>It looks wrong, until one realizes that the message actually reads
<code>sunit=64     swidth=64 blks</code>. A block is 4096 bytes. 64 blks is thus
<code>64*4096 = 262144</code>. <code>sunit</code> on command line is specified in multiples of
512 bytes. <code>512*512 = 262144</code>, so it is consistent.</p>
<h4 id="jkuhns5739_commented_at_2022-03-22_1940"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075562160">2022-03-22 19:40</a>:<a class="headerlink" href="#jkuhns5739_commented_at_2022-03-22_1940" title="Permanent link">&para;</a></h4>
<p>Thanks, it is a misunderstanding on my part, which unfortunately makes
the issue more confusing.</p>
<p>I did not see anything in dmesg that indicated an error. These are the
only xfs specific log messages in the file.</p>
<pre><code>kern  :info  : [  +3.953741] SGI XFS with ACLs, security attributes, quota, no debug enabled
kern  :warn  : [  +0.002342] XFS (dm-8): logbuf size must be greater than or equal to log stripe size
</code></pre>
<p><a href="https://github.com/rear/rear/files/8327383/rear-OTT50-Host-1B-dmesg.log">rear-OTT50-Host-1B-dmesg.log</a></p>
<h4 id="pcahyna_commented_at_2022-03-22_1951"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075575246">2022-03-22 19:51</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-22_1951" title="Permanent link">&para;</a></h4>
<blockquote>
<p>kern :warn : [ +0.002342] XFS (dm-8): logbuf size must be greater
than or equal to log stripe size</p>
</blockquote>
<p>And that's it.</p>
<h4 id="pcahyna_commented_at_2022-03-22_1953"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075578230">2022-03-22 19:53</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-22_1953" title="Permanent link">&para;</a></h4>
<p>What are the mount option on the original system? I mean the options
that really get passed to mount (in fstab), not the filesystem creation
options. Do you use the sunit= ,swidth= etc. options in normal
operation?</p>
<h4 id="jkuhns5739_commented_at_2022-03-22_2031"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1075609083">2022-03-22 20:31</a>:<a class="headerlink" href="#jkuhns5739_commented_at_2022-03-22_2031" title="Permanent link">&para;</a></h4>
<p>The options are not specified in fstab.</p>
<pre><code>[root@OTT50-Host-1B ~]# cat /etc/fstab

/dev/mapper/vg00-root   /                       xfs     defaults        0 0
UUID=ea026af3-32f8-4b7e-8d9c-a2ade4a00206 /boot                   xfs     defaults        0 0
UUID=F316-EA90          /boot/efi               vfat    defaults,uid=0,gid=0,umask=077,shortname=winnt 0 2
/dev/mapper/vg00-home   /home                   xfs     defaults,nodev  0 0
/dev/mapper/vg00-opt    /opt                    xfs     defaults        0 0
/dev/mapper/vg00-tmp    /tmp                    xfs     defaults,nodev,nosuid,noexec 0 0
/dev/mapper/vg00-var    /var                    xfs     defaults        0 0
/dev/mapper/vg00-var_lib_libvirt_images /var/lib/libvirt/images xfs     defaults        0 0
/dev/mapper/vg00-var_log /var/log                xfs     defaults,nodev,nosuid,noexec 0 0
/dev/mapper/vg00-var_log_audit /var/log/audit          xfs     defaults,nodev,nosuid,noexec 0 0
/dev/mapper/vg00-var_tmp /var/tmp                xfs     defaults,nodev,nosuid,noexec 0 0
tmpfs   /dev/shm        tmpfs   nodev,nosuid,noexec     0 0
/dev/mapper/vg00-backups /backups xfs defaults 0 0
/dev/mapper/vg00-upgrades /upgrades xfs defaults 0 0
</code></pre>
<h4 id="jsmeix_commented_at_2022-03-23_0811"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076061645">2022-03-23 08:11</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-23_0811" title="Permanent link">&para;</a></h4>
<p>A side note FYI regarding<br />
<a href="https://github.com/rear/rear/issues/2777#issuecomment-1075532334">https://github.com/rear/rear/issues/2777#issuecomment-1075532334</a><br />
that <code>mkfs.xfs -d sunit=512</code> results <code>sunit=64</code> in the output, cf.<br />
<a href="https://github.com/rear/rear/issues/1998#issuecomment-445220483">https://github.com/rear/rear/issues/1998#issuecomment-445220483</a></p>
<p>I think this is the code that deals with it (block size 4096 versus
sector size 512)</p>
<pre><code>function xfs_parse
    ...
            # Handle mkfs.xfs special cases
            # sunit &amp; swidth are set in blocks
            if [ $var = "sunit" ] || [ $var = "swidth" ]; then
                val=$((val*$block_size/512))
            fi
</code></pre>
<p>which is currently at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/filesystems-functions.sh#L190">https://github.com/rear/rear/blob/master/usr/share/rear/lib/filesystems-functions.sh#L190</a></p>
<p>There is a hardcoded 512 so I wonder if that is actually always a fixed
value.<br />
E.g. I wonder what happens on disks with 4096 sector size like my disk:</p>
<pre><code># parted -s /dev/sda unit B print
Model: ATA TOSHIBA MQ01ABF0 (scsi)
Disk /dev/sda: 500107862016B
Sector size (logical/physical): 512B/4096B
</code></pre>
<p>Will the logical sector size be used or the physical sector size<br />
or will a fixed kernel internal (logical) sector size 512 be used?</p>
<p>In lib/layout-functions.sh we have two hardcoded
<code>local block_size=512</code><br />
in particular this one</p>
<pre><code># Linux always considers sectors to be 512 bytes long. See the note in the
# kernel source, specifically, include/linux/types.h regarding the sector_t
# type for details.
local block_size=512
</code></pre>
<p>currently at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/lib/layout-functions.sh#L702">https://github.com/rear/rear/blob/master/usr/share/rear/lib/layout-functions.sh#L702</a></p>
<p>That "Linux always considers sectors to be 512 bytes" is also mentioned
at<br />
<a href="https://docs.huihoo.com/doxygen/linux/kernel/3.7/include_2linux_2types_8h.html">https://docs.huihoo.com/doxygen/linux/kernel/3.7/include_2linux_2types_8h.html</a></p>
<pre><code>Linux always considers sectors to be 512 bytes long
independently of the devices real block size.
</code></pre>
<p>This is for "Linux Kernel 3.7.1" and it is still the same for 5.17.0<br />
so one could assume that kernel internal (logical) sector size 512 is a
fixed value.</p>
<h4 id="jsmeix_commented_at_2022-03-23_0853"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076107100">2022-03-23 08:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-23_0853" title="Permanent link">&para;</a></h4>
<p>Regarding how a filesystem is created during "rear recover"<br />
versuse how the created filesystem is mounted during "rear recover":</p>
<p>A filesystem is created by the create_fs function in<br />
layout/prepare/GNU/Linux/131_include_filesystem_code.sh<br />
that implements different <code>case</code> code for different filesystems.</p>
<p>A created filesystem is mounted by the mount_fs function in<br />
layout/prepare/GNU/Linux/133_include_mount_filesystem_code.sh<br />
that extracts mount options from the matching <code>fs</code> entry in
disklayout.conf<br />
and also implements different <code>case</code> code for certain filesystems<br />
but for XFS the default case is used.</p>
<p>Regarding how the mount options for a filesystem are stored in
disklayout.conf:<br />
This happens in layout/save/GNU/Linux/230_filesystem_layout.sh<br />
Because<br />
<a href="https://github.com/rear/rear/files/8318869/rear-OTT50-Host-1B-mkbackup.log">https://github.com/rear/rear/files/8318869/rear-OTT50-Host-1B-mkbackup.log</a><br />
contains</p>
<pre><code>2022-03-21 13:44:57.428361528 Including layout/save/GNU/Linux/230_filesystem_layout.sh
2022-03-21 13:44:57.429669431 Begin saving filesystem layout
2022-03-21 13:44:57.432069537 Saving filesystem layout (using the findmnt command).
2022-03-21 13:44:57.461560988 Processing filesystem 'xfs' on '/dev/mapper/vg00-backups' mounted at '/backups'
2022-03-21 13:44:57.640448151 Processing filesystem 'xfs' on '/dev/mapper/vg00-home' mounted at '/home'
2022-03-21 13:44:57.744970477 Processing filesystem 'xfs' on '/dev/mapper/vg00-opt' mounted at '/opt'
2022-03-21 13:44:57.887880604 Processing filesystem 'xfs' on '/dev/mapper/vg00-root' mounted at '/'
2022-03-21 13:44:58.074530745 Processing filesystem 'xfs' on '/dev/mapper/vg00-tmp' mounted at '/tmp'
2022-03-21 13:44:58.169939386 Processing filesystem 'xfs' on '/dev/mapper/vg00-upgrades' mounted at '/upgrades'
2022-03-21 13:44:58.256965993 Processing filesystem 'xfs' on '/dev/mapper/vg00-var' mounted at '/var'
2022-03-21 13:44:58.350765059 Processing filesystem 'xfs' on '/dev/mapper/vg00-var_lib_libvirt_images' mounted at '/var/lib/libvirt/images'
2022-03-21 13:44:58.548745820 Processing filesystem 'xfs' on '/dev/mapper/vg00-var_log' mounted at '/var/log'
2022-03-21 13:44:58.645453973 Processing filesystem 'xfs' on '/dev/mapper/vg00-var_log_audit' mounted at '/var/log/audit'
2022-03-21 13:44:58.702769030 Processing filesystem 'xfs' on '/dev/mapper/vg00-var_tmp' mounted at '/var/tmp'
2022-03-21 13:44:58.791070010 Processing filesystem 'vfat' on '/dev/sda1' mounted at '/boot/efi'
2022-03-21 13:44:58.828735651 Processing filesystem 'xfs' on '/dev/sda2' mounted at '/boot'
2022-03-21 13:44:58.879783279 End saving filesystem layout
</code></pre>
<p>the read_filesystems_command in 230_filesystem_layout.sh is</p>
<pre><code>findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs
</code></pre>
<p>so the mount options should be basically what findmnt shows as OPTIONS<br />
as far as I currently see what the code does.</p>
<h4 id="jsmeix_commented_at_2022-03-23_0901"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076116242">2022-03-23 09:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-23_0901" title="Permanent link">&para;</a></h4>
<p>@JKuhns5739<br />
please attach your original (unmodified) disklayout.conf file<br />
and what</p>
<pre><code>findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs
</code></pre>
<p>results on your system - if possible what it results on your original
system<br />
if you still have your original system running - or on another
sufficiently simliar<br />
system if you have several such systems with similar XFS running.<br />
A debug log file of "rear -d -D mkbackup" on your original system<br />
would also be hepful for us to better understand things.</p>
<h4 id="pcahyna_commented_at_2022-03-23_0929"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076145484">2022-03-23 09:29</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-23_0929" title="Permanent link">&para;</a></h4>
<blockquote>
<p>There is a hardcoded 512 so I wonder if that is actually always a
fixed value.</p>
</blockquote>
<p>@jsmeix mkfs.xfs(8) man page says:</p>
<pre><code>                   sunit=value
                          This  is  used to specify the stripe unit for a RAID
                          device or a logical volume.  The  value  has  to  be
                          specified in 512-byte block units.
</code></pre>
<p>It says nothing about any relation to the physical sector size. But you
can try it, if you have such a disk - documentation can be misleading
from time to time.</p>
<h4 id="jsmeix_commented_at_2022-03-23_0932"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076148612">2022-03-23 09:32</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-23_0932" title="Permanent link">&para;</a></h4>
<p>Sigh - sorry! Again I missed to just read the matching "fine manual"
;-)<br />
When the man page states a fixed value has to be used that vaule must be
hardcoded.</p>
<h4 id="pcahyna_commented_at_2022-03-23_1241"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076331700">2022-03-23 12:41</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-03-23_1241" title="Permanent link">&para;</a></h4>
<p>I tested it anyway on a 4096-sector-size disk (both physical and
logical).</p>
<pre><code># mkfs.xfs -d sunit=512 -d swidth=512
meta-data=/dev/dasdb1            isize=512    agcount=16, agsize=1126912 blks
         =                       sectsz=4096  attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=18030576, imaxpct=25
         =                       sunit=64     swidth=64 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=8803, version=2
         =                       sectsz=4096  sunit=1 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<p>I.e. same values as before, despite the fact that XFS correctly
recognizes the larger sector size <code>sectsz=4096</code>, it is still using 512
bytes as the multiplier for <code>sunit</code>, otherwise the values would not
match. So I conclude that the fine manual is accurate (this time).</p>
<h4 id="jkuhns5739_commented_at_2022-03-23_1249"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076338303">2022-03-23 12:49</a>:<a class="headerlink" href="#jkuhns5739_commented_at_2022-03-23_1249" title="Permanent link">&para;</a></h4>
<p>The system has been restored with Ansible scripts so it should be back
to its original values. This data also aligns with similar systems we
have.</p>
<pre><code>[root@OTT50-Host-1B ~]# findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t ext2,ext3,ext4,vfat,xfs,reiserfs,btrfs

/dev/mapper/vg00-root / xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/sda2 /boot xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-opt /opt xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/sda1 /boot/efi vfat rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro
/dev/mapper/vg00-backups /backups xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-var /var xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-tmp /tmp xfs rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-home /home xfs rw,nodev,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-upgrades /upgrades xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-var_tmp /var/tmp xfs rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-var_log /var/log xfs rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-var_log_audit /var/log/audit xfs rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
/dev/mapper/vg00-var_lib_libvirt_images /var/lib/libvirt/images xfs rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
</code></pre>
<p>Requested files:<br />
<a href="https://github.com/rear/rear/files/8333052/disklayout.conf.txt">disklayout.conf.txt</a><br />
<a href="https://github.com/rear/rear/files/8333076/rear-OTT50-Host-1B-Debug.log">rear-OTT50-Host-1B-Debug.log</a></p>
<h4 id="jsmeix_commented_at_2022-03-23_1350"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076398881">2022-03-23 13:50</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-23_1350" title="Permanent link">&para;</a></h4>
<p>The filesystem options in<br />
<a href="https://github.com/rear/rear/files/8333052/disklayout.conf.txt">https://github.com/rear/rear/files/8333052/disklayout.conf.txt</a><br />
are (cut and sorted)</p>
<pre><code>rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nodev,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro
rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota
</code></pre>
<p>In layout/save/GNU/Linux/230_filesystem_layout.sh the 'seclabel'
option is cut, cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L246">https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L246</a><br />
so the filesystem options in the findmnt output without the 'seclabel'
option in<br />
<a href="https://github.com/rear/rear/issues/2777#issuecomment-1076338303">https://github.com/rear/rear/issues/2777#issuecomment-1076338303</a><br />
are (cut and sorted)</p>
<pre><code>rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nodev,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro
rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota
</code></pre>
<p>The only remaining difference is that in the findmnt output there is
always</p>
<pre><code>... logbufs=8,logbsize=256k ...
</code></pre>
<p>while in disklayout.conf there is both</p>
<pre><code>... logbufs=8,logbsize=256k ...
... logbufs=8,logbsize=32k ...
</code></pre>
<p>In
<a href="https://github.com/rear/rear/files/8333076/rear-OTT50-Host-1B-Debug.log">https://github.com/rear/rear/files/8333076/rear-OTT50-Host-1B-Debug.log</a><br />
there is (excerpts):</p>
<pre><code>+ source /usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh
...
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,nodev,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,nosuid,nodev,noexec,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
++ echo -n ' options=rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro'
++ echo -n ' options=rw,relatime,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota'
</code></pre>
<p>so the disklayout.conf that was created by this run of "rear mkbackup"<br />
always has</p>
<pre><code>... logbufs=8,logbsize=256k ...
</code></pre>
<p>which matches what there is in the findmnt output.<br />
There is no <code>logbsize=32</code> in<br />
<a href="https://github.com/rear/rear/files/8333076/rear-OTT50-Host-1B-Debug.log">https://github.com/rear/rear/files/8333076/rear-OTT50-Host-1B-Debug.log</a></p>
<p>I assume that<br />
<a href="https://github.com/rear/rear/files/8333052/disklayout.conf.txt">https://github.com/rear/rear/files/8333052/disklayout.conf.txt</a><br />
is the original (unmodified) disklayout.conf file that<br />
caused the "rear recover" failure in this issue here<br />
and I assume the filesystem options in that disklayout.conf file<br />
also match what there is in the findmnt output when it was run<br />
at that time on that system where that disklayout.conf file was made.</p>
<p>I cannot explain why the filesystem options in the findmnt output<br />
at that time on that system where that disklayout.conf file was made<br />
seem to not have matched what the <code>xfs_info</code> command did output, cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L225">https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L225</a></p>
<p>During "rear mkrescue/mkbackup" the script<br />
layout/save/GNU/Linux/230_filesystem_layout.sh<br />
calls 'xfs_info' and stores its output in<br />
var/lib/rear/layout/xfs/XFS_DEVICE.xfs<br />
files where XFS_DEVICE is the basename of the device<br />
where the XFS filesystem is (e.g. sda2), cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L596">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L596</a></p>
<p>@JKuhns5739<br />
perhaps you still have your original <code>xfs_info</code> command output files<br />
that match your above attached<br />
<a href="https://github.com/rear/rear/files/8333052/disklayout.conf.txt">https://github.com/rear/rear/files/8333052/disklayout.conf.txt</a><br />
If yes, could you please also attach them?</p>
<h4 id="jkuhns5739_commented_at_2022-03-23_1532"><img src="https://avatars.githubusercontent.com/u/69595121?v=4" width="50"><a href="https://github.com/JKuhns5739">JKuhns5739</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1076492271">2022-03-23 15:32</a>:<a class="headerlink" href="#jkuhns5739_commented_at_2022-03-23_1532" title="Permanent link">&para;</a></h4>
<p>I don't have the original command output. I did create a backup log from
Host-1B mate unit, Host-1A, which is an identical system. The log file
includes both logbsizes of 32k and 256k.</p>
<pre><code>+++ mount -t xfs
++ '[' -n '/dev/mapper/vg00-root on / type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/sda2 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-opt on /opt type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-tmp on /tmp type xfs (rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var on /var type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-upgrades on /upgrades type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-home on /home type xfs (rw,nodev,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-backups on /backups type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var_tmp on /var/tmp type xfs (rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var_log on /var/log type xfs (rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var_log_audit on /var/log/audit type xfs (rw,nosuid,nodev,noexec,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var_lib_libvirt_images on /var/lib/libvirt/images type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=256k,sunit=512,swidth=512,noquota)
/dev/mapper/vg00-var on /var/lib/containers/storage/overlay type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,sunit=512,swidth=512,noquota)' ']'
</code></pre>
<p><a href="https://github.com/rear/rear/files/8334320/rear-OTt50-Host-1A.log">rear-OTt50-Host-1A.log</a></p>
<h4 id="jsmeix_commented_at_2022-03-24_1258"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1077600797">2022-03-24 12:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-03-24_1258" title="Permanent link">&para;</a></h4>
<p>In
<a href="https://github.com/rear/rear/files/8334320/rear-OTt50-Host-1A.log">https://github.com/rear/rear/files/8334320/rear-OTt50-Host-1A.log</a><br />
the options that <code>mount -t xfs</code> shows are the same as the options that<br />
<code>findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t xfs</code>shows<br />
and the latter ones get stored in disklayout.conf<br />
except the removed <code>seclabel</code> option<br />
and except the duplicated mounted</p>
<pre><code>/dev/mapper/vg00-var on /var ...
/dev/mapper/vg00-var on /var/lib/containers/storage/overlay ...
</code></pre>
<p>where the second one ("overlay") is skipped by
230_filesystem_layout.sh at<br />
"# Remove duplicate lines for the same device" which is currently at<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L41">https://github.com/rear/rear/blob/master/usr/share/rear/layout/save/GNU/Linux/230_filesystem_layout.sh#L41</a></p>
<p>So all looks well from what I can see in<br />
<a href="https://github.com/rear/rear/files/8334320/rear-OTt50-Host-1A.log">https://github.com/rear/rear/files/8334320/rear-OTt50-Host-1A.log</a></p>
<p>So it still looks as if <code>mkfs.xfs</code> (re)-creates the XFS with options<br />
from what is stored in the var/lib/rear/layout/xfs/XFS_DEVICE.xfs
files<br />
that then do not work for mounting it with the options in
disklayout.conf<br />
as shown in the "rear recover" log excerpt from<br />
<a href="https://github.com/rear/rear/files/8318871/rear-OTT50-Host-1B-recover.log">https://github.com/rear/rear/files/8318871/rear-OTT50-Host-1B-recover.log</a><br />
in<br />
<a href="https://github.com/rear/rear/issues/2777#issuecomment-1074861999">https://github.com/rear/rear/issues/2777#issuecomment-1074861999</a></p>
<p>But we don't have a <code>dmesg</code> output from the "rear recover" time
2022-03-21 18:40<br />
that may show more about what actually went wrong with XFS there.<br />
We only have<br />
<a href="https://github.com/rear/rear/files/8327383/rear-OTT50-Host-1B-dmesg.log">https://github.com/rear/rear/files/8327383/rear-OTT50-Host-1B-dmesg.log</a><br />
that is from a later time 2022-03-22 13:45<br />
likely after the manual recovery of the system by editing
disklayout.conf<br />
and removing most of the xfs options in<br />
<a href="https://github.com/rear/rear/issues/2777#issuecomment-1075428019">https://github.com/rear/rear/issues/2777#issuecomment-1075428019</a></p>
<p>Perhaps<br />
<a href="https://github.com/rear/rear/issues/2777#issuecomment-1075428019">https://github.com/rear/rear/issues/2777#issuecomment-1075428019</a><br />
points to a possible way to make "rear recover" more robust<br />
against subtle things with XFS mount options:</p>
<p>Currently during "rear recover" it mounts XFS filesystems<br />
with all those "fancy" options that have been reported by
<code>mount -t xfs</code><br />
and/or <code>findmnt -mnrv -o SOURCE,TARGET,FSTYPE,OPTIONS -t xfs</code><br />
at the time when "rear mkbackup" was run on the original system.</p>
<p>Probably in most cases all those "fancy" options are not needed<br />
to mount the (re)-created XFS during "rear recover"<br />
because all what is needed during "rear recover" is to get<br />
the filesystems mounted "sufficiently OK" so that it works<br />
to restore the files from backup into the empty (re)-created
filesystems.<br />
After "rear recover" the recreated system will be rebooted<br />
and then its filesystems get mounted according to what is<br />
stored in the restored config files from the backup.</p>
<p>So a possible way to make "rear recover" more robust<br />
against subtle things with XFS mount options<br />
could be to<br />
first try to mount the (re)-created XFS with all those "fancy" options<br />
but when this fails then try to mount it without any options as
fallback<br />
and only if also this fails stop with an error,<br />
cf. "Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<p>So in the <code>mount_fs()</code> function in<br />
layout/prepare/GNU/Linux/133_include_mount_filesystem_code.sh<br />
we may add a separated <code>case</code> for $fstype <code>(xfs)</code><br />
for example like (totally untested offhanded proposal):</p>
<pre><code>        (xfs)
            (
            echo "mkdir -p $TARGET_FS_ROOT$mountpoint"
            echo "if ! mount $mountopts $device $TARGET_FS_ROOT$mountpoint ; then"
            echo "    # Trying to mount without mount options as fallback"
            echo "    mount $device $TARGET_FS_ROOT$mountpoint"
            echo "fi"
            ) &gt;&gt; "$LAYOUT_CODE"
            ;;
</code></pre>
<p>Perhaps some standard XFS mount options might be useful also in the
fallback case<br />
but I am not at all a sufficient XFS expert to understand XFS specific
mount options.</p>
<p>I cannot imagine what should go worse with such a fallback attempt.<br />
If the fallback works to get the backup restored things should be OK,<br />
if not "rear recover" behaves as before i.e. it fails (only a bit
different).</p>
<p>@pcahyna<br />
what do you think about such kind of fallback behaviour?</p>
<h4 id="github-actions_commented_at_2022-06-05_0300"><img src="https://avatars.githubusercontent.com/in/15368?v=4" width="50"><a href="https://github.com/apps/github-actions">github-actions</a> commented at <a href="https://github.com/rear/rear/issues/2777#issuecomment-1146730338">2022-06-05 03:00</a>:<a class="headerlink" href="#github-actions_commented_at_2022-06-05_0300" title="Permanent link">&para;</a></h4>
<p>Stale issue message</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-03-21.2777.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
