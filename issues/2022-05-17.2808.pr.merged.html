<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2022 05 17.2808.pr.merged - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2022 05 17.2808.pr.merged";
        var mkdocs_page_input_path = "issues/2022-05-17.2808.pr.merged.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2022 05 17.2808.pr.merged</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2808_pr_merged_exclude_devwatchdog_from_recovery_system"><a href="https://github.com/rear/rear/pull/2808">#2808 PR</a> <code>merged</code>: Exclude dev/watchdog* from recovery system<a class="headerlink" href="#2808_pr_merged_exclude_devwatchdog_from_recovery_system" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="jsmeix_opened_issue_at_2022-05-17_1252"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/pull/2808">2022-05-17 12:52</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2022-05-17_1252" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Critical</strong><br />
    ("critical" because it is related to system crash in some cases)</p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2798">https://github.com/rear/rear/issues/2798</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    See
    <a href="https://github.com/rear/rear/issues/2798#issuecomment-1126145771">https://github.com/rear/rear/issues/2798#issuecomment-1126145771</a><br />
    and
    <a href="https://github.com/rear/rear/issues/2798#issuecomment-1127721378">https://github.com/rear/rear/issues/2798#issuecomment-1127721378</a></p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>In default.conf add dev/watchdog* to COPY_AS_IS_EXCLUDE<br />
because /dev/watchdog /dev/watchdog* functionality<br />
is not wanted in the ReaR rescue/recovery system<br />
because we do not want any automated reboot<br />
while disaster recovery happens via "rear recover".<br />
Furthermore having dev/watchdog* during "rear mkrescue"<br />
may even trigger a system "crash" that is caused by<br />
TrendMicro ds_am module touching dev/watchdog<br />
in ReaR's build area (/var/tmp/rear.XXX/rootfs).</p>
<h4 id="gdha_commented_at_2022-05-18_0758"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129693611">2022-05-18 07:58</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-18_0758" title="Permanent link">&para;</a></h4>
<p>@jsmeix Be careful, by adding this device to COPY_AS_IS_EXCLUDE it is
also excluded from the tar archive (with BACKUP=NETFS). We need to
recreate this device after recovery. Perhaps, with an extra small
script?</p>
<h4 id="gdha_commented_at_2022-05-18_0800"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129695461">2022-05-18 08:00</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-18_0800" title="Permanent link">&para;</a></h4>
<p>FYI - TrendMicro is working on a hotfix to prevent crashes with their
product due to /dev/watchdog.</p>
<h4 id="jsmeix_commented_at_2022-05-18_1110"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129876267">2022-05-18 11:10</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-18_1110" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
I don't find code that things in COPY_AS_IS_EXCLUDE<br />
are also excluded from the tar archive (with BACKUP=NETFS):</p>
<pre><code># find usr/sbin/rear usr/share/rear -type f | xargs grep 'COPY_AS_IS_EXCLUDE' | egrep -v 'COPY_AS_IS_EXCLUDE_|COPY_AS_IS_EXCLUDE\+=| *#'

usr/share/rear/build/GNU/Linux/100_copy_as_is.sh:Log "Files being excluded: ${COPY_AS_IS_EXCLUDE[@]}"
usr/share/rear/build/GNU/Linux/100_copy_as_is.sh:for excluded_file in "${COPY_AS_IS_EXCLUDE[@]}" ; do
usr/share/rear/build/GNU/Linux/100_copy_as_is.sh:    Error "Failed to copy files and directories in COPY_AS_IS minus COPY_AS_IS_EXCLUDE"
usr/share/rear/build/GNU/Linux/100_copy_as_is.sh:Log "Finished copying files and directories in COPY_AS_IS minus COPY_AS_IS_EXCLUDE"

usr/share/rear/conf/default.conf:COPY_AS_IS_EXCLUDE=( $VAR_DIR/output/\* dev/.udev dev/shm dev/shm/\* dev/oracleasm dev/mapper )
</code></pre>
<p>As far as I see build/GNU/Linux/100_copy_as_is.sh<br />
is the only place where COPY_AS_IS_EXCLUDE is evaluated<br />
therein in this code (excerpts):</p>
<pre><code>local copy_as_is_exclude_file="$TMP_DIR/copy-as-is-exclude"
...
for excluded_file in "${COPY_AS_IS_EXCLUDE[@]}" ; do
    echo "$excluded_file"
done &gt;$copy_as_is_exclude_file
...
if ! tar -v -X $copy_as_is_exclude_file -P -C / -c ${COPY_AS_IS[*]} 2&gt;$copy_as_is_filelist_file | tar $v -C $ROOTFS_DIR/ -x 1&gt;/dev/null ; then
    Error "Failed to copy files and directories in COPY_AS_IS minus COPY_AS_IS_EXCLUDE"
fi
</code></pre>
<p>where <code>copy_as_is_exclude_file</code> only appears in<br />
build/GNU/Linux/100_copy_as_is.sh<br />
and the file name <code>copy-as-is-exclude</code> also only appears in<br />
build/GNU/Linux/100_copy_as_is.sh</p>
<p>So I see no relation between COPY_AS_IS_EXCLUDE<br />
and what is in the backup.</p>
<p>I think if there was a relation between COPY_AS_IS_EXCLUDE<br />
and what is in the backup it could be a severe bug<br />
(unexpectedly suppressed files from the backup)<br />
because COPY_AS_IS_EXCLUDE should only belong to<br />
what gets excluded from the ReaR recovery system.</p>
<h4 id="jsmeix_commented_at_2022-05-18_1126"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129890669">2022-05-18 11:26</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-18_1126" title="Permanent link">&para;</a></h4>
<p>@gdha<br />
do you perhaps remember our meanwhile removed<br />
finalize/default/100_populate_dev.sh<br />
cf.
<a href="https://github.com/rear/rear/issues/2045#issuecomment-464737610">https://github.com/rear/rear/issues/2045#issuecomment-464737610</a><br />
which we now have in a modified form in<br />
finalize/default/110_bind_mount_proc_sys_dev_run.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/finalize/default/110_bind_mount_proc_sys_dev_run.sh">https://github.com/rear/rear/blob/master/usr/share/rear/finalize/default/110_bind_mount_proc_sys_dev_run.sh</a><br />
as a workaround for older systems when it does not work<br />
to bind-mount /dev on TARGET_FS_ROOT/dev<br />
cf.
<a href="https://github.com/rear/rear/pull/2113">https://github.com/rear/rear/pull/2113</a></p>
<h4 id="pcahyna_commented_at_2022-05-18_1138"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129901289">2022-05-18 11:38</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-18_1138" title="Permanent link">&para;</a></h4>
<p>Sorry, I still don't understand how the issue arises and how does this
PR fix it. What is the process triggering the crash? From the
description of the issue it looks like there is a process opening the
device file and not closing it, but how is ReaR doing it? In
<code>usr/share/rear/build/GNU/Linux/100_copy_as_is.sh</code> seems to copy files
using <code>tar -c ... | tar -x</code>, and <code>tar</code> does not open device files (I
checked). If there is a process opening device special files, it can
lead to other problems (IIRC tapes can get rewound if you open and close
the corresponding device, for example.)</p>
<p>(The issue and comment mentions TrendMicro ds_am module, sorry for my
ignorance, I don't know what it is and why is it related.)</p>
<h4 id="gdha_commented_at_2022-05-18_1156"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129916296">2022-05-18 11:56</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-18_1156" title="Permanent link">&para;</a></h4>
<p>@pcahyna</p>
<blockquote>
<p>Sorry, I still don't understand how the issue arises and how does this
PR fix it. What is the process triggering the crash? From the
description of the issue it looks like there is a process opening the
device file and not closing it, but how is ReaR doing it? In
<code>usr/share/rear/build/GNU/Linux/100_copy_as_is.sh</code> seems to copy files
using <code>tar -c ... | tar -x</code>, and <code>tar</code> does not open device files (I
checked). If there is a process opening device special files, it can
lead to other problems (IIRC tapes can get rewound if you open and
close the corresponding device, for example.)</p>
<p>(The issue and comment mentions TrendMicro ds_am module, sorry for my
ignorance, I don't know what it is and why is it related.)</p>
</blockquote>
<p>The <code>tar</code> command archives the complete /dev to the rescue image, which
is sufficient to trigger TrendMicro ds_am module to trigger the crash.
TrendMicro acknowledged that this is a bug and they are working on a
fix.</p>
<h4 id="jsmeix_commented_at_2022-05-18_1159"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1129918614">2022-05-18 11:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-18_1159" title="Permanent link">&para;</a></h4>
<p>I made this PR only based on what I read on<br />
<a href="https://github.com/rear/rear/issues/2798">https://github.com/rear/rear/issues/2798</a></p>
<p>In particular I do not understand what "crash" means therein.<br />
As far as I understand what I read about /dev/watchdog<br />
an automated reboot happens when there is no write<br />
to /dev/watchdog for a certain time.<br />
So I guess there was no actual "crash" in<br />
<a href="https://github.com/rear/rear/issues/2798">https://github.com/rear/rear/issues/2798</a><br />
but just the automated reboot happened all of a sudden<br />
which looks to the user as if the system had crashed.</p>
<p>Regarding "TrendMicro ds_am module touch dev/watchdog<br />
under the /tmp/rear.XXXX directory":<br />
On my homeoffice laptop after a "rear mkrescue" (yesterday)<br />
without the change in this PR I have</p>
<pre><code># ls -l /var/tmp/rear.IuB8N948ZgRegGv/rootfs/dev/watchdog*
crw------- 1 root root  10, 130 May 17 08:45 /var/tmp/rear.IuB8N948ZgRegGv/rootfs/dev/watchdog
crw------- 1 root root 248,   0 May 17 08:45 /var/tmp/rear.IuB8N948ZgRegGv/rootfs/dev/watchdog0
</code></pre>
<p>which are the same device major and minor numbers<br />
as on my original system</p>
<pre><code># ls -l /dev/watchdog*
crw------- 1 root root  10, 130 May 18 09:55 /dev/watchdog
crw------- 1 root root 248,   0 May 18 09:55 /dev/watchdog0
</code></pre>
<p>so /dev/watchdog* in /var/tmp/rear.XXX/rootfs<br />
are device nodes that behave same as the original ones.<br />
Accordingly when some strange software writes to<br />
a /dev/watchdog* in /var/tmp/rear.XXX/rootfs<br />
and leaves it as is (i.e. no further writes)<br />
the automated watchdog reboot happens.<br />
At least that is how I imagine what actually happens.<br />
But I am not at all a watchdog expert - I learned about<br />
its existence via
<a href="https://github.com/rear/rear/issues/2798">https://github.com/rear/rear/issues/2798</a></p>
<h4 id="gdha_commented_at_2022-05-18_1345"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1130038215">2022-05-18 13:45</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-18_1345" title="Permanent link">&para;</a></h4>
<p>@jsmeix A "crash" means a system panic - see
<a href="https://github.com/rear/rear/issues/2798#issuecomment-1119659939">https://github.com/rear/rear/issues/2798#issuecomment-1119659939</a></p>
<h4 id="jsmeix_commented_at_2022-05-19_1058"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131545357">2022-05-19 10:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-19_1058" title="Permanent link">&para;</a></h4>
<p>A side note only for the "fun" of it:<br />
It seems the TrendMicro cyber security software<br />
sometimes messes around too much with kernel stuff<br />
so the only way out for the kernel is to give up like<br />
<a href="https://access.redhat.com/solutions/3100321">https://access.redhat.com/solutions/3100321</a><br />
and it seems things don't always improve when several<br />
security software things are running concurrently like<br />
<a href="https://www.ibm.com/support/pages/ibm-security-guardium-potential-linux-kernel-reboot-when-running-trendmicro-deep-security-agent-and-guardium-stap-same-linux-server">https://www.ibm.com/support/pages/ibm-security-guardium-potential-linux-kernel-reboot-when-running-trendmicro-deep-security-agent-and-guardium-stap-same-linux-server</a></p>
<h4 id="jsmeix_commented_at_2022-05-19_1101"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131547333">2022-05-19 11:01</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-19_1101" title="Permanent link">&para;</a></h4>
<p>I think the crucial question here is:<br />
Are /dev/watchdog* of any use inside the recovery system or not.</p>
<h4 id="gdha_commented_at_2022-05-19_1159"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131598647">2022-05-19 11:59</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-19_1159" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I think the crucial question here is: Are /dev/watchdog* of any use
inside the recovery system or not.</p>
</blockquote>
<p>The watchdog devices are not required during recovery. However, we have
to make sure that these devices are recovered (by the backup) or
recreated somehow.</p>
<h4 id="jsmeix_commented_at_2022-05-19_1359"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131728955">2022-05-19 13:59</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-19_1359" title="Permanent link">&para;</a></h4>
<p>I think nowadays /dev/ is only a mountpoint<br />
(i.e. /dev/ itself is initially an empty directory)<br />
and it is the special filesystem that is mounted at /dev/<br />
which lets "somehow magically" device nodes appear therein<br />
(e.g. via devtmpfs mounted at /dev/ together with udev).</p>
<p>So there should be no need to specially care about<br />
the device nodes in the rebooted recreated system<br />
(neither in the backup nor to recreate them by ReaR).</p>
<p>All what is needed is that the recreated system will mount<br />
"the right thing" at /dev/ same as on the original system.<br />
I think there is nothing what ReaR has to actively do<br />
ruring "rear recover" to make that happen.<br />
Only restoring all basic system files from the backup<br />
(in particular kernel, udev, init/systemd, and so on)<br />
should be sufficient so that after reboot the recreated<br />
system will again mount "the right thing" at /dev/.</p>
<p>But I am not an expert regarding populating /dev/<br />
so I may misunderstand things.</p>
<p>Cf.<br />
<a href="https://unix.stackexchange.com/questions/619589/is-it-necessary-to-mount-devtmpfs-with-etc-fstab">https://unix.stackexchange.com/questions/619589/is-it-necessary-to-mount-devtmpfs-with-etc-fstab</a></p>
<h4 id="gdha_commented_at_2022-05-19_1406"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131738351">2022-05-19 14:06</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-19_1406" title="Permanent link">&para;</a></h4>
<p>@jsmeix I don't know if the device will automatically be recreated or
not. Not without testing it out. However, these were production systems
which cannot be scraped to test it out. On the other hand, a missing
device can easlily be recreated by hand.</p>
<h4 id="pcahyna_commented_at_2022-05-19_1710"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1131971862">2022-05-19 17:10</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-05-19_1710" title="Permanent link">&para;</a></h4>
<p>For me another question is, do we want to make changes that do not fix
any issue in ReaR (nor in the OS or backup tool that ReaR is intended to
integrate with), but in a 3rd party tool that has nothing to do with
ReaR? I can see the value for users, but on the other hand such
workarounds clutter and complicate the code. (Fortunately this change is
simple and also well documented, so I am inclined to say yes, but I am
not entirely sure it is a good idea in general.)</p>
<h4 id="gdha_commented_at_2022-05-20_0636"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1132528680">2022-05-20 06:36</a>:<a class="headerlink" href="#gdha_commented_at_2022-05-20_0636" title="Permanent link">&para;</a></h4>
<p>Perhaps we better make some proper documentation around it as it is
indeed not a flaw in ReaR. ReaR only suffers by it.</p>
<h4 id="jsmeix_commented_at_2022-05-20_0700"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1132544204">2022-05-20 07:00</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-20_0700" title="Permanent link">&para;</a></h4>
<p>@pcahyna<br />
yes, we do want to make changes in ReaR<br />
that do not fix any issue in ReaR itself<br />
but that avoid bugs in whatever non-ReaR stuff,<br />
see the section "Dirty hacks welcome" in<br />
<a href="https://github.com/rear/rear/wiki/Coding-Style">https://github.com/rear/rear/wiki/Coding-Style</a></p>
<h4 id="jsmeix_commented_at_2022-05-20_0712"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1132556033">2022-05-20 07:12</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-20_0712" title="Permanent link">&para;</a></h4>
<p>Now the question is whether or not<br />
the change in this pull request is a dirty hack.</p>
<p>My current point of view is:</p>
<p>In general /dev/watchdog* inside the recovery system<br />
does not make sense so it should be excluded in general.</p>
<p>The issue
<a href="https://github.com/rear/rear/issues/2798">https://github.com/rear/rear/issues/2798</a><br />
was only the reason to think about whether or not<br />
/dev/watchdog* should be in the recovery system.</p>
<p>So the change in this pull request is not a dirty hack<br />
and I made my comments in the code accordingly<br />
(i.e. first the generic reason then the special case<br />
that it avoids a crash under special circumstances).</p>
<p>I would not have done this pull request if I thought that<br />
in general /dev/watchdog* should be in the recovery system<br />
because then I would not exclude it from the recovery system<br />
in default.conf but leave it to the specific users<br />
of the buggy TrendMicro cyber security software<br />
to deal with it specifically on their own via</p>
<pre><code>COPY_AS_IS_EXCLUDE+=( dev/watchdog\* )
</code></pre>
<p>in their etc/rear/local.conf</p>
<h4 id="jsmeix_commented_at_2022-05-20_0714"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1132558386">2022-05-20 07:14</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-20_0714" title="Permanent link">&para;</a></h4>
<p>@gdha @pcahyna<br />
if you regard the change in this pull request as a dirty hack<br />
I think this pull request should not be merged.</p>
<h4 id="jsmeix_commented_at_2022-05-20_0723"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1132569411">2022-05-20 07:23</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-20_0723" title="Permanent link">&para;</a></h4>
<p>What I could currently imagine why /dev/watchdog*<br />
could be even useful in the recovery system<br />
is a use case of some kind of unattended "rear recover"<br />
where a user has also some additional special things<br />
set up in his recovery system to let it automatically reboot<br />
when his recovery system "hangs up" or becomes unresponsive.<br />
Because ReaR does not provide any watchdog functionality<br />
such a use case would again be some "third-party issue"<br />
(here some additional third party watchdog functionality).<br />
I think even then excluding /dev/watchdog* in default.conf<br />
should be still OK because we cannot make default.conf<br />
to be right for every possible additional special things.</p>
<h4 id="jsmeix_commented_at_2022-05-23_0829"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1134352830">2022-05-23 08:29</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-23_0829" title="Permanent link">&para;</a></h4>
<p>I overestimated this pull request to be a "blocker"<br />
(i.e. that we won't release ReaR 2.7 without a solution for it).</p>
<p>Actually it cannot be a blocker when an issue is caused<br />
by some special (and not often used) third-party software,<br />
in particular not when a solution exists how affected users can<br />
avoid that the bug in their third-party software affects ReaR.</p>
<p>In general it is not ReaR's job to avoid (or work around)<br />
that a bug in third-party software may cause "bad things".</p>
<h4 id="jsmeix_commented_at_2022-05-25_1153"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2808#issuecomment-1137146930">2022-05-25 11:53</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-25_1153" title="Permanent link">&para;</a></h4>
<p>I tested it myself:<br />
The only difference in /var/tmp/rear.XXX/rootfs/dev is<br />
that dev/watchdog and dev/watchdog0 are no longer there.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-05-17.2808.pr.merged.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
