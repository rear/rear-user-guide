<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2786 PR closed: Print error if UUID not updated - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2786 PR closed: Print error if UUID not updated";
        var mkdocs_page_input_path = "issues/2022-04-07.2786.pr.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2786 PR closed: Print error if UUID not updated</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2786_pr_closed_print_error_if_uuid_not_updated"><a href="https://github.com/rear/rear/pull/2786">#2786 PR</a> <code>closed</code>: Print error if UUID not updated<a class="headerlink" href="#2786_pr_closed_print_error_if_uuid_not_updated" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>won't fix / can't fix / obsolete</code></p>
<h4 id="bwelterl_opened_issue_at_2022-04-07_1147"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> opened issue at <a href="https://github.com/rear/rear/pull/2786">2022-04-07 11:47</a>:<a class="headerlink" href="#bwelterl_opened_issue_at_2022-04-07_1147" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_pull_request_template">Relax-and-Recover (ReaR) Pull Request Template<a class="headerlink" href="#relax-and-recover_rear_pull_request_template" title="Permanent link">&para;</a></h4>
<p>Please fill in the following items before submitting a new pull request:</p>
<h5 id="pull_request_details">Pull Request Details:<a class="headerlink" href="#pull_request_details" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Type: <strong>Enhancement</strong></p>
</li>
<li>
<p>Impact: <strong>Normal</strong></p>
</li>
<li>
<p>Reference to related issue (URL):<br />
<a href="https://github.com/rear/rear/issues/2785">https://github.com/rear/rear/issues/2785</a></p>
</li>
<li>
<p>How was this pull request tested?<br />
    internally</p>
</li>
<li>
<p>Brief description of the changes in this pull request:</p>
</li>
</ul>
<p>Instead of just checking the return code of sed (which is 1 even if no
patch is done)</p>
<pre><code>    sed  "$sed_script" "$restored_file" || LogPrintError "Migrating filesystem UUIDs in $restored_file to current UUIDs failed";
</code></pre>
<p>I suggest to check if the file was really modified and print an error if
not:</p>
<pre><code>    LogPrint "Patching filesystem UUIDs in $restored_file to current UUIDs"
    # Do not error out at this late state of "rear recover" (after the backup was restored) but inform the user:
    sed -i.prerear "$sed_script" "$restored_file" || LogPrintError "Migrating filesystem UUIDs in $restored_file to current UUIDs failed";

    # sed does not print an error if the pattern is not found in the file, thus we keep a backup and compare it to patched file:
    if test -f "$restored_file".prerear; then
        diff "$restored_file" "$restored_file".prerear  &gt;&amp;2 &amp;&amp; LogPrintError "WARNING: File $restored_file has not been modified during UUID migration, please check if the old UUID is correct: sed script: *$sed_script *"
        rm -f "$restored_file".prerear
    fi
</code></pre>
<p>Please note: This will not cover the case when multiple UUID must be
updated and only one is not...<br />
And also, we will have false warning because some files should not be
updated (/etc/default/grub for example).<br />
A deeper modification might be necessary to have a sed script for each
UUID, thus we will be able to detect which one is missing when it should
be (but even in this case, false warning will appear).</p>
<h4 id="jsmeix_commented_at_2022-04-07_1156"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091644975">2022-04-07 11:56</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-07_1156" title="Permanent link">&para;</a></h4>
<p>@bwelterl<br />
thank you for your fix!<br />
I will have a look tomorrow (if nothing gets in my way).</p>
<h4 id="pcahyna_commented_at_2022-04-07_1244"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091689855">2022-04-07 12:44</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-07_1244" title="Permanent link">&para;</a></h4>
<p>I believe the selinux changes should not be there, they belong to a
different PR.</p>
<h4 id="bwelterl_commented_at_2022-04-07_1249"><img src="https://avatars.githubusercontent.com/u/32841830?v=4" width="50"><a href="https://github.com/bwelterl">bwelterl</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091694576">2022-04-07 12:49</a>:<a class="headerlink" href="#bwelterl_commented_at_2022-04-07_1249" title="Permanent link">&para;</a></h4>
<blockquote>
<p>I believe the selinux changes should not be there, they belong to a
different PR.</p>
</blockquote>
<p>ooops thanks, the PR is only on
usr/share/rear/finalize/GNU/Linux/280_migrate_uuid_tags.sh ...</p>
<h4 id="pcahyna_commented_at_2022-04-07_1253"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091698822">2022-04-07 12:53</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-07_1253" title="Permanent link">&para;</a></h4>
<p>Thanks for the PR, but I am afraid this will not work as expected. What
if the file does not contain the UUID at all, therefore does not require
patching? You mention <code>/etc/default/grub</code>, but there are other cases
(there is no requirement to mount devices by UUID in fstab, you can
mount them by label or by device path), so in many cases it is entirely
OK that sed does not patch anything. Lots of false warning will be
printed and either scare the user, or will be ignored.</p>
<h4 id="pcahyna_commented_at_2022-04-07_1304"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091710832">2022-04-07 13:04</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-07_1304" title="Permanent link">&para;</a></h4>
<p>I have another idea for detecting these kinds of problems. Could
<code>mkrescue</code> save checksums of all the files that need to be patched,
<code>recover</code> check them before patching them, and if any checksum differs,
warn?</p>
<h4 id="jsmeix_commented_at_2022-04-07_1447"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091833759">2022-04-07 14:47</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-07_1447" title="Permanent link">&para;</a></h4>
<p>Regarding checksums of (config) files, cf.<br />
layout/compare/default/510_compare_files.sh</p>
<p>This is currently only run in case of "rear checklayout",<br />
cf. lib/checklayout-workflow.sh<br />
but we could do something like that also for "rear mkrescue".</p>
<p>Furthermore we could clean up things by using only the<br />
already existing CHECK_CONFIG_FILES array<br />
(or a more general similar array) in default.conf<br />
everywhere instead of hardcoded file lists in scripts like<br />
finalize/GNU/Linux/280_migrate_uuid_tags.sh</p>
<p>This would also provide "final power to the user"<br />
when the user can specify what files to check and migrate<br />
if the default array setting is not what he needs.</p>
<h4 id="pcahyna_commented_at_2022-04-07_1533"><img src="https://avatars.githubusercontent.com/u/26300485?u=9105d243bc9f7ade463a3e52e8dd13fa67837158&v=4" width="50"><a href="https://github.com/pcahyna">pcahyna</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1091885729">2022-04-07 15:33</a>:<a class="headerlink" href="#pcahyna_commented_at_2022-04-07_1533" title="Permanent link">&para;</a></h4>
<p>The larger issue is what to do when a checksum mismatch is detected -
the recovered system is likely broken then and it is too late to produce
a correct/consistent backup.<br />
Of course, any "Print error" approach, such as the one in this PR, will
suffer from the same problem.</p>
<h4 id="jsmeix_commented_at_2022-04-08_1325"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1092858089">2022-04-08 13:25</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-04-08_1325" title="Permanent link">&para;</a></h4>
<p>I think what @bwelterl intends is to only detect<br />
when the recovered system could be broken<br />
so he could manually fix things after "rear recover"<br />
in the still running recovery system<br />
in contrast to now where all looks well<br />
but then the recreated system fails to boot.</p>
<h4 id="jsmeix_commented_at_2022-05-05_1041"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/pull/2786#issuecomment-1118408874">2022-05-05 10:41</a>:<a class="headerlink" href="#jsmeix_commented_at_2022-05-05_1041" title="Permanent link">&para;</a></h4>
<p>This pull request should be obsoleted by<br />
<a href="https://github.com/rear/rear/pull/2795">https://github.com/rear/rear/pull/2795</a><br />
which implements a more generic check to detect<br />
when restored basic system files do not match the recreated system.</p>
<p>@bwelterl<br />
if possible for you please test our current ReaR GitHub master code,<br />
see the section<br />
"Testing current ReaR upstream GitHub master code" in<br />
<a href="https://en.opensuse.org/SDB:Disaster_Recovery">https://en.opensuse.org/SDB:Disaster_Recovery</a></p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2022-04-07.2786.pr.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
