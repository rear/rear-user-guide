<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2400 Issue closed: Include mounting nfs capability in rescue ISO to mount Amazon S3 like cloud storage buckets - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2400 Issue closed: Include mounting nfs capability in rescue ISO to mount Amazon S3 like cloud storage buckets";
        var mkdocs_page_input_path = "issues/2020-05-18.2400.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/netfs_nas.html">Internal Backup with tar to NFS server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/rbme.html">External Backup using RBME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/restic.html">External Backup using restic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/squash-git-log-commments.html">How to squash git log comments into one line</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear29.html">Release Notes ReaR 2.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2400 Issue closed: Include mounting nfs capability in rescue ISO to mount Amazon S3 like cloud storage buckets</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2400_issue_closed_include_mounting_nfs_capability_in_rescue_iso_to_mount_amazon_s3_like_cloud_storage_buckets"><a href="https://github.com/rear/rear/issues/2400">#2400 Issue</a> <code>closed</code>: Include mounting nfs capability in rescue ISO to mount Amazon S3 like cloud storage buckets<a class="headerlink" href="#2400_issue_closed_include_mounting_nfs_capability_in_rescue_iso_to_mount_amazon_s3_like_cloud_storage_buckets" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>support / question</code>, <code>fixed / solved / done</code></p>
<h4 id="ase7en34_opened_issue_at_2020-05-18_0650"><img src="https://avatars.githubusercontent.com/u/65528374?v=4" width="50"><a href="https://github.com/ase7en34">ase7en34</a> opened issue at <a href="https://github.com/rear/rear/issues/2400">2020-05-18 06:50</a>:<a class="headerlink" href="#ase7en34_opened_issue_at_2020-05-18_0650" title="Permanent link">&para;</a></h4>
<h4 id="relax-and-recover_rear_issue_template">Relax-and-Recover (ReaR) Issue Template<a class="headerlink" href="#relax-and-recover_rear_issue_template" title="Permanent link">&para;</a></h4>
<p>Fill in the following items before submitting a new issue<br />
(quick response is not guaranteed with free support):</p>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"):<br />
    Relax-and-Recover 2.5 / Git</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    RedHat 7</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):</p>
</li>
</ul>
<!-- -->

<pre><code>OUTPUT=ISO
BACKUP=NETFS
OUTPUT_URL=file:///s3fs
BACKUP_URL=file:///s3fs
BACKUP_PROG_EXCLUDE=("${BACKUP_PROG_EXCLUDE[@]}" '/tmp/*' '/var/tmp/*' )
USE_DHCLIENT=yes
COPY_AS_IS=( "${COPY_AS_IS[@]}" /root/.passwd-s3fs )
PROGS=( "${PROGS[@]}" s3fs )
</code></pre>
<p>Hello all,</p>
<p>first I would like to tank you for your efforts and for this great piece
of code.</p>
<p>I have a following question regarding backups on Amazon S3 like bucked
cloud provider.</p>
<p>We have access to cloud storage via buckets. For integrating with ReaR
we have installed back-end ( f3fs utility ) which can mount such bucket
as local directory. Creating backups are working for now - tar archives
created without any errors, however we have difficulties mounting this
file system in rescue mode. When trying to mount with s3fs we have got
following error:</p>
<pre><code>s3fs: There is no enough disk space for used as cache or (temporary) directory for s3fs
</code></pre>
<p>We have tried some methods to solve this like creating of ramfs or tmpfs
and mounting in /tmp/ramfs, but without success. Also options like
nocache, use_cachedir did not helped us, error remains same.</p>
<p>We know that you are not responsible for s3fs code, but we are wondering
if we include mount.nfs in PROGS[@] variable we will be able to mount
remote NFS server which already serve mounted via S3FS bucket and this
way to complete the recover.</p>
<p>I need to mention that this NFS server is not always switched on and
will be started only when recover/migration/newmachine tasks are needed.
Also for now there is no way to create template from existing machine
and deploy it as new one - therefore we need to use tool like ReaR.</p>
<p>Many thanks in advance.</p>
<h4 id="jsmeix_commented_at_2020-05-18_1522"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-630255235">2020-05-18 15:22</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-18_1522" title="Permanent link">&para;</a></h4>
<p>I know nothing about Amazon S3 like cloud storage via buckets.</p>
<p>The ReaR recovery system is minimal so it contains by default<br />
only those programs that are needed to run "rear recover" with the<br />
same etc/rear/local.conf that was used for "rear mkrescue/mkbackup".<br />
The ReaR recovery system runs in main memory via a ramdisk<br />
so it should not be bigger than what is actually needed<br />
to not waste main memory space.<br />
Furthermore the ReaR recovery system is specific for each host<br />
where "rear mkrescue/mkbackup" was run so you need to<br />
store a separated ReaR recovery system for each host<br />
(together with the backup of the files of each host)<br />
so it should not be bigger than what is actually needed<br />
to not waste backup storage space.</p>
<p>With <code>BACKUP_URL=file://</code> no NFS mount tools get<br />
automatically included in the ReaR recovery system.</p>
<p>In contrast with <code>BACKUP_URL=nfs://</code> NFS mount tools get<br />
automatically included in the ReaR recovery system.</p>
<p>So I think the simplest and most straightforward way is to<br />
use <code>BACKUP_URL=nfs://</code> and have your NFS server also<br />
switched on when you run "rear mkrescue/mkbackup".</p>
<p>Then things are consistent during "rear mkrescue/mkbackup"<br />
with what will happen later during "rear recover".</p>
<p>If you really must use "rear mkrescue/mkbackup" in an<br />
environment that is inconsistent with the one where<br />
"rear recover" will happen later, then<br />
you must manually work around those inconsistencies<br />
by manually specifying the additionally needed programs<br />
for your "rear recover" environment via the generic config arrays<br />
COPY_AS_IS, LIBS, PROGS, and REQUIRED_PROGS,<br />
see their description in default.conf in particular<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1334">https://github.com/rear/rear/blob/master/usr/share/rear/conf/default.conf#L1334</a></p>
<h4 id="gdha_commented_at_2020-05-19_0940"><img src="https://avatars.githubusercontent.com/u/888633?u=cdaeb31efcc0048d3619651aa18dd4b76e636b21&v=4" width="50"><a href="https://github.com/gdha">gdha</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-630709646">2020-05-19 09:40</a>:<a class="headerlink" href="#gdha_commented_at_2020-05-19_0940" title="Permanent link">&para;</a></h4>
<p>@ase7en34 Why not prepare a pull request for mounting s3fs buckets? It
can be done similar as we did for sshfs.<br />
Start with the script
<code>prep/NETFS/default/050_check_NETFS_requirements.sh</code> and
<code>lib/global-functions.sh</code><br />
It is not complicated - just tested it out to mount an AWS s3 bucket
with s3fs.</p>
<h4 id="ase7en34_commented_at_2020-05-19_1932"><img src="https://avatars.githubusercontent.com/u/65528374?v=4" width="50"><a href="https://github.com/ase7en34">ase7en34</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-631036075">2020-05-19 19:32</a>:<a class="headerlink" href="#ase7en34_commented_at_2020-05-19_1932" title="Permanent link">&para;</a></h4>
<p>Hello all,</p>
<p>many thanks for your answers.<br />
@gdha honestly I'm not a script guy - it is too complicated to me with
all that functions and variables. I need to satisfy with what I have.
Meanwhile I managed to include mount.nfs binary in rescue media and
successfully completed the restore.</p>
<h4 id="jsmeix_commented_at_2020-05-20_0706"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-631280520">2020-05-20 07:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-05-20_0706" title="Permanent link">&para;</a></h4>
<p>@ase7en34<br />
according to your<br />
<a href="https://github.com/rear/rear/issues/2400#issuecomment-631036075">https://github.com/rear/rear/issues/2400#issuecomment-631036075</a><br />
I assume the issue is solved for you so that I can close it hereby.</p>
<p>@gdha<br />
according to what @ase7en34 wrote in his initial comment (excerpts)</p>
<pre><code>PROGS=( "${PROGS[@]}" s3fs )
...
we have difficulties mounting this file system
in rescue mode. When trying to mount
with s3fs we have got following error:

s3fs: There is no enough disk space for used
as cache or (temporary) directory for s3fs

We have tried some methods to solve this
like creating of ramfs or tmpfs and mounting
in /tmp/ramfs, but without success.
Also options like nocache, use_cachedir
did not helped us, error remains same.
</code></pre>
<p>it seems it could become a rather tricky task<br />
to prepare the recovery system to successfully<br />
mount Amazon S3 like cloud storage buckets<br />
from within the recovery system.</p>
<h4 id="jsmeix_commented_at_2020-07-24_1151"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-663501888">2020-07-24 11:51</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-07-24_1151" title="Permanent link">&para;</a></h4>
<p>Regarding<br />
"there is no enough disk space for used as cache or (temporary)
directory"<br />
in the ReaR recovery system:</p>
<p>I noticed by chance<br />
restore/GALAXY/default/390_create_ramdisk.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/restore/GALAXY/default/390_create_ramdisk.sh">https://github.com/rear/rear/blob/master/usr/share/rear/restore/GALAXY/default/390_create_ramdisk.sh</a><br />
and the two identical<br />
verify/GALAXY7/default/390_create_ramdisk.sh<br />
verify/GALAXY10/default/390_create_ramdisk.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/verify/GALAXY10/default/390_create_ramdisk.sh">https://github.com/rear/rear/blob/master/usr/share/rear/verify/GALAXY10/default/390_create_ramdisk.sh</a><br />
which are old code (that was not actually maintained since more than 10
years)<br />
but it may at least indicate what one might do to get<br />
"enough disk space for used as cache or (temporary) directory"<br />
in the ReaR recovery system.</p>
<p>There is also<br />
verify/DUPLICITY/default/200_check_tmpfs.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/verify/DUPLICITY/default/200_check_tmpfs.sh">https://github.com/rear/rear/blob/master/usr/share/rear/verify/DUPLICITY/default/200_check_tmpfs.sh</a></p>
<h4 id="ase7en34_commented_at_2020-07-24_1208"><img src="https://avatars.githubusercontent.com/u/65528374?v=4" width="50"><a href="https://github.com/ase7en34">ase7en34</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-663507433">2020-07-24 12:08</a>:<a class="headerlink" href="#ase7en34_commented_at_2020-07-24_1208" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Regarding<br />
"there is no enough disk space for used as cache or (temporary)
directory"<br />
in the ReaR recovery system:</p>
<p>I noticed by chance<br />
restore/GALAXY/default/390_create_ramdisk.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/restore/GALAXY/default/390_create_ramdisk.sh">https://github.com/rear/rear/blob/master/usr/share/rear/restore/GALAXY/default/390_create_ramdisk.sh</a><br />
and the two identical<br />
verify/GALAXY7/default/390_create_ramdisk.sh<br />
verify/GALAXY10/default/390_create_ramdisk.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/verify/GALAXY10/default/390_create_ramdisk.sh">https://github.com/rear/rear/blob/master/usr/share/rear/verify/GALAXY10/default/390_create_ramdisk.sh</a><br />
which are old code (that was not actually maintained since more than
10 years)<br />
but it may at least indicate what one might do to get<br />
"enough disk space for used as cache or (temporary) directory"<br />
in the ReaR recovery system.</p>
<p>There is also<br />
verify/DUPLICITY/default/200_check_tmpfs.sh<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/verify/DUPLICITY/default/200_check_tmpfs.sh">https://github.com/rear/rear/blob/master/usr/share/rear/verify/DUPLICITY/default/200_check_tmpfs.sh</a></p>
</blockquote>
<p>Hello Johannes,</p>
<p>thank you for this update. However I mentioned in my first post that
creating /ramfs or /tmpfs in memory did not solve the problem:</p>
<p>----Quote-----</p>
<p>We have tried some methods to solve this like creating of ramfs or tmpfs
and mounting in /tmp/ramfs, but without success. Also options like
nocache, use_cachedir did not helped us, error remains same.</p>
<p>----EndQuote-----</p>
<h4 id="jsmeix_commented_at_2020-07-24_1215"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2400#issuecomment-663509736">2020-07-24 12:15</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-07-24_1215" title="Permanent link">&para;</a></h4>
<p>@ase7en34<br />
ah - yes,<br />
thank you to remind my lossy mind ;-)</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2025 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-05-18.2400.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
