<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>#2436 Issue closed: OPALPBA: COPY_AS_IS_EXCLUDE+=( "$REAR_DIR_PREFIX" ) could be insufficient - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "#2436 Issue closed: OPALPBA: COPY_AS_IS_EXCLUDE+=( \"$REAR_DIR_PREFIX\" ) could be insufficient";
        var mkdocs_page_input_path = "issues/2020-06-23.2436.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', "366986045", "auto");
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/backup_netfs.html">Example of BACKUP=NETFS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear28.html">Release Notes ReaR 2.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">#2436 Issue closed: OPALPBA: COPY_AS_IS_EXCLUDE+=( "$REAR_DIR_PREFIX" ) could be insufficient</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2436_issue_closed_opalpba_copy_as_is_exclude_rear_dir_prefix_could_be_insufficient"><a href="https://github.com/rear/rear/issues/2436">#2436 Issue</a> <code>closed</code>: OPALPBA: COPY_AS_IS_EXCLUDE+=( "$REAR_DIR_PREFIX" ) could be insufficient<a class="headerlink" href="#2436_issue_closed_opalpba_copy_as_is_exclude_rear_dir_prefix_could_be_insufficient" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code>, <code>minor bug</code></p>
<h4 id="jsmeix_opened_issue_at_2020-06-23_1033"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> opened issue at <a href="https://github.com/rear/rear/issues/2436">2020-06-23 10:33</a>:<a class="headerlink" href="#jsmeix_opened_issue_at_2020-06-23_1033" title="Permanent link">&para;</a></h4>
<p>@OliverO2</p>
<p>by chance from plain looking at the code I noticed the following:</p>
<p>rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh
contains<br />
<a href="https://github.com/rear/rear/blob/master/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L16">https://github.com/rear/rear/blob/master/usr/share/rear/build/OPALPBA/Linux-i386/095_exclude_non_essential_files.sh#L16</a></p>
<pre><code># ReaR
COPY_AS_IS_EXCLUDE+=( "$REAR_DIR_PREFIX" )
</code></pre>
<p>but "$REAR_DIR_PREFIX" is only set in usr/sbin/rear<br />
if <code>rear</code> is running from a git checkout<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L78">https://github.com/rear/rear/blob/master/usr/sbin/rear#L78</a></p>
<pre><code># Find out if we're running from checkout
REAR_DIR_PREFIX=""
readonly SCRIPT_FILE="$( readlink -f $( type -p "$0" || echo "$0" ) )"
if test "$SCRIPT_FILE" != "$( readlink -f /usr/sbin/$PROGRAM )" ; then
    REAR_DIR_PREFIX=${SCRIPT_FILE%/usr/sbin/$PROGRAM}
fi
</code></pre>
<p>so in particular when <code>rear</code> is running from an installed RPM package<br />
"$REAR_DIR_PREFIX" is empty so that</p>
<pre><code>COPY_AS_IS_EXCLUDE+=( "$REAR_DIR_PREFIX" )
</code></pre>
<p>won't exclude anything as far as I see from plain looking at the code.</p>
<p>According to how "$REAR_DIR_PREFIX" is used in the code<br />
(<code>find usr/share/rear/ -type f | xargs grep 'REAR_DIR_PREFIX'</code>)<br />
I think what should work in any case to exclude ReaR is</p>
<pre><code>COPY_AS_IS_EXCLUDE+=( "$SHARE_DIR" "$CONFIG_DIR" "$VAR_DIR" "$LOG_DIR" )
</code></pre>
<p>cf.<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L86">https://github.com/rear/rear/blob/master/usr/sbin/rear#L86</a></p>
<pre><code># Program directories - they must be set here. Everything else is then dynamic.
# Not yet readonly here because they are set via the /etc/rear/rescue.conf file
# in the recovery system that is sourced by the rear command in recover mode
# and CONFIG_DIR can also be changed via '-c' command line option:
SHARE_DIR="$REAR_DIR_PREFIX/usr/share/rear"
CONFIG_DIR="$REAR_DIR_PREFIX/etc/rear"
VAR_DIR="$REAR_DIR_PREFIX/var/lib/rear"
LOG_DIR="$REAR_DIR_PREFIX/var/log/rear"
</code></pre>
<p>and<br />
<a href="https://github.com/rear/rear/blob/master/usr/sbin/rear#L501">https://github.com/rear/rear/blob/master/usr/sbin/rear#L501</a></p>
<pre><code># Now SHARE_DIR CONFIG_DIR VAR_DIR LOG_DIR and KERNEL_VERSION should be set to a fixed value:
readonly SHARE_DIR CONFIG_DIR VAR_DIR LOG_DIR KERNEL_VERSION
</code></pre>
<h4 id="olivero2_commented_at_2020-06-24_1618"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2436#issuecomment-648920992">2020-06-24 16:18</a>:<a class="headerlink" href="#olivero2_commented_at_2020-06-24_1618" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thanks for pointing this out. Will look at this one next week, too.</p>
<h4 id="olivero2_commented_at_2020-06-30_1826"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2436#issuecomment-651965909">2020-06-30 18:26</a>:<a class="headerlink" href="#olivero2_commented_at_2020-06-30_1826" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
Thank you for catching this and explaining the underlying mechanism in
detail. My new PR deals with the issue (and others) as far as reasonable
for me. As my testing has shown, not every copy can be avoided via
<code>COPY_AS_IS_EXCLUDE</code>. Some parts are hardcoded differently. For example,
excluding <code>$CONFIG_DIR</code> that way has no effect. The PR works around this
limitation.</p>
<p>With the PR's changes, <code>rear mkopalpba</code> and <code>rear mkrescue</code> run pretty
silent over here. The latter still produces this output:</p>
<pre><code>Symlink '/lib/modules/5.4.0-39-generic/build' -&gt; '/usr/src/linux-headers-5.4.0-39-generic' refers to a non-existing directory on the recovery system.
It will not be copied by default. You can include '/usr/src/linux-headers-5.4.0-39-generic' via the 'COPY_AS_IS' configuration variable.
</code></pre>
<p>This is due to the way
<code>usr/share/rear/build/GNU/Linux/400_copy_modules.sh</code> works when
configured with <code>MODULES=( 'all_modules' )</code>. No big deal for me.</p>
<h4 id="jsmeix_commented_at_2020-07-02_1306"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2436#issuecomment-652994299">2020-07-02 13:06</a>:<a class="headerlink" href="#jsmeix_commented_at_2020-07-02_1306" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2448">https://github.com/rear/rear/pull/2448</a>
merged this issue is fixed.</p>
<p>@OliverO2<br />
thank you for your continuous adaptions and improvements of the<br />
TCG Opal 2-compliant Self-Encrypting Disks support in ReaR!</p>
<h4 id="olivero2_commented_at_2020-07-02_1320"><img src="https://avatars.githubusercontent.com/u/4660803?v=4" width="50"><a href="https://github.com/OliverO2">OliverO2</a> commented at <a href="https://github.com/rear/rear/issues/2436#issuecomment-653001652">2020-07-02 13:20</a>:<a class="headerlink" href="#olivero2_commented_at_2020-07-02_1320" title="Permanent link">&para;</a></h4>
<p>@jsmeix<br />
As always, thank you for the excellent cooperation!</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2024 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2020-06-23.2436.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rear/rear-user-guide" class="fa fa-code-fork" style="color: #fcfcfc"> rear/rear-user-guide</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
