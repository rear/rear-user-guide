<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <meta property="og:title" content="Relax-and-Recover (ReaR) User Guide Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Relax-and-Recover (ReaR) kind of documentation ans starting with a good User Guide."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://relax-and-recover.org/rear-user-guide/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://relax-and-recover.org/rear-user-guide/img/rear_logo_50.png"/>
    <meta property="og:image:width" content="50"/>
    <meta property="og:image:height" content="50"/>
    
    <title>2019 08 02.2200.issue.closed - Relax-and-Recover (ReaR) User Guide Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/rear.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2019 08 02.2200.issue.closed";
        var mkdocs_page_input_path = "issues/2019-08-02.2200.issue.closed.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '366986045', 'auto');
        ga('send', 'pageview');
      </script>
    
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Relax-and-Recover (ReaR) User Guide Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">BASICS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/history.html">Bit of History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/getting-started.html">Getting started with ReaR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../basics/configuration.html">Basic configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SCENARIOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/index.html">Scenarios Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">DEVELOPMENT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/github-pr.html">Make a pull request with GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear27.html">Release Notes ReaR 2.7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/rear26.html">Release Notes ReaR 2.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../releasenotes/knownproblems.html">Known Problems and Workarounds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ISSUES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Issues History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../legal/license/index.html">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Relax-and-Recover (ReaR) User Guide Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>2019 08 02.2200.issue.closed</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="2200_issue_closed_new_use-case_for_blockclone_backup_method"><a href="https://github.com/rear/rear/issues/2200">#2200 Issue</a> <code>closed</code>: New use-case for BLOCKCLONE backup method<a class="headerlink" href="#2200_issue_closed_new_use-case_for_blockclone_backup_method" title="Permanent link">&para;</a></h1>
<p><strong>Labels</strong>: <code>enhancement</code>, <code>fixed / solved / done</code></p>
<h4 id="petroniusniger_opened_issue_at_2019-08-02_1225"><img src="https://avatars.githubusercontent.com/u/7203946?v=4" width="50"><a href="https://github.com/petroniusniger">petroniusniger</a> opened issue at <a href="https://github.com/rear/rear/issues/2200">2019-08-02 12:25</a>:<a class="headerlink" href="#petroniusniger_opened_issue_at_2019-08-02_1225" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>ReaR version ("/usr/sbin/rear -V"): git latest</p>
</li>
<li>
<p>OS version ("cat /etc/rear/os.conf" or "lsb_release -a" or "cat
    /etc/os-release"):<br />
    NAME="openSUSE Leap"<br />
    VERSION="15.0"<br />
    ID="opensuse-leap"<br />
    ID_LIKE="suse opensuse"<br />
    VERSION_ID="15.0"<br />
    PRETTY_NAME="openSUSE Leap 15.0"<br />
    ANSI_COLOR="0;32"<br />
    CPE_NAME="cpe:/o:opensuse:leap:15.0"<br />
    BUG_REPORT_URL="<a href="https://bugs.opensuse.org">https://bugs.opensuse.org</a>"<br />
    HOME_URL="<a href="https://www.opensuse.org/">https://www.opensuse.org/</a>"</p>
</li>
<li>
<p>ReaR configuration files ("cat /etc/rear/site.conf" and/or "cat
    /etc/rear/local.conf"):<br />
    Custom</p>
</li>
<li>
<p>Hardware (PC or PowerNV BareMetal or ARM) or virtual machine (KVM
    guest or PoverVM LPAR): VMware VM</p>
</li>
<li>
<p>System architecture (x86 compatible or PPC64/PPC64LE or what exact
    ARM device): x86</p>
</li>
<li>
<p>Firmware (BIOS or UEFI or Open Firmware) and bootloader (GRUB or
    ELILO or Petitboot): EFI + grub2-uefi</p>
</li>
<li>
<p>Storage (local disk or SSD) and/or SAN (FC or iSCSI or FCoE) and/or
    multipath (DM or NVMe): local virtual disk + LVM + LUKS</p>
</li>
<li>
<p>Description of the issue (ideally so that others can reproduce it):</p>
</li>
</ul>
<p>The current support for LUKS-encrypted filesystems means that the backup
of the data it contains will be taken while the filesystem is decrypted
and that during the recover phase a new encrypted filesystem will be
created with new encryption keys, and the data then restored inside.</p>
<p>This is all very good and it works very well, but what if you have a
more complex LUKS setup, with different passphrases or keys stored in
some of the 8 slots it provides to do so. Perhaps you would care as much
about recovering your data as you cared about recovering the exact LUKS
setup you created, including those keys.</p>
<p>So I thought about using the "multiple backups" approach, ignoring the
encrypted filesystem during the "base system" backup phase, and then
using a second BLOCKCLONE phase using <code>dd</code> to image the underlying block
device (a logical volume in my case) that contains the encrypted
filesystem. And it mostly worked out of the box. I only faced 2 minor
issues:</p>
<ul>
<li>I still got prompted to create a new encryption key for the target
    device -- this is purely cosmetic, as it will just get overwritten
    by the BLOCKCLONE restore</li>
<li>since the various scripts didn't take any steps to try and unmount
    the filesystem before the backup and the restore phase, the
    recovered system failed to boot as it considered the filesystem
    corrupted, and I had to run the repair command manually.</li>
</ul>
<p>To remedy this latter shortcoming, I've created a new configuration
variable and improved the BLOCKCLONE backup and restore scripts:</p>
<ul>
<li>if <code>BLOCKCLONE_TRY_UNMOUNT</code>is set to "yes", both scripts will now
    try to unmount the source/target device before performing the
    backup/restore. If the unmounting fails, this is not considered
    fatal and a warning message is issued (as before)</li>
<li>if the device was initially mounted and it could be unmounted, then
    the backup script will try to remount it once its job is over (the
    restore script doesn't try to remount, just issues a message stating
    that the user may do so manually if needed)</li>
<li>I've also documented this new use-case in the User Guide, chapter
    12, "BLOCKCLONE"</li>
</ul>
<p>I'll prepare a branch with the updated code for review.</p>
<h4 id="petroniusniger_commented_at_2019-08-02_1309"><img src="https://avatars.githubusercontent.com/u/7203946?v=4" width="50"><a href="https://github.com/petroniusniger">petroniusniger</a> commented at <a href="https://github.com/rear/rear/issues/2200#issuecomment-517694434">2019-08-02 13:09</a>:<a class="headerlink" href="#petroniusniger_commented_at_2019-08-02_1309" title="Permanent link">&para;</a></h4>
<p>In addition to the aforementioned changes, the branch will also contain:</p>
<ul>
<li>bug fix in global function <code>umount_mountpoint()</code>: return value now
    visible by calling script</li>
<li>cosmetics in global function <code>is_device_mounted()</code>: local variables
    now defined as <code>local</code></li>
<li>new global function <code>get_mountpoint()</code></li>
<li>fixed typo in User Guide, chapter 11, "multiple backups"</li>
</ul>
<h4 id="petroniusniger_commented_at_2019-08-02_1316"><img src="https://avatars.githubusercontent.com/u/7203946?v=4" width="50"><a href="https://github.com/petroniusniger">petroniusniger</a> commented at <a href="https://github.com/rear/rear/issues/2200#issuecomment-517696739">2019-08-02 13:16</a>:<a class="headerlink" href="#petroniusniger_commented_at_2019-08-02_1316" title="Permanent link">&para;</a></h4>
<p>All current changes pushed to branch "issue-2200".</p>
<h4 id="jsmeix_commented_at_2019-09-03_1158"><img src="https://avatars.githubusercontent.com/u/1788608?u=925fc54e2ce01551392622446ece427f51e2f0ce&v=4" width="50"><a href="https://github.com/jsmeix">jsmeix</a> commented at <a href="https://github.com/rear/rear/issues/2200#issuecomment-527427262">2019-09-03 11:58</a>:<a class="headerlink" href="#jsmeix_commented_at_2019-09-03_1158" title="Permanent link">&para;</a></h4>
<p>With
<a href="https://github.com/rear/rear/pull/2201">https://github.com/rear/rear/pull/2201</a>
merged<br />
I think this issue is done.</p>
<hr />
<p>[Export of Github issue for
<a href="https://github.com/rear/rear">rear/rear</a>.]</p>
              
            </div>
          </div>

<footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2022 - CC0 1.0 Universal<br />Give <a href="https://github.com/rear/rear-user-guide/issues/new?title=issues/2019-08-02.2200.issue.closed.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
